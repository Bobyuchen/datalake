[0m11:10:19.364587 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000001CEC7855710>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000001CEC7853390>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000001CEC7854C50>]}


============================== 11:10:19.368589 | 705ef4a4-53e3-4d04-8d01-e09d99abf131 ==============================
[0m11:10:19.368589 [info ] [MainThread]: Running with dbt=1.8.2
[0m11:10:19.370065 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'indirect_selection': 'eager', 'write_json': 'True', 'log_cache_events': 'False', 'partial_parse': 'True', 'cache_selected_only': 'False', 'warn_error': 'None', 'fail_fast': 'False', 'debug': 'False', 'log_path': 'C:\\Users\\ASUS\\Desktop\\work\\Iceberg-Dbt-Trino-Hive-modern-open-source-data-stack-main\\dbt\\logs', 'version_check': 'True', 'profiles_dir': 'C:\\Users\\ASUS\\Desktop\\work\\Iceberg-Dbt-Trino-Hive-modern-open-source-data-stack-main\\dbt', 'use_colors': 'True', 'use_experimental_parser': 'False', 'no_print': 'None', 'quiet': 'False', 'log_format': 'default', 'static_parser': 'True', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'invocation_command': 'dbt debug', 'target_path': 'None', 'introspect': 'True', 'send_anonymous_usage_stats': 'True'}
[0m11:10:19.393741 [info ] [MainThread]: dbt version: 1.8.2
[0m11:10:19.393741 [info ] [MainThread]: python version: 3.11.5
[0m11:10:19.394980 [info ] [MainThread]: python path: C:\Users\ASUS\anaconda3\python.exe
[0m11:10:19.394980 [info ] [MainThread]: os info: Windows-10-10.0.22631-SP0
[0m11:10:19.799630 [info ] [MainThread]: Using profiles dir at C:\Users\ASUS\Desktop\work\Iceberg-Dbt-Trino-Hive-modern-open-source-data-stack-main\dbt
[0m11:10:19.800630 [info ] [MainThread]: Using profiles.yml file at C:\Users\ASUS\Desktop\work\Iceberg-Dbt-Trino-Hive-modern-open-source-data-stack-main\dbt\profiles.yml
[0m11:10:19.800630 [info ] [MainThread]: Using dbt_project.yml file at C:\Users\ASUS\Desktop\work\Iceberg-Dbt-Trino-Hive-modern-open-source-data-stack-main\dbt\dbt_project.yml
[0m11:10:19.801630 [info ] [MainThread]: adapter type: trino
[0m11:10:19.801630 [info ] [MainThread]: adapter version: 1.8.0
[0m11:10:19.866143 [info ] [MainThread]: Configuration:
[0m11:10:19.867140 [info ] [MainThread]:   profiles.yml file [[32mOK found and valid[0m]
[0m11:10:19.867140 [info ] [MainThread]:   dbt_project.yml file [[32mOK found and valid[0m]
[0m11:10:19.868140 [info ] [MainThread]: Required dependencies:
[0m11:10:19.868140 [debug] [MainThread]: Executing "git --help"
[0m11:10:19.974505 [debug] [MainThread]: STDOUT: "b"usage: git [-v | --version] [-h | --help] [-C <path>] [-c <name>=<value>]\n           [--exec-path[=<path>]] [--html-path] [--man-path] [--info-path]\n           [-p | --paginate | -P | --no-pager] [--no-replace-objects] [--bare]\n           [--git-dir=<path>] [--work-tree=<path>] [--namespace=<name>]\n           [--config-env=<name>=<envvar>] <command> [<args>]\n\nThese are common Git commands used in various situations:\n\nstart a working area (see also: git help tutorial)\n   clone     Clone a repository into a new directory\n   init      Create an empty Git repository or reinitialize an existing one\n\nwork on the current change (see also: git help everyday)\n   add       Add file contents to the index\n   mv        Move or rename a file, a directory, or a symlink\n   restore   Restore working tree files\n   rm        Remove files from the working tree and from the index\n\nexamine the history and state (see also: git help revisions)\n   bisect    Use binary search to find the commit that introduced a bug\n   diff      Show changes between commits, commit and working tree, etc\n   grep      Print lines matching a pattern\n   log       Show commit logs\n   show      Show various types of objects\n   status    Show the working tree status\n\ngrow, mark and tweak your common history\n   branch    List, create, or delete branches\n   commit    Record changes to the repository\n   merge     Join two or more development histories together\n   rebase    Reapply commits on top of another base tip\n   reset     Reset current HEAD to the specified state\n   switch    Switch branches\n   tag       Create, list, delete or verify a tag object signed with GPG\n\ncollaborate (see also: git help workflows)\n   fetch     Download objects and refs from another repository\n   pull      Fetch from and integrate with another repository or a local branch\n   push      Update remote refs along with associated objects\n\n'git help -a' and 'git help -g' list available subcommands and some\nconcept guides. See 'git help <command>' or 'git help <concept>'\nto read about a specific subcommand or concept.\nSee 'git help git' for an overview of the system.\n""
[0m11:10:19.975505 [debug] [MainThread]: STDERR: "b''"
[0m11:10:19.975505 [info ] [MainThread]:  - git [[32mOK found[0m]

[0m11:10:19.976509 [info ] [MainThread]: Connection:
[0m11:10:19.976509 [info ] [MainThread]:   host: localhost
[0m11:10:19.977505 [info ] [MainThread]:   port: 8080
[0m11:10:19.978079 [info ] [MainThread]:   user: admin
[0m11:10:19.978587 [info ] [MainThread]:   database: datalake
[0m11:10:19.979125 [info ] [MainThread]:   schema: analytics
[0m11:10:19.979660 [info ] [MainThread]:   cert: None
[0m11:10:19.980191 [info ] [MainThread]:   prepared_statements_enabled: True
[0m11:10:19.980720 [info ] [MainThread]: Registered adapter: trino=1.8.0
[0m11:10:19.981239 [debug] [MainThread]: Acquiring new trino connection 'debug'
[0m11:10:20.138550 [debug] [MainThread]: Using trino connection "debug"
[0m11:10:20.139548 [debug] [MainThread]: On debug: select 1 as id
[0m11:10:20.139548 [debug] [MainThread]: Opening a new connection, currently in state init
[0m11:10:20.802607 [debug] [MainThread]: SQL status: SUCCESS in 1.0 seconds
[0m11:10:20.802607 [debug] [MainThread]: On debug: Close
[0m11:10:20.804182 [info ] [MainThread]:   Connection test: [[32mOK connection ok[0m]

[0m11:10:20.805139 [info ] [MainThread]: [32mAll checks passed![0m
[0m11:10:20.807138 [debug] [MainThread]: Command `dbt debug` succeeded at 11:10:20.807138 after 1.60 seconds
[0m11:10:20.807138 [debug] [MainThread]: Connection 'debug' was properly closed.
[0m11:10:20.808138 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000001CEC6C4CED0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000001CEC7FB8A90>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000001CEC29A4410>]}
[0m11:10:20.808138 [debug] [MainThread]: Flushing usage events
[0m11:20:17.695045 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000001E955005B50>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000001E954FF7A90>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000001E955047790>]}


============================== 11:20:17.698044 | 9ed89192-263b-42d0-b34d-a593b4fbb192 ==============================
[0m11:20:17.698044 [info ] [MainThread]: Running with dbt=1.8.2
[0m11:20:17.699046 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'indirect_selection': 'eager', 'log_cache_events': 'False', 'write_json': 'True', 'partial_parse': 'True', 'cache_selected_only': 'False', 'profiles_dir': 'C:\\Users\\ASUS\\Desktop\\work\\Iceberg-Dbt-Trino-Hive-modern-open-source-data-stack-main\\dbt', 'fail_fast': 'False', 'warn_error': 'None', 'log_path': 'C:\\Users\\ASUS\\Desktop\\work\\Iceberg-Dbt-Trino-Hive-modern-open-source-data-stack-main\\dbt\\logs', 'debug': 'False', 'version_check': 'True', 'use_colors': 'True', 'use_experimental_parser': 'False', 'no_print': 'None', 'quiet': 'False', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'invocation_command': 'dbt debug', 'introspect': 'True', 'static_parser': 'True', 'target_path': 'None', 'log_format': 'default', 'send_anonymous_usage_stats': 'True'}
[0m11:20:17.707702 [info ] [MainThread]: dbt version: 1.8.2
[0m11:20:17.707702 [info ] [MainThread]: python version: 3.11.5
[0m11:20:17.711131 [info ] [MainThread]: python path: C:\Users\ASUS\anaconda3\python.exe
[0m11:20:17.711131 [info ] [MainThread]: os info: Windows-10-10.0.22631-SP0
[0m11:20:17.874381 [info ] [MainThread]: Using profiles dir at C:\Users\ASUS\Desktop\work\Iceberg-Dbt-Trino-Hive-modern-open-source-data-stack-main\dbt
[0m11:20:17.875380 [info ] [MainThread]: Using profiles.yml file at C:\Users\ASUS\Desktop\work\Iceberg-Dbt-Trino-Hive-modern-open-source-data-stack-main\dbt\profiles.yml
[0m11:20:17.875380 [info ] [MainThread]: Using dbt_project.yml file at C:\Users\ASUS\Desktop\work\Iceberg-Dbt-Trino-Hive-modern-open-source-data-stack-main\dbt\dbt_project.yml
[0m11:20:17.876446 [info ] [MainThread]: adapter type: trino
[0m11:20:17.876950 [info ] [MainThread]: adapter version: 1.8.0
[0m11:20:17.941176 [info ] [MainThread]: Configuration:
[0m11:20:17.942178 [info ] [MainThread]:   profiles.yml file [[32mOK found and valid[0m]
[0m11:20:17.943176 [info ] [MainThread]:   dbt_project.yml file [[32mOK found and valid[0m]
[0m11:20:17.943176 [info ] [MainThread]: Required dependencies:
[0m11:20:17.944669 [debug] [MainThread]: Executing "git --help"
[0m11:20:18.035234 [debug] [MainThread]: STDOUT: "b"usage: git [-v | --version] [-h | --help] [-C <path>] [-c <name>=<value>]\n           [--exec-path[=<path>]] [--html-path] [--man-path] [--info-path]\n           [-p | --paginate | -P | --no-pager] [--no-replace-objects] [--bare]\n           [--git-dir=<path>] [--work-tree=<path>] [--namespace=<name>]\n           [--config-env=<name>=<envvar>] <command> [<args>]\n\nThese are common Git commands used in various situations:\n\nstart a working area (see also: git help tutorial)\n   clone     Clone a repository into a new directory\n   init      Create an empty Git repository or reinitialize an existing one\n\nwork on the current change (see also: git help everyday)\n   add       Add file contents to the index\n   mv        Move or rename a file, a directory, or a symlink\n   restore   Restore working tree files\n   rm        Remove files from the working tree and from the index\n\nexamine the history and state (see also: git help revisions)\n   bisect    Use binary search to find the commit that introduced a bug\n   diff      Show changes between commits, commit and working tree, etc\n   grep      Print lines matching a pattern\n   log       Show commit logs\n   show      Show various types of objects\n   status    Show the working tree status\n\ngrow, mark and tweak your common history\n   branch    List, create, or delete branches\n   commit    Record changes to the repository\n   merge     Join two or more development histories together\n   rebase    Reapply commits on top of another base tip\n   reset     Reset current HEAD to the specified state\n   switch    Switch branches\n   tag       Create, list, delete or verify a tag object signed with GPG\n\ncollaborate (see also: git help workflows)\n   fetch     Download objects and refs from another repository\n   pull      Fetch from and integrate with another repository or a local branch\n   push      Update remote refs along with associated objects\n\n'git help -a' and 'git help -g' list available subcommands and some\nconcept guides. See 'git help <command>' or 'git help <concept>'\nto read about a specific subcommand or concept.\nSee 'git help git' for an overview of the system.\n""
[0m11:20:18.035234 [debug] [MainThread]: STDERR: "b''"
[0m11:20:18.035234 [info ] [MainThread]:  - git [[32mOK found[0m]

[0m11:20:18.036694 [info ] [MainThread]: Connection:
[0m11:20:18.036694 [info ] [MainThread]:   host: localhost
[0m11:20:18.037704 [info ] [MainThread]:   port: 8080
[0m11:20:18.037704 [info ] [MainThread]:   user: admin
[0m11:20:18.038702 [info ] [MainThread]:   database: datalake
[0m11:20:18.038702 [info ] [MainThread]:   schema: analytics
[0m11:20:18.038702 [info ] [MainThread]:   cert: None
[0m11:20:18.040138 [info ] [MainThread]:   prepared_statements_enabled: True
[0m11:20:18.041150 [info ] [MainThread]: Registered adapter: trino=1.8.0
[0m11:20:18.041150 [debug] [MainThread]: Acquiring new trino connection 'debug'
[0m11:20:18.100750 [debug] [MainThread]: Using trino connection "debug"
[0m11:20:18.101753 [debug] [MainThread]: On debug: select 1 as id
[0m11:20:18.101753 [debug] [MainThread]: Opening a new connection, currently in state init
[0m11:20:18.175329 [debug] [MainThread]: SQL status: SUCCESS in 0.0 seconds
[0m11:20:18.176339 [debug] [MainThread]: On debug: Close
[0m11:20:18.177339 [info ] [MainThread]:   Connection test: [[32mOK connection ok[0m]

[0m11:20:18.177339 [info ] [MainThread]: [32mAll checks passed![0m
[0m11:20:18.179341 [debug] [MainThread]: Command `dbt debug` succeeded at 11:20:18.179341 after 0.61 seconds
[0m11:20:18.179341 [debug] [MainThread]: Connection 'debug' was properly closed.
[0m11:20:18.179341 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000001E95500B0D0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000001E954CE2E90>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000001E950354750>]}
[0m11:20:18.180338 [debug] [MainThread]: Flushing usage events
[0m13:53:52.953446 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x00000124AE845E50>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x00000124AE859210>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x00000124AE883310>]}


============================== 13:53:52.957445 | 31f3c16c-cee0-4582-8477-1512c33afc50 ==============================
[0m13:53:52.957445 [info ] [MainThread]: Running with dbt=1.8.2
[0m13:53:52.958446 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'indirect_selection': 'eager', 'write_json': 'True', 'log_cache_events': 'False', 'partial_parse': 'True', 'cache_selected_only': 'False', 'profiles_dir': 'C:\\Users\\ASUS\\Desktop\\work\\Iceberg-Dbt-Trino-Hive-modern-open-source-data-stack-main\\dbt', 'fail_fast': 'False', 'version_check': 'True', 'log_path': 'C:\\Users\\ASUS\\Desktop\\work\\Iceberg-Dbt-Trino-Hive-modern-open-source-data-stack-main\\dbt\\logs', 'debug': 'False', 'warn_error': 'None', 'use_colors': 'True', 'use_experimental_parser': 'False', 'no_print': 'None', 'quiet': 'False', 'log_format': 'default', 'static_parser': 'True', 'invocation_command': 'dbt test', 'introspect': 'True', 'target_path': 'None', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'send_anonymous_usage_stats': 'True'}
[0m13:53:53.402824 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': '31f3c16c-cee0-4582-8477-1512c33afc50', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x00000124AEC06D50>]}
[0m13:53:53.437252 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': '31f3c16c-cee0-4582-8477-1512c33afc50', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x00000124AEC07010>]}
[0m13:53:53.438253 [info ] [MainThread]: Registered adapter: trino=1.8.0
[0m13:53:53.439330 [error] [MainThread]: Encountered an error:
Compilation Error
  dbt found 2 package(s) specified in packages.yml, but only 0 package(s) installed in dbt_packages. Run "dbt deps" to install package dependencies.
[0m13:53:53.440975 [debug] [MainThread]: Command `dbt test` failed at 13:53:53.440537 after 0.63 seconds
[0m13:53:53.440975 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x00000124AE8BBE90>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x00000124AE8BBF50>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x00000124AE8BBE50>]}
[0m13:53:53.440975 [debug] [MainThread]: Flushing usage events
[0m13:54:09.202739 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000002AD51975210>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000002AD519B7A90>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000002AD5125B490>]}


============================== 13:54:09.204739 | 0a544f03-ccaa-4b23-8f0a-132e821f1c84 ==============================
[0m13:54:09.204739 [info ] [MainThread]: Running with dbt=1.8.2
[0m13:54:09.205739 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'indirect_selection': 'eager', 'log_cache_events': 'False', 'write_json': 'True', 'partial_parse': 'True', 'cache_selected_only': 'False', 'profiles_dir': 'C:\\Users\\ASUS\\Desktop\\work\\Iceberg-Dbt-Trino-Hive-modern-open-source-data-stack-main\\dbt', 'debug': 'False', 'fail_fast': 'False', 'log_path': 'C:\\Users\\ASUS\\Desktop\\work\\Iceberg-Dbt-Trino-Hive-modern-open-source-data-stack-main\\dbt\\logs', 'warn_error': 'None', 'version_check': 'True', 'use_colors': 'True', 'use_experimental_parser': 'False', 'no_print': 'None', 'quiet': 'False', 'log_format': 'default', 'introspect': 'True', 'invocation_command': 'dbt deps', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'target_path': 'None', 'static_parser': 'True', 'send_anonymous_usage_stats': 'True'}
[0m13:54:09.342647 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': '0a544f03-ccaa-4b23-8f0a-132e821f1c84', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000002AD51A15310>]}
[0m13:54:09.361513 [debug] [MainThread]: Set downloads directory='C:\Users\ASUS\AppData\Local\Temp\dbt-downloads-rxb_bp0b'
[0m13:54:09.361513 [debug] [MainThread]: Making package index registry request: GET https://hub.getdbt.com/api/v1/index.json
[0m13:54:10.392289 [debug] [MainThread]: Response from registry index: GET https://hub.getdbt.com/api/v1/index.json 200
[0m13:54:10.393818 [debug] [MainThread]: Making package registry request: GET https://hub.getdbt.com/api/v1/dbt-labs/dbt_utils.json
[0m13:54:11.416132 [debug] [MainThread]: Response from registry: GET https://hub.getdbt.com/api/v1/dbt-labs/dbt_utils.json 200
[0m13:54:11.421139 [debug] [MainThread]: Making package registry request: GET https://hub.getdbt.com/api/v1/starburstdata/trino_utils.json
[0m13:54:12.714924 [debug] [MainThread]: Response from registry: GET https://hub.getdbt.com/api/v1/starburstdata/trino_utils.json 200
[0m13:54:12.721990 [info ] [MainThread]: Updating lock file in file path: C:\Users\ASUS\Desktop\work\Iceberg-Dbt-Trino-Hive-modern-open-source-data-stack-main\dbt/package-lock.yml
[0m13:54:12.724589 [debug] [MainThread]: Set downloads directory='C:\Users\ASUS\AppData\Local\Temp\dbt-downloads-nhhrxewz'
[0m13:54:12.727357 [info ] [MainThread]: Installing dbt-labs/dbt_utils
[0m13:54:13.449435 [info ] [MainThread]: Installed from version 1.1.1
[0m13:54:13.449435 [info ] [MainThread]: Updated version available: 1.2.0
[0m13:54:13.450437 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'package', 'label': '0a544f03-ccaa-4b23-8f0a-132e821f1c84', 'property_': 'install', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000002AD5076A510>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000002AD51E9FF50>]}
[0m13:54:13.450437 [info ] [MainThread]: Installing starburstdata/trino_utils
[0m13:54:14.006919 [info ] [MainThread]: Installed from version 0.6.0
[0m13:54:14.006919 [info ] [MainThread]: Up to date!
[0m13:54:14.008207 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'package', 'label': '0a544f03-ccaa-4b23-8f0a-132e821f1c84', 'property_': 'install', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000002AD51A15BD0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000002AD519AA110>]}
[0m13:54:14.008207 [info ] [MainThread]: 
[0m13:54:14.009216 [info ] [MainThread]: Updates available for packages: ['dbt-labs/dbt_utils']                 
Update your versions in packages.yml, then run dbt deps
[0m13:54:14.011215 [debug] [MainThread]: Command `dbt deps` succeeded at 13:54:14.011215 after 4.95 seconds
[0m13:54:14.011215 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000002AD51A09DD0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000002AD4CAC4750>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000002AD4CA2E690>]}
[0m13:54:14.012213 [debug] [MainThread]: Flushing usage events
[0m13:55:09.945735 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x00000241A23A72D0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x00000241A23E1950>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x00000241A23D6F90>]}


============================== 13:55:09.947745 | f21a5e14-367e-4532-a519-0706f342a0dc ==============================
[0m13:55:09.947745 [info ] [MainThread]: Running with dbt=1.8.2
[0m13:55:09.948746 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'indirect_selection': 'eager', 'log_cache_events': 'False', 'write_json': 'True', 'partial_parse': 'True', 'cache_selected_only': 'False', 'warn_error': 'None', 'fail_fast': 'False', 'version_check': 'True', 'log_path': 'C:\\Users\\ASUS\\Desktop\\work\\Iceberg-Dbt-Trino-Hive-modern-open-source-data-stack-main\\dbt\\logs', 'debug': 'False', 'profiles_dir': 'C:\\Users\\ASUS\\Desktop\\work\\Iceberg-Dbt-Trino-Hive-modern-open-source-data-stack-main\\dbt', 'use_colors': 'True', 'use_experimental_parser': 'False', 'no_print': 'None', 'quiet': 'False', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'static_parser': 'True', 'log_format': 'default', 'invocation_command': 'dbt test', 'target_path': 'None', 'introspect': 'True', 'send_anonymous_usage_stats': 'True'}
[0m13:55:10.281863 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': 'f21a5e14-367e-4532-a519-0706f342a0dc', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x00000241A20CBA50>]}
[0m13:55:10.317706 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': 'f21a5e14-367e-4532-a519-0706f342a0dc', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000002419F5253D0>]}
[0m13:55:10.317706 [info ] [MainThread]: Registered adapter: trino=1.8.0
[0m13:55:10.329006 [debug] [MainThread]: checksum: f0a141b9de567cb7f131613ba2682f40b3a1c6a157f81c6e5435862eff68f109, vars: {}, profile: , target: , version: 1.8.2
[0m13:55:10.329532 [info ] [MainThread]: Unable to do partial parsing because saved manifest not found. Starting full parse.
[0m13:55:10.330060 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'partial_parser', 'label': 'f21a5e14-367e-4532-a519-0706f342a0dc', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x00000241A253D8D0>]}
[0m13:55:11.314374 [warn ] [MainThread]: [[33mWARNING[0m]: Deprecated functionality
The `tests` config has been renamed to `data_tests`. Please see
https://docs.getdbt.com/docs/build/data-tests#new-data_tests-syntax for more
information.
[0m13:55:11.315815 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'deprecation', 'label': 'f21a5e14-367e-4532-a519-0706f342a0dc', 'property_': 'warn', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x00000241A26FF390>]}
[0m13:55:11.322819 [warn ] [MainThread]: [[33mWARNING[0m]: Did not find matching node for patch with name 'auth_events' in the 'models' section of file 'models\schema.yml'
[0m13:55:11.473919 [warn ] [MainThread]: [[33mWARNING[0m]: Test 'test.my_dbt_trino_project.unique_auth_events_sessionId.d4e6c5c31c' (models\schema.yml) depends on a node named 'auth_events' in package '' which was not found
[0m13:55:11.473919 [warn ] [MainThread]: [[33mWARNING[0m]: Test 'test.my_dbt_trino_project.accepted_values_auth_events_level__free__paid.d9038ceb20' (models\schema.yml) depends on a node named 'auth_events' in package '' which was not found
[0m13:55:11.475260 [warn ] [MainThread]: [[33mWARNING[0m]: Test 'test.my_dbt_trino_project.not_null_auth_events_itemInSession.f485d08ef6' (models\schema.yml) depends on a node named 'auth_events' in package '' which was not found
[0m13:55:11.475260 [warn ] [MainThread]: [[33mWARNING[0m]: Test 'test.my_dbt_trino_project.accepted_values_auth_events_gender__M__F.2485b60684' (models\schema.yml) depends on a node named 'auth_events' in package '' which was not found
[0m13:55:11.476556 [warn ] [MainThread]: [[33mWARNING[0m]: Test 'test.my_dbt_trino_project.accepted_values_auth_events_success__True__False.00a11715d4' (models\schema.yml) depends on a node named 'auth_events' in package '' which was not found
[0m13:55:11.553440 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': 'f21a5e14-367e-4532-a519-0706f342a0dc', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x00000241A23D78D0>]}
[0m13:55:11.648694 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': 'f21a5e14-367e-4532-a519-0706f342a0dc', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x00000241A3E83E50>]}
[0m13:55:11.648694 [info ] [MainThread]: Found 15 models, 7 data tests, 3 sources, 559 macros
[0m13:55:11.649695 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': 'f21a5e14-367e-4532-a519-0706f342a0dc', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x00000241A2B76890>]}
[0m13:55:11.651694 [info ] [MainThread]: 
[0m13:55:11.651694 [debug] [MainThread]: Acquiring new trino connection 'master'
[0m13:55:11.656631 [debug] [ThreadPool]: Acquiring new trino connection 'list_datalake_analytics_source'
[0m13:55:11.769337 [debug] [ThreadPool]: Using trino connection "list_datalake_analytics_source"
[0m13:55:11.770337 [debug] [ThreadPool]: On list_datalake_analytics_source: /* {"app": "dbt", "dbt_version": "1.8.2", "profile_name": "my_dbt_trino_project", "target_name": "dev", "connection_name": "list_datalake_analytics_source"} */
select
      t.table_catalog as database,
      t.table_name as name,
      t.table_schema as schema,
      case when mv.name is not null then 'materialized_view'
           when t.table_type = 'BASE TABLE' then 'table'
           when t.table_type = 'VIEW' then 'view'
           else t.table_type
      end as table_type
    from "datalake".INFORMATION_SCHEMA.tables t
    left join (
            select * from system.metadata.materialized_views
            where catalog_name = 'datalake'
              and schema_name = 'analytics_source') mv
          on mv.catalog_name = t.table_catalog and mv.schema_name = t.table_schema and mv.name = t.table_name
    where t.table_schema = 'analytics_source'
[0m13:55:11.770337 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m13:55:13.241438 [debug] [ThreadPool]: SQL status: SUCCESS in 1.0 seconds
[0m13:55:13.242524 [debug] [ThreadPool]: On list_datalake_analytics_source: ROLLBACK
[0m13:55:13.244031 [debug] [ThreadPool]: On list_datalake_analytics_source: Close
[0m13:55:13.244031 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_datalake_analytics_source, now list_datalake_analytics_stage)
[0m13:55:13.248536 [debug] [ThreadPool]: Using trino connection "list_datalake_analytics_stage"
[0m13:55:13.249548 [debug] [ThreadPool]: On list_datalake_analytics_stage: /* {"app": "dbt", "dbt_version": "1.8.2", "profile_name": "my_dbt_trino_project", "target_name": "dev", "connection_name": "list_datalake_analytics_stage"} */
select
      t.table_catalog as database,
      t.table_name as name,
      t.table_schema as schema,
      case when mv.name is not null then 'materialized_view'
           when t.table_type = 'BASE TABLE' then 'table'
           when t.table_type = 'VIEW' then 'view'
           else t.table_type
      end as table_type
    from "datalake".INFORMATION_SCHEMA.tables t
    left join (
            select * from system.metadata.materialized_views
            where catalog_name = 'datalake'
              and schema_name = 'analytics_stage') mv
          on mv.catalog_name = t.table_catalog and mv.schema_name = t.table_schema and mv.name = t.table_name
    where t.table_schema = 'analytics_stage'
[0m13:55:13.249548 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m13:55:13.439585 [debug] [ThreadPool]: SQL status: SUCCESS in 0.0 seconds
[0m13:55:13.441743 [debug] [ThreadPool]: On list_datalake_analytics_stage: ROLLBACK
[0m13:55:13.442742 [debug] [ThreadPool]: On list_datalake_analytics_stage: Close
[0m13:55:13.443251 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_datalake_analytics_stage, now list_datalake_analytics)
[0m13:55:13.447910 [debug] [ThreadPool]: Using trino connection "list_datalake_analytics"
[0m13:55:13.447910 [debug] [ThreadPool]: On list_datalake_analytics: /* {"app": "dbt", "dbt_version": "1.8.2", "profile_name": "my_dbt_trino_project", "target_name": "dev", "connection_name": "list_datalake_analytics"} */
select
      t.table_catalog as database,
      t.table_name as name,
      t.table_schema as schema,
      case when mv.name is not null then 'materialized_view'
           when t.table_type = 'BASE TABLE' then 'table'
           when t.table_type = 'VIEW' then 'view'
           else t.table_type
      end as table_type
    from "datalake".INFORMATION_SCHEMA.tables t
    left join (
            select * from system.metadata.materialized_views
            where catalog_name = 'datalake'
              and schema_name = 'analytics') mv
          on mv.catalog_name = t.table_catalog and mv.schema_name = t.table_schema and mv.name = t.table_name
    where t.table_schema = 'analytics'
[0m13:55:13.448910 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m13:55:13.598272 [debug] [ThreadPool]: SQL status: SUCCESS in 0.0 seconds
[0m13:55:13.599787 [debug] [ThreadPool]: On list_datalake_analytics: ROLLBACK
[0m13:55:13.600800 [debug] [ThreadPool]: On list_datalake_analytics: Close
[0m13:55:13.600800 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': 'f21a5e14-367e-4532-a519-0706f342a0dc', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x00000241A2920E90>]}
[0m13:55:13.601886 [debug] [MainThread]: On master: COMMIT
[0m13:55:13.602901 [info ] [MainThread]: Concurrency: 1 threads (target='dev')
[0m13:55:13.602901 [info ] [MainThread]: 
[0m13:55:13.607424 [debug] [Thread-1 (]: Began running node test.my_dbt_trino_project.accepted_values_src_auth_events_gender__F__M.888b091b87
[0m13:55:13.607987 [info ] [Thread-1 (]: 1 of 7 START test accepted_values_src_auth_events_gender__F__M ................. [RUN]
[0m13:55:13.608495 [debug] [Thread-1 (]: Acquiring new trino connection 'test.my_dbt_trino_project.accepted_values_src_auth_events_gender__F__M.888b091b87'
[0m13:55:13.609938 [debug] [Thread-1 (]: Began compiling node test.my_dbt_trino_project.accepted_values_src_auth_events_gender__F__M.888b091b87
[0m13:55:13.616018 [debug] [Thread-1 (]: Writing injected SQL for node "test.my_dbt_trino_project.accepted_values_src_auth_events_gender__F__M.888b091b87"
[0m13:55:13.618130 [debug] [Thread-1 (]: Began executing node test.my_dbt_trino_project.accepted_values_src_auth_events_gender__F__M.888b091b87
[0m13:55:13.638929 [debug] [Thread-1 (]: Writing runtime sql for node "test.my_dbt_trino_project.accepted_values_src_auth_events_gender__F__M.888b091b87"
[0m13:55:13.643519 [debug] [Thread-1 (]: Using trino connection "test.my_dbt_trino_project.accepted_values_src_auth_events_gender__F__M.888b091b87"
[0m13:55:13.643519 [debug] [Thread-1 (]: On test.my_dbt_trino_project.accepted_values_src_auth_events_gender__F__M.888b091b87: /* {"app": "dbt", "dbt_version": "1.8.2", "profile_name": "my_dbt_trino_project", "target_name": "dev", "node_id": "test.my_dbt_trino_project.accepted_values_src_auth_events_gender__F__M.888b091b87"} */
select
      count(*) as failures,
      count(*) != 0 as should_warn,
      count(*) != 0 as should_error
    from (
      
    
    

with all_values as (

    select
        gender as value_field,
        count(*) as n_records

    from "datalake"."analytics_source"."src_auth_events"
    group by gender

)

select *
from all_values
where value_field not in (
    'F','M'
)



      
    ) dbt_internal_test
[0m13:55:13.644516 [debug] [Thread-1 (]: Opening a new connection, currently in state init
[0m13:55:13.821638 [debug] [Thread-1 (]: Trino adapter: Trino query id: 20240617_050058_00005_4aicc
[0m13:55:13.822144 [debug] [Thread-1 (]: Trino adapter: Trino error: TrinoUserError(type=USER_ERROR, name=TABLE_NOT_FOUND, message="line 17:10: Table 'datalake.analytics_source.src_auth_events' does not exist", query_id=20240617_050058_00005_4aicc)
[0m13:55:13.822144 [debug] [Thread-1 (]: On test.my_dbt_trino_project.accepted_values_src_auth_events_gender__F__M.888b091b87: ROLLBACK
[0m13:55:13.823699 [debug] [Thread-1 (]: On test.my_dbt_trino_project.accepted_values_src_auth_events_gender__F__M.888b091b87: Close
[0m13:55:13.831041 [debug] [Thread-1 (]: Database Error in test accepted_values_src_auth_events_gender__F__M (models\source\schema.yml)
  TrinoUserError(type=USER_ERROR, name=TABLE_NOT_FOUND, message="line 17:10: Table 'datalake.analytics_source.src_auth_events' does not exist", query_id=20240617_050058_00005_4aicc)
  compiled Code at target\run\my_dbt_trino_project\models\source\schema.yml\accepted_values_src_auth_events_gender__F__M.sql
[0m13:55:13.831041 [error] [Thread-1 (]: 1 of 7 ERROR accepted_values_src_auth_events_gender__F__M ...................... [[31mERROR[0m in 0.22s]
[0m13:55:13.833696 [debug] [Thread-1 (]: Finished running node test.my_dbt_trino_project.accepted_values_src_auth_events_gender__F__M.888b091b87
[0m13:55:13.834271 [debug] [Thread-1 (]: Began running node test.my_dbt_trino_project.accepted_values_src_auth_events_level__free__paid.2d853012e0
[0m13:55:13.834271 [info ] [Thread-1 (]: 2 of 7 START test accepted_values_src_auth_events_level__free__paid ............ [RUN]
[0m13:55:13.835278 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly test.my_dbt_trino_project.accepted_values_src_auth_events_gender__F__M.888b091b87, now test.my_dbt_trino_project.accepted_values_src_auth_events_level__free__paid.2d853012e0)
[0m13:55:13.836300 [debug] [Thread-1 (]: Began compiling node test.my_dbt_trino_project.accepted_values_src_auth_events_level__free__paid.2d853012e0
[0m13:55:13.839649 [debug] [Thread-1 (]: Writing injected SQL for node "test.my_dbt_trino_project.accepted_values_src_auth_events_level__free__paid.2d853012e0"
[0m13:55:13.841131 [debug] [Thread-1 (]: Began executing node test.my_dbt_trino_project.accepted_values_src_auth_events_level__free__paid.2d853012e0
[0m13:55:13.843141 [debug] [Thread-1 (]: Writing runtime sql for node "test.my_dbt_trino_project.accepted_values_src_auth_events_level__free__paid.2d853012e0"
[0m13:55:13.845140 [debug] [Thread-1 (]: Using trino connection "test.my_dbt_trino_project.accepted_values_src_auth_events_level__free__paid.2d853012e0"
[0m13:55:13.846143 [debug] [Thread-1 (]: On test.my_dbt_trino_project.accepted_values_src_auth_events_level__free__paid.2d853012e0: /* {"app": "dbt", "dbt_version": "1.8.2", "profile_name": "my_dbt_trino_project", "target_name": "dev", "node_id": "test.my_dbt_trino_project.accepted_values_src_auth_events_level__free__paid.2d853012e0"} */
select
      count(*) as failures,
      count(*) != 0 as should_warn,
      count(*) != 0 as should_error
    from (
      
    
    

with all_values as (

    select
        level as value_field,
        count(*) as n_records

    from "datalake"."analytics_source"."src_auth_events"
    group by level

)

select *
from all_values
where value_field not in (
    'free','paid'
)



      
    ) dbt_internal_test
[0m13:55:13.846143 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m13:55:13.903994 [debug] [Thread-1 (]: Trino adapter: Trino query id: 20240617_050058_00006_4aicc
[0m13:55:13.903994 [debug] [Thread-1 (]: Trino adapter: Trino error: TrinoUserError(type=USER_ERROR, name=TABLE_NOT_FOUND, message="line 17:10: Table 'datalake.analytics_source.src_auth_events' does not exist", query_id=20240617_050058_00006_4aicc)
[0m13:55:13.904994 [debug] [Thread-1 (]: On test.my_dbt_trino_project.accepted_values_src_auth_events_level__free__paid.2d853012e0: ROLLBACK
[0m13:55:13.905993 [debug] [Thread-1 (]: On test.my_dbt_trino_project.accepted_values_src_auth_events_level__free__paid.2d853012e0: Close
[0m13:55:13.907990 [debug] [Thread-1 (]: Database Error in test accepted_values_src_auth_events_level__free__paid (models\source\schema.yml)
  TrinoUserError(type=USER_ERROR, name=TABLE_NOT_FOUND, message="line 17:10: Table 'datalake.analytics_source.src_auth_events' does not exist", query_id=20240617_050058_00006_4aicc)
  compiled Code at target\run\my_dbt_trino_project\models\source\schema.yml\accepted_values_src_auth_events_level__free__paid.sql
[0m13:55:13.908993 [error] [Thread-1 (]: 2 of 7 ERROR accepted_values_src_auth_events_level__free__paid ................. [[31mERROR[0m in 0.07s]
[0m13:55:13.909992 [debug] [Thread-1 (]: Finished running node test.my_dbt_trino_project.accepted_values_src_auth_events_level__free__paid.2d853012e0
[0m13:55:13.910994 [debug] [Thread-1 (]: Began running node test.my_dbt_trino_project.accepted_values_src_auth_events_success__True__False.5205206c4b
[0m13:55:13.910994 [info ] [Thread-1 (]: 3 of 7 START test accepted_values_src_auth_events_success__True__False ......... [RUN]
[0m13:55:13.911992 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly test.my_dbt_trino_project.accepted_values_src_auth_events_level__free__paid.2d853012e0, now test.my_dbt_trino_project.accepted_values_src_auth_events_success__True__False.5205206c4b)
[0m13:55:13.911992 [debug] [Thread-1 (]: Began compiling node test.my_dbt_trino_project.accepted_values_src_auth_events_success__True__False.5205206c4b
[0m13:55:13.918518 [debug] [Thread-1 (]: Writing injected SQL for node "test.my_dbt_trino_project.accepted_values_src_auth_events_success__True__False.5205206c4b"
[0m13:55:13.919518 [debug] [Thread-1 (]: Began executing node test.my_dbt_trino_project.accepted_values_src_auth_events_success__True__False.5205206c4b
[0m13:55:13.921741 [debug] [Thread-1 (]: Writing runtime sql for node "test.my_dbt_trino_project.accepted_values_src_auth_events_success__True__False.5205206c4b"
[0m13:55:13.924520 [debug] [Thread-1 (]: Using trino connection "test.my_dbt_trino_project.accepted_values_src_auth_events_success__True__False.5205206c4b"
[0m13:55:13.924520 [debug] [Thread-1 (]: On test.my_dbt_trino_project.accepted_values_src_auth_events_success__True__False.5205206c4b: /* {"app": "dbt", "dbt_version": "1.8.2", "profile_name": "my_dbt_trino_project", "target_name": "dev", "node_id": "test.my_dbt_trino_project.accepted_values_src_auth_events_success__True__False.5205206c4b"} */
select
      count(*) as failures,
      count(*) != 0 as should_warn,
      count(*) != 0 as should_error
    from (
      
    
    

with all_values as (

    select
        success as value_field,
        count(*) as n_records

    from "datalake"."analytics_source"."src_auth_events"
    group by success

)

select *
from all_values
where value_field not in (
    'True','False'
)



      
    ) dbt_internal_test
[0m13:55:13.925520 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m13:55:13.955696 [debug] [Thread-1 (]: Trino adapter: Trino query id: 20240617_050058_00007_4aicc
[0m13:55:13.956703 [debug] [Thread-1 (]: Trino adapter: Trino error: TrinoUserError(type=USER_ERROR, name=TABLE_NOT_FOUND, message="line 17:10: Table 'datalake.analytics_source.src_auth_events' does not exist", query_id=20240617_050058_00007_4aicc)
[0m13:55:13.956703 [debug] [Thread-1 (]: On test.my_dbt_trino_project.accepted_values_src_auth_events_success__True__False.5205206c4b: ROLLBACK
[0m13:55:13.956703 [debug] [Thread-1 (]: On test.my_dbt_trino_project.accepted_values_src_auth_events_success__True__False.5205206c4b: Close
[0m13:55:13.958880 [debug] [Thread-1 (]: Database Error in test accepted_values_src_auth_events_success__True__False (models\source\schema.yml)
  TrinoUserError(type=USER_ERROR, name=TABLE_NOT_FOUND, message="line 17:10: Table 'datalake.analytics_source.src_auth_events' does not exist", query_id=20240617_050058_00007_4aicc)
  compiled Code at target\run\my_dbt_trino_project\models\source\schema.yml\accepted_values_src_auth_events_success__True__False.sql
[0m13:55:13.959882 [error] [Thread-1 (]: 3 of 7 ERROR accepted_values_src_auth_events_success__True__False .............. [[31mERROR[0m in 0.05s]
[0m13:55:13.960883 [debug] [Thread-1 (]: Finished running node test.my_dbt_trino_project.accepted_values_src_auth_events_success__True__False.5205206c4b
[0m13:55:13.960883 [debug] [Thread-1 (]: Began running node test.my_dbt_trino_project.not_null_src_auth_events_sessionId.5faf81a495
[0m13:55:13.961883 [info ] [Thread-1 (]: 4 of 7 START test not_null_src_auth_events_sessionId ........................... [RUN]
[0m13:55:13.961883 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly test.my_dbt_trino_project.accepted_values_src_auth_events_success__True__False.5205206c4b, now test.my_dbt_trino_project.not_null_src_auth_events_sessionId.5faf81a495)
[0m13:55:13.962879 [debug] [Thread-1 (]: Began compiling node test.my_dbt_trino_project.not_null_src_auth_events_sessionId.5faf81a495
[0m13:55:13.968621 [debug] [Thread-1 (]: Writing injected SQL for node "test.my_dbt_trino_project.not_null_src_auth_events_sessionId.5faf81a495"
[0m13:55:13.969623 [debug] [Thread-1 (]: Began executing node test.my_dbt_trino_project.not_null_src_auth_events_sessionId.5faf81a495
[0m13:55:13.971623 [debug] [Thread-1 (]: Writing runtime sql for node "test.my_dbt_trino_project.not_null_src_auth_events_sessionId.5faf81a495"
[0m13:55:13.973619 [debug] [Thread-1 (]: Using trino connection "test.my_dbt_trino_project.not_null_src_auth_events_sessionId.5faf81a495"
[0m13:55:13.973619 [debug] [Thread-1 (]: On test.my_dbt_trino_project.not_null_src_auth_events_sessionId.5faf81a495: /* {"app": "dbt", "dbt_version": "1.8.2", "profile_name": "my_dbt_trino_project", "target_name": "dev", "node_id": "test.my_dbt_trino_project.not_null_src_auth_events_sessionId.5faf81a495"} */
select
      count(*) as failures,
      count(*) != 0 as should_warn,
      count(*) != 0 as should_error
    from (
      
    
    



select sessionId
from "datalake"."analytics_source"."src_auth_events"
where sessionId is null



      
    ) dbt_internal_test
[0m13:55:13.974619 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m13:55:14.001763 [debug] [Thread-1 (]: Trino adapter: Trino query id: 20240617_050058_00008_4aicc
[0m13:55:14.002762 [debug] [Thread-1 (]: Trino adapter: Trino error: TrinoUserError(type=USER_ERROR, name=TABLE_NOT_FOUND, message="line 14:6: Table 'datalake.analytics_source.src_auth_events' does not exist", query_id=20240617_050058_00008_4aicc)
[0m13:55:14.002762 [debug] [Thread-1 (]: On test.my_dbt_trino_project.not_null_src_auth_events_sessionId.5faf81a495: ROLLBACK
[0m13:55:14.003761 [debug] [Thread-1 (]: On test.my_dbt_trino_project.not_null_src_auth_events_sessionId.5faf81a495: Close
[0m13:55:14.005764 [debug] [Thread-1 (]: Database Error in test not_null_src_auth_events_sessionId (models\source\schema.yml)
  TrinoUserError(type=USER_ERROR, name=TABLE_NOT_FOUND, message="line 14:6: Table 'datalake.analytics_source.src_auth_events' does not exist", query_id=20240617_050058_00008_4aicc)
  compiled Code at target\run\my_dbt_trino_project\models\source\schema.yml\not_null_src_auth_events_sessionId.sql
[0m13:55:14.006773 [error] [Thread-1 (]: 4 of 7 ERROR not_null_src_auth_events_sessionId ................................ [[31mERROR[0m in 0.04s]
[0m13:55:14.008116 [debug] [Thread-1 (]: Finished running node test.my_dbt_trino_project.not_null_src_auth_events_sessionId.5faf81a495
[0m13:55:14.008116 [debug] [Thread-1 (]: Began running node test.my_dbt_trino_project.not_null_src_auth_events_ts.179fe664b6
[0m13:55:14.008116 [info ] [Thread-1 (]: 5 of 7 START test not_null_src_auth_events_ts .................................. [RUN]
[0m13:55:14.009122 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly test.my_dbt_trino_project.not_null_src_auth_events_sessionId.5faf81a495, now test.my_dbt_trino_project.not_null_src_auth_events_ts.179fe664b6)
[0m13:55:14.009122 [debug] [Thread-1 (]: Began compiling node test.my_dbt_trino_project.not_null_src_auth_events_ts.179fe664b6
[0m13:55:14.013126 [debug] [Thread-1 (]: Writing injected SQL for node "test.my_dbt_trino_project.not_null_src_auth_events_ts.179fe664b6"
[0m13:55:14.014122 [debug] [Thread-1 (]: Began executing node test.my_dbt_trino_project.not_null_src_auth_events_ts.179fe664b6
[0m13:55:14.016122 [debug] [Thread-1 (]: Writing runtime sql for node "test.my_dbt_trino_project.not_null_src_auth_events_ts.179fe664b6"
[0m13:55:14.017122 [debug] [Thread-1 (]: Using trino connection "test.my_dbt_trino_project.not_null_src_auth_events_ts.179fe664b6"
[0m13:55:14.018125 [debug] [Thread-1 (]: On test.my_dbt_trino_project.not_null_src_auth_events_ts.179fe664b6: /* {"app": "dbt", "dbt_version": "1.8.2", "profile_name": "my_dbt_trino_project", "target_name": "dev", "node_id": "test.my_dbt_trino_project.not_null_src_auth_events_ts.179fe664b6"} */
select
      count(*) as failures,
      count(*) != 0 as should_warn,
      count(*) != 0 as should_error
    from (
      
    
    



select ts
from "datalake"."analytics_source"."src_auth_events"
where ts is null



      
    ) dbt_internal_test
[0m13:55:14.018125 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m13:55:14.065480 [debug] [Thread-1 (]: Trino adapter: Trino query id: 20240617_050058_00009_4aicc
[0m13:55:14.066476 [debug] [Thread-1 (]: Trino adapter: Trino error: TrinoUserError(type=USER_ERROR, name=TABLE_NOT_FOUND, message="line 14:6: Table 'datalake.analytics_source.src_auth_events' does not exist", query_id=20240617_050058_00009_4aicc)
[0m13:55:14.066476 [debug] [Thread-1 (]: On test.my_dbt_trino_project.not_null_src_auth_events_ts.179fe664b6: ROLLBACK
[0m13:55:14.067476 [debug] [Thread-1 (]: On test.my_dbt_trino_project.not_null_src_auth_events_ts.179fe664b6: Close
[0m13:55:14.069878 [debug] [Thread-1 (]: Database Error in test not_null_src_auth_events_ts (models\source\schema.yml)
  TrinoUserError(type=USER_ERROR, name=TABLE_NOT_FOUND, message="line 14:6: Table 'datalake.analytics_source.src_auth_events' does not exist", query_id=20240617_050058_00009_4aicc)
  compiled Code at target\run\my_dbt_trino_project\models\source\schema.yml\not_null_src_auth_events_ts.sql
[0m13:55:14.070412 [error] [Thread-1 (]: 5 of 7 ERROR not_null_src_auth_events_ts ....................................... [[31mERROR[0m in 0.06s]
[0m13:55:14.071477 [debug] [Thread-1 (]: Finished running node test.my_dbt_trino_project.not_null_src_auth_events_ts.179fe664b6
[0m13:55:14.071477 [debug] [Thread-1 (]: Began running node test.my_dbt_trino_project.unique_src_auth_events_sessionId.86c4c7c26f
[0m13:55:14.072013 [info ] [Thread-1 (]: 6 of 7 START test unique_src_auth_events_sessionId ............................. [RUN]
[0m13:55:14.073083 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly test.my_dbt_trino_project.not_null_src_auth_events_ts.179fe664b6, now test.my_dbt_trino_project.unique_src_auth_events_sessionId.86c4c7c26f)
[0m13:55:14.073083 [debug] [Thread-1 (]: Began compiling node test.my_dbt_trino_project.unique_src_auth_events_sessionId.86c4c7c26f
[0m13:55:14.078342 [debug] [Thread-1 (]: Writing injected SQL for node "test.my_dbt_trino_project.unique_src_auth_events_sessionId.86c4c7c26f"
[0m13:55:14.078867 [debug] [Thread-1 (]: Began executing node test.my_dbt_trino_project.unique_src_auth_events_sessionId.86c4c7c26f
[0m13:55:14.080444 [debug] [Thread-1 (]: Writing runtime sql for node "test.my_dbt_trino_project.unique_src_auth_events_sessionId.86c4c7c26f"
[0m13:55:14.082449 [debug] [Thread-1 (]: Using trino connection "test.my_dbt_trino_project.unique_src_auth_events_sessionId.86c4c7c26f"
[0m13:55:14.082449 [debug] [Thread-1 (]: On test.my_dbt_trino_project.unique_src_auth_events_sessionId.86c4c7c26f: /* {"app": "dbt", "dbt_version": "1.8.2", "profile_name": "my_dbt_trino_project", "target_name": "dev", "node_id": "test.my_dbt_trino_project.unique_src_auth_events_sessionId.86c4c7c26f"} */
select
      count(*) as failures,
      count(*) != 0 as should_warn,
      count(*) != 0 as should_error
    from (
      
    
    

select
    sessionId as unique_field,
    count(*) as n_records

from "datalake"."analytics_source"."src_auth_events"
where sessionId is not null
group by sessionId
having count(*) > 1



      
    ) dbt_internal_test
[0m13:55:14.082449 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m13:55:14.134164 [debug] [Thread-1 (]: Trino adapter: Trino query id: 20240617_050058_00010_4aicc
[0m13:55:14.135166 [debug] [Thread-1 (]: Trino adapter: Trino error: TrinoUserError(type=USER_ERROR, name=TABLE_NOT_FOUND, message="line 15:6: Table 'datalake.analytics_source.src_auth_events' does not exist", query_id=20240617_050058_00010_4aicc)
[0m13:55:14.135166 [debug] [Thread-1 (]: On test.my_dbt_trino_project.unique_src_auth_events_sessionId.86c4c7c26f: ROLLBACK
[0m13:55:14.135166 [debug] [Thread-1 (]: On test.my_dbt_trino_project.unique_src_auth_events_sessionId.86c4c7c26f: Close
[0m13:55:14.137985 [debug] [Thread-1 (]: Database Error in test unique_src_auth_events_sessionId (models\source\schema.yml)
  TrinoUserError(type=USER_ERROR, name=TABLE_NOT_FOUND, message="line 15:6: Table 'datalake.analytics_source.src_auth_events' does not exist", query_id=20240617_050058_00010_4aicc)
  compiled Code at target\run\my_dbt_trino_project\models\source\schema.yml\unique_src_auth_events_sessionId.sql
[0m13:55:14.137985 [error] [Thread-1 (]: 6 of 7 ERROR unique_src_auth_events_sessionId .................................. [[31mERROR[0m in 0.07s]
[0m13:55:14.139364 [debug] [Thread-1 (]: Finished running node test.my_dbt_trino_project.unique_src_auth_events_sessionId.86c4c7c26f
[0m13:55:14.140431 [debug] [Thread-1 (]: Began running node test.my_dbt_trino_project.unique_src_auth_events_userId.9244f51c84
[0m13:55:14.140431 [info ] [Thread-1 (]: 7 of 7 START test unique_src_auth_events_userId ................................ [RUN]
[0m13:55:14.141638 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly test.my_dbt_trino_project.unique_src_auth_events_sessionId.86c4c7c26f, now test.my_dbt_trino_project.unique_src_auth_events_userId.9244f51c84)
[0m13:55:14.141638 [debug] [Thread-1 (]: Began compiling node test.my_dbt_trino_project.unique_src_auth_events_userId.9244f51c84
[0m13:55:14.145723 [debug] [Thread-1 (]: Writing injected SQL for node "test.my_dbt_trino_project.unique_src_auth_events_userId.9244f51c84"
[0m13:55:14.146727 [debug] [Thread-1 (]: Began executing node test.my_dbt_trino_project.unique_src_auth_events_userId.9244f51c84
[0m13:55:14.149726 [debug] [Thread-1 (]: Writing runtime sql for node "test.my_dbt_trino_project.unique_src_auth_events_userId.9244f51c84"
[0m13:55:14.150914 [debug] [Thread-1 (]: Using trino connection "test.my_dbt_trino_project.unique_src_auth_events_userId.9244f51c84"
[0m13:55:14.151916 [debug] [Thread-1 (]: On test.my_dbt_trino_project.unique_src_auth_events_userId.9244f51c84: /* {"app": "dbt", "dbt_version": "1.8.2", "profile_name": "my_dbt_trino_project", "target_name": "dev", "node_id": "test.my_dbt_trino_project.unique_src_auth_events_userId.9244f51c84"} */
select
      count(*) as failures,
      count(*) != 0 as should_warn,
      count(*) != 0 as should_error
    from (
      
    
    

select
    userId as unique_field,
    count(*) as n_records

from "datalake"."analytics_source"."src_auth_events"
where userId is not null
group by userId
having count(*) > 1



      
    ) dbt_internal_test
[0m13:55:14.151916 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m13:55:14.180474 [debug] [Thread-1 (]: Trino adapter: Trino query id: 20240617_050058_00011_4aicc
[0m13:55:14.181472 [debug] [Thread-1 (]: Trino adapter: Trino error: TrinoUserError(type=USER_ERROR, name=TABLE_NOT_FOUND, message="line 15:6: Table 'datalake.analytics_source.src_auth_events' does not exist", query_id=20240617_050058_00011_4aicc)
[0m13:55:14.181472 [debug] [Thread-1 (]: On test.my_dbt_trino_project.unique_src_auth_events_userId.9244f51c84: ROLLBACK
[0m13:55:14.181472 [debug] [Thread-1 (]: On test.my_dbt_trino_project.unique_src_auth_events_userId.9244f51c84: Close
[0m13:55:14.184479 [debug] [Thread-1 (]: Database Error in test unique_src_auth_events_userId (models\source\schema.yml)
  TrinoUserError(type=USER_ERROR, name=TABLE_NOT_FOUND, message="line 15:6: Table 'datalake.analytics_source.src_auth_events' does not exist", query_id=20240617_050058_00011_4aicc)
  compiled Code at target\run\my_dbt_trino_project\models\source\schema.yml\unique_src_auth_events_userId.sql
[0m13:55:14.184479 [error] [Thread-1 (]: 7 of 7 ERROR unique_src_auth_events_userId ..................................... [[31mERROR[0m in 0.04s]
[0m13:55:14.185475 [debug] [Thread-1 (]: Finished running node test.my_dbt_trino_project.unique_src_auth_events_userId.9244f51c84
[0m13:55:14.187719 [debug] [MainThread]: On master: COMMIT
[0m13:55:14.188752 [debug] [MainThread]: Connection 'master' was properly closed.
[0m13:55:14.189740 [debug] [MainThread]: Connection 'list_datalake_analytics' was properly closed.
[0m13:55:14.189740 [debug] [MainThread]: Connection 'test.my_dbt_trino_project.unique_src_auth_events_userId.9244f51c84' was properly closed.
[0m13:55:14.190741 [info ] [MainThread]: 
[0m13:55:14.190741 [info ] [MainThread]: Finished running 7 data tests in 0 hours 0 minutes and 2.54 seconds (2.54s).
[0m13:55:14.193368 [debug] [MainThread]: Command end result
[0m13:55:14.224995 [info ] [MainThread]: 
[0m13:55:14.226078 [info ] [MainThread]: [31mCompleted with 7 errors and 0 warnings:[0m
[0m13:55:14.227144 [info ] [MainThread]: 
[0m13:55:14.227692 [error] [MainThread]:   Database Error in test accepted_values_src_auth_events_gender__F__M (models\source\schema.yml)
  TrinoUserError(type=USER_ERROR, name=TABLE_NOT_FOUND, message="line 17:10: Table 'datalake.analytics_source.src_auth_events' does not exist", query_id=20240617_050058_00005_4aicc)
  compiled Code at target\run\my_dbt_trino_project\models\source\schema.yml\accepted_values_src_auth_events_gender__F__M.sql
[0m13:55:14.228219 [info ] [MainThread]: 
[0m13:55:14.228746 [error] [MainThread]:   Database Error in test accepted_values_src_auth_events_level__free__paid (models\source\schema.yml)
  TrinoUserError(type=USER_ERROR, name=TABLE_NOT_FOUND, message="line 17:10: Table 'datalake.analytics_source.src_auth_events' does not exist", query_id=20240617_050058_00006_4aicc)
  compiled Code at target\run\my_dbt_trino_project\models\source\schema.yml\accepted_values_src_auth_events_level__free__paid.sql
[0m13:55:14.229833 [info ] [MainThread]: 
[0m13:55:14.230363 [error] [MainThread]:   Database Error in test accepted_values_src_auth_events_success__True__False (models\source\schema.yml)
  TrinoUserError(type=USER_ERROR, name=TABLE_NOT_FOUND, message="line 17:10: Table 'datalake.analytics_source.src_auth_events' does not exist", query_id=20240617_050058_00007_4aicc)
  compiled Code at target\run\my_dbt_trino_project\models\source\schema.yml\accepted_values_src_auth_events_success__True__False.sql
[0m13:55:14.230894 [info ] [MainThread]: 
[0m13:55:14.231971 [error] [MainThread]:   Database Error in test not_null_src_auth_events_sessionId (models\source\schema.yml)
  TrinoUserError(type=USER_ERROR, name=TABLE_NOT_FOUND, message="line 14:6: Table 'datalake.analytics_source.src_auth_events' does not exist", query_id=20240617_050058_00008_4aicc)
  compiled Code at target\run\my_dbt_trino_project\models\source\schema.yml\not_null_src_auth_events_sessionId.sql
[0m13:55:14.233022 [info ] [MainThread]: 
[0m13:55:14.234078 [error] [MainThread]:   Database Error in test not_null_src_auth_events_ts (models\source\schema.yml)
  TrinoUserError(type=USER_ERROR, name=TABLE_NOT_FOUND, message="line 14:6: Table 'datalake.analytics_source.src_auth_events' does not exist", query_id=20240617_050058_00009_4aicc)
  compiled Code at target\run\my_dbt_trino_project\models\source\schema.yml\not_null_src_auth_events_ts.sql
[0m13:55:14.234602 [info ] [MainThread]: 
[0m13:55:14.235688 [error] [MainThread]:   Database Error in test unique_src_auth_events_sessionId (models\source\schema.yml)
  TrinoUserError(type=USER_ERROR, name=TABLE_NOT_FOUND, message="line 15:6: Table 'datalake.analytics_source.src_auth_events' does not exist", query_id=20240617_050058_00010_4aicc)
  compiled Code at target\run\my_dbt_trino_project\models\source\schema.yml\unique_src_auth_events_sessionId.sql
[0m13:55:14.236226 [info ] [MainThread]: 
[0m13:55:14.237292 [error] [MainThread]:   Database Error in test unique_src_auth_events_userId (models\source\schema.yml)
  TrinoUserError(type=USER_ERROR, name=TABLE_NOT_FOUND, message="line 15:6: Table 'datalake.analytics_source.src_auth_events' does not exist", query_id=20240617_050058_00011_4aicc)
  compiled Code at target\run\my_dbt_trino_project\models\source\schema.yml\unique_src_auth_events_userId.sql
[0m13:55:14.238545 [info ] [MainThread]: 
[0m13:55:14.239550 [info ] [MainThread]: Done. PASS=0 WARN=0 ERROR=7 SKIP=0 TOTAL=7
[0m13:55:14.240551 [debug] [MainThread]: Command `dbt test` failed at 13:55:14.240551 after 4.46 seconds
[0m13:55:14.241556 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x00000241A2413510>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x00000241A3C25D50>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x00000241A2413410>]}
[0m13:55:14.242556 [debug] [MainThread]: Flushing usage events
[0m15:57:06.525352 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000001B3D0694E90>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000001B3CDD785D0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000001B3D03C6810>]}


============================== 15:57:06.528353 | 47478481-c08d-45d3-a3b7-eb22c9745feb ==============================
[0m15:57:06.528353 [info ] [MainThread]: Running with dbt=1.8.2
[0m15:57:06.528353 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'indirect_selection': 'eager', 'write_json': 'True', 'log_cache_events': 'False', 'partial_parse': 'True', 'cache_selected_only': 'False', 'profiles_dir': 'C:\\Users\\ASUS\\Desktop\\work\\Iceberg-Dbt-Trino-Hive-modern-open-source-data-stack-main\\dbt', 'version_check': 'True', 'debug': 'False', 'log_path': 'C:\\Users\\ASUS\\Desktop\\work\\Iceberg-Dbt-Trino-Hive-modern-open-source-data-stack-main\\dbt\\logs', 'fail_fast': 'False', 'warn_error': 'None', 'use_colors': 'True', 'use_experimental_parser': 'False', 'no_print': 'None', 'quiet': 'False', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'introspect': 'True', 'log_format': 'default', 'invocation_command': 'dbt deps', 'target_path': 'None', 'static_parser': 'True', 'send_anonymous_usage_stats': 'True'}
[0m15:57:06.671809 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': '47478481-c08d-45d3-a3b7-eb22c9745feb', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000001B3D0739450>]}
[0m15:57:06.726572 [debug] [MainThread]: Set downloads directory='C:\Users\ASUS\AppData\Local\Temp\dbt-downloads-_fqs9y2n'
[0m15:57:06.726572 [debug] [MainThread]: Making package index registry request: GET https://hub.getdbt.com/api/v1/index.json
[0m15:57:08.145961 [debug] [MainThread]: Response from registry index: GET https://hub.getdbt.com/api/v1/index.json 200
[0m15:57:08.148042 [debug] [MainThread]: Making package registry request: GET https://hub.getdbt.com/api/v1/dbt-labs/dbt_utils.json
[0m15:57:09.510006 [debug] [MainThread]: Response from registry: GET https://hub.getdbt.com/api/v1/dbt-labs/dbt_utils.json 200
[0m15:57:09.514266 [debug] [MainThread]: Making package registry request: GET https://hub.getdbt.com/api/v1/starburstdata/trino_utils.json
[0m15:57:10.865532 [debug] [MainThread]: Response from registry: GET https://hub.getdbt.com/api/v1/starburstdata/trino_utils.json 200
[0m15:57:10.867546 [info ] [MainThread]: Installing dbt-labs/dbt_utils
[0m15:57:11.632581 [info ] [MainThread]: Installed from version 1.1.1
[0m15:57:11.633588 [info ] [MainThread]: Updated version available: 1.2.0
[0m15:57:11.633588 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'package', 'label': '47478481-c08d-45d3-a3b7-eb22c9745feb', 'property_': 'install', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000001B3CF488ED0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000001B3D072B790>]}
[0m15:57:11.634590 [info ] [MainThread]: Installing starburstdata/trino_utils
[0m15:57:12.199863 [info ] [MainThread]: Installed from version 0.6.0
[0m15:57:12.199863 [info ] [MainThread]: Up to date!
[0m15:57:12.200861 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'package', 'label': '47478481-c08d-45d3-a3b7-eb22c9745feb', 'property_': 'install', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000001B3D06FC550>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000001B3D086C550>]}
[0m15:57:12.201860 [info ] [MainThread]: 
[0m15:57:12.201860 [info ] [MainThread]: Updates available for packages: ['dbt-labs/dbt_utils']                 
Update your versions in packages.yml, then run dbt deps
[0m15:57:12.202860 [debug] [MainThread]: Command `dbt deps` succeeded at 15:57:12.202860 after 5.82 seconds
[0m15:57:12.203860 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000001B3CB9E49D0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000001B3D02A4050>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000001B3CB94E850>]}
[0m15:57:12.203860 [debug] [MainThread]: Flushing usage events
[0m15:57:28.282655 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000001E6D90E8590>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000001E6D90D67D0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000001E6D90D6B90>]}


============================== 15:57:28.284755 | 4ddd1e51-e4ad-4c9f-af4f-5c3da928d150 ==============================
[0m15:57:28.284755 [info ] [MainThread]: Running with dbt=1.8.2
[0m15:57:28.285754 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'indirect_selection': 'eager', 'write_json': 'True', 'log_cache_events': 'False', 'partial_parse': 'True', 'cache_selected_only': 'False', 'profiles_dir': 'C:\\Users\\ASUS\\Desktop\\work\\Iceberg-Dbt-Trino-Hive-modern-open-source-data-stack-main\\dbt', 'version_check': 'True', 'fail_fast': 'False', 'log_path': 'C:\\Users\\ASUS\\Desktop\\work\\Iceberg-Dbt-Trino-Hive-modern-open-source-data-stack-main\\dbt\\logs', 'debug': 'False', 'warn_error': 'None', 'use_colors': 'True', 'use_experimental_parser': 'False', 'no_print': 'None', 'quiet': 'False', 'log_format': 'default', 'introspect': 'True', 'static_parser': 'True', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'target_path': 'None', 'invocation_command': 'dbt run', 'send_anonymous_usage_stats': 'True'}
[0m15:57:28.592843 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': '4ddd1e51-e4ad-4c9f-af4f-5c3da928d150', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000001E6D953CED0>]}
[0m15:57:28.630357 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': '4ddd1e51-e4ad-4c9f-af4f-5c3da928d150', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000001E6D6269C90>]}
[0m15:57:28.631356 [info ] [MainThread]: Registered adapter: trino=1.8.0
[0m15:57:28.642358 [debug] [MainThread]: checksum: f0a141b9de567cb7f131613ba2682f40b3a1c6a157f81c6e5435862eff68f109, vars: {}, profile: , target: , version: 1.8.2
[0m15:57:28.813059 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 0 files changed.
[0m15:57:28.814059 [debug] [MainThread]: Partial parsing enabled, no changes found, skipping parsing
[0m15:57:28.843572 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': '4ddd1e51-e4ad-4c9f-af4f-5c3da928d150', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000001E6D9707450>]}
[0m15:57:28.915200 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': '4ddd1e51-e4ad-4c9f-af4f-5c3da928d150', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000001E6D9637F50>]}
[0m15:57:28.915731 [info ] [MainThread]: Found 15 models, 7 data tests, 3 sources, 559 macros
[0m15:57:28.916263 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '4ddd1e51-e4ad-4c9f-af4f-5c3da928d150', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000001E6D987DD90>]}
[0m15:57:28.917902 [info ] [MainThread]: 
[0m15:57:28.918428 [debug] [MainThread]: Acquiring new trino connection 'master'
[0m15:57:28.922668 [debug] [ThreadPool]: Acquiring new trino connection 'list_datalake'
[0m15:57:29.005936 [debug] [ThreadPool]: Using trino connection "list_datalake"
[0m15:57:29.006936 [debug] [ThreadPool]: On list_datalake: /* {"app": "dbt", "dbt_version": "1.8.2", "profile_name": "my_dbt_trino_project", "target_name": "dev", "connection_name": "list_datalake"} */

    select schema_name
    from "datalake".INFORMATION_SCHEMA.schemata
[0m15:57:29.006936 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m15:57:29.797540 [debug] [ThreadPool]: SQL status: SUCCESS in 1.0 seconds
[0m15:57:29.798541 [debug] [ThreadPool]: On list_datalake: Close
[0m15:57:29.803024 [debug] [ThreadPool]: Using trino connection "list_datalake"
[0m15:57:29.803024 [debug] [ThreadPool]: On list_datalake: /* {"app": "dbt", "dbt_version": "1.8.2", "profile_name": "my_dbt_trino_project", "target_name": "dev", "connection_name": "list_datalake"} */

    select schema_name
    from "datalake".INFORMATION_SCHEMA.schemata
[0m15:57:29.803024 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m15:57:29.873636 [debug] [ThreadPool]: SQL status: SUCCESS in 0.0 seconds
[0m15:57:29.874636 [debug] [ThreadPool]: On list_datalake: Close
[0m15:57:29.878758 [debug] [ThreadPool]: Using trino connection "list_datalake"
[0m15:57:29.878758 [debug] [ThreadPool]: On list_datalake: /* {"app": "dbt", "dbt_version": "1.8.2", "profile_name": "my_dbt_trino_project", "target_name": "dev", "connection_name": "list_datalake"} */

    select schema_name
    from "datalake".INFORMATION_SCHEMA.schemata
[0m15:57:29.879766 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m15:57:29.950503 [debug] [ThreadPool]: SQL status: SUCCESS in 0.0 seconds
[0m15:57:29.951012 [debug] [ThreadPool]: On list_datalake: Close
[0m15:57:29.953413 [debug] [ThreadPool]: Acquiring new trino connection 'list_datalake_analytics_stage'
[0m15:57:29.963403 [debug] [ThreadPool]: Using trino connection "list_datalake_analytics_stage"
[0m15:57:29.964401 [debug] [ThreadPool]: On list_datalake_analytics_stage: /* {"app": "dbt", "dbt_version": "1.8.2", "profile_name": "my_dbt_trino_project", "target_name": "dev", "connection_name": "list_datalake_analytics_stage"} */
select
      t.table_catalog as database,
      t.table_name as name,
      t.table_schema as schema,
      case when mv.name is not null then 'materialized_view'
           when t.table_type = 'BASE TABLE' then 'table'
           when t.table_type = 'VIEW' then 'view'
           else t.table_type
      end as table_type
    from "datalake".INFORMATION_SCHEMA.tables t
    left join (
            select * from system.metadata.materialized_views
            where catalog_name = 'datalake'
              and schema_name = 'analytics_stage') mv
          on mv.catalog_name = t.table_catalog and mv.schema_name = t.table_schema and mv.name = t.table_name
    where t.table_schema = 'analytics_stage'
[0m15:57:29.964401 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m15:57:30.471642 [debug] [ThreadPool]: SQL status: SUCCESS in 1.0 seconds
[0m15:57:30.472673 [debug] [ThreadPool]: On list_datalake_analytics_stage: ROLLBACK
[0m15:57:30.474179 [debug] [ThreadPool]: On list_datalake_analytics_stage: Close
[0m15:57:30.474179 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_datalake_analytics_stage, now list_datalake_analytics_source)
[0m15:57:30.477698 [debug] [ThreadPool]: Using trino connection "list_datalake_analytics_source"
[0m15:57:30.478698 [debug] [ThreadPool]: On list_datalake_analytics_source: /* {"app": "dbt", "dbt_version": "1.8.2", "profile_name": "my_dbt_trino_project", "target_name": "dev", "connection_name": "list_datalake_analytics_source"} */
select
      t.table_catalog as database,
      t.table_name as name,
      t.table_schema as schema,
      case when mv.name is not null then 'materialized_view'
           when t.table_type = 'BASE TABLE' then 'table'
           when t.table_type = 'VIEW' then 'view'
           else t.table_type
      end as table_type
    from "datalake".INFORMATION_SCHEMA.tables t
    left join (
            select * from system.metadata.materialized_views
            where catalog_name = 'datalake'
              and schema_name = 'analytics_source') mv
          on mv.catalog_name = t.table_catalog and mv.schema_name = t.table_schema and mv.name = t.table_name
    where t.table_schema = 'analytics_source'
[0m15:57:30.478698 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m15:57:30.671414 [debug] [ThreadPool]: SQL status: SUCCESS in 0.0 seconds
[0m15:57:30.672422 [debug] [ThreadPool]: On list_datalake_analytics_source: ROLLBACK
[0m15:57:30.672422 [debug] [ThreadPool]: On list_datalake_analytics_source: Close
[0m15:57:30.673437 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_datalake_analytics_source, now list_datalake_analytics)
[0m15:57:30.677458 [debug] [ThreadPool]: Using trino connection "list_datalake_analytics"
[0m15:57:30.677458 [debug] [ThreadPool]: On list_datalake_analytics: /* {"app": "dbt", "dbt_version": "1.8.2", "profile_name": "my_dbt_trino_project", "target_name": "dev", "connection_name": "list_datalake_analytics"} */
select
      t.table_catalog as database,
      t.table_name as name,
      t.table_schema as schema,
      case when mv.name is not null then 'materialized_view'
           when t.table_type = 'BASE TABLE' then 'table'
           when t.table_type = 'VIEW' then 'view'
           else t.table_type
      end as table_type
    from "datalake".INFORMATION_SCHEMA.tables t
    left join (
            select * from system.metadata.materialized_views
            where catalog_name = 'datalake'
              and schema_name = 'analytics') mv
          on mv.catalog_name = t.table_catalog and mv.schema_name = t.table_schema and mv.name = t.table_name
    where t.table_schema = 'analytics'
[0m15:57:30.677458 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m15:57:30.845451 [debug] [ThreadPool]: SQL status: SUCCESS in 0.0 seconds
[0m15:57:30.847458 [debug] [ThreadPool]: On list_datalake_analytics: ROLLBACK
[0m15:57:30.847458 [debug] [ThreadPool]: On list_datalake_analytics: Close
[0m15:57:30.848457 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '4ddd1e51-e4ad-4c9f-af4f-5c3da928d150', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000001E6D90E4110>]}
[0m15:57:30.849461 [debug] [MainThread]: On master: COMMIT
[0m15:57:30.850460 [info ] [MainThread]: Concurrency: 1 threads (target='dev')
[0m15:57:30.850967 [info ] [MainThread]: 
[0m15:57:30.853973 [debug] [Thread-1 (]: Began running node model.my_dbt_trino_project.src_auth_events
[0m15:57:30.855481 [info ] [Thread-1 (]: 1 of 15 START sql incremental model analytics_source.src_auth_events ........... [RUN]
[0m15:57:30.856486 [debug] [Thread-1 (]: Acquiring new trino connection 'model.my_dbt_trino_project.src_auth_events'
[0m15:57:30.856486 [debug] [Thread-1 (]: Began compiling node model.my_dbt_trino_project.src_auth_events
[0m15:57:30.868089 [debug] [Thread-1 (]: Writing injected SQL for node "model.my_dbt_trino_project.src_auth_events"
[0m15:57:30.869091 [debug] [Thread-1 (]: Began executing node model.my_dbt_trino_project.src_auth_events
[0m15:57:30.915992 [debug] [Thread-1 (]: Writing runtime sql for node "model.my_dbt_trino_project.src_auth_events"
[0m15:57:30.919500 [debug] [Thread-1 (]: Using trino connection "model.my_dbt_trino_project.src_auth_events"
[0m15:57:30.920500 [debug] [Thread-1 (]: On model.my_dbt_trino_project.src_auth_events: /* {"app": "dbt", "dbt_version": "1.8.2", "profile_name": "my_dbt_trino_project", "target_name": "dev", "node_id": "model.my_dbt_trino_project.src_auth_events"} */

  
    

    create table "datalake"."analytics_source"."src_auth_events"
      
      
    as (
      

with source as (
    select
        CAST(ts AS VARCHAR) as id, 
        ts,
        CAST(sessionId AS VARCHAR) as sessionId,
        level,
        itemInSession,
        city,
        zip,
        state,
        userAgent,
        CAST(NULLIF(lon, '') AS double) as lon,
        CAST(NULLIF(lat, '') AS double) as lat,
        CAST(FLOOR(CAST(NULLIF(userId, '') AS DOUBLE)) AS INT) as userId, 
        lastName,
        firstName,
        gender,
        CAST(FLOOR(CAST(NULLIF(registration, '') AS DOUBLE)) AS BIGINT) as registration,
        success
    from "oltp"."public"."auth_events"
)

select
    id,
    ts,
    sessionId,
    level,
    itemInSession,
    city,
    zip,
    state,
    userAgent,
    lon,
    lat,
    userId,
    lastName,
    firstName,
    gender,
    registration, 
    CASE 
        WHEN CAST(success AS VARCHAR) = 't' THEN true 
        WHEN CAST(success AS VARCHAR) = 'f' THEN false
        ELSE NULL 
    END AS success_boolean
from source


    )
[0m15:57:30.920500 [debug] [Thread-1 (]: Opening a new connection, currently in state init
[0m15:57:35.151567 [debug] [Thread-1 (]: SQL status: SUCCESS in 4.0 seconds
[0m15:57:35.157379 [debug] [Thread-1 (]: Applying DROP to: "datalake"."analytics_source"."src_auth_events__dbt_tmp"
[0m15:57:35.158972 [debug] [Thread-1 (]: Using trino connection "model.my_dbt_trino_project.src_auth_events"
[0m15:57:35.159507 [debug] [Thread-1 (]: On model.my_dbt_trino_project.src_auth_events: /* {"app": "dbt", "dbt_version": "1.8.2", "profile_name": "my_dbt_trino_project", "target_name": "dev", "node_id": "model.my_dbt_trino_project.src_auth_events"} */

    drop table if exists "datalake"."analytics_source"."src_auth_events__dbt_tmp"
[0m15:57:35.233909 [debug] [Thread-1 (]: SQL status: SUCCESS in 0.0 seconds
[0m15:57:35.244456 [debug] [Thread-1 (]: On model.my_dbt_trino_project.src_auth_events: ROLLBACK
[0m15:57:35.245974 [debug] [Thread-1 (]: On model.my_dbt_trino_project.src_auth_events: Close
[0m15:57:35.246981 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '4ddd1e51-e4ad-4c9f-af4f-5c3da928d150', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000001E6D9F5DFD0>]}
[0m15:57:35.247980 [info ] [Thread-1 (]: 1 of 15 OK created sql incremental model analytics_source.src_auth_events ...... [[32mSUCCESS[0m in 4.39s]
[0m15:57:35.248978 [debug] [Thread-1 (]: Finished running node model.my_dbt_trino_project.src_auth_events
[0m15:57:35.248978 [debug] [Thread-1 (]: Began running node model.my_dbt_trino_project.src_listen_events
[0m15:57:35.249978 [info ] [Thread-1 (]: 2 of 15 START sql incremental model analytics_source.src_listen_events ......... [RUN]
[0m15:57:35.249978 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.my_dbt_trino_project.src_auth_events, now model.my_dbt_trino_project.src_listen_events)
[0m15:57:35.251482 [debug] [Thread-1 (]: Began compiling node model.my_dbt_trino_project.src_listen_events
[0m15:57:35.254802 [debug] [Thread-1 (]: Writing injected SQL for node "model.my_dbt_trino_project.src_listen_events"
[0m15:57:35.255488 [debug] [Thread-1 (]: Began executing node model.my_dbt_trino_project.src_listen_events
[0m15:57:35.258487 [debug] [Thread-1 (]: Writing runtime sql for node "model.my_dbt_trino_project.src_listen_events"
[0m15:57:35.262050 [debug] [Thread-1 (]: Using trino connection "model.my_dbt_trino_project.src_listen_events"
[0m15:57:35.262050 [debug] [Thread-1 (]: On model.my_dbt_trino_project.src_listen_events: /* {"app": "dbt", "dbt_version": "1.8.2", "profile_name": "my_dbt_trino_project", "target_name": "dev", "node_id": "model.my_dbt_trino_project.src_listen_events"} */

  
    

    create table "datalake"."analytics_source"."src_listen_events"
      
      
    as (
      

with source as (

    select
        CAST(_id AS VARCHAR) as id,
        artist,
        song,
        CAST(NULLIF(duration, '') AS DOUBLE) as duration,
        ts,
        sessionid,
        auth,
        level,
        CAST(NULLIF(itemInSession, '') AS INTEGER) as itemInSession,
        city,
        zip,
        state,
        country,
        userAgent,
        CAST(NULLIF(lon, '') AS DOUBLE) as lon,
        CAST(NULLIF(lat, '') AS DOUBLE) as lat,
        CAST(CAST(NULLIF(userId, '') AS DOUBLE) AS INTEGER) as userId,
 -- Assurez-vous que userId peut aussi être converti de cette manière.
        lastName,
        firstName,
        gender,
        CAST(CAST(NULLIF(registration, '') AS DOUBLE) AS BIGINT) as registration
    from "website"."demo"."listen_events"

)

select * from source


    )
[0m15:57:35.262050 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m15:57:35.956726 [debug] [Thread-1 (]: SQL status: SUCCESS in 1.0 seconds
[0m15:57:35.961572 [debug] [Thread-1 (]: Applying DROP to: "datalake"."analytics_source"."src_listen_events__dbt_tmp"
[0m15:57:35.963140 [debug] [Thread-1 (]: Using trino connection "model.my_dbt_trino_project.src_listen_events"
[0m15:57:35.963671 [debug] [Thread-1 (]: On model.my_dbt_trino_project.src_listen_events: /* {"app": "dbt", "dbt_version": "1.8.2", "profile_name": "my_dbt_trino_project", "target_name": "dev", "node_id": "model.my_dbt_trino_project.src_listen_events"} */

    drop table if exists "datalake"."analytics_source"."src_listen_events__dbt_tmp"
[0m15:57:36.026751 [debug] [Thread-1 (]: SQL status: SUCCESS in 0.0 seconds
[0m15:57:36.028752 [debug] [Thread-1 (]: On model.my_dbt_trino_project.src_listen_events: ROLLBACK
[0m15:57:36.028752 [debug] [Thread-1 (]: On model.my_dbt_trino_project.src_listen_events: Close
[0m15:57:36.029750 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '4ddd1e51-e4ad-4c9f-af4f-5c3da928d150', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000001E6D9F8FCD0>]}
[0m15:57:36.030749 [info ] [Thread-1 (]: 2 of 15 OK created sql incremental model analytics_source.src_listen_events .... [[32mSUCCESS[0m in 0.78s]
[0m15:57:36.030749 [debug] [Thread-1 (]: Finished running node model.my_dbt_trino_project.src_listen_events
[0m15:57:36.030749 [debug] [Thread-1 (]: Began running node model.my_dbt_trino_project.src_page_view_events
[0m15:57:36.032257 [info ] [Thread-1 (]: 3 of 15 START sql incremental model analytics_source.src_page_view_events ...... [RUN]
[0m15:57:36.033265 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.my_dbt_trino_project.src_listen_events, now model.my_dbt_trino_project.src_page_view_events)
[0m15:57:36.033265 [debug] [Thread-1 (]: Began compiling node model.my_dbt_trino_project.src_page_view_events
[0m15:57:36.036266 [debug] [Thread-1 (]: Writing injected SQL for node "model.my_dbt_trino_project.src_page_view_events"
[0m15:57:36.037267 [debug] [Thread-1 (]: Began executing node model.my_dbt_trino_project.src_page_view_events
[0m15:57:36.042264 [debug] [Thread-1 (]: Writing runtime sql for node "model.my_dbt_trino_project.src_page_view_events"
[0m15:57:36.045264 [debug] [Thread-1 (]: Using trino connection "model.my_dbt_trino_project.src_page_view_events"
[0m15:57:36.046265 [debug] [Thread-1 (]: On model.my_dbt_trino_project.src_page_view_events: /* {"app": "dbt", "dbt_version": "1.8.2", "profile_name": "my_dbt_trino_project", "target_name": "dev", "node_id": "model.my_dbt_trino_project.src_page_view_events"} */

  
    

    create table "datalake"."analytics_source"."src_page_view_events"
      
      
    as (
      

with source as (
    select
        CAST(_id AS VARCHAR) as id,
        ts,
        CAST(sessionId AS VARCHAR) as sessionId,
        page,
        auth,
        level,
        CAST(CAST(NULLIF(itemInSession, '') AS DOUBLE) AS INTEGER) as itemInSession, 
        city,
        zip,
        state,
        userAgent,
        CAST(NULLIF(lon, '') AS double) as lon,
        CAST(NULLIF(lat, '') AS double) as lat,
        CAST(CAST(NULLIF(userId, '') AS DOUBLE) AS INTEGER) as userId, 
        lastName,
        firstName,
        gender,
        CAST(CAST(NULLIF(registration, '') AS DOUBLE) AS BIGINT) as registration, 
        artist,
        song,
        CAST(NULLIF(duration, '') AS double) as duration
    from "website"."demo"."page_view_events"
)

select * from source


    )
[0m15:57:36.046265 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m15:57:36.491508 [debug] [Thread-1 (]: SQL status: SUCCESS in 0.0 seconds
[0m15:57:36.494513 [debug] [Thread-1 (]: Applying DROP to: "datalake"."analytics_source"."src_page_view_events__dbt_tmp"
[0m15:57:36.495019 [debug] [Thread-1 (]: Using trino connection "model.my_dbt_trino_project.src_page_view_events"
[0m15:57:36.495019 [debug] [Thread-1 (]: On model.my_dbt_trino_project.src_page_view_events: /* {"app": "dbt", "dbt_version": "1.8.2", "profile_name": "my_dbt_trino_project", "target_name": "dev", "node_id": "model.my_dbt_trino_project.src_page_view_events"} */

    drop table if exists "datalake"."analytics_source"."src_page_view_events__dbt_tmp"
[0m15:57:36.559634 [debug] [Thread-1 (]: SQL status: SUCCESS in 0.0 seconds
[0m15:57:36.561145 [debug] [Thread-1 (]: On model.my_dbt_trino_project.src_page_view_events: ROLLBACK
[0m15:57:36.561145 [debug] [Thread-1 (]: On model.my_dbt_trino_project.src_page_view_events: Close
[0m15:57:36.562144 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '4ddd1e51-e4ad-4c9f-af4f-5c3da928d150', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000001E6D9FD8910>]}
[0m15:57:36.562144 [info ] [Thread-1 (]: 3 of 15 OK created sql incremental model analytics_source.src_page_view_events . [[32mSUCCESS[0m in 0.53s]
[0m15:57:36.563486 [debug] [Thread-1 (]: Finished running node model.my_dbt_trino_project.src_page_view_events
[0m15:57:36.564492 [debug] [Thread-1 (]: Began running node model.my_dbt_trino_project.stg_user_level_by_gender
[0m15:57:36.564492 [info ] [Thread-1 (]: 4 of 15 START sql view model analytics_stage.stg_user_level_by_gender .......... [RUN]
[0m15:57:36.565495 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.my_dbt_trino_project.src_page_view_events, now model.my_dbt_trino_project.stg_user_level_by_gender)
[0m15:57:36.566003 [debug] [Thread-1 (]: Began compiling node model.my_dbt_trino_project.stg_user_level_by_gender
[0m15:57:36.568524 [debug] [Thread-1 (]: Writing injected SQL for node "model.my_dbt_trino_project.stg_user_level_by_gender"
[0m15:57:36.569525 [debug] [Thread-1 (]: Began executing node model.my_dbt_trino_project.stg_user_level_by_gender
[0m15:57:36.584150 [debug] [Thread-1 (]: Writing runtime sql for node "model.my_dbt_trino_project.stg_user_level_by_gender"
[0m15:57:36.586151 [debug] [Thread-1 (]: Using trino connection "model.my_dbt_trino_project.stg_user_level_by_gender"
[0m15:57:36.586151 [debug] [Thread-1 (]: On model.my_dbt_trino_project.stg_user_level_by_gender: /* {"app": "dbt", "dbt_version": "1.8.2", "profile_name": "my_dbt_trino_project", "target_name": "dev", "node_id": "model.my_dbt_trino_project.stg_user_level_by_gender"} */

  create or replace view
    "datalake"."analytics_stage"."stg_user_level_by_gender"
  security definer
  as
    

WITH user_subscriptions AS (
    SELECT
        gender,
        level, 
        COUNT(DISTINCT userId) AS user_count
    FROM "datalake"."analytics_source"."src_auth_events"
    WHERE gender IS NOT NULL AND level IS NOT NULL
    GROUP BY gender, level
)

SELECT
    gender,
    level,
    user_count
FROM user_subscriptions
  
[0m15:57:36.587154 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m15:57:36.688213 [debug] [Thread-1 (]: SQL status: SUCCESS in 0.0 seconds
[0m15:57:36.689724 [debug] [Thread-1 (]: On model.my_dbt_trino_project.stg_user_level_by_gender: ROLLBACK
[0m15:57:36.689724 [debug] [Thread-1 (]: On model.my_dbt_trino_project.stg_user_level_by_gender: Close
[0m15:57:36.690724 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '4ddd1e51-e4ad-4c9f-af4f-5c3da928d150', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000001E6D9FCCC50>]}
[0m15:57:36.690724 [info ] [Thread-1 (]: 4 of 15 OK created sql view model analytics_stage.stg_user_level_by_gender ..... [[32mSUCCESS[0m in 0.13s]
[0m15:57:36.691725 [debug] [Thread-1 (]: Finished running node model.my_dbt_trino_project.stg_user_level_by_gender
[0m15:57:36.692725 [debug] [Thread-1 (]: Began running node model.my_dbt_trino_project.stg_streams_hourly
[0m15:57:36.693235 [info ] [Thread-1 (]: 5 of 15 START sql view model analytics_stage.stg_streams_hourly ................ [RUN]
[0m15:57:36.694241 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.my_dbt_trino_project.stg_user_level_by_gender, now model.my_dbt_trino_project.stg_streams_hourly)
[0m15:57:36.694241 [debug] [Thread-1 (]: Began compiling node model.my_dbt_trino_project.stg_streams_hourly
[0m15:57:36.697241 [debug] [Thread-1 (]: Writing injected SQL for node "model.my_dbt_trino_project.stg_streams_hourly"
[0m15:57:36.698243 [debug] [Thread-1 (]: Began executing node model.my_dbt_trino_project.stg_streams_hourly
[0m15:57:36.700241 [debug] [Thread-1 (]: Writing runtime sql for node "model.my_dbt_trino_project.stg_streams_hourly"
[0m15:57:36.701810 [debug] [Thread-1 (]: Using trino connection "model.my_dbt_trino_project.stg_streams_hourly"
[0m15:57:36.701810 [debug] [Thread-1 (]: On model.my_dbt_trino_project.stg_streams_hourly: /* {"app": "dbt", "dbt_version": "1.8.2", "profile_name": "my_dbt_trino_project", "target_name": "dev", "node_id": "model.my_dbt_trino_project.stg_streams_hourly"} */

  create or replace view
    "datalake"."analytics_stage"."stg_streams_hourly"
  security definer
  as
    

SELECT
    DATE_FORMAT(FROM_UNIXTIME(ts), '%Y-%m-%d') AS stream_date, 
    DATE_FORMAT(FROM_UNIXTIME(ts), '%H') AS stream_hour,
    COUNT(*) AS total_streams
FROM "datalake"."analytics_source"."src_listen_events"
GROUP BY
    DATE_FORMAT(FROM_UNIXTIME(ts), '%Y-%m-%d'),
    DATE_FORMAT(FROM_UNIXTIME(ts), '%H')
  
[0m15:57:36.702818 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m15:57:36.781173 [debug] [Thread-1 (]: SQL status: SUCCESS in 0.0 seconds
[0m15:57:36.783170 [debug] [Thread-1 (]: On model.my_dbt_trino_project.stg_streams_hourly: ROLLBACK
[0m15:57:36.783170 [debug] [Thread-1 (]: On model.my_dbt_trino_project.stg_streams_hourly: Close
[0m15:57:36.784172 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '4ddd1e51-e4ad-4c9f-af4f-5c3da928d150', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000001E6D9FA0E50>]}
[0m15:57:36.784172 [info ] [Thread-1 (]: 5 of 15 OK created sql view model analytics_stage.stg_streams_hourly ........... [[32mSUCCESS[0m in 0.09s]
[0m15:57:36.785354 [debug] [Thread-1 (]: Finished running node model.my_dbt_trino_project.stg_streams_hourly
[0m15:57:36.785858 [debug] [Thread-1 (]: Began running node model.my_dbt_trino_project.stg_top_songs_artists
[0m15:57:36.785858 [info ] [Thread-1 (]: 6 of 15 START sql view model analytics_stage.stg_top_songs_artists ............. [RUN]
[0m15:57:36.786863 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.my_dbt_trino_project.stg_streams_hourly, now model.my_dbt_trino_project.stg_top_songs_artists)
[0m15:57:36.786863 [debug] [Thread-1 (]: Began compiling node model.my_dbt_trino_project.stg_top_songs_artists
[0m15:57:36.789367 [debug] [Thread-1 (]: Writing injected SQL for node "model.my_dbt_trino_project.stg_top_songs_artists"
[0m15:57:36.790372 [debug] [Thread-1 (]: Began executing node model.my_dbt_trino_project.stg_top_songs_artists
[0m15:57:36.792371 [debug] [Thread-1 (]: Writing runtime sql for node "model.my_dbt_trino_project.stg_top_songs_artists"
[0m15:57:36.793374 [debug] [Thread-1 (]: Using trino connection "model.my_dbt_trino_project.stg_top_songs_artists"
[0m15:57:36.794371 [debug] [Thread-1 (]: On model.my_dbt_trino_project.stg_top_songs_artists: /* {"app": "dbt", "dbt_version": "1.8.2", "profile_name": "my_dbt_trino_project", "target_name": "dev", "node_id": "model.my_dbt_trino_project.stg_top_songs_artists"} */

  create or replace view
    "datalake"."analytics_stage"."stg_top_songs_artists"
  security definer
  as
    

WITH song_plays AS (
    SELECT
        artist,
        song,
        COUNT(*) AS play_count
    FROM "datalake"."analytics_source"."src_listen_events"
    GROUP BY artist, song
)

SELECT
    artist,
    song,
    play_count
FROM song_plays
ORDER BY play_count DESC
  
[0m15:57:36.794371 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m15:57:36.882351 [debug] [Thread-1 (]: SQL status: SUCCESS in 0.0 seconds
[0m15:57:36.884347 [debug] [Thread-1 (]: On model.my_dbt_trino_project.stg_top_songs_artists: ROLLBACK
[0m15:57:36.884347 [debug] [Thread-1 (]: On model.my_dbt_trino_project.stg_top_songs_artists: Close
[0m15:57:36.885348 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '4ddd1e51-e4ad-4c9f-af4f-5c3da928d150', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000001E6DB028D90>]}
[0m15:57:36.886350 [info ] [Thread-1 (]: 6 of 15 OK created sql view model analytics_stage.stg_top_songs_artists ........ [[32mSUCCESS[0m in 0.10s]
[0m15:57:36.886350 [debug] [Thread-1 (]: Finished running node model.my_dbt_trino_project.stg_top_songs_artists
[0m15:57:36.887347 [debug] [Thread-1 (]: Began running node model.my_dbt_trino_project.stg_unique_users
[0m15:57:36.887347 [info ] [Thread-1 (]: 7 of 15 START sql view model analytics_stage.stg_unique_users .................. [RUN]
[0m15:57:36.888346 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.my_dbt_trino_project.stg_top_songs_artists, now model.my_dbt_trino_project.stg_unique_users)
[0m15:57:36.888346 [debug] [Thread-1 (]: Began compiling node model.my_dbt_trino_project.stg_unique_users
[0m15:57:36.944315 [debug] [Thread-1 (]: Writing injected SQL for node "model.my_dbt_trino_project.stg_unique_users"
[0m15:57:36.944822 [debug] [Thread-1 (]: Began executing node model.my_dbt_trino_project.stg_unique_users
[0m15:57:36.947466 [debug] [Thread-1 (]: Writing runtime sql for node "model.my_dbt_trino_project.stg_unique_users"
[0m15:57:36.948523 [debug] [Thread-1 (]: Using trino connection "model.my_dbt_trino_project.stg_unique_users"
[0m15:57:36.949048 [debug] [Thread-1 (]: On model.my_dbt_trino_project.stg_unique_users: /* {"app": "dbt", "dbt_version": "1.8.2", "profile_name": "my_dbt_trino_project", "target_name": "dev", "node_id": "model.my_dbt_trino_project.stg_unique_users"} */

  create or replace view
    "datalake"."analytics_stage"."stg_unique_users"
  security definer
  as
    

SELECT
    COUNT(DISTINCT userid) AS total_unique_users
FROM "datalake"."analytics_source"."src_listen_events"
WHERE userid IS NOT NULL
  
[0m15:57:36.949574 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m15:57:37.033442 [debug] [Thread-1 (]: SQL status: SUCCESS in 0.0 seconds
[0m15:57:37.034447 [debug] [Thread-1 (]: On model.my_dbt_trino_project.stg_unique_users: ROLLBACK
[0m15:57:37.035447 [debug] [Thread-1 (]: On model.my_dbt_trino_project.stg_unique_users: Close
[0m15:57:37.035447 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '4ddd1e51-e4ad-4c9f-af4f-5c3da928d150', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000001E6DB024D10>]}
[0m15:57:37.036451 [info ] [Thread-1 (]: 7 of 15 OK created sql view model analytics_stage.stg_unique_users ............. [[32mSUCCESS[0m in 0.15s]
[0m15:57:37.037451 [debug] [Thread-1 (]: Finished running node model.my_dbt_trino_project.stg_unique_users
[0m15:57:37.037451 [debug] [Thread-1 (]: Began running node model.my_dbt_trino_project.stg_user_activity_per_country
[0m15:57:37.038447 [info ] [Thread-1 (]: 8 of 15 START sql view model analytics_stage.stg_user_activity_per_country ..... [RUN]
[0m15:57:37.038447 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.my_dbt_trino_project.stg_unique_users, now model.my_dbt_trino_project.stg_user_activity_per_country)
[0m15:57:37.039447 [debug] [Thread-1 (]: Began compiling node model.my_dbt_trino_project.stg_user_activity_per_country
[0m15:57:37.042448 [debug] [Thread-1 (]: Writing injected SQL for node "model.my_dbt_trino_project.stg_user_activity_per_country"
[0m15:57:37.042448 [debug] [Thread-1 (]: Began executing node model.my_dbt_trino_project.stg_user_activity_per_country
[0m15:57:37.045447 [debug] [Thread-1 (]: Writing runtime sql for node "model.my_dbt_trino_project.stg_user_activity_per_country"
[0m15:57:37.049454 [debug] [Thread-1 (]: Using trino connection "model.my_dbt_trino_project.stg_user_activity_per_country"
[0m15:57:37.049454 [debug] [Thread-1 (]: On model.my_dbt_trino_project.stg_user_activity_per_country: /* {"app": "dbt", "dbt_version": "1.8.2", "profile_name": "my_dbt_trino_project", "target_name": "dev", "node_id": "model.my_dbt_trino_project.stg_user_activity_per_country"} */

  create or replace view
    "datalake"."analytics_stage"."stg_user_activity_per_country"
  security definer
  as
    

WITH combined_activities AS (
  SELECT
    country,
    'listen_event' AS event_type,
    ts,
    userid
  FROM "datalake"."analytics_source"."src_listen_events"
  WHERE country IS NOT NULL
  UNION ALL
  SELECT
    'Unknown' AS country, 
    ts,
    userid
  FROM "datalake"."analytics_source"."src_auth_events"
  UNION ALL
  SELECT
    'Unknown' AS country, 
    'page_view_event' AS event_type,
    ts,
    userid
  FROM "datalake"."analytics_source"."src_page_view_events"
)

SELECT
  country,
  COUNT(*) AS activity_count
FROM combined_activities
GROUP BY country
  
[0m15:57:37.049454 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m15:57:37.133382 [debug] [Thread-1 (]: Trino adapter: Trino query id: 20240617_075737_00016_xsftb
[0m15:57:37.133382 [debug] [Thread-1 (]: Trino adapter: Trino error: TrinoUserError(type=USER_ERROR, name=TYPE_MISMATCH, message="line 17:3: UNION query has different number of fields: 4, 3", query_id=20240617_075737_00016_xsftb)
[0m15:57:37.134389 [debug] [Thread-1 (]: On model.my_dbt_trino_project.stg_user_activity_per_country: ROLLBACK
[0m15:57:37.135391 [debug] [Thread-1 (]: On model.my_dbt_trino_project.stg_user_activity_per_country: Close
[0m15:57:37.139905 [debug] [Thread-1 (]: Database Error in model stg_user_activity_per_country (models\stage\stg_user_activity_per_country.sql)
  TrinoUserError(type=USER_ERROR, name=TYPE_MISMATCH, message="line 17:3: UNION query has different number of fields: 4, 3", query_id=20240617_075737_00016_xsftb)
  compiled Code at target\run\my_dbt_trino_project\models\stage\stg_user_activity_per_country.sql
[0m15:57:37.139905 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '4ddd1e51-e4ad-4c9f-af4f-5c3da928d150', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000001E6D91785D0>]}
[0m15:57:37.140903 [error] [Thread-1 (]: 8 of 15 ERROR creating sql view model analytics_stage.stg_user_activity_per_country  [[31mERROR[0m in 0.10s]
[0m15:57:37.142103 [debug] [Thread-1 (]: Finished running node model.my_dbt_trino_project.stg_user_activity_per_country
[0m15:57:37.142103 [debug] [Thread-1 (]: Began running node model.my_dbt_trino_project.stg_user_activity_per_location
[0m15:57:37.143103 [info ] [Thread-1 (]: 9 of 15 START sql view model analytics_stage.stg_user_activity_per_location .... [RUN]
[0m15:57:37.143103 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.my_dbt_trino_project.stg_user_activity_per_country, now model.my_dbt_trino_project.stg_user_activity_per_location)
[0m15:57:37.144100 [debug] [Thread-1 (]: Began compiling node model.my_dbt_trino_project.stg_user_activity_per_location
[0m15:57:37.147100 [debug] [Thread-1 (]: Writing injected SQL for node "model.my_dbt_trino_project.stg_user_activity_per_location"
[0m15:57:37.148104 [debug] [Thread-1 (]: Began executing node model.my_dbt_trino_project.stg_user_activity_per_location
[0m15:57:37.150611 [debug] [Thread-1 (]: Writing runtime sql for node "model.my_dbt_trino_project.stg_user_activity_per_location"
[0m15:57:37.152611 [debug] [Thread-1 (]: Using trino connection "model.my_dbt_trino_project.stg_user_activity_per_location"
[0m15:57:37.152611 [debug] [Thread-1 (]: On model.my_dbt_trino_project.stg_user_activity_per_location: /* {"app": "dbt", "dbt_version": "1.8.2", "profile_name": "my_dbt_trino_project", "target_name": "dev", "node_id": "model.my_dbt_trino_project.stg_user_activity_per_location"} */

  create or replace view
    "datalake"."analytics_stage"."stg_user_activity_per_location"
  security definer
  as
    

WITH combined_activities AS (
  SELECT
    city,
    state,
    'auth_event' AS event_type,
    ts,
    userid
 FROM "datalake"."analytics_source"."src_auth_events"
  UNION ALL
  SELECT
    city,
    state,
    'listen_event' AS event_type,
    ts,
    userid
  FROM "datalake"."analytics_source"."src_listen_events"
  UNION ALL
  SELECT
    city,
    state,
    'page_view_event' AS event_type,
    ts,
    userid
  FROM "datalake"."analytics_source"."src_page_view_events"
)

SELECT
  state,
  city,
  COUNT(*) AS activity_count
FROM combined_activities
GROUP BY state, city
  
[0m15:57:37.153617 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m15:57:37.257580 [debug] [Thread-1 (]: SQL status: SUCCESS in 0.0 seconds
[0m15:57:37.259587 [debug] [Thread-1 (]: On model.my_dbt_trino_project.stg_user_activity_per_location: ROLLBACK
[0m15:57:37.259587 [debug] [Thread-1 (]: On model.my_dbt_trino_project.stg_user_activity_per_location: Close
[0m15:57:37.260585 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '4ddd1e51-e4ad-4c9f-af4f-5c3da928d150', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000001E6D91784D0>]}
[0m15:57:37.261588 [info ] [Thread-1 (]: 9 of 15 OK created sql view model analytics_stage.stg_user_activity_per_location  [[32mSUCCESS[0m in 0.12s]
[0m15:57:37.262586 [debug] [Thread-1 (]: Finished running node model.my_dbt_trino_project.stg_user_activity_per_location
[0m15:57:37.262586 [debug] [Thread-1 (]: Began running node model.my_dbt_trino_project.mart_user_level_by_gender
[0m15:57:37.263587 [info ] [Thread-1 (]: 10 of 15 START sql table model analytics.mart_user_level_by_gender ............. [RUN]
[0m15:57:37.263587 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.my_dbt_trino_project.stg_user_activity_per_location, now model.my_dbt_trino_project.mart_user_level_by_gender)
[0m15:57:37.264592 [debug] [Thread-1 (]: Began compiling node model.my_dbt_trino_project.mart_user_level_by_gender
[0m15:57:37.267590 [debug] [Thread-1 (]: Writing injected SQL for node "model.my_dbt_trino_project.mart_user_level_by_gender"
[0m15:57:37.267590 [debug] [Thread-1 (]: Began executing node model.my_dbt_trino_project.mart_user_level_by_gender
[0m15:57:37.280788 [debug] [Thread-1 (]: Writing runtime sql for node "model.my_dbt_trino_project.mart_user_level_by_gender"
[0m15:57:37.284405 [debug] [Thread-1 (]: Using trino connection "model.my_dbt_trino_project.mart_user_level_by_gender"
[0m15:57:37.284405 [debug] [Thread-1 (]: On model.my_dbt_trino_project.mart_user_level_by_gender: /* {"app": "dbt", "dbt_version": "1.8.2", "profile_name": "my_dbt_trino_project", "target_name": "dev", "node_id": "model.my_dbt_trino_project.mart_user_level_by_gender"} */

  
    

    create table "datalake"."analytics"."mart_user_level_by_gender__dbt_tmp"
      
      
    as (
      

SELECT
    gender,
    level,
    SUM(user_count) AS total_users,
    ROUND(SUM(user_count) * 100.0 / SUM(SUM(user_count)) OVER (), 2) AS percentage_of_total_users
FROM "datalake"."analytics_stage"."stg_user_level_by_gender"
GROUP BY gender, level
    )
[0m15:57:37.285404 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m15:57:38.099336 [debug] [Thread-1 (]: SQL status: SUCCESS in 1.0 seconds
[0m15:57:38.107927 [debug] [Thread-1 (]: Using trino connection "model.my_dbt_trino_project.mart_user_level_by_gender"
[0m15:57:38.108927 [debug] [Thread-1 (]: On model.my_dbt_trino_project.mart_user_level_by_gender: /* {"app": "dbt", "dbt_version": "1.8.2", "profile_name": "my_dbt_trino_project", "target_name": "dev", "node_id": "model.my_dbt_trino_project.mart_user_level_by_gender"} */
alter table "datalake"."analytics"."mart_user_level_by_gender__dbt_tmp" rename to "datalake"."analytics"."mart_user_level_by_gender"
[0m15:57:38.220034 [debug] [Thread-1 (]: SQL status: SUCCESS in 0.0 seconds
[0m15:57:38.224035 [debug] [Thread-1 (]: Applying DROP to: "datalake"."analytics"."mart_user_level_by_gender__dbt_backup"
[0m15:57:38.225033 [debug] [Thread-1 (]: Using trino connection "model.my_dbt_trino_project.mart_user_level_by_gender"
[0m15:57:38.225033 [debug] [Thread-1 (]: On model.my_dbt_trino_project.mart_user_level_by_gender: /* {"app": "dbt", "dbt_version": "1.8.2", "profile_name": "my_dbt_trino_project", "target_name": "dev", "node_id": "model.my_dbt_trino_project.mart_user_level_by_gender"} */

    drop table if exists "datalake"."analytics"."mart_user_level_by_gender__dbt_backup"
[0m15:57:38.301926 [debug] [Thread-1 (]: SQL status: SUCCESS in 0.0 seconds
[0m15:57:38.303438 [debug] [Thread-1 (]: On model.my_dbt_trino_project.mart_user_level_by_gender: ROLLBACK
[0m15:57:38.303438 [debug] [Thread-1 (]: On model.my_dbt_trino_project.mart_user_level_by_gender: Close
[0m15:57:38.304436 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '4ddd1e51-e4ad-4c9f-af4f-5c3da928d150', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000001E6D9B17790>]}
[0m15:57:38.305438 [info ] [Thread-1 (]: 10 of 15 OK created sql table model analytics.mart_user_level_by_gender ........ [[32mSUCCESS[0m in 1.04s]
[0m15:57:38.305438 [debug] [Thread-1 (]: Finished running node model.my_dbt_trino_project.mart_user_level_by_gender
[0m15:57:38.306435 [debug] [Thread-1 (]: Began running node model.my_dbt_trino_project.mart_hourly_stream_evolution
[0m15:57:38.306435 [info ] [Thread-1 (]: 11 of 15 START sql table model analytics.mart_hourly_stream_evolution .......... [RUN]
[0m15:57:38.307434 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.my_dbt_trino_project.mart_user_level_by_gender, now model.my_dbt_trino_project.mart_hourly_stream_evolution)
[0m15:57:38.307434 [debug] [Thread-1 (]: Began compiling node model.my_dbt_trino_project.mart_hourly_stream_evolution
[0m15:57:38.310435 [debug] [Thread-1 (]: Writing injected SQL for node "model.my_dbt_trino_project.mart_hourly_stream_evolution"
[0m15:57:38.310435 [debug] [Thread-1 (]: Began executing node model.my_dbt_trino_project.mart_hourly_stream_evolution
[0m15:57:38.313436 [debug] [Thread-1 (]: Writing runtime sql for node "model.my_dbt_trino_project.mart_hourly_stream_evolution"
[0m15:57:38.315436 [debug] [Thread-1 (]: Using trino connection "model.my_dbt_trino_project.mart_hourly_stream_evolution"
[0m15:57:38.316479 [debug] [Thread-1 (]: On model.my_dbt_trino_project.mart_hourly_stream_evolution: /* {"app": "dbt", "dbt_version": "1.8.2", "profile_name": "my_dbt_trino_project", "target_name": "dev", "node_id": "model.my_dbt_trino_project.mart_hourly_stream_evolution"} */

  
    

    create table "datalake"."analytics"."mart_hourly_stream_evolution__dbt_tmp"
      
      
    as (
      

SELECT
    stream_date,
    stream_hour,
    total_streams,
    SUM(total_streams) OVER (PARTITION BY stream_date ORDER BY stream_hour) AS cumulative_streams
FROM "datalake"."analytics_stage"."stg_streams_hourly"
ORDER BY
    stream_date,
    stream_hour
    )
[0m15:57:38.317452 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m15:57:38.863567 [debug] [Thread-1 (]: SQL status: SUCCESS in 1.0 seconds
[0m15:57:38.866565 [debug] [Thread-1 (]: Using trino connection "model.my_dbt_trino_project.mart_hourly_stream_evolution"
[0m15:57:38.866565 [debug] [Thread-1 (]: On model.my_dbt_trino_project.mart_hourly_stream_evolution: /* {"app": "dbt", "dbt_version": "1.8.2", "profile_name": "my_dbt_trino_project", "target_name": "dev", "node_id": "model.my_dbt_trino_project.mart_hourly_stream_evolution"} */
alter table "datalake"."analytics"."mart_hourly_stream_evolution__dbt_tmp" rename to "datalake"."analytics"."mart_hourly_stream_evolution"
[0m15:57:38.969406 [debug] [Thread-1 (]: SQL status: SUCCESS in 0.0 seconds
[0m15:57:38.973444 [debug] [Thread-1 (]: Applying DROP to: "datalake"."analytics"."mart_hourly_stream_evolution__dbt_backup"
[0m15:57:38.974408 [debug] [Thread-1 (]: Using trino connection "model.my_dbt_trino_project.mart_hourly_stream_evolution"
[0m15:57:38.974408 [debug] [Thread-1 (]: On model.my_dbt_trino_project.mart_hourly_stream_evolution: /* {"app": "dbt", "dbt_version": "1.8.2", "profile_name": "my_dbt_trino_project", "target_name": "dev", "node_id": "model.my_dbt_trino_project.mart_hourly_stream_evolution"} */

    drop table if exists "datalake"."analytics"."mart_hourly_stream_evolution__dbt_backup"
[0m15:57:39.036468 [debug] [Thread-1 (]: SQL status: SUCCESS in 0.0 seconds
[0m15:57:39.037977 [debug] [Thread-1 (]: On model.my_dbt_trino_project.mart_hourly_stream_evolution: ROLLBACK
[0m15:57:39.038984 [debug] [Thread-1 (]: On model.my_dbt_trino_project.mart_hourly_stream_evolution: Close
[0m15:57:39.038984 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '4ddd1e51-e4ad-4c9f-af4f-5c3da928d150', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000001E6D9B11C10>]}
[0m15:57:39.039986 [info ] [Thread-1 (]: 11 of 15 OK created sql table model analytics.mart_hourly_stream_evolution ..... [[32mSUCCESS[0m in 0.73s]
[0m15:57:39.041492 [debug] [Thread-1 (]: Finished running node model.my_dbt_trino_project.mart_hourly_stream_evolution
[0m15:57:39.041492 [debug] [Thread-1 (]: Began running node model.my_dbt_trino_project.mart_top_songs_artists
[0m15:57:39.042500 [info ] [Thread-1 (]: 12 of 15 START sql table model analytics.mart_top_songs_artists ................ [RUN]
[0m15:57:39.042500 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.my_dbt_trino_project.mart_hourly_stream_evolution, now model.my_dbt_trino_project.mart_top_songs_artists)
[0m15:57:39.043500 [debug] [Thread-1 (]: Began compiling node model.my_dbt_trino_project.mart_top_songs_artists
[0m15:57:39.046497 [debug] [Thread-1 (]: Writing injected SQL for node "model.my_dbt_trino_project.mart_top_songs_artists"
[0m15:57:39.046497 [debug] [Thread-1 (]: Began executing node model.my_dbt_trino_project.mart_top_songs_artists
[0m15:57:39.049497 [debug] [Thread-1 (]: Writing runtime sql for node "model.my_dbt_trino_project.mart_top_songs_artists"
[0m15:57:39.050500 [debug] [Thread-1 (]: Using trino connection "model.my_dbt_trino_project.mart_top_songs_artists"
[0m15:57:39.051498 [debug] [Thread-1 (]: On model.my_dbt_trino_project.mart_top_songs_artists: /* {"app": "dbt", "dbt_version": "1.8.2", "profile_name": "my_dbt_trino_project", "target_name": "dev", "node_id": "model.my_dbt_trino_project.mart_top_songs_artists"} */

  
    

    create table "datalake"."analytics"."mart_top_songs_artists__dbt_tmp"
      
      
    as (
      

WITH top_songs AS (
    SELECT
        artist,
        song,
        play_count
    FROM "datalake"."analytics_stage"."stg_top_songs_artists"
)

SELECT
    artist,
    song,
    play_count
FROM top_songs
    )
[0m15:57:39.051498 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m15:57:39.414143 [debug] [Thread-1 (]: SQL status: SUCCESS in 0.0 seconds
[0m15:57:39.417154 [debug] [Thread-1 (]: Using trino connection "model.my_dbt_trino_project.mart_top_songs_artists"
[0m15:57:39.417154 [debug] [Thread-1 (]: On model.my_dbt_trino_project.mart_top_songs_artists: /* {"app": "dbt", "dbt_version": "1.8.2", "profile_name": "my_dbt_trino_project", "target_name": "dev", "node_id": "model.my_dbt_trino_project.mart_top_songs_artists"} */
alter table "datalake"."analytics"."mart_top_songs_artists__dbt_tmp" rename to "datalake"."analytics"."mart_top_songs_artists"
[0m15:57:39.525280 [debug] [Thread-1 (]: SQL status: SUCCESS in 0.0 seconds
[0m15:57:39.529805 [debug] [Thread-1 (]: Applying DROP to: "datalake"."analytics"."mart_top_songs_artists__dbt_backup"
[0m15:57:39.530805 [debug] [Thread-1 (]: Using trino connection "model.my_dbt_trino_project.mart_top_songs_artists"
[0m15:57:39.530805 [debug] [Thread-1 (]: On model.my_dbt_trino_project.mart_top_songs_artists: /* {"app": "dbt", "dbt_version": "1.8.2", "profile_name": "my_dbt_trino_project", "target_name": "dev", "node_id": "model.my_dbt_trino_project.mart_top_songs_artists"} */

    drop table if exists "datalake"."analytics"."mart_top_songs_artists__dbt_backup"
[0m15:57:39.597224 [debug] [Thread-1 (]: SQL status: SUCCESS in 0.0 seconds
[0m15:57:39.598235 [debug] [Thread-1 (]: On model.my_dbt_trino_project.mart_top_songs_artists: ROLLBACK
[0m15:57:39.599224 [debug] [Thread-1 (]: On model.my_dbt_trino_project.mart_top_songs_artists: Close
[0m15:57:39.599224 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '4ddd1e51-e4ad-4c9f-af4f-5c3da928d150', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000001E6D9110750>]}
[0m15:57:39.600226 [info ] [Thread-1 (]: 12 of 15 OK created sql table model analytics.mart_top_songs_artists ........... [[32mSUCCESS[0m in 0.56s]
[0m15:57:39.601297 [debug] [Thread-1 (]: Finished running node model.my_dbt_trino_project.mart_top_songs_artists
[0m15:57:39.601297 [debug] [Thread-1 (]: Began running node model.my_dbt_trino_project.mart_total_unique_users
[0m15:57:39.602223 [info ] [Thread-1 (]: 13 of 15 START sql table model analytics.mart_total_unique_users ............... [RUN]
[0m15:57:39.603226 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.my_dbt_trino_project.mart_top_songs_artists, now model.my_dbt_trino_project.mart_total_unique_users)
[0m15:57:39.603226 [debug] [Thread-1 (]: Began compiling node model.my_dbt_trino_project.mart_total_unique_users
[0m15:57:39.605795 [debug] [Thread-1 (]: Writing injected SQL for node "model.my_dbt_trino_project.mart_total_unique_users"
[0m15:57:39.606795 [debug] [Thread-1 (]: Began executing node model.my_dbt_trino_project.mart_total_unique_users
[0m15:57:39.608793 [debug] [Thread-1 (]: Writing runtime sql for node "model.my_dbt_trino_project.mart_total_unique_users"
[0m15:57:39.610506 [debug] [Thread-1 (]: Using trino connection "model.my_dbt_trino_project.mart_total_unique_users"
[0m15:57:39.611305 [debug] [Thread-1 (]: On model.my_dbt_trino_project.mart_total_unique_users: /* {"app": "dbt", "dbt_version": "1.8.2", "profile_name": "my_dbt_trino_project", "target_name": "dev", "node_id": "model.my_dbt_trino_project.mart_total_unique_users"} */

  
    

    create table "datalake"."analytics"."mart_total_unique_users__dbt_tmp"
      
      
    as (
      

SELECT
    total_unique_users
FROM "datalake"."analytics_stage"."stg_unique_users"
    )
[0m15:57:39.611305 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m15:57:39.997644 [debug] [Thread-1 (]: SQL status: SUCCESS in 0.0 seconds
[0m15:57:40.000646 [debug] [Thread-1 (]: Using trino connection "model.my_dbt_trino_project.mart_total_unique_users"
[0m15:57:40.000646 [debug] [Thread-1 (]: On model.my_dbt_trino_project.mart_total_unique_users: /* {"app": "dbt", "dbt_version": "1.8.2", "profile_name": "my_dbt_trino_project", "target_name": "dev", "node_id": "model.my_dbt_trino_project.mart_total_unique_users"} */
alter table "datalake"."analytics"."mart_total_unique_users__dbt_tmp" rename to "datalake"."analytics"."mart_total_unique_users"
[0m15:57:40.106702 [debug] [Thread-1 (]: SQL status: SUCCESS in 0.0 seconds
[0m15:57:40.109216 [debug] [Thread-1 (]: Applying DROP to: "datalake"."analytics"."mart_total_unique_users__dbt_backup"
[0m15:57:40.110212 [debug] [Thread-1 (]: Using trino connection "model.my_dbt_trino_project.mart_total_unique_users"
[0m15:57:40.110212 [debug] [Thread-1 (]: On model.my_dbt_trino_project.mart_total_unique_users: /* {"app": "dbt", "dbt_version": "1.8.2", "profile_name": "my_dbt_trino_project", "target_name": "dev", "node_id": "model.my_dbt_trino_project.mart_total_unique_users"} */

    drop table if exists "datalake"."analytics"."mart_total_unique_users__dbt_backup"
[0m15:57:40.165342 [debug] [Thread-1 (]: SQL status: SUCCESS in 0.0 seconds
[0m15:57:40.167341 [debug] [Thread-1 (]: On model.my_dbt_trino_project.mart_total_unique_users: ROLLBACK
[0m15:57:40.167341 [debug] [Thread-1 (]: On model.my_dbt_trino_project.mart_total_unique_users: Close
[0m15:57:40.168339 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '4ddd1e51-e4ad-4c9f-af4f-5c3da928d150', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000001E6D9B46AD0>]}
[0m15:57:40.168339 [info ] [Thread-1 (]: 13 of 15 OK created sql table model analytics.mart_total_unique_users .......... [[32mSUCCESS[0m in 0.57s]
[0m15:57:40.169847 [debug] [Thread-1 (]: Finished running node model.my_dbt_trino_project.mart_total_unique_users
[0m15:57:40.169847 [debug] [Thread-1 (]: Began running node model.my_dbt_trino_project.mart_user_activity_per_country
[0m15:57:40.169847 [info ] [Thread-1 (]: 14 of 15 SKIP relation analytics.mart_user_activity_per_country ................ [[33mSKIP[0m]
[0m15:57:40.170858 [debug] [Thread-1 (]: Finished running node model.my_dbt_trino_project.mart_user_activity_per_country
[0m15:57:40.171856 [debug] [Thread-1 (]: Began running node model.my_dbt_trino_project.mart_user_activity_per_state
[0m15:57:40.171856 [info ] [Thread-1 (]: 15 of 15 START sql table model analytics.mart_user_activity_per_state .......... [RUN]
[0m15:57:40.172855 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.my_dbt_trino_project.mart_total_unique_users, now model.my_dbt_trino_project.mart_user_activity_per_state)
[0m15:57:40.172855 [debug] [Thread-1 (]: Began compiling node model.my_dbt_trino_project.mart_user_activity_per_state
[0m15:57:40.175855 [debug] [Thread-1 (]: Writing injected SQL for node "model.my_dbt_trino_project.mart_user_activity_per_state"
[0m15:57:40.175855 [debug] [Thread-1 (]: Began executing node model.my_dbt_trino_project.mart_user_activity_per_state
[0m15:57:40.178856 [debug] [Thread-1 (]: Writing runtime sql for node "model.my_dbt_trino_project.mart_user_activity_per_state"
[0m15:57:40.180853 [debug] [Thread-1 (]: Using trino connection "model.my_dbt_trino_project.mart_user_activity_per_state"
[0m15:57:40.180853 [debug] [Thread-1 (]: On model.my_dbt_trino_project.mart_user_activity_per_state: /* {"app": "dbt", "dbt_version": "1.8.2", "profile_name": "my_dbt_trino_project", "target_name": "dev", "node_id": "model.my_dbt_trino_project.mart_user_activity_per_state"} */

  
    

    create table "datalake"."analytics"."mart_user_activity_per_state__dbt_tmp"
      
      
    as (
      

SELECT
  state,
  city,
  SUM(activity_count) AS total_activity
FROM "datalake"."analytics_stage"."stg_user_activity_per_location"
GROUP BY state, city
ORDER BY state, SUM(activity_count) DESC
    )
[0m15:57:40.181854 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m15:57:40.587258 [debug] [Thread-1 (]: SQL status: SUCCESS in 0.0 seconds
[0m15:57:40.590764 [debug] [Thread-1 (]: Using trino connection "model.my_dbt_trino_project.mart_user_activity_per_state"
[0m15:57:40.590764 [debug] [Thread-1 (]: On model.my_dbt_trino_project.mart_user_activity_per_state: /* {"app": "dbt", "dbt_version": "1.8.2", "profile_name": "my_dbt_trino_project", "target_name": "dev", "node_id": "model.my_dbt_trino_project.mart_user_activity_per_state"} */
alter table "datalake"."analytics"."mart_user_activity_per_state__dbt_tmp" rename to "datalake"."analytics"."mart_user_activity_per_state"
[0m15:57:40.695547 [debug] [Thread-1 (]: SQL status: SUCCESS in 0.0 seconds
[0m15:57:40.698067 [debug] [Thread-1 (]: Applying DROP to: "datalake"."analytics"."mart_user_activity_per_state__dbt_backup"
[0m15:57:40.699067 [debug] [Thread-1 (]: Using trino connection "model.my_dbt_trino_project.mart_user_activity_per_state"
[0m15:57:40.699067 [debug] [Thread-1 (]: On model.my_dbt_trino_project.mart_user_activity_per_state: /* {"app": "dbt", "dbt_version": "1.8.2", "profile_name": "my_dbt_trino_project", "target_name": "dev", "node_id": "model.my_dbt_trino_project.mart_user_activity_per_state"} */

    drop table if exists "datalake"."analytics"."mart_user_activity_per_state__dbt_backup"
[0m15:57:40.755695 [debug] [Thread-1 (]: SQL status: SUCCESS in 0.0 seconds
[0m15:57:40.757708 [debug] [Thread-1 (]: On model.my_dbt_trino_project.mart_user_activity_per_state: ROLLBACK
[0m15:57:40.757708 [debug] [Thread-1 (]: On model.my_dbt_trino_project.mart_user_activity_per_state: Close
[0m15:57:40.758711 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '4ddd1e51-e4ad-4c9f-af4f-5c3da928d150', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000001E6D9B17790>]}
[0m15:57:40.758711 [info ] [Thread-1 (]: 15 of 15 OK created sql table model analytics.mart_user_activity_per_state ..... [[32mSUCCESS[0m in 0.59s]
[0m15:57:40.760000 [debug] [Thread-1 (]: Finished running node model.my_dbt_trino_project.mart_user_activity_per_state
[0m15:57:40.761506 [debug] [MainThread]: On master: COMMIT
[0m15:57:40.762030 [debug] [MainThread]: Connection 'master' was properly closed.
[0m15:57:40.762569 [debug] [MainThread]: Connection 'list_datalake' was properly closed.
[0m15:57:40.762569 [debug] [MainThread]: Connection 'list_datalake_analytics' was properly closed.
[0m15:57:40.763101 [debug] [MainThread]: Connection 'model.my_dbt_trino_project.mart_user_activity_per_state' was properly closed.
[0m15:57:40.763634 [info ] [MainThread]: 
[0m15:57:40.764142 [info ] [MainThread]: Finished running 3 incremental models, 6 view models, 6 table models in 0 hours 0 minutes and 11.84 seconds (11.84s).
[0m15:57:40.765718 [debug] [MainThread]: Command end result
[0m15:57:40.801606 [info ] [MainThread]: 
[0m15:57:40.802610 [info ] [MainThread]: [31mCompleted with 1 error and 0 warnings:[0m
[0m15:57:40.803611 [info ] [MainThread]: 
[0m15:57:40.803611 [error] [MainThread]:   Database Error in model stg_user_activity_per_country (models\stage\stg_user_activity_per_country.sql)
  TrinoUserError(type=USER_ERROR, name=TYPE_MISMATCH, message="line 17:3: UNION query has different number of fields: 4, 3", query_id=20240617_075737_00016_xsftb)
  compiled Code at target\run\my_dbt_trino_project\models\stage\stg_user_activity_per_country.sql
[0m15:57:40.804608 [info ] [MainThread]: 
[0m15:57:40.805610 [info ] [MainThread]: Done. PASS=13 WARN=0 ERROR=1 SKIP=1 TOTAL=15
[0m15:57:40.806606 [debug] [MainThread]: Command `dbt run` failed at 15:57:40.806606 after 12.67 seconds
[0m15:57:40.806606 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000001E6D41BF590>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000001E6D41BF910>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000001E6D41BF490>]}
[0m15:57:40.807608 [debug] [MainThread]: Flushing usage events
[0m16:02:54.594368 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x0000026C69805CD0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x0000026C6980BC50>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x0000026C69848A10>]}


============================== 16:02:54.594368 | 536373b5-260c-4091-abc1-9dc095bf72ea ==============================
[0m16:02:54.594368 [info ] [MainThread]: Running with dbt=1.8.2
[0m16:02:54.594368 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'indirect_selection': 'eager', 'write_json': 'True', 'log_cache_events': 'False', 'partial_parse': 'True', 'cache_selected_only': 'False', 'warn_error': 'None', 'version_check': 'True', 'fail_fast': 'False', 'log_path': 'C:\\Users\\ASUS\\Desktop\\work\\Iceberg-Dbt-Trino-Hive-modern-open-source-data-stack-main\\dbt\\logs', 'profiles_dir': 'C:\\Users\\ASUS\\Desktop\\work\\Iceberg-Dbt-Trino-Hive-modern-open-source-data-stack-main\\dbt', 'debug': 'False', 'use_colors': 'True', 'use_experimental_parser': 'False', 'no_print': 'None', 'quiet': 'False', 'log_format': 'default', 'invocation_command': 'dbt run', 'introspect': 'True', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'target_path': 'None', 'static_parser': 'True', 'send_anonymous_usage_stats': 'True'}
[0m16:02:54.907735 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': '536373b5-260c-4091-abc1-9dc095bf72ea', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x0000026C69C03D90>]}
[0m16:02:54.948018 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': '536373b5-260c-4091-abc1-9dc095bf72ea', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x0000026C66985610>]}
[0m16:02:54.948018 [info ] [MainThread]: Registered adapter: trino=1.8.0
[0m16:02:54.961953 [debug] [MainThread]: checksum: f0a141b9de567cb7f131613ba2682f40b3a1c6a157f81c6e5435862eff68f109, vars: {}, profile: , target: , version: 1.8.2
[0m16:02:55.142874 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 0 files changed.
[0m16:02:55.142874 [debug] [MainThread]: Partial parsing enabled, no changes found, skipping parsing
[0m16:02:55.181040 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': '536373b5-260c-4091-abc1-9dc095bf72ea', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x0000026C69EA2D50>]}
[0m16:02:55.266125 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': '536373b5-260c-4091-abc1-9dc095bf72ea', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x0000026C69D57D50>]}
[0m16:02:55.266678 [info ] [MainThread]: Found 15 models, 7 data tests, 3 sources, 559 macros
[0m16:02:55.267728 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '536373b5-260c-4091-abc1-9dc095bf72ea', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x0000026C69870B10>]}
[0m16:02:55.269297 [info ] [MainThread]: 
[0m16:02:55.270349 [debug] [MainThread]: Acquiring new trino connection 'master'
[0m16:02:55.276176 [debug] [ThreadPool]: Acquiring new trino connection 'list_datalake'
[0m16:02:55.337389 [debug] [ThreadPool]: Using trino connection "list_datalake"
[0m16:02:55.337913 [debug] [ThreadPool]: On list_datalake: /* {"app": "dbt", "dbt_version": "1.8.2", "profile_name": "my_dbt_trino_project", "target_name": "dev", "connection_name": "list_datalake"} */

    select schema_name
    from "datalake".INFORMATION_SCHEMA.schemata
[0m16:02:55.338440 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m16:02:55.388381 [debug] [ThreadPool]: SQL status: SUCCESS in 0.0 seconds
[0m16:02:55.388381 [debug] [ThreadPool]: On list_datalake: Close
[0m16:02:55.395041 [debug] [ThreadPool]: Using trino connection "list_datalake"
[0m16:02:55.395041 [debug] [ThreadPool]: On list_datalake: /* {"app": "dbt", "dbt_version": "1.8.2", "profile_name": "my_dbt_trino_project", "target_name": "dev", "connection_name": "list_datalake"} */

    select schema_name
    from "datalake".INFORMATION_SCHEMA.schemata
[0m16:02:55.395041 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m16:02:55.440404 [debug] [ThreadPool]: SQL status: SUCCESS in 0.0 seconds
[0m16:02:55.441459 [debug] [ThreadPool]: On list_datalake: Close
[0m16:02:55.444690 [debug] [ThreadPool]: Using trino connection "list_datalake"
[0m16:02:55.444690 [debug] [ThreadPool]: On list_datalake: /* {"app": "dbt", "dbt_version": "1.8.2", "profile_name": "my_dbt_trino_project", "target_name": "dev", "connection_name": "list_datalake"} */

    select schema_name
    from "datalake".INFORMATION_SCHEMA.schemata
[0m16:02:55.445217 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m16:02:55.477825 [debug] [ThreadPool]: SQL status: SUCCESS in 0.0 seconds
[0m16:02:55.480284 [debug] [ThreadPool]: On list_datalake: Close
[0m16:02:55.482934 [debug] [ThreadPool]: Acquiring new trino connection 'list_datalake_analytics'
[0m16:02:55.495024 [debug] [ThreadPool]: Using trino connection "list_datalake_analytics"
[0m16:02:55.495541 [debug] [ThreadPool]: On list_datalake_analytics: /* {"app": "dbt", "dbt_version": "1.8.2", "profile_name": "my_dbt_trino_project", "target_name": "dev", "connection_name": "list_datalake_analytics"} */
select
      t.table_catalog as database,
      t.table_name as name,
      t.table_schema as schema,
      case when mv.name is not null then 'materialized_view'
           when t.table_type = 'BASE TABLE' then 'table'
           when t.table_type = 'VIEW' then 'view'
           else t.table_type
      end as table_type
    from "datalake".INFORMATION_SCHEMA.tables t
    left join (
            select * from system.metadata.materialized_views
            where catalog_name = 'datalake'
              and schema_name = 'analytics') mv
          on mv.catalog_name = t.table_catalog and mv.schema_name = t.table_schema and mv.name = t.table_name
    where t.table_schema = 'analytics'
[0m16:02:55.495541 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m16:02:55.628215 [debug] [ThreadPool]: SQL status: SUCCESS in 0.0 seconds
[0m16:02:55.630261 [debug] [ThreadPool]: On list_datalake_analytics: ROLLBACK
[0m16:02:55.630261 [debug] [ThreadPool]: On list_datalake_analytics: Close
[0m16:02:55.631849 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_datalake_analytics, now list_datalake_analytics_source)
[0m16:02:55.637610 [debug] [ThreadPool]: Using trino connection "list_datalake_analytics_source"
[0m16:02:55.637610 [debug] [ThreadPool]: On list_datalake_analytics_source: /* {"app": "dbt", "dbt_version": "1.8.2", "profile_name": "my_dbt_trino_project", "target_name": "dev", "connection_name": "list_datalake_analytics_source"} */
select
      t.table_catalog as database,
      t.table_name as name,
      t.table_schema as schema,
      case when mv.name is not null then 'materialized_view'
           when t.table_type = 'BASE TABLE' then 'table'
           when t.table_type = 'VIEW' then 'view'
           else t.table_type
      end as table_type
    from "datalake".INFORMATION_SCHEMA.tables t
    left join (
            select * from system.metadata.materialized_views
            where catalog_name = 'datalake'
              and schema_name = 'analytics_source') mv
          on mv.catalog_name = t.table_catalog and mv.schema_name = t.table_schema and mv.name = t.table_name
    where t.table_schema = 'analytics_source'
[0m16:02:55.637610 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m16:02:55.722983 [debug] [ThreadPool]: SQL status: SUCCESS in 0.0 seconds
[0m16:02:55.727005 [debug] [ThreadPool]: On list_datalake_analytics_source: ROLLBACK
[0m16:02:55.727005 [debug] [ThreadPool]: On list_datalake_analytics_source: Close
[0m16:02:55.727005 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_datalake_analytics_source, now list_datalake_analytics_stage)
[0m16:02:55.729540 [debug] [ThreadPool]: Using trino connection "list_datalake_analytics_stage"
[0m16:02:55.729540 [debug] [ThreadPool]: On list_datalake_analytics_stage: /* {"app": "dbt", "dbt_version": "1.8.2", "profile_name": "my_dbt_trino_project", "target_name": "dev", "connection_name": "list_datalake_analytics_stage"} */
select
      t.table_catalog as database,
      t.table_name as name,
      t.table_schema as schema,
      case when mv.name is not null then 'materialized_view'
           when t.table_type = 'BASE TABLE' then 'table'
           when t.table_type = 'VIEW' then 'view'
           else t.table_type
      end as table_type
    from "datalake".INFORMATION_SCHEMA.tables t
    left join (
            select * from system.metadata.materialized_views
            where catalog_name = 'datalake'
              and schema_name = 'analytics_stage') mv
          on mv.catalog_name = t.table_catalog and mv.schema_name = t.table_schema and mv.name = t.table_name
    where t.table_schema = 'analytics_stage'
[0m16:02:55.729540 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m16:02:55.823107 [debug] [ThreadPool]: SQL status: SUCCESS in 0.0 seconds
[0m16:02:55.824354 [debug] [ThreadPool]: On list_datalake_analytics_stage: ROLLBACK
[0m16:02:55.825184 [debug] [ThreadPool]: On list_datalake_analytics_stage: Close
[0m16:02:55.826198 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '536373b5-260c-4091-abc1-9dc095bf72ea', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x0000026C6B215990>]}
[0m16:02:55.826198 [debug] [MainThread]: On master: COMMIT
[0m16:02:55.826198 [info ] [MainThread]: Concurrency: 1 threads (target='dev')
[0m16:02:55.826198 [info ] [MainThread]: 
[0m16:02:55.826198 [debug] [Thread-1 (]: Began running node model.my_dbt_trino_project.src_auth_events
[0m16:02:55.826198 [info ] [Thread-1 (]: 1 of 15 START sql incremental model analytics_source.src_auth_events ........... [RUN]
[0m16:02:55.832713 [debug] [Thread-1 (]: Acquiring new trino connection 'model.my_dbt_trino_project.src_auth_events'
[0m16:02:55.832713 [debug] [Thread-1 (]: Began compiling node model.my_dbt_trino_project.src_auth_events
[0m16:02:55.843959 [debug] [Thread-1 (]: Writing injected SQL for node "model.my_dbt_trino_project.src_auth_events"
[0m16:02:55.843959 [debug] [Thread-1 (]: Began executing node model.my_dbt_trino_project.src_auth_events
[0m16:02:55.895460 [debug] [Thread-1 (]: Using trino connection "model.my_dbt_trino_project.src_auth_events"
[0m16:02:55.895460 [debug] [Thread-1 (]: On model.my_dbt_trino_project.src_auth_events: /* {"app": "dbt", "dbt_version": "1.8.2", "profile_name": "my_dbt_trino_project", "target_name": "dev", "node_id": "model.my_dbt_trino_project.src_auth_events"} */

  
    

    create table "datalake"."analytics_source"."src_auth_events__dbt_tmp"
      
      
    as (
      

with source as (
    select
        CAST(ts AS VARCHAR) as id, 
        ts,
        CAST(sessionId AS VARCHAR) as sessionId,
        level,
        itemInSession,
        city,
        zip,
        state,
        userAgent,
        CAST(NULLIF(lon, '') AS double) as lon,
        CAST(NULLIF(lat, '') AS double) as lat,
        CAST(FLOOR(CAST(NULLIF(userId, '') AS DOUBLE)) AS INT) as userId, 
        lastName,
        firstName,
        gender,
        CAST(FLOOR(CAST(NULLIF(registration, '') AS DOUBLE)) AS BIGINT) as registration,
        success
    from "oltp"."public"."auth_events"
)

select
    id,
    ts,
    sessionId,
    level,
    itemInSession,
    city,
    zip,
    state,
    userAgent,
    lon,
    lat,
    userId,
    lastName,
    firstName,
    gender,
    registration, 
    CASE 
        WHEN CAST(success AS VARCHAR) = 't' THEN true 
        WHEN CAST(success AS VARCHAR) = 'f' THEN false
        ELSE NULL 
    END AS success_boolean
from source


    where ts > (select max(ts) from "datalake"."analytics_source"."src_auth_events")

    )
[0m16:02:55.898617 [debug] [Thread-1 (]: Opening a new connection, currently in state init
[0m16:02:56.487987 [debug] [Thread-1 (]: SQL status: SUCCESS in 1.0 seconds
[0m16:02:56.499753 [debug] [Thread-1 (]: Using trino connection "model.my_dbt_trino_project.src_auth_events"
[0m16:02:56.500268 [debug] [Thread-1 (]: On model.my_dbt_trino_project.src_auth_events: /* {"app": "dbt", "dbt_version": "1.8.2", "profile_name": "my_dbt_trino_project", "target_name": "dev", "node_id": "model.my_dbt_trino_project.src_auth_events"} */

    describe "datalake"."analytics_source"."src_auth_events__dbt_tmp"
[0m16:02:56.667683 [debug] [Thread-1 (]: SQL status: SUCCESS in 0.0 seconds
[0m16:02:56.672724 [debug] [Thread-1 (]: Using trino connection "model.my_dbt_trino_project.src_auth_events"
[0m16:02:56.672724 [debug] [Thread-1 (]: On model.my_dbt_trino_project.src_auth_events: /* {"app": "dbt", "dbt_version": "1.8.2", "profile_name": "my_dbt_trino_project", "target_name": "dev", "node_id": "model.my_dbt_trino_project.src_auth_events"} */

    describe "datalake"."analytics_source"."src_auth_events"
[0m16:02:56.795812 [debug] [Thread-1 (]: SQL status: SUCCESS in 0.0 seconds
[0m16:02:56.805085 [debug] [Thread-1 (]: Using trino connection "model.my_dbt_trino_project.src_auth_events"
[0m16:02:56.805605 [debug] [Thread-1 (]: On model.my_dbt_trino_project.src_auth_events: /* {"app": "dbt", "dbt_version": "1.8.2", "profile_name": "my_dbt_trino_project", "target_name": "dev", "node_id": "model.my_dbt_trino_project.src_auth_events"} */

    describe "datalake"."analytics_source"."src_auth_events"
[0m16:02:56.931369 [debug] [Thread-1 (]: SQL status: SUCCESS in 0.0 seconds
[0m16:02:56.946807 [debug] [Thread-1 (]: Writing runtime sql for node "model.my_dbt_trino_project.src_auth_events"
[0m16:02:56.948910 [debug] [Thread-1 (]: Using trino connection "model.my_dbt_trino_project.src_auth_events"
[0m16:02:56.948910 [debug] [Thread-1 (]: On model.my_dbt_trino_project.src_auth_events: /* {"app": "dbt", "dbt_version": "1.8.2", "profile_name": "my_dbt_trino_project", "target_name": "dev", "node_id": "model.my_dbt_trino_project.src_auth_events"} */
insert into "datalake"."analytics_source"."src_auth_events" ("id", "ts", "sessionid", "level", "iteminsession", "city", "zip", "state", "useragent", "lon", "lat", "userid", "lastname", "firstname", "gender", "registration", "success_boolean")
    (
        select "id", "ts", "sessionid", "level", "iteminsession", "city", "zip", "state", "useragent", "lon", "lat", "userid", "lastname", "firstname", "gender", "registration", "success_boolean"
        from "datalake"."analytics_source"."src_auth_events__dbt_tmp"
    )
[0m16:02:57.143330 [debug] [Thread-1 (]: SQL status: SUCCESS in 0.0 seconds
[0m16:02:57.148618 [debug] [Thread-1 (]: Applying DROP to: "datalake"."analytics_source"."src_auth_events__dbt_tmp"
[0m16:02:57.150716 [debug] [Thread-1 (]: Using trino connection "model.my_dbt_trino_project.src_auth_events"
[0m16:02:57.151738 [debug] [Thread-1 (]: On model.my_dbt_trino_project.src_auth_events: /* {"app": "dbt", "dbt_version": "1.8.2", "profile_name": "my_dbt_trino_project", "target_name": "dev", "node_id": "model.my_dbt_trino_project.src_auth_events"} */

    drop table if exists "datalake"."analytics_source"."src_auth_events__dbt_tmp"
[0m16:02:57.361435 [debug] [Thread-1 (]: SQL status: SUCCESS in 0.0 seconds
[0m16:02:57.374237 [debug] [Thread-1 (]: On model.my_dbt_trino_project.src_auth_events: ROLLBACK
[0m16:02:57.374237 [debug] [Thread-1 (]: On model.my_dbt_trino_project.src_auth_events: Close
[0m16:02:57.374237 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '536373b5-260c-4091-abc1-9dc095bf72ea', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x0000026C69E76F10>]}
[0m16:02:57.374237 [info ] [Thread-1 (]: 1 of 15 OK created sql incremental model analytics_source.src_auth_events ...... [[32mSUCCESS[0m in 1.54s]
[0m16:02:57.374237 [debug] [Thread-1 (]: Finished running node model.my_dbt_trino_project.src_auth_events
[0m16:02:57.374237 [debug] [Thread-1 (]: Began running node model.my_dbt_trino_project.src_listen_events
[0m16:02:57.374237 [info ] [Thread-1 (]: 2 of 15 START sql incremental model analytics_source.src_listen_events ......... [RUN]
[0m16:02:57.374237 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.my_dbt_trino_project.src_auth_events, now model.my_dbt_trino_project.src_listen_events)
[0m16:02:57.374237 [debug] [Thread-1 (]: Began compiling node model.my_dbt_trino_project.src_listen_events
[0m16:02:57.383473 [debug] [Thread-1 (]: Writing injected SQL for node "model.my_dbt_trino_project.src_listen_events"
[0m16:02:57.384561 [debug] [Thread-1 (]: Began executing node model.my_dbt_trino_project.src_listen_events
[0m16:02:57.390907 [debug] [Thread-1 (]: Using trino connection "model.my_dbt_trino_project.src_listen_events"
[0m16:02:57.390907 [debug] [Thread-1 (]: On model.my_dbt_trino_project.src_listen_events: /* {"app": "dbt", "dbt_version": "1.8.2", "profile_name": "my_dbt_trino_project", "target_name": "dev", "node_id": "model.my_dbt_trino_project.src_listen_events"} */

  
    

    create table "datalake"."analytics_source"."src_listen_events__dbt_tmp"
      
      
    as (
      

with source as (

    select
        CAST(_id AS VARCHAR) as id,
        artist,
        song,
        CAST(NULLIF(duration, '') AS DOUBLE) as duration,
        ts,
        sessionid,
        auth,
        level,
        CAST(NULLIF(itemInSession, '') AS INTEGER) as itemInSession,
        city,
        zip,
        state,
        country,
        userAgent,
        CAST(NULLIF(lon, '') AS DOUBLE) as lon,
        CAST(NULLIF(lat, '') AS DOUBLE) as lat,
        CAST(CAST(NULLIF(userId, '') AS DOUBLE) AS INTEGER) as userId,
 -- Assurez-vous que userId peut aussi être converti de cette manière.
        lastName,
        firstName,
        gender,
        CAST(CAST(NULLIF(registration, '') AS DOUBLE) AS BIGINT) as registration
    from "website"."demo"."listen_events"

)

select * from source



    -- this filter will only be applied on an incremental run
    where ts > (select max(ts) from "datalake"."analytics_source"."src_listen_events")


    )
[0m16:02:57.390907 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m16:02:57.674476 [debug] [Thread-1 (]: SQL status: SUCCESS in 0.0 seconds
[0m16:02:57.674476 [debug] [Thread-1 (]: Using trino connection "model.my_dbt_trino_project.src_listen_events"
[0m16:02:57.677485 [debug] [Thread-1 (]: On model.my_dbt_trino_project.src_listen_events: /* {"app": "dbt", "dbt_version": "1.8.2", "profile_name": "my_dbt_trino_project", "target_name": "dev", "node_id": "model.my_dbt_trino_project.src_listen_events"} */

    describe "datalake"."analytics_source"."src_listen_events__dbt_tmp"
[0m16:02:57.793625 [debug] [Thread-1 (]: SQL status: SUCCESS in 0.0 seconds
[0m16:02:57.797255 [debug] [Thread-1 (]: Using trino connection "model.my_dbt_trino_project.src_listen_events"
[0m16:02:57.797775 [debug] [Thread-1 (]: On model.my_dbt_trino_project.src_listen_events: /* {"app": "dbt", "dbt_version": "1.8.2", "profile_name": "my_dbt_trino_project", "target_name": "dev", "node_id": "model.my_dbt_trino_project.src_listen_events"} */

    describe "datalake"."analytics_source"."src_listen_events"
[0m16:02:57.929298 [debug] [Thread-1 (]: SQL status: SUCCESS in 0.0 seconds
[0m16:02:57.936849 [debug] [Thread-1 (]: Using trino connection "model.my_dbt_trino_project.src_listen_events"
[0m16:02:57.936849 [debug] [Thread-1 (]: On model.my_dbt_trino_project.src_listen_events: /* {"app": "dbt", "dbt_version": "1.8.2", "profile_name": "my_dbt_trino_project", "target_name": "dev", "node_id": "model.my_dbt_trino_project.src_listen_events"} */

    describe "datalake"."analytics_source"."src_listen_events"
[0m16:02:58.054024 [debug] [Thread-1 (]: SQL status: SUCCESS in 0.0 seconds
[0m16:02:58.057569 [debug] [Thread-1 (]: Writing runtime sql for node "model.my_dbt_trino_project.src_listen_events"
[0m16:02:58.057569 [debug] [Thread-1 (]: Using trino connection "model.my_dbt_trino_project.src_listen_events"
[0m16:02:58.061087 [debug] [Thread-1 (]: On model.my_dbt_trino_project.src_listen_events: /* {"app": "dbt", "dbt_version": "1.8.2", "profile_name": "my_dbt_trino_project", "target_name": "dev", "node_id": "model.my_dbt_trino_project.src_listen_events"} */
insert into "datalake"."analytics_source"."src_listen_events" ("id", "artist", "song", "duration", "ts", "sessionid", "auth", "level", "iteminsession", "city", "zip", "state", "country", "useragent", "lon", "lat", "userid", "lastname", "firstname", "gender", "registration")
    (
        select "id", "artist", "song", "duration", "ts", "sessionid", "auth", "level", "iteminsession", "city", "zip", "state", "country", "useragent", "lon", "lat", "userid", "lastname", "firstname", "gender", "registration"
        from "datalake"."analytics_source"."src_listen_events__dbt_tmp"
    )
[0m16:02:58.227812 [debug] [Thread-1 (]: SQL status: SUCCESS in 0.0 seconds
[0m16:02:58.227812 [debug] [Thread-1 (]: Applying DROP to: "datalake"."analytics_source"."src_listen_events__dbt_tmp"
[0m16:02:58.227812 [debug] [Thread-1 (]: Using trino connection "model.my_dbt_trino_project.src_listen_events"
[0m16:02:58.227812 [debug] [Thread-1 (]: On model.my_dbt_trino_project.src_listen_events: /* {"app": "dbt", "dbt_version": "1.8.2", "profile_name": "my_dbt_trino_project", "target_name": "dev", "node_id": "model.my_dbt_trino_project.src_listen_events"} */

    drop table if exists "datalake"."analytics_source"."src_listen_events__dbt_tmp"
[0m16:02:58.356876 [debug] [Thread-1 (]: SQL status: SUCCESS in 0.0 seconds
[0m16:02:58.356876 [debug] [Thread-1 (]: On model.my_dbt_trino_project.src_listen_events: ROLLBACK
[0m16:02:58.356876 [debug] [Thread-1 (]: On model.my_dbt_trino_project.src_listen_events: Close
[0m16:02:58.361971 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '536373b5-260c-4091-abc1-9dc095bf72ea', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x0000026C69E5F910>]}
[0m16:02:58.361971 [info ] [Thread-1 (]: 2 of 15 OK created sql incremental model analytics_source.src_listen_events .... [[32mSUCCESS[0m in 0.99s]
[0m16:02:58.361971 [debug] [Thread-1 (]: Finished running node model.my_dbt_trino_project.src_listen_events
[0m16:02:58.361971 [debug] [Thread-1 (]: Began running node model.my_dbt_trino_project.src_page_view_events
[0m16:02:58.361971 [info ] [Thread-1 (]: 3 of 15 START sql incremental model analytics_source.src_page_view_events ...... [RUN]
[0m16:02:58.361971 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.my_dbt_trino_project.src_listen_events, now model.my_dbt_trino_project.src_page_view_events)
[0m16:02:58.361971 [debug] [Thread-1 (]: Began compiling node model.my_dbt_trino_project.src_page_view_events
[0m16:02:58.361971 [debug] [Thread-1 (]: Writing injected SQL for node "model.my_dbt_trino_project.src_page_view_events"
[0m16:02:58.361971 [debug] [Thread-1 (]: Began executing node model.my_dbt_trino_project.src_page_view_events
[0m16:02:58.370484 [debug] [Thread-1 (]: Using trino connection "model.my_dbt_trino_project.src_page_view_events"
[0m16:02:58.370484 [debug] [Thread-1 (]: On model.my_dbt_trino_project.src_page_view_events: /* {"app": "dbt", "dbt_version": "1.8.2", "profile_name": "my_dbt_trino_project", "target_name": "dev", "node_id": "model.my_dbt_trino_project.src_page_view_events"} */

  
    

    create table "datalake"."analytics_source"."src_page_view_events__dbt_tmp"
      
      
    as (
      

with source as (
    select
        CAST(_id AS VARCHAR) as id,
        ts,
        CAST(sessionId AS VARCHAR) as sessionId,
        page,
        auth,
        level,
        CAST(CAST(NULLIF(itemInSession, '') AS DOUBLE) AS INTEGER) as itemInSession, 
        city,
        zip,
        state,
        userAgent,
        CAST(NULLIF(lon, '') AS double) as lon,
        CAST(NULLIF(lat, '') AS double) as lat,
        CAST(CAST(NULLIF(userId, '') AS DOUBLE) AS INTEGER) as userId, 
        lastName,
        firstName,
        gender,
        CAST(CAST(NULLIF(registration, '') AS DOUBLE) AS BIGINT) as registration, 
        artist,
        song,
        CAST(NULLIF(duration, '') AS double) as duration
    from "website"."demo"."page_view_events"
)

select * from source


    where ts > (select max(ts) from "datalake"."analytics_source"."src_page_view_events")

    )
[0m16:02:58.370484 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m16:02:58.597264 [debug] [Thread-1 (]: SQL status: SUCCESS in 0.0 seconds
[0m16:02:58.603299 [debug] [Thread-1 (]: Using trino connection "model.my_dbt_trino_project.src_page_view_events"
[0m16:02:58.604320 [debug] [Thread-1 (]: On model.my_dbt_trino_project.src_page_view_events: /* {"app": "dbt", "dbt_version": "1.8.2", "profile_name": "my_dbt_trino_project", "target_name": "dev", "node_id": "model.my_dbt_trino_project.src_page_view_events"} */

    describe "datalake"."analytics_source"."src_page_view_events__dbt_tmp"
[0m16:02:58.720169 [debug] [Thread-1 (]: SQL status: SUCCESS in 0.0 seconds
[0m16:02:58.769540 [debug] [Thread-1 (]: Using trino connection "model.my_dbt_trino_project.src_page_view_events"
[0m16:02:58.772973 [debug] [Thread-1 (]: On model.my_dbt_trino_project.src_page_view_events: /* {"app": "dbt", "dbt_version": "1.8.2", "profile_name": "my_dbt_trino_project", "target_name": "dev", "node_id": "model.my_dbt_trino_project.src_page_view_events"} */

    describe "datalake"."analytics_source"."src_page_view_events"
[0m16:02:58.896792 [debug] [Thread-1 (]: SQL status: SUCCESS in 0.0 seconds
[0m16:02:58.899353 [debug] [Thread-1 (]: Using trino connection "model.my_dbt_trino_project.src_page_view_events"
[0m16:02:58.899353 [debug] [Thread-1 (]: On model.my_dbt_trino_project.src_page_view_events: /* {"app": "dbt", "dbt_version": "1.8.2", "profile_name": "my_dbt_trino_project", "target_name": "dev", "node_id": "model.my_dbt_trino_project.src_page_view_events"} */

    describe "datalake"."analytics_source"."src_page_view_events"
[0m16:02:59.016426 [debug] [Thread-1 (]: SQL status: SUCCESS in 0.0 seconds
[0m16:02:59.019599 [debug] [Thread-1 (]: Writing runtime sql for node "model.my_dbt_trino_project.src_page_view_events"
[0m16:02:59.021754 [debug] [Thread-1 (]: Using trino connection "model.my_dbt_trino_project.src_page_view_events"
[0m16:02:59.022276 [debug] [Thread-1 (]: On model.my_dbt_trino_project.src_page_view_events: /* {"app": "dbt", "dbt_version": "1.8.2", "profile_name": "my_dbt_trino_project", "target_name": "dev", "node_id": "model.my_dbt_trino_project.src_page_view_events"} */
insert into "datalake"."analytics_source"."src_page_view_events" ("id", "ts", "sessionid", "page", "auth", "level", "iteminsession", "city", "zip", "state", "useragent", "lon", "lat", "userid", "lastname", "firstname", "gender", "registration", "artist", "song", "duration")
    (
        select "id", "ts", "sessionid", "page", "auth", "level", "iteminsession", "city", "zip", "state", "useragent", "lon", "lat", "userid", "lastname", "firstname", "gender", "registration", "artist", "song", "duration"
        from "datalake"."analytics_source"."src_page_view_events__dbt_tmp"
    )
[0m16:02:59.182681 [debug] [Thread-1 (]: SQL status: SUCCESS in 0.0 seconds
[0m16:02:59.186936 [debug] [Thread-1 (]: Applying DROP to: "datalake"."analytics_source"."src_page_view_events__dbt_tmp"
[0m16:02:59.188001 [debug] [Thread-1 (]: Using trino connection "model.my_dbt_trino_project.src_page_view_events"
[0m16:02:59.188536 [debug] [Thread-1 (]: On model.my_dbt_trino_project.src_page_view_events: /* {"app": "dbt", "dbt_version": "1.8.2", "profile_name": "my_dbt_trino_project", "target_name": "dev", "node_id": "model.my_dbt_trino_project.src_page_view_events"} */

    drop table if exists "datalake"."analytics_source"."src_page_view_events__dbt_tmp"
[0m16:02:59.298208 [debug] [Thread-1 (]: SQL status: SUCCESS in 0.0 seconds
[0m16:02:59.299728 [debug] [Thread-1 (]: On model.my_dbt_trino_project.src_page_view_events: ROLLBACK
[0m16:02:59.299728 [debug] [Thread-1 (]: On model.my_dbt_trino_project.src_page_view_events: Close
[0m16:02:59.299728 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '536373b5-260c-4091-abc1-9dc095bf72ea', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x0000026C69ECC1D0>]}
[0m16:02:59.299728 [info ] [Thread-1 (]: 3 of 15 OK created sql incremental model analytics_source.src_page_view_events . [[32mSUCCESS[0m in 0.94s]
[0m16:02:59.299728 [debug] [Thread-1 (]: Finished running node model.my_dbt_trino_project.src_page_view_events
[0m16:02:59.303805 [debug] [Thread-1 (]: Began running node model.my_dbt_trino_project.stg_user_level_by_gender
[0m16:02:59.303805 [info ] [Thread-1 (]: 4 of 15 START sql view model analytics_stage.stg_user_level_by_gender .......... [RUN]
[0m16:02:59.303805 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.my_dbt_trino_project.src_page_view_events, now model.my_dbt_trino_project.stg_user_level_by_gender)
[0m16:02:59.303805 [debug] [Thread-1 (]: Began compiling node model.my_dbt_trino_project.stg_user_level_by_gender
[0m16:02:59.303805 [debug] [Thread-1 (]: Writing injected SQL for node "model.my_dbt_trino_project.stg_user_level_by_gender"
[0m16:02:59.303805 [debug] [Thread-1 (]: Began executing node model.my_dbt_trino_project.stg_user_level_by_gender
[0m16:02:59.320558 [debug] [Thread-1 (]: Writing runtime sql for node "model.my_dbt_trino_project.stg_user_level_by_gender"
[0m16:02:59.322429 [debug] [Thread-1 (]: Using trino connection "model.my_dbt_trino_project.stg_user_level_by_gender"
[0m16:02:59.322429 [debug] [Thread-1 (]: On model.my_dbt_trino_project.stg_user_level_by_gender: /* {"app": "dbt", "dbt_version": "1.8.2", "profile_name": "my_dbt_trino_project", "target_name": "dev", "node_id": "model.my_dbt_trino_project.stg_user_level_by_gender"} */

  create or replace view
    "datalake"."analytics_stage"."stg_user_level_by_gender"
  security definer
  as
    

WITH user_subscriptions AS (
    SELECT
        gender,
        level, 
        COUNT(DISTINCT userId) AS user_count
    FROM "datalake"."analytics_source"."src_auth_events"
    WHERE gender IS NOT NULL AND level IS NOT NULL
    GROUP BY gender, level
)

SELECT
    gender,
    level,
    user_count
FROM user_subscriptions
  
[0m16:02:59.325456 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m16:02:59.397184 [debug] [Thread-1 (]: SQL status: SUCCESS in 0.0 seconds
[0m16:02:59.398193 [debug] [Thread-1 (]: On model.my_dbt_trino_project.stg_user_level_by_gender: ROLLBACK
[0m16:02:59.398193 [debug] [Thread-1 (]: On model.my_dbt_trino_project.stg_user_level_by_gender: Close
[0m16:02:59.398193 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '536373b5-260c-4091-abc1-9dc095bf72ea', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x0000026C6B686F10>]}
[0m16:02:59.398193 [info ] [Thread-1 (]: 4 of 15 OK created sql view model analytics_stage.stg_user_level_by_gender ..... [[32mSUCCESS[0m in 0.09s]
[0m16:02:59.398193 [debug] [Thread-1 (]: Finished running node model.my_dbt_trino_project.stg_user_level_by_gender
[0m16:02:59.403891 [debug] [Thread-1 (]: Began running node model.my_dbt_trino_project.stg_streams_hourly
[0m16:02:59.403891 [info ] [Thread-1 (]: 5 of 15 START sql view model analytics_stage.stg_streams_hourly ................ [RUN]
[0m16:02:59.403891 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.my_dbt_trino_project.stg_user_level_by_gender, now model.my_dbt_trino_project.stg_streams_hourly)
[0m16:02:59.403891 [debug] [Thread-1 (]: Began compiling node model.my_dbt_trino_project.stg_streams_hourly
[0m16:02:59.403891 [debug] [Thread-1 (]: Writing injected SQL for node "model.my_dbt_trino_project.stg_streams_hourly"
[0m16:02:59.403891 [debug] [Thread-1 (]: Began executing node model.my_dbt_trino_project.stg_streams_hourly
[0m16:02:59.403891 [debug] [Thread-1 (]: Writing runtime sql for node "model.my_dbt_trino_project.stg_streams_hourly"
[0m16:02:59.403891 [debug] [Thread-1 (]: Using trino connection "model.my_dbt_trino_project.stg_streams_hourly"
[0m16:02:59.403891 [debug] [Thread-1 (]: On model.my_dbt_trino_project.stg_streams_hourly: /* {"app": "dbt", "dbt_version": "1.8.2", "profile_name": "my_dbt_trino_project", "target_name": "dev", "node_id": "model.my_dbt_trino_project.stg_streams_hourly"} */

  create or replace view
    "datalake"."analytics_stage"."stg_streams_hourly"
  security definer
  as
    

SELECT
    DATE_FORMAT(FROM_UNIXTIME(ts), '%Y-%m-%d') AS stream_date, 
    DATE_FORMAT(FROM_UNIXTIME(ts), '%H') AS stream_hour,
    COUNT(*) AS total_streams
FROM "datalake"."analytics_source"."src_listen_events"
GROUP BY
    DATE_FORMAT(FROM_UNIXTIME(ts), '%Y-%m-%d'),
    DATE_FORMAT(FROM_UNIXTIME(ts), '%H')
  
[0m16:02:59.403891 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m16:02:59.484735 [debug] [Thread-1 (]: SQL status: SUCCESS in 0.0 seconds
[0m16:02:59.487312 [debug] [Thread-1 (]: On model.my_dbt_trino_project.stg_streams_hourly: ROLLBACK
[0m16:02:59.487312 [debug] [Thread-1 (]: On model.my_dbt_trino_project.stg_streams_hourly: Close
[0m16:02:59.487312 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '536373b5-260c-4091-abc1-9dc095bf72ea', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x0000026C69C1A910>]}
[0m16:02:59.487312 [info ] [Thread-1 (]: 5 of 15 OK created sql view model analytics_stage.stg_streams_hourly ........... [[32mSUCCESS[0m in 0.08s]
[0m16:02:59.487312 [debug] [Thread-1 (]: Finished running node model.my_dbt_trino_project.stg_streams_hourly
[0m16:02:59.487312 [debug] [Thread-1 (]: Began running node model.my_dbt_trino_project.stg_top_songs_artists
[0m16:02:59.491271 [info ] [Thread-1 (]: 6 of 15 START sql view model analytics_stage.stg_top_songs_artists ............. [RUN]
[0m16:02:59.491271 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.my_dbt_trino_project.stg_streams_hourly, now model.my_dbt_trino_project.stg_top_songs_artists)
[0m16:02:59.491271 [debug] [Thread-1 (]: Began compiling node model.my_dbt_trino_project.stg_top_songs_artists
[0m16:02:59.491271 [debug] [Thread-1 (]: Writing injected SQL for node "model.my_dbt_trino_project.stg_top_songs_artists"
[0m16:02:59.491271 [debug] [Thread-1 (]: Began executing node model.my_dbt_trino_project.stg_top_songs_artists
[0m16:02:59.498215 [debug] [Thread-1 (]: Writing runtime sql for node "model.my_dbt_trino_project.stg_top_songs_artists"
[0m16:02:59.498215 [debug] [Thread-1 (]: Using trino connection "model.my_dbt_trino_project.stg_top_songs_artists"
[0m16:02:59.498215 [debug] [Thread-1 (]: On model.my_dbt_trino_project.stg_top_songs_artists: /* {"app": "dbt", "dbt_version": "1.8.2", "profile_name": "my_dbt_trino_project", "target_name": "dev", "node_id": "model.my_dbt_trino_project.stg_top_songs_artists"} */

  create or replace view
    "datalake"."analytics_stage"."stg_top_songs_artists"
  security definer
  as
    

WITH song_plays AS (
    SELECT
        artist,
        song,
        COUNT(*) AS play_count
    FROM "datalake"."analytics_source"."src_listen_events"
    GROUP BY artist, song
)

SELECT
    artist,
    song,
    play_count
FROM song_plays
ORDER BY play_count DESC
  
[0m16:02:59.498215 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m16:02:59.552345 [debug] [Thread-1 (]: SQL status: SUCCESS in 0.0 seconds
[0m16:02:59.557872 [debug] [Thread-1 (]: On model.my_dbt_trino_project.stg_top_songs_artists: ROLLBACK
[0m16:02:59.557872 [debug] [Thread-1 (]: On model.my_dbt_trino_project.stg_top_songs_artists: Close
[0m16:02:59.557872 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '536373b5-260c-4091-abc1-9dc095bf72ea', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x0000026C6B244410>]}
[0m16:02:59.557872 [info ] [Thread-1 (]: 6 of 15 OK created sql view model analytics_stage.stg_top_songs_artists ........ [[32mSUCCESS[0m in 0.07s]
[0m16:02:59.560884 [debug] [Thread-1 (]: Finished running node model.my_dbt_trino_project.stg_top_songs_artists
[0m16:02:59.560884 [debug] [Thread-1 (]: Began running node model.my_dbt_trino_project.stg_unique_users
[0m16:02:59.562047 [info ] [Thread-1 (]: 7 of 15 START sql view model analytics_stage.stg_unique_users .................. [RUN]
[0m16:02:59.563057 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.my_dbt_trino_project.stg_top_songs_artists, now model.my_dbt_trino_project.stg_unique_users)
[0m16:02:59.563057 [debug] [Thread-1 (]: Began compiling node model.my_dbt_trino_project.stg_unique_users
[0m16:02:59.564622 [debug] [Thread-1 (]: Writing injected SQL for node "model.my_dbt_trino_project.stg_unique_users"
[0m16:02:59.564622 [debug] [Thread-1 (]: Began executing node model.my_dbt_trino_project.stg_unique_users
[0m16:02:59.564622 [debug] [Thread-1 (]: Writing runtime sql for node "model.my_dbt_trino_project.stg_unique_users"
[0m16:02:59.564622 [debug] [Thread-1 (]: Using trino connection "model.my_dbt_trino_project.stg_unique_users"
[0m16:02:59.564622 [debug] [Thread-1 (]: On model.my_dbt_trino_project.stg_unique_users: /* {"app": "dbt", "dbt_version": "1.8.2", "profile_name": "my_dbt_trino_project", "target_name": "dev", "node_id": "model.my_dbt_trino_project.stg_unique_users"} */

  create or replace view
    "datalake"."analytics_stage"."stg_unique_users"
  security definer
  as
    

SELECT
    COUNT(DISTINCT userid) AS total_unique_users
FROM "datalake"."analytics_source"."src_listen_events"
WHERE userid IS NOT NULL
  
[0m16:02:59.564622 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m16:02:59.634209 [debug] [Thread-1 (]: SQL status: SUCCESS in 0.0 seconds
[0m16:02:59.634209 [debug] [Thread-1 (]: On model.my_dbt_trino_project.stg_unique_users: ROLLBACK
[0m16:02:59.634209 [debug] [Thread-1 (]: On model.my_dbt_trino_project.stg_unique_users: Close
[0m16:02:59.637215 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '536373b5-260c-4091-abc1-9dc095bf72ea', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x0000026C6B687C50>]}
[0m16:02:59.638249 [info ] [Thread-1 (]: 7 of 15 OK created sql view model analytics_stage.stg_unique_users ............. [[32mSUCCESS[0m in 0.07s]
[0m16:02:59.639653 [debug] [Thread-1 (]: Finished running node model.my_dbt_trino_project.stg_unique_users
[0m16:02:59.639653 [debug] [Thread-1 (]: Began running node model.my_dbt_trino_project.stg_user_activity_per_country
[0m16:02:59.639653 [info ] [Thread-1 (]: 8 of 15 START sql view model analytics_stage.stg_user_activity_per_country ..... [RUN]
[0m16:02:59.639653 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.my_dbt_trino_project.stg_unique_users, now model.my_dbt_trino_project.stg_user_activity_per_country)
[0m16:02:59.639653 [debug] [Thread-1 (]: Began compiling node model.my_dbt_trino_project.stg_user_activity_per_country
[0m16:02:59.639653 [debug] [Thread-1 (]: Writing injected SQL for node "model.my_dbt_trino_project.stg_user_activity_per_country"
[0m16:02:59.639653 [debug] [Thread-1 (]: Began executing node model.my_dbt_trino_project.stg_user_activity_per_country
[0m16:02:59.648131 [debug] [Thread-1 (]: Writing runtime sql for node "model.my_dbt_trino_project.stg_user_activity_per_country"
[0m16:02:59.650782 [debug] [Thread-1 (]: Using trino connection "model.my_dbt_trino_project.stg_user_activity_per_country"
[0m16:02:59.651424 [debug] [Thread-1 (]: On model.my_dbt_trino_project.stg_user_activity_per_country: /* {"app": "dbt", "dbt_version": "1.8.2", "profile_name": "my_dbt_trino_project", "target_name": "dev", "node_id": "model.my_dbt_trino_project.stg_user_activity_per_country"} */

  create or replace view
    "datalake"."analytics_stage"."stg_user_activity_per_country"
  security definer
  as
    

WITH combined_activities AS (
  SELECT
    country,
    'listen_event' AS event_type,
    ts,
    userid
  FROM "datalake"."analytics_source"."src_listen_events"
  WHERE country IS NOT NULL
  UNION ALL
  SELECT
    'Unknown' AS country, 
    ts,
    userid
  FROM "datalake"."analytics_source"."src_auth_events"
  UNION ALL
  SELECT
    'Unknown' AS country, 
    'page_view_event' AS event_type,
    ts,
    userid
  FROM "datalake"."analytics_source"."src_page_view_events"
)

SELECT
  country,
  COUNT(*) AS activity_count
FROM combined_activities
GROUP BY country
  
[0m16:02:59.651633 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m16:02:59.700705 [debug] [Thread-1 (]: Trino adapter: Trino query id: 20240617_080259_00067_xsftb
[0m16:02:59.700705 [debug] [Thread-1 (]: Trino adapter: Trino error: TrinoUserError(type=USER_ERROR, name=TYPE_MISMATCH, message="line 17:3: UNION query has different number of fields: 4, 3", query_id=20240617_080259_00067_xsftb)
[0m16:02:59.700705 [debug] [Thread-1 (]: On model.my_dbt_trino_project.stg_user_activity_per_country: ROLLBACK
[0m16:02:59.700705 [debug] [Thread-1 (]: On model.my_dbt_trino_project.stg_user_activity_per_country: Close
[0m16:02:59.709551 [debug] [Thread-1 (]: Database Error in model stg_user_activity_per_country (models\stage\stg_user_activity_per_country.sql)
  TrinoUserError(type=USER_ERROR, name=TYPE_MISMATCH, message="line 17:3: UNION query has different number of fields: 4, 3", query_id=20240617_080259_00067_xsftb)
  compiled Code at target\run\my_dbt_trino_project\models\stage\stg_user_activity_per_country.sql
[0m16:02:59.709551 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '536373b5-260c-4091-abc1-9dc095bf72ea', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x0000026C6B2AFE10>]}
[0m16:02:59.714456 [error] [Thread-1 (]: 8 of 15 ERROR creating sql view model analytics_stage.stg_user_activity_per_country  [[31mERROR[0m in 0.07s]
[0m16:02:59.714456 [debug] [Thread-1 (]: Finished running node model.my_dbt_trino_project.stg_user_activity_per_country
[0m16:02:59.714456 [debug] [Thread-1 (]: Began running node model.my_dbt_trino_project.stg_user_activity_per_location
[0m16:02:59.714456 [info ] [Thread-1 (]: 9 of 15 START sql view model analytics_stage.stg_user_activity_per_location .... [RUN]
[0m16:02:59.716897 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.my_dbt_trino_project.stg_user_activity_per_country, now model.my_dbt_trino_project.stg_user_activity_per_location)
[0m16:02:59.716897 [debug] [Thread-1 (]: Began compiling node model.my_dbt_trino_project.stg_user_activity_per_location
[0m16:02:59.718062 [debug] [Thread-1 (]: Writing injected SQL for node "model.my_dbt_trino_project.stg_user_activity_per_location"
[0m16:02:59.718062 [debug] [Thread-1 (]: Began executing node model.my_dbt_trino_project.stg_user_activity_per_location
[0m16:02:59.718062 [debug] [Thread-1 (]: Writing runtime sql for node "model.my_dbt_trino_project.stg_user_activity_per_location"
[0m16:02:59.718062 [debug] [Thread-1 (]: Using trino connection "model.my_dbt_trino_project.stg_user_activity_per_location"
[0m16:02:59.718062 [debug] [Thread-1 (]: On model.my_dbt_trino_project.stg_user_activity_per_location: /* {"app": "dbt", "dbt_version": "1.8.2", "profile_name": "my_dbt_trino_project", "target_name": "dev", "node_id": "model.my_dbt_trino_project.stg_user_activity_per_location"} */

  create or replace view
    "datalake"."analytics_stage"."stg_user_activity_per_location"
  security definer
  as
    

WITH combined_activities AS (
  SELECT
    city,
    state,
    'auth_event' AS event_type,
    ts,
    userid
 FROM "datalake"."analytics_source"."src_auth_events"
  UNION ALL
  SELECT
    city,
    state,
    'listen_event' AS event_type,
    ts,
    userid
  FROM "datalake"."analytics_source"."src_listen_events"
  UNION ALL
  SELECT
    city,
    state,
    'page_view_event' AS event_type,
    ts,
    userid
  FROM "datalake"."analytics_source"."src_page_view_events"
)

SELECT
  state,
  city,
  COUNT(*) AS activity_count
FROM combined_activities
GROUP BY state, city
  
[0m16:02:59.718062 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m16:02:59.810655 [debug] [Thread-1 (]: SQL status: SUCCESS in 0.0 seconds
[0m16:02:59.810655 [debug] [Thread-1 (]: On model.my_dbt_trino_project.stg_user_activity_per_location: ROLLBACK
[0m16:02:59.810655 [debug] [Thread-1 (]: On model.my_dbt_trino_project.stg_user_activity_per_location: Close
[0m16:02:59.810655 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '536373b5-260c-4091-abc1-9dc095bf72ea', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x0000026C69C5EB50>]}
[0m16:02:59.810655 [info ] [Thread-1 (]: 9 of 15 OK created sql view model analytics_stage.stg_user_activity_per_location  [[32mSUCCESS[0m in 0.09s]
[0m16:02:59.814664 [debug] [Thread-1 (]: Finished running node model.my_dbt_trino_project.stg_user_activity_per_location
[0m16:02:59.814664 [debug] [Thread-1 (]: Began running node model.my_dbt_trino_project.mart_user_level_by_gender
[0m16:02:59.815847 [info ] [Thread-1 (]: 10 of 15 START sql table model analytics.mart_user_level_by_gender ............. [RUN]
[0m16:02:59.816352 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.my_dbt_trino_project.stg_user_activity_per_location, now model.my_dbt_trino_project.mart_user_level_by_gender)
[0m16:02:59.817001 [debug] [Thread-1 (]: Began compiling node model.my_dbt_trino_project.mart_user_level_by_gender
[0m16:02:59.819594 [debug] [Thread-1 (]: Writing injected SQL for node "model.my_dbt_trino_project.mart_user_level_by_gender"
[0m16:02:59.820291 [debug] [Thread-1 (]: Began executing node model.my_dbt_trino_project.mart_user_level_by_gender
[0m16:02:59.841479 [debug] [Thread-1 (]: Writing runtime sql for node "model.my_dbt_trino_project.mart_user_level_by_gender"
[0m16:02:59.841479 [debug] [Thread-1 (]: Using trino connection "model.my_dbt_trino_project.mart_user_level_by_gender"
[0m16:02:59.843901 [debug] [Thread-1 (]: On model.my_dbt_trino_project.mart_user_level_by_gender: /* {"app": "dbt", "dbt_version": "1.8.2", "profile_name": "my_dbt_trino_project", "target_name": "dev", "node_id": "model.my_dbt_trino_project.mart_user_level_by_gender"} */

  
    

    create table "datalake"."analytics"."mart_user_level_by_gender__dbt_tmp"
      
      
    as (
      

SELECT
    gender,
    level,
    SUM(user_count) AS total_users,
    ROUND(SUM(user_count) * 100.0 / SUM(SUM(user_count)) OVER (), 2) AS percentage_of_total_users
FROM "datalake"."analytics_stage"."stg_user_level_by_gender"
GROUP BY gender, level
    )
[0m16:02:59.843901 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m16:03:00.188160 [debug] [Thread-1 (]: SQL status: SUCCESS in 0.0 seconds
[0m16:03:00.196872 [debug] [Thread-1 (]: Using trino connection "model.my_dbt_trino_project.mart_user_level_by_gender"
[0m16:03:00.196872 [debug] [Thread-1 (]: On model.my_dbt_trino_project.mart_user_level_by_gender: /* {"app": "dbt", "dbt_version": "1.8.2", "profile_name": "my_dbt_trino_project", "target_name": "dev", "node_id": "model.my_dbt_trino_project.mart_user_level_by_gender"} */
alter table "datalake"."analytics"."mart_user_level_by_gender" rename to "datalake"."analytics"."mart_user_level_by_gender__dbt_backup"
[0m16:03:00.291339 [debug] [Thread-1 (]: SQL status: SUCCESS in 0.0 seconds
[0m16:03:00.298862 [debug] [Thread-1 (]: Using trino connection "model.my_dbt_trino_project.mart_user_level_by_gender"
[0m16:03:00.298862 [debug] [Thread-1 (]: On model.my_dbt_trino_project.mart_user_level_by_gender: /* {"app": "dbt", "dbt_version": "1.8.2", "profile_name": "my_dbt_trino_project", "target_name": "dev", "node_id": "model.my_dbt_trino_project.mart_user_level_by_gender"} */
alter table "datalake"."analytics"."mart_user_level_by_gender__dbt_tmp" rename to "datalake"."analytics"."mart_user_level_by_gender"
[0m16:03:00.402758 [debug] [Thread-1 (]: SQL status: SUCCESS in 0.0 seconds
[0m16:03:00.404274 [debug] [Thread-1 (]: Applying DROP to: "datalake"."analytics"."mart_user_level_by_gender__dbt_backup"
[0m16:03:00.404274 [debug] [Thread-1 (]: Using trino connection "model.my_dbt_trino_project.mart_user_level_by_gender"
[0m16:03:00.404274 [debug] [Thread-1 (]: On model.my_dbt_trino_project.mart_user_level_by_gender: /* {"app": "dbt", "dbt_version": "1.8.2", "profile_name": "my_dbt_trino_project", "target_name": "dev", "node_id": "model.my_dbt_trino_project.mart_user_level_by_gender"} */

    drop table if exists "datalake"."analytics"."mart_user_level_by_gender__dbt_backup"
[0m16:03:00.558004 [debug] [Thread-1 (]: SQL status: SUCCESS in 0.0 seconds
[0m16:03:00.558004 [debug] [Thread-1 (]: On model.my_dbt_trino_project.mart_user_level_by_gender: ROLLBACK
[0m16:03:00.558004 [debug] [Thread-1 (]: On model.my_dbt_trino_project.mart_user_level_by_gender: Close
[0m16:03:00.558004 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '536373b5-260c-4091-abc1-9dc095bf72ea', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x0000026C6998AF50>]}
[0m16:03:00.558004 [info ] [Thread-1 (]: 10 of 15 OK created sql table model analytics.mart_user_level_by_gender ........ [[32mSUCCESS[0m in 0.74s]
[0m16:03:00.565005 [debug] [Thread-1 (]: Finished running node model.my_dbt_trino_project.mart_user_level_by_gender
[0m16:03:00.565005 [debug] [Thread-1 (]: Began running node model.my_dbt_trino_project.mart_hourly_stream_evolution
[0m16:03:00.565005 [info ] [Thread-1 (]: 11 of 15 START sql table model analytics.mart_hourly_stream_evolution .......... [RUN]
[0m16:03:00.565005 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.my_dbt_trino_project.mart_user_level_by_gender, now model.my_dbt_trino_project.mart_hourly_stream_evolution)
[0m16:03:00.565005 [debug] [Thread-1 (]: Began compiling node model.my_dbt_trino_project.mart_hourly_stream_evolution
[0m16:03:00.569787 [debug] [Thread-1 (]: Writing injected SQL for node "model.my_dbt_trino_project.mart_hourly_stream_evolution"
[0m16:03:00.570573 [debug] [Thread-1 (]: Began executing node model.my_dbt_trino_project.mart_hourly_stream_evolution
[0m16:03:00.573743 [debug] [Thread-1 (]: Writing runtime sql for node "model.my_dbt_trino_project.mart_hourly_stream_evolution"
[0m16:03:00.575856 [debug] [Thread-1 (]: Using trino connection "model.my_dbt_trino_project.mart_hourly_stream_evolution"
[0m16:03:00.577790 [debug] [Thread-1 (]: On model.my_dbt_trino_project.mart_hourly_stream_evolution: /* {"app": "dbt", "dbt_version": "1.8.2", "profile_name": "my_dbt_trino_project", "target_name": "dev", "node_id": "model.my_dbt_trino_project.mart_hourly_stream_evolution"} */

  
    

    create table "datalake"."analytics"."mart_hourly_stream_evolution__dbt_tmp"
      
      
    as (
      

SELECT
    stream_date,
    stream_hour,
    total_streams,
    SUM(total_streams) OVER (PARTITION BY stream_date ORDER BY stream_hour) AS cumulative_streams
FROM "datalake"."analytics_stage"."stg_streams_hourly"
ORDER BY
    stream_date,
    stream_hour
    )
[0m16:03:00.577790 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m16:03:00.873819 [debug] [Thread-1 (]: SQL status: SUCCESS in 0.0 seconds
[0m16:03:00.877825 [debug] [Thread-1 (]: Using trino connection "model.my_dbt_trino_project.mart_hourly_stream_evolution"
[0m16:03:00.877825 [debug] [Thread-1 (]: On model.my_dbt_trino_project.mart_hourly_stream_evolution: /* {"app": "dbt", "dbt_version": "1.8.2", "profile_name": "my_dbt_trino_project", "target_name": "dev", "node_id": "model.my_dbt_trino_project.mart_hourly_stream_evolution"} */
alter table "datalake"."analytics"."mart_hourly_stream_evolution" rename to "datalake"."analytics"."mart_hourly_stream_evolution__dbt_backup"
[0m16:03:00.967904 [debug] [Thread-1 (]: SQL status: SUCCESS in 0.0 seconds
[0m16:03:00.974518 [debug] [Thread-1 (]: Using trino connection "model.my_dbt_trino_project.mart_hourly_stream_evolution"
[0m16:03:00.974518 [debug] [Thread-1 (]: On model.my_dbt_trino_project.mart_hourly_stream_evolution: /* {"app": "dbt", "dbt_version": "1.8.2", "profile_name": "my_dbt_trino_project", "target_name": "dev", "node_id": "model.my_dbt_trino_project.mart_hourly_stream_evolution"} */
alter table "datalake"."analytics"."mart_hourly_stream_evolution__dbt_tmp" rename to "datalake"."analytics"."mart_hourly_stream_evolution"
[0m16:03:01.027646 [debug] [Thread-1 (]: SQL status: SUCCESS in 0.0 seconds
[0m16:03:01.030179 [debug] [Thread-1 (]: Applying DROP to: "datalake"."analytics"."mart_hourly_stream_evolution__dbt_backup"
[0m16:03:01.030179 [debug] [Thread-1 (]: Using trino connection "model.my_dbt_trino_project.mart_hourly_stream_evolution"
[0m16:03:01.031904 [debug] [Thread-1 (]: On model.my_dbt_trino_project.mart_hourly_stream_evolution: /* {"app": "dbt", "dbt_version": "1.8.2", "profile_name": "my_dbt_trino_project", "target_name": "dev", "node_id": "model.my_dbt_trino_project.mart_hourly_stream_evolution"} */

    drop table if exists "datalake"."analytics"."mart_hourly_stream_evolution__dbt_backup"
[0m16:03:01.256999 [debug] [Thread-1 (]: SQL status: SUCCESS in 0.0 seconds
[0m16:03:01.267004 [debug] [Thread-1 (]: On model.my_dbt_trino_project.mart_hourly_stream_evolution: ROLLBACK
[0m16:03:01.267004 [debug] [Thread-1 (]: On model.my_dbt_trino_project.mart_hourly_stream_evolution: Close
[0m16:03:01.267004 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '536373b5-260c-4091-abc1-9dc095bf72ea', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x0000026C6B236190>]}
[0m16:03:01.267004 [info ] [Thread-1 (]: 11 of 15 OK created sql table model analytics.mart_hourly_stream_evolution ..... [[32mSUCCESS[0m in 0.70s]
[0m16:03:01.267004 [debug] [Thread-1 (]: Finished running node model.my_dbt_trino_project.mart_hourly_stream_evolution
[0m16:03:01.267004 [debug] [Thread-1 (]: Began running node model.my_dbt_trino_project.mart_top_songs_artists
[0m16:03:01.267004 [info ] [Thread-1 (]: 12 of 15 START sql table model analytics.mart_top_songs_artists ................ [RUN]
[0m16:03:01.267004 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.my_dbt_trino_project.mart_hourly_stream_evolution, now model.my_dbt_trino_project.mart_top_songs_artists)
[0m16:03:01.267004 [debug] [Thread-1 (]: Began compiling node model.my_dbt_trino_project.mart_top_songs_artists
[0m16:03:01.273091 [debug] [Thread-1 (]: Writing injected SQL for node "model.my_dbt_trino_project.mart_top_songs_artists"
[0m16:03:01.273091 [debug] [Thread-1 (]: Began executing node model.my_dbt_trino_project.mart_top_songs_artists
[0m16:03:01.273091 [debug] [Thread-1 (]: Writing runtime sql for node "model.my_dbt_trino_project.mart_top_songs_artists"
[0m16:03:01.282184 [debug] [Thread-1 (]: Using trino connection "model.my_dbt_trino_project.mart_top_songs_artists"
[0m16:03:01.282184 [debug] [Thread-1 (]: On model.my_dbt_trino_project.mart_top_songs_artists: /* {"app": "dbt", "dbt_version": "1.8.2", "profile_name": "my_dbt_trino_project", "target_name": "dev", "node_id": "model.my_dbt_trino_project.mart_top_songs_artists"} */

  
    

    create table "datalake"."analytics"."mart_top_songs_artists__dbt_tmp"
      
      
    as (
      

WITH top_songs AS (
    SELECT
        artist,
        song,
        play_count
    FROM "datalake"."analytics_stage"."stg_top_songs_artists"
)

SELECT
    artist,
    song,
    play_count
FROM top_songs
    )
[0m16:03:01.282184 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m16:03:01.583519 [debug] [Thread-1 (]: SQL status: SUCCESS in 0.0 seconds
[0m16:03:01.584524 [debug] [Thread-1 (]: Using trino connection "model.my_dbt_trino_project.mart_top_songs_artists"
[0m16:03:01.584524 [debug] [Thread-1 (]: On model.my_dbt_trino_project.mart_top_songs_artists: /* {"app": "dbt", "dbt_version": "1.8.2", "profile_name": "my_dbt_trino_project", "target_name": "dev", "node_id": "model.my_dbt_trino_project.mart_top_songs_artists"} */
alter table "datalake"."analytics"."mart_top_songs_artists" rename to "datalake"."analytics"."mart_top_songs_artists__dbt_backup"
[0m16:03:01.664828 [debug] [Thread-1 (]: SQL status: SUCCESS in 0.0 seconds
[0m16:03:01.664828 [debug] [Thread-1 (]: Using trino connection "model.my_dbt_trino_project.mart_top_songs_artists"
[0m16:03:01.677788 [debug] [Thread-1 (]: On model.my_dbt_trino_project.mart_top_songs_artists: /* {"app": "dbt", "dbt_version": "1.8.2", "profile_name": "my_dbt_trino_project", "target_name": "dev", "node_id": "model.my_dbt_trino_project.mart_top_songs_artists"} */
alter table "datalake"."analytics"."mart_top_songs_artists__dbt_tmp" rename to "datalake"."analytics"."mart_top_songs_artists"
[0m16:03:01.765485 [debug] [Thread-1 (]: SQL status: SUCCESS in 0.0 seconds
[0m16:03:01.770683 [debug] [Thread-1 (]: Applying DROP to: "datalake"."analytics"."mart_top_songs_artists__dbt_backup"
[0m16:03:01.771741 [debug] [Thread-1 (]: Using trino connection "model.my_dbt_trino_project.mart_top_songs_artists"
[0m16:03:01.771741 [debug] [Thread-1 (]: On model.my_dbt_trino_project.mart_top_songs_artists: /* {"app": "dbt", "dbt_version": "1.8.2", "profile_name": "my_dbt_trino_project", "target_name": "dev", "node_id": "model.my_dbt_trino_project.mart_top_songs_artists"} */

    drop table if exists "datalake"."analytics"."mart_top_songs_artists__dbt_backup"
[0m16:03:01.918618 [debug] [Thread-1 (]: SQL status: SUCCESS in 0.0 seconds
[0m16:03:01.918618 [debug] [Thread-1 (]: On model.my_dbt_trino_project.mart_top_songs_artists: ROLLBACK
[0m16:03:01.918618 [debug] [Thread-1 (]: On model.my_dbt_trino_project.mart_top_songs_artists: Close
[0m16:03:01.918618 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '536373b5-260c-4091-abc1-9dc095bf72ea', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x0000026C6B2AFC50>]}
[0m16:03:01.918618 [info ] [Thread-1 (]: 12 of 15 OK created sql table model analytics.mart_top_songs_artists ........... [[32mSUCCESS[0m in 0.65s]
[0m16:03:01.918618 [debug] [Thread-1 (]: Finished running node model.my_dbt_trino_project.mart_top_songs_artists
[0m16:03:01.918618 [debug] [Thread-1 (]: Began running node model.my_dbt_trino_project.mart_total_unique_users
[0m16:03:01.918618 [info ] [Thread-1 (]: 13 of 15 START sql table model analytics.mart_total_unique_users ............... [RUN]
[0m16:03:01.927857 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.my_dbt_trino_project.mart_top_songs_artists, now model.my_dbt_trino_project.mart_total_unique_users)
[0m16:03:01.927857 [debug] [Thread-1 (]: Began compiling node model.my_dbt_trino_project.mart_total_unique_users
[0m16:03:01.930638 [debug] [Thread-1 (]: Writing injected SQL for node "model.my_dbt_trino_project.mart_total_unique_users"
[0m16:03:01.931418 [debug] [Thread-1 (]: Began executing node model.my_dbt_trino_project.mart_total_unique_users
[0m16:03:01.934793 [debug] [Thread-1 (]: Writing runtime sql for node "model.my_dbt_trino_project.mart_total_unique_users"
[0m16:03:01.936261 [debug] [Thread-1 (]: Using trino connection "model.my_dbt_trino_project.mart_total_unique_users"
[0m16:03:01.936261 [debug] [Thread-1 (]: On model.my_dbt_trino_project.mart_total_unique_users: /* {"app": "dbt", "dbt_version": "1.8.2", "profile_name": "my_dbt_trino_project", "target_name": "dev", "node_id": "model.my_dbt_trino_project.mart_total_unique_users"} */

  
    

    create table "datalake"."analytics"."mart_total_unique_users__dbt_tmp"
      
      
    as (
      

SELECT
    total_unique_users
FROM "datalake"."analytics_stage"."stg_unique_users"
    )
[0m16:03:01.936261 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m16:03:02.241770 [debug] [Thread-1 (]: SQL status: SUCCESS in 0.0 seconds
[0m16:03:02.246367 [debug] [Thread-1 (]: Using trino connection "model.my_dbt_trino_project.mart_total_unique_users"
[0m16:03:02.246877 [debug] [Thread-1 (]: On model.my_dbt_trino_project.mart_total_unique_users: /* {"app": "dbt", "dbt_version": "1.8.2", "profile_name": "my_dbt_trino_project", "target_name": "dev", "node_id": "model.my_dbt_trino_project.mart_total_unique_users"} */
alter table "datalake"."analytics"."mart_total_unique_users" rename to "datalake"."analytics"."mart_total_unique_users__dbt_backup"
[0m16:03:02.337650 [debug] [Thread-1 (]: SQL status: SUCCESS in 0.0 seconds
[0m16:03:02.340672 [debug] [Thread-1 (]: Using trino connection "model.my_dbt_trino_project.mart_total_unique_users"
[0m16:03:02.340672 [debug] [Thread-1 (]: On model.my_dbt_trino_project.mart_total_unique_users: /* {"app": "dbt", "dbt_version": "1.8.2", "profile_name": "my_dbt_trino_project", "target_name": "dev", "node_id": "model.my_dbt_trino_project.mart_total_unique_users"} */
alter table "datalake"."analytics"."mart_total_unique_users__dbt_tmp" rename to "datalake"."analytics"."mart_total_unique_users"
[0m16:03:02.431410 [debug] [Thread-1 (]: SQL status: SUCCESS in 0.0 seconds
[0m16:03:02.438649 [debug] [Thread-1 (]: Applying DROP to: "datalake"."analytics"."mart_total_unique_users__dbt_backup"
[0m16:03:02.439644 [debug] [Thread-1 (]: Using trino connection "model.my_dbt_trino_project.mart_total_unique_users"
[0m16:03:02.439644 [debug] [Thread-1 (]: On model.my_dbt_trino_project.mart_total_unique_users: /* {"app": "dbt", "dbt_version": "1.8.2", "profile_name": "my_dbt_trino_project", "target_name": "dev", "node_id": "model.my_dbt_trino_project.mart_total_unique_users"} */

    drop table if exists "datalake"."analytics"."mart_total_unique_users__dbt_backup"
[0m16:03:02.577575 [debug] [Thread-1 (]: SQL status: SUCCESS in 0.0 seconds
[0m16:03:02.577575 [debug] [Thread-1 (]: On model.my_dbt_trino_project.mart_total_unique_users: ROLLBACK
[0m16:03:02.577575 [debug] [Thread-1 (]: On model.my_dbt_trino_project.mart_total_unique_users: Close
[0m16:03:02.577575 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '536373b5-260c-4091-abc1-9dc095bf72ea', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x0000026C6B126AD0>]}
[0m16:03:02.577575 [info ] [Thread-1 (]: 13 of 15 OK created sql table model analytics.mart_total_unique_users .......... [[32mSUCCESS[0m in 0.66s]
[0m16:03:02.577575 [debug] [Thread-1 (]: Finished running node model.my_dbt_trino_project.mart_total_unique_users
[0m16:03:02.577575 [debug] [Thread-1 (]: Began running node model.my_dbt_trino_project.mart_user_activity_per_country
[0m16:03:02.577575 [info ] [Thread-1 (]: 14 of 15 SKIP relation analytics.mart_user_activity_per_country ................ [[33mSKIP[0m]
[0m16:03:02.577575 [debug] [Thread-1 (]: Finished running node model.my_dbt_trino_project.mart_user_activity_per_country
[0m16:03:02.577575 [debug] [Thread-1 (]: Began running node model.my_dbt_trino_project.mart_user_activity_per_state
[0m16:03:02.577575 [info ] [Thread-1 (]: 15 of 15 START sql table model analytics.mart_user_activity_per_state .......... [RUN]
[0m16:03:02.577575 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.my_dbt_trino_project.mart_total_unique_users, now model.my_dbt_trino_project.mart_user_activity_per_state)
[0m16:03:02.577575 [debug] [Thread-1 (]: Began compiling node model.my_dbt_trino_project.mart_user_activity_per_state
[0m16:03:02.577575 [debug] [Thread-1 (]: Writing injected SQL for node "model.my_dbt_trino_project.mart_user_activity_per_state"
[0m16:03:02.587968 [debug] [Thread-1 (]: Began executing node model.my_dbt_trino_project.mart_user_activity_per_state
[0m16:03:02.590285 [debug] [Thread-1 (]: Writing runtime sql for node "model.my_dbt_trino_project.mart_user_activity_per_state"
[0m16:03:02.592695 [debug] [Thread-1 (]: Using trino connection "model.my_dbt_trino_project.mart_user_activity_per_state"
[0m16:03:02.592695 [debug] [Thread-1 (]: On model.my_dbt_trino_project.mart_user_activity_per_state: /* {"app": "dbt", "dbt_version": "1.8.2", "profile_name": "my_dbt_trino_project", "target_name": "dev", "node_id": "model.my_dbt_trino_project.mart_user_activity_per_state"} */

  
    

    create table "datalake"."analytics"."mart_user_activity_per_state__dbt_tmp"
      
      
    as (
      

SELECT
  state,
  city,
  SUM(activity_count) AS total_activity
FROM "datalake"."analytics_stage"."stg_user_activity_per_location"
GROUP BY state, city
ORDER BY state, SUM(activity_count) DESC
    )
[0m16:03:02.593694 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m16:03:02.941781 [debug] [Thread-1 (]: SQL status: SUCCESS in 0.0 seconds
[0m16:03:02.941781 [debug] [Thread-1 (]: Using trino connection "model.my_dbt_trino_project.mart_user_activity_per_state"
[0m16:03:02.941781 [debug] [Thread-1 (]: On model.my_dbt_trino_project.mart_user_activity_per_state: /* {"app": "dbt", "dbt_version": "1.8.2", "profile_name": "my_dbt_trino_project", "target_name": "dev", "node_id": "model.my_dbt_trino_project.mart_user_activity_per_state"} */
alter table "datalake"."analytics"."mart_user_activity_per_state" rename to "datalake"."analytics"."mart_user_activity_per_state__dbt_backup"
[0m16:03:03.037389 [debug] [Thread-1 (]: SQL status: SUCCESS in 0.0 seconds
[0m16:03:03.042804 [debug] [Thread-1 (]: Using trino connection "model.my_dbt_trino_project.mart_user_activity_per_state"
[0m16:03:03.042804 [debug] [Thread-1 (]: On model.my_dbt_trino_project.mart_user_activity_per_state: /* {"app": "dbt", "dbt_version": "1.8.2", "profile_name": "my_dbt_trino_project", "target_name": "dev", "node_id": "model.my_dbt_trino_project.mart_user_activity_per_state"} */
alter table "datalake"."analytics"."mart_user_activity_per_state__dbt_tmp" rename to "datalake"."analytics"."mart_user_activity_per_state"
[0m16:03:03.130150 [debug] [Thread-1 (]: SQL status: SUCCESS in 0.0 seconds
[0m16:03:03.133417 [debug] [Thread-1 (]: Applying DROP to: "datalake"."analytics"."mart_user_activity_per_state__dbt_backup"
[0m16:03:03.133417 [debug] [Thread-1 (]: Using trino connection "model.my_dbt_trino_project.mart_user_activity_per_state"
[0m16:03:03.133417 [debug] [Thread-1 (]: On model.my_dbt_trino_project.mart_user_activity_per_state: /* {"app": "dbt", "dbt_version": "1.8.2", "profile_name": "my_dbt_trino_project", "target_name": "dev", "node_id": "model.my_dbt_trino_project.mart_user_activity_per_state"} */

    drop table if exists "datalake"."analytics"."mart_user_activity_per_state__dbt_backup"
[0m16:03:03.259239 [debug] [Thread-1 (]: SQL status: SUCCESS in 0.0 seconds
[0m16:03:03.260251 [debug] [Thread-1 (]: On model.my_dbt_trino_project.mart_user_activity_per_state: ROLLBACK
[0m16:03:03.260251 [debug] [Thread-1 (]: On model.my_dbt_trino_project.mart_user_activity_per_state: Close
[0m16:03:03.260251 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '536373b5-260c-4091-abc1-9dc095bf72ea', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x0000026C68C33E10>]}
[0m16:03:03.262814 [info ] [Thread-1 (]: 15 of 15 OK created sql table model analytics.mart_user_activity_per_state ..... [[32mSUCCESS[0m in 0.68s]
[0m16:03:03.262814 [debug] [Thread-1 (]: Finished running node model.my_dbt_trino_project.mart_user_activity_per_state
[0m16:03:03.264560 [debug] [MainThread]: On master: COMMIT
[0m16:03:03.264560 [debug] [MainThread]: Connection 'master' was properly closed.
[0m16:03:03.264560 [debug] [MainThread]: Connection 'list_datalake' was properly closed.
[0m16:03:03.264560 [debug] [MainThread]: Connection 'list_datalake_analytics_stage' was properly closed.
[0m16:03:03.265727 [debug] [MainThread]: Connection 'model.my_dbt_trino_project.mart_user_activity_per_state' was properly closed.
[0m16:03:03.266233 [info ] [MainThread]: 
[0m16:03:03.266233 [info ] [MainThread]: Finished running 3 incremental models, 6 view models, 6 table models in 0 hours 0 minutes and 8.00 seconds (8.00s).
[0m16:03:03.267369 [debug] [MainThread]: Command end result
[0m16:03:03.298811 [info ] [MainThread]: 
[0m16:03:03.299820 [info ] [MainThread]: [31mCompleted with 1 error and 0 warnings:[0m
[0m16:03:03.299820 [info ] [MainThread]: 
[0m16:03:03.300822 [error] [MainThread]:   Database Error in model stg_user_activity_per_country (models\stage\stg_user_activity_per_country.sql)
  TrinoUserError(type=USER_ERROR, name=TYPE_MISMATCH, message="line 17:3: UNION query has different number of fields: 4, 3", query_id=20240617_080259_00067_xsftb)
  compiled Code at target\run\my_dbt_trino_project\models\stage\stg_user_activity_per_country.sql
[0m16:03:03.302021 [info ] [MainThread]: 
[0m16:03:03.302021 [info ] [MainThread]: Done. PASS=13 WARN=0 ERROR=1 SKIP=1 TOTAL=15
[0m16:03:03.302021 [debug] [MainThread]: Command `dbt run` failed at 16:03:03.302021 after 8.85 seconds
[0m16:03:03.302021 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x0000026C698922D0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x0000026C64ABE8D0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x0000026C64ABF910>]}
[0m16:03:03.302021 [debug] [MainThread]: Flushing usage events
[0m16:11:45.969761 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000002214ACB70D0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000002214A9BB5D0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000002214AC76810>]}


============================== 16:11:45.973125 | 274c9ecc-d069-4370-a20b-011cfe485d2d ==============================
[0m16:11:45.973125 [info ] [MainThread]: Running with dbt=1.8.2
[0m16:11:45.974177 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'indirect_selection': 'eager', 'log_cache_events': 'False', 'write_json': 'True', 'partial_parse': 'True', 'cache_selected_only': 'False', 'warn_error': 'None', 'version_check': 'True', 'fail_fast': 'False', 'log_path': 'C:\\Users\\ASUS\\Desktop\\work\\Iceberg-Dbt-Trino-Hive-modern-open-source-data-stack-main\\dbt\\logs', 'debug': 'False', 'profiles_dir': 'C:\\Users\\ASUS\\Desktop\\work\\Iceberg-Dbt-Trino-Hive-modern-open-source-data-stack-main\\dbt', 'use_colors': 'True', 'use_experimental_parser': 'False', 'no_print': 'None', 'quiet': 'False', 'log_format': 'default', 'invocation_command': 'dbt run', 'introspect': 'True', 'static_parser': 'True', 'target_path': 'None', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'send_anonymous_usage_stats': 'True'}
[0m16:11:46.330729 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': '274c9ecc-d069-4370-a20b-011cfe485d2d', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000002214B02B7D0>]}
[0m16:11:46.364376 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': '274c9ecc-d069-4370-a20b-011cfe485d2d', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x0000022147E05890>]}
[0m16:11:46.364376 [info ] [MainThread]: Registered adapter: trino=1.8.0
[0m16:11:46.379737 [debug] [MainThread]: checksum: f0a141b9de567cb7f131613ba2682f40b3a1c6a157f81c6e5435862eff68f109, vars: {}, profile: , target: , version: 1.8.2
[0m16:11:46.533143 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 1 files changed.
[0m16:11:46.533143 [debug] [MainThread]: Partial parsing: updated file: my_dbt_trino_project://models\stage\stg_streams_hourly.sql
[0m16:11:46.722826 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': '274c9ecc-d069-4370-a20b-011cfe485d2d', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000002214B133C50>]}
[0m16:11:46.786713 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': '274c9ecc-d069-4370-a20b-011cfe485d2d', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000002214B0E9550>]}
[0m16:11:46.786713 [info ] [MainThread]: Found 15 models, 7 data tests, 3 sources, 559 macros
[0m16:11:46.786713 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '274c9ecc-d069-4370-a20b-011cfe485d2d', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x0000022147E04ED0>]}
[0m16:11:46.786713 [info ] [MainThread]: 
[0m16:11:46.786713 [debug] [MainThread]: Acquiring new trino connection 'master'
[0m16:11:46.797556 [debug] [ThreadPool]: Acquiring new trino connection 'list_datalake'
[0m16:11:46.851957 [debug] [ThreadPool]: Using trino connection "list_datalake"
[0m16:11:46.852954 [debug] [ThreadPool]: On list_datalake: /* {"app": "dbt", "dbt_version": "1.8.2", "profile_name": "my_dbt_trino_project", "target_name": "dev", "connection_name": "list_datalake"} */

    select schema_name
    from "datalake".INFORMATION_SCHEMA.schemata
[0m16:11:46.852954 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m16:11:46.904834 [debug] [ThreadPool]: SQL status: SUCCESS in 0.0 seconds
[0m16:11:46.904834 [debug] [ThreadPool]: On list_datalake: Close
[0m16:11:46.910880 [debug] [ThreadPool]: Using trino connection "list_datalake"
[0m16:11:46.910880 [debug] [ThreadPool]: On list_datalake: /* {"app": "dbt", "dbt_version": "1.8.2", "profile_name": "my_dbt_trino_project", "target_name": "dev", "connection_name": "list_datalake"} */

    select schema_name
    from "datalake".INFORMATION_SCHEMA.schemata
[0m16:11:46.910880 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m16:11:46.951826 [debug] [ThreadPool]: SQL status: SUCCESS in 0.0 seconds
[0m16:11:46.951826 [debug] [ThreadPool]: On list_datalake: Close
[0m16:11:46.962142 [debug] [ThreadPool]: Using trino connection "list_datalake"
[0m16:11:46.962142 [debug] [ThreadPool]: On list_datalake: /* {"app": "dbt", "dbt_version": "1.8.2", "profile_name": "my_dbt_trino_project", "target_name": "dev", "connection_name": "list_datalake"} */

    select schema_name
    from "datalake".INFORMATION_SCHEMA.schemata
[0m16:11:46.962142 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m16:11:46.987855 [debug] [ThreadPool]: SQL status: SUCCESS in 0.0 seconds
[0m16:11:46.987855 [debug] [ThreadPool]: On list_datalake: Close
[0m16:11:46.992154 [debug] [ThreadPool]: Acquiring new trino connection 'list_datalake_analytics_stage'
[0m16:11:46.999767 [debug] [ThreadPool]: Using trino connection "list_datalake_analytics_stage"
[0m16:11:46.999767 [debug] [ThreadPool]: On list_datalake_analytics_stage: /* {"app": "dbt", "dbt_version": "1.8.2", "profile_name": "my_dbt_trino_project", "target_name": "dev", "connection_name": "list_datalake_analytics_stage"} */
select
      t.table_catalog as database,
      t.table_name as name,
      t.table_schema as schema,
      case when mv.name is not null then 'materialized_view'
           when t.table_type = 'BASE TABLE' then 'table'
           when t.table_type = 'VIEW' then 'view'
           else t.table_type
      end as table_type
    from "datalake".INFORMATION_SCHEMA.tables t
    left join (
            select * from system.metadata.materialized_views
            where catalog_name = 'datalake'
              and schema_name = 'analytics_stage') mv
          on mv.catalog_name = t.table_catalog and mv.schema_name = t.table_schema and mv.name = t.table_name
    where t.table_schema = 'analytics_stage'
[0m16:11:46.999767 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m16:11:47.064059 [debug] [ThreadPool]: SQL status: SUCCESS in 0.0 seconds
[0m16:11:47.064059 [debug] [ThreadPool]: On list_datalake_analytics_stage: ROLLBACK
[0m16:11:47.064059 [debug] [ThreadPool]: On list_datalake_analytics_stage: Close
[0m16:11:47.064059 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_datalake_analytics_stage, now list_datalake_analytics)
[0m16:11:47.071842 [debug] [ThreadPool]: Using trino connection "list_datalake_analytics"
[0m16:11:47.071842 [debug] [ThreadPool]: On list_datalake_analytics: /* {"app": "dbt", "dbt_version": "1.8.2", "profile_name": "my_dbt_trino_project", "target_name": "dev", "connection_name": "list_datalake_analytics"} */
select
      t.table_catalog as database,
      t.table_name as name,
      t.table_schema as schema,
      case when mv.name is not null then 'materialized_view'
           when t.table_type = 'BASE TABLE' then 'table'
           when t.table_type = 'VIEW' then 'view'
           else t.table_type
      end as table_type
    from "datalake".INFORMATION_SCHEMA.tables t
    left join (
            select * from system.metadata.materialized_views
            where catalog_name = 'datalake'
              and schema_name = 'analytics') mv
          on mv.catalog_name = t.table_catalog and mv.schema_name = t.table_schema and mv.name = t.table_name
    where t.table_schema = 'analytics'
[0m16:11:47.071842 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m16:11:47.128735 [debug] [ThreadPool]: SQL status: SUCCESS in 0.0 seconds
[0m16:11:47.128735 [debug] [ThreadPool]: On list_datalake_analytics: ROLLBACK
[0m16:11:47.128735 [debug] [ThreadPool]: On list_datalake_analytics: Close
[0m16:11:47.128735 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_datalake_analytics, now list_datalake_analytics_source)
[0m16:11:47.136294 [debug] [ThreadPool]: Using trino connection "list_datalake_analytics_source"
[0m16:11:47.136899 [debug] [ThreadPool]: On list_datalake_analytics_source: /* {"app": "dbt", "dbt_version": "1.8.2", "profile_name": "my_dbt_trino_project", "target_name": "dev", "connection_name": "list_datalake_analytics_source"} */
select
      t.table_catalog as database,
      t.table_name as name,
      t.table_schema as schema,
      case when mv.name is not null then 'materialized_view'
           when t.table_type = 'BASE TABLE' then 'table'
           when t.table_type = 'VIEW' then 'view'
           else t.table_type
      end as table_type
    from "datalake".INFORMATION_SCHEMA.tables t
    left join (
            select * from system.metadata.materialized_views
            where catalog_name = 'datalake'
              and schema_name = 'analytics_source') mv
          on mv.catalog_name = t.table_catalog and mv.schema_name = t.table_schema and mv.name = t.table_name
    where t.table_schema = 'analytics_source'
[0m16:11:47.136899 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m16:11:47.205295 [debug] [ThreadPool]: SQL status: SUCCESS in 0.0 seconds
[0m16:11:47.205295 [debug] [ThreadPool]: On list_datalake_analytics_source: ROLLBACK
[0m16:11:47.205295 [debug] [ThreadPool]: On list_datalake_analytics_source: Close
[0m16:11:47.210403 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '274c9ecc-d069-4370-a20b-011cfe485d2d', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x00000221483D2E50>]}
[0m16:11:47.210403 [debug] [MainThread]: On master: COMMIT
[0m16:11:47.210403 [info ] [MainThread]: Concurrency: 1 threads (target='dev')
[0m16:11:47.211910 [info ] [MainThread]: 
[0m16:11:47.215158 [debug] [Thread-1 (]: Began running node model.my_dbt_trino_project.src_auth_events
[0m16:11:47.215662 [info ] [Thread-1 (]: 1 of 15 START sql incremental model analytics_source.src_auth_events ........... [RUN]
[0m16:11:47.216322 [debug] [Thread-1 (]: Acquiring new trino connection 'model.my_dbt_trino_project.src_auth_events'
[0m16:11:47.217329 [debug] [Thread-1 (]: Began compiling node model.my_dbt_trino_project.src_auth_events
[0m16:11:47.222266 [debug] [Thread-1 (]: Writing injected SQL for node "model.my_dbt_trino_project.src_auth_events"
[0m16:11:47.222266 [debug] [Thread-1 (]: Began executing node model.my_dbt_trino_project.src_auth_events
[0m16:11:47.275862 [debug] [Thread-1 (]: Using trino connection "model.my_dbt_trino_project.src_auth_events"
[0m16:11:47.276759 [debug] [Thread-1 (]: On model.my_dbt_trino_project.src_auth_events: /* {"app": "dbt", "dbt_version": "1.8.2", "profile_name": "my_dbt_trino_project", "target_name": "dev", "node_id": "model.my_dbt_trino_project.src_auth_events"} */

  
    

    create table "datalake"."analytics_source"."src_auth_events__dbt_tmp"
      
      
    as (
      

with source as (
    select
        CAST(ts AS VARCHAR) as id, 
        ts,
        CAST(sessionId AS VARCHAR) as sessionId,
        level,
        itemInSession,
        city,
        zip,
        state,
        userAgent,
        CAST(NULLIF(lon, '') AS double) as lon,
        CAST(NULLIF(lat, '') AS double) as lat,
        CAST(FLOOR(CAST(NULLIF(userId, '') AS DOUBLE)) AS INT) as userId, 
        lastName,
        firstName,
        gender,
        CAST(FLOOR(CAST(NULLIF(registration, '') AS DOUBLE)) AS BIGINT) as registration,
        success
    from "oltp"."public"."auth_events"
)

select
    id,
    ts,
    sessionId,
    level,
    itemInSession,
    city,
    zip,
    state,
    userAgent,
    lon,
    lat,
    userId,
    lastName,
    firstName,
    gender,
    registration, 
    CASE 
        WHEN CAST(success AS VARCHAR) = 't' THEN true 
        WHEN CAST(success AS VARCHAR) = 'f' THEN false
        ELSE NULL 
    END AS success_boolean
from source


    where ts > (select max(ts) from "datalake"."analytics_source"."src_auth_events")

    )
[0m16:11:47.276759 [debug] [Thread-1 (]: Opening a new connection, currently in state init
[0m16:11:47.514540 [debug] [Thread-1 (]: SQL status: SUCCESS in 0.0 seconds
[0m16:11:47.523023 [debug] [Thread-1 (]: Using trino connection "model.my_dbt_trino_project.src_auth_events"
[0m16:11:47.523547 [debug] [Thread-1 (]: On model.my_dbt_trino_project.src_auth_events: /* {"app": "dbt", "dbt_version": "1.8.2", "profile_name": "my_dbt_trino_project", "target_name": "dev", "node_id": "model.my_dbt_trino_project.src_auth_events"} */

    describe "datalake"."analytics_source"."src_auth_events__dbt_tmp"
[0m16:11:47.623057 [debug] [Thread-1 (]: SQL status: SUCCESS in 0.0 seconds
[0m16:11:47.628778 [debug] [Thread-1 (]: Using trino connection "model.my_dbt_trino_project.src_auth_events"
[0m16:11:47.630668 [debug] [Thread-1 (]: On model.my_dbt_trino_project.src_auth_events: /* {"app": "dbt", "dbt_version": "1.8.2", "profile_name": "my_dbt_trino_project", "target_name": "dev", "node_id": "model.my_dbt_trino_project.src_auth_events"} */

    describe "datalake"."analytics_source"."src_auth_events"
[0m16:11:47.731718 [debug] [Thread-1 (]: SQL status: SUCCESS in 0.0 seconds
[0m16:11:47.786486 [debug] [Thread-1 (]: Using trino connection "model.my_dbt_trino_project.src_auth_events"
[0m16:11:47.786486 [debug] [Thread-1 (]: On model.my_dbt_trino_project.src_auth_events: /* {"app": "dbt", "dbt_version": "1.8.2", "profile_name": "my_dbt_trino_project", "target_name": "dev", "node_id": "model.my_dbt_trino_project.src_auth_events"} */

    describe "datalake"."analytics_source"."src_auth_events"
[0m16:11:47.889660 [debug] [Thread-1 (]: SQL status: SUCCESS in 0.0 seconds
[0m16:11:47.896494 [debug] [Thread-1 (]: Writing runtime sql for node "model.my_dbt_trino_project.src_auth_events"
[0m16:11:47.901303 [debug] [Thread-1 (]: Using trino connection "model.my_dbt_trino_project.src_auth_events"
[0m16:11:47.901715 [debug] [Thread-1 (]: On model.my_dbt_trino_project.src_auth_events: /* {"app": "dbt", "dbt_version": "1.8.2", "profile_name": "my_dbt_trino_project", "target_name": "dev", "node_id": "model.my_dbt_trino_project.src_auth_events"} */
insert into "datalake"."analytics_source"."src_auth_events" ("id", "ts", "sessionid", "level", "iteminsession", "city", "zip", "state", "useragent", "lon", "lat", "userid", "lastname", "firstname", "gender", "registration", "success_boolean")
    (
        select "id", "ts", "sessionid", "level", "iteminsession", "city", "zip", "state", "useragent", "lon", "lat", "userid", "lastname", "firstname", "gender", "registration", "success_boolean"
        from "datalake"."analytics_source"."src_auth_events__dbt_tmp"
    )
[0m16:11:48.060291 [debug] [Thread-1 (]: SQL status: SUCCESS in 0.0 seconds
[0m16:11:48.066602 [debug] [Thread-1 (]: Applying DROP to: "datalake"."analytics_source"."src_auth_events__dbt_tmp"
[0m16:11:48.069221 [debug] [Thread-1 (]: Using trino connection "model.my_dbt_trino_project.src_auth_events"
[0m16:11:48.069221 [debug] [Thread-1 (]: On model.my_dbt_trino_project.src_auth_events: /* {"app": "dbt", "dbt_version": "1.8.2", "profile_name": "my_dbt_trino_project", "target_name": "dev", "node_id": "model.my_dbt_trino_project.src_auth_events"} */

    drop table if exists "datalake"."analytics_source"."src_auth_events__dbt_tmp"
[0m16:11:48.205546 [debug] [Thread-1 (]: SQL status: SUCCESS in 0.0 seconds
[0m16:11:48.224186 [debug] [Thread-1 (]: On model.my_dbt_trino_project.src_auth_events: ROLLBACK
[0m16:11:48.227292 [debug] [Thread-1 (]: On model.my_dbt_trino_project.src_auth_events: Close
[0m16:11:48.230528 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '274c9ecc-d069-4370-a20b-011cfe485d2d', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000002214C791490>]}
[0m16:11:48.230528 [info ] [Thread-1 (]: 1 of 15 OK created sql incremental model analytics_source.src_auth_events ...... [[32mSUCCESS[0m in 1.01s]
[0m16:11:48.230528 [debug] [Thread-1 (]: Finished running node model.my_dbt_trino_project.src_auth_events
[0m16:11:48.233536 [debug] [Thread-1 (]: Began running node model.my_dbt_trino_project.src_listen_events
[0m16:11:48.234057 [info ] [Thread-1 (]: 2 of 15 START sql incremental model analytics_source.src_listen_events ......... [RUN]
[0m16:11:48.235219 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.my_dbt_trino_project.src_auth_events, now model.my_dbt_trino_project.src_listen_events)
[0m16:11:48.236637 [debug] [Thread-1 (]: Began compiling node model.my_dbt_trino_project.src_listen_events
[0m16:11:48.241222 [debug] [Thread-1 (]: Writing injected SQL for node "model.my_dbt_trino_project.src_listen_events"
[0m16:11:48.241794 [debug] [Thread-1 (]: Began executing node model.my_dbt_trino_project.src_listen_events
[0m16:11:48.248870 [debug] [Thread-1 (]: Using trino connection "model.my_dbt_trino_project.src_listen_events"
[0m16:11:48.249398 [debug] [Thread-1 (]: On model.my_dbt_trino_project.src_listen_events: /* {"app": "dbt", "dbt_version": "1.8.2", "profile_name": "my_dbt_trino_project", "target_name": "dev", "node_id": "model.my_dbt_trino_project.src_listen_events"} */

  
    

    create table "datalake"."analytics_source"."src_listen_events__dbt_tmp"
      
      
    as (
      

with source as (

    select
        CAST(_id AS VARCHAR) as id,
        artist,
        song,
        CAST(NULLIF(duration, '') AS DOUBLE) as duration,
        ts,
        sessionid,
        auth,
        level,
        CAST(NULLIF(itemInSession, '') AS INTEGER) as itemInSession,
        city,
        zip,
        state,
        country,
        userAgent,
        CAST(NULLIF(lon, '') AS DOUBLE) as lon,
        CAST(NULLIF(lat, '') AS DOUBLE) as lat,
        CAST(CAST(NULLIF(userId, '') AS DOUBLE) AS INTEGER) as userId,
 -- Assurez-vous que userId peut aussi être converti de cette manière.
        lastName,
        firstName,
        gender,
        CAST(CAST(NULLIF(registration, '') AS DOUBLE) AS BIGINT) as registration
    from "website"."demo"."listen_events"

)

select * from source



    -- this filter will only be applied on an incremental run
    where ts > (select max(ts) from "datalake"."analytics_source"."src_listen_events")


    )
[0m16:11:48.249931 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m16:11:48.478576 [debug] [Thread-1 (]: SQL status: SUCCESS in 0.0 seconds
[0m16:11:48.485270 [debug] [Thread-1 (]: Using trino connection "model.my_dbt_trino_project.src_listen_events"
[0m16:11:48.485270 [debug] [Thread-1 (]: On model.my_dbt_trino_project.src_listen_events: /* {"app": "dbt", "dbt_version": "1.8.2", "profile_name": "my_dbt_trino_project", "target_name": "dev", "node_id": "model.my_dbt_trino_project.src_listen_events"} */

    describe "datalake"."analytics_source"."src_listen_events__dbt_tmp"
[0m16:11:48.598604 [debug] [Thread-1 (]: SQL status: SUCCESS in 0.0 seconds
[0m16:11:48.602854 [debug] [Thread-1 (]: Using trino connection "model.my_dbt_trino_project.src_listen_events"
[0m16:11:48.602854 [debug] [Thread-1 (]: On model.my_dbt_trino_project.src_listen_events: /* {"app": "dbt", "dbt_version": "1.8.2", "profile_name": "my_dbt_trino_project", "target_name": "dev", "node_id": "model.my_dbt_trino_project.src_listen_events"} */

    describe "datalake"."analytics_source"."src_listen_events"
[0m16:11:48.711076 [debug] [Thread-1 (]: SQL status: SUCCESS in 0.0 seconds
[0m16:11:48.715856 [debug] [Thread-1 (]: Using trino connection "model.my_dbt_trino_project.src_listen_events"
[0m16:11:48.715856 [debug] [Thread-1 (]: On model.my_dbt_trino_project.src_listen_events: /* {"app": "dbt", "dbt_version": "1.8.2", "profile_name": "my_dbt_trino_project", "target_name": "dev", "node_id": "model.my_dbt_trino_project.src_listen_events"} */

    describe "datalake"."analytics_source"."src_listen_events"
[0m16:11:48.833994 [debug] [Thread-1 (]: SQL status: SUCCESS in 0.0 seconds
[0m16:11:48.837235 [debug] [Thread-1 (]: Writing runtime sql for node "model.my_dbt_trino_project.src_listen_events"
[0m16:11:48.840544 [debug] [Thread-1 (]: Using trino connection "model.my_dbt_trino_project.src_listen_events"
[0m16:11:48.840544 [debug] [Thread-1 (]: On model.my_dbt_trino_project.src_listen_events: /* {"app": "dbt", "dbt_version": "1.8.2", "profile_name": "my_dbt_trino_project", "target_name": "dev", "node_id": "model.my_dbt_trino_project.src_listen_events"} */
insert into "datalake"."analytics_source"."src_listen_events" ("id", "artist", "song", "duration", "ts", "sessionid", "auth", "level", "iteminsession", "city", "zip", "state", "country", "useragent", "lon", "lat", "userid", "lastname", "firstname", "gender", "registration")
    (
        select "id", "artist", "song", "duration", "ts", "sessionid", "auth", "level", "iteminsession", "city", "zip", "state", "country", "useragent", "lon", "lat", "userid", "lastname", "firstname", "gender", "registration"
        from "datalake"."analytics_source"."src_listen_events__dbt_tmp"
    )
[0m16:11:49.002575 [debug] [Thread-1 (]: SQL status: SUCCESS in 0.0 seconds
[0m16:11:49.003758 [debug] [Thread-1 (]: Applying DROP to: "datalake"."analytics_source"."src_listen_events__dbt_tmp"
[0m16:11:49.007146 [debug] [Thread-1 (]: Using trino connection "model.my_dbt_trino_project.src_listen_events"
[0m16:11:49.007146 [debug] [Thread-1 (]: On model.my_dbt_trino_project.src_listen_events: /* {"app": "dbt", "dbt_version": "1.8.2", "profile_name": "my_dbt_trino_project", "target_name": "dev", "node_id": "model.my_dbt_trino_project.src_listen_events"} */

    drop table if exists "datalake"."analytics_source"."src_listen_events__dbt_tmp"
[0m16:11:49.116253 [debug] [Thread-1 (]: SQL status: SUCCESS in 0.0 seconds
[0m16:11:49.116253 [debug] [Thread-1 (]: On model.my_dbt_trino_project.src_listen_events: ROLLBACK
[0m16:11:49.116253 [debug] [Thread-1 (]: On model.my_dbt_trino_project.src_listen_events: Close
[0m16:11:49.116253 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '274c9ecc-d069-4370-a20b-011cfe485d2d', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x0000022149A91810>]}
[0m16:11:49.116253 [info ] [Thread-1 (]: 2 of 15 OK created sql incremental model analytics_source.src_listen_events .... [[32mSUCCESS[0m in 0.88s]
[0m16:11:49.121716 [debug] [Thread-1 (]: Finished running node model.my_dbt_trino_project.src_listen_events
[0m16:11:49.122270 [debug] [Thread-1 (]: Began running node model.my_dbt_trino_project.src_page_view_events
[0m16:11:49.122321 [info ] [Thread-1 (]: 3 of 15 START sql incremental model analytics_source.src_page_view_events ...... [RUN]
[0m16:11:49.122321 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.my_dbt_trino_project.src_listen_events, now model.my_dbt_trino_project.src_page_view_events)
[0m16:11:49.122321 [debug] [Thread-1 (]: Began compiling node model.my_dbt_trino_project.src_page_view_events
[0m16:11:49.122321 [debug] [Thread-1 (]: Writing injected SQL for node "model.my_dbt_trino_project.src_page_view_events"
[0m16:11:49.122321 [debug] [Thread-1 (]: Began executing node model.my_dbt_trino_project.src_page_view_events
[0m16:11:49.128339 [debug] [Thread-1 (]: Using trino connection "model.my_dbt_trino_project.src_page_view_events"
[0m16:11:49.133904 [debug] [Thread-1 (]: On model.my_dbt_trino_project.src_page_view_events: /* {"app": "dbt", "dbt_version": "1.8.2", "profile_name": "my_dbt_trino_project", "target_name": "dev", "node_id": "model.my_dbt_trino_project.src_page_view_events"} */

  
    

    create table "datalake"."analytics_source"."src_page_view_events__dbt_tmp"
      
      
    as (
      

with source as (
    select
        CAST(_id AS VARCHAR) as id,
        ts,
        CAST(sessionId AS VARCHAR) as sessionId,
        page,
        auth,
        level,
        CAST(CAST(NULLIF(itemInSession, '') AS DOUBLE) AS INTEGER) as itemInSession, 
        city,
        zip,
        state,
        userAgent,
        CAST(NULLIF(lon, '') AS double) as lon,
        CAST(NULLIF(lat, '') AS double) as lat,
        CAST(CAST(NULLIF(userId, '') AS DOUBLE) AS INTEGER) as userId, 
        lastName,
        firstName,
        gender,
        CAST(CAST(NULLIF(registration, '') AS DOUBLE) AS BIGINT) as registration, 
        artist,
        song,
        CAST(NULLIF(duration, '') AS double) as duration
    from "website"."demo"."page_view_events"
)

select * from source


    where ts > (select max(ts) from "datalake"."analytics_source"."src_page_view_events")

    )
[0m16:11:49.134553 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m16:11:49.309165 [debug] [Thread-1 (]: SQL status: SUCCESS in 0.0 seconds
[0m16:11:49.311794 [debug] [Thread-1 (]: Using trino connection "model.my_dbt_trino_project.src_page_view_events"
[0m16:11:49.311794 [debug] [Thread-1 (]: On model.my_dbt_trino_project.src_page_view_events: /* {"app": "dbt", "dbt_version": "1.8.2", "profile_name": "my_dbt_trino_project", "target_name": "dev", "node_id": "model.my_dbt_trino_project.src_page_view_events"} */

    describe "datalake"."analytics_source"."src_page_view_events__dbt_tmp"
[0m16:11:49.408239 [debug] [Thread-1 (]: SQL status: SUCCESS in 0.0 seconds
[0m16:11:49.412201 [debug] [Thread-1 (]: Using trino connection "model.my_dbt_trino_project.src_page_view_events"
[0m16:11:49.413172 [debug] [Thread-1 (]: On model.my_dbt_trino_project.src_page_view_events: /* {"app": "dbt", "dbt_version": "1.8.2", "profile_name": "my_dbt_trino_project", "target_name": "dev", "node_id": "model.my_dbt_trino_project.src_page_view_events"} */

    describe "datalake"."analytics_source"."src_page_view_events"
[0m16:11:49.510748 [debug] [Thread-1 (]: SQL status: SUCCESS in 0.0 seconds
[0m16:11:49.513352 [debug] [Thread-1 (]: Using trino connection "model.my_dbt_trino_project.src_page_view_events"
[0m16:11:49.513352 [debug] [Thread-1 (]: On model.my_dbt_trino_project.src_page_view_events: /* {"app": "dbt", "dbt_version": "1.8.2", "profile_name": "my_dbt_trino_project", "target_name": "dev", "node_id": "model.my_dbt_trino_project.src_page_view_events"} */

    describe "datalake"."analytics_source"."src_page_view_events"
[0m16:11:49.619369 [debug] [Thread-1 (]: SQL status: SUCCESS in 0.0 seconds
[0m16:11:49.621196 [debug] [Thread-1 (]: Writing runtime sql for node "model.my_dbt_trino_project.src_page_view_events"
[0m16:11:49.623646 [debug] [Thread-1 (]: Using trino connection "model.my_dbt_trino_project.src_page_view_events"
[0m16:11:49.623646 [debug] [Thread-1 (]: On model.my_dbt_trino_project.src_page_view_events: /* {"app": "dbt", "dbt_version": "1.8.2", "profile_name": "my_dbt_trino_project", "target_name": "dev", "node_id": "model.my_dbt_trino_project.src_page_view_events"} */
insert into "datalake"."analytics_source"."src_page_view_events" ("id", "ts", "sessionid", "page", "auth", "level", "iteminsession", "city", "zip", "state", "useragent", "lon", "lat", "userid", "lastname", "firstname", "gender", "registration", "artist", "song", "duration")
    (
        select "id", "ts", "sessionid", "page", "auth", "level", "iteminsession", "city", "zip", "state", "useragent", "lon", "lat", "userid", "lastname", "firstname", "gender", "registration", "artist", "song", "duration"
        from "datalake"."analytics_source"."src_page_view_events__dbt_tmp"
    )
[0m16:11:49.753777 [debug] [Thread-1 (]: SQL status: SUCCESS in 0.0 seconds
[0m16:11:49.757335 [debug] [Thread-1 (]: Applying DROP to: "datalake"."analytics_source"."src_page_view_events__dbt_tmp"
[0m16:11:49.757335 [debug] [Thread-1 (]: Using trino connection "model.my_dbt_trino_project.src_page_view_events"
[0m16:11:49.757335 [debug] [Thread-1 (]: On model.my_dbt_trino_project.src_page_view_events: /* {"app": "dbt", "dbt_version": "1.8.2", "profile_name": "my_dbt_trino_project", "target_name": "dev", "node_id": "model.my_dbt_trino_project.src_page_view_events"} */

    drop table if exists "datalake"."analytics_source"."src_page_view_events__dbt_tmp"
[0m16:11:49.868838 [debug] [Thread-1 (]: SQL status: SUCCESS in 0.0 seconds
[0m16:11:49.870422 [debug] [Thread-1 (]: On model.my_dbt_trino_project.src_page_view_events: ROLLBACK
[0m16:11:49.870422 [debug] [Thread-1 (]: On model.my_dbt_trino_project.src_page_view_events: Close
[0m16:11:49.870422 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '274c9ecc-d069-4370-a20b-011cfe485d2d', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000002214A91C210>]}
[0m16:11:49.873146 [info ] [Thread-1 (]: 3 of 15 OK created sql incremental model analytics_source.src_page_view_events . [[32mSUCCESS[0m in 0.75s]
[0m16:11:49.873963 [debug] [Thread-1 (]: Finished running node model.my_dbt_trino_project.src_page_view_events
[0m16:11:49.873963 [debug] [Thread-1 (]: Began running node model.my_dbt_trino_project.stg_user_level_by_gender
[0m16:11:49.873963 [info ] [Thread-1 (]: 4 of 15 START sql view model analytics_stage.stg_user_level_by_gender .......... [RUN]
[0m16:11:49.873963 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.my_dbt_trino_project.src_page_view_events, now model.my_dbt_trino_project.stg_user_level_by_gender)
[0m16:11:49.873963 [debug] [Thread-1 (]: Began compiling node model.my_dbt_trino_project.stg_user_level_by_gender
[0m16:11:49.876786 [debug] [Thread-1 (]: Writing injected SQL for node "model.my_dbt_trino_project.stg_user_level_by_gender"
[0m16:11:49.876786 [debug] [Thread-1 (]: Began executing node model.my_dbt_trino_project.stg_user_level_by_gender
[0m16:11:49.892847 [debug] [Thread-1 (]: Writing runtime sql for node "model.my_dbt_trino_project.stg_user_level_by_gender"
[0m16:11:49.892847 [debug] [Thread-1 (]: Using trino connection "model.my_dbt_trino_project.stg_user_level_by_gender"
[0m16:11:49.892847 [debug] [Thread-1 (]: On model.my_dbt_trino_project.stg_user_level_by_gender: /* {"app": "dbt", "dbt_version": "1.8.2", "profile_name": "my_dbt_trino_project", "target_name": "dev", "node_id": "model.my_dbt_trino_project.stg_user_level_by_gender"} */

  create or replace view
    "datalake"."analytics_stage"."stg_user_level_by_gender"
  security definer
  as
    

WITH user_subscriptions AS (
    SELECT
        gender,
        level, 
        COUNT(DISTINCT userId) AS user_count
    FROM "datalake"."analytics_source"."src_auth_events"
    WHERE gender IS NOT NULL AND level IS NOT NULL
    GROUP BY gender, level
)

SELECT
    gender,
    level,
    user_count
FROM user_subscriptions
  
[0m16:11:49.892847 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m16:11:49.953209 [debug] [Thread-1 (]: SQL status: SUCCESS in 0.0 seconds
[0m16:11:49.953209 [debug] [Thread-1 (]: On model.my_dbt_trino_project.stg_user_level_by_gender: ROLLBACK
[0m16:11:49.953209 [debug] [Thread-1 (]: On model.my_dbt_trino_project.stg_user_level_by_gender: Close
[0m16:11:49.953209 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '274c9ecc-d069-4370-a20b-011cfe485d2d', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000002214C9058D0>]}
[0m16:11:49.953209 [info ] [Thread-1 (]: 4 of 15 OK created sql view model analytics_stage.stg_user_level_by_gender ..... [[32mSUCCESS[0m in 0.08s]
[0m16:11:49.953209 [debug] [Thread-1 (]: Finished running node model.my_dbt_trino_project.stg_user_level_by_gender
[0m16:11:49.953209 [debug] [Thread-1 (]: Began running node model.my_dbt_trino_project.stg_streams_hourly
[0m16:11:49.962221 [info ] [Thread-1 (]: 5 of 15 START sql table model analytics_stage.stg_streams_hourly ............... [RUN]
[0m16:11:49.963213 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.my_dbt_trino_project.stg_user_level_by_gender, now model.my_dbt_trino_project.stg_streams_hourly)
[0m16:11:49.963213 [debug] [Thread-1 (]: Began compiling node model.my_dbt_trino_project.stg_streams_hourly
[0m16:11:49.968230 [debug] [Thread-1 (]: Writing injected SQL for node "model.my_dbt_trino_project.stg_streams_hourly"
[0m16:11:49.968230 [debug] [Thread-1 (]: Began executing node model.my_dbt_trino_project.stg_streams_hourly
[0m16:11:49.983216 [debug] [Thread-1 (]: Writing runtime sql for node "model.my_dbt_trino_project.stg_streams_hourly"
[0m16:11:49.985774 [debug] [Thread-1 (]: Using trino connection "model.my_dbt_trino_project.stg_streams_hourly"
[0m16:11:49.985774 [debug] [Thread-1 (]: On model.my_dbt_trino_project.stg_streams_hourly: /* {"app": "dbt", "dbt_version": "1.8.2", "profile_name": "my_dbt_trino_project", "target_name": "dev", "node_id": "model.my_dbt_trino_project.stg_streams_hourly"} */

  
    

    create table "datalake"."analytics_stage"."stg_streams_hourly__dbt_tmp"
      
      
    as (
      

SELECT
    DATE_FORMAT(FROM_UNIXTIME(ts), '%Y-%m-%d') AS stream_date, 
    DATE_FORMAT(FROM_UNIXTIME(ts), '%H') AS stream_hour,
    COUNT(*) AS total_streams
FROM "datalake"."analytics_source"."src_listen_events"
GROUP BY
    DATE_FORMAT(FROM_UNIXTIME(ts), '%Y-%m-%d'),
    DATE_FORMAT(FROM_UNIXTIME(ts), '%H')
    )
[0m16:11:49.986779 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m16:11:50.250091 [debug] [Thread-1 (]: SQL status: SUCCESS in 0.0 seconds
[0m16:11:50.250091 [debug] [Thread-1 (]: Using trino connection "model.my_dbt_trino_project.stg_streams_hourly"
[0m16:11:50.250091 [debug] [Thread-1 (]: On model.my_dbt_trino_project.stg_streams_hourly: /* {"app": "dbt", "dbt_version": "1.8.2", "profile_name": "my_dbt_trino_project", "target_name": "dev", "node_id": "model.my_dbt_trino_project.stg_streams_hourly"} */
alter view "datalake"."analytics_stage"."stg_streams_hourly" rename to "datalake"."analytics_stage"."stg_streams_hourly__dbt_backup"
[0m16:11:50.352580 [debug] [Thread-1 (]: SQL status: SUCCESS in 0.0 seconds
[0m16:11:50.352580 [debug] [Thread-1 (]: Using trino connection "model.my_dbt_trino_project.stg_streams_hourly"
[0m16:11:50.352580 [debug] [Thread-1 (]: On model.my_dbt_trino_project.stg_streams_hourly: /* {"app": "dbt", "dbt_version": "1.8.2", "profile_name": "my_dbt_trino_project", "target_name": "dev", "node_id": "model.my_dbt_trino_project.stg_streams_hourly"} */
alter table "datalake"."analytics_stage"."stg_streams_hourly__dbt_tmp" rename to "datalake"."analytics_stage"."stg_streams_hourly"
[0m16:11:50.448509 [debug] [Thread-1 (]: SQL status: SUCCESS in 0.0 seconds
[0m16:11:50.448509 [debug] [Thread-1 (]: Applying DROP to: "datalake"."analytics_stage"."stg_streams_hourly__dbt_backup"
[0m16:11:50.448509 [debug] [Thread-1 (]: Using trino connection "model.my_dbt_trino_project.stg_streams_hourly"
[0m16:11:50.448509 [debug] [Thread-1 (]: On model.my_dbt_trino_project.stg_streams_hourly: /* {"app": "dbt", "dbt_version": "1.8.2", "profile_name": "my_dbt_trino_project", "target_name": "dev", "node_id": "model.my_dbt_trino_project.stg_streams_hourly"} */

    drop view if exists "datalake"."analytics_stage"."stg_streams_hourly__dbt_backup"
[0m16:11:50.542197 [debug] [Thread-1 (]: SQL status: SUCCESS in 0.0 seconds
[0m16:11:50.542197 [debug] [Thread-1 (]: On model.my_dbt_trino_project.stg_streams_hourly: ROLLBACK
[0m16:11:50.542197 [debug] [Thread-1 (]: On model.my_dbt_trino_project.stg_streams_hourly: Close
[0m16:11:50.542197 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '274c9ecc-d069-4370-a20b-011cfe485d2d', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000002214AFD74D0>]}
[0m16:11:50.542197 [info ] [Thread-1 (]: 5 of 15 OK created sql table model analytics_stage.stg_streams_hourly .......... [[32mSUCCESS[0m in 0.58s]
[0m16:11:50.542197 [debug] [Thread-1 (]: Finished running node model.my_dbt_trino_project.stg_streams_hourly
[0m16:11:50.542197 [debug] [Thread-1 (]: Began running node model.my_dbt_trino_project.stg_top_songs_artists
[0m16:11:50.542197 [info ] [Thread-1 (]: 6 of 15 START sql view model analytics_stage.stg_top_songs_artists ............. [RUN]
[0m16:11:50.542197 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.my_dbt_trino_project.stg_streams_hourly, now model.my_dbt_trino_project.stg_top_songs_artists)
[0m16:11:50.542197 [debug] [Thread-1 (]: Began compiling node model.my_dbt_trino_project.stg_top_songs_artists
[0m16:11:50.548849 [debug] [Thread-1 (]: Writing injected SQL for node "model.my_dbt_trino_project.stg_top_songs_artists"
[0m16:11:50.548849 [debug] [Thread-1 (]: Began executing node model.my_dbt_trino_project.stg_top_songs_artists
[0m16:11:50.548849 [debug] [Thread-1 (]: Writing runtime sql for node "model.my_dbt_trino_project.stg_top_songs_artists"
[0m16:11:50.548849 [debug] [Thread-1 (]: Using trino connection "model.my_dbt_trino_project.stg_top_songs_artists"
[0m16:11:50.548849 [debug] [Thread-1 (]: On model.my_dbt_trino_project.stg_top_songs_artists: /* {"app": "dbt", "dbt_version": "1.8.2", "profile_name": "my_dbt_trino_project", "target_name": "dev", "node_id": "model.my_dbt_trino_project.stg_top_songs_artists"} */

  create or replace view
    "datalake"."analytics_stage"."stg_top_songs_artists"
  security definer
  as
    

WITH song_plays AS (
    SELECT
        artist,
        song,
        COUNT(*) AS play_count
    FROM "datalake"."analytics_source"."src_listen_events"
    GROUP BY artist, song
)

SELECT
    artist,
    song,
    play_count
FROM song_plays
ORDER BY play_count DESC
  
[0m16:11:50.557991 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m16:11:50.612053 [debug] [Thread-1 (]: SQL status: SUCCESS in 0.0 seconds
[0m16:11:50.614221 [debug] [Thread-1 (]: On model.my_dbt_trino_project.stg_top_songs_artists: ROLLBACK
[0m16:11:50.614757 [debug] [Thread-1 (]: On model.my_dbt_trino_project.stg_top_songs_artists: Close
[0m16:11:50.615295 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '274c9ecc-d069-4370-a20b-011cfe485d2d', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000002214C743610>]}
[0m16:11:50.615823 [info ] [Thread-1 (]: 6 of 15 OK created sql view model analytics_stage.stg_top_songs_artists ........ [[32mSUCCESS[0m in 0.07s]
[0m16:11:50.616899 [debug] [Thread-1 (]: Finished running node model.my_dbt_trino_project.stg_top_songs_artists
[0m16:11:50.617414 [debug] [Thread-1 (]: Began running node model.my_dbt_trino_project.stg_unique_users
[0m16:11:50.617935 [info ] [Thread-1 (]: 7 of 15 START sql view model analytics_stage.stg_unique_users .................. [RUN]
[0m16:11:50.618475 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.my_dbt_trino_project.stg_top_songs_artists, now model.my_dbt_trino_project.stg_unique_users)
[0m16:11:50.619010 [debug] [Thread-1 (]: Began compiling node model.my_dbt_trino_project.stg_unique_users
[0m16:11:50.619547 [debug] [Thread-1 (]: Writing injected SQL for node "model.my_dbt_trino_project.stg_unique_users"
[0m16:11:50.619547 [debug] [Thread-1 (]: Began executing node model.my_dbt_trino_project.stg_unique_users
[0m16:11:50.623020 [debug] [Thread-1 (]: Writing runtime sql for node "model.my_dbt_trino_project.stg_unique_users"
[0m16:11:50.623020 [debug] [Thread-1 (]: Using trino connection "model.my_dbt_trino_project.stg_unique_users"
[0m16:11:50.623020 [debug] [Thread-1 (]: On model.my_dbt_trino_project.stg_unique_users: /* {"app": "dbt", "dbt_version": "1.8.2", "profile_name": "my_dbt_trino_project", "target_name": "dev", "node_id": "model.my_dbt_trino_project.stg_unique_users"} */

  create or replace view
    "datalake"."analytics_stage"."stg_unique_users"
  security definer
  as
    

SELECT
    COUNT(DISTINCT userid) AS total_unique_users
FROM "datalake"."analytics_source"."src_listen_events"
WHERE userid IS NOT NULL
  
[0m16:11:50.626635 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m16:11:50.703915 [debug] [Thread-1 (]: SQL status: SUCCESS in 0.0 seconds
[0m16:11:50.706263 [debug] [Thread-1 (]: On model.my_dbt_trino_project.stg_unique_users: ROLLBACK
[0m16:11:50.706263 [debug] [Thread-1 (]: On model.my_dbt_trino_project.stg_unique_users: Close
[0m16:11:50.706263 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '274c9ecc-d069-4370-a20b-011cfe485d2d', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000002214C891590>]}
[0m16:11:50.706263 [info ] [Thread-1 (]: 7 of 15 OK created sql view model analytics_stage.stg_unique_users ............. [[32mSUCCESS[0m in 0.09s]
[0m16:11:50.706263 [debug] [Thread-1 (]: Finished running node model.my_dbt_trino_project.stg_unique_users
[0m16:11:50.706263 [debug] [Thread-1 (]: Began running node model.my_dbt_trino_project.stg_user_activity_per_country
[0m16:11:50.706263 [info ] [Thread-1 (]: 8 of 15 START sql view model analytics_stage.stg_user_activity_per_country ..... [RUN]
[0m16:11:50.706263 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.my_dbt_trino_project.stg_unique_users, now model.my_dbt_trino_project.stg_user_activity_per_country)
[0m16:11:50.706263 [debug] [Thread-1 (]: Began compiling node model.my_dbt_trino_project.stg_user_activity_per_country
[0m16:11:50.706263 [debug] [Thread-1 (]: Writing injected SQL for node "model.my_dbt_trino_project.stg_user_activity_per_country"
[0m16:11:50.716788 [debug] [Thread-1 (]: Began executing node model.my_dbt_trino_project.stg_user_activity_per_country
[0m16:11:50.719888 [debug] [Thread-1 (]: Writing runtime sql for node "model.my_dbt_trino_project.stg_user_activity_per_country"
[0m16:11:50.723176 [debug] [Thread-1 (]: Using trino connection "model.my_dbt_trino_project.stg_user_activity_per_country"
[0m16:11:50.723176 [debug] [Thread-1 (]: On model.my_dbt_trino_project.stg_user_activity_per_country: /* {"app": "dbt", "dbt_version": "1.8.2", "profile_name": "my_dbt_trino_project", "target_name": "dev", "node_id": "model.my_dbt_trino_project.stg_user_activity_per_country"} */

  create or replace view
    "datalake"."analytics_stage"."stg_user_activity_per_country"
  security definer
  as
    

WITH combined_activities AS (
  SELECT
    country,
    'listen_event' AS event_type,
    ts,
    userid
  FROM "datalake"."analytics_source"."src_listen_events"
  WHERE country IS NOT NULL
  UNION ALL
  SELECT
    'Unknown' AS country, 
    ts,
    userid
  FROM "datalake"."analytics_source"."src_auth_events"
  UNION ALL
  SELECT
    'Unknown' AS country, 
    'page_view_event' AS event_type,
    ts,
    userid
  FROM "datalake"."analytics_source"."src_page_view_events"
)

SELECT
  country,
  COUNT(*) AS activity_count
FROM combined_activities
GROUP BY country
  
[0m16:11:50.724224 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m16:11:50.775081 [debug] [Thread-1 (]: Trino adapter: Trino query id: 20240617_081150_00129_xsftb
[0m16:11:50.775081 [debug] [Thread-1 (]: Trino adapter: Trino error: TrinoUserError(type=USER_ERROR, name=TYPE_MISMATCH, message="line 17:3: UNION query has different number of fields: 4, 3", query_id=20240617_081150_00129_xsftb)
[0m16:11:50.775081 [debug] [Thread-1 (]: On model.my_dbt_trino_project.stg_user_activity_per_country: ROLLBACK
[0m16:11:50.775081 [debug] [Thread-1 (]: On model.my_dbt_trino_project.stg_user_activity_per_country: Close
[0m16:11:50.783873 [debug] [Thread-1 (]: Database Error in model stg_user_activity_per_country (models\stage\stg_user_activity_per_country.sql)
  TrinoUserError(type=USER_ERROR, name=TYPE_MISMATCH, message="line 17:3: UNION query has different number of fields: 4, 3", query_id=20240617_081150_00129_xsftb)
  compiled Code at target\run\my_dbt_trino_project\models\stage\stg_user_activity_per_country.sql
[0m16:11:50.783873 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '274c9ecc-d069-4370-a20b-011cfe485d2d', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x0000022146CBAD10>]}
[0m16:11:50.783873 [error] [Thread-1 (]: 8 of 15 ERROR creating sql view model analytics_stage.stg_user_activity_per_country  [[31mERROR[0m in 0.08s]
[0m16:11:50.783873 [debug] [Thread-1 (]: Finished running node model.my_dbt_trino_project.stg_user_activity_per_country
[0m16:11:50.783873 [debug] [Thread-1 (]: Began running node model.my_dbt_trino_project.stg_user_activity_per_location
[0m16:11:50.783873 [info ] [Thread-1 (]: 9 of 15 START sql view model analytics_stage.stg_user_activity_per_location .... [RUN]
[0m16:11:50.783873 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.my_dbt_trino_project.stg_user_activity_per_country, now model.my_dbt_trino_project.stg_user_activity_per_location)
[0m16:11:50.783873 [debug] [Thread-1 (]: Began compiling node model.my_dbt_trino_project.stg_user_activity_per_location
[0m16:11:50.783873 [debug] [Thread-1 (]: Writing injected SQL for node "model.my_dbt_trino_project.stg_user_activity_per_location"
[0m16:11:50.794707 [debug] [Thread-1 (]: Began executing node model.my_dbt_trino_project.stg_user_activity_per_location
[0m16:11:50.796730 [debug] [Thread-1 (]: Writing runtime sql for node "model.my_dbt_trino_project.stg_user_activity_per_location"
[0m16:11:50.798743 [debug] [Thread-1 (]: Using trino connection "model.my_dbt_trino_project.stg_user_activity_per_location"
[0m16:11:50.798743 [debug] [Thread-1 (]: On model.my_dbt_trino_project.stg_user_activity_per_location: /* {"app": "dbt", "dbt_version": "1.8.2", "profile_name": "my_dbt_trino_project", "target_name": "dev", "node_id": "model.my_dbt_trino_project.stg_user_activity_per_location"} */

  create or replace view
    "datalake"."analytics_stage"."stg_user_activity_per_location"
  security definer
  as
    

WITH combined_activities AS (
  SELECT
    city,
    state,
    'auth_event' AS event_type,
    ts,
    userid
 FROM "datalake"."analytics_source"."src_auth_events"
  UNION ALL
  SELECT
    city,
    state,
    'listen_event' AS event_type,
    ts,
    userid
  FROM "datalake"."analytics_source"."src_listen_events"
  UNION ALL
  SELECT
    city,
    state,
    'page_view_event' AS event_type,
    ts,
    userid
  FROM "datalake"."analytics_source"."src_page_view_events"
)

SELECT
  state,
  city,
  COUNT(*) AS activity_count
FROM combined_activities
GROUP BY state, city
  
[0m16:11:50.798743 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m16:11:50.878596 [debug] [Thread-1 (]: SQL status: SUCCESS in 0.0 seconds
[0m16:11:50.880105 [debug] [Thread-1 (]: On model.my_dbt_trino_project.stg_user_activity_per_location: ROLLBACK
[0m16:11:50.880105 [debug] [Thread-1 (]: On model.my_dbt_trino_project.stg_user_activity_per_location: Close
[0m16:11:50.880105 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '274c9ecc-d069-4370-a20b-011cfe485d2d', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000002214C92A010>]}
[0m16:11:50.880105 [info ] [Thread-1 (]: 9 of 15 OK created sql view model analytics_stage.stg_user_activity_per_location  [[32mSUCCESS[0m in 0.10s]
[0m16:11:50.882884 [debug] [Thread-1 (]: Finished running node model.my_dbt_trino_project.stg_user_activity_per_location
[0m16:11:50.883139 [debug] [Thread-1 (]: Began running node model.my_dbt_trino_project.mart_user_level_by_gender
[0m16:11:50.883679 [info ] [Thread-1 (]: 10 of 15 START sql table model analytics.mart_user_level_by_gender ............. [RUN]
[0m16:11:50.883679 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.my_dbt_trino_project.stg_user_activity_per_location, now model.my_dbt_trino_project.mart_user_level_by_gender)
[0m16:11:50.883679 [debug] [Thread-1 (]: Began compiling node model.my_dbt_trino_project.mart_user_level_by_gender
[0m16:11:50.883679 [debug] [Thread-1 (]: Writing injected SQL for node "model.my_dbt_trino_project.mart_user_level_by_gender"
[0m16:11:50.883679 [debug] [Thread-1 (]: Began executing node model.my_dbt_trino_project.mart_user_level_by_gender
[0m16:11:50.883679 [debug] [Thread-1 (]: Writing runtime sql for node "model.my_dbt_trino_project.mart_user_level_by_gender"
[0m16:11:50.894726 [debug] [Thread-1 (]: Using trino connection "model.my_dbt_trino_project.mart_user_level_by_gender"
[0m16:11:50.895719 [debug] [Thread-1 (]: On model.my_dbt_trino_project.mart_user_level_by_gender: /* {"app": "dbt", "dbt_version": "1.8.2", "profile_name": "my_dbt_trino_project", "target_name": "dev", "node_id": "model.my_dbt_trino_project.mart_user_level_by_gender"} */

  
    

    create table "datalake"."analytics"."mart_user_level_by_gender__dbt_tmp"
      
      
    as (
      

SELECT
    gender,
    level,
    SUM(user_count) AS total_users,
    ROUND(SUM(user_count) * 100.0 / SUM(SUM(user_count)) OVER (), 2) AS percentage_of_total_users
FROM "datalake"."analytics_stage"."stg_user_level_by_gender"
GROUP BY gender, level
    )
[0m16:11:50.895719 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m16:11:51.192895 [debug] [Thread-1 (]: SQL status: SUCCESS in 0.0 seconds
[0m16:11:51.192895 [debug] [Thread-1 (]: Using trino connection "model.my_dbt_trino_project.mart_user_level_by_gender"
[0m16:11:51.197348 [debug] [Thread-1 (]: On model.my_dbt_trino_project.mart_user_level_by_gender: /* {"app": "dbt", "dbt_version": "1.8.2", "profile_name": "my_dbt_trino_project", "target_name": "dev", "node_id": "model.my_dbt_trino_project.mart_user_level_by_gender"} */
alter table "datalake"."analytics"."mart_user_level_by_gender" rename to "datalake"."analytics"."mart_user_level_by_gender__dbt_backup"
[0m16:11:51.287956 [debug] [Thread-1 (]: SQL status: SUCCESS in 0.0 seconds
[0m16:11:51.287956 [debug] [Thread-1 (]: Using trino connection "model.my_dbt_trino_project.mart_user_level_by_gender"
[0m16:11:51.287956 [debug] [Thread-1 (]: On model.my_dbt_trino_project.mart_user_level_by_gender: /* {"app": "dbt", "dbt_version": "1.8.2", "profile_name": "my_dbt_trino_project", "target_name": "dev", "node_id": "model.my_dbt_trino_project.mart_user_level_by_gender"} */
alter table "datalake"."analytics"."mart_user_level_by_gender__dbt_tmp" rename to "datalake"."analytics"."mart_user_level_by_gender"
[0m16:11:51.365072 [debug] [Thread-1 (]: SQL status: SUCCESS in 0.0 seconds
[0m16:11:51.378947 [debug] [Thread-1 (]: Applying DROP to: "datalake"."analytics"."mart_user_level_by_gender__dbt_backup"
[0m16:11:51.378947 [debug] [Thread-1 (]: Using trino connection "model.my_dbt_trino_project.mart_user_level_by_gender"
[0m16:11:51.380011 [debug] [Thread-1 (]: On model.my_dbt_trino_project.mart_user_level_by_gender: /* {"app": "dbt", "dbt_version": "1.8.2", "profile_name": "my_dbt_trino_project", "target_name": "dev", "node_id": "model.my_dbt_trino_project.mart_user_level_by_gender"} */

    drop table if exists "datalake"."analytics"."mart_user_level_by_gender__dbt_backup"
[0m16:11:51.491763 [debug] [Thread-1 (]: SQL status: SUCCESS in 0.0 seconds
[0m16:11:51.491763 [debug] [Thread-1 (]: On model.my_dbt_trino_project.mart_user_level_by_gender: ROLLBACK
[0m16:11:51.491763 [debug] [Thread-1 (]: On model.my_dbt_trino_project.mart_user_level_by_gender: Close
[0m16:11:51.491763 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '274c9ecc-d069-4370-a20b-011cfe485d2d', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x0000022146CBAD10>]}
[0m16:11:51.491763 [info ] [Thread-1 (]: 10 of 15 OK created sql table model analytics.mart_user_level_by_gender ........ [[32mSUCCESS[0m in 0.61s]
[0m16:11:51.491763 [debug] [Thread-1 (]: Finished running node model.my_dbt_trino_project.mart_user_level_by_gender
[0m16:11:51.491763 [debug] [Thread-1 (]: Began running node model.my_dbt_trino_project.mart_hourly_stream_evolution
[0m16:11:51.491763 [info ] [Thread-1 (]: 11 of 15 START sql table model analytics.mart_hourly_stream_evolution .......... [RUN]
[0m16:11:51.491763 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.my_dbt_trino_project.mart_user_level_by_gender, now model.my_dbt_trino_project.mart_hourly_stream_evolution)
[0m16:11:51.491763 [debug] [Thread-1 (]: Began compiling node model.my_dbt_trino_project.mart_hourly_stream_evolution
[0m16:11:51.504666 [debug] [Thread-1 (]: Writing injected SQL for node "model.my_dbt_trino_project.mart_hourly_stream_evolution"
[0m16:11:51.504666 [debug] [Thread-1 (]: Began executing node model.my_dbt_trino_project.mart_hourly_stream_evolution
[0m16:11:51.508495 [debug] [Thread-1 (]: Writing runtime sql for node "model.my_dbt_trino_project.mart_hourly_stream_evolution"
[0m16:11:51.509516 [debug] [Thread-1 (]: Using trino connection "model.my_dbt_trino_project.mart_hourly_stream_evolution"
[0m16:11:51.509516 [debug] [Thread-1 (]: On model.my_dbt_trino_project.mart_hourly_stream_evolution: /* {"app": "dbt", "dbt_version": "1.8.2", "profile_name": "my_dbt_trino_project", "target_name": "dev", "node_id": "model.my_dbt_trino_project.mart_hourly_stream_evolution"} */

  
    

    create table "datalake"."analytics"."mart_hourly_stream_evolution__dbt_tmp"
      
      
    as (
      

SELECT
    stream_date,
    stream_hour,
    total_streams,
    SUM(total_streams) OVER (PARTITION BY stream_date ORDER BY stream_hour) AS cumulative_streams
FROM "datalake"."analytics_stage"."stg_streams_hourly"
ORDER BY
    stream_date,
    stream_hour
    )
[0m16:11:51.510513 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m16:11:51.753939 [debug] [Thread-1 (]: SQL status: SUCCESS in 0.0 seconds
[0m16:11:51.753939 [debug] [Thread-1 (]: Using trino connection "model.my_dbt_trino_project.mart_hourly_stream_evolution"
[0m16:11:51.753939 [debug] [Thread-1 (]: On model.my_dbt_trino_project.mart_hourly_stream_evolution: /* {"app": "dbt", "dbt_version": "1.8.2", "profile_name": "my_dbt_trino_project", "target_name": "dev", "node_id": "model.my_dbt_trino_project.mart_hourly_stream_evolution"} */
alter table "datalake"."analytics"."mart_hourly_stream_evolution" rename to "datalake"."analytics"."mart_hourly_stream_evolution__dbt_backup"
[0m16:11:51.848453 [debug] [Thread-1 (]: SQL status: SUCCESS in 0.0 seconds
[0m16:11:51.848453 [debug] [Thread-1 (]: Using trino connection "model.my_dbt_trino_project.mart_hourly_stream_evolution"
[0m16:11:51.848453 [debug] [Thread-1 (]: On model.my_dbt_trino_project.mart_hourly_stream_evolution: /* {"app": "dbt", "dbt_version": "1.8.2", "profile_name": "my_dbt_trino_project", "target_name": "dev", "node_id": "model.my_dbt_trino_project.mart_hourly_stream_evolution"} */
alter table "datalake"."analytics"."mart_hourly_stream_evolution__dbt_tmp" rename to "datalake"."analytics"."mart_hourly_stream_evolution"
[0m16:11:51.945597 [debug] [Thread-1 (]: SQL status: SUCCESS in 0.0 seconds
[0m16:11:51.952495 [debug] [Thread-1 (]: Applying DROP to: "datalake"."analytics"."mart_hourly_stream_evolution__dbt_backup"
[0m16:11:51.952495 [debug] [Thread-1 (]: Using trino connection "model.my_dbt_trino_project.mart_hourly_stream_evolution"
[0m16:11:51.952495 [debug] [Thread-1 (]: On model.my_dbt_trino_project.mart_hourly_stream_evolution: /* {"app": "dbt", "dbt_version": "1.8.2", "profile_name": "my_dbt_trino_project", "target_name": "dev", "node_id": "model.my_dbt_trino_project.mart_hourly_stream_evolution"} */

    drop table if exists "datalake"."analytics"."mart_hourly_stream_evolution__dbt_backup"
[0m16:11:52.084612 [debug] [Thread-1 (]: SQL status: SUCCESS in 0.0 seconds
[0m16:11:52.085121 [debug] [Thread-1 (]: On model.my_dbt_trino_project.mart_hourly_stream_evolution: ROLLBACK
[0m16:11:52.085121 [debug] [Thread-1 (]: On model.my_dbt_trino_project.mart_hourly_stream_evolution: Close
[0m16:11:52.085121 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '274c9ecc-d069-4370-a20b-011cfe485d2d', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000002214C8AA5D0>]}
[0m16:11:52.085121 [info ] [Thread-1 (]: 11 of 15 OK created sql table model analytics.mart_hourly_stream_evolution ..... [[32mSUCCESS[0m in 0.59s]
[0m16:11:52.089227 [debug] [Thread-1 (]: Finished running node model.my_dbt_trino_project.mart_hourly_stream_evolution
[0m16:11:52.089227 [debug] [Thread-1 (]: Began running node model.my_dbt_trino_project.mart_top_songs_artists
[0m16:11:52.089227 [info ] [Thread-1 (]: 12 of 15 START sql table model analytics.mart_top_songs_artists ................ [RUN]
[0m16:11:52.089227 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.my_dbt_trino_project.mart_hourly_stream_evolution, now model.my_dbt_trino_project.mart_top_songs_artists)
[0m16:11:52.091111 [debug] [Thread-1 (]: Began compiling node model.my_dbt_trino_project.mart_top_songs_artists
[0m16:11:52.091111 [debug] [Thread-1 (]: Writing injected SQL for node "model.my_dbt_trino_project.mart_top_songs_artists"
[0m16:11:52.091111 [debug] [Thread-1 (]: Began executing node model.my_dbt_trino_project.mart_top_songs_artists
[0m16:11:52.101630 [debug] [Thread-1 (]: Writing runtime sql for node "model.my_dbt_trino_project.mart_top_songs_artists"
[0m16:11:52.104137 [debug] [Thread-1 (]: Using trino connection "model.my_dbt_trino_project.mart_top_songs_artists"
[0m16:11:52.105143 [debug] [Thread-1 (]: On model.my_dbt_trino_project.mart_top_songs_artists: /* {"app": "dbt", "dbt_version": "1.8.2", "profile_name": "my_dbt_trino_project", "target_name": "dev", "node_id": "model.my_dbt_trino_project.mart_top_songs_artists"} */

  
    

    create table "datalake"."analytics"."mart_top_songs_artists__dbt_tmp"
      
      
    as (
      

WITH top_songs AS (
    SELECT
        artist,
        song,
        play_count
    FROM "datalake"."analytics_stage"."stg_top_songs_artists"
)

SELECT
    artist,
    song,
    play_count
FROM top_songs
    )
[0m16:11:52.105143 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m16:11:52.366612 [debug] [Thread-1 (]: SQL status: SUCCESS in 0.0 seconds
[0m16:11:52.368120 [debug] [Thread-1 (]: Using trino connection "model.my_dbt_trino_project.mart_top_songs_artists"
[0m16:11:52.368120 [debug] [Thread-1 (]: On model.my_dbt_trino_project.mart_top_songs_artists: /* {"app": "dbt", "dbt_version": "1.8.2", "profile_name": "my_dbt_trino_project", "target_name": "dev", "node_id": "model.my_dbt_trino_project.mart_top_songs_artists"} */
alter table "datalake"."analytics"."mart_top_songs_artists" rename to "datalake"."analytics"."mart_top_songs_artists__dbt_backup"
[0m16:11:52.452688 [debug] [Thread-1 (]: SQL status: SUCCESS in 0.0 seconds
[0m16:11:52.452688 [debug] [Thread-1 (]: Using trino connection "model.my_dbt_trino_project.mart_top_songs_artists"
[0m16:11:52.452688 [debug] [Thread-1 (]: On model.my_dbt_trino_project.mart_top_songs_artists: /* {"app": "dbt", "dbt_version": "1.8.2", "profile_name": "my_dbt_trino_project", "target_name": "dev", "node_id": "model.my_dbt_trino_project.mart_top_songs_artists"} */
alter table "datalake"."analytics"."mart_top_songs_artists__dbt_tmp" rename to "datalake"."analytics"."mart_top_songs_artists"
[0m16:11:52.552538 [debug] [Thread-1 (]: SQL status: SUCCESS in 0.0 seconds
[0m16:11:52.559044 [debug] [Thread-1 (]: Applying DROP to: "datalake"."analytics"."mart_top_songs_artists__dbt_backup"
[0m16:11:52.559044 [debug] [Thread-1 (]: Using trino connection "model.my_dbt_trino_project.mart_top_songs_artists"
[0m16:11:52.559044 [debug] [Thread-1 (]: On model.my_dbt_trino_project.mart_top_songs_artists: /* {"app": "dbt", "dbt_version": "1.8.2", "profile_name": "my_dbt_trino_project", "target_name": "dev", "node_id": "model.my_dbt_trino_project.mart_top_songs_artists"} */

    drop table if exists "datalake"."analytics"."mart_top_songs_artists__dbt_backup"
[0m16:11:52.687619 [debug] [Thread-1 (]: SQL status: SUCCESS in 0.0 seconds
[0m16:11:52.687619 [debug] [Thread-1 (]: On model.my_dbt_trino_project.mart_top_songs_artists: ROLLBACK
[0m16:11:52.687619 [debug] [Thread-1 (]: On model.my_dbt_trino_project.mart_top_songs_artists: Close
[0m16:11:52.687619 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '274c9ecc-d069-4370-a20b-011cfe485d2d', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x0000022146CBAD10>]}
[0m16:11:52.687619 [info ] [Thread-1 (]: 12 of 15 OK created sql table model analytics.mart_top_songs_artists ........... [[32mSUCCESS[0m in 0.60s]
[0m16:11:52.691221 [debug] [Thread-1 (]: Finished running node model.my_dbt_trino_project.mart_top_songs_artists
[0m16:11:52.691221 [debug] [Thread-1 (]: Began running node model.my_dbt_trino_project.mart_total_unique_users
[0m16:11:52.691221 [info ] [Thread-1 (]: 13 of 15 START sql table model analytics.mart_total_unique_users ............... [RUN]
[0m16:11:52.691221 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.my_dbt_trino_project.mart_top_songs_artists, now model.my_dbt_trino_project.mart_total_unique_users)
[0m16:11:52.691221 [debug] [Thread-1 (]: Began compiling node model.my_dbt_trino_project.mart_total_unique_users
[0m16:11:52.691221 [debug] [Thread-1 (]: Writing injected SQL for node "model.my_dbt_trino_project.mart_total_unique_users"
[0m16:11:52.691221 [debug] [Thread-1 (]: Began executing node model.my_dbt_trino_project.mart_total_unique_users
[0m16:11:52.697462 [debug] [Thread-1 (]: Writing runtime sql for node "model.my_dbt_trino_project.mart_total_unique_users"
[0m16:11:52.697462 [debug] [Thread-1 (]: Using trino connection "model.my_dbt_trino_project.mart_total_unique_users"
[0m16:11:52.697462 [debug] [Thread-1 (]: On model.my_dbt_trino_project.mart_total_unique_users: /* {"app": "dbt", "dbt_version": "1.8.2", "profile_name": "my_dbt_trino_project", "target_name": "dev", "node_id": "model.my_dbt_trino_project.mart_total_unique_users"} */

  
    

    create table "datalake"."analytics"."mart_total_unique_users__dbt_tmp"
      
      
    as (
      

SELECT
    total_unique_users
FROM "datalake"."analytics_stage"."stg_unique_users"
    )
[0m16:11:52.697462 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m16:11:52.949436 [debug] [Thread-1 (]: SQL status: SUCCESS in 0.0 seconds
[0m16:11:52.949436 [debug] [Thread-1 (]: Using trino connection "model.my_dbt_trino_project.mart_total_unique_users"
[0m16:11:52.949436 [debug] [Thread-1 (]: On model.my_dbt_trino_project.mart_total_unique_users: /* {"app": "dbt", "dbt_version": "1.8.2", "profile_name": "my_dbt_trino_project", "target_name": "dev", "node_id": "model.my_dbt_trino_project.mart_total_unique_users"} */
alter table "datalake"."analytics"."mart_total_unique_users" rename to "datalake"."analytics"."mart_total_unique_users__dbt_backup"
[0m16:11:53.045663 [debug] [Thread-1 (]: SQL status: SUCCESS in 0.0 seconds
[0m16:11:53.047181 [debug] [Thread-1 (]: Using trino connection "model.my_dbt_trino_project.mart_total_unique_users"
[0m16:11:53.047181 [debug] [Thread-1 (]: On model.my_dbt_trino_project.mart_total_unique_users: /* {"app": "dbt", "dbt_version": "1.8.2", "profile_name": "my_dbt_trino_project", "target_name": "dev", "node_id": "model.my_dbt_trino_project.mart_total_unique_users"} */
alter table "datalake"."analytics"."mart_total_unique_users__dbt_tmp" rename to "datalake"."analytics"."mart_total_unique_users"
[0m16:11:53.134009 [debug] [Thread-1 (]: SQL status: SUCCESS in 0.0 seconds
[0m16:11:53.134009 [debug] [Thread-1 (]: Applying DROP to: "datalake"."analytics"."mart_total_unique_users__dbt_backup"
[0m16:11:53.134009 [debug] [Thread-1 (]: Using trino connection "model.my_dbt_trino_project.mart_total_unique_users"
[0m16:11:53.134009 [debug] [Thread-1 (]: On model.my_dbt_trino_project.mart_total_unique_users: /* {"app": "dbt", "dbt_version": "1.8.2", "profile_name": "my_dbt_trino_project", "target_name": "dev", "node_id": "model.my_dbt_trino_project.mart_total_unique_users"} */

    drop table if exists "datalake"."analytics"."mart_total_unique_users__dbt_backup"
[0m16:11:53.272043 [debug] [Thread-1 (]: SQL status: SUCCESS in 0.0 seconds
[0m16:11:53.274149 [debug] [Thread-1 (]: On model.my_dbt_trino_project.mart_total_unique_users: ROLLBACK
[0m16:11:53.274671 [debug] [Thread-1 (]: On model.my_dbt_trino_project.mart_total_unique_users: Close
[0m16:11:53.275507 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '274c9ecc-d069-4370-a20b-011cfe485d2d', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000002214B156810>]}
[0m16:11:53.276202 [info ] [Thread-1 (]: 13 of 15 OK created sql table model analytics.mart_total_unique_users .......... [[32mSUCCESS[0m in 0.58s]
[0m16:11:53.276724 [debug] [Thread-1 (]: Finished running node model.my_dbt_trino_project.mart_total_unique_users
[0m16:11:53.277247 [debug] [Thread-1 (]: Began running node model.my_dbt_trino_project.mart_user_activity_per_country
[0m16:11:53.277764 [info ] [Thread-1 (]: 14 of 15 SKIP relation analytics.mart_user_activity_per_country ................ [[33mSKIP[0m]
[0m16:11:53.278287 [debug] [Thread-1 (]: Finished running node model.my_dbt_trino_project.mart_user_activity_per_country
[0m16:11:53.278809 [debug] [Thread-1 (]: Began running node model.my_dbt_trino_project.mart_user_activity_per_state
[0m16:11:53.279335 [info ] [Thread-1 (]: 15 of 15 START sql table model analytics.mart_user_activity_per_state .......... [RUN]
[0m16:11:53.279859 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.my_dbt_trino_project.mart_total_unique_users, now model.my_dbt_trino_project.mart_user_activity_per_state)
[0m16:11:53.280379 [debug] [Thread-1 (]: Began compiling node model.my_dbt_trino_project.mart_user_activity_per_state
[0m16:11:53.284209 [debug] [Thread-1 (]: Writing injected SQL for node "model.my_dbt_trino_project.mart_user_activity_per_state"
[0m16:11:53.286416 [debug] [Thread-1 (]: Began executing node model.my_dbt_trino_project.mart_user_activity_per_state
[0m16:11:53.288966 [debug] [Thread-1 (]: Writing runtime sql for node "model.my_dbt_trino_project.mart_user_activity_per_state"
[0m16:11:53.291249 [debug] [Thread-1 (]: Using trino connection "model.my_dbt_trino_project.mart_user_activity_per_state"
[0m16:11:53.291420 [debug] [Thread-1 (]: On model.my_dbt_trino_project.mart_user_activity_per_state: /* {"app": "dbt", "dbt_version": "1.8.2", "profile_name": "my_dbt_trino_project", "target_name": "dev", "node_id": "model.my_dbt_trino_project.mart_user_activity_per_state"} */

  
    

    create table "datalake"."analytics"."mart_user_activity_per_state__dbt_tmp"
      
      
    as (
      

SELECT
  state,
  city,
  SUM(activity_count) AS total_activity
FROM "datalake"."analytics_stage"."stg_user_activity_per_location"
GROUP BY state, city
ORDER BY state, SUM(activity_count) DESC
    )
[0m16:11:53.292058 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m16:11:53.581760 [debug] [Thread-1 (]: SQL status: SUCCESS in 0.0 seconds
[0m16:11:53.582935 [debug] [Thread-1 (]: Using trino connection "model.my_dbt_trino_project.mart_user_activity_per_state"
[0m16:11:53.582935 [debug] [Thread-1 (]: On model.my_dbt_trino_project.mart_user_activity_per_state: /* {"app": "dbt", "dbt_version": "1.8.2", "profile_name": "my_dbt_trino_project", "target_name": "dev", "node_id": "model.my_dbt_trino_project.mart_user_activity_per_state"} */
alter table "datalake"."analytics"."mart_user_activity_per_state" rename to "datalake"."analytics"."mart_user_activity_per_state__dbt_backup"
[0m16:11:53.684507 [debug] [Thread-1 (]: SQL status: SUCCESS in 0.0 seconds
[0m16:11:53.689283 [debug] [Thread-1 (]: Using trino connection "model.my_dbt_trino_project.mart_user_activity_per_state"
[0m16:11:53.689283 [debug] [Thread-1 (]: On model.my_dbt_trino_project.mart_user_activity_per_state: /* {"app": "dbt", "dbt_version": "1.8.2", "profile_name": "my_dbt_trino_project", "target_name": "dev", "node_id": "model.my_dbt_trino_project.mart_user_activity_per_state"} */
alter table "datalake"."analytics"."mart_user_activity_per_state__dbt_tmp" rename to "datalake"."analytics"."mart_user_activity_per_state"
[0m16:11:53.787218 [debug] [Thread-1 (]: SQL status: SUCCESS in 0.0 seconds
[0m16:11:53.787218 [debug] [Thread-1 (]: Applying DROP to: "datalake"."analytics"."mart_user_activity_per_state__dbt_backup"
[0m16:11:53.787218 [debug] [Thread-1 (]: Using trino connection "model.my_dbt_trino_project.mart_user_activity_per_state"
[0m16:11:53.787218 [debug] [Thread-1 (]: On model.my_dbt_trino_project.mart_user_activity_per_state: /* {"app": "dbt", "dbt_version": "1.8.2", "profile_name": "my_dbt_trino_project", "target_name": "dev", "node_id": "model.my_dbt_trino_project.mart_user_activity_per_state"} */

    drop table if exists "datalake"."analytics"."mart_user_activity_per_state__dbt_backup"
[0m16:11:53.909756 [debug] [Thread-1 (]: SQL status: SUCCESS in 0.0 seconds
[0m16:11:53.909756 [debug] [Thread-1 (]: On model.my_dbt_trino_project.mart_user_activity_per_state: ROLLBACK
[0m16:11:53.909756 [debug] [Thread-1 (]: On model.my_dbt_trino_project.mart_user_activity_per_state: Close
[0m16:11:53.909756 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '274c9ecc-d069-4370-a20b-011cfe485d2d', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000002214B34DE90>]}
[0m16:11:53.909756 [info ] [Thread-1 (]: 15 of 15 OK created sql table model analytics.mart_user_activity_per_state ..... [[32mSUCCESS[0m in 0.63s]
[0m16:11:53.909756 [debug] [Thread-1 (]: Finished running node model.my_dbt_trino_project.mart_user_activity_per_state
[0m16:11:53.909756 [debug] [MainThread]: On master: COMMIT
[0m16:11:53.909756 [debug] [MainThread]: Connection 'master' was properly closed.
[0m16:11:53.917253 [debug] [MainThread]: Connection 'list_datalake' was properly closed.
[0m16:11:53.917253 [debug] [MainThread]: Connection 'list_datalake_analytics_source' was properly closed.
[0m16:11:53.917760 [debug] [MainThread]: Connection 'model.my_dbt_trino_project.mart_user_activity_per_state' was properly closed.
[0m16:11:53.917760 [info ] [MainThread]: 
[0m16:11:53.918283 [info ] [MainThread]: Finished running 3 incremental models, 5 view models, 7 table models in 0 hours 0 minutes and 7.13 seconds (7.13s).
[0m16:11:53.920405 [debug] [MainThread]: Command end result
[0m16:11:53.950312 [info ] [MainThread]: 
[0m16:11:53.950312 [info ] [MainThread]: [31mCompleted with 1 error and 0 warnings:[0m
[0m16:11:53.955217 [info ] [MainThread]: 
[0m16:11:53.955217 [error] [MainThread]:   Database Error in model stg_user_activity_per_country (models\stage\stg_user_activity_per_country.sql)
  TrinoUserError(type=USER_ERROR, name=TYPE_MISMATCH, message="line 17:3: UNION query has different number of fields: 4, 3", query_id=20240617_081150_00129_xsftb)
  compiled Code at target\run\my_dbt_trino_project\models\stage\stg_user_activity_per_country.sql
[0m16:11:53.956323 [info ] [MainThread]: 
[0m16:11:53.956323 [info ] [MainThread]: Done. PASS=13 WARN=0 ERROR=1 SKIP=1 TOTAL=15
[0m16:11:53.957754 [debug] [MainThread]: Command `dbt run` failed at 16:11:53.957754 after 8.14 seconds
[0m16:11:53.959124 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x0000022145D7F490>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x0000022145D7E850>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x0000022145D7F910>]}
[0m16:11:53.959124 [debug] [MainThread]: Flushing usage events
[0m16:29:30.994641 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000001BC424C5BD0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000001BC42507550>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000001BC41EBDD10>]}


============================== 16:29:30.998578 | 2657ce0c-1a6e-435b-b73d-64436f55d2be ==============================
[0m16:29:30.998578 [info ] [MainThread]: Running with dbt=1.8.2
[0m16:29:30.999668 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'indirect_selection': 'eager', 'write_json': 'True', 'log_cache_events': 'False', 'partial_parse': 'True', 'cache_selected_only': 'False', 'profiles_dir': 'C:\\Users\\ASUS\\Desktop\\work\\Iceberg-Dbt-Trino-Hive-modern-open-source-data-stack-main\\dbt', 'debug': 'False', 'version_check': 'True', 'log_path': 'C:\\Users\\ASUS\\Desktop\\work\\Iceberg-Dbt-Trino-Hive-modern-open-source-data-stack-main\\dbt\\logs', 'warn_error': 'None', 'fail_fast': 'False', 'use_colors': 'True', 'use_experimental_parser': 'False', 'no_print': 'None', 'quiet': 'False', 'log_format': 'default', 'static_parser': 'True', 'invocation_command': 'dbt run', 'introspect': 'True', 'target_path': 'None', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'send_anonymous_usage_stats': 'True'}
[0m16:29:31.331971 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': '2657ce0c-1a6e-435b-b73d-64436f55d2be', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000001BC4252D250>]}
[0m16:29:31.382434 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': '2657ce0c-1a6e-435b-b73d-64436f55d2be', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000001BC3F645510>]}
[0m16:29:31.383482 [info ] [MainThread]: Registered adapter: trino=1.8.0
[0m16:29:31.394280 [debug] [MainThread]: checksum: f0a141b9de567cb7f131613ba2682f40b3a1c6a157f81c6e5435862eff68f109, vars: {}, profile: , target: , version: 1.8.2
[0m16:29:31.539226 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 0 files changed.
[0m16:29:31.539226 [debug] [MainThread]: Partial parsing enabled, no changes found, skipping parsing
[0m16:29:31.569252 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': '2657ce0c-1a6e-435b-b73d-64436f55d2be', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000001BC429417D0>]}
[0m16:29:31.650282 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': '2657ce0c-1a6e-435b-b73d-64436f55d2be', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000001BC42A03C50>]}
[0m16:29:31.650282 [info ] [MainThread]: Found 15 models, 7 data tests, 3 sources, 559 macros
[0m16:29:31.650282 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '2657ce0c-1a6e-435b-b73d-64436f55d2be', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000001BC42902390>]}
[0m16:29:31.653644 [info ] [MainThread]: 
[0m16:29:31.654148 [debug] [MainThread]: Acquiring new trino connection 'master'
[0m16:29:31.656401 [debug] [ThreadPool]: Acquiring new trino connection 'list_datalake'
[0m16:29:31.714688 [debug] [ThreadPool]: Using trino connection "list_datalake"
[0m16:29:31.714688 [debug] [ThreadPool]: On list_datalake: /* {"app": "dbt", "dbt_version": "1.8.2", "profile_name": "my_dbt_trino_project", "target_name": "dev", "connection_name": "list_datalake"} */

    select schema_name
    from "datalake".INFORMATION_SCHEMA.schemata
[0m16:29:31.715551 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m16:29:31.779630 [debug] [ThreadPool]: SQL status: SUCCESS in 0.0 seconds
[0m16:29:31.781639 [debug] [ThreadPool]: On list_datalake: Close
[0m16:29:31.784125 [debug] [ThreadPool]: Using trino connection "list_datalake"
[0m16:29:31.785638 [debug] [ThreadPool]: On list_datalake: /* {"app": "dbt", "dbt_version": "1.8.2", "profile_name": "my_dbt_trino_project", "target_name": "dev", "connection_name": "list_datalake"} */

    select schema_name
    from "datalake".INFORMATION_SCHEMA.schemata
[0m16:29:31.785638 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m16:29:31.845410 [debug] [ThreadPool]: SQL status: SUCCESS in 0.0 seconds
[0m16:29:31.845410 [debug] [ThreadPool]: On list_datalake: Close
[0m16:29:31.850084 [debug] [ThreadPool]: Using trino connection "list_datalake"
[0m16:29:31.851734 [debug] [ThreadPool]: On list_datalake: /* {"app": "dbt", "dbt_version": "1.8.2", "profile_name": "my_dbt_trino_project", "target_name": "dev", "connection_name": "list_datalake"} */

    select schema_name
    from "datalake".INFORMATION_SCHEMA.schemata
[0m16:29:31.851734 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m16:29:31.889281 [debug] [ThreadPool]: SQL status: SUCCESS in 0.0 seconds
[0m16:29:31.889281 [debug] [ThreadPool]: On list_datalake: Close
[0m16:29:31.894309 [debug] [ThreadPool]: Acquiring new trino connection 'list_datalake_analytics_source'
[0m16:29:31.901766 [debug] [ThreadPool]: Using trino connection "list_datalake_analytics_source"
[0m16:29:31.906786 [debug] [ThreadPool]: On list_datalake_analytics_source: /* {"app": "dbt", "dbt_version": "1.8.2", "profile_name": "my_dbt_trino_project", "target_name": "dev", "connection_name": "list_datalake_analytics_source"} */
select
      t.table_catalog as database,
      t.table_name as name,
      t.table_schema as schema,
      case when mv.name is not null then 'materialized_view'
           when t.table_type = 'BASE TABLE' then 'table'
           when t.table_type = 'VIEW' then 'view'
           else t.table_type
      end as table_type
    from "datalake".INFORMATION_SCHEMA.tables t
    left join (
            select * from system.metadata.materialized_views
            where catalog_name = 'datalake'
              and schema_name = 'analytics_source') mv
          on mv.catalog_name = t.table_catalog and mv.schema_name = t.table_schema and mv.name = t.table_name
    where t.table_schema = 'analytics_source'
[0m16:29:31.906786 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m16:29:32.089487 [debug] [ThreadPool]: SQL status: SUCCESS in 0.0 seconds
[0m16:29:32.091015 [debug] [ThreadPool]: On list_datalake_analytics_source: ROLLBACK
[0m16:29:32.091015 [debug] [ThreadPool]: On list_datalake_analytics_source: Close
[0m16:29:32.092532 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_datalake_analytics_source, now list_datalake_analytics)
[0m16:29:32.098606 [debug] [ThreadPool]: Using trino connection "list_datalake_analytics"
[0m16:29:32.098606 [debug] [ThreadPool]: On list_datalake_analytics: /* {"app": "dbt", "dbt_version": "1.8.2", "profile_name": "my_dbt_trino_project", "target_name": "dev", "connection_name": "list_datalake_analytics"} */
select
      t.table_catalog as database,
      t.table_name as name,
      t.table_schema as schema,
      case when mv.name is not null then 'materialized_view'
           when t.table_type = 'BASE TABLE' then 'table'
           when t.table_type = 'VIEW' then 'view'
           else t.table_type
      end as table_type
    from "datalake".INFORMATION_SCHEMA.tables t
    left join (
            select * from system.metadata.materialized_views
            where catalog_name = 'datalake'
              and schema_name = 'analytics') mv
          on mv.catalog_name = t.table_catalog and mv.schema_name = t.table_schema and mv.name = t.table_name
    where t.table_schema = 'analytics'
[0m16:29:32.098606 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m16:29:32.218509 [debug] [ThreadPool]: SQL status: SUCCESS in 0.0 seconds
[0m16:29:32.218509 [debug] [ThreadPool]: On list_datalake_analytics: ROLLBACK
[0m16:29:32.220473 [debug] [ThreadPool]: On list_datalake_analytics: Close
[0m16:29:32.222021 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_datalake_analytics, now list_datalake_analytics_stage)
[0m16:29:32.226409 [debug] [ThreadPool]: Using trino connection "list_datalake_analytics_stage"
[0m16:29:32.226916 [debug] [ThreadPool]: On list_datalake_analytics_stage: /* {"app": "dbt", "dbt_version": "1.8.2", "profile_name": "my_dbt_trino_project", "target_name": "dev", "connection_name": "list_datalake_analytics_stage"} */
select
      t.table_catalog as database,
      t.table_name as name,
      t.table_schema as schema,
      case when mv.name is not null then 'materialized_view'
           when t.table_type = 'BASE TABLE' then 'table'
           when t.table_type = 'VIEW' then 'view'
           else t.table_type
      end as table_type
    from "datalake".INFORMATION_SCHEMA.tables t
    left join (
            select * from system.metadata.materialized_views
            where catalog_name = 'datalake'
              and schema_name = 'analytics_stage') mv
          on mv.catalog_name = t.table_catalog and mv.schema_name = t.table_schema and mv.name = t.table_name
    where t.table_schema = 'analytics_stage'
[0m16:29:32.226916 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m16:29:32.316885 [debug] [ThreadPool]: SQL status: SUCCESS in 0.0 seconds
[0m16:29:32.319407 [debug] [ThreadPool]: On list_datalake_analytics_stage: ROLLBACK
[0m16:29:32.319407 [debug] [ThreadPool]: On list_datalake_analytics_stage: Close
[0m16:29:32.320429 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '2657ce0c-1a6e-435b-b73d-64436f55d2be', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000001BC43F192D0>]}
[0m16:29:32.322010 [debug] [MainThread]: On master: COMMIT
[0m16:29:32.322523 [info ] [MainThread]: Concurrency: 1 threads (target='dev')
[0m16:29:32.323544 [info ] [MainThread]: 
[0m16:29:32.326069 [debug] [Thread-1 (]: Began running node model.my_dbt_trino_project.src_auth_events
[0m16:29:32.326069 [info ] [Thread-1 (]: 1 of 15 START sql incremental model analytics_source.src_auth_events ........... [RUN]
[0m16:29:32.328092 [debug] [Thread-1 (]: Acquiring new trino connection 'model.my_dbt_trino_project.src_auth_events'
[0m16:29:32.328933 [debug] [Thread-1 (]: Began compiling node model.my_dbt_trino_project.src_auth_events
[0m16:29:32.336563 [debug] [Thread-1 (]: Writing injected SQL for node "model.my_dbt_trino_project.src_auth_events"
[0m16:29:32.339586 [debug] [Thread-1 (]: Began executing node model.my_dbt_trino_project.src_auth_events
[0m16:29:32.383638 [debug] [Thread-1 (]: Using trino connection "model.my_dbt_trino_project.src_auth_events"
[0m16:29:32.392659 [debug] [Thread-1 (]: On model.my_dbt_trino_project.src_auth_events: /* {"app": "dbt", "dbt_version": "1.8.2", "profile_name": "my_dbt_trino_project", "target_name": "dev", "node_id": "model.my_dbt_trino_project.src_auth_events"} */

  
    

    create table "datalake"."analytics_source"."src_auth_events__dbt_tmp"
      
      
    as (
      

with source as (
    select
        CAST(ts AS VARCHAR) as id, 
        ts,
        CAST(sessionId AS VARCHAR) as sessionId,
        level,
        itemInSession,
        city,
        zip,
        state,
        userAgent,
        CAST(NULLIF(lon, '') AS double) as lon,
        CAST(NULLIF(lat, '') AS double) as lat,
        CAST(FLOOR(CAST(NULLIF(userId, '') AS DOUBLE)) AS INT) as userId, 
        lastName,
        firstName,
        gender,
        CAST(FLOOR(CAST(NULLIF(registration, '') AS DOUBLE)) AS BIGINT) as registration,
        success
    from "oltp"."public"."auth_events"
)

select
    id,
    ts,
    sessionId,
    level,
    itemInSession,
    city,
    zip,
    state,
    userAgent,
    lon,
    lat,
    userId,
    lastName,
    firstName,
    gender,
    registration, 
    CASE 
        WHEN CAST(success AS VARCHAR) = 't' THEN true 
        WHEN CAST(success AS VARCHAR) = 'f' THEN false
        ELSE NULL 
    END AS success_boolean
from source


    where ts > (select max(ts) from "datalake"."analytics_source"."src_auth_events")

    )
[0m16:29:32.393394 [debug] [Thread-1 (]: Opening a new connection, currently in state init
[0m16:29:32.867027 [debug] [Thread-1 (]: SQL status: SUCCESS in 0.0 seconds
[0m16:29:32.878134 [debug] [Thread-1 (]: Using trino connection "model.my_dbt_trino_project.src_auth_events"
[0m16:29:32.878134 [debug] [Thread-1 (]: On model.my_dbt_trino_project.src_auth_events: /* {"app": "dbt", "dbt_version": "1.8.2", "profile_name": "my_dbt_trino_project", "target_name": "dev", "node_id": "model.my_dbt_trino_project.src_auth_events"} */

    describe "datalake"."analytics_source"."src_auth_events__dbt_tmp"
[0m16:29:33.004432 [debug] [Thread-1 (]: SQL status: SUCCESS in 0.0 seconds
[0m16:29:33.009164 [debug] [Thread-1 (]: Using trino connection "model.my_dbt_trino_project.src_auth_events"
[0m16:29:33.009164 [debug] [Thread-1 (]: On model.my_dbt_trino_project.src_auth_events: /* {"app": "dbt", "dbt_version": "1.8.2", "profile_name": "my_dbt_trino_project", "target_name": "dev", "node_id": "model.my_dbt_trino_project.src_auth_events"} */

    describe "datalake"."analytics_source"."src_auth_events"
[0m16:29:33.139744 [debug] [Thread-1 (]: SQL status: SUCCESS in 0.0 seconds
[0m16:29:33.145272 [debug] [Thread-1 (]: Using trino connection "model.my_dbt_trino_project.src_auth_events"
[0m16:29:33.145272 [debug] [Thread-1 (]: On model.my_dbt_trino_project.src_auth_events: /* {"app": "dbt", "dbt_version": "1.8.2", "profile_name": "my_dbt_trino_project", "target_name": "dev", "node_id": "model.my_dbt_trino_project.src_auth_events"} */

    describe "datalake"."analytics_source"."src_auth_events"
[0m16:29:33.279345 [debug] [Thread-1 (]: SQL status: SUCCESS in 0.0 seconds
[0m16:29:33.287780 [debug] [Thread-1 (]: Writing runtime sql for node "model.my_dbt_trino_project.src_auth_events"
[0m16:29:33.290223 [debug] [Thread-1 (]: Using trino connection "model.my_dbt_trino_project.src_auth_events"
[0m16:29:33.290223 [debug] [Thread-1 (]: On model.my_dbt_trino_project.src_auth_events: /* {"app": "dbt", "dbt_version": "1.8.2", "profile_name": "my_dbt_trino_project", "target_name": "dev", "node_id": "model.my_dbt_trino_project.src_auth_events"} */
insert into "datalake"."analytics_source"."src_auth_events" ("id", "ts", "sessionid", "level", "iteminsession", "city", "zip", "state", "useragent", "lon", "lat", "userid", "lastname", "firstname", "gender", "registration", "success_boolean")
    (
        select "id", "ts", "sessionid", "level", "iteminsession", "city", "zip", "state", "useragent", "lon", "lat", "userid", "lastname", "firstname", "gender", "registration", "success_boolean"
        from "datalake"."analytics_source"."src_auth_events__dbt_tmp"
    )
[0m16:29:33.494156 [debug] [Thread-1 (]: SQL status: SUCCESS in 0.0 seconds
[0m16:29:33.496687 [debug] [Thread-1 (]: Applying DROP to: "datalake"."analytics_source"."src_auth_events__dbt_tmp"
[0m16:29:33.502703 [debug] [Thread-1 (]: Using trino connection "model.my_dbt_trino_project.src_auth_events"
[0m16:29:33.505222 [debug] [Thread-1 (]: On model.my_dbt_trino_project.src_auth_events: /* {"app": "dbt", "dbt_version": "1.8.2", "profile_name": "my_dbt_trino_project", "target_name": "dev", "node_id": "model.my_dbt_trino_project.src_auth_events"} */

    drop table if exists "datalake"."analytics_source"."src_auth_events__dbt_tmp"
[0m16:29:33.654793 [debug] [Thread-1 (]: SQL status: SUCCESS in 0.0 seconds
[0m16:29:33.667879 [debug] [Thread-1 (]: On model.my_dbt_trino_project.src_auth_events: ROLLBACK
[0m16:29:33.667879 [debug] [Thread-1 (]: On model.my_dbt_trino_project.src_auth_events: Close
[0m16:29:33.670896 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '2657ce0c-1a6e-435b-b73d-64436f55d2be', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000001BC4434F210>]}
[0m16:29:33.671584 [info ] [Thread-1 (]: 1 of 15 OK created sql incremental model analytics_source.src_auth_events ...... [[32mSUCCESS[0m in 1.34s]
[0m16:29:33.671584 [debug] [Thread-1 (]: Finished running node model.my_dbt_trino_project.src_auth_events
[0m16:29:33.671584 [debug] [Thread-1 (]: Began running node model.my_dbt_trino_project.src_listen_events
[0m16:29:33.671584 [info ] [Thread-1 (]: 2 of 15 START sql incremental model analytics_source.src_listen_events ......... [RUN]
[0m16:29:33.671584 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.my_dbt_trino_project.src_auth_events, now model.my_dbt_trino_project.src_listen_events)
[0m16:29:33.671584 [debug] [Thread-1 (]: Began compiling node model.my_dbt_trino_project.src_listen_events
[0m16:29:33.676090 [debug] [Thread-1 (]: Writing injected SQL for node "model.my_dbt_trino_project.src_listen_events"
[0m16:29:33.676090 [debug] [Thread-1 (]: Began executing node model.my_dbt_trino_project.src_listen_events
[0m16:29:33.685751 [debug] [Thread-1 (]: Using trino connection "model.my_dbt_trino_project.src_listen_events"
[0m16:29:33.686756 [debug] [Thread-1 (]: On model.my_dbt_trino_project.src_listen_events: /* {"app": "dbt", "dbt_version": "1.8.2", "profile_name": "my_dbt_trino_project", "target_name": "dev", "node_id": "model.my_dbt_trino_project.src_listen_events"} */

  
    

    create table "datalake"."analytics_source"."src_listen_events__dbt_tmp"
      
      
    as (
      

with source as (

    select
        CAST(_id AS VARCHAR) as id,
        artist,
        song,
        CAST(NULLIF(duration, '') AS DOUBLE) as duration,
        ts,
        sessionid,
        auth,
        level,
        CAST(NULLIF(itemInSession, '') AS INTEGER) as itemInSession,
        city,
        zip,
        state,
        country,
        userAgent,
        CAST(NULLIF(lon, '') AS DOUBLE) as lon,
        CAST(NULLIF(lat, '') AS DOUBLE) as lat,
        CAST(CAST(NULLIF(userId, '') AS DOUBLE) AS INTEGER) as userId,
 -- Assurez-vous que userId peut aussi être converti de cette manière.
        lastName,
        firstName,
        gender,
        CAST(CAST(NULLIF(registration, '') AS DOUBLE) AS BIGINT) as registration
    from "website"."demo"."listen_events"

)

select * from source



    -- this filter will only be applied on an incremental run
    where ts > (select max(ts) from "datalake"."analytics_source"."src_listen_events")


    )
[0m16:29:33.687098 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m16:29:34.006182 [debug] [Thread-1 (]: SQL status: SUCCESS in 0.0 seconds
[0m16:29:34.008688 [debug] [Thread-1 (]: Using trino connection "model.my_dbt_trino_project.src_listen_events"
[0m16:29:34.008688 [debug] [Thread-1 (]: On model.my_dbt_trino_project.src_listen_events: /* {"app": "dbt", "dbt_version": "1.8.2", "profile_name": "my_dbt_trino_project", "target_name": "dev", "node_id": "model.my_dbt_trino_project.src_listen_events"} */

    describe "datalake"."analytics_source"."src_listen_events__dbt_tmp"
[0m16:29:34.125667 [debug] [Thread-1 (]: SQL status: SUCCESS in 0.0 seconds
[0m16:29:34.127696 [debug] [Thread-1 (]: Using trino connection "model.my_dbt_trino_project.src_listen_events"
[0m16:29:34.127696 [debug] [Thread-1 (]: On model.my_dbt_trino_project.src_listen_events: /* {"app": "dbt", "dbt_version": "1.8.2", "profile_name": "my_dbt_trino_project", "target_name": "dev", "node_id": "model.my_dbt_trino_project.src_listen_events"} */

    describe "datalake"."analytics_source"."src_listen_events"
[0m16:29:34.246797 [debug] [Thread-1 (]: SQL status: SUCCESS in 0.0 seconds
[0m16:29:34.247809 [debug] [Thread-1 (]: Using trino connection "model.my_dbt_trino_project.src_listen_events"
[0m16:29:34.247809 [debug] [Thread-1 (]: On model.my_dbt_trino_project.src_listen_events: /* {"app": "dbt", "dbt_version": "1.8.2", "profile_name": "my_dbt_trino_project", "target_name": "dev", "node_id": "model.my_dbt_trino_project.src_listen_events"} */

    describe "datalake"."analytics_source"."src_listen_events"
[0m16:29:34.370656 [debug] [Thread-1 (]: SQL status: SUCCESS in 0.0 seconds
[0m16:29:34.373228 [debug] [Thread-1 (]: Writing runtime sql for node "model.my_dbt_trino_project.src_listen_events"
[0m16:29:34.373228 [debug] [Thread-1 (]: Using trino connection "model.my_dbt_trino_project.src_listen_events"
[0m16:29:34.373228 [debug] [Thread-1 (]: On model.my_dbt_trino_project.src_listen_events: /* {"app": "dbt", "dbt_version": "1.8.2", "profile_name": "my_dbt_trino_project", "target_name": "dev", "node_id": "model.my_dbt_trino_project.src_listen_events"} */
insert into "datalake"."analytics_source"."src_listen_events" ("id", "artist", "song", "duration", "ts", "sessionid", "auth", "level", "iteminsession", "city", "zip", "state", "country", "useragent", "lon", "lat", "userid", "lastname", "firstname", "gender", "registration")
    (
        select "id", "artist", "song", "duration", "ts", "sessionid", "auth", "level", "iteminsession", "city", "zip", "state", "country", "useragent", "lon", "lat", "userid", "lastname", "firstname", "gender", "registration"
        from "datalake"."analytics_source"."src_listen_events__dbt_tmp"
    )
[0m16:29:34.540967 [debug] [Thread-1 (]: SQL status: SUCCESS in 0.0 seconds
[0m16:29:34.547422 [debug] [Thread-1 (]: Applying DROP to: "datalake"."analytics_source"."src_listen_events__dbt_tmp"
[0m16:29:34.550442 [debug] [Thread-1 (]: Using trino connection "model.my_dbt_trino_project.src_listen_events"
[0m16:29:34.550442 [debug] [Thread-1 (]: On model.my_dbt_trino_project.src_listen_events: /* {"app": "dbt", "dbt_version": "1.8.2", "profile_name": "my_dbt_trino_project", "target_name": "dev", "node_id": "model.my_dbt_trino_project.src_listen_events"} */

    drop table if exists "datalake"."analytics_source"."src_listen_events__dbt_tmp"
[0m16:29:34.705258 [debug] [Thread-1 (]: SQL status: SUCCESS in 0.0 seconds
[0m16:29:34.708180 [debug] [Thread-1 (]: On model.my_dbt_trino_project.src_listen_events: ROLLBACK
[0m16:29:34.708180 [debug] [Thread-1 (]: On model.my_dbt_trino_project.src_listen_events: Close
[0m16:29:34.709220 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '2657ce0c-1a6e-435b-b73d-64436f55d2be', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000001BC42B2E350>]}
[0m16:29:34.709746 [info ] [Thread-1 (]: 2 of 15 OK created sql incremental model analytics_source.src_listen_events .... [[32mSUCCESS[0m in 1.04s]
[0m16:29:34.710265 [debug] [Thread-1 (]: Finished running node model.my_dbt_trino_project.src_listen_events
[0m16:29:34.710780 [debug] [Thread-1 (]: Began running node model.my_dbt_trino_project.src_page_view_events
[0m16:29:34.711291 [info ] [Thread-1 (]: 3 of 15 START sql incremental model analytics_source.src_page_view_events ...... [RUN]
[0m16:29:34.711805 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.my_dbt_trino_project.src_listen_events, now model.my_dbt_trino_project.src_page_view_events)
[0m16:29:34.712322 [debug] [Thread-1 (]: Began compiling node model.my_dbt_trino_project.src_page_view_events
[0m16:29:34.715421 [debug] [Thread-1 (]: Writing injected SQL for node "model.my_dbt_trino_project.src_page_view_events"
[0m16:29:34.715937 [debug] [Thread-1 (]: Began executing node model.my_dbt_trino_project.src_page_view_events
[0m16:29:34.721893 [debug] [Thread-1 (]: Using trino connection "model.my_dbt_trino_project.src_page_view_events"
[0m16:29:34.721893 [debug] [Thread-1 (]: On model.my_dbt_trino_project.src_page_view_events: /* {"app": "dbt", "dbt_version": "1.8.2", "profile_name": "my_dbt_trino_project", "target_name": "dev", "node_id": "model.my_dbt_trino_project.src_page_view_events"} */

  
    

    create table "datalake"."analytics_source"."src_page_view_events__dbt_tmp"
      
      
    as (
      

with source as (
    select
        CAST(_id AS VARCHAR) as id,
        ts,
        CAST(sessionId AS VARCHAR) as sessionId,
        page,
        auth,
        level,
        CAST(CAST(NULLIF(itemInSession, '') AS DOUBLE) AS INTEGER) as itemInSession, 
        city,
        zip,
        state,
        userAgent,
        CAST(NULLIF(lon, '') AS double) as lon,
        CAST(NULLIF(lat, '') AS double) as lat,
        CAST(CAST(NULLIF(userId, '') AS DOUBLE) AS INTEGER) as userId, 
        lastName,
        firstName,
        gender,
        CAST(CAST(NULLIF(registration, '') AS DOUBLE) AS BIGINT) as registration, 
        artist,
        song,
        CAST(NULLIF(duration, '') AS double) as duration
    from "website"."demo"."page_view_events"
)

select * from source


    where ts > (select max(ts) from "datalake"."analytics_source"."src_page_view_events")

    )
[0m16:29:34.722925 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m16:29:34.997823 [debug] [Thread-1 (]: SQL status: SUCCESS in 0.0 seconds
[0m16:29:35.005148 [debug] [Thread-1 (]: Using trino connection "model.my_dbt_trino_project.src_page_view_events"
[0m16:29:35.005148 [debug] [Thread-1 (]: On model.my_dbt_trino_project.src_page_view_events: /* {"app": "dbt", "dbt_version": "1.8.2", "profile_name": "my_dbt_trino_project", "target_name": "dev", "node_id": "model.my_dbt_trino_project.src_page_view_events"} */

    describe "datalake"."analytics_source"."src_page_view_events__dbt_tmp"
[0m16:29:35.138688 [debug] [Thread-1 (]: SQL status: SUCCESS in 0.0 seconds
[0m16:29:35.171962 [debug] [Thread-1 (]: Using trino connection "model.my_dbt_trino_project.src_page_view_events"
[0m16:29:35.187485 [debug] [Thread-1 (]: On model.my_dbt_trino_project.src_page_view_events: /* {"app": "dbt", "dbt_version": "1.8.2", "profile_name": "my_dbt_trino_project", "target_name": "dev", "node_id": "model.my_dbt_trino_project.src_page_view_events"} */

    describe "datalake"."analytics_source"."src_page_view_events"
[0m16:29:35.283560 [debug] [Thread-1 (]: SQL status: SUCCESS in 0.0 seconds
[0m16:29:35.285072 [debug] [Thread-1 (]: Using trino connection "model.my_dbt_trino_project.src_page_view_events"
[0m16:29:35.285072 [debug] [Thread-1 (]: On model.my_dbt_trino_project.src_page_view_events: /* {"app": "dbt", "dbt_version": "1.8.2", "profile_name": "my_dbt_trino_project", "target_name": "dev", "node_id": "model.my_dbt_trino_project.src_page_view_events"} */

    describe "datalake"."analytics_source"."src_page_view_events"
[0m16:29:35.384603 [debug] [Thread-1 (]: SQL status: SUCCESS in 0.0 seconds
[0m16:29:35.387609 [debug] [Thread-1 (]: Writing runtime sql for node "model.my_dbt_trino_project.src_page_view_events"
[0m16:29:35.387609 [debug] [Thread-1 (]: Using trino connection "model.my_dbt_trino_project.src_page_view_events"
[0m16:29:35.387609 [debug] [Thread-1 (]: On model.my_dbt_trino_project.src_page_view_events: /* {"app": "dbt", "dbt_version": "1.8.2", "profile_name": "my_dbt_trino_project", "target_name": "dev", "node_id": "model.my_dbt_trino_project.src_page_view_events"} */
insert into "datalake"."analytics_source"."src_page_view_events" ("id", "ts", "sessionid", "page", "auth", "level", "iteminsession", "city", "zip", "state", "useragent", "lon", "lat", "userid", "lastname", "firstname", "gender", "registration", "artist", "song", "duration")
    (
        select "id", "ts", "sessionid", "page", "auth", "level", "iteminsession", "city", "zip", "state", "useragent", "lon", "lat", "userid", "lastname", "firstname", "gender", "registration", "artist", "song", "duration"
        from "datalake"."analytics_source"."src_page_view_events__dbt_tmp"
    )
[0m16:29:35.537233 [debug] [Thread-1 (]: SQL status: SUCCESS in 0.0 seconds
[0m16:29:35.543369 [debug] [Thread-1 (]: Applying DROP to: "datalake"."analytics_source"."src_page_view_events__dbt_tmp"
[0m16:29:35.543369 [debug] [Thread-1 (]: Using trino connection "model.my_dbt_trino_project.src_page_view_events"
[0m16:29:35.545884 [debug] [Thread-1 (]: On model.my_dbt_trino_project.src_page_view_events: /* {"app": "dbt", "dbt_version": "1.8.2", "profile_name": "my_dbt_trino_project", "target_name": "dev", "node_id": "model.my_dbt_trino_project.src_page_view_events"} */

    drop table if exists "datalake"."analytics_source"."src_page_view_events__dbt_tmp"
[0m16:29:35.663198 [debug] [Thread-1 (]: SQL status: SUCCESS in 0.0 seconds
[0m16:29:35.663198 [debug] [Thread-1 (]: On model.my_dbt_trino_project.src_page_view_events: ROLLBACK
[0m16:29:35.663198 [debug] [Thread-1 (]: On model.my_dbt_trino_project.src_page_view_events: Close
[0m16:29:35.665706 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '2657ce0c-1a6e-435b-b73d-64436f55d2be', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000001BC42B8CD90>]}
[0m16:29:35.665706 [info ] [Thread-1 (]: 3 of 15 OK created sql incremental model analytics_source.src_page_view_events . [[32mSUCCESS[0m in 0.95s]
[0m16:29:35.667071 [debug] [Thread-1 (]: Finished running node model.my_dbt_trino_project.src_page_view_events
[0m16:29:35.667726 [debug] [Thread-1 (]: Began running node model.my_dbt_trino_project.stg_user_level_by_gender
[0m16:29:35.667726 [info ] [Thread-1 (]: 4 of 15 START sql view model analytics_stage.stg_user_level_by_gender .......... [RUN]
[0m16:29:35.667726 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.my_dbt_trino_project.src_page_view_events, now model.my_dbt_trino_project.stg_user_level_by_gender)
[0m16:29:35.667726 [debug] [Thread-1 (]: Began compiling node model.my_dbt_trino_project.stg_user_level_by_gender
[0m16:29:35.667726 [debug] [Thread-1 (]: Writing injected SQL for node "model.my_dbt_trino_project.stg_user_level_by_gender"
[0m16:29:35.667726 [debug] [Thread-1 (]: Began executing node model.my_dbt_trino_project.stg_user_level_by_gender
[0m16:29:35.685300 [debug] [Thread-1 (]: Writing runtime sql for node "model.my_dbt_trino_project.stg_user_level_by_gender"
[0m16:29:35.688314 [debug] [Thread-1 (]: Using trino connection "model.my_dbt_trino_project.stg_user_level_by_gender"
[0m16:29:35.688314 [debug] [Thread-1 (]: On model.my_dbt_trino_project.stg_user_level_by_gender: /* {"app": "dbt", "dbt_version": "1.8.2", "profile_name": "my_dbt_trino_project", "target_name": "dev", "node_id": "model.my_dbt_trino_project.stg_user_level_by_gender"} */

  create or replace view
    "datalake"."analytics_stage"."stg_user_level_by_gender"
  security definer
  as
    

WITH user_subscriptions AS (
    SELECT
        gender,
        level, 
        COUNT(DISTINCT userId) AS user_count
    FROM "datalake"."analytics_source"."src_auth_events"
    WHERE gender IS NOT NULL AND level IS NOT NULL
    GROUP BY gender, level
)

SELECT
    gender,
    level,
    user_count
FROM user_subscriptions
  
[0m16:29:35.689313 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m16:29:35.755169 [debug] [Thread-1 (]: SQL status: SUCCESS in 0.0 seconds
[0m16:29:35.755169 [debug] [Thread-1 (]: On model.my_dbt_trino_project.stg_user_level_by_gender: ROLLBACK
[0m16:29:35.755169 [debug] [Thread-1 (]: On model.my_dbt_trino_project.stg_user_level_by_gender: Close
[0m16:29:35.755169 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '2657ce0c-1a6e-435b-b73d-64436f55d2be', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000001BC42B1BAD0>]}
[0m16:29:35.755169 [info ] [Thread-1 (]: 4 of 15 OK created sql view model analytics_stage.stg_user_level_by_gender ..... [[32mSUCCESS[0m in 0.09s]
[0m16:29:35.761203 [debug] [Thread-1 (]: Finished running node model.my_dbt_trino_project.stg_user_level_by_gender
[0m16:29:35.761203 [debug] [Thread-1 (]: Began running node model.my_dbt_trino_project.stg_streams_hourly
[0m16:29:35.761203 [info ] [Thread-1 (]: 5 of 15 START sql table model analytics_stage.stg_streams_hourly ............... [RUN]
[0m16:29:35.761203 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.my_dbt_trino_project.stg_user_level_by_gender, now model.my_dbt_trino_project.stg_streams_hourly)
[0m16:29:35.761203 [debug] [Thread-1 (]: Began compiling node model.my_dbt_trino_project.stg_streams_hourly
[0m16:29:35.764217 [debug] [Thread-1 (]: Writing injected SQL for node "model.my_dbt_trino_project.stg_streams_hourly"
[0m16:29:35.764217 [debug] [Thread-1 (]: Began executing node model.my_dbt_trino_project.stg_streams_hourly
[0m16:29:35.780708 [debug] [Thread-1 (]: Writing runtime sql for node "model.my_dbt_trino_project.stg_streams_hourly"
[0m16:29:35.782300 [debug] [Thread-1 (]: Using trino connection "model.my_dbt_trino_project.stg_streams_hourly"
[0m16:29:35.783382 [debug] [Thread-1 (]: On model.my_dbt_trino_project.stg_streams_hourly: /* {"app": "dbt", "dbt_version": "1.8.2", "profile_name": "my_dbt_trino_project", "target_name": "dev", "node_id": "model.my_dbt_trino_project.stg_streams_hourly"} */

  
    

    create table "datalake"."analytics_stage"."stg_streams_hourly__dbt_tmp"
      
      
    as (
      

SELECT
    DATE_FORMAT(FROM_UNIXTIME(ts), '%Y-%m-%d') AS stream_date, 
    DATE_FORMAT(FROM_UNIXTIME(ts), '%H') AS stream_hour,
    COUNT(*) AS total_streams
FROM "datalake"."analytics_source"."src_listen_events"
GROUP BY
    DATE_FORMAT(FROM_UNIXTIME(ts), '%Y-%m-%d'),
    DATE_FORMAT(FROM_UNIXTIME(ts), '%H')
    )
[0m16:29:35.783382 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m16:29:36.146133 [debug] [Thread-1 (]: SQL status: SUCCESS in 0.0 seconds
[0m16:29:36.156273 [debug] [Thread-1 (]: Using trino connection "model.my_dbt_trino_project.stg_streams_hourly"
[0m16:29:36.156273 [debug] [Thread-1 (]: On model.my_dbt_trino_project.stg_streams_hourly: /* {"app": "dbt", "dbt_version": "1.8.2", "profile_name": "my_dbt_trino_project", "target_name": "dev", "node_id": "model.my_dbt_trino_project.stg_streams_hourly"} */
alter table "datalake"."analytics_stage"."stg_streams_hourly" rename to "datalake"."analytics_stage"."stg_streams_hourly__dbt_backup"
[0m16:29:36.255663 [debug] [Thread-1 (]: SQL status: SUCCESS in 0.0 seconds
[0m16:29:36.257669 [debug] [Thread-1 (]: Using trino connection "model.my_dbt_trino_project.stg_streams_hourly"
[0m16:29:36.257669 [debug] [Thread-1 (]: On model.my_dbt_trino_project.stg_streams_hourly: /* {"app": "dbt", "dbt_version": "1.8.2", "profile_name": "my_dbt_trino_project", "target_name": "dev", "node_id": "model.my_dbt_trino_project.stg_streams_hourly"} */
alter table "datalake"."analytics_stage"."stg_streams_hourly__dbt_tmp" rename to "datalake"."analytics_stage"."stg_streams_hourly"
[0m16:29:36.365793 [debug] [Thread-1 (]: SQL status: SUCCESS in 0.0 seconds
[0m16:29:36.368992 [debug] [Thread-1 (]: Applying DROP to: "datalake"."analytics_stage"."stg_streams_hourly__dbt_backup"
[0m16:29:36.370035 [debug] [Thread-1 (]: Using trino connection "model.my_dbt_trino_project.stg_streams_hourly"
[0m16:29:36.370035 [debug] [Thread-1 (]: On model.my_dbt_trino_project.stg_streams_hourly: /* {"app": "dbt", "dbt_version": "1.8.2", "profile_name": "my_dbt_trino_project", "target_name": "dev", "node_id": "model.my_dbt_trino_project.stg_streams_hourly"} */

    drop table if exists "datalake"."analytics_stage"."stg_streams_hourly__dbt_backup"
[0m16:29:36.515591 [debug] [Thread-1 (]: SQL status: SUCCESS in 0.0 seconds
[0m16:29:36.517706 [debug] [Thread-1 (]: On model.my_dbt_trino_project.stg_streams_hourly: ROLLBACK
[0m16:29:36.517706 [debug] [Thread-1 (]: On model.my_dbt_trino_project.stg_streams_hourly: Close
[0m16:29:36.518243 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '2657ce0c-1a6e-435b-b73d-64436f55d2be', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000001BC412CE250>]}
[0m16:29:36.519298 [info ] [Thread-1 (]: 5 of 15 OK created sql table model analytics_stage.stg_streams_hourly .......... [[32mSUCCESS[0m in 0.76s]
[0m16:29:36.519834 [debug] [Thread-1 (]: Finished running node model.my_dbt_trino_project.stg_streams_hourly
[0m16:29:36.520343 [debug] [Thread-1 (]: Began running node model.my_dbt_trino_project.stg_top_songs_artists
[0m16:29:36.520343 [info ] [Thread-1 (]: 6 of 15 START sql view model analytics_stage.stg_top_songs_artists ............. [RUN]
[0m16:29:36.520343 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.my_dbt_trino_project.stg_streams_hourly, now model.my_dbt_trino_project.stg_top_songs_artists)
[0m16:29:36.520343 [debug] [Thread-1 (]: Began compiling node model.my_dbt_trino_project.stg_top_songs_artists
[0m16:29:36.524318 [debug] [Thread-1 (]: Writing injected SQL for node "model.my_dbt_trino_project.stg_top_songs_artists"
[0m16:29:36.525367 [debug] [Thread-1 (]: Began executing node model.my_dbt_trino_project.stg_top_songs_artists
[0m16:29:36.527954 [debug] [Thread-1 (]: Writing runtime sql for node "model.my_dbt_trino_project.stg_top_songs_artists"
[0m16:29:36.529507 [debug] [Thread-1 (]: Using trino connection "model.my_dbt_trino_project.stg_top_songs_artists"
[0m16:29:36.530023 [debug] [Thread-1 (]: On model.my_dbt_trino_project.stg_top_songs_artists: /* {"app": "dbt", "dbt_version": "1.8.2", "profile_name": "my_dbt_trino_project", "target_name": "dev", "node_id": "model.my_dbt_trino_project.stg_top_songs_artists"} */

  create or replace view
    "datalake"."analytics_stage"."stg_top_songs_artists"
  security definer
  as
    

WITH song_plays AS (
    SELECT
        artist,
        song,
        COUNT(*) AS play_count
    FROM "datalake"."analytics_source"."src_listen_events"
    GROUP BY artist, song
)

SELECT
    artist,
    song,
    play_count
FROM song_plays
ORDER BY play_count DESC
  
[0m16:29:36.530568 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m16:29:36.607965 [debug] [Thread-1 (]: SQL status: SUCCESS in 0.0 seconds
[0m16:29:36.610028 [debug] [Thread-1 (]: On model.my_dbt_trino_project.stg_top_songs_artists: ROLLBACK
[0m16:29:36.610545 [debug] [Thread-1 (]: On model.my_dbt_trino_project.stg_top_songs_artists: Close
[0m16:29:36.611062 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '2657ce0c-1a6e-435b-b73d-64436f55d2be', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000001BC442E4590>]}
[0m16:29:36.611577 [info ] [Thread-1 (]: 6 of 15 OK created sql view model analytics_stage.stg_top_songs_artists ........ [[32mSUCCESS[0m in 0.09s]
[0m16:29:36.612633 [debug] [Thread-1 (]: Finished running node model.my_dbt_trino_project.stg_top_songs_artists
[0m16:29:36.613153 [debug] [Thread-1 (]: Began running node model.my_dbt_trino_project.stg_unique_users
[0m16:29:36.613667 [info ] [Thread-1 (]: 7 of 15 START sql view model analytics_stage.stg_unique_users .................. [RUN]
[0m16:29:36.614731 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.my_dbt_trino_project.stg_top_songs_artists, now model.my_dbt_trino_project.stg_unique_users)
[0m16:29:36.614731 [debug] [Thread-1 (]: Began compiling node model.my_dbt_trino_project.stg_unique_users
[0m16:29:36.617859 [debug] [Thread-1 (]: Writing injected SQL for node "model.my_dbt_trino_project.stg_unique_users"
[0m16:29:36.618673 [debug] [Thread-1 (]: Began executing node model.my_dbt_trino_project.stg_unique_users
[0m16:29:36.620815 [debug] [Thread-1 (]: Writing runtime sql for node "model.my_dbt_trino_project.stg_unique_users"
[0m16:29:36.622435 [debug] [Thread-1 (]: Using trino connection "model.my_dbt_trino_project.stg_unique_users"
[0m16:29:36.622963 [debug] [Thread-1 (]: On model.my_dbt_trino_project.stg_unique_users: /* {"app": "dbt", "dbt_version": "1.8.2", "profile_name": "my_dbt_trino_project", "target_name": "dev", "node_id": "model.my_dbt_trino_project.stg_unique_users"} */

  create or replace view
    "datalake"."analytics_stage"."stg_unique_users"
  security definer
  as
    

SELECT
    COUNT(DISTINCT userid) AS total_unique_users
FROM "datalake"."analytics_source"."src_listen_events"
WHERE userid IS NOT NULL
  
[0m16:29:36.623848 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m16:29:36.674485 [debug] [Thread-1 (]: SQL status: SUCCESS in 0.0 seconds
[0m16:29:36.676566 [debug] [Thread-1 (]: On model.my_dbt_trino_project.stg_unique_users: ROLLBACK
[0m16:29:36.677083 [debug] [Thread-1 (]: On model.my_dbt_trino_project.stg_unique_users: Close
[0m16:29:36.677602 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '2657ce0c-1a6e-435b-b73d-64436f55d2be', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000001BC42A44F10>]}
[0m16:29:36.678648 [info ] [Thread-1 (]: 7 of 15 OK created sql view model analytics_stage.stg_unique_users ............. [[32mSUCCESS[0m in 0.06s]
[0m16:29:36.679177 [debug] [Thread-1 (]: Finished running node model.my_dbt_trino_project.stg_unique_users
[0m16:29:36.679694 [debug] [Thread-1 (]: Began running node model.my_dbt_trino_project.stg_user_activity_per_country
[0m16:29:36.680739 [info ] [Thread-1 (]: 8 of 15 START sql view model analytics_stage.stg_user_activity_per_country ..... [RUN]
[0m16:29:36.681283 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.my_dbt_trino_project.stg_unique_users, now model.my_dbt_trino_project.stg_user_activity_per_country)
[0m16:29:36.681283 [debug] [Thread-1 (]: Began compiling node model.my_dbt_trino_project.stg_user_activity_per_country
[0m16:29:36.684417 [debug] [Thread-1 (]: Writing injected SQL for node "model.my_dbt_trino_project.stg_user_activity_per_country"
[0m16:29:36.684936 [debug] [Thread-1 (]: Began executing node model.my_dbt_trino_project.stg_user_activity_per_country
[0m16:29:36.687933 [debug] [Thread-1 (]: Writing runtime sql for node "model.my_dbt_trino_project.stg_user_activity_per_country"
[0m16:29:36.689568 [debug] [Thread-1 (]: Using trino connection "model.my_dbt_trino_project.stg_user_activity_per_country"
[0m16:29:36.690619 [debug] [Thread-1 (]: On model.my_dbt_trino_project.stg_user_activity_per_country: /* {"app": "dbt", "dbt_version": "1.8.2", "profile_name": "my_dbt_trino_project", "target_name": "dev", "node_id": "model.my_dbt_trino_project.stg_user_activity_per_country"} */

  create or replace view
    "datalake"."analytics_stage"."stg_user_activity_per_country"
  security definer
  as
    

WITH combined_activities AS (
  SELECT
    country,
    'listen_event' AS event_type,
    ts,
    userid
  FROM "datalake"."analytics_source"."src_listen_events"
  WHERE country IS NOT NULL
  UNION ALL
  SELECT
    'Unknown' AS country, 
    ts,
    userid
  FROM "datalake"."analytics_source"."src_auth_events"
  UNION ALL
  SELECT
    'Unknown' AS country, 
    'page_view_event' AS event_type,
    ts,
    userid
  FROM "datalake"."analytics_source"."src_page_view_events"
)

SELECT
  country,
  COUNT(*) AS activity_count
FROM combined_activities
GROUP BY country
  
[0m16:29:36.690815 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m16:29:36.744791 [debug] [Thread-1 (]: Trino adapter: Trino query id: 20240617_082936_00196_xsftb
[0m16:29:36.744791 [debug] [Thread-1 (]: Trino adapter: Trino error: TrinoUserError(type=USER_ERROR, name=TYPE_MISMATCH, message="line 17:3: UNION query has different number of fields: 4, 3", query_id=20240617_082936_00196_xsftb)
[0m16:29:36.744791 [debug] [Thread-1 (]: On model.my_dbt_trino_project.stg_user_activity_per_country: ROLLBACK
[0m16:29:36.744791 [debug] [Thread-1 (]: On model.my_dbt_trino_project.stg_user_activity_per_country: Close
[0m16:29:36.744791 [debug] [Thread-1 (]: Database Error in model stg_user_activity_per_country (models\stage\stg_user_activity_per_country.sql)
  TrinoUserError(type=USER_ERROR, name=TYPE_MISMATCH, message="line 17:3: UNION query has different number of fields: 4, 3", query_id=20240617_082936_00196_xsftb)
  compiled Code at target\run\my_dbt_trino_project\models\stage\stg_user_activity_per_country.sql
[0m16:29:36.753366 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '2657ce0c-1a6e-435b-b73d-64436f55d2be', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000001BC424C6490>]}
[0m16:29:36.753366 [error] [Thread-1 (]: 8 of 15 ERROR creating sql view model analytics_stage.stg_user_activity_per_country  [[31mERROR[0m in 0.07s]
[0m16:29:36.754550 [debug] [Thread-1 (]: Finished running node model.my_dbt_trino_project.stg_user_activity_per_country
[0m16:29:36.754550 [debug] [Thread-1 (]: Began running node model.my_dbt_trino_project.stg_user_activity_per_location
[0m16:29:36.754550 [info ] [Thread-1 (]: 9 of 15 START sql view model analytics_stage.stg_user_activity_per_location .... [RUN]
[0m16:29:36.754550 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.my_dbt_trino_project.stg_user_activity_per_country, now model.my_dbt_trino_project.stg_user_activity_per_location)
[0m16:29:36.754550 [debug] [Thread-1 (]: Began compiling node model.my_dbt_trino_project.stg_user_activity_per_location
[0m16:29:36.760336 [debug] [Thread-1 (]: Writing injected SQL for node "model.my_dbt_trino_project.stg_user_activity_per_location"
[0m16:29:36.760831 [debug] [Thread-1 (]: Began executing node model.my_dbt_trino_project.stg_user_activity_per_location
[0m16:29:36.764105 [debug] [Thread-1 (]: Writing runtime sql for node "model.my_dbt_trino_project.stg_user_activity_per_location"
[0m16:29:36.765113 [debug] [Thread-1 (]: Using trino connection "model.my_dbt_trino_project.stg_user_activity_per_location"
[0m16:29:36.765113 [debug] [Thread-1 (]: On model.my_dbt_trino_project.stg_user_activity_per_location: /* {"app": "dbt", "dbt_version": "1.8.2", "profile_name": "my_dbt_trino_project", "target_name": "dev", "node_id": "model.my_dbt_trino_project.stg_user_activity_per_location"} */

  create or replace view
    "datalake"."analytics_stage"."stg_user_activity_per_location"
  security definer
  as
    

WITH combined_activities AS (
  SELECT
    city,
    state,
    'auth_event' AS event_type,
    ts,
    userid
 FROM "datalake"."analytics_source"."src_auth_events"
  UNION ALL
  SELECT
    city,
    state,
    'listen_event' AS event_type,
    ts,
    userid
  FROM "datalake"."analytics_source"."src_listen_events"
  UNION ALL
  SELECT
    city,
    state,
    'page_view_event' AS event_type,
    ts,
    userid
  FROM "datalake"."analytics_source"."src_page_view_events"
)

SELECT
  state,
  city,
  COUNT(*) AS activity_count
FROM combined_activities
GROUP BY state, city
  
[0m16:29:36.766860 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m16:29:36.867714 [debug] [Thread-1 (]: SQL status: SUCCESS in 0.0 seconds
[0m16:29:36.869145 [debug] [Thread-1 (]: On model.my_dbt_trino_project.stg_user_activity_per_location: ROLLBACK
[0m16:29:36.869145 [debug] [Thread-1 (]: On model.my_dbt_trino_project.stg_user_activity_per_location: Close
[0m16:29:36.869145 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '2657ce0c-1a6e-435b-b73d-64436f55d2be', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000001BC41DA6650>]}
[0m16:29:36.872661 [info ] [Thread-1 (]: 9 of 15 OK created sql view model analytics_stage.stg_user_activity_per_location  [[32mSUCCESS[0m in 0.11s]
[0m16:29:36.872661 [debug] [Thread-1 (]: Finished running node model.my_dbt_trino_project.stg_user_activity_per_location
[0m16:29:36.872661 [debug] [Thread-1 (]: Began running node model.my_dbt_trino_project.mart_user_level_by_gender
[0m16:29:36.874173 [info ] [Thread-1 (]: 10 of 15 START sql table model analytics.mart_user_level_by_gender ............. [RUN]
[0m16:29:36.874173 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.my_dbt_trino_project.stg_user_activity_per_location, now model.my_dbt_trino_project.mart_user_level_by_gender)
[0m16:29:36.874173 [debug] [Thread-1 (]: Began compiling node model.my_dbt_trino_project.mart_user_level_by_gender
[0m16:29:36.877501 [debug] [Thread-1 (]: Writing injected SQL for node "model.my_dbt_trino_project.mart_user_level_by_gender"
[0m16:29:36.877501 [debug] [Thread-1 (]: Began executing node model.my_dbt_trino_project.mart_user_level_by_gender
[0m16:29:36.881014 [debug] [Thread-1 (]: Writing runtime sql for node "model.my_dbt_trino_project.mart_user_level_by_gender"
[0m16:29:36.883960 [debug] [Thread-1 (]: Using trino connection "model.my_dbt_trino_project.mart_user_level_by_gender"
[0m16:29:36.884666 [debug] [Thread-1 (]: On model.my_dbt_trino_project.mart_user_level_by_gender: /* {"app": "dbt", "dbt_version": "1.8.2", "profile_name": "my_dbt_trino_project", "target_name": "dev", "node_id": "model.my_dbt_trino_project.mart_user_level_by_gender"} */

  
    

    create table "datalake"."analytics"."mart_user_level_by_gender__dbt_tmp"
      
      
    as (
      

SELECT
    gender,
    level,
    SUM(user_count) AS total_users,
    ROUND(SUM(user_count) * 100.0 / SUM(SUM(user_count)) OVER (), 2) AS percentage_of_total_users
FROM "datalake"."analytics_stage"."stg_user_level_by_gender"
GROUP BY gender, level
    )
[0m16:29:36.884666 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m16:29:37.206463 [debug] [Thread-1 (]: SQL status: SUCCESS in 0.0 seconds
[0m16:29:37.206463 [debug] [Thread-1 (]: Using trino connection "model.my_dbt_trino_project.mart_user_level_by_gender"
[0m16:29:37.206463 [debug] [Thread-1 (]: On model.my_dbt_trino_project.mart_user_level_by_gender: /* {"app": "dbt", "dbt_version": "1.8.2", "profile_name": "my_dbt_trino_project", "target_name": "dev", "node_id": "model.my_dbt_trino_project.mart_user_level_by_gender"} */
alter table "datalake"."analytics"."mart_user_level_by_gender" rename to "datalake"."analytics"."mart_user_level_by_gender__dbt_backup"
[0m16:29:37.285049 [debug] [Thread-1 (]: SQL status: SUCCESS in 0.0 seconds
[0m16:29:37.300682 [debug] [Thread-1 (]: Using trino connection "model.my_dbt_trino_project.mart_user_level_by_gender"
[0m16:29:37.300682 [debug] [Thread-1 (]: On model.my_dbt_trino_project.mart_user_level_by_gender: /* {"app": "dbt", "dbt_version": "1.8.2", "profile_name": "my_dbt_trino_project", "target_name": "dev", "node_id": "model.my_dbt_trino_project.mart_user_level_by_gender"} */
alter table "datalake"."analytics"."mart_user_level_by_gender__dbt_tmp" rename to "datalake"."analytics"."mart_user_level_by_gender"
[0m16:29:37.380855 [debug] [Thread-1 (]: SQL status: SUCCESS in 0.0 seconds
[0m16:29:37.380855 [debug] [Thread-1 (]: Applying DROP to: "datalake"."analytics"."mart_user_level_by_gender__dbt_backup"
[0m16:29:37.380855 [debug] [Thread-1 (]: Using trino connection "model.my_dbt_trino_project.mart_user_level_by_gender"
[0m16:29:37.380855 [debug] [Thread-1 (]: On model.my_dbt_trino_project.mart_user_level_by_gender: /* {"app": "dbt", "dbt_version": "1.8.2", "profile_name": "my_dbt_trino_project", "target_name": "dev", "node_id": "model.my_dbt_trino_project.mart_user_level_by_gender"} */

    drop table if exists "datalake"."analytics"."mart_user_level_by_gender__dbt_backup"
[0m16:29:37.529610 [debug] [Thread-1 (]: SQL status: SUCCESS in 0.0 seconds
[0m16:29:37.534894 [debug] [Thread-1 (]: On model.my_dbt_trino_project.mart_user_level_by_gender: ROLLBACK
[0m16:29:37.534894 [debug] [Thread-1 (]: On model.my_dbt_trino_project.mart_user_level_by_gender: Close
[0m16:29:37.534894 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '2657ce0c-1a6e-435b-b73d-64436f55d2be', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000001BC42B8F3D0>]}
[0m16:29:37.534894 [info ] [Thread-1 (]: 10 of 15 OK created sql table model analytics.mart_user_level_by_gender ........ [[32mSUCCESS[0m in 0.66s]
[0m16:29:37.534894 [debug] [Thread-1 (]: Finished running node model.my_dbt_trino_project.mart_user_level_by_gender
[0m16:29:37.534894 [debug] [Thread-1 (]: Began running node model.my_dbt_trino_project.mart_hourly_stream_evolution
[0m16:29:37.534894 [info ] [Thread-1 (]: 11 of 15 START sql table model analytics.mart_hourly_stream_evolution .......... [RUN]
[0m16:29:37.534894 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.my_dbt_trino_project.mart_user_level_by_gender, now model.my_dbt_trino_project.mart_hourly_stream_evolution)
[0m16:29:37.534894 [debug] [Thread-1 (]: Began compiling node model.my_dbt_trino_project.mart_hourly_stream_evolution
[0m16:29:37.542141 [debug] [Thread-1 (]: Writing injected SQL for node "model.my_dbt_trino_project.mart_hourly_stream_evolution"
[0m16:29:37.542141 [debug] [Thread-1 (]: Began executing node model.my_dbt_trino_project.mart_hourly_stream_evolution
[0m16:29:37.544647 [debug] [Thread-1 (]: Writing runtime sql for node "model.my_dbt_trino_project.mart_hourly_stream_evolution"
[0m16:29:37.544647 [debug] [Thread-1 (]: Using trino connection "model.my_dbt_trino_project.mart_hourly_stream_evolution"
[0m16:29:37.544647 [debug] [Thread-1 (]: On model.my_dbt_trino_project.mart_hourly_stream_evolution: /* {"app": "dbt", "dbt_version": "1.8.2", "profile_name": "my_dbt_trino_project", "target_name": "dev", "node_id": "model.my_dbt_trino_project.mart_hourly_stream_evolution"} */

  
    

    create table "datalake"."analytics"."mart_hourly_stream_evolution__dbt_tmp"
      
      
    as (
      

SELECT
    stream_date,
    stream_hour,
    total_streams,
    SUM(total_streams) OVER (PARTITION BY stream_date ORDER BY stream_hour) AS cumulative_streams
FROM "datalake"."analytics_stage"."stg_streams_hourly"
ORDER BY
    stream_date,
    stream_hour
    )
[0m16:29:37.544647 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m16:29:37.835844 [debug] [Thread-1 (]: SQL status: SUCCESS in 0.0 seconds
[0m16:29:37.838351 [debug] [Thread-1 (]: Using trino connection "model.my_dbt_trino_project.mart_hourly_stream_evolution"
[0m16:29:37.841696 [debug] [Thread-1 (]: On model.my_dbt_trino_project.mart_hourly_stream_evolution: /* {"app": "dbt", "dbt_version": "1.8.2", "profile_name": "my_dbt_trino_project", "target_name": "dev", "node_id": "model.my_dbt_trino_project.mart_hourly_stream_evolution"} */
alter table "datalake"."analytics"."mart_hourly_stream_evolution" rename to "datalake"."analytics"."mart_hourly_stream_evolution__dbt_backup"
[0m16:29:37.933868 [debug] [Thread-1 (]: SQL status: SUCCESS in 0.0 seconds
[0m16:29:37.935380 [debug] [Thread-1 (]: Using trino connection "model.my_dbt_trino_project.mart_hourly_stream_evolution"
[0m16:29:37.935380 [debug] [Thread-1 (]: On model.my_dbt_trino_project.mart_hourly_stream_evolution: /* {"app": "dbt", "dbt_version": "1.8.2", "profile_name": "my_dbt_trino_project", "target_name": "dev", "node_id": "model.my_dbt_trino_project.mart_hourly_stream_evolution"} */
alter table "datalake"."analytics"."mart_hourly_stream_evolution__dbt_tmp" rename to "datalake"."analytics"."mart_hourly_stream_evolution"
[0m16:29:38.026557 [debug] [Thread-1 (]: SQL status: SUCCESS in 0.0 seconds
[0m16:29:38.033659 [debug] [Thread-1 (]: Applying DROP to: "datalake"."analytics"."mart_hourly_stream_evolution__dbt_backup"
[0m16:29:38.034135 [debug] [Thread-1 (]: Using trino connection "model.my_dbt_trino_project.mart_hourly_stream_evolution"
[0m16:29:38.034135 [debug] [Thread-1 (]: On model.my_dbt_trino_project.mart_hourly_stream_evolution: /* {"app": "dbt", "dbt_version": "1.8.2", "profile_name": "my_dbt_trino_project", "target_name": "dev", "node_id": "model.my_dbt_trino_project.mart_hourly_stream_evolution"} */

    drop table if exists "datalake"."analytics"."mart_hourly_stream_evolution__dbt_backup"
[0m16:29:38.175525 [debug] [Thread-1 (]: SQL status: SUCCESS in 0.0 seconds
[0m16:29:38.175525 [debug] [Thread-1 (]: On model.my_dbt_trino_project.mart_hourly_stream_evolution: ROLLBACK
[0m16:29:38.175525 [debug] [Thread-1 (]: On model.my_dbt_trino_project.mart_hourly_stream_evolution: Close
[0m16:29:38.175525 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '2657ce0c-1a6e-435b-b73d-64436f55d2be', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000001BC41F0B650>]}
[0m16:29:38.175525 [info ] [Thread-1 (]: 11 of 15 OK created sql table model analytics.mart_hourly_stream_evolution ..... [[32mSUCCESS[0m in 0.64s]
[0m16:29:38.175525 [debug] [Thread-1 (]: Finished running node model.my_dbt_trino_project.mart_hourly_stream_evolution
[0m16:29:38.175525 [debug] [Thread-1 (]: Began running node model.my_dbt_trino_project.mart_top_songs_artists
[0m16:29:38.175525 [info ] [Thread-1 (]: 12 of 15 START sql table model analytics.mart_top_songs_artists ................ [RUN]
[0m16:29:38.175525 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.my_dbt_trino_project.mart_hourly_stream_evolution, now model.my_dbt_trino_project.mart_top_songs_artists)
[0m16:29:38.175525 [debug] [Thread-1 (]: Began compiling node model.my_dbt_trino_project.mart_top_songs_artists
[0m16:29:38.175525 [debug] [Thread-1 (]: Writing injected SQL for node "model.my_dbt_trino_project.mart_top_songs_artists"
[0m16:29:38.175525 [debug] [Thread-1 (]: Began executing node model.my_dbt_trino_project.mart_top_songs_artists
[0m16:29:38.191646 [debug] [Thread-1 (]: Writing runtime sql for node "model.my_dbt_trino_project.mart_top_songs_artists"
[0m16:29:38.192681 [debug] [Thread-1 (]: Using trino connection "model.my_dbt_trino_project.mart_top_songs_artists"
[0m16:29:38.193685 [debug] [Thread-1 (]: On model.my_dbt_trino_project.mart_top_songs_artists: /* {"app": "dbt", "dbt_version": "1.8.2", "profile_name": "my_dbt_trino_project", "target_name": "dev", "node_id": "model.my_dbt_trino_project.mart_top_songs_artists"} */

  
    

    create table "datalake"."analytics"."mart_top_songs_artists__dbt_tmp"
      
      
    as (
      

WITH top_songs AS (
    SELECT
        artist,
        song,
        play_count
    FROM "datalake"."analytics_stage"."stg_top_songs_artists"
)

SELECT
    artist,
    song,
    play_count
FROM top_songs
    )
[0m16:29:38.193825 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m16:29:38.506364 [debug] [Thread-1 (]: SQL status: SUCCESS in 0.0 seconds
[0m16:29:38.510351 [debug] [Thread-1 (]: Using trino connection "model.my_dbt_trino_project.mart_top_songs_artists"
[0m16:29:38.510351 [debug] [Thread-1 (]: On model.my_dbt_trino_project.mart_top_songs_artists: /* {"app": "dbt", "dbt_version": "1.8.2", "profile_name": "my_dbt_trino_project", "target_name": "dev", "node_id": "model.my_dbt_trino_project.mart_top_songs_artists"} */
alter table "datalake"."analytics"."mart_top_songs_artists" rename to "datalake"."analytics"."mart_top_songs_artists__dbt_backup"
[0m16:29:38.607577 [debug] [Thread-1 (]: SQL status: SUCCESS in 0.0 seconds
[0m16:29:38.611214 [debug] [Thread-1 (]: Using trino connection "model.my_dbt_trino_project.mart_top_songs_artists"
[0m16:29:38.611734 [debug] [Thread-1 (]: On model.my_dbt_trino_project.mart_top_songs_artists: /* {"app": "dbt", "dbt_version": "1.8.2", "profile_name": "my_dbt_trino_project", "target_name": "dev", "node_id": "model.my_dbt_trino_project.mart_top_songs_artists"} */
alter table "datalake"."analytics"."mart_top_songs_artists__dbt_tmp" rename to "datalake"."analytics"."mart_top_songs_artists"
[0m16:29:38.711611 [debug] [Thread-1 (]: SQL status: SUCCESS in 0.0 seconds
[0m16:29:38.711611 [debug] [Thread-1 (]: Applying DROP to: "datalake"."analytics"."mart_top_songs_artists__dbt_backup"
[0m16:29:38.711611 [debug] [Thread-1 (]: Using trino connection "model.my_dbt_trino_project.mart_top_songs_artists"
[0m16:29:38.711611 [debug] [Thread-1 (]: On model.my_dbt_trino_project.mart_top_songs_artists: /* {"app": "dbt", "dbt_version": "1.8.2", "profile_name": "my_dbt_trino_project", "target_name": "dev", "node_id": "model.my_dbt_trino_project.mart_top_songs_artists"} */

    drop table if exists "datalake"."analytics"."mart_top_songs_artists__dbt_backup"
[0m16:29:38.834579 [debug] [Thread-1 (]: SQL status: SUCCESS in 0.0 seconds
[0m16:29:38.834579 [debug] [Thread-1 (]: On model.my_dbt_trino_project.mart_top_songs_artists: ROLLBACK
[0m16:29:38.834579 [debug] [Thread-1 (]: On model.my_dbt_trino_project.mart_top_songs_artists: Close
[0m16:29:38.834579 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '2657ce0c-1a6e-435b-b73d-64436f55d2be', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000001BC424C9DD0>]}
[0m16:29:38.834579 [info ] [Thread-1 (]: 12 of 15 OK created sql table model analytics.mart_top_songs_artists ........... [[32mSUCCESS[0m in 0.66s]
[0m16:29:38.834579 [debug] [Thread-1 (]: Finished running node model.my_dbt_trino_project.mart_top_songs_artists
[0m16:29:38.834579 [debug] [Thread-1 (]: Began running node model.my_dbt_trino_project.mart_total_unique_users
[0m16:29:38.841086 [info ] [Thread-1 (]: 13 of 15 START sql table model analytics.mart_total_unique_users ............... [RUN]
[0m16:29:38.841086 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.my_dbt_trino_project.mart_top_songs_artists, now model.my_dbt_trino_project.mart_total_unique_users)
[0m16:29:38.841086 [debug] [Thread-1 (]: Began compiling node model.my_dbt_trino_project.mart_total_unique_users
[0m16:29:38.842601 [debug] [Thread-1 (]: Writing injected SQL for node "model.my_dbt_trino_project.mart_total_unique_users"
[0m16:29:38.842601 [debug] [Thread-1 (]: Began executing node model.my_dbt_trino_project.mart_total_unique_users
[0m16:29:38.842601 [debug] [Thread-1 (]: Writing runtime sql for node "model.my_dbt_trino_project.mart_total_unique_users"
[0m16:29:38.842601 [debug] [Thread-1 (]: Using trino connection "model.my_dbt_trino_project.mart_total_unique_users"
[0m16:29:38.842601 [debug] [Thread-1 (]: On model.my_dbt_trino_project.mart_total_unique_users: /* {"app": "dbt", "dbt_version": "1.8.2", "profile_name": "my_dbt_trino_project", "target_name": "dev", "node_id": "model.my_dbt_trino_project.mart_total_unique_users"} */

  
    

    create table "datalake"."analytics"."mart_total_unique_users__dbt_tmp"
      
      
    as (
      

SELECT
    total_unique_users
FROM "datalake"."analytics_stage"."stg_unique_users"
    )
[0m16:29:38.842601 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m16:29:39.139166 [debug] [Thread-1 (]: SQL status: SUCCESS in 0.0 seconds
[0m16:29:39.139166 [debug] [Thread-1 (]: Using trino connection "model.my_dbt_trino_project.mart_total_unique_users"
[0m16:29:39.139166 [debug] [Thread-1 (]: On model.my_dbt_trino_project.mart_total_unique_users: /* {"app": "dbt", "dbt_version": "1.8.2", "profile_name": "my_dbt_trino_project", "target_name": "dev", "node_id": "model.my_dbt_trino_project.mart_total_unique_users"} */
alter table "datalake"."analytics"."mart_total_unique_users" rename to "datalake"."analytics"."mart_total_unique_users__dbt_backup"
[0m16:29:39.237609 [debug] [Thread-1 (]: SQL status: SUCCESS in 0.0 seconds
[0m16:29:39.237609 [debug] [Thread-1 (]: Using trino connection "model.my_dbt_trino_project.mart_total_unique_users"
[0m16:29:39.237609 [debug] [Thread-1 (]: On model.my_dbt_trino_project.mart_total_unique_users: /* {"app": "dbt", "dbt_version": "1.8.2", "profile_name": "my_dbt_trino_project", "target_name": "dev", "node_id": "model.my_dbt_trino_project.mart_total_unique_users"} */
alter table "datalake"."analytics"."mart_total_unique_users__dbt_tmp" rename to "datalake"."analytics"."mart_total_unique_users"
[0m16:29:39.330092 [debug] [Thread-1 (]: SQL status: SUCCESS in 0.0 seconds
[0m16:29:39.330092 [debug] [Thread-1 (]: Applying DROP to: "datalake"."analytics"."mart_total_unique_users__dbt_backup"
[0m16:29:39.330092 [debug] [Thread-1 (]: Using trino connection "model.my_dbt_trino_project.mart_total_unique_users"
[0m16:29:39.330092 [debug] [Thread-1 (]: On model.my_dbt_trino_project.mart_total_unique_users: /* {"app": "dbt", "dbt_version": "1.8.2", "profile_name": "my_dbt_trino_project", "target_name": "dev", "node_id": "model.my_dbt_trino_project.mart_total_unique_users"} */

    drop table if exists "datalake"."analytics"."mart_total_unique_users__dbt_backup"
[0m16:29:39.451282 [debug] [Thread-1 (]: SQL status: SUCCESS in 0.0 seconds
[0m16:29:39.457093 [debug] [Thread-1 (]: On model.my_dbt_trino_project.mart_total_unique_users: ROLLBACK
[0m16:29:39.457573 [debug] [Thread-1 (]: On model.my_dbt_trino_project.mart_total_unique_users: Close
[0m16:29:39.457573 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '2657ce0c-1a6e-435b-b73d-64436f55d2be', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000001BC442EAAD0>]}
[0m16:29:39.457573 [info ] [Thread-1 (]: 13 of 15 OK created sql table model analytics.mart_total_unique_users .......... [[32mSUCCESS[0m in 0.62s]
[0m16:29:39.459466 [debug] [Thread-1 (]: Finished running node model.my_dbt_trino_project.mart_total_unique_users
[0m16:29:39.460182 [debug] [Thread-1 (]: Began running node model.my_dbt_trino_project.mart_user_activity_per_country
[0m16:29:39.460182 [info ] [Thread-1 (]: 14 of 15 SKIP relation analytics.mart_user_activity_per_country ................ [[33mSKIP[0m]
[0m16:29:39.460182 [debug] [Thread-1 (]: Finished running node model.my_dbt_trino_project.mart_user_activity_per_country
[0m16:29:39.460182 [debug] [Thread-1 (]: Began running node model.my_dbt_trino_project.mart_user_activity_per_state
[0m16:29:39.460182 [info ] [Thread-1 (]: 15 of 15 START sql table model analytics.mart_user_activity_per_state .......... [RUN]
[0m16:29:39.460182 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.my_dbt_trino_project.mart_total_unique_users, now model.my_dbt_trino_project.mart_user_activity_per_state)
[0m16:29:39.463135 [debug] [Thread-1 (]: Began compiling node model.my_dbt_trino_project.mart_user_activity_per_state
[0m16:29:39.463479 [debug] [Thread-1 (]: Writing injected SQL for node "model.my_dbt_trino_project.mart_user_activity_per_state"
[0m16:29:39.463479 [debug] [Thread-1 (]: Began executing node model.my_dbt_trino_project.mart_user_activity_per_state
[0m16:29:39.463479 [debug] [Thread-1 (]: Writing runtime sql for node "model.my_dbt_trino_project.mart_user_activity_per_state"
[0m16:29:39.463479 [debug] [Thread-1 (]: Using trino connection "model.my_dbt_trino_project.mart_user_activity_per_state"
[0m16:29:39.463479 [debug] [Thread-1 (]: On model.my_dbt_trino_project.mart_user_activity_per_state: /* {"app": "dbt", "dbt_version": "1.8.2", "profile_name": "my_dbt_trino_project", "target_name": "dev", "node_id": "model.my_dbt_trino_project.mart_user_activity_per_state"} */

  
    

    create table "datalake"."analytics"."mart_user_activity_per_state__dbt_tmp"
      
      
    as (
      

SELECT
  state,
  city,
  SUM(activity_count) AS total_activity
FROM "datalake"."analytics_stage"."stg_user_activity_per_location"
GROUP BY state, city
ORDER BY state, SUM(activity_count) DESC
    )
[0m16:29:39.463479 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m16:29:39.776824 [debug] [Thread-1 (]: SQL status: SUCCESS in 0.0 seconds
[0m16:29:39.778848 [debug] [Thread-1 (]: Using trino connection "model.my_dbt_trino_project.mart_user_activity_per_state"
[0m16:29:39.778848 [debug] [Thread-1 (]: On model.my_dbt_trino_project.mart_user_activity_per_state: /* {"app": "dbt", "dbt_version": "1.8.2", "profile_name": "my_dbt_trino_project", "target_name": "dev", "node_id": "model.my_dbt_trino_project.mart_user_activity_per_state"} */
alter table "datalake"."analytics"."mart_user_activity_per_state" rename to "datalake"."analytics"."mart_user_activity_per_state__dbt_backup"
[0m16:29:39.873262 [debug] [Thread-1 (]: SQL status: SUCCESS in 0.0 seconds
[0m16:29:39.876270 [debug] [Thread-1 (]: Using trino connection "model.my_dbt_trino_project.mart_user_activity_per_state"
[0m16:29:39.876776 [debug] [Thread-1 (]: On model.my_dbt_trino_project.mart_user_activity_per_state: /* {"app": "dbt", "dbt_version": "1.8.2", "profile_name": "my_dbt_trino_project", "target_name": "dev", "node_id": "model.my_dbt_trino_project.mart_user_activity_per_state"} */
alter table "datalake"."analytics"."mart_user_activity_per_state__dbt_tmp" rename to "datalake"."analytics"."mart_user_activity_per_state"
[0m16:29:39.971386 [debug] [Thread-1 (]: SQL status: SUCCESS in 0.0 seconds
[0m16:29:39.971386 [debug] [Thread-1 (]: Applying DROP to: "datalake"."analytics"."mart_user_activity_per_state__dbt_backup"
[0m16:29:39.971386 [debug] [Thread-1 (]: Using trino connection "model.my_dbt_trino_project.mart_user_activity_per_state"
[0m16:29:39.971386 [debug] [Thread-1 (]: On model.my_dbt_trino_project.mart_user_activity_per_state: /* {"app": "dbt", "dbt_version": "1.8.2", "profile_name": "my_dbt_trino_project", "target_name": "dev", "node_id": "model.my_dbt_trino_project.mart_user_activity_per_state"} */

    drop table if exists "datalake"."analytics"."mart_user_activity_per_state__dbt_backup"
[0m16:29:40.101202 [debug] [Thread-1 (]: SQL status: SUCCESS in 0.0 seconds
[0m16:29:40.107453 [debug] [Thread-1 (]: On model.my_dbt_trino_project.mart_user_activity_per_state: ROLLBACK
[0m16:29:40.107453 [debug] [Thread-1 (]: On model.my_dbt_trino_project.mart_user_activity_per_state: Close
[0m16:29:40.107453 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '2657ce0c-1a6e-435b-b73d-64436f55d2be', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000001BC4431F950>]}
[0m16:29:40.109942 [info ] [Thread-1 (]: 15 of 15 OK created sql table model analytics.mart_user_activity_per_state ..... [[32mSUCCESS[0m in 0.65s]
[0m16:29:40.109942 [debug] [Thread-1 (]: Finished running node model.my_dbt_trino_project.mart_user_activity_per_state
[0m16:29:40.109942 [debug] [MainThread]: On master: COMMIT
[0m16:29:40.109942 [debug] [MainThread]: Connection 'master' was properly closed.
[0m16:29:40.109942 [debug] [MainThread]: Connection 'list_datalake' was properly closed.
[0m16:29:40.109942 [debug] [MainThread]: Connection 'list_datalake_analytics_stage' was properly closed.
[0m16:29:40.109942 [debug] [MainThread]: Connection 'model.my_dbt_trino_project.mart_user_activity_per_state' was properly closed.
[0m16:29:40.109942 [info ] [MainThread]: 
[0m16:29:40.109942 [info ] [MainThread]: Finished running 3 incremental models, 5 view models, 7 table models in 0 hours 0 minutes and 8.46 seconds (8.46s).
[0m16:29:40.115448 [debug] [MainThread]: Command end result
[0m16:29:40.149392 [info ] [MainThread]: 
[0m16:29:40.150584 [info ] [MainThread]: [31mCompleted with 1 error and 0 warnings:[0m
[0m16:29:40.151244 [info ] [MainThread]: 
[0m16:29:40.151244 [error] [MainThread]:   Database Error in model stg_user_activity_per_country (models\stage\stg_user_activity_per_country.sql)
  TrinoUserError(type=USER_ERROR, name=TYPE_MISMATCH, message="line 17:3: UNION query has different number of fields: 4, 3", query_id=20240617_082936_00196_xsftb)
  compiled Code at target\run\my_dbt_trino_project\models\stage\stg_user_activity_per_country.sql
[0m16:29:40.152315 [info ] [MainThread]: 
[0m16:29:40.152938 [info ] [MainThread]: Done. PASS=13 WARN=0 ERROR=1 SKIP=1 TOTAL=15
[0m16:29:40.153498 [debug] [MainThread]: Command `dbt run` failed at 16:29:40.153498 after 9.31 seconds
[0m16:29:40.153498 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000001BC3D57E8D0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000001BC3D57F910>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000001BC42C95DD0>]}
[0m16:29:40.155006 [debug] [MainThread]: Flushing usage events
[0m16:35:22.807897 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x00000221B2EBA610>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x00000221B4EB80D0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x00000221B5617D10>]}


============================== 16:35:22.810895 | 6d445026-1a06-40d9-9df1-6e0b60904b48 ==============================
[0m16:35:22.810895 [info ] [MainThread]: Running with dbt=1.8.2
[0m16:35:22.811895 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'indirect_selection': 'eager', 'log_cache_events': 'False', 'write_json': 'True', 'partial_parse': 'True', 'cache_selected_only': 'False', 'warn_error': 'None', 'debug': 'False', 'fail_fast': 'False', 'log_path': 'C:\\Users\\ASUS\\Desktop\\work\\Iceberg-Dbt-Trino-Hive-modern-open-source-data-stack-main\\dbt\\logs', 'profiles_dir': 'C:\\Users\\ASUS\\Desktop\\work\\Iceberg-Dbt-Trino-Hive-modern-open-source-data-stack-main\\dbt', 'version_check': 'True', 'use_colors': 'True', 'use_experimental_parser': 'False', 'no_print': 'None', 'quiet': 'False', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'invocation_command': 'dbt run', 'log_format': 'default', 'static_parser': 'True', 'target_path': 'None', 'introspect': 'True', 'send_anonymous_usage_stats': 'True'}
[0m16:35:23.110068 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': '6d445026-1a06-40d9-9df1-6e0b60904b48', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x00000221B55D4790>]}
[0m16:35:23.145019 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': '6d445026-1a06-40d9-9df1-6e0b60904b48', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x00000221B2755750>]}
[0m16:35:23.146529 [info ] [MainThread]: Registered adapter: trino=1.8.0
[0m16:35:23.156345 [debug] [MainThread]: checksum: f0a141b9de567cb7f131613ba2682f40b3a1c6a157f81c6e5435862eff68f109, vars: {}, profile: , target: , version: 1.8.2
[0m16:35:23.305088 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 1 files changed.
[0m16:35:23.306089 [debug] [MainThread]: Partial parsing: updated file: my_dbt_trino_project://models\source\src_auth_events.sql
[0m16:35:23.454461 [warn ] [MainThread]: [[33mWARNING[0m]: Deprecated functionality
The `tests` config has been renamed to `data_tests`. Please see
https://docs.getdbt.com/docs/build/data-tests#new-data_tests-syntax for more
information.
[0m16:35:23.455477 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'deprecation', 'label': '6d445026-1a06-40d9-9df1-6e0b60904b48', 'property_': 'warn', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x00000221B5E95190>]}
[0m16:35:23.597859 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': '6d445026-1a06-40d9-9df1-6e0b60904b48', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x00000221B6F3B250>]}
[0m16:35:23.666452 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': '6d445026-1a06-40d9-9df1-6e0b60904b48', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x00000221B5C29450>]}
[0m16:35:23.667452 [info ] [MainThread]: Found 15 models, 7 data tests, 3 sources, 559 macros
[0m16:35:23.668460 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '6d445026-1a06-40d9-9df1-6e0b60904b48', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x00000221B6FCE6D0>]}
[0m16:35:23.669453 [info ] [MainThread]: 
[0m16:35:23.670452 [debug] [MainThread]: Acquiring new trino connection 'master'
[0m16:35:23.675453 [debug] [ThreadPool]: Acquiring new trino connection 'list_datalake'
[0m16:35:23.779059 [debug] [ThreadPool]: Using trino connection "list_datalake"
[0m16:35:23.780060 [debug] [ThreadPool]: On list_datalake: /* {"app": "dbt", "dbt_version": "1.8.2", "profile_name": "my_dbt_trino_project", "target_name": "dev", "connection_name": "list_datalake"} */

    select schema_name
    from "datalake".INFORMATION_SCHEMA.schemata
[0m16:35:23.780060 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m16:35:23.837068 [debug] [ThreadPool]: SQL status: SUCCESS in 0.0 seconds
[0m16:35:23.838069 [debug] [ThreadPool]: On list_datalake: Close
[0m16:35:23.841068 [debug] [ThreadPool]: Using trino connection "list_datalake"
[0m16:35:23.841068 [debug] [ThreadPool]: On list_datalake: /* {"app": "dbt", "dbt_version": "1.8.2", "profile_name": "my_dbt_trino_project", "target_name": "dev", "connection_name": "list_datalake"} */

    select schema_name
    from "datalake".INFORMATION_SCHEMA.schemata
[0m16:35:23.841068 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m16:35:23.887910 [debug] [ThreadPool]: SQL status: SUCCESS in 0.0 seconds
[0m16:35:23.888918 [debug] [ThreadPool]: On list_datalake: Close
[0m16:35:23.891917 [debug] [ThreadPool]: Using trino connection "list_datalake"
[0m16:35:23.891917 [debug] [ThreadPool]: On list_datalake: /* {"app": "dbt", "dbt_version": "1.8.2", "profile_name": "my_dbt_trino_project", "target_name": "dev", "connection_name": "list_datalake"} */

    select schema_name
    from "datalake".INFORMATION_SCHEMA.schemata
[0m16:35:23.892917 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m16:35:23.919915 [debug] [ThreadPool]: SQL status: SUCCESS in 0.0 seconds
[0m16:35:23.920923 [debug] [ThreadPool]: On list_datalake: Close
[0m16:35:23.922921 [debug] [ThreadPool]: Acquiring new trino connection 'list_datalake_analytics_source'
[0m16:35:23.932935 [debug] [ThreadPool]: Using trino connection "list_datalake_analytics_source"
[0m16:35:23.933939 [debug] [ThreadPool]: On list_datalake_analytics_source: /* {"app": "dbt", "dbt_version": "1.8.2", "profile_name": "my_dbt_trino_project", "target_name": "dev", "connection_name": "list_datalake_analytics_source"} */
select
      t.table_catalog as database,
      t.table_name as name,
      t.table_schema as schema,
      case when mv.name is not null then 'materialized_view'
           when t.table_type = 'BASE TABLE' then 'table'
           when t.table_type = 'VIEW' then 'view'
           else t.table_type
      end as table_type
    from "datalake".INFORMATION_SCHEMA.tables t
    left join (
            select * from system.metadata.materialized_views
            where catalog_name = 'datalake'
              and schema_name = 'analytics_source') mv
          on mv.catalog_name = t.table_catalog and mv.schema_name = t.table_schema and mv.name = t.table_name
    where t.table_schema = 'analytics_source'
[0m16:35:23.933939 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m16:35:24.022523 [debug] [ThreadPool]: SQL status: SUCCESS in 0.0 seconds
[0m16:35:24.024038 [debug] [ThreadPool]: On list_datalake_analytics_source: ROLLBACK
[0m16:35:24.024038 [debug] [ThreadPool]: On list_datalake_analytics_source: Close
[0m16:35:24.025035 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_datalake_analytics_source, now list_datalake_analytics_stage)
[0m16:35:24.028434 [debug] [ThreadPool]: Using trino connection "list_datalake_analytics_stage"
[0m16:35:24.029433 [debug] [ThreadPool]: On list_datalake_analytics_stage: /* {"app": "dbt", "dbt_version": "1.8.2", "profile_name": "my_dbt_trino_project", "target_name": "dev", "connection_name": "list_datalake_analytics_stage"} */
select
      t.table_catalog as database,
      t.table_name as name,
      t.table_schema as schema,
      case when mv.name is not null then 'materialized_view'
           when t.table_type = 'BASE TABLE' then 'table'
           when t.table_type = 'VIEW' then 'view'
           else t.table_type
      end as table_type
    from "datalake".INFORMATION_SCHEMA.tables t
    left join (
            select * from system.metadata.materialized_views
            where catalog_name = 'datalake'
              and schema_name = 'analytics_stage') mv
          on mv.catalog_name = t.table_catalog and mv.schema_name = t.table_schema and mv.name = t.table_name
    where t.table_schema = 'analytics_stage'
[0m16:35:24.029433 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m16:35:24.093057 [debug] [ThreadPool]: SQL status: SUCCESS in 0.0 seconds
[0m16:35:24.094623 [debug] [ThreadPool]: On list_datalake_analytics_stage: ROLLBACK
[0m16:35:24.094623 [debug] [ThreadPool]: On list_datalake_analytics_stage: Close
[0m16:35:24.095628 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_datalake_analytics_stage, now list_datalake_analytics)
[0m16:35:24.099694 [debug] [ThreadPool]: Using trino connection "list_datalake_analytics"
[0m16:35:24.100695 [debug] [ThreadPool]: On list_datalake_analytics: /* {"app": "dbt", "dbt_version": "1.8.2", "profile_name": "my_dbt_trino_project", "target_name": "dev", "connection_name": "list_datalake_analytics"} */
select
      t.table_catalog as database,
      t.table_name as name,
      t.table_schema as schema,
      case when mv.name is not null then 'materialized_view'
           when t.table_type = 'BASE TABLE' then 'table'
           when t.table_type = 'VIEW' then 'view'
           else t.table_type
      end as table_type
    from "datalake".INFORMATION_SCHEMA.tables t
    left join (
            select * from system.metadata.materialized_views
            where catalog_name = 'datalake'
              and schema_name = 'analytics') mv
          on mv.catalog_name = t.table_catalog and mv.schema_name = t.table_schema and mv.name = t.table_name
    where t.table_schema = 'analytics'
[0m16:35:24.100695 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m16:35:24.173324 [debug] [ThreadPool]: SQL status: SUCCESS in 0.0 seconds
[0m16:35:24.174330 [debug] [ThreadPool]: On list_datalake_analytics: ROLLBACK
[0m16:35:24.174330 [debug] [ThreadPool]: On list_datalake_analytics: Close
[0m16:35:24.176627 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '6d445026-1a06-40d9-9df1-6e0b60904b48', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x00000221B6F48250>]}
[0m16:35:24.176627 [debug] [MainThread]: On master: COMMIT
[0m16:35:24.177633 [info ] [MainThread]: Concurrency: 1 threads (target='dev')
[0m16:35:24.177633 [info ] [MainThread]: 
[0m16:35:24.180634 [debug] [Thread-1 (]: Began running node model.my_dbt_trino_project.src_auth_events
[0m16:35:24.180634 [info ] [Thread-1 (]: 1 of 15 START sql table model analytics_source.src_auth_events ................. [RUN]
[0m16:35:24.182139 [debug] [Thread-1 (]: Acquiring new trino connection 'model.my_dbt_trino_project.src_auth_events'
[0m16:35:24.182139 [debug] [Thread-1 (]: Began compiling node model.my_dbt_trino_project.src_auth_events
[0m16:35:24.186659 [debug] [Thread-1 (]: Writing injected SQL for node "model.my_dbt_trino_project.src_auth_events"
[0m16:35:24.187670 [debug] [Thread-1 (]: Began executing node model.my_dbt_trino_project.src_auth_events
[0m16:35:24.223775 [debug] [Thread-1 (]: Writing runtime sql for node "model.my_dbt_trino_project.src_auth_events"
[0m16:35:24.227475 [debug] [Thread-1 (]: Using trino connection "model.my_dbt_trino_project.src_auth_events"
[0m16:35:24.228004 [debug] [Thread-1 (]: On model.my_dbt_trino_project.src_auth_events: /* {"app": "dbt", "dbt_version": "1.8.2", "profile_name": "my_dbt_trino_project", "target_name": "dev", "node_id": "model.my_dbt_trino_project.src_auth_events"} */

  
    

    create table "datalake"."analytics_source"."src_auth_events__dbt_tmp"
      
      
    as (
      

with source as (
    select
        CAST(ts AS VARCHAR) as id, 
        ts,
        CAST(sessionId AS VARCHAR) as sessionId,
        level,
        itemInSession,
        city,
        zip,
        state,
        userAgent,
        CAST(NULLIF(lon, '') AS double) as lon,
        CAST(NULLIF(lat, '') AS double) as lat,
        CAST(FLOOR(CAST(NULLIF(userId, '') AS DOUBLE)) AS INT) as userId, 
        lastName,
        firstName,
        gender,
        CAST(FLOOR(CAST(NULLIF(registration, '') AS DOUBLE)) AS BIGINT) as registration,
        success
    from "oltp"."public"."auth_events"
)

select
    id,
    ts,
    sessionId,
    level,
    itemInSession,
    city,
    zip,
    state,
    userAgent,
    lon,
    lat,
    userId,
    lastName,
    firstName,
    gender,
    registration, 
    CASE 
        WHEN CAST(success AS VARCHAR) = 't' THEN true 
        WHEN CAST(success AS VARCHAR) = 'f' THEN false
        ELSE NULL 
    END AS success_boolean
from source


    )
[0m16:35:24.228535 [debug] [Thread-1 (]: Opening a new connection, currently in state init
[0m16:35:24.479708 [debug] [Thread-1 (]: SQL status: SUCCESS in 0.0 seconds
[0m16:35:24.485218 [debug] [Thread-1 (]: Using trino connection "model.my_dbt_trino_project.src_auth_events"
[0m16:35:24.485218 [debug] [Thread-1 (]: On model.my_dbt_trino_project.src_auth_events: /* {"app": "dbt", "dbt_version": "1.8.2", "profile_name": "my_dbt_trino_project", "target_name": "dev", "node_id": "model.my_dbt_trino_project.src_auth_events"} */
alter table "datalake"."analytics_source"."src_auth_events" rename to "datalake"."analytics_source"."src_auth_events__dbt_backup"
[0m16:35:24.576600 [debug] [Thread-1 (]: SQL status: SUCCESS in 0.0 seconds
[0m16:35:24.579597 [debug] [Thread-1 (]: Using trino connection "model.my_dbt_trino_project.src_auth_events"
[0m16:35:24.579597 [debug] [Thread-1 (]: On model.my_dbt_trino_project.src_auth_events: /* {"app": "dbt", "dbt_version": "1.8.2", "profile_name": "my_dbt_trino_project", "target_name": "dev", "node_id": "model.my_dbt_trino_project.src_auth_events"} */
alter table "datalake"."analytics_source"."src_auth_events__dbt_tmp" rename to "datalake"."analytics_source"."src_auth_events"
[0m16:35:24.664131 [debug] [Thread-1 (]: SQL status: SUCCESS in 0.0 seconds
[0m16:35:24.669128 [debug] [Thread-1 (]: Applying DROP to: "datalake"."analytics_source"."src_auth_events__dbt_backup"
[0m16:35:24.671228 [debug] [Thread-1 (]: Using trino connection "model.my_dbt_trino_project.src_auth_events"
[0m16:35:24.671228 [debug] [Thread-1 (]: On model.my_dbt_trino_project.src_auth_events: /* {"app": "dbt", "dbt_version": "1.8.2", "profile_name": "my_dbt_trino_project", "target_name": "dev", "node_id": "model.my_dbt_trino_project.src_auth_events"} */

    drop table if exists "datalake"."analytics_source"."src_auth_events__dbt_backup"
[0m16:35:24.788496 [debug] [Thread-1 (]: SQL status: SUCCESS in 0.0 seconds
[0m16:35:24.800477 [debug] [Thread-1 (]: On model.my_dbt_trino_project.src_auth_events: ROLLBACK
[0m16:35:24.801477 [debug] [Thread-1 (]: On model.my_dbt_trino_project.src_auth_events: Close
[0m16:35:24.802478 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '6d445026-1a06-40d9-9df1-6e0b60904b48', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x00000221B725D550>]}
[0m16:35:24.803480 [info ] [Thread-1 (]: 1 of 15 OK created sql table model analytics_source.src_auth_events ............ [[32mSUCCESS[0m in 0.62s]
[0m16:35:24.803480 [debug] [Thread-1 (]: Finished running node model.my_dbt_trino_project.src_auth_events
[0m16:35:24.804477 [debug] [Thread-1 (]: Began running node model.my_dbt_trino_project.src_listen_events
[0m16:35:24.804477 [info ] [Thread-1 (]: 2 of 15 START sql incremental model analytics_source.src_listen_events ......... [RUN]
[0m16:35:24.805481 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.my_dbt_trino_project.src_auth_events, now model.my_dbt_trino_project.src_listen_events)
[0m16:35:24.805481 [debug] [Thread-1 (]: Began compiling node model.my_dbt_trino_project.src_listen_events
[0m16:35:24.810478 [debug] [Thread-1 (]: Writing injected SQL for node "model.my_dbt_trino_project.src_listen_events"
[0m16:35:24.810478 [debug] [Thread-1 (]: Began executing node model.my_dbt_trino_project.src_listen_events
[0m16:35:24.836996 [debug] [Thread-1 (]: Using trino connection "model.my_dbt_trino_project.src_listen_events"
[0m16:35:24.836996 [debug] [Thread-1 (]: On model.my_dbt_trino_project.src_listen_events: /* {"app": "dbt", "dbt_version": "1.8.2", "profile_name": "my_dbt_trino_project", "target_name": "dev", "node_id": "model.my_dbt_trino_project.src_listen_events"} */

  
    

    create table "datalake"."analytics_source"."src_listen_events__dbt_tmp"
      
      
    as (
      

with source as (

    select
        CAST(_id AS VARCHAR) as id,
        artist,
        song,
        CAST(NULLIF(duration, '') AS DOUBLE) as duration,
        ts,
        sessionid,
        auth,
        level,
        CAST(NULLIF(itemInSession, '') AS INTEGER) as itemInSession,
        city,
        zip,
        state,
        country,
        userAgent,
        CAST(NULLIF(lon, '') AS DOUBLE) as lon,
        CAST(NULLIF(lat, '') AS DOUBLE) as lat,
        CAST(CAST(NULLIF(userId, '') AS DOUBLE) AS INTEGER) as userId,
 -- Assurez-vous que userId peut aussi être converti de cette manière.
        lastName,
        firstName,
        gender,
        CAST(CAST(NULLIF(registration, '') AS DOUBLE) AS BIGINT) as registration
    from "website"."demo"."listen_events"

)

select * from source



    -- this filter will only be applied on an incremental run
    where ts > (select max(ts) from "datalake"."analytics_source"."src_listen_events")


    )
[0m16:35:24.837994 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m16:35:25.001938 [debug] [Thread-1 (]: SQL status: SUCCESS in 0.0 seconds
[0m16:35:25.009761 [debug] [Thread-1 (]: Using trino connection "model.my_dbt_trino_project.src_listen_events"
[0m16:35:25.010762 [debug] [Thread-1 (]: On model.my_dbt_trino_project.src_listen_events: /* {"app": "dbt", "dbt_version": "1.8.2", "profile_name": "my_dbt_trino_project", "target_name": "dev", "node_id": "model.my_dbt_trino_project.src_listen_events"} */

    describe "datalake"."analytics_source"."src_listen_events__dbt_tmp"
[0m16:35:25.099198 [debug] [Thread-1 (]: SQL status: SUCCESS in 0.0 seconds
[0m16:35:25.102198 [debug] [Thread-1 (]: Using trino connection "model.my_dbt_trino_project.src_listen_events"
[0m16:35:25.103708 [debug] [Thread-1 (]: On model.my_dbt_trino_project.src_listen_events: /* {"app": "dbt", "dbt_version": "1.8.2", "profile_name": "my_dbt_trino_project", "target_name": "dev", "node_id": "model.my_dbt_trino_project.src_listen_events"} */

    describe "datalake"."analytics_source"."src_listen_events"
[0m16:35:25.185968 [debug] [Thread-1 (]: SQL status: SUCCESS in 0.0 seconds
[0m16:35:25.192024 [debug] [Thread-1 (]: Using trino connection "model.my_dbt_trino_project.src_listen_events"
[0m16:35:25.193530 [debug] [Thread-1 (]: On model.my_dbt_trino_project.src_listen_events: /* {"app": "dbt", "dbt_version": "1.8.2", "profile_name": "my_dbt_trino_project", "target_name": "dev", "node_id": "model.my_dbt_trino_project.src_listen_events"} */

    describe "datalake"."analytics_source"."src_listen_events"
[0m16:35:25.280344 [debug] [Thread-1 (]: SQL status: SUCCESS in 0.0 seconds
[0m16:35:25.288348 [debug] [Thread-1 (]: Writing runtime sql for node "model.my_dbt_trino_project.src_listen_events"
[0m16:35:25.290342 [debug] [Thread-1 (]: Using trino connection "model.my_dbt_trino_project.src_listen_events"
[0m16:35:25.291342 [debug] [Thread-1 (]: On model.my_dbt_trino_project.src_listen_events: /* {"app": "dbt", "dbt_version": "1.8.2", "profile_name": "my_dbt_trino_project", "target_name": "dev", "node_id": "model.my_dbt_trino_project.src_listen_events"} */
insert into "datalake"."analytics_source"."src_listen_events" ("id", "artist", "song", "duration", "ts", "sessionid", "auth", "level", "iteminsession", "city", "zip", "state", "country", "useragent", "lon", "lat", "userid", "lastname", "firstname", "gender", "registration")
    (
        select "id", "artist", "song", "duration", "ts", "sessionid", "auth", "level", "iteminsession", "city", "zip", "state", "country", "useragent", "lon", "lat", "userid", "lastname", "firstname", "gender", "registration"
        from "datalake"."analytics_source"."src_listen_events__dbt_tmp"
    )
[0m16:35:25.430102 [debug] [Thread-1 (]: SQL status: SUCCESS in 0.0 seconds
[0m16:35:25.433620 [debug] [Thread-1 (]: Applying DROP to: "datalake"."analytics_source"."src_listen_events__dbt_tmp"
[0m16:35:25.434630 [debug] [Thread-1 (]: Using trino connection "model.my_dbt_trino_project.src_listen_events"
[0m16:35:25.435632 [debug] [Thread-1 (]: On model.my_dbt_trino_project.src_listen_events: /* {"app": "dbt", "dbt_version": "1.8.2", "profile_name": "my_dbt_trino_project", "target_name": "dev", "node_id": "model.my_dbt_trino_project.src_listen_events"} */

    drop table if exists "datalake"."analytics_source"."src_listen_events__dbt_tmp"
[0m16:35:25.546181 [debug] [Thread-1 (]: SQL status: SUCCESS in 0.0 seconds
[0m16:35:25.547755 [debug] [Thread-1 (]: On model.my_dbt_trino_project.src_listen_events: ROLLBACK
[0m16:35:25.548289 [debug] [Thread-1 (]: On model.my_dbt_trino_project.src_listen_events: Close
[0m16:35:25.548811 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '6d445026-1a06-40d9-9df1-6e0b60904b48', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x00000221B5C33F10>]}
[0m16:35:25.549337 [info ] [Thread-1 (]: 2 of 15 OK created sql incremental model analytics_source.src_listen_events .... [[32mSUCCESS[0m in 0.74s]
[0m16:35:25.549866 [debug] [Thread-1 (]: Finished running node model.my_dbt_trino_project.src_listen_events
[0m16:35:25.550387 [debug] [Thread-1 (]: Began running node model.my_dbt_trino_project.src_page_view_events
[0m16:35:25.550906 [info ] [Thread-1 (]: 3 of 15 START sql incremental model analytics_source.src_page_view_events ...... [RUN]
[0m16:35:25.551427 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.my_dbt_trino_project.src_listen_events, now model.my_dbt_trino_project.src_page_view_events)
[0m16:35:25.551947 [debug] [Thread-1 (]: Began compiling node model.my_dbt_trino_project.src_page_view_events
[0m16:35:25.554551 [debug] [Thread-1 (]: Writing injected SQL for node "model.my_dbt_trino_project.src_page_view_events"
[0m16:35:25.555069 [debug] [Thread-1 (]: Began executing node model.my_dbt_trino_project.src_page_view_events
[0m16:35:25.560643 [debug] [Thread-1 (]: Using trino connection "model.my_dbt_trino_project.src_page_view_events"
[0m16:35:25.560643 [debug] [Thread-1 (]: On model.my_dbt_trino_project.src_page_view_events: /* {"app": "dbt", "dbt_version": "1.8.2", "profile_name": "my_dbt_trino_project", "target_name": "dev", "node_id": "model.my_dbt_trino_project.src_page_view_events"} */

  
    

    create table "datalake"."analytics_source"."src_page_view_events__dbt_tmp"
      
      
    as (
      

with source as (
    select
        CAST(_id AS VARCHAR) as id,
        ts,
        CAST(sessionId AS VARCHAR) as sessionId,
        page,
        auth,
        level,
        CAST(CAST(NULLIF(itemInSession, '') AS DOUBLE) AS INTEGER) as itemInSession, 
        city,
        zip,
        state,
        userAgent,
        CAST(NULLIF(lon, '') AS double) as lon,
        CAST(NULLIF(lat, '') AS double) as lat,
        CAST(CAST(NULLIF(userId, '') AS DOUBLE) AS INTEGER) as userId, 
        lastName,
        firstName,
        gender,
        CAST(CAST(NULLIF(registration, '') AS DOUBLE) AS BIGINT) as registration, 
        artist,
        song,
        CAST(NULLIF(duration, '') AS double) as duration
    from "website"."demo"."page_view_events"
)

select * from source


    where ts > (select max(ts) from "datalake"."analytics_source"."src_page_view_events")

    )
[0m16:35:25.561645 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m16:35:25.719789 [debug] [Thread-1 (]: SQL status: SUCCESS in 0.0 seconds
[0m16:35:25.722795 [debug] [Thread-1 (]: Using trino connection "model.my_dbt_trino_project.src_page_view_events"
[0m16:35:25.723797 [debug] [Thread-1 (]: On model.my_dbt_trino_project.src_page_view_events: /* {"app": "dbt", "dbt_version": "1.8.2", "profile_name": "my_dbt_trino_project", "target_name": "dev", "node_id": "model.my_dbt_trino_project.src_page_view_events"} */

    describe "datalake"."analytics_source"."src_page_view_events__dbt_tmp"
[0m16:35:25.805126 [debug] [Thread-1 (]: SQL status: SUCCESS in 0.0 seconds
[0m16:35:25.809223 [debug] [Thread-1 (]: Using trino connection "model.my_dbt_trino_project.src_page_view_events"
[0m16:35:25.809223 [debug] [Thread-1 (]: On model.my_dbt_trino_project.src_page_view_events: /* {"app": "dbt", "dbt_version": "1.8.2", "profile_name": "my_dbt_trino_project", "target_name": "dev", "node_id": "model.my_dbt_trino_project.src_page_view_events"} */

    describe "datalake"."analytics_source"."src_page_view_events"
[0m16:35:25.896366 [debug] [Thread-1 (]: SQL status: SUCCESS in 0.0 seconds
[0m16:35:25.899421 [debug] [Thread-1 (]: Using trino connection "model.my_dbt_trino_project.src_page_view_events"
[0m16:35:25.900420 [debug] [Thread-1 (]: On model.my_dbt_trino_project.src_page_view_events: /* {"app": "dbt", "dbt_version": "1.8.2", "profile_name": "my_dbt_trino_project", "target_name": "dev", "node_id": "model.my_dbt_trino_project.src_page_view_events"} */

    describe "datalake"."analytics_source"."src_page_view_events"
[0m16:35:25.988723 [debug] [Thread-1 (]: SQL status: SUCCESS in 0.0 seconds
[0m16:35:25.991722 [debug] [Thread-1 (]: Writing runtime sql for node "model.my_dbt_trino_project.src_page_view_events"
[0m16:35:25.994459 [debug] [Thread-1 (]: Using trino connection "model.my_dbt_trino_project.src_page_view_events"
[0m16:35:25.995451 [debug] [Thread-1 (]: On model.my_dbt_trino_project.src_page_view_events: /* {"app": "dbt", "dbt_version": "1.8.2", "profile_name": "my_dbt_trino_project", "target_name": "dev", "node_id": "model.my_dbt_trino_project.src_page_view_events"} */
insert into "datalake"."analytics_source"."src_page_view_events" ("id", "ts", "sessionid", "page", "auth", "level", "iteminsession", "city", "zip", "state", "useragent", "lon", "lat", "userid", "lastname", "firstname", "gender", "registration", "artist", "song", "duration")
    (
        select "id", "ts", "sessionid", "page", "auth", "level", "iteminsession", "city", "zip", "state", "useragent", "lon", "lat", "userid", "lastname", "firstname", "gender", "registration", "artist", "song", "duration"
        from "datalake"."analytics_source"."src_page_view_events__dbt_tmp"
    )
[0m16:35:26.127734 [debug] [Thread-1 (]: SQL status: SUCCESS in 0.0 seconds
[0m16:35:26.130734 [debug] [Thread-1 (]: Applying DROP to: "datalake"."analytics_source"."src_page_view_events__dbt_tmp"
[0m16:35:26.131241 [debug] [Thread-1 (]: Using trino connection "model.my_dbt_trino_project.src_page_view_events"
[0m16:35:26.131241 [debug] [Thread-1 (]: On model.my_dbt_trino_project.src_page_view_events: /* {"app": "dbt", "dbt_version": "1.8.2", "profile_name": "my_dbt_trino_project", "target_name": "dev", "node_id": "model.my_dbt_trino_project.src_page_view_events"} */

    drop table if exists "datalake"."analytics_source"."src_page_view_events__dbt_tmp"
[0m16:35:26.236937 [debug] [Thread-1 (]: SQL status: SUCCESS in 0.0 seconds
[0m16:35:26.238939 [debug] [Thread-1 (]: On model.my_dbt_trino_project.src_page_view_events: ROLLBACK
[0m16:35:26.238939 [debug] [Thread-1 (]: On model.my_dbt_trino_project.src_page_view_events: Close
[0m16:35:26.239938 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '6d445026-1a06-40d9-9df1-6e0b60904b48', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x00000221B72CDA90>]}
[0m16:35:26.239938 [info ] [Thread-1 (]: 3 of 15 OK created sql incremental model analytics_source.src_page_view_events . [[32mSUCCESS[0m in 0.69s]
[0m16:35:26.241414 [debug] [Thread-1 (]: Finished running node model.my_dbt_trino_project.src_page_view_events
[0m16:35:26.242424 [debug] [Thread-1 (]: Began running node model.my_dbt_trino_project.stg_user_level_by_gender
[0m16:35:26.242424 [info ] [Thread-1 (]: 4 of 15 START sql view model analytics_stage.stg_user_level_by_gender .......... [RUN]
[0m16:35:26.243421 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.my_dbt_trino_project.src_page_view_events, now model.my_dbt_trino_project.stg_user_level_by_gender)
[0m16:35:26.243421 [debug] [Thread-1 (]: Began compiling node model.my_dbt_trino_project.stg_user_level_by_gender
[0m16:35:26.246422 [debug] [Thread-1 (]: Writing injected SQL for node "model.my_dbt_trino_project.stg_user_level_by_gender"
[0m16:35:26.247424 [debug] [Thread-1 (]: Began executing node model.my_dbt_trino_project.stg_user_level_by_gender
[0m16:35:26.263307 [debug] [Thread-1 (]: Writing runtime sql for node "model.my_dbt_trino_project.stg_user_level_by_gender"
[0m16:35:26.264725 [debug] [Thread-1 (]: Using trino connection "model.my_dbt_trino_project.stg_user_level_by_gender"
[0m16:35:26.265568 [debug] [Thread-1 (]: On model.my_dbt_trino_project.stg_user_level_by_gender: /* {"app": "dbt", "dbt_version": "1.8.2", "profile_name": "my_dbt_trino_project", "target_name": "dev", "node_id": "model.my_dbt_trino_project.stg_user_level_by_gender"} */

  create or replace view
    "datalake"."analytics_stage"."stg_user_level_by_gender"
  security definer
  as
    

WITH user_subscriptions AS (
    SELECT
        gender,
        level, 
        COUNT(DISTINCT userId) AS user_count
    FROM "datalake"."analytics_source"."src_auth_events"
    WHERE gender IS NOT NULL AND level IS NOT NULL
    GROUP BY gender, level
)

SELECT
    gender,
    level,
    user_count
FROM user_subscriptions
  
[0m16:35:26.265568 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m16:35:26.312052 [debug] [Thread-1 (]: SQL status: SUCCESS in 0.0 seconds
[0m16:35:26.314056 [debug] [Thread-1 (]: On model.my_dbt_trino_project.stg_user_level_by_gender: ROLLBACK
[0m16:35:26.314056 [debug] [Thread-1 (]: On model.my_dbt_trino_project.stg_user_level_by_gender: Close
[0m16:35:26.315559 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '6d445026-1a06-40d9-9df1-6e0b60904b48', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x00000221B5B15E50>]}
[0m16:35:26.315559 [info ] [Thread-1 (]: 4 of 15 OK created sql view model analytics_stage.stg_user_level_by_gender ..... [[32mSUCCESS[0m in 0.07s]
[0m16:35:26.316567 [debug] [Thread-1 (]: Finished running node model.my_dbt_trino_project.stg_user_level_by_gender
[0m16:35:26.317574 [debug] [Thread-1 (]: Began running node model.my_dbt_trino_project.stg_streams_hourly
[0m16:35:26.317574 [info ] [Thread-1 (]: 5 of 15 START sql table model analytics_stage.stg_streams_hourly ............... [RUN]
[0m16:35:26.317574 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.my_dbt_trino_project.stg_user_level_by_gender, now model.my_dbt_trino_project.stg_streams_hourly)
[0m16:35:26.318954 [debug] [Thread-1 (]: Began compiling node model.my_dbt_trino_project.stg_streams_hourly
[0m16:35:26.321239 [debug] [Thread-1 (]: Writing injected SQL for node "model.my_dbt_trino_project.stg_streams_hourly"
[0m16:35:26.322239 [debug] [Thread-1 (]: Began executing node model.my_dbt_trino_project.stg_streams_hourly
[0m16:35:26.324513 [debug] [Thread-1 (]: Writing runtime sql for node "model.my_dbt_trino_project.stg_streams_hourly"
[0m16:35:26.326512 [debug] [Thread-1 (]: Using trino connection "model.my_dbt_trino_project.stg_streams_hourly"
[0m16:35:26.326512 [debug] [Thread-1 (]: On model.my_dbt_trino_project.stg_streams_hourly: /* {"app": "dbt", "dbt_version": "1.8.2", "profile_name": "my_dbt_trino_project", "target_name": "dev", "node_id": "model.my_dbt_trino_project.stg_streams_hourly"} */

  
    

    create table "datalake"."analytics_stage"."stg_streams_hourly__dbt_tmp"
      
      
    as (
      

SELECT
    DATE_FORMAT(FROM_UNIXTIME(ts), '%Y-%m-%d') AS stream_date, 
    DATE_FORMAT(FROM_UNIXTIME(ts), '%H') AS stream_hour,
    COUNT(*) AS total_streams
FROM "datalake"."analytics_source"."src_listen_events"
GROUP BY
    DATE_FORMAT(FROM_UNIXTIME(ts), '%Y-%m-%d'),
    DATE_FORMAT(FROM_UNIXTIME(ts), '%H')
    )
[0m16:35:26.327515 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m16:35:26.566429 [debug] [Thread-1 (]: SQL status: SUCCESS in 0.0 seconds
[0m16:35:26.569656 [debug] [Thread-1 (]: Using trino connection "model.my_dbt_trino_project.stg_streams_hourly"
[0m16:35:26.570178 [debug] [Thread-1 (]: On model.my_dbt_trino_project.stg_streams_hourly: /* {"app": "dbt", "dbt_version": "1.8.2", "profile_name": "my_dbt_trino_project", "target_name": "dev", "node_id": "model.my_dbt_trino_project.stg_streams_hourly"} */
alter table "datalake"."analytics_stage"."stg_streams_hourly" rename to "datalake"."analytics_stage"."stg_streams_hourly__dbt_backup"
[0m16:35:26.657168 [debug] [Thread-1 (]: SQL status: SUCCESS in 0.0 seconds
[0m16:35:26.660309 [debug] [Thread-1 (]: Using trino connection "model.my_dbt_trino_project.stg_streams_hourly"
[0m16:35:26.660827 [debug] [Thread-1 (]: On model.my_dbt_trino_project.stg_streams_hourly: /* {"app": "dbt", "dbt_version": "1.8.2", "profile_name": "my_dbt_trino_project", "target_name": "dev", "node_id": "model.my_dbt_trino_project.stg_streams_hourly"} */
alter table "datalake"."analytics_stage"."stg_streams_hourly__dbt_tmp" rename to "datalake"."analytics_stage"."stg_streams_hourly"
[0m16:35:26.745588 [debug] [Thread-1 (]: SQL status: SUCCESS in 0.0 seconds
[0m16:35:26.749738 [debug] [Thread-1 (]: Applying DROP to: "datalake"."analytics_stage"."stg_streams_hourly__dbt_backup"
[0m16:35:26.750258 [debug] [Thread-1 (]: Using trino connection "model.my_dbt_trino_project.stg_streams_hourly"
[0m16:35:26.750776 [debug] [Thread-1 (]: On model.my_dbt_trino_project.stg_streams_hourly: /* {"app": "dbt", "dbt_version": "1.8.2", "profile_name": "my_dbt_trino_project", "target_name": "dev", "node_id": "model.my_dbt_trino_project.stg_streams_hourly"} */

    drop table if exists "datalake"."analytics_stage"."stg_streams_hourly__dbt_backup"
[0m16:35:26.862144 [debug] [Thread-1 (]: SQL status: SUCCESS in 0.0 seconds
[0m16:35:26.864144 [debug] [Thread-1 (]: On model.my_dbt_trino_project.stg_streams_hourly: ROLLBACK
[0m16:35:26.864144 [debug] [Thread-1 (]: On model.my_dbt_trino_project.stg_streams_hourly: Close
[0m16:35:26.865145 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '6d445026-1a06-40d9-9df1-6e0b60904b48', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x00000221B5BE3AD0>]}
[0m16:35:26.865145 [info ] [Thread-1 (]: 5 of 15 OK created sql table model analytics_stage.stg_streams_hourly .......... [[32mSUCCESS[0m in 0.55s]
[0m16:35:26.866147 [debug] [Thread-1 (]: Finished running node model.my_dbt_trino_project.stg_streams_hourly
[0m16:35:26.867146 [debug] [Thread-1 (]: Began running node model.my_dbt_trino_project.stg_top_songs_artists
[0m16:35:26.867146 [info ] [Thread-1 (]: 6 of 15 START sql view model analytics_stage.stg_top_songs_artists ............. [RUN]
[0m16:35:26.868143 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.my_dbt_trino_project.stg_streams_hourly, now model.my_dbt_trino_project.stg_top_songs_artists)
[0m16:35:26.868143 [debug] [Thread-1 (]: Began compiling node model.my_dbt_trino_project.stg_top_songs_artists
[0m16:35:26.870686 [debug] [Thread-1 (]: Writing injected SQL for node "model.my_dbt_trino_project.stg_top_songs_artists"
[0m16:35:26.871694 [debug] [Thread-1 (]: Began executing node model.my_dbt_trino_project.stg_top_songs_artists
[0m16:35:26.873691 [debug] [Thread-1 (]: Writing runtime sql for node "model.my_dbt_trino_project.stg_top_songs_artists"
[0m16:35:26.875691 [debug] [Thread-1 (]: Using trino connection "model.my_dbt_trino_project.stg_top_songs_artists"
[0m16:35:26.875691 [debug] [Thread-1 (]: On model.my_dbt_trino_project.stg_top_songs_artists: /* {"app": "dbt", "dbt_version": "1.8.2", "profile_name": "my_dbt_trino_project", "target_name": "dev", "node_id": "model.my_dbt_trino_project.stg_top_songs_artists"} */

  create or replace view
    "datalake"."analytics_stage"."stg_top_songs_artists"
  security definer
  as
    

WITH song_plays AS (
    SELECT
        artist,
        song,
        COUNT(*) AS play_count
    FROM "datalake"."analytics_source"."src_listen_events"
    GROUP BY artist, song
)

SELECT
    artist,
    song,
    play_count
FROM song_plays
ORDER BY play_count DESC
  
[0m16:35:26.875691 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m16:35:26.925566 [debug] [Thread-1 (]: SQL status: SUCCESS in 0.0 seconds
[0m16:35:26.927677 [debug] [Thread-1 (]: On model.my_dbt_trino_project.stg_top_songs_artists: ROLLBACK
[0m16:35:26.928188 [debug] [Thread-1 (]: On model.my_dbt_trino_project.stg_top_songs_artists: Close
[0m16:35:26.928809 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '6d445026-1a06-40d9-9df1-6e0b60904b48', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x00000221B5A4F4D0>]}
[0m16:35:26.929314 [info ] [Thread-1 (]: 6 of 15 OK created sql view model analytics_stage.stg_top_songs_artists ........ [[32mSUCCESS[0m in 0.06s]
[0m16:35:26.930385 [debug] [Thread-1 (]: Finished running node model.my_dbt_trino_project.stg_top_songs_artists
[0m16:35:26.930385 [debug] [Thread-1 (]: Began running node model.my_dbt_trino_project.stg_unique_users
[0m16:35:26.930920 [info ] [Thread-1 (]: 7 of 15 START sql view model analytics_stage.stg_unique_users .................. [RUN]
[0m16:35:26.931985 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.my_dbt_trino_project.stg_top_songs_artists, now model.my_dbt_trino_project.stg_unique_users)
[0m16:35:26.931985 [debug] [Thread-1 (]: Began compiling node model.my_dbt_trino_project.stg_unique_users
[0m16:35:26.935225 [debug] [Thread-1 (]: Writing injected SQL for node "model.my_dbt_trino_project.stg_unique_users"
[0m16:35:26.935225 [debug] [Thread-1 (]: Began executing node model.my_dbt_trino_project.stg_unique_users
[0m16:35:26.937676 [debug] [Thread-1 (]: Writing runtime sql for node "model.my_dbt_trino_project.stg_unique_users"
[0m16:35:26.939685 [debug] [Thread-1 (]: Using trino connection "model.my_dbt_trino_project.stg_unique_users"
[0m16:35:26.939685 [debug] [Thread-1 (]: On model.my_dbt_trino_project.stg_unique_users: /* {"app": "dbt", "dbt_version": "1.8.2", "profile_name": "my_dbt_trino_project", "target_name": "dev", "node_id": "model.my_dbt_trino_project.stg_unique_users"} */

  create or replace view
    "datalake"."analytics_stage"."stg_unique_users"
  security definer
  as
    

SELECT
    COUNT(DISTINCT userid) AS total_unique_users
FROM "datalake"."analytics_source"."src_listen_events"
WHERE userid IS NOT NULL
  
[0m16:35:26.939685 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m16:35:27.006468 [debug] [Thread-1 (]: SQL status: SUCCESS in 0.0 seconds
[0m16:35:27.007468 [debug] [Thread-1 (]: On model.my_dbt_trino_project.stg_unique_users: ROLLBACK
[0m16:35:27.008468 [debug] [Thread-1 (]: On model.my_dbt_trino_project.stg_unique_users: Close
[0m16:35:27.008468 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '6d445026-1a06-40d9-9df1-6e0b60904b48', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x00000221B5925B50>]}
[0m16:35:27.009573 [info ] [Thread-1 (]: 7 of 15 OK created sql view model analytics_stage.stg_unique_users ............. [[32mSUCCESS[0m in 0.08s]
[0m16:35:27.009573 [debug] [Thread-1 (]: Finished running node model.my_dbt_trino_project.stg_unique_users
[0m16:35:27.011002 [debug] [Thread-1 (]: Began running node model.my_dbt_trino_project.stg_user_activity_per_country
[0m16:35:27.011548 [info ] [Thread-1 (]: 8 of 15 START sql view model analytics_stage.stg_user_activity_per_country ..... [RUN]
[0m16:35:27.011548 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.my_dbt_trino_project.stg_unique_users, now model.my_dbt_trino_project.stg_user_activity_per_country)
[0m16:35:27.012673 [debug] [Thread-1 (]: Began compiling node model.my_dbt_trino_project.stg_user_activity_per_country
[0m16:35:27.014686 [debug] [Thread-1 (]: Writing injected SQL for node "model.my_dbt_trino_project.stg_user_activity_per_country"
[0m16:35:27.015684 [debug] [Thread-1 (]: Began executing node model.my_dbt_trino_project.stg_user_activity_per_country
[0m16:35:27.017685 [debug] [Thread-1 (]: Writing runtime sql for node "model.my_dbt_trino_project.stg_user_activity_per_country"
[0m16:35:27.022190 [debug] [Thread-1 (]: Using trino connection "model.my_dbt_trino_project.stg_user_activity_per_country"
[0m16:35:27.022190 [debug] [Thread-1 (]: On model.my_dbt_trino_project.stg_user_activity_per_country: /* {"app": "dbt", "dbt_version": "1.8.2", "profile_name": "my_dbt_trino_project", "target_name": "dev", "node_id": "model.my_dbt_trino_project.stg_user_activity_per_country"} */

  create or replace view
    "datalake"."analytics_stage"."stg_user_activity_per_country"
  security definer
  as
    

WITH combined_activities AS (
  SELECT
    country,
    'listen_event' AS event_type,
    ts,
    userid
  FROM "datalake"."analytics_source"."src_listen_events"
  WHERE country IS NOT NULL
  UNION ALL
  SELECT
    'Unknown' AS country, 
    ts,
    userid
  FROM "datalake"."analytics_source"."src_auth_events"
  UNION ALL
  SELECT
    'Unknown' AS country, 
    'page_view_event' AS event_type,
    ts,
    userid
  FROM "datalake"."analytics_source"."src_page_view_events"
)

SELECT
  country,
  COUNT(*) AS activity_count
FROM combined_activities
GROUP BY country
  
[0m16:35:27.022190 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m16:35:27.074726 [debug] [Thread-1 (]: Trino adapter: Trino query id: 20240617_083527_00253_xsftb
[0m16:35:27.074726 [debug] [Thread-1 (]: Trino adapter: Trino error: TrinoUserError(type=USER_ERROR, name=TYPE_MISMATCH, message="line 17:3: UNION query has different number of fields: 4, 3", query_id=20240617_083527_00253_xsftb)
[0m16:35:27.075740 [debug] [Thread-1 (]: On model.my_dbt_trino_project.stg_user_activity_per_country: ROLLBACK
[0m16:35:27.075740 [debug] [Thread-1 (]: On model.my_dbt_trino_project.stg_user_activity_per_country: Close
[0m16:35:27.079738 [debug] [Thread-1 (]: Database Error in model stg_user_activity_per_country (models\stage\stg_user_activity_per_country.sql)
  TrinoUserError(type=USER_ERROR, name=TYPE_MISMATCH, message="line 17:3: UNION query has different number of fields: 4, 3", query_id=20240617_083527_00253_xsftb)
  compiled Code at target\run\my_dbt_trino_project\models\stage\stg_user_activity_per_country.sql
[0m16:35:27.080737 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '6d445026-1a06-40d9-9df1-6e0b60904b48', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x00000221B7303990>]}
[0m16:35:27.081739 [error] [Thread-1 (]: 8 of 15 ERROR creating sql view model analytics_stage.stg_user_activity_per_country  [[31mERROR[0m in 0.07s]
[0m16:35:27.081739 [debug] [Thread-1 (]: Finished running node model.my_dbt_trino_project.stg_user_activity_per_country
[0m16:35:27.083005 [debug] [Thread-1 (]: Began running node model.my_dbt_trino_project.stg_user_activity_per_location
[0m16:35:27.083513 [info ] [Thread-1 (]: 9 of 15 START sql view model analytics_stage.stg_user_activity_per_location .... [RUN]
[0m16:35:27.083513 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.my_dbt_trino_project.stg_user_activity_per_country, now model.my_dbt_trino_project.stg_user_activity_per_location)
[0m16:35:27.084752 [debug] [Thread-1 (]: Began compiling node model.my_dbt_trino_project.stg_user_activity_per_location
[0m16:35:27.087263 [debug] [Thread-1 (]: Writing injected SQL for node "model.my_dbt_trino_project.stg_user_activity_per_location"
[0m16:35:27.088263 [debug] [Thread-1 (]: Began executing node model.my_dbt_trino_project.stg_user_activity_per_location
[0m16:35:27.090262 [debug] [Thread-1 (]: Writing runtime sql for node "model.my_dbt_trino_project.stg_user_activity_per_location"
[0m16:35:27.092372 [debug] [Thread-1 (]: Using trino connection "model.my_dbt_trino_project.stg_user_activity_per_location"
[0m16:35:27.093510 [debug] [Thread-1 (]: On model.my_dbt_trino_project.stg_user_activity_per_location: /* {"app": "dbt", "dbt_version": "1.8.2", "profile_name": "my_dbt_trino_project", "target_name": "dev", "node_id": "model.my_dbt_trino_project.stg_user_activity_per_location"} */

  create or replace view
    "datalake"."analytics_stage"."stg_user_activity_per_location"
  security definer
  as
    

WITH combined_activities AS (
  SELECT
    city,
    state,
    'auth_event' AS event_type,
    ts,
    userid
 FROM "datalake"."analytics_source"."src_auth_events"
  UNION ALL
  SELECT
    city,
    state,
    'listen_event' AS event_type,
    ts,
    userid
  FROM "datalake"."analytics_source"."src_listen_events"
  UNION ALL
  SELECT
    city,
    state,
    'page_view_event' AS event_type,
    ts,
    userid
  FROM "datalake"."analytics_source"."src_page_view_events"
)

SELECT
  state,
  city,
  COUNT(*) AS activity_count
FROM combined_activities
GROUP BY state, city
  
[0m16:35:27.093510 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m16:35:27.169016 [debug] [Thread-1 (]: SQL status: SUCCESS in 0.0 seconds
[0m16:35:27.171022 [debug] [Thread-1 (]: On model.my_dbt_trino_project.stg_user_activity_per_location: ROLLBACK
[0m16:35:27.171022 [debug] [Thread-1 (]: On model.my_dbt_trino_project.stg_user_activity_per_location: Close
[0m16:35:27.172022 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '6d445026-1a06-40d9-9df1-6e0b60904b48', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x00000221B722E3D0>]}
[0m16:35:27.172022 [info ] [Thread-1 (]: 9 of 15 OK created sql view model analytics_stage.stg_user_activity_per_location  [[32mSUCCESS[0m in 0.09s]
[0m16:35:27.172022 [debug] [Thread-1 (]: Finished running node model.my_dbt_trino_project.stg_user_activity_per_location
[0m16:35:27.173471 [debug] [Thread-1 (]: Began running node model.my_dbt_trino_project.mart_user_level_by_gender
[0m16:35:27.173471 [info ] [Thread-1 (]: 10 of 15 START sql table model analytics.mart_user_level_by_gender ............. [RUN]
[0m16:35:27.173471 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.my_dbt_trino_project.stg_user_activity_per_location, now model.my_dbt_trino_project.mart_user_level_by_gender)
[0m16:35:27.174930 [debug] [Thread-1 (]: Began compiling node model.my_dbt_trino_project.mart_user_level_by_gender
[0m16:35:27.176937 [debug] [Thread-1 (]: Writing injected SQL for node "model.my_dbt_trino_project.mart_user_level_by_gender"
[0m16:35:27.177935 [debug] [Thread-1 (]: Began executing node model.my_dbt_trino_project.mart_user_level_by_gender
[0m16:35:27.180444 [debug] [Thread-1 (]: Writing runtime sql for node "model.my_dbt_trino_project.mart_user_level_by_gender"
[0m16:35:27.181447 [debug] [Thread-1 (]: Using trino connection "model.my_dbt_trino_project.mart_user_level_by_gender"
[0m16:35:27.182447 [debug] [Thread-1 (]: On model.my_dbt_trino_project.mart_user_level_by_gender: /* {"app": "dbt", "dbt_version": "1.8.2", "profile_name": "my_dbt_trino_project", "target_name": "dev", "node_id": "model.my_dbt_trino_project.mart_user_level_by_gender"} */

  
    

    create table "datalake"."analytics"."mart_user_level_by_gender__dbt_tmp"
      
      
    as (
      

SELECT
    gender,
    level,
    SUM(user_count) AS total_users,
    ROUND(SUM(user_count) * 100.0 / SUM(SUM(user_count)) OVER (), 2) AS percentage_of_total_users
FROM "datalake"."analytics_stage"."stg_user_level_by_gender"
GROUP BY gender, level
    )
[0m16:35:27.182447 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m16:35:27.494550 [debug] [Thread-1 (]: SQL status: SUCCESS in 0.0 seconds
[0m16:35:27.497885 [debug] [Thread-1 (]: Using trino connection "model.my_dbt_trino_project.mart_user_level_by_gender"
[0m16:35:27.497885 [debug] [Thread-1 (]: On model.my_dbt_trino_project.mart_user_level_by_gender: /* {"app": "dbt", "dbt_version": "1.8.2", "profile_name": "my_dbt_trino_project", "target_name": "dev", "node_id": "model.my_dbt_trino_project.mart_user_level_by_gender"} */
alter table "datalake"."analytics"."mart_user_level_by_gender" rename to "datalake"."analytics"."mart_user_level_by_gender__dbt_backup"
[0m16:35:27.587080 [debug] [Thread-1 (]: SQL status: SUCCESS in 0.0 seconds
[0m16:35:27.590077 [debug] [Thread-1 (]: Using trino connection "model.my_dbt_trino_project.mart_user_level_by_gender"
[0m16:35:27.591078 [debug] [Thread-1 (]: On model.my_dbt_trino_project.mart_user_level_by_gender: /* {"app": "dbt", "dbt_version": "1.8.2", "profile_name": "my_dbt_trino_project", "target_name": "dev", "node_id": "model.my_dbt_trino_project.mart_user_level_by_gender"} */
alter table "datalake"."analytics"."mart_user_level_by_gender__dbt_tmp" rename to "datalake"."analytics"."mart_user_level_by_gender"
[0m16:35:27.688369 [debug] [Thread-1 (]: SQL status: SUCCESS in 0.0 seconds
[0m16:35:27.692362 [debug] [Thread-1 (]: Applying DROP to: "datalake"."analytics"."mart_user_level_by_gender__dbt_backup"
[0m16:35:27.693362 [debug] [Thread-1 (]: Using trino connection "model.my_dbt_trino_project.mart_user_level_by_gender"
[0m16:35:27.693362 [debug] [Thread-1 (]: On model.my_dbt_trino_project.mart_user_level_by_gender: /* {"app": "dbt", "dbt_version": "1.8.2", "profile_name": "my_dbt_trino_project", "target_name": "dev", "node_id": "model.my_dbt_trino_project.mart_user_level_by_gender"} */

    drop table if exists "datalake"."analytics"."mart_user_level_by_gender__dbt_backup"
[0m16:35:27.801526 [debug] [Thread-1 (]: SQL status: SUCCESS in 0.0 seconds
[0m16:35:27.803527 [debug] [Thread-1 (]: On model.my_dbt_trino_project.mart_user_level_by_gender: ROLLBACK
[0m16:35:27.803527 [debug] [Thread-1 (]: On model.my_dbt_trino_project.mart_user_level_by_gender: Close
[0m16:35:27.804684 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '6d445026-1a06-40d9-9df1-6e0b60904b48', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x00000221B5C9E850>]}
[0m16:35:27.805238 [info ] [Thread-1 (]: 10 of 15 OK created sql table model analytics.mart_user_level_by_gender ........ [[32mSUCCESS[0m in 0.63s]
[0m16:35:27.806245 [debug] [Thread-1 (]: Finished running node model.my_dbt_trino_project.mart_user_level_by_gender
[0m16:35:27.806245 [debug] [Thread-1 (]: Began running node model.my_dbt_trino_project.mart_hourly_stream_evolution
[0m16:35:27.807245 [info ] [Thread-1 (]: 11 of 15 START sql table model analytics.mart_hourly_stream_evolution .......... [RUN]
[0m16:35:27.808244 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.my_dbt_trino_project.mart_user_level_by_gender, now model.my_dbt_trino_project.mart_hourly_stream_evolution)
[0m16:35:27.808244 [debug] [Thread-1 (]: Began compiling node model.my_dbt_trino_project.mart_hourly_stream_evolution
[0m16:35:27.811244 [debug] [Thread-1 (]: Writing injected SQL for node "model.my_dbt_trino_project.mart_hourly_stream_evolution"
[0m16:35:27.811244 [debug] [Thread-1 (]: Began executing node model.my_dbt_trino_project.mart_hourly_stream_evolution
[0m16:35:27.817247 [debug] [Thread-1 (]: Writing runtime sql for node "model.my_dbt_trino_project.mart_hourly_stream_evolution"
[0m16:35:27.819248 [debug] [Thread-1 (]: Using trino connection "model.my_dbt_trino_project.mart_hourly_stream_evolution"
[0m16:35:27.819248 [debug] [Thread-1 (]: On model.my_dbt_trino_project.mart_hourly_stream_evolution: /* {"app": "dbt", "dbt_version": "1.8.2", "profile_name": "my_dbt_trino_project", "target_name": "dev", "node_id": "model.my_dbt_trino_project.mart_hourly_stream_evolution"} */

  
    

    create table "datalake"."analytics"."mart_hourly_stream_evolution__dbt_tmp"
      
      
    as (
      

SELECT
    stream_date,
    stream_hour,
    total_streams,
    SUM(total_streams) OVER (PARTITION BY stream_date ORDER BY stream_hour) AS cumulative_streams
FROM "datalake"."analytics_stage"."stg_streams_hourly"
ORDER BY
    stream_date,
    stream_hour
    )
[0m16:35:27.819248 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m16:35:28.088408 [debug] [Thread-1 (]: SQL status: SUCCESS in 0.0 seconds
[0m16:35:28.091408 [debug] [Thread-1 (]: Using trino connection "model.my_dbt_trino_project.mart_hourly_stream_evolution"
[0m16:35:28.092408 [debug] [Thread-1 (]: On model.my_dbt_trino_project.mart_hourly_stream_evolution: /* {"app": "dbt", "dbt_version": "1.8.2", "profile_name": "my_dbt_trino_project", "target_name": "dev", "node_id": "model.my_dbt_trino_project.mart_hourly_stream_evolution"} */
alter table "datalake"."analytics"."mart_hourly_stream_evolution" rename to "datalake"."analytics"."mart_hourly_stream_evolution__dbt_backup"
[0m16:35:28.179572 [debug] [Thread-1 (]: SQL status: SUCCESS in 0.0 seconds
[0m16:35:28.183572 [debug] [Thread-1 (]: Using trino connection "model.my_dbt_trino_project.mart_hourly_stream_evolution"
[0m16:35:28.183572 [debug] [Thread-1 (]: On model.my_dbt_trino_project.mart_hourly_stream_evolution: /* {"app": "dbt", "dbt_version": "1.8.2", "profile_name": "my_dbt_trino_project", "target_name": "dev", "node_id": "model.my_dbt_trino_project.mart_hourly_stream_evolution"} */
alter table "datalake"."analytics"."mart_hourly_stream_evolution__dbt_tmp" rename to "datalake"."analytics"."mart_hourly_stream_evolution"
[0m16:35:28.276412 [debug] [Thread-1 (]: SQL status: SUCCESS in 0.0 seconds
[0m16:35:28.279518 [debug] [Thread-1 (]: Applying DROP to: "datalake"."analytics"."mart_hourly_stream_evolution__dbt_backup"
[0m16:35:28.281029 [debug] [Thread-1 (]: Using trino connection "model.my_dbt_trino_project.mart_hourly_stream_evolution"
[0m16:35:28.281029 [debug] [Thread-1 (]: On model.my_dbt_trino_project.mart_hourly_stream_evolution: /* {"app": "dbt", "dbt_version": "1.8.2", "profile_name": "my_dbt_trino_project", "target_name": "dev", "node_id": "model.my_dbt_trino_project.mart_hourly_stream_evolution"} */

    drop table if exists "datalake"."analytics"."mart_hourly_stream_evolution__dbt_backup"
[0m16:35:28.410085 [debug] [Thread-1 (]: SQL status: SUCCESS in 0.0 seconds
[0m16:35:28.411085 [debug] [Thread-1 (]: On model.my_dbt_trino_project.mart_hourly_stream_evolution: ROLLBACK
[0m16:35:28.412084 [debug] [Thread-1 (]: On model.my_dbt_trino_project.mart_hourly_stream_evolution: Close
[0m16:35:28.412084 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '6d445026-1a06-40d9-9df1-6e0b60904b48', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x00000221B770F050>]}
[0m16:35:28.412084 [info ] [Thread-1 (]: 11 of 15 OK created sql table model analytics.mart_hourly_stream_evolution ..... [[32mSUCCESS[0m in 0.60s]
[0m16:35:28.413935 [debug] [Thread-1 (]: Finished running node model.my_dbt_trino_project.mart_hourly_stream_evolution
[0m16:35:28.413935 [debug] [Thread-1 (]: Began running node model.my_dbt_trino_project.mart_top_songs_artists
[0m16:35:28.413935 [info ] [Thread-1 (]: 12 of 15 START sql table model analytics.mart_top_songs_artists ................ [RUN]
[0m16:35:28.414940 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.my_dbt_trino_project.mart_hourly_stream_evolution, now model.my_dbt_trino_project.mart_top_songs_artists)
[0m16:35:28.414940 [debug] [Thread-1 (]: Began compiling node model.my_dbt_trino_project.mart_top_songs_artists
[0m16:35:28.417941 [debug] [Thread-1 (]: Writing injected SQL for node "model.my_dbt_trino_project.mart_top_songs_artists"
[0m16:35:28.418941 [debug] [Thread-1 (]: Began executing node model.my_dbt_trino_project.mart_top_songs_artists
[0m16:35:28.421360 [debug] [Thread-1 (]: Writing runtime sql for node "model.my_dbt_trino_project.mart_top_songs_artists"
[0m16:35:28.423360 [debug] [Thread-1 (]: Using trino connection "model.my_dbt_trino_project.mart_top_songs_artists"
[0m16:35:28.423360 [debug] [Thread-1 (]: On model.my_dbt_trino_project.mart_top_songs_artists: /* {"app": "dbt", "dbt_version": "1.8.2", "profile_name": "my_dbt_trino_project", "target_name": "dev", "node_id": "model.my_dbt_trino_project.mart_top_songs_artists"} */

  
    

    create table "datalake"."analytics"."mart_top_songs_artists__dbt_tmp"
      
      
    as (
      

WITH top_songs AS (
    SELECT
        artist,
        song,
        play_count
    FROM "datalake"."analytics_stage"."stg_top_songs_artists"
)

SELECT
    artist,
    song,
    play_count
FROM top_songs
    )
[0m16:35:28.423360 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m16:35:28.661080 [debug] [Thread-1 (]: SQL status: SUCCESS in 0.0 seconds
[0m16:35:28.665310 [debug] [Thread-1 (]: Using trino connection "model.my_dbt_trino_project.mart_top_songs_artists"
[0m16:35:28.665855 [debug] [Thread-1 (]: On model.my_dbt_trino_project.mart_top_songs_artists: /* {"app": "dbt", "dbt_version": "1.8.2", "profile_name": "my_dbt_trino_project", "target_name": "dev", "node_id": "model.my_dbt_trino_project.mart_top_songs_artists"} */
alter table "datalake"."analytics"."mart_top_songs_artists" rename to "datalake"."analytics"."mart_top_songs_artists__dbt_backup"
[0m16:35:28.754837 [debug] [Thread-1 (]: SQL status: SUCCESS in 0.0 seconds
[0m16:35:28.758834 [debug] [Thread-1 (]: Using trino connection "model.my_dbt_trino_project.mart_top_songs_artists"
[0m16:35:28.758834 [debug] [Thread-1 (]: On model.my_dbt_trino_project.mart_top_songs_artists: /* {"app": "dbt", "dbt_version": "1.8.2", "profile_name": "my_dbt_trino_project", "target_name": "dev", "node_id": "model.my_dbt_trino_project.mart_top_songs_artists"} */
alter table "datalake"."analytics"."mart_top_songs_artists__dbt_tmp" rename to "datalake"."analytics"."mart_top_songs_artists"
[0m16:35:28.845483 [debug] [Thread-1 (]: SQL status: SUCCESS in 0.0 seconds
[0m16:35:28.847482 [debug] [Thread-1 (]: Applying DROP to: "datalake"."analytics"."mart_top_songs_artists__dbt_backup"
[0m16:35:28.848483 [debug] [Thread-1 (]: Using trino connection "model.my_dbt_trino_project.mart_top_songs_artists"
[0m16:35:28.849483 [debug] [Thread-1 (]: On model.my_dbt_trino_project.mart_top_songs_artists: /* {"app": "dbt", "dbt_version": "1.8.2", "profile_name": "my_dbt_trino_project", "target_name": "dev", "node_id": "model.my_dbt_trino_project.mart_top_songs_artists"} */

    drop table if exists "datalake"."analytics"."mart_top_songs_artists__dbt_backup"
[0m16:35:28.971838 [debug] [Thread-1 (]: SQL status: SUCCESS in 0.0 seconds
[0m16:35:28.974349 [debug] [Thread-1 (]: On model.my_dbt_trino_project.mart_top_songs_artists: ROLLBACK
[0m16:35:28.974349 [debug] [Thread-1 (]: On model.my_dbt_trino_project.mart_top_songs_artists: Close
[0m16:35:28.975351 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '6d445026-1a06-40d9-9df1-6e0b60904b48', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x00000221B5A73090>]}
[0m16:35:28.976594 [info ] [Thread-1 (]: 12 of 15 OK created sql table model analytics.mart_top_songs_artists ........... [[32mSUCCESS[0m in 0.56s]
[0m16:35:28.976594 [debug] [Thread-1 (]: Finished running node model.my_dbt_trino_project.mart_top_songs_artists
[0m16:35:28.977599 [debug] [Thread-1 (]: Began running node model.my_dbt_trino_project.mart_total_unique_users
[0m16:35:28.977599 [info ] [Thread-1 (]: 13 of 15 START sql table model analytics.mart_total_unique_users ............... [RUN]
[0m16:35:28.979064 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.my_dbt_trino_project.mart_top_songs_artists, now model.my_dbt_trino_project.mart_total_unique_users)
[0m16:35:28.979570 [debug] [Thread-1 (]: Began compiling node model.my_dbt_trino_project.mart_total_unique_users
[0m16:35:28.982719 [debug] [Thread-1 (]: Writing injected SQL for node "model.my_dbt_trino_project.mart_total_unique_users"
[0m16:35:28.983753 [debug] [Thread-1 (]: Began executing node model.my_dbt_trino_project.mart_total_unique_users
[0m16:35:28.987942 [debug] [Thread-1 (]: Writing runtime sql for node "model.my_dbt_trino_project.mart_total_unique_users"
[0m16:35:28.988991 [debug] [Thread-1 (]: Using trino connection "model.my_dbt_trino_project.mart_total_unique_users"
[0m16:35:28.989506 [debug] [Thread-1 (]: On model.my_dbt_trino_project.mart_total_unique_users: /* {"app": "dbt", "dbt_version": "1.8.2", "profile_name": "my_dbt_trino_project", "target_name": "dev", "node_id": "model.my_dbt_trino_project.mart_total_unique_users"} */

  
    

    create table "datalake"."analytics"."mart_total_unique_users__dbt_tmp"
      
      
    as (
      

SELECT
    total_unique_users
FROM "datalake"."analytics_stage"."stg_unique_users"
    )
[0m16:35:28.990021 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m16:35:29.226883 [debug] [Thread-1 (]: SQL status: SUCCESS in 0.0 seconds
[0m16:35:29.230478 [debug] [Thread-1 (]: Using trino connection "model.my_dbt_trino_project.mart_total_unique_users"
[0m16:35:29.230478 [debug] [Thread-1 (]: On model.my_dbt_trino_project.mart_total_unique_users: /* {"app": "dbt", "dbt_version": "1.8.2", "profile_name": "my_dbt_trino_project", "target_name": "dev", "node_id": "model.my_dbt_trino_project.mart_total_unique_users"} */
alter table "datalake"."analytics"."mart_total_unique_users" rename to "datalake"."analytics"."mart_total_unique_users__dbt_backup"
[0m16:35:29.317780 [debug] [Thread-1 (]: SQL status: SUCCESS in 0.0 seconds
[0m16:35:29.320723 [debug] [Thread-1 (]: Using trino connection "model.my_dbt_trino_project.mart_total_unique_users"
[0m16:35:29.321723 [debug] [Thread-1 (]: On model.my_dbt_trino_project.mart_total_unique_users: /* {"app": "dbt", "dbt_version": "1.8.2", "profile_name": "my_dbt_trino_project", "target_name": "dev", "node_id": "model.my_dbt_trino_project.mart_total_unique_users"} */
alter table "datalake"."analytics"."mart_total_unique_users__dbt_tmp" rename to "datalake"."analytics"."mart_total_unique_users"
[0m16:35:29.413139 [debug] [Thread-1 (]: SQL status: SUCCESS in 0.0 seconds
[0m16:35:29.416009 [debug] [Thread-1 (]: Applying DROP to: "datalake"."analytics"."mart_total_unique_users__dbt_backup"
[0m16:35:29.417016 [debug] [Thread-1 (]: Using trino connection "model.my_dbt_trino_project.mart_total_unique_users"
[0m16:35:29.417016 [debug] [Thread-1 (]: On model.my_dbt_trino_project.mart_total_unique_users: /* {"app": "dbt", "dbt_version": "1.8.2", "profile_name": "my_dbt_trino_project", "target_name": "dev", "node_id": "model.my_dbt_trino_project.mart_total_unique_users"} */

    drop table if exists "datalake"."analytics"."mart_total_unique_users__dbt_backup"
[0m16:35:29.527762 [debug] [Thread-1 (]: SQL status: SUCCESS in 0.0 seconds
[0m16:35:29.529817 [debug] [Thread-1 (]: On model.my_dbt_trino_project.mart_total_unique_users: ROLLBACK
[0m16:35:29.529817 [debug] [Thread-1 (]: On model.my_dbt_trino_project.mart_total_unique_users: Close
[0m16:35:29.530819 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '6d445026-1a06-40d9-9df1-6e0b60904b48', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x00000221B5B22FD0>]}
[0m16:35:29.530819 [info ] [Thread-1 (]: 13 of 15 OK created sql table model analytics.mart_total_unique_users .......... [[32mSUCCESS[0m in 0.55s]
[0m16:35:29.531815 [debug] [Thread-1 (]: Finished running node model.my_dbt_trino_project.mart_total_unique_users
[0m16:35:29.531815 [debug] [Thread-1 (]: Began running node model.my_dbt_trino_project.mart_user_activity_per_country
[0m16:35:29.532816 [info ] [Thread-1 (]: 14 of 15 SKIP relation analytics.mart_user_activity_per_country ................ [[33mSKIP[0m]
[0m16:35:29.532816 [debug] [Thread-1 (]: Finished running node model.my_dbt_trino_project.mart_user_activity_per_country
[0m16:35:29.533982 [debug] [Thread-1 (]: Began running node model.my_dbt_trino_project.mart_user_activity_per_state
[0m16:35:29.533982 [info ] [Thread-1 (]: 15 of 15 START sql table model analytics.mart_user_activity_per_state .......... [RUN]
[0m16:35:29.533982 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.my_dbt_trino_project.mart_total_unique_users, now model.my_dbt_trino_project.mart_user_activity_per_state)
[0m16:35:29.535040 [debug] [Thread-1 (]: Began compiling node model.my_dbt_trino_project.mart_user_activity_per_state
[0m16:35:29.537553 [debug] [Thread-1 (]: Writing injected SQL for node "model.my_dbt_trino_project.mart_user_activity_per_state"
[0m16:35:29.537553 [debug] [Thread-1 (]: Began executing node model.my_dbt_trino_project.mart_user_activity_per_state
[0m16:35:29.540594 [debug] [Thread-1 (]: Writing runtime sql for node "model.my_dbt_trino_project.mart_user_activity_per_state"
[0m16:35:29.541593 [debug] [Thread-1 (]: Using trino connection "model.my_dbt_trino_project.mart_user_activity_per_state"
[0m16:35:29.541593 [debug] [Thread-1 (]: On model.my_dbt_trino_project.mart_user_activity_per_state: /* {"app": "dbt", "dbt_version": "1.8.2", "profile_name": "my_dbt_trino_project", "target_name": "dev", "node_id": "model.my_dbt_trino_project.mart_user_activity_per_state"} */

  
    

    create table "datalake"."analytics"."mart_user_activity_per_state__dbt_tmp"
      
      
    as (
      

SELECT
  state,
  city,
  SUM(activity_count) AS total_activity
FROM "datalake"."analytics_stage"."stg_user_activity_per_location"
GROUP BY state, city
ORDER BY state, SUM(activity_count) DESC
    )
[0m16:35:29.542593 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m16:35:29.822254 [debug] [Thread-1 (]: SQL status: SUCCESS in 0.0 seconds
[0m16:35:29.825937 [debug] [Thread-1 (]: Using trino connection "model.my_dbt_trino_project.mart_user_activity_per_state"
[0m16:35:29.826998 [debug] [Thread-1 (]: On model.my_dbt_trino_project.mart_user_activity_per_state: /* {"app": "dbt", "dbt_version": "1.8.2", "profile_name": "my_dbt_trino_project", "target_name": "dev", "node_id": "model.my_dbt_trino_project.mart_user_activity_per_state"} */
alter table "datalake"."analytics"."mart_user_activity_per_state" rename to "datalake"."analytics"."mart_user_activity_per_state__dbt_backup"
[0m16:35:29.915303 [debug] [Thread-1 (]: SQL status: SUCCESS in 0.0 seconds
[0m16:35:29.918310 [debug] [Thread-1 (]: Using trino connection "model.my_dbt_trino_project.mart_user_activity_per_state"
[0m16:35:29.919313 [debug] [Thread-1 (]: On model.my_dbt_trino_project.mart_user_activity_per_state: /* {"app": "dbt", "dbt_version": "1.8.2", "profile_name": "my_dbt_trino_project", "target_name": "dev", "node_id": "model.my_dbt_trino_project.mart_user_activity_per_state"} */
alter table "datalake"."analytics"."mart_user_activity_per_state__dbt_tmp" rename to "datalake"."analytics"."mart_user_activity_per_state"
[0m16:35:30.012469 [debug] [Thread-1 (]: SQL status: SUCCESS in 0.0 seconds
[0m16:35:30.015466 [debug] [Thread-1 (]: Applying DROP to: "datalake"."analytics"."mart_user_activity_per_state__dbt_backup"
[0m16:35:30.016467 [debug] [Thread-1 (]: Using trino connection "model.my_dbt_trino_project.mart_user_activity_per_state"
[0m16:35:30.017468 [debug] [Thread-1 (]: On model.my_dbt_trino_project.mart_user_activity_per_state: /* {"app": "dbt", "dbt_version": "1.8.2", "profile_name": "my_dbt_trino_project", "target_name": "dev", "node_id": "model.my_dbt_trino_project.mart_user_activity_per_state"} */

    drop table if exists "datalake"."analytics"."mart_user_activity_per_state__dbt_backup"
[0m16:35:30.151825 [debug] [Thread-1 (]: SQL status: SUCCESS in 0.0 seconds
[0m16:35:30.153825 [debug] [Thread-1 (]: On model.my_dbt_trino_project.mart_user_activity_per_state: ROLLBACK
[0m16:35:30.154827 [debug] [Thread-1 (]: On model.my_dbt_trino_project.mart_user_activity_per_state: Close
[0m16:35:30.154827 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '6d445026-1a06-40d9-9df1-6e0b60904b48', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x00000221B5C30750>]}
[0m16:35:30.155827 [info ] [Thread-1 (]: 15 of 15 OK created sql table model analytics.mart_user_activity_per_state ..... [[32mSUCCESS[0m in 0.62s]
[0m16:35:30.156997 [debug] [Thread-1 (]: Finished running node model.my_dbt_trino_project.mart_user_activity_per_state
[0m16:35:30.158000 [debug] [MainThread]: On master: COMMIT
[0m16:35:30.158996 [debug] [MainThread]: Connection 'master' was properly closed.
[0m16:35:30.158996 [debug] [MainThread]: Connection 'list_datalake' was properly closed.
[0m16:35:30.158996 [debug] [MainThread]: Connection 'list_datalake_analytics' was properly closed.
[0m16:35:30.158996 [debug] [MainThread]: Connection 'model.my_dbt_trino_project.mart_user_activity_per_state' was properly closed.
[0m16:35:30.160011 [info ] [MainThread]: 
[0m16:35:30.161010 [info ] [MainThread]: Finished running 8 table models, 2 incremental models, 5 view models in 0 hours 0 minutes and 6.49 seconds (6.49s).
[0m16:35:30.162012 [debug] [MainThread]: Command end result
[0m16:35:30.196740 [info ] [MainThread]: 
[0m16:35:30.197743 [info ] [MainThread]: [31mCompleted with 1 error and 0 warnings:[0m
[0m16:35:30.197743 [info ] [MainThread]: 
[0m16:35:30.199169 [error] [MainThread]:   Database Error in model stg_user_activity_per_country (models\stage\stg_user_activity_per_country.sql)
  TrinoUserError(type=USER_ERROR, name=TYPE_MISMATCH, message="line 17:3: UNION query has different number of fields: 4, 3", query_id=20240617_083527_00253_xsftb)
  compiled Code at target\run\my_dbt_trino_project\models\stage\stg_user_activity_per_country.sql
[0m16:35:30.200176 [info ] [MainThread]: 
[0m16:35:30.200176 [info ] [MainThread]: Done. PASS=13 WARN=0 ERROR=1 SKIP=1 TOTAL=15
[0m16:35:30.201174 [debug] [MainThread]: Command `dbt run` failed at 16:35:30.201174 after 7.54 seconds
[0m16:35:30.202177 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x00000221B06AF590>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x00000221B06AF550>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x00000221B06AF490>]}
[0m16:35:30.202177 [debug] [MainThread]: Flushing usage events
[0m10:10:12.827942 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x0000015311057DD0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x00000153110AB190>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x00000153110A8D10>]}


============================== 10:10:12.833450 | 99fdf06c-b191-4997-80c8-2fdd8e226ace ==============================
[0m10:10:12.833450 [info ] [MainThread]: Running with dbt=1.8.2
[0m10:10:12.833450 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'indirect_selection': 'eager', 'log_cache_events': 'False', 'write_json': 'True', 'partial_parse': 'True', 'cache_selected_only': 'False', 'profiles_dir': 'C:\\Users\\ASUS\\Desktop\\work\\Iceberg-Dbt-Trino-Hive-modern-open-source-data-stack-main\\dbt', 'version_check': 'True', 'debug': 'False', 'log_path': 'C:\\Users\\ASUS\\Desktop\\work\\Iceberg-Dbt-Trino-Hive-modern-open-source-data-stack-main\\dbt\\logs', 'warn_error': 'None', 'fail_fast': 'False', 'use_colors': 'True', 'use_experimental_parser': 'False', 'no_print': 'None', 'quiet': 'False', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'introspect': 'True', 'log_format': 'default', 'static_parser': 'True', 'target_path': 'None', 'invocation_command': 'dbt run', 'send_anonymous_usage_stats': 'True'}
[0m10:10:13.436949 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': '99fdf06c-b191-4997-80c8-2fdd8e226ace', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x00000153114064D0>]}
[0m10:10:13.468040 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': '99fdf06c-b191-4997-80c8-2fdd8e226ace', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x00000153113B5190>]}
[0m10:10:13.469544 [info ] [MainThread]: Registered adapter: trino=1.8.0
[0m10:10:13.482685 [debug] [MainThread]: checksum: f0a141b9de567cb7f131613ba2682f40b3a1c6a157f81c6e5435862eff68f109, vars: {}, profile: , target: , version: 1.8.2
[0m10:10:13.687286 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 1 files changed.
[0m10:10:13.687821 [debug] [MainThread]: Partial parsing: updated file: my_dbt_trino_project://models\source\src_auth_events.sql
[0m10:10:13.847408 [warn ] [MainThread]: [[33mWARNING[0m]: Deprecated functionality
The `tests` config has been renamed to `data_tests`. Please see
https://docs.getdbt.com/docs/build/data-tests#new-data_tests-syntax for more
information.
[0m10:10:13.848437 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'deprecation', 'label': '99fdf06c-b191-4997-80c8-2fdd8e226ace', 'property_': 'warn', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000001531294AE90>]}
[0m10:10:14.012160 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': '99fdf06c-b191-4997-80c8-2fdd8e226ace', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x0000015312A015D0>]}
[0m10:10:14.090737 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': '99fdf06c-b191-4997-80c8-2fdd8e226ace', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x0000015311704ED0>]}
[0m10:10:14.091742 [info ] [MainThread]: Found 15 models, 7 data tests, 3 sources, 559 macros
[0m10:10:14.091742 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '99fdf06c-b191-4997-80c8-2fdd8e226ace', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x0000015312A59110>]}
[0m10:10:14.093760 [info ] [MainThread]: 
[0m10:10:14.093760 [debug] [MainThread]: Acquiring new trino connection 'master'
[0m10:10:14.097814 [debug] [ThreadPool]: Acquiring new trino connection 'list_datalake'
[0m10:10:14.318418 [debug] [ThreadPool]: Using trino connection "list_datalake"
[0m10:10:14.318418 [debug] [ThreadPool]: On list_datalake: /* {"app": "dbt", "dbt_version": "1.8.2", "profile_name": "my_dbt_trino_project", "target_name": "dev", "connection_name": "list_datalake"} */

    select schema_name
    from "datalake".INFORMATION_SCHEMA.schemata
[0m10:10:14.319418 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m10:10:27.966312 [debug] [ThreadPool]: On list_datalake: Close
[0m10:10:27.969826 [debug] [ThreadPool]: Using trino connection "list_datalake"
[0m10:10:27.970837 [debug] [ThreadPool]: On list_datalake: /* {"app": "dbt", "dbt_version": "1.8.2", "profile_name": "my_dbt_trino_project", "target_name": "dev", "connection_name": "list_datalake"} */

    select schema_name
    from "datalake".INFORMATION_SCHEMA.schemata
[0m10:10:27.970837 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m10:10:40.948642 [debug] [ThreadPool]: On list_datalake: Close
[0m10:10:40.954092 [debug] [ThreadPool]: Using trino connection "list_datalake"
[0m10:10:40.955213 [debug] [ThreadPool]: On list_datalake: /* {"app": "dbt", "dbt_version": "1.8.2", "profile_name": "my_dbt_trino_project", "target_name": "dev", "connection_name": "list_datalake"} */

    select schema_name
    from "datalake".INFORMATION_SCHEMA.schemata
[0m10:10:40.955741 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m10:10:54.119808 [debug] [ThreadPool]: On list_datalake: Close
[0m10:10:54.120860 [debug] [MainThread]: Connection 'master' was properly closed.
[0m10:10:54.121380 [debug] [MainThread]: Connection 'list_datalake' was properly closed.
[0m10:10:54.121380 [info ] [MainThread]: 
[0m10:10:54.122787 [info ] [MainThread]: Finished running  in 0 hours 0 minutes and 40.03 seconds (40.03s).
[0m10:10:54.123098 [error] [MainThread]: Encountered an error:

[0m10:10:54.138730 [error] [MainThread]: Traceback (most recent call last):
  File "C:\Users\ASUS\anaconda3\Lib\site-packages\urllib3\connection.py", line 174, in _new_conn
    conn = connection.create_connection(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\ASUS\anaconda3\Lib\site-packages\urllib3\util\connection.py", line 95, in create_connection
    raise err
  File "C:\Users\ASUS\anaconda3\Lib\site-packages\urllib3\util\connection.py", line 85, in create_connection
    sock.connect(sa)
ConnectionRefusedError: [WinError 10061] 無法連線，因為目標電腦拒絕連線。

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "C:\Users\ASUS\anaconda3\Lib\site-packages\urllib3\connectionpool.py", line 714, in urlopen
    httplib_response = self._make_request(
                       ^^^^^^^^^^^^^^^^^^^
  File "C:\Users\ASUS\anaconda3\Lib\site-packages\urllib3\connectionpool.py", line 415, in _make_request
    conn.request(method, url, **httplib_request_kw)
  File "C:\Users\ASUS\anaconda3\Lib\site-packages\urllib3\connection.py", line 244, in request
    super(HTTPConnection, self).request(method, url, body=body, headers=headers)
  File "C:\Users\ASUS\anaconda3\Lib\http\client.py", line 1286, in request
    self._send_request(method, url, body, headers, encode_chunked)
  File "C:\Users\ASUS\anaconda3\Lib\http\client.py", line 1332, in _send_request
    self.endheaders(body, encode_chunked=encode_chunked)
  File "C:\Users\ASUS\anaconda3\Lib\http\client.py", line 1281, in endheaders
    self._send_output(message_body, encode_chunked=encode_chunked)
  File "C:\Users\ASUS\anaconda3\Lib\http\client.py", line 1041, in _send_output
    self.send(msg)
  File "C:\Users\ASUS\anaconda3\Lib\http\client.py", line 979, in send
    self.connect()
  File "C:\Users\ASUS\anaconda3\Lib\site-packages\urllib3\connection.py", line 205, in connect
    conn = self._new_conn()
           ^^^^^^^^^^^^^^^^
  File "C:\Users\ASUS\anaconda3\Lib\site-packages\urllib3\connection.py", line 186, in _new_conn
    raise NewConnectionError(
urllib3.exceptions.NewConnectionError: <urllib3.connection.HTTPConnection object at 0x0000015312D43090>: Failed to establish a new connection: [WinError 10061] 無法連線，因為目標電腦拒絕連線。

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "C:\Users\ASUS\anaconda3\Lib\site-packages\requests\adapters.py", line 486, in send
    resp = conn.urlopen(
           ^^^^^^^^^^^^^
  File "C:\Users\ASUS\anaconda3\Lib\site-packages\urllib3\connectionpool.py", line 798, in urlopen
    retries = retries.increment(
              ^^^^^^^^^^^^^^^^^^
  File "C:\Users\ASUS\anaconda3\Lib\site-packages\urllib3\util\retry.py", line 592, in increment
    raise MaxRetryError(_pool, url, error or ResponseError(cause))
urllib3.exceptions.MaxRetryError: HTTPConnectionPool(host='localhost', port=8080): Max retries exceeded with url: /v1/statement (Caused by NewConnectionError('<urllib3.connection.HTTPConnection object at 0x0000015312D43090>: Failed to establish a new connection: [WinError 10061] 無法連線，因為目標電腦拒絕連線。'))

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "C:\Users\ASUS\anaconda3\Lib\site-packages\trino\client.py", line 780, in execute
    response = self._request.post(self._query, additional_http_headers)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\ASUS\anaconda3\Lib\site-packages\trino\client.py", line 542, in post
    http_response = self._post(
                    ^^^^^^^^^^^
  File "C:\Users\ASUS\anaconda3\Lib\site-packages\trino\client.py", line 879, in decorated
    raise error
  File "C:\Users\ASUS\anaconda3\Lib\site-packages\trino\client.py", line 866, in decorated
    result = func(*args, **kwargs)
             ^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\ASUS\anaconda3\Lib\site-packages\requests\sessions.py", line 637, in post
    return self.request("POST", url, data=data, json=json, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\ASUS\anaconda3\Lib\site-packages\requests\sessions.py", line 589, in request
    resp = self.send(prep, **send_kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\ASUS\anaconda3\Lib\site-packages\requests\sessions.py", line 703, in send
    r = adapter.send(request, **kwargs)
        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\ASUS\anaconda3\Lib\site-packages\requests\adapters.py", line 519, in send
    raise ConnectionError(e, request=request)
requests.exceptions.ConnectionError: HTTPConnectionPool(host='localhost', port=8080): Max retries exceeded with url: /v1/statement (Caused by NewConnectionError('<urllib3.connection.HTTPConnection object at 0x0000015312D43090>: Failed to establish a new connection: [WinError 10061] 無法連線，因為目標電腦拒絕連線。'))

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "C:\Users\ASUS\anaconda3\Lib\site-packages\dbt\adapters\trino\connections.py", line 430, in exception_handler
    yield
  File "C:\Users\ASUS\anaconda3\Lib\site-packages\dbt\adapters\sql\connections.py", line 94, in add_query
    cursor.execute(sql, bindings)
  File "C:\Users\ASUS\anaconda3\Lib\site-packages\dbt\adapters\trino\connections.py", line 386, in execute
    result = self._cursor.execute(sql, params=bindings)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\ASUS\anaconda3\Lib\site-packages\trino\dbapi.py", line 589, in execute
    self._iterator = iter(self._query.execute())
                          ^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\ASUS\anaconda3\Lib\site-packages\trino\client.py", line 782, in execute
    raise trino.exceptions.TrinoConnectionError("failed to execute: {}".format(e))
trino.exceptions.TrinoConnectionError: failed to execute: HTTPConnectionPool(host='localhost', port=8080): Max retries exceeded with url: /v1/statement (Caused by NewConnectionError('<urllib3.connection.HTTPConnection object at 0x0000015312D43090>: Failed to establish a new connection: [WinError 10061] 無法連線，因為目標電腦拒絕連線。'))

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "C:\Users\ASUS\anaconda3\Lib\site-packages\dbt\task\runnable.py", line 627, in create_schemas
    existing_schemas_lowered.update(ls_future.result())
                                    ^^^^^^^^^^^^^^^^^^
  File "C:\Users\ASUS\anaconda3\Lib\concurrent\futures\_base.py", line 449, in result
    return self.__get_result()
           ^^^^^^^^^^^^^^^^^^^
  File "C:\Users\ASUS\anaconda3\Lib\concurrent\futures\_base.py", line 401, in __get_result
    raise self._exception
  File "C:\Users\ASUS\anaconda3\Lib\concurrent\futures\thread.py", line 58, in run
    result = self.fn(*self.args, **self.kwargs)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\ASUS\anaconda3\Lib\site-packages\dbt_common\utils\executor.py", line 13, in connected
    return func(*args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\ASUS\anaconda3\Lib\site-packages\dbt\task\runnable.py", line 602, in list_schemas
    for s in adapter.list_schemas(database_quoted)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\ASUS\anaconda3\Lib\site-packages\dbt\adapters\sql\impl.py", line 213, in list_schemas
    results = self.execute_macro(LIST_SCHEMAS_MACRO_NAME, kwargs={"database": database})
              ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\ASUS\anaconda3\Lib\site-packages\dbt\adapters\base\impl.py", line 1119, in execute_macro
    result = macro_function(**kwargs)
             ^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\ASUS\anaconda3\Lib\site-packages\dbt_common\clients\jinja.py", line 335, in __call__
    return self.call_macro(*args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\ASUS\anaconda3\Lib\site-packages\dbt_common\clients\jinja.py", line 298, in call_macro
    return macro(*args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\ASUS\anaconda3\Lib\site-packages\jinja2\runtime.py", line 768, in __call__
    return self._invoke(arguments, autoescape)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\ASUS\anaconda3\Lib\site-packages\jinja2\runtime.py", line 782, in _invoke
    rv = self._func(*arguments)
         ^^^^^^^^^^^^^^^^^^^^^^
  File "<template>", line 20, in macro
  File "C:\Users\ASUS\anaconda3\Lib\site-packages\jinja2\sandbox.py", line 394, in call
    return __context.call(__obj, *args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\ASUS\anaconda3\Lib\site-packages\jinja2\runtime.py", line 303, in call
    return __obj(*args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\ASUS\anaconda3\Lib\site-packages\dbt\clients\jinja.py", line 84, in __call__
    return self.call_macro(*args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\ASUS\anaconda3\Lib\site-packages\dbt_common\clients\jinja.py", line 298, in call_macro
    return macro(*args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\ASUS\anaconda3\Lib\site-packages\jinja2\runtime.py", line 768, in __call__
    return self._invoke(arguments, autoescape)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\ASUS\anaconda3\Lib\site-packages\jinja2\runtime.py", line 782, in _invoke
    rv = self._func(*arguments)
         ^^^^^^^^^^^^^^^^^^^^^^
  File "<template>", line 31, in macro
  File "C:\Users\ASUS\anaconda3\Lib\site-packages\jinja2\sandbox.py", line 394, in call
    return __context.call(__obj, *args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\ASUS\anaconda3\Lib\site-packages\jinja2\runtime.py", line 303, in call
    return __obj(*args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\ASUS\anaconda3\Lib\site-packages\dbt\clients\jinja.py", line 84, in __call__
    return self.call_macro(*args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\ASUS\anaconda3\Lib\site-packages\dbt_common\clients\jinja.py", line 298, in call_macro
    return macro(*args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\ASUS\anaconda3\Lib\site-packages\jinja2\runtime.py", line 768, in __call__
    return self._invoke(arguments, autoescape)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\ASUS\anaconda3\Lib\site-packages\jinja2\runtime.py", line 782, in _invoke
    rv = self._func(*arguments)
         ^^^^^^^^^^^^^^^^^^^^^^
  File "<template>", line 52, in macro
  File "C:\Users\ASUS\anaconda3\Lib\site-packages\jinja2\sandbox.py", line 394, in call
    return __context.call(__obj, *args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\ASUS\anaconda3\Lib\site-packages\jinja2\runtime.py", line 303, in call
    return __obj(*args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\ASUS\anaconda3\Lib\site-packages\dbt\adapters\base\impl.py", line 350, in execute
    return self.connections.execute(sql=sql, auto_begin=auto_begin, fetch=fetch, limit=limit)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\ASUS\anaconda3\Lib\site-packages\dbt\adapters\sql\connections.py", line 156, in execute
    _, cursor = self.add_query(sql, auto_begin)
                ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\ASUS\anaconda3\Lib\site-packages\dbt\adapters\trino\connections.py", line 528, in add_query
    connection, cursor = parent.add_query(
                         ^^^^^^^^^^^^^^^^^
  File "C:\Users\ASUS\anaconda3\Lib\site-packages\dbt\adapters\sql\connections.py", line 78, in add_query
    with self.exception_handler(sql):
  File "C:\Users\ASUS\anaconda3\Lib\contextlib.py", line 155, in __exit__
    self.gen.throw(typ, value, traceback)
  File "C:\Users\ASUS\anaconda3\Lib\site-packages\dbt\adapters\trino\connections.py", line 435, in exception_handler
    raise FailedToConnectError(msg) from e
dbt.adapters.exceptions.connection.FailedToConnectError: Database Error
  failed to execute: HTTPConnectionPool(host='localhost', port=8080): Max retries exceeded with url: /v1/statement (Caused by NewConnectionError('<urllib3.connection.HTTPConnection object at 0x0000015312D43090>: Failed to establish a new connection: [WinError 10061] 無法連線，因為目標電腦拒絕連線。'))

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "C:\Users\ASUS\anaconda3\Lib\site-packages\dbt\cli\requires.py", line 138, in wrapper
    result, success = func(*args, **kwargs)
                      ^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\ASUS\anaconda3\Lib\site-packages\dbt\cli\requires.py", line 101, in wrapper
    return func(*args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\ASUS\anaconda3\Lib\site-packages\dbt\cli\requires.py", line 218, in wrapper
    return func(*args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\ASUS\anaconda3\Lib\site-packages\dbt\cli\requires.py", line 247, in wrapper
    return func(*args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\ASUS\anaconda3\Lib\site-packages\dbt\cli\requires.py", line 294, in wrapper
    return func(*args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\ASUS\anaconda3\Lib\site-packages\dbt\cli\requires.py", line 332, in wrapper
    return func(*args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\ASUS\anaconda3\Lib\site-packages\dbt\cli\main.py", line 569, in run
    results = task.run()
              ^^^^^^^^^^
  File "C:\Users\ASUS\anaconda3\Lib\site-packages\dbt\task\runnable.py", line 526, in run
    result = self.execute_with_hooks(selected_uids)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\ASUS\anaconda3\Lib\site-packages\dbt\task\runnable.py", line 486, in execute_with_hooks
    self.before_run(adapter, selected_uids)
  File "C:\Users\ASUS\anaconda3\Lib\site-packages\dbt\task\run.py", line 459, in before_run
    self.create_schemas(adapter, required_schemas)
  File "C:\Users\ASUS\anaconda3\Lib\site-packages\dbt\task\runnable.py", line 617, in create_schemas
    with dbt_common.utils.executor(self.config) as tpe:  # type: ignore
  File "C:\Users\ASUS\anaconda3\Lib\concurrent\futures\_base.py", line 647, in __exit__
    self.shutdown(wait=True)
  File "C:\Users\ASUS\anaconda3\Lib\concurrent\futures\thread.py", line 235, in shutdown
    t.join()
  File "C:\Users\ASUS\anaconda3\Lib\threading.py", line 1112, in join
    self._wait_for_tstate_lock()
  File "C:\Users\ASUS\anaconda3\Lib\threading.py", line 1132, in _wait_for_tstate_lock
    if lock.acquire(block, timeout):
       ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
KeyboardInterrupt

[0m10:10:54.154795 [debug] [MainThread]: Command `dbt run` failed at 10:10:54.154795 after 41.49 seconds
[0m10:10:54.154795 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000001530F962C90>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000001530C11F590>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000001530C11F410>]}
[0m10:10:54.155794 [debug] [MainThread]: Flushing usage events
[0m10:22:10.643696 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x0000018460A76F10>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x0000018460AA2E90>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x0000018460AB88D0>]}


============================== 10:22:10.645696 | d6959cc8-448e-497b-afb2-bb9c2a807523 ==============================
[0m10:22:10.645696 [info ] [MainThread]: Running with dbt=1.8.2
[0m10:22:10.646698 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'indirect_selection': 'eager', 'write_json': 'True', 'log_cache_events': 'False', 'partial_parse': 'True', 'cache_selected_only': 'False', 'warn_error': 'None', 'fail_fast': 'False', 'version_check': 'True', 'log_path': 'C:\\Users\\ASUS\\Desktop\\work\\Iceberg-Dbt-Trino-Hive-modern-open-source-data-stack-main\\dbt\\logs', 'debug': 'False', 'profiles_dir': 'C:\\Users\\ASUS\\Desktop\\work\\Iceberg-Dbt-Trino-Hive-modern-open-source-data-stack-main\\dbt', 'use_colors': 'True', 'use_experimental_parser': 'False', 'no_print': 'None', 'quiet': 'False', 'log_format': 'default', 'invocation_command': 'dbt test', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'static_parser': 'True', 'target_path': 'None', 'introspect': 'True', 'send_anonymous_usage_stats': 'True'}
[0m10:22:10.965832 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': 'd6959cc8-448e-497b-afb2-bb9c2a807523', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x0000018460ED7890>]}
[0m10:22:11.001044 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': 'd6959cc8-448e-497b-afb2-bb9c2a807523', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000001845DBF5550>]}
[0m10:22:11.002096 [info ] [MainThread]: Registered adapter: trino=1.8.0
[0m10:22:11.015324 [debug] [MainThread]: checksum: f0a141b9de567cb7f131613ba2682f40b3a1c6a157f81c6e5435862eff68f109, vars: {}, profile: , target: , version: 1.8.2
[0m10:22:11.194075 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 0 files changed.
[0m10:22:11.194075 [debug] [MainThread]: Partial parsing enabled, no changes found, skipping parsing
[0m10:22:11.228586 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': 'd6959cc8-448e-497b-afb2-bb9c2a807523', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x0000018460E37610>]}
[0m10:22:11.314852 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': 'd6959cc8-448e-497b-afb2-bb9c2a807523', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x0000018460EF3ED0>]}
[0m10:22:11.315850 [info ] [MainThread]: Found 15 models, 7 data tests, 3 sources, 559 macros
[0m10:22:11.316854 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': 'd6959cc8-448e-497b-afb2-bb9c2a807523', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000001846106B5D0>]}
[0m10:22:11.317855 [info ] [MainThread]: 
[0m10:22:11.318852 [debug] [MainThread]: Acquiring new trino connection 'master'
[0m10:22:11.323851 [debug] [ThreadPool]: Acquiring new trino connection 'list_datalake_analytics_stage'
[0m10:22:11.380894 [debug] [ThreadPool]: Using trino connection "list_datalake_analytics_stage"
[0m10:22:11.380894 [debug] [ThreadPool]: On list_datalake_analytics_stage: /* {"app": "dbt", "dbt_version": "1.8.2", "profile_name": "my_dbt_trino_project", "target_name": "dev", "connection_name": "list_datalake_analytics_stage"} */
select
      t.table_catalog as database,
      t.table_name as name,
      t.table_schema as schema,
      case when mv.name is not null then 'materialized_view'
           when t.table_type = 'BASE TABLE' then 'table'
           when t.table_type = 'VIEW' then 'view'
           else t.table_type
      end as table_type
    from "datalake".INFORMATION_SCHEMA.tables t
    left join (
            select * from system.metadata.materialized_views
            where catalog_name = 'datalake'
              and schema_name = 'analytics_stage') mv
          on mv.catalog_name = t.table_catalog and mv.schema_name = t.table_schema and mv.name = t.table_name
    where t.table_schema = 'analytics_stage'
[0m10:22:11.380894 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m10:22:12.746513 [debug] [ThreadPool]: SQL status: SUCCESS in 1.0 seconds
[0m10:22:12.748055 [debug] [ThreadPool]: On list_datalake_analytics_stage: ROLLBACK
[0m10:22:12.749107 [debug] [ThreadPool]: On list_datalake_analytics_stage: Close
[0m10:22:12.750155 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_datalake_analytics_stage, now list_datalake_analytics)
[0m10:22:12.755398 [debug] [ThreadPool]: Using trino connection "list_datalake_analytics"
[0m10:22:12.756426 [debug] [ThreadPool]: On list_datalake_analytics: /* {"app": "dbt", "dbt_version": "1.8.2", "profile_name": "my_dbt_trino_project", "target_name": "dev", "connection_name": "list_datalake_analytics"} */
select
      t.table_catalog as database,
      t.table_name as name,
      t.table_schema as schema,
      case when mv.name is not null then 'materialized_view'
           when t.table_type = 'BASE TABLE' then 'table'
           when t.table_type = 'VIEW' then 'view'
           else t.table_type
      end as table_type
    from "datalake".INFORMATION_SCHEMA.tables t
    left join (
            select * from system.metadata.materialized_views
            where catalog_name = 'datalake'
              and schema_name = 'analytics') mv
          on mv.catalog_name = t.table_catalog and mv.schema_name = t.table_schema and mv.name = t.table_name
    where t.table_schema = 'analytics'
[0m10:22:12.756426 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m10:22:13.011372 [debug] [ThreadPool]: SQL status: SUCCESS in 0.0 seconds
[0m10:22:13.015611 [debug] [ThreadPool]: On list_datalake_analytics: ROLLBACK
[0m10:22:13.015611 [debug] [ThreadPool]: On list_datalake_analytics: Close
[0m10:22:13.017090 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_datalake_analytics, now list_datalake_analytics_source)
[0m10:22:13.021825 [debug] [ThreadPool]: Using trino connection "list_datalake_analytics_source"
[0m10:22:13.022827 [debug] [ThreadPool]: On list_datalake_analytics_source: /* {"app": "dbt", "dbt_version": "1.8.2", "profile_name": "my_dbt_trino_project", "target_name": "dev", "connection_name": "list_datalake_analytics_source"} */
select
      t.table_catalog as database,
      t.table_name as name,
      t.table_schema as schema,
      case when mv.name is not null then 'materialized_view'
           when t.table_type = 'BASE TABLE' then 'table'
           when t.table_type = 'VIEW' then 'view'
           else t.table_type
      end as table_type
    from "datalake".INFORMATION_SCHEMA.tables t
    left join (
            select * from system.metadata.materialized_views
            where catalog_name = 'datalake'
              and schema_name = 'analytics_source') mv
          on mv.catalog_name = t.table_catalog and mv.schema_name = t.table_schema and mv.name = t.table_name
    where t.table_schema = 'analytics_source'
[0m10:22:13.023918 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m10:22:13.179908 [debug] [ThreadPool]: SQL status: SUCCESS in 0.0 seconds
[0m10:22:13.181470 [debug] [ThreadPool]: On list_datalake_analytics_source: ROLLBACK
[0m10:22:13.181990 [debug] [ThreadPool]: On list_datalake_analytics_source: Close
[0m10:22:13.183638 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': 'd6959cc8-448e-497b-afb2-bb9c2a807523', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x0000018460F92250>]}
[0m10:22:13.184677 [debug] [MainThread]: On master: COMMIT
[0m10:22:13.185201 [info ] [MainThread]: Concurrency: 1 threads (target='dev')
[0m10:22:13.186267 [info ] [MainThread]: 
[0m10:22:13.190317 [debug] [Thread-1 (]: Began running node test.my_dbt_trino_project.accepted_values_src_auth_events_gender__F__M.888b091b87
[0m10:22:13.190317 [info ] [Thread-1 (]: 1 of 7 START test accepted_values_src_auth_events_gender__F__M ................. [RUN]
[0m10:22:13.191825 [debug] [Thread-1 (]: Acquiring new trino connection 'test.my_dbt_trino_project.accepted_values_src_auth_events_gender__F__M.888b091b87'
[0m10:22:13.192833 [debug] [Thread-1 (]: Began compiling node test.my_dbt_trino_project.accepted_values_src_auth_events_gender__F__M.888b091b87
[0m10:22:13.208920 [debug] [Thread-1 (]: Writing injected SQL for node "test.my_dbt_trino_project.accepted_values_src_auth_events_gender__F__M.888b091b87"
[0m10:22:13.210304 [debug] [Thread-1 (]: Began executing node test.my_dbt_trino_project.accepted_values_src_auth_events_gender__F__M.888b091b87
[0m10:22:13.227499 [debug] [Thread-1 (]: Writing runtime sql for node "test.my_dbt_trino_project.accepted_values_src_auth_events_gender__F__M.888b091b87"
[0m10:22:13.230010 [debug] [Thread-1 (]: Using trino connection "test.my_dbt_trino_project.accepted_values_src_auth_events_gender__F__M.888b091b87"
[0m10:22:13.231017 [debug] [Thread-1 (]: On test.my_dbt_trino_project.accepted_values_src_auth_events_gender__F__M.888b091b87: /* {"app": "dbt", "dbt_version": "1.8.2", "profile_name": "my_dbt_trino_project", "target_name": "dev", "node_id": "test.my_dbt_trino_project.accepted_values_src_auth_events_gender__F__M.888b091b87"} */
select
      count(*) as failures,
      count(*) != 0 as should_warn,
      count(*) != 0 as should_error
    from (
      
    
    

with all_values as (

    select
        gender as value_field,
        count(*) as n_records

    from "datalake"."analytics_source"."src_auth_events"
    group by gender

)

select *
from all_values
where value_field not in (
    'F','M'
)



      
    ) dbt_internal_test
[0m10:22:13.231017 [debug] [Thread-1 (]: Opening a new connection, currently in state init
[0m10:22:15.350918 [debug] [Thread-1 (]: SQL status: SUCCESS in 2.0 seconds
[0m10:22:15.354629 [debug] [Thread-1 (]: On test.my_dbt_trino_project.accepted_values_src_auth_events_gender__F__M.888b091b87: ROLLBACK
[0m10:22:15.354629 [debug] [Thread-1 (]: On test.my_dbt_trino_project.accepted_values_src_auth_events_gender__F__M.888b091b87: Close
[0m10:22:15.356152 [error] [Thread-1 (]: 1 of 7 FAIL 1 accepted_values_src_auth_events_gender__F__M ..................... [[31mFAIL 1[0m in 2.16s]
[0m10:22:15.357225 [debug] [Thread-1 (]: Finished running node test.my_dbt_trino_project.accepted_values_src_auth_events_gender__F__M.888b091b87
[0m10:22:15.357755 [debug] [Thread-1 (]: Began running node test.my_dbt_trino_project.accepted_values_src_auth_events_level__free__paid.2d853012e0
[0m10:22:15.358288 [info ] [Thread-1 (]: 2 of 7 START test accepted_values_src_auth_events_level__free__paid ............ [RUN]
[0m10:22:15.358818 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly test.my_dbt_trino_project.accepted_values_src_auth_events_gender__F__M.888b091b87, now test.my_dbt_trino_project.accepted_values_src_auth_events_level__free__paid.2d853012e0)
[0m10:22:15.358818 [debug] [Thread-1 (]: Began compiling node test.my_dbt_trino_project.accepted_values_src_auth_events_level__free__paid.2d853012e0
[0m10:22:15.363848 [debug] [Thread-1 (]: Writing injected SQL for node "test.my_dbt_trino_project.accepted_values_src_auth_events_level__free__paid.2d853012e0"
[0m10:22:15.363848 [debug] [Thread-1 (]: Began executing node test.my_dbt_trino_project.accepted_values_src_auth_events_level__free__paid.2d853012e0
[0m10:22:15.366913 [debug] [Thread-1 (]: Writing runtime sql for node "test.my_dbt_trino_project.accepted_values_src_auth_events_level__free__paid.2d853012e0"
[0m10:22:15.368920 [debug] [Thread-1 (]: Using trino connection "test.my_dbt_trino_project.accepted_values_src_auth_events_level__free__paid.2d853012e0"
[0m10:22:15.368920 [debug] [Thread-1 (]: On test.my_dbt_trino_project.accepted_values_src_auth_events_level__free__paid.2d853012e0: /* {"app": "dbt", "dbt_version": "1.8.2", "profile_name": "my_dbt_trino_project", "target_name": "dev", "node_id": "test.my_dbt_trino_project.accepted_values_src_auth_events_level__free__paid.2d853012e0"} */
select
      count(*) as failures,
      count(*) != 0 as should_warn,
      count(*) != 0 as should_error
    from (
      
    
    

with all_values as (

    select
        level as value_field,
        count(*) as n_records

    from "datalake"."analytics_source"."src_auth_events"
    group by level

)

select *
from all_values
where value_field not in (
    'free','paid'
)



      
    ) dbt_internal_test
[0m10:22:15.369922 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m10:22:15.646542 [debug] [Thread-1 (]: SQL status: SUCCESS in 0.0 seconds
[0m10:22:15.648675 [debug] [Thread-1 (]: On test.my_dbt_trino_project.accepted_values_src_auth_events_level__free__paid.2d853012e0: ROLLBACK
[0m10:22:15.649213 [debug] [Thread-1 (]: On test.my_dbt_trino_project.accepted_values_src_auth_events_level__free__paid.2d853012e0: Close
[0m10:22:15.650807 [info ] [Thread-1 (]: 2 of 7 PASS accepted_values_src_auth_events_level__free__paid .................. [[32mPASS[0m in 0.29s]
[0m10:22:15.651887 [debug] [Thread-1 (]: Finished running node test.my_dbt_trino_project.accepted_values_src_auth_events_level__free__paid.2d853012e0
[0m10:22:15.652942 [debug] [Thread-1 (]: Began running node test.my_dbt_trino_project.accepted_values_src_auth_events_success__True__False.5205206c4b
[0m10:22:15.653469 [info ] [Thread-1 (]: 3 of 7 START test accepted_values_src_auth_events_success__True__False ......... [RUN]
[0m10:22:15.654538 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly test.my_dbt_trino_project.accepted_values_src_auth_events_level__free__paid.2d853012e0, now test.my_dbt_trino_project.accepted_values_src_auth_events_success__True__False.5205206c4b)
[0m10:22:15.655063 [debug] [Thread-1 (]: Began compiling node test.my_dbt_trino_project.accepted_values_src_auth_events_success__True__False.5205206c4b
[0m10:22:15.662205 [debug] [Thread-1 (]: Writing injected SQL for node "test.my_dbt_trino_project.accepted_values_src_auth_events_success__True__False.5205206c4b"
[0m10:22:15.664204 [debug] [Thread-1 (]: Began executing node test.my_dbt_trino_project.accepted_values_src_auth_events_success__True__False.5205206c4b
[0m10:22:15.669912 [debug] [Thread-1 (]: Writing runtime sql for node "test.my_dbt_trino_project.accepted_values_src_auth_events_success__True__False.5205206c4b"
[0m10:22:15.672443 [debug] [Thread-1 (]: Using trino connection "test.my_dbt_trino_project.accepted_values_src_auth_events_success__True__False.5205206c4b"
[0m10:22:15.673445 [debug] [Thread-1 (]: On test.my_dbt_trino_project.accepted_values_src_auth_events_success__True__False.5205206c4b: /* {"app": "dbt", "dbt_version": "1.8.2", "profile_name": "my_dbt_trino_project", "target_name": "dev", "node_id": "test.my_dbt_trino_project.accepted_values_src_auth_events_success__True__False.5205206c4b"} */
select
      count(*) as failures,
      count(*) != 0 as should_warn,
      count(*) != 0 as should_error
    from (
      
    
    

with all_values as (

    select
        success as value_field,
        count(*) as n_records

    from "datalake"."analytics_source"."src_auth_events"
    group by success

)

select *
from all_values
where value_field not in (
    'True','False'
)



      
    ) dbt_internal_test
[0m10:22:15.674443 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m10:22:15.739356 [debug] [Thread-1 (]: Trino adapter: Trino query id: 20240618_022215_00005_z97n2
[0m10:22:15.739888 [debug] [Thread-1 (]: Trino adapter: Trino error: TrinoUserError(type=USER_ERROR, name=COLUMN_NOT_FOUND, message="line 14:9: Column 'success' cannot be resolved", query_id=20240618_022215_00005_z97n2)
[0m10:22:15.740420 [debug] [Thread-1 (]: On test.my_dbt_trino_project.accepted_values_src_auth_events_success__True__False.5205206c4b: ROLLBACK
[0m10:22:15.740955 [debug] [Thread-1 (]: On test.my_dbt_trino_project.accepted_values_src_auth_events_success__True__False.5205206c4b: Close
[0m10:22:15.746085 [debug] [Thread-1 (]: Database Error in test accepted_values_src_auth_events_success__True__False (models\source\schema.yml)
  TrinoUserError(type=USER_ERROR, name=COLUMN_NOT_FOUND, message="line 14:9: Column 'success' cannot be resolved", query_id=20240618_022215_00005_z97n2)
  compiled Code at target\run\my_dbt_trino_project\models\source\schema.yml\accepted_values_src_auth_events_success__True__False.sql
[0m10:22:15.747086 [error] [Thread-1 (]: 3 of 7 ERROR accepted_values_src_auth_events_success__True__False .............. [[31mERROR[0m in 0.09s]
[0m10:22:15.748596 [debug] [Thread-1 (]: Finished running node test.my_dbt_trino_project.accepted_values_src_auth_events_success__True__False.5205206c4b
[0m10:22:15.748596 [debug] [Thread-1 (]: Began running node test.my_dbt_trino_project.not_null_src_auth_events_sessionId.5faf81a495
[0m10:22:15.749607 [info ] [Thread-1 (]: 4 of 7 START test not_null_src_auth_events_sessionId ........................... [RUN]
[0m10:22:15.750607 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly test.my_dbt_trino_project.accepted_values_src_auth_events_success__True__False.5205206c4b, now test.my_dbt_trino_project.not_null_src_auth_events_sessionId.5faf81a495)
[0m10:22:15.751117 [debug] [Thread-1 (]: Began compiling node test.my_dbt_trino_project.not_null_src_auth_events_sessionId.5faf81a495
[0m10:22:15.757177 [debug] [Thread-1 (]: Writing injected SQL for node "test.my_dbt_trino_project.not_null_src_auth_events_sessionId.5faf81a495"
[0m10:22:15.758175 [debug] [Thread-1 (]: Began executing node test.my_dbt_trino_project.not_null_src_auth_events_sessionId.5faf81a495
[0m10:22:15.761694 [debug] [Thread-1 (]: Writing runtime sql for node "test.my_dbt_trino_project.not_null_src_auth_events_sessionId.5faf81a495"
[0m10:22:15.763692 [debug] [Thread-1 (]: Using trino connection "test.my_dbt_trino_project.not_null_src_auth_events_sessionId.5faf81a495"
[0m10:22:15.764695 [debug] [Thread-1 (]: On test.my_dbt_trino_project.not_null_src_auth_events_sessionId.5faf81a495: /* {"app": "dbt", "dbt_version": "1.8.2", "profile_name": "my_dbt_trino_project", "target_name": "dev", "node_id": "test.my_dbt_trino_project.not_null_src_auth_events_sessionId.5faf81a495"} */
select
      count(*) as failures,
      count(*) != 0 as should_warn,
      count(*) != 0 as should_error
    from (
      
    
    



select sessionId
from "datalake"."analytics_source"."src_auth_events"
where sessionId is null



      
    ) dbt_internal_test
[0m10:22:15.764695 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m10:22:15.930772 [debug] [Thread-1 (]: SQL status: SUCCESS in 0.0 seconds
[0m10:22:15.933420 [debug] [Thread-1 (]: On test.my_dbt_trino_project.not_null_src_auth_events_sessionId.5faf81a495: ROLLBACK
[0m10:22:15.933939 [debug] [Thread-1 (]: On test.my_dbt_trino_project.not_null_src_auth_events_sessionId.5faf81a495: Close
[0m10:22:15.934979 [info ] [Thread-1 (]: 4 of 7 PASS not_null_src_auth_events_sessionId ................................. [[32mPASS[0m in 0.18s]
[0m10:22:15.936619 [debug] [Thread-1 (]: Finished running node test.my_dbt_trino_project.not_null_src_auth_events_sessionId.5faf81a495
[0m10:22:15.937140 [debug] [Thread-1 (]: Began running node test.my_dbt_trino_project.not_null_src_auth_events_ts.179fe664b6
[0m10:22:15.937677 [info ] [Thread-1 (]: 5 of 7 START test not_null_src_auth_events_ts .................................. [RUN]
[0m10:22:15.939283 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly test.my_dbt_trino_project.not_null_src_auth_events_sessionId.5faf81a495, now test.my_dbt_trino_project.not_null_src_auth_events_ts.179fe664b6)
[0m10:22:15.939829 [debug] [Thread-1 (]: Began compiling node test.my_dbt_trino_project.not_null_src_auth_events_ts.179fe664b6
[0m10:22:15.946397 [debug] [Thread-1 (]: Writing injected SQL for node "test.my_dbt_trino_project.not_null_src_auth_events_ts.179fe664b6"
[0m10:22:15.946397 [debug] [Thread-1 (]: Began executing node test.my_dbt_trino_project.not_null_src_auth_events_ts.179fe664b6
[0m10:22:15.949921 [debug] [Thread-1 (]: Writing runtime sql for node "test.my_dbt_trino_project.not_null_src_auth_events_ts.179fe664b6"
[0m10:22:15.951430 [debug] [Thread-1 (]: Using trino connection "test.my_dbt_trino_project.not_null_src_auth_events_ts.179fe664b6"
[0m10:22:15.952441 [debug] [Thread-1 (]: On test.my_dbt_trino_project.not_null_src_auth_events_ts.179fe664b6: /* {"app": "dbt", "dbt_version": "1.8.2", "profile_name": "my_dbt_trino_project", "target_name": "dev", "node_id": "test.my_dbt_trino_project.not_null_src_auth_events_ts.179fe664b6"} */
select
      count(*) as failures,
      count(*) != 0 as should_warn,
      count(*) != 0 as should_error
    from (
      
    
    



select ts
from "datalake"."analytics_source"."src_auth_events"
where ts is null



      
    ) dbt_internal_test
[0m10:22:15.952950 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m10:22:16.111567 [debug] [Thread-1 (]: SQL status: SUCCESS in 0.0 seconds
[0m10:22:16.113690 [debug] [Thread-1 (]: On test.my_dbt_trino_project.not_null_src_auth_events_ts.179fe664b6: ROLLBACK
[0m10:22:16.114751 [debug] [Thread-1 (]: On test.my_dbt_trino_project.not_null_src_auth_events_ts.179fe664b6: Close
[0m10:22:16.115287 [info ] [Thread-1 (]: 5 of 7 PASS not_null_src_auth_events_ts ........................................ [[32mPASS[0m in 0.18s]
[0m10:22:16.116872 [debug] [Thread-1 (]: Finished running node test.my_dbt_trino_project.not_null_src_auth_events_ts.179fe664b6
[0m10:22:16.117406 [debug] [Thread-1 (]: Began running node test.my_dbt_trino_project.unique_src_auth_events_sessionId.86c4c7c26f
[0m10:22:16.117928 [info ] [Thread-1 (]: 6 of 7 START test unique_src_auth_events_sessionId ............................. [RUN]
[0m10:22:16.118987 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly test.my_dbt_trino_project.not_null_src_auth_events_ts.179fe664b6, now test.my_dbt_trino_project.unique_src_auth_events_sessionId.86c4c7c26f)
[0m10:22:16.118987 [debug] [Thread-1 (]: Began compiling node test.my_dbt_trino_project.unique_src_auth_events_sessionId.86c4c7c26f
[0m10:22:16.124384 [debug] [Thread-1 (]: Writing injected SQL for node "test.my_dbt_trino_project.unique_src_auth_events_sessionId.86c4c7c26f"
[0m10:22:16.125890 [debug] [Thread-1 (]: Began executing node test.my_dbt_trino_project.unique_src_auth_events_sessionId.86c4c7c26f
[0m10:22:16.130471 [debug] [Thread-1 (]: Writing runtime sql for node "test.my_dbt_trino_project.unique_src_auth_events_sessionId.86c4c7c26f"
[0m10:22:16.132478 [debug] [Thread-1 (]: Using trino connection "test.my_dbt_trino_project.unique_src_auth_events_sessionId.86c4c7c26f"
[0m10:22:16.133488 [debug] [Thread-1 (]: On test.my_dbt_trino_project.unique_src_auth_events_sessionId.86c4c7c26f: /* {"app": "dbt", "dbt_version": "1.8.2", "profile_name": "my_dbt_trino_project", "target_name": "dev", "node_id": "test.my_dbt_trino_project.unique_src_auth_events_sessionId.86c4c7c26f"} */
select
      count(*) as failures,
      count(*) != 0 as should_warn,
      count(*) != 0 as should_error
    from (
      
    
    

select
    sessionId as unique_field,
    count(*) as n_records

from "datalake"."analytics_source"."src_auth_events"
where sessionId is not null
group by sessionId
having count(*) > 1



      
    ) dbt_internal_test
[0m10:22:16.133488 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m10:22:16.331047 [debug] [Thread-1 (]: SQL status: SUCCESS in 0.0 seconds
[0m10:22:16.333161 [debug] [Thread-1 (]: On test.my_dbt_trino_project.unique_src_auth_events_sessionId.86c4c7c26f: ROLLBACK
[0m10:22:16.333161 [debug] [Thread-1 (]: On test.my_dbt_trino_project.unique_src_auth_events_sessionId.86c4c7c26f: Close
[0m10:22:16.334674 [error] [Thread-1 (]: 6 of 7 FAIL 13 unique_src_auth_events_sessionId ................................ [[31mFAIL 13[0m in 0.22s]
[0m10:22:16.335727 [debug] [Thread-1 (]: Finished running node test.my_dbt_trino_project.unique_src_auth_events_sessionId.86c4c7c26f
[0m10:22:16.336782 [debug] [Thread-1 (]: Began running node test.my_dbt_trino_project.unique_src_auth_events_userId.9244f51c84
[0m10:22:16.337303 [info ] [Thread-1 (]: 7 of 7 START test unique_src_auth_events_userId ................................ [RUN]
[0m10:22:16.337822 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly test.my_dbt_trino_project.unique_src_auth_events_sessionId.86c4c7c26f, now test.my_dbt_trino_project.unique_src_auth_events_userId.9244f51c84)
[0m10:22:16.338344 [debug] [Thread-1 (]: Began compiling node test.my_dbt_trino_project.unique_src_auth_events_userId.9244f51c84
[0m10:22:16.341530 [debug] [Thread-1 (]: Writing injected SQL for node "test.my_dbt_trino_project.unique_src_auth_events_userId.9244f51c84"
[0m10:22:16.342949 [debug] [Thread-1 (]: Began executing node test.my_dbt_trino_project.unique_src_auth_events_userId.9244f51c84
[0m10:22:16.345464 [debug] [Thread-1 (]: Writing runtime sql for node "test.my_dbt_trino_project.unique_src_auth_events_userId.9244f51c84"
[0m10:22:16.347548 [debug] [Thread-1 (]: Using trino connection "test.my_dbt_trino_project.unique_src_auth_events_userId.9244f51c84"
[0m10:22:16.347548 [debug] [Thread-1 (]: On test.my_dbt_trino_project.unique_src_auth_events_userId.9244f51c84: /* {"app": "dbt", "dbt_version": "1.8.2", "profile_name": "my_dbt_trino_project", "target_name": "dev", "node_id": "test.my_dbt_trino_project.unique_src_auth_events_userId.9244f51c84"} */
select
      count(*) as failures,
      count(*) != 0 as should_warn,
      count(*) != 0 as should_error
    from (
      
    
    

select
    userId as unique_field,
    count(*) as n_records

from "datalake"."analytics_source"."src_auth_events"
where userId is not null
group by userId
having count(*) > 1



      
    ) dbt_internal_test
[0m10:22:16.348562 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m10:22:16.567258 [debug] [Thread-1 (]: SQL status: SUCCESS in 0.0 seconds
[0m10:22:16.568838 [debug] [Thread-1 (]: On test.my_dbt_trino_project.unique_src_auth_events_userId.9244f51c84: ROLLBACK
[0m10:22:16.569363 [debug] [Thread-1 (]: On test.my_dbt_trino_project.unique_src_auth_events_userId.9244f51c84: Close
[0m10:22:16.570415 [error] [Thread-1 (]: 7 of 7 FAIL 6 unique_src_auth_events_userId .................................... [[31mFAIL 6[0m in 0.23s]
[0m10:22:16.571470 [debug] [Thread-1 (]: Finished running node test.my_dbt_trino_project.unique_src_auth_events_userId.9244f51c84
[0m10:22:16.572508 [debug] [MainThread]: On master: COMMIT
[0m10:22:16.573045 [debug] [MainThread]: Connection 'master' was properly closed.
[0m10:22:16.573576 [debug] [MainThread]: Connection 'list_datalake_analytics_source' was properly closed.
[0m10:22:16.573576 [debug] [MainThread]: Connection 'test.my_dbt_trino_project.unique_src_auth_events_userId.9244f51c84' was properly closed.
[0m10:22:16.574103 [info ] [MainThread]: 
[0m10:22:16.574627 [info ] [MainThread]: Finished running 7 data tests in 0 hours 0 minutes and 5.26 seconds (5.26s).
[0m10:22:16.576203 [debug] [MainThread]: Command end result
[0m10:22:16.659845 [info ] [MainThread]: 
[0m10:22:16.660573 [info ] [MainThread]: [31mCompleted with 4 errors and 0 warnings:[0m
[0m10:22:16.660573 [info ] [MainThread]: 
[0m10:22:16.662013 [error] [MainThread]: [31mFailure in test accepted_values_src_auth_events_gender__F__M (models\source\schema.yml)[0m
[0m10:22:16.662013 [error] [MainThread]:   Got 1 result, configured to fail if != 0
[0m10:22:16.662013 [info ] [MainThread]: 
[0m10:22:16.663358 [info ] [MainThread]:   compiled code at target\compiled\my_dbt_trino_project\models\source\schema.yml\accepted_values_src_auth_events_gender__F__M.sql
[0m10:22:16.663358 [info ] [MainThread]: 
[0m10:22:16.663358 [error] [MainThread]:   Database Error in test accepted_values_src_auth_events_success__True__False (models\source\schema.yml)
  TrinoUserError(type=USER_ERROR, name=COLUMN_NOT_FOUND, message="line 14:9: Column 'success' cannot be resolved", query_id=20240618_022215_00005_z97n2)
  compiled Code at target\run\my_dbt_trino_project\models\source\schema.yml\accepted_values_src_auth_events_success__True__False.sql
[0m10:22:16.664840 [info ] [MainThread]: 
[0m10:22:16.664840 [error] [MainThread]: [31mFailure in test unique_src_auth_events_sessionId (models\source\schema.yml)[0m
[0m10:22:16.666049 [error] [MainThread]:   Got 13 results, configured to fail if != 0
[0m10:22:16.666049 [info ] [MainThread]: 
[0m10:22:16.667054 [info ] [MainThread]:   compiled code at target\compiled\my_dbt_trino_project\models\source\schema.yml\unique_src_auth_events_sessionId.sql
[0m10:22:16.667054 [info ] [MainThread]: 
[0m10:22:16.668055 [error] [MainThread]: [31mFailure in test unique_src_auth_events_userId (models\source\schema.yml)[0m
[0m10:22:16.668055 [error] [MainThread]:   Got 6 results, configured to fail if != 0
[0m10:22:16.669053 [info ] [MainThread]: 
[0m10:22:16.669053 [info ] [MainThread]:   compiled code at target\compiled\my_dbt_trino_project\models\source\schema.yml\unique_src_auth_events_userId.sql
[0m10:22:16.670054 [info ] [MainThread]: 
[0m10:22:16.670054 [info ] [MainThread]: Done. PASS=3 WARN=0 ERROR=4 SKIP=0 TOTAL=7
[0m10:22:16.672569 [debug] [MainThread]: Command `dbt test` failed at 10:22:16.672569 after 6.16 seconds
[0m10:22:16.672569 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000001845BD2E890>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000001845BD2F410>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000001845E148AD0>]}
[0m10:22:16.673570 [debug] [MainThread]: Flushing usage events
[0m10:29:30.745110 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x0000023329CC8A50>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x0000023329CB7FD0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x0000023329CB6F50>]}


============================== 10:29:30.760613 | 45d5dc60-c70f-4d66-9848-7613de854ac6 ==============================
[0m10:29:30.760613 [info ] [MainThread]: Running with dbt=1.8.2
[0m10:29:30.761626 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'indirect_selection': 'eager', 'log_cache_events': 'False', 'write_json': 'True', 'partial_parse': 'True', 'cache_selected_only': 'False', 'profiles_dir': 'C:\\Users\\ASUS\\Desktop\\work\\Iceberg-Dbt-Trino-Hive-modern-open-source-data-stack-main\\dbt', 'version_check': 'True', 'fail_fast': 'False', 'log_path': 'C:\\Users\\ASUS\\Desktop\\work\\Iceberg-Dbt-Trino-Hive-modern-open-source-data-stack-main\\dbt\\logs', 'debug': 'False', 'warn_error': 'None', 'use_colors': 'True', 'use_experimental_parser': 'False', 'no_print': 'None', 'quiet': 'False', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'introspect': 'True', 'log_format': 'default', 'static_parser': 'True', 'target_path': 'None', 'invocation_command': 'dbt run', 'send_anonymous_usage_stats': 'True'}
[0m10:29:31.083851 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': '45d5dc60-c70f-4d66-9848-7613de854ac6', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x0000023329FD5190>]}
[0m10:29:31.126819 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': '45d5dc60-c70f-4d66-9848-7613de854ac6', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x0000023326DF56D0>]}
[0m10:29:31.127822 [info ] [MainThread]: Registered adapter: trino=1.8.0
[0m10:29:31.140451 [debug] [MainThread]: checksum: f0a141b9de567cb7f131613ba2682f40b3a1c6a157f81c6e5435862eff68f109, vars: {}, profile: , target: , version: 1.8.2
[0m10:29:31.302270 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 0 files changed.
[0m10:29:31.302270 [debug] [MainThread]: Partial parsing enabled, no changes found, skipping parsing
[0m10:29:31.331017 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': '45d5dc60-c70f-4d66-9848-7613de854ac6', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000002332A2CAD90>]}
[0m10:29:31.394296 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': '45d5dc60-c70f-4d66-9848-7613de854ac6', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000002332A1C3F50>]}
[0m10:29:31.394296 [info ] [MainThread]: Found 15 models, 7 data tests, 3 sources, 559 macros
[0m10:29:31.394296 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '45d5dc60-c70f-4d66-9848-7613de854ac6', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x0000023329EA90D0>]}
[0m10:29:31.394296 [info ] [MainThread]: 
[0m10:29:31.409951 [debug] [MainThread]: Acquiring new trino connection 'master'
[0m10:29:31.410963 [debug] [ThreadPool]: Acquiring new trino connection 'list_datalake'
[0m10:29:31.474019 [debug] [ThreadPool]: Using trino connection "list_datalake"
[0m10:29:31.474545 [debug] [ThreadPool]: On list_datalake: /* {"app": "dbt", "dbt_version": "1.8.2", "profile_name": "my_dbt_trino_project", "target_name": "dev", "connection_name": "list_datalake"} */

    select schema_name
    from "datalake".INFORMATION_SCHEMA.schemata
[0m10:29:31.475089 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m10:29:31.541598 [debug] [ThreadPool]: SQL status: SUCCESS in 0.0 seconds
[0m10:29:31.543177 [debug] [ThreadPool]: On list_datalake: Close
[0m10:29:31.546469 [debug] [ThreadPool]: Using trino connection "list_datalake"
[0m10:29:31.546469 [debug] [ThreadPool]: On list_datalake: /* {"app": "dbt", "dbt_version": "1.8.2", "profile_name": "my_dbt_trino_project", "target_name": "dev", "connection_name": "list_datalake"} */

    select schema_name
    from "datalake".INFORMATION_SCHEMA.schemata
[0m10:29:31.546469 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m10:29:31.586147 [debug] [ThreadPool]: SQL status: SUCCESS in 0.0 seconds
[0m10:29:31.586979 [debug] [ThreadPool]: On list_datalake: Close
[0m10:29:31.587583 [debug] [ThreadPool]: Using trino connection "list_datalake"
[0m10:29:31.587583 [debug] [ThreadPool]: On list_datalake: /* {"app": "dbt", "dbt_version": "1.8.2", "profile_name": "my_dbt_trino_project", "target_name": "dev", "connection_name": "list_datalake"} */

    select schema_name
    from "datalake".INFORMATION_SCHEMA.schemata
[0m10:29:31.587583 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m10:29:31.628083 [debug] [ThreadPool]: SQL status: SUCCESS in 0.0 seconds
[0m10:29:31.629372 [debug] [ThreadPool]: On list_datalake: Close
[0m10:29:31.629372 [debug] [ThreadPool]: Acquiring new trino connection 'list_datalake_analytics_stage'
[0m10:29:31.641854 [debug] [ThreadPool]: Using trino connection "list_datalake_analytics_stage"
[0m10:29:31.641854 [debug] [ThreadPool]: On list_datalake_analytics_stage: /* {"app": "dbt", "dbt_version": "1.8.2", "profile_name": "my_dbt_trino_project", "target_name": "dev", "connection_name": "list_datalake_analytics_stage"} */
select
      t.table_catalog as database,
      t.table_name as name,
      t.table_schema as schema,
      case when mv.name is not null then 'materialized_view'
           when t.table_type = 'BASE TABLE' then 'table'
           when t.table_type = 'VIEW' then 'view'
           else t.table_type
      end as table_type
    from "datalake".INFORMATION_SCHEMA.tables t
    left join (
            select * from system.metadata.materialized_views
            where catalog_name = 'datalake'
              and schema_name = 'analytics_stage') mv
          on mv.catalog_name = t.table_catalog and mv.schema_name = t.table_schema and mv.name = t.table_name
    where t.table_schema = 'analytics_stage'
[0m10:29:31.641854 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m10:29:31.741897 [debug] [ThreadPool]: SQL status: SUCCESS in 0.0 seconds
[0m10:29:31.742928 [debug] [ThreadPool]: On list_datalake_analytics_stage: ROLLBACK
[0m10:29:31.743456 [debug] [ThreadPool]: On list_datalake_analytics_stage: Close
[0m10:29:31.744021 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_datalake_analytics_stage, now list_datalake_analytics_source)
[0m10:29:31.748355 [debug] [ThreadPool]: Using trino connection "list_datalake_analytics_source"
[0m10:29:31.748355 [debug] [ThreadPool]: On list_datalake_analytics_source: /* {"app": "dbt", "dbt_version": "1.8.2", "profile_name": "my_dbt_trino_project", "target_name": "dev", "connection_name": "list_datalake_analytics_source"} */
select
      t.table_catalog as database,
      t.table_name as name,
      t.table_schema as schema,
      case when mv.name is not null then 'materialized_view'
           when t.table_type = 'BASE TABLE' then 'table'
           when t.table_type = 'VIEW' then 'view'
           else t.table_type
      end as table_type
    from "datalake".INFORMATION_SCHEMA.tables t
    left join (
            select * from system.metadata.materialized_views
            where catalog_name = 'datalake'
              and schema_name = 'analytics_source') mv
          on mv.catalog_name = t.table_catalog and mv.schema_name = t.table_schema and mv.name = t.table_name
    where t.table_schema = 'analytics_source'
[0m10:29:31.748866 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m10:29:31.853164 [debug] [ThreadPool]: SQL status: SUCCESS in 0.0 seconds
[0m10:29:31.854206 [debug] [ThreadPool]: On list_datalake_analytics_source: ROLLBACK
[0m10:29:31.854735 [debug] [ThreadPool]: On list_datalake_analytics_source: Close
[0m10:29:31.855795 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_datalake_analytics_source, now list_datalake_analytics)
[0m10:29:31.860009 [debug] [ThreadPool]: Using trino connection "list_datalake_analytics"
[0m10:29:31.860009 [debug] [ThreadPool]: On list_datalake_analytics: /* {"app": "dbt", "dbt_version": "1.8.2", "profile_name": "my_dbt_trino_project", "target_name": "dev", "connection_name": "list_datalake_analytics"} */
select
      t.table_catalog as database,
      t.table_name as name,
      t.table_schema as schema,
      case when mv.name is not null then 'materialized_view'
           when t.table_type = 'BASE TABLE' then 'table'
           when t.table_type = 'VIEW' then 'view'
           else t.table_type
      end as table_type
    from "datalake".INFORMATION_SCHEMA.tables t
    left join (
            select * from system.metadata.materialized_views
            where catalog_name = 'datalake'
              and schema_name = 'analytics') mv
          on mv.catalog_name = t.table_catalog and mv.schema_name = t.table_schema and mv.name = t.table_name
    where t.table_schema = 'analytics'
[0m10:29:31.860528 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m10:29:31.977353 [debug] [ThreadPool]: SQL status: SUCCESS in 0.0 seconds
[0m10:29:31.978452 [debug] [ThreadPool]: On list_datalake_analytics: ROLLBACK
[0m10:29:31.978981 [debug] [ThreadPool]: On list_datalake_analytics: Close
[0m10:29:31.981104 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '45d5dc60-c70f-4d66-9848-7613de854ac6', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000002332A417790>]}
[0m10:29:31.981637 [debug] [MainThread]: On master: COMMIT
[0m10:29:31.981637 [info ] [MainThread]: Concurrency: 1 threads (target='dev')
[0m10:29:31.982697 [info ] [MainThread]: 
[0m10:29:31.985287 [debug] [Thread-1 (]: Began running node model.my_dbt_trino_project.src_auth_events
[0m10:29:31.985824 [info ] [Thread-1 (]: 1 of 15 START sql incremental model analytics_source.src_auth_events ........... [RUN]
[0m10:29:31.986352 [debug] [Thread-1 (]: Acquiring new trino connection 'model.my_dbt_trino_project.src_auth_events'
[0m10:29:31.986882 [debug] [Thread-1 (]: Began compiling node model.my_dbt_trino_project.src_auth_events
[0m10:29:31.994056 [debug] [Thread-1 (]: Writing injected SQL for node "model.my_dbt_trino_project.src_auth_events"
[0m10:29:31.995306 [debug] [Thread-1 (]: Began executing node model.my_dbt_trino_project.src_auth_events
[0m10:29:32.042279 [debug] [Thread-1 (]: Using trino connection "model.my_dbt_trino_project.src_auth_events"
[0m10:29:32.042784 [debug] [Thread-1 (]: On model.my_dbt_trino_project.src_auth_events: /* {"app": "dbt", "dbt_version": "1.8.2", "profile_name": "my_dbt_trino_project", "target_name": "dev", "node_id": "model.my_dbt_trino_project.src_auth_events"} */

  
    

    create table "datalake"."analytics_source"."src_auth_events__dbt_tmp"
      
      
    as (
      

with source as (
    select
        CAST(ts AS VARCHAR) as id, 
        ts,
        CAST(sessionId AS VARCHAR) as sessionId,
        level,
        itemInSession,
        city,
        zip,
        state,
        userAgent,
        CAST(NULLIF(lon, '') AS double) as lon,
        CAST(NULLIF(lat, '') AS double) as lat,
        CAST(FLOOR(CAST(NULLIF(userId, '') AS DOUBLE)) AS INT) as userId, 
        lastName,
        firstName,
        gender,
        CAST(FLOOR(CAST(NULLIF(registration, '') AS DOUBLE)) AS BIGINT) as registration,
        success
    from "oltp"."public"."auth_events"
)

select
    id,
    ts,
    sessionId,
    level,
    itemInSession,
    city,
    zip,
    state,
    userAgent,
    lon,
    lat,
    userId,
    lastName,
    firstName,
    gender,
    registration, 
    CASE 
        WHEN CAST(success AS VARCHAR) = 't' THEN true 
        WHEN CAST(success AS VARCHAR) = 'f' THEN false
        ELSE NULL 
    END AS success_boolean
from source


    where ts > (select max(ts) from "datalake"."analytics_source"."src_auth_events")

    )
[0m10:29:32.042784 [debug] [Thread-1 (]: Opening a new connection, currently in state init
[0m10:29:34.376138 [debug] [Thread-1 (]: SQL status: SUCCESS in 2.0 seconds
[0m10:29:34.383971 [debug] [Thread-1 (]: Using trino connection "model.my_dbt_trino_project.src_auth_events"
[0m10:29:34.384491 [debug] [Thread-1 (]: On model.my_dbt_trino_project.src_auth_events: /* {"app": "dbt", "dbt_version": "1.8.2", "profile_name": "my_dbt_trino_project", "target_name": "dev", "node_id": "model.my_dbt_trino_project.src_auth_events"} */

    describe "datalake"."analytics_source"."src_auth_events__dbt_tmp"
[0m10:29:34.542224 [debug] [Thread-1 (]: SQL status: SUCCESS in 0.0 seconds
[0m10:29:34.545878 [debug] [Thread-1 (]: Using trino connection "model.my_dbt_trino_project.src_auth_events"
[0m10:29:34.546399 [debug] [Thread-1 (]: On model.my_dbt_trino_project.src_auth_events: /* {"app": "dbt", "dbt_version": "1.8.2", "profile_name": "my_dbt_trino_project", "target_name": "dev", "node_id": "model.my_dbt_trino_project.src_auth_events"} */

    describe "datalake"."analytics_source"."src_auth_events"
[0m10:29:34.671884 [debug] [Thread-1 (]: SQL status: SUCCESS in 0.0 seconds
[0m10:29:34.678669 [debug] [Thread-1 (]: Using trino connection "model.my_dbt_trino_project.src_auth_events"
[0m10:29:34.679218 [debug] [Thread-1 (]: On model.my_dbt_trino_project.src_auth_events: /* {"app": "dbt", "dbt_version": "1.8.2", "profile_name": "my_dbt_trino_project", "target_name": "dev", "node_id": "model.my_dbt_trino_project.src_auth_events"} */

    describe "datalake"."analytics_source"."src_auth_events"
[0m10:29:34.813046 [debug] [Thread-1 (]: SQL status: SUCCESS in 0.0 seconds
[0m10:29:34.821947 [debug] [Thread-1 (]: Writing runtime sql for node "model.my_dbt_trino_project.src_auth_events"
[0m10:29:34.823003 [debug] [Thread-1 (]: Using trino connection "model.my_dbt_trino_project.src_auth_events"
[0m10:29:34.823003 [debug] [Thread-1 (]: On model.my_dbt_trino_project.src_auth_events: /* {"app": "dbt", "dbt_version": "1.8.2", "profile_name": "my_dbt_trino_project", "target_name": "dev", "node_id": "model.my_dbt_trino_project.src_auth_events"} */
insert into "datalake"."analytics_source"."src_auth_events" ("id", "ts", "sessionid", "level", "iteminsession", "city", "zip", "state", "useragent", "lon", "lat", "userid", "lastname", "firstname", "gender", "registration", "success_boolean")
    (
        select "id", "ts", "sessionid", "level", "iteminsession", "city", "zip", "state", "useragent", "lon", "lat", "userid", "lastname", "firstname", "gender", "registration", "success_boolean"
        from "datalake"."analytics_source"."src_auth_events__dbt_tmp"
    )
[0m10:29:35.030561 [debug] [Thread-1 (]: SQL status: SUCCESS in 0.0 seconds
[0m10:29:35.036314 [debug] [Thread-1 (]: Applying DROP to: "datalake"."analytics_source"."src_auth_events__dbt_tmp"
[0m10:29:35.038395 [debug] [Thread-1 (]: Using trino connection "model.my_dbt_trino_project.src_auth_events"
[0m10:29:35.038929 [debug] [Thread-1 (]: On model.my_dbt_trino_project.src_auth_events: /* {"app": "dbt", "dbt_version": "1.8.2", "profile_name": "my_dbt_trino_project", "target_name": "dev", "node_id": "model.my_dbt_trino_project.src_auth_events"} */

    drop table if exists "datalake"."analytics_source"."src_auth_events__dbt_tmp"
[0m10:29:35.275390 [debug] [Thread-1 (]: SQL status: SUCCESS in 0.0 seconds
[0m10:29:35.286249 [debug] [Thread-1 (]: On model.my_dbt_trino_project.src_auth_events: ROLLBACK
[0m10:29:35.286249 [debug] [Thread-1 (]: On model.my_dbt_trino_project.src_auth_events: Close
[0m10:29:35.286249 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '45d5dc60-c70f-4d66-9848-7613de854ac6', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000002332AAF0B90>]}
[0m10:29:35.288088 [info ] [Thread-1 (]: 1 of 15 OK created sql incremental model analytics_source.src_auth_events ...... [[32mSUCCESS[0m in 3.30s]
[0m10:29:35.288088 [debug] [Thread-1 (]: Finished running node model.my_dbt_trino_project.src_auth_events
[0m10:29:35.288088 [debug] [Thread-1 (]: Began running node model.my_dbt_trino_project.src_listen_events
[0m10:29:35.288088 [info ] [Thread-1 (]: 2 of 15 START sql incremental model analytics_source.src_listen_events ......... [RUN]
[0m10:29:35.288088 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.my_dbt_trino_project.src_auth_events, now model.my_dbt_trino_project.src_listen_events)
[0m10:29:35.288088 [debug] [Thread-1 (]: Began compiling node model.my_dbt_trino_project.src_listen_events
[0m10:29:35.288088 [debug] [Thread-1 (]: Writing injected SQL for node "model.my_dbt_trino_project.src_listen_events"
[0m10:29:35.288088 [debug] [Thread-1 (]: Began executing node model.my_dbt_trino_project.src_listen_events
[0m10:29:35.300594 [debug] [Thread-1 (]: Using trino connection "model.my_dbt_trino_project.src_listen_events"
[0m10:29:35.300594 [debug] [Thread-1 (]: On model.my_dbt_trino_project.src_listen_events: /* {"app": "dbt", "dbt_version": "1.8.2", "profile_name": "my_dbt_trino_project", "target_name": "dev", "node_id": "model.my_dbt_trino_project.src_listen_events"} */

  
    

    create table "datalake"."analytics_source"."src_listen_events__dbt_tmp"
      
      
    as (
      

with source as (

    select
        CAST(_id AS VARCHAR) as id,
        artist,
        song,
        CAST(NULLIF(duration, '') AS DOUBLE) as duration,
        ts,
        sessionid,
        auth,
        level,
        CAST(NULLIF(itemInSession, '') AS INTEGER) as itemInSession,
        city,
        zip,
        state,
        country,
        userAgent,
        CAST(NULLIF(lon, '') AS DOUBLE) as lon,
        CAST(NULLIF(lat, '') AS DOUBLE) as lat,
        CAST(CAST(NULLIF(userId, '') AS DOUBLE) AS INTEGER) as userId,
 -- Assurez-vous que userId peut aussi être converti de cette manière.
        lastName,
        firstName,
        gender,
        CAST(CAST(NULLIF(registration, '') AS DOUBLE) AS BIGINT) as registration
    from "website"."demo"."listen_events"

)

select * from source



    -- this filter will only be applied on an incremental run
    where ts > (select max(ts) from "datalake"."analytics_source"."src_listen_events")


    )
[0m10:29:35.301409 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m10:29:35.721787 [debug] [Thread-1 (]: SQL status: SUCCESS in 0.0 seconds
[0m10:29:35.724405 [debug] [Thread-1 (]: Using trino connection "model.my_dbt_trino_project.src_listen_events"
[0m10:29:35.724918 [debug] [Thread-1 (]: On model.my_dbt_trino_project.src_listen_events: /* {"app": "dbt", "dbt_version": "1.8.2", "profile_name": "my_dbt_trino_project", "target_name": "dev", "node_id": "model.my_dbt_trino_project.src_listen_events"} */

    describe "datalake"."analytics_source"."src_listen_events__dbt_tmp"
[0m10:29:35.846091 [debug] [Thread-1 (]: SQL status: SUCCESS in 0.0 seconds
[0m10:29:35.850242 [debug] [Thread-1 (]: Using trino connection "model.my_dbt_trino_project.src_listen_events"
[0m10:29:35.850759 [debug] [Thread-1 (]: On model.my_dbt_trino_project.src_listen_events: /* {"app": "dbt", "dbt_version": "1.8.2", "profile_name": "my_dbt_trino_project", "target_name": "dev", "node_id": "model.my_dbt_trino_project.src_listen_events"} */

    describe "datalake"."analytics_source"."src_listen_events"
[0m10:29:35.990121 [debug] [Thread-1 (]: SQL status: SUCCESS in 0.0 seconds
[0m10:29:35.993207 [debug] [Thread-1 (]: Using trino connection "model.my_dbt_trino_project.src_listen_events"
[0m10:29:35.993722 [debug] [Thread-1 (]: On model.my_dbt_trino_project.src_listen_events: /* {"app": "dbt", "dbt_version": "1.8.2", "profile_name": "my_dbt_trino_project", "target_name": "dev", "node_id": "model.my_dbt_trino_project.src_listen_events"} */

    describe "datalake"."analytics_source"."src_listen_events"
[0m10:29:36.116444 [debug] [Thread-1 (]: SQL status: SUCCESS in 0.0 seconds
[0m10:29:36.119062 [debug] [Thread-1 (]: Writing runtime sql for node "model.my_dbt_trino_project.src_listen_events"
[0m10:29:36.121502 [debug] [Thread-1 (]: Using trino connection "model.my_dbt_trino_project.src_listen_events"
[0m10:29:36.122026 [debug] [Thread-1 (]: On model.my_dbt_trino_project.src_listen_events: /* {"app": "dbt", "dbt_version": "1.8.2", "profile_name": "my_dbt_trino_project", "target_name": "dev", "node_id": "model.my_dbt_trino_project.src_listen_events"} */
insert into "datalake"."analytics_source"."src_listen_events" ("id", "artist", "song", "duration", "ts", "sessionid", "auth", "level", "iteminsession", "city", "zip", "state", "country", "useragent", "lon", "lat", "userid", "lastname", "firstname", "gender", "registration")
    (
        select "id", "artist", "song", "duration", "ts", "sessionid", "auth", "level", "iteminsession", "city", "zip", "state", "country", "useragent", "lon", "lat", "userid", "lastname", "firstname", "gender", "registration"
        from "datalake"."analytics_source"."src_listen_events__dbt_tmp"
    )
[0m10:29:36.315560 [debug] [Thread-1 (]: SQL status: SUCCESS in 0.0 seconds
[0m10:29:36.318707 [debug] [Thread-1 (]: Applying DROP to: "datalake"."analytics_source"."src_listen_events__dbt_tmp"
[0m10:29:36.319232 [debug] [Thread-1 (]: Using trino connection "model.my_dbt_trino_project.src_listen_events"
[0m10:29:36.319751 [debug] [Thread-1 (]: On model.my_dbt_trino_project.src_listen_events: /* {"app": "dbt", "dbt_version": "1.8.2", "profile_name": "my_dbt_trino_project", "target_name": "dev", "node_id": "model.my_dbt_trino_project.src_listen_events"} */

    drop table if exists "datalake"."analytics_source"."src_listen_events__dbt_tmp"
[0m10:29:36.469120 [debug] [Thread-1 (]: SQL status: SUCCESS in 0.0 seconds
[0m10:29:36.470692 [debug] [Thread-1 (]: On model.my_dbt_trino_project.src_listen_events: ROLLBACK
[0m10:29:36.471211 [debug] [Thread-1 (]: On model.my_dbt_trino_project.src_listen_events: Close
[0m10:29:36.471730 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '45d5dc60-c70f-4d66-9848-7613de854ac6', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x0000023329C9B710>]}
[0m10:29:36.472249 [info ] [Thread-1 (]: 2 of 15 OK created sql incremental model analytics_source.src_listen_events .... [[32mSUCCESS[0m in 1.18s]
[0m10:29:36.473287 [debug] [Thread-1 (]: Finished running node model.my_dbt_trino_project.src_listen_events
[0m10:29:36.473803 [debug] [Thread-1 (]: Began running node model.my_dbt_trino_project.src_page_view_events
[0m10:29:36.474320 [info ] [Thread-1 (]: 3 of 15 START sql incremental model analytics_source.src_page_view_events ...... [RUN]
[0m10:29:36.474836 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.my_dbt_trino_project.src_listen_events, now model.my_dbt_trino_project.src_page_view_events)
[0m10:29:36.475352 [debug] [Thread-1 (]: Began compiling node model.my_dbt_trino_project.src_page_view_events
[0m10:29:36.478453 [debug] [Thread-1 (]: Writing injected SQL for node "model.my_dbt_trino_project.src_page_view_events"
[0m10:29:36.478968 [debug] [Thread-1 (]: Began executing node model.my_dbt_trino_project.src_page_view_events
[0m10:29:36.487737 [debug] [Thread-1 (]: Using trino connection "model.my_dbt_trino_project.src_page_view_events"
[0m10:29:36.488792 [debug] [Thread-1 (]: On model.my_dbt_trino_project.src_page_view_events: /* {"app": "dbt", "dbt_version": "1.8.2", "profile_name": "my_dbt_trino_project", "target_name": "dev", "node_id": "model.my_dbt_trino_project.src_page_view_events"} */

  
    

    create table "datalake"."analytics_source"."src_page_view_events__dbt_tmp"
      
      
    as (
      

with source as (
    select
        CAST(_id AS VARCHAR) as id,
        ts,
        CAST(sessionId AS VARCHAR) as sessionId,
        page,
        auth,
        level,
        CAST(CAST(NULLIF(itemInSession, '') AS DOUBLE) AS INTEGER) as itemInSession, 
        city,
        zip,
        state,
        userAgent,
        CAST(NULLIF(lon, '') AS double) as lon,
        CAST(NULLIF(lat, '') AS double) as lat,
        CAST(CAST(NULLIF(userId, '') AS DOUBLE) AS INTEGER) as userId, 
        lastName,
        firstName,
        gender,
        CAST(CAST(NULLIF(registration, '') AS DOUBLE) AS BIGINT) as registration, 
        artist,
        song,
        CAST(NULLIF(duration, '') AS double) as duration
    from "website"."demo"."page_view_events"
)

select * from source


    where ts > (select max(ts) from "datalake"."analytics_source"."src_page_view_events")

    )
[0m10:29:36.489322 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m10:29:36.768295 [debug] [Thread-1 (]: SQL status: SUCCESS in 0.0 seconds
[0m10:29:36.772585 [debug] [Thread-1 (]: Using trino connection "model.my_dbt_trino_project.src_page_view_events"
[0m10:29:36.772585 [debug] [Thread-1 (]: On model.my_dbt_trino_project.src_page_view_events: /* {"app": "dbt", "dbt_version": "1.8.2", "profile_name": "my_dbt_trino_project", "target_name": "dev", "node_id": "model.my_dbt_trino_project.src_page_view_events"} */

    describe "datalake"."analytics_source"."src_page_view_events__dbt_tmp"
[0m10:29:36.898420 [debug] [Thread-1 (]: SQL status: SUCCESS in 0.0 seconds
[0m10:29:36.939866 [debug] [Thread-1 (]: Using trino connection "model.my_dbt_trino_project.src_page_view_events"
[0m10:29:36.939866 [debug] [Thread-1 (]: On model.my_dbt_trino_project.src_page_view_events: /* {"app": "dbt", "dbt_version": "1.8.2", "profile_name": "my_dbt_trino_project", "target_name": "dev", "node_id": "model.my_dbt_trino_project.src_page_view_events"} */

    describe "datalake"."analytics_source"."src_page_view_events"
[0m10:29:37.067011 [debug] [Thread-1 (]: SQL status: SUCCESS in 0.0 seconds
[0m10:29:37.070347 [debug] [Thread-1 (]: Using trino connection "model.my_dbt_trino_project.src_page_view_events"
[0m10:29:37.070868 [debug] [Thread-1 (]: On model.my_dbt_trino_project.src_page_view_events: /* {"app": "dbt", "dbt_version": "1.8.2", "profile_name": "my_dbt_trino_project", "target_name": "dev", "node_id": "model.my_dbt_trino_project.src_page_view_events"} */

    describe "datalake"."analytics_source"."src_page_view_events"
[0m10:29:37.189863 [debug] [Thread-1 (]: SQL status: SUCCESS in 0.0 seconds
[0m10:29:37.192230 [debug] [Thread-1 (]: Writing runtime sql for node "model.my_dbt_trino_project.src_page_view_events"
[0m10:29:37.194350 [debug] [Thread-1 (]: Using trino connection "model.my_dbt_trino_project.src_page_view_events"
[0m10:29:37.194865 [debug] [Thread-1 (]: On model.my_dbt_trino_project.src_page_view_events: /* {"app": "dbt", "dbt_version": "1.8.2", "profile_name": "my_dbt_trino_project", "target_name": "dev", "node_id": "model.my_dbt_trino_project.src_page_view_events"} */
insert into "datalake"."analytics_source"."src_page_view_events" ("id", "ts", "sessionid", "page", "auth", "level", "iteminsession", "city", "zip", "state", "useragent", "lon", "lat", "userid", "lastname", "firstname", "gender", "registration", "artist", "song", "duration")
    (
        select "id", "ts", "sessionid", "page", "auth", "level", "iteminsession", "city", "zip", "state", "useragent", "lon", "lat", "userid", "lastname", "firstname", "gender", "registration", "artist", "song", "duration"
        from "datalake"."analytics_source"."src_page_view_events__dbt_tmp"
    )
[0m10:29:37.352495 [debug] [Thread-1 (]: SQL status: SUCCESS in 0.0 seconds
[0m10:29:37.355085 [debug] [Thread-1 (]: Applying DROP to: "datalake"."analytics_source"."src_page_view_events__dbt_tmp"
[0m10:29:37.356125 [debug] [Thread-1 (]: Using trino connection "model.my_dbt_trino_project.src_page_view_events"
[0m10:29:37.356125 [debug] [Thread-1 (]: On model.my_dbt_trino_project.src_page_view_events: /* {"app": "dbt", "dbt_version": "1.8.2", "profile_name": "my_dbt_trino_project", "target_name": "dev", "node_id": "model.my_dbt_trino_project.src_page_view_events"} */

    drop table if exists "datalake"."analytics_source"."src_page_view_events__dbt_tmp"
[0m10:29:37.491456 [debug] [Thread-1 (]: SQL status: SUCCESS in 0.0 seconds
[0m10:29:37.493000 [debug] [Thread-1 (]: On model.my_dbt_trino_project.src_page_view_events: ROLLBACK
[0m10:29:37.493516 [debug] [Thread-1 (]: On model.my_dbt_trino_project.src_page_view_events: Close
[0m10:29:37.494056 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '45d5dc60-c70f-4d66-9848-7613de854ac6', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000002332AB2F150>]}
[0m10:29:37.494567 [info ] [Thread-1 (]: 3 of 15 OK created sql incremental model analytics_source.src_page_view_events . [[32mSUCCESS[0m in 1.02s]
[0m10:29:37.495095 [debug] [Thread-1 (]: Finished running node model.my_dbt_trino_project.src_page_view_events
[0m10:29:37.495608 [debug] [Thread-1 (]: Began running node model.my_dbt_trino_project.stg_user_level_by_gender
[0m10:29:37.496133 [info ] [Thread-1 (]: 4 of 15 START sql view model analytics_stage.stg_user_level_by_gender .......... [RUN]
[0m10:29:37.496650 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.my_dbt_trino_project.src_page_view_events, now model.my_dbt_trino_project.stg_user_level_by_gender)
[0m10:29:37.497172 [debug] [Thread-1 (]: Began compiling node model.my_dbt_trino_project.stg_user_level_by_gender
[0m10:29:37.499243 [debug] [Thread-1 (]: Writing injected SQL for node "model.my_dbt_trino_project.stg_user_level_by_gender"
[0m10:29:37.499243 [debug] [Thread-1 (]: Began executing node model.my_dbt_trino_project.stg_user_level_by_gender
[0m10:29:37.502157 [debug] [Thread-1 (]: Writing runtime sql for node "model.my_dbt_trino_project.stg_user_level_by_gender"
[0m10:29:37.513497 [debug] [Thread-1 (]: Using trino connection "model.my_dbt_trino_project.stg_user_level_by_gender"
[0m10:29:37.514001 [debug] [Thread-1 (]: On model.my_dbt_trino_project.stg_user_level_by_gender: /* {"app": "dbt", "dbt_version": "1.8.2", "profile_name": "my_dbt_trino_project", "target_name": "dev", "node_id": "model.my_dbt_trino_project.stg_user_level_by_gender"} */

  create or replace view
    "datalake"."analytics_stage"."stg_user_level_by_gender"
  security definer
  as
    

WITH user_subscriptions AS (
    SELECT
        gender,
        level, 
        COUNT(DISTINCT userId) AS user_count
    FROM "datalake"."analytics_source"."src_auth_events"
    WHERE gender IS NOT NULL AND level IS NOT NULL
    GROUP BY gender, level
)

SELECT
    gender,
    level,
    user_count
FROM user_subscriptions
  
[0m10:29:37.514001 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m10:29:37.679035 [debug] [Thread-1 (]: SQL status: SUCCESS in 0.0 seconds
[0m10:29:37.682828 [debug] [Thread-1 (]: On model.my_dbt_trino_project.stg_user_level_by_gender: ROLLBACK
[0m10:29:37.682992 [debug] [Thread-1 (]: On model.my_dbt_trino_project.stg_user_level_by_gender: Close
[0m10:29:37.683534 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '45d5dc60-c70f-4d66-9848-7613de854ac6', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000002332999F190>]}
[0m10:29:37.684565 [info ] [Thread-1 (]: 4 of 15 OK created sql view model analytics_stage.stg_user_level_by_gender ..... [[32mSUCCESS[0m in 0.19s]
[0m10:29:37.685089 [debug] [Thread-1 (]: Finished running node model.my_dbt_trino_project.stg_user_level_by_gender
[0m10:29:37.685602 [debug] [Thread-1 (]: Began running node model.my_dbt_trino_project.stg_streams_hourly
[0m10:29:37.686118 [info ] [Thread-1 (]: 5 of 15 START sql table model analytics_stage.stg_streams_hourly ............... [RUN]
[0m10:29:37.686643 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.my_dbt_trino_project.stg_user_level_by_gender, now model.my_dbt_trino_project.stg_streams_hourly)
[0m10:29:37.686643 [debug] [Thread-1 (]: Began compiling node model.my_dbt_trino_project.stg_streams_hourly
[0m10:29:37.689069 [debug] [Thread-1 (]: Writing injected SQL for node "model.my_dbt_trino_project.stg_streams_hourly"
[0m10:29:37.689069 [debug] [Thread-1 (]: Began executing node model.my_dbt_trino_project.stg_streams_hourly
[0m10:29:37.701812 [debug] [Thread-1 (]: Writing runtime sql for node "model.my_dbt_trino_project.stg_streams_hourly"
[0m10:29:37.703982 [debug] [Thread-1 (]: Using trino connection "model.my_dbt_trino_project.stg_streams_hourly"
[0m10:29:37.703982 [debug] [Thread-1 (]: On model.my_dbt_trino_project.stg_streams_hourly: /* {"app": "dbt", "dbt_version": "1.8.2", "profile_name": "my_dbt_trino_project", "target_name": "dev", "node_id": "model.my_dbt_trino_project.stg_streams_hourly"} */

  
    

    create table "datalake"."analytics_stage"."stg_streams_hourly__dbt_tmp"
      
      
    as (
      

SELECT
    DATE_FORMAT(FROM_UNIXTIME(ts), '%Y-%m-%d') AS stream_date, 
    DATE_FORMAT(FROM_UNIXTIME(ts), '%H') AS stream_hour,
    COUNT(*) AS total_streams
FROM "datalake"."analytics_source"."src_listen_events"
GROUP BY
    DATE_FORMAT(FROM_UNIXTIME(ts), '%Y-%m-%d'),
    DATE_FORMAT(FROM_UNIXTIME(ts), '%H')
    )
[0m10:29:37.703982 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m10:29:38.493118 [debug] [Thread-1 (]: SQL status: SUCCESS in 1.0 seconds
[0m10:29:38.499931 [debug] [Thread-1 (]: Using trino connection "model.my_dbt_trino_project.stg_streams_hourly"
[0m10:29:38.500450 [debug] [Thread-1 (]: On model.my_dbt_trino_project.stg_streams_hourly: /* {"app": "dbt", "dbt_version": "1.8.2", "profile_name": "my_dbt_trino_project", "target_name": "dev", "node_id": "model.my_dbt_trino_project.stg_streams_hourly"} */
alter table "datalake"."analytics_stage"."stg_streams_hourly" rename to "datalake"."analytics_stage"."stg_streams_hourly__dbt_backup"
[0m10:29:38.638809 [debug] [Thread-1 (]: SQL status: SUCCESS in 0.0 seconds
[0m10:29:38.643527 [debug] [Thread-1 (]: Using trino connection "model.my_dbt_trino_project.stg_streams_hourly"
[0m10:29:38.644564 [debug] [Thread-1 (]: On model.my_dbt_trino_project.stg_streams_hourly: /* {"app": "dbt", "dbt_version": "1.8.2", "profile_name": "my_dbt_trino_project", "target_name": "dev", "node_id": "model.my_dbt_trino_project.stg_streams_hourly"} */
alter table "datalake"."analytics_stage"."stg_streams_hourly__dbt_tmp" rename to "datalake"."analytics_stage"."stg_streams_hourly"
[0m10:29:38.705872 [debug] [Thread-1 (]: SQL status: SUCCESS in 0.0 seconds
[0m10:29:38.708981 [debug] [Thread-1 (]: Applying DROP to: "datalake"."analytics_stage"."stg_streams_hourly__dbt_backup"
[0m10:29:38.709499 [debug] [Thread-1 (]: Using trino connection "model.my_dbt_trino_project.stg_streams_hourly"
[0m10:29:38.710013 [debug] [Thread-1 (]: On model.my_dbt_trino_project.stg_streams_hourly: /* {"app": "dbt", "dbt_version": "1.8.2", "profile_name": "my_dbt_trino_project", "target_name": "dev", "node_id": "model.my_dbt_trino_project.stg_streams_hourly"} */

    drop table if exists "datalake"."analytics_stage"."stg_streams_hourly__dbt_backup"
[0m10:29:38.890807 [debug] [Thread-1 (]: SQL status: SUCCESS in 0.0 seconds
[0m10:29:38.894626 [debug] [Thread-1 (]: On model.my_dbt_trino_project.stg_streams_hourly: ROLLBACK
[0m10:29:38.895212 [debug] [Thread-1 (]: On model.my_dbt_trino_project.stg_streams_hourly: Close
[0m10:29:38.896241 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '45d5dc60-c70f-4d66-9848-7613de854ac6', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x0000023329C9BF90>]}
[0m10:29:38.897518 [info ] [Thread-1 (]: 5 of 15 OK created sql table model analytics_stage.stg_streams_hourly .......... [[32mSUCCESS[0m in 1.21s]
[0m10:29:38.898962 [debug] [Thread-1 (]: Finished running node model.my_dbt_trino_project.stg_streams_hourly
[0m10:29:38.898962 [debug] [Thread-1 (]: Began running node model.my_dbt_trino_project.stg_top_songs_artists
[0m10:29:38.901469 [info ] [Thread-1 (]: 6 of 15 START sql view model analytics_stage.stg_top_songs_artists ............. [RUN]
[0m10:29:38.902951 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.my_dbt_trino_project.stg_streams_hourly, now model.my_dbt_trino_project.stg_top_songs_artists)
[0m10:29:38.903723 [debug] [Thread-1 (]: Began compiling node model.my_dbt_trino_project.stg_top_songs_artists
[0m10:29:38.906990 [debug] [Thread-1 (]: Writing injected SQL for node "model.my_dbt_trino_project.stg_top_songs_artists"
[0m10:29:38.910054 [debug] [Thread-1 (]: Began executing node model.my_dbt_trino_project.stg_top_songs_artists
[0m10:29:38.915952 [debug] [Thread-1 (]: Writing runtime sql for node "model.my_dbt_trino_project.stg_top_songs_artists"
[0m10:29:38.918423 [debug] [Thread-1 (]: Using trino connection "model.my_dbt_trino_project.stg_top_songs_artists"
[0m10:29:38.919906 [debug] [Thread-1 (]: On model.my_dbt_trino_project.stg_top_songs_artists: /* {"app": "dbt", "dbt_version": "1.8.2", "profile_name": "my_dbt_trino_project", "target_name": "dev", "node_id": "model.my_dbt_trino_project.stg_top_songs_artists"} */

  create or replace view
    "datalake"."analytics_stage"."stg_top_songs_artists"
  security definer
  as
    

WITH song_plays AS (
    SELECT
        artist,
        song,
        COUNT(*) AS play_count
    FROM "datalake"."analytics_source"."src_listen_events"
    GROUP BY artist, song
)

SELECT
    artist,
    song,
    play_count
FROM song_plays
ORDER BY play_count DESC
  
[0m10:29:38.920438 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m10:29:39.043242 [debug] [Thread-1 (]: SQL status: SUCCESS in 0.0 seconds
[0m10:29:39.046350 [debug] [Thread-1 (]: On model.my_dbt_trino_project.stg_top_songs_artists: ROLLBACK
[0m10:29:39.046880 [debug] [Thread-1 (]: On model.my_dbt_trino_project.stg_top_songs_artists: Close
[0m10:29:39.047943 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '45d5dc60-c70f-4d66-9848-7613de854ac6', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000002332A6E51D0>]}
[0m10:29:39.048783 [info ] [Thread-1 (]: 6 of 15 OK created sql view model analytics_stage.stg_top_songs_artists ........ [[32mSUCCESS[0m in 0.15s]
[0m10:29:39.049861 [debug] [Thread-1 (]: Finished running node model.my_dbt_trino_project.stg_top_songs_artists
[0m10:29:39.050394 [debug] [Thread-1 (]: Began running node model.my_dbt_trino_project.stg_unique_users
[0m10:29:39.051459 [info ] [Thread-1 (]: 7 of 15 START sql view model analytics_stage.stg_unique_users .................. [RUN]
[0m10:29:39.052613 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.my_dbt_trino_project.stg_top_songs_artists, now model.my_dbt_trino_project.stg_unique_users)
[0m10:29:39.053134 [debug] [Thread-1 (]: Began compiling node model.my_dbt_trino_project.stg_unique_users
[0m10:29:39.057681 [debug] [Thread-1 (]: Writing injected SQL for node "model.my_dbt_trino_project.stg_unique_users"
[0m10:29:39.058680 [debug] [Thread-1 (]: Began executing node model.my_dbt_trino_project.stg_unique_users
[0m10:29:39.062100 [debug] [Thread-1 (]: Writing runtime sql for node "model.my_dbt_trino_project.stg_unique_users"
[0m10:29:39.064735 [debug] [Thread-1 (]: Using trino connection "model.my_dbt_trino_project.stg_unique_users"
[0m10:29:39.065262 [debug] [Thread-1 (]: On model.my_dbt_trino_project.stg_unique_users: /* {"app": "dbt", "dbt_version": "1.8.2", "profile_name": "my_dbt_trino_project", "target_name": "dev", "node_id": "model.my_dbt_trino_project.stg_unique_users"} */

  create or replace view
    "datalake"."analytics_stage"."stg_unique_users"
  security definer
  as
    

SELECT
    COUNT(DISTINCT userid) AS total_unique_users
FROM "datalake"."analytics_source"."src_listen_events"
WHERE userid IS NOT NULL
  
[0m10:29:39.065783 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m10:29:39.166029 [debug] [Thread-1 (]: SQL status: SUCCESS in 0.0 seconds
[0m10:29:39.168118 [debug] [Thread-1 (]: On model.my_dbt_trino_project.stg_unique_users: ROLLBACK
[0m10:29:39.168642 [debug] [Thread-1 (]: On model.my_dbt_trino_project.stg_unique_users: Close
[0m10:29:39.169172 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '45d5dc60-c70f-4d66-9848-7613de854ac6', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000002332BBE43D0>]}
[0m10:29:39.170151 [info ] [Thread-1 (]: 7 of 15 OK created sql view model analytics_stage.stg_unique_users ............. [[32mSUCCESS[0m in 0.12s]
[0m10:29:39.170939 [debug] [Thread-1 (]: Finished running node model.my_dbt_trino_project.stg_unique_users
[0m10:29:39.171984 [debug] [Thread-1 (]: Began running node model.my_dbt_trino_project.stg_user_activity_per_country
[0m10:29:39.172507 [info ] [Thread-1 (]: 8 of 15 START sql view model analytics_stage.stg_user_activity_per_country ..... [RUN]
[0m10:29:39.173557 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.my_dbt_trino_project.stg_unique_users, now model.my_dbt_trino_project.stg_user_activity_per_country)
[0m10:29:39.173557 [debug] [Thread-1 (]: Began compiling node model.my_dbt_trino_project.stg_user_activity_per_country
[0m10:29:39.176874 [debug] [Thread-1 (]: Writing injected SQL for node "model.my_dbt_trino_project.stg_user_activity_per_country"
[0m10:29:39.177922 [debug] [Thread-1 (]: Began executing node model.my_dbt_trino_project.stg_user_activity_per_country
[0m10:29:39.180577 [debug] [Thread-1 (]: Writing runtime sql for node "model.my_dbt_trino_project.stg_user_activity_per_country"
[0m10:29:39.183071 [debug] [Thread-1 (]: Using trino connection "model.my_dbt_trino_project.stg_user_activity_per_country"
[0m10:29:39.183071 [debug] [Thread-1 (]: On model.my_dbt_trino_project.stg_user_activity_per_country: /* {"app": "dbt", "dbt_version": "1.8.2", "profile_name": "my_dbt_trino_project", "target_name": "dev", "node_id": "model.my_dbt_trino_project.stg_user_activity_per_country"} */

  create or replace view
    "datalake"."analytics_stage"."stg_user_activity_per_country"
  security definer
  as
    

WITH combined_activities AS (
  SELECT
    country,
    'listen_event' AS event_type,
    ts,
    userid
  FROM "datalake"."analytics_source"."src_listen_events"
  WHERE country IS NOT NULL
  UNION ALL
  SELECT
    'Unknown' AS country, 
    ts,
    userid
  FROM "datalake"."analytics_source"."src_auth_events"
  UNION ALL
  SELECT
    'Unknown' AS country, 
    'page_view_event' AS event_type,
    ts,
    userid
  FROM "datalake"."analytics_source"."src_page_view_events"
)

SELECT
  country,
  COUNT(*) AS activity_count
FROM combined_activities
GROUP BY country
  
[0m10:29:39.183071 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m10:29:39.253556 [debug] [Thread-1 (]: Trino adapter: Trino query id: 20240618_022939_00041_z97n2
[0m10:29:39.254781 [debug] [Thread-1 (]: Trino adapter: Trino error: TrinoUserError(type=USER_ERROR, name=TYPE_MISMATCH, message="line 17:3: UNION query has different number of fields: 4, 3", query_id=20240618_022939_00041_z97n2)
[0m10:29:39.255369 [debug] [Thread-1 (]: On model.my_dbt_trino_project.stg_user_activity_per_country: ROLLBACK
[0m10:29:39.255369 [debug] [Thread-1 (]: On model.my_dbt_trino_project.stg_user_activity_per_country: Close
[0m10:29:39.255369 [debug] [Thread-1 (]: Database Error in model stg_user_activity_per_country (models\stage\stg_user_activity_per_country.sql)
  TrinoUserError(type=USER_ERROR, name=TYPE_MISMATCH, message="line 17:3: UNION query has different number of fields: 4, 3", query_id=20240618_022939_00041_z97n2)
  compiled Code at target\run\my_dbt_trino_project\models\stage\stg_user_activity_per_country.sql
[0m10:29:39.262544 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '45d5dc60-c70f-4d66-9848-7613de854ac6', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000002332AB686D0>]}
[0m10:29:39.262544 [error] [Thread-1 (]: 8 of 15 ERROR creating sql view model analytics_stage.stg_user_activity_per_country  [[31mERROR[0m in 0.09s]
[0m10:29:39.263558 [debug] [Thread-1 (]: Finished running node model.my_dbt_trino_project.stg_user_activity_per_country
[0m10:29:39.263558 [debug] [Thread-1 (]: Began running node model.my_dbt_trino_project.stg_user_activity_per_location
[0m10:29:39.263558 [info ] [Thread-1 (]: 9 of 15 START sql view model analytics_stage.stg_user_activity_per_location .... [RUN]
[0m10:29:39.263558 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.my_dbt_trino_project.stg_user_activity_per_country, now model.my_dbt_trino_project.stg_user_activity_per_location)
[0m10:29:39.263558 [debug] [Thread-1 (]: Began compiling node model.my_dbt_trino_project.stg_user_activity_per_location
[0m10:29:39.267604 [debug] [Thread-1 (]: Writing injected SQL for node "model.my_dbt_trino_project.stg_user_activity_per_location"
[0m10:29:39.271308 [debug] [Thread-1 (]: Began executing node model.my_dbt_trino_project.stg_user_activity_per_location
[0m10:29:39.273621 [debug] [Thread-1 (]: Writing runtime sql for node "model.my_dbt_trino_project.stg_user_activity_per_location"
[0m10:29:39.274369 [debug] [Thread-1 (]: Using trino connection "model.my_dbt_trino_project.stg_user_activity_per_location"
[0m10:29:39.274369 [debug] [Thread-1 (]: On model.my_dbt_trino_project.stg_user_activity_per_location: /* {"app": "dbt", "dbt_version": "1.8.2", "profile_name": "my_dbt_trino_project", "target_name": "dev", "node_id": "model.my_dbt_trino_project.stg_user_activity_per_location"} */

  create or replace view
    "datalake"."analytics_stage"."stg_user_activity_per_location"
  security definer
  as
    

WITH combined_activities AS (
  SELECT
    city,
    state,
    'auth_event' AS event_type,
    ts,
    userid
 FROM "datalake"."analytics_source"."src_auth_events"
  UNION ALL
  SELECT
    city,
    state,
    'listen_event' AS event_type,
    ts,
    userid
  FROM "datalake"."analytics_source"."src_listen_events"
  UNION ALL
  SELECT
    city,
    state,
    'page_view_event' AS event_type,
    ts,
    userid
  FROM "datalake"."analytics_source"."src_page_view_events"
)

SELECT
  state,
  city,
  COUNT(*) AS activity_count
FROM combined_activities
GROUP BY state, city
  
[0m10:29:39.274369 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m10:29:39.402460 [debug] [Thread-1 (]: SQL status: SUCCESS in 0.0 seconds
[0m10:29:39.404587 [debug] [Thread-1 (]: On model.my_dbt_trino_project.stg_user_activity_per_location: ROLLBACK
[0m10:29:39.405111 [debug] [Thread-1 (]: On model.my_dbt_trino_project.stg_user_activity_per_location: Close
[0m10:29:39.405646 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '45d5dc60-c70f-4d66-9848-7613de854ac6', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000002332AB72C90>]}
[0m10:29:39.406381 [info ] [Thread-1 (]: 9 of 15 OK created sql view model analytics_stage.stg_user_activity_per_location  [[32mSUCCESS[0m in 0.14s]
[0m10:29:39.407406 [debug] [Thread-1 (]: Finished running node model.my_dbt_trino_project.stg_user_activity_per_location
[0m10:29:39.407406 [debug] [Thread-1 (]: Began running node model.my_dbt_trino_project.mart_user_level_by_gender
[0m10:29:39.408468 [info ] [Thread-1 (]: 10 of 15 START sql table model analytics.mart_user_level_by_gender ............. [RUN]
[0m10:29:39.409066 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.my_dbt_trino_project.stg_user_activity_per_location, now model.my_dbt_trino_project.mart_user_level_by_gender)
[0m10:29:39.409066 [debug] [Thread-1 (]: Began compiling node model.my_dbt_trino_project.mart_user_level_by_gender
[0m10:29:39.412218 [debug] [Thread-1 (]: Writing injected SQL for node "model.my_dbt_trino_project.mart_user_level_by_gender"
[0m10:29:39.413399 [debug] [Thread-1 (]: Began executing node model.my_dbt_trino_project.mart_user_level_by_gender
[0m10:29:39.417578 [debug] [Thread-1 (]: Writing runtime sql for node "model.my_dbt_trino_project.mart_user_level_by_gender"
[0m10:29:39.419893 [debug] [Thread-1 (]: Using trino connection "model.my_dbt_trino_project.mart_user_level_by_gender"
[0m10:29:39.420432 [debug] [Thread-1 (]: On model.my_dbt_trino_project.mart_user_level_by_gender: /* {"app": "dbt", "dbt_version": "1.8.2", "profile_name": "my_dbt_trino_project", "target_name": "dev", "node_id": "model.my_dbt_trino_project.mart_user_level_by_gender"} */

  
    

    create table "datalake"."analytics"."mart_user_level_by_gender__dbt_tmp"
      
      
    as (
      

SELECT
    gender,
    level,
    SUM(user_count) AS total_users,
    ROUND(SUM(user_count) * 100.0 / SUM(SUM(user_count)) OVER (), 2) AS percentage_of_total_users
FROM "datalake"."analytics_stage"."stg_user_level_by_gender"
GROUP BY gender, level
    )
[0m10:29:39.421039 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m10:29:39.992503 [debug] [Thread-1 (]: SQL status: SUCCESS in 1.0 seconds
[0m10:29:39.993023 [debug] [Thread-1 (]: Using trino connection "model.my_dbt_trino_project.mart_user_level_by_gender"
[0m10:29:39.993023 [debug] [Thread-1 (]: On model.my_dbt_trino_project.mart_user_level_by_gender: /* {"app": "dbt", "dbt_version": "1.8.2", "profile_name": "my_dbt_trino_project", "target_name": "dev", "node_id": "model.my_dbt_trino_project.mart_user_level_by_gender"} */
alter table "datalake"."analytics"."mart_user_level_by_gender" rename to "datalake"."analytics"."mart_user_level_by_gender__dbt_backup"
[0m10:29:40.109427 [debug] [Thread-1 (]: SQL status: SUCCESS in 0.0 seconds
[0m10:29:40.113081 [debug] [Thread-1 (]: Using trino connection "model.my_dbt_trino_project.mart_user_level_by_gender"
[0m10:29:40.113629 [debug] [Thread-1 (]: On model.my_dbt_trino_project.mart_user_level_by_gender: /* {"app": "dbt", "dbt_version": "1.8.2", "profile_name": "my_dbt_trino_project", "target_name": "dev", "node_id": "model.my_dbt_trino_project.mart_user_level_by_gender"} */
alter table "datalake"."analytics"."mart_user_level_by_gender__dbt_tmp" rename to "datalake"."analytics"."mart_user_level_by_gender"
[0m10:29:40.172424 [debug] [Thread-1 (]: SQL status: SUCCESS in 0.0 seconds
[0m10:29:40.175062 [debug] [Thread-1 (]: Applying DROP to: "datalake"."analytics"."mart_user_level_by_gender__dbt_backup"
[0m10:29:40.176103 [debug] [Thread-1 (]: Using trino connection "model.my_dbt_trino_project.mart_user_level_by_gender"
[0m10:29:40.176619 [debug] [Thread-1 (]: On model.my_dbt_trino_project.mart_user_level_by_gender: /* {"app": "dbt", "dbt_version": "1.8.2", "profile_name": "my_dbt_trino_project", "target_name": "dev", "node_id": "model.my_dbt_trino_project.mart_user_level_by_gender"} */

    drop table if exists "datalake"."analytics"."mart_user_level_by_gender__dbt_backup"
[0m10:29:40.284563 [debug] [Thread-1 (]: SQL status: SUCCESS in 0.0 seconds
[0m10:29:40.286126 [debug] [Thread-1 (]: On model.my_dbt_trino_project.mart_user_level_by_gender: ROLLBACK
[0m10:29:40.286643 [debug] [Thread-1 (]: On model.my_dbt_trino_project.mart_user_level_by_gender: Close
[0m10:29:40.287283 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '45d5dc60-c70f-4d66-9848-7613de854ac6', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000002332AB2E810>]}
[0m10:29:40.288314 [info ] [Thread-1 (]: 10 of 15 OK created sql table model analytics.mart_user_level_by_gender ........ [[32mSUCCESS[0m in 0.88s]
[0m10:29:40.288928 [debug] [Thread-1 (]: Finished running node model.my_dbt_trino_project.mart_user_level_by_gender
[0m10:29:40.289434 [debug] [Thread-1 (]: Began running node model.my_dbt_trino_project.mart_hourly_stream_evolution
[0m10:29:40.289956 [info ] [Thread-1 (]: 11 of 15 START sql table model analytics.mart_hourly_stream_evolution .......... [RUN]
[0m10:29:40.290480 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.my_dbt_trino_project.mart_user_level_by_gender, now model.my_dbt_trino_project.mart_hourly_stream_evolution)
[0m10:29:40.290480 [debug] [Thread-1 (]: Began compiling node model.my_dbt_trino_project.mart_hourly_stream_evolution
[0m10:29:40.293592 [debug] [Thread-1 (]: Writing injected SQL for node "model.my_dbt_trino_project.mart_hourly_stream_evolution"
[0m10:29:40.294630 [debug] [Thread-1 (]: Began executing node model.my_dbt_trino_project.mart_hourly_stream_evolution
[0m10:29:40.298922 [debug] [Thread-1 (]: Writing runtime sql for node "model.my_dbt_trino_project.mart_hourly_stream_evolution"
[0m10:29:40.300189 [debug] [Thread-1 (]: Using trino connection "model.my_dbt_trino_project.mart_hourly_stream_evolution"
[0m10:29:40.301210 [debug] [Thread-1 (]: On model.my_dbt_trino_project.mart_hourly_stream_evolution: /* {"app": "dbt", "dbt_version": "1.8.2", "profile_name": "my_dbt_trino_project", "target_name": "dev", "node_id": "model.my_dbt_trino_project.mart_hourly_stream_evolution"} */

  
    

    create table "datalake"."analytics"."mart_hourly_stream_evolution__dbt_tmp"
      
      
    as (
      

SELECT
    stream_date,
    stream_hour,
    total_streams,
    SUM(total_streams) OVER (PARTITION BY stream_date ORDER BY stream_hour) AS cumulative_streams
FROM "datalake"."analytics_stage"."stg_streams_hourly"
ORDER BY
    stream_date,
    stream_hour
    )
[0m10:29:40.301210 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m10:29:40.651830 [debug] [Thread-1 (]: SQL status: SUCCESS in 0.0 seconds
[0m10:29:40.654939 [debug] [Thread-1 (]: Using trino connection "model.my_dbt_trino_project.mart_hourly_stream_evolution"
[0m10:29:40.654939 [debug] [Thread-1 (]: On model.my_dbt_trino_project.mart_hourly_stream_evolution: /* {"app": "dbt", "dbt_version": "1.8.2", "profile_name": "my_dbt_trino_project", "target_name": "dev", "node_id": "model.my_dbt_trino_project.mart_hourly_stream_evolution"} */
alter table "datalake"."analytics"."mart_hourly_stream_evolution" rename to "datalake"."analytics"."mart_hourly_stream_evolution__dbt_backup"
[0m10:29:40.764566 [debug] [Thread-1 (]: SQL status: SUCCESS in 0.0 seconds
[0m10:29:40.768258 [debug] [Thread-1 (]: Using trino connection "model.my_dbt_trino_project.mart_hourly_stream_evolution"
[0m10:29:40.768793 [debug] [Thread-1 (]: On model.my_dbt_trino_project.mart_hourly_stream_evolution: /* {"app": "dbt", "dbt_version": "1.8.2", "profile_name": "my_dbt_trino_project", "target_name": "dev", "node_id": "model.my_dbt_trino_project.mart_hourly_stream_evolution"} */
alter table "datalake"."analytics"."mart_hourly_stream_evolution__dbt_tmp" rename to "datalake"."analytics"."mart_hourly_stream_evolution"
[0m10:29:40.832144 [debug] [Thread-1 (]: SQL status: SUCCESS in 0.0 seconds
[0m10:29:40.835850 [debug] [Thread-1 (]: Applying DROP to: "datalake"."analytics"."mart_hourly_stream_evolution__dbt_backup"
[0m10:29:40.836915 [debug] [Thread-1 (]: Using trino connection "model.my_dbt_trino_project.mart_hourly_stream_evolution"
[0m10:29:40.837441 [debug] [Thread-1 (]: On model.my_dbt_trino_project.mart_hourly_stream_evolution: /* {"app": "dbt", "dbt_version": "1.8.2", "profile_name": "my_dbt_trino_project", "target_name": "dev", "node_id": "model.my_dbt_trino_project.mart_hourly_stream_evolution"} */

    drop table if exists "datalake"."analytics"."mart_hourly_stream_evolution__dbt_backup"
[0m10:29:40.950576 [debug] [Thread-1 (]: SQL status: SUCCESS in 0.0 seconds
[0m10:29:40.952166 [debug] [Thread-1 (]: On model.my_dbt_trino_project.mart_hourly_stream_evolution: ROLLBACK
[0m10:29:40.952697 [debug] [Thread-1 (]: On model.my_dbt_trino_project.mart_hourly_stream_evolution: Close
[0m10:29:40.953229 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '45d5dc60-c70f-4d66-9848-7613de854ac6', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x0000023329960B10>]}
[0m10:29:40.953750 [info ] [Thread-1 (]: 11 of 15 OK created sql table model analytics.mart_hourly_stream_evolution ..... [[32mSUCCESS[0m in 0.66s]
[0m10:29:40.954820 [debug] [Thread-1 (]: Finished running node model.my_dbt_trino_project.mart_hourly_stream_evolution
[0m10:29:40.955343 [debug] [Thread-1 (]: Began running node model.my_dbt_trino_project.mart_top_songs_artists
[0m10:29:40.955872 [info ] [Thread-1 (]: 12 of 15 START sql table model analytics.mart_top_songs_artists ................ [RUN]
[0m10:29:40.956453 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.my_dbt_trino_project.mart_hourly_stream_evolution, now model.my_dbt_trino_project.mart_top_songs_artists)
[0m10:29:40.956956 [debug] [Thread-1 (]: Began compiling node model.my_dbt_trino_project.mart_top_songs_artists
[0m10:29:40.960098 [debug] [Thread-1 (]: Writing injected SQL for node "model.my_dbt_trino_project.mart_top_songs_artists"
[0m10:29:40.960617 [debug] [Thread-1 (]: Began executing node model.my_dbt_trino_project.mart_top_songs_artists
[0m10:29:40.961136 [debug] [Thread-1 (]: Writing runtime sql for node "model.my_dbt_trino_project.mart_top_songs_artists"
[0m10:29:40.961136 [debug] [Thread-1 (]: Using trino connection "model.my_dbt_trino_project.mart_top_songs_artists"
[0m10:29:40.961136 [debug] [Thread-1 (]: On model.my_dbt_trino_project.mart_top_songs_artists: /* {"app": "dbt", "dbt_version": "1.8.2", "profile_name": "my_dbt_trino_project", "target_name": "dev", "node_id": "model.my_dbt_trino_project.mart_top_songs_artists"} */

  
    

    create table "datalake"."analytics"."mart_top_songs_artists__dbt_tmp"
      
      
    as (
      

WITH top_songs AS (
    SELECT
        artist,
        song,
        play_count
    FROM "datalake"."analytics_stage"."stg_top_songs_artists"
)

SELECT
    artist,
    song,
    play_count
FROM top_songs
    )
[0m10:29:40.961136 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m10:29:41.337791 [debug] [Thread-1 (]: SQL status: SUCCESS in 0.0 seconds
[0m10:29:41.341434 [debug] [Thread-1 (]: Using trino connection "model.my_dbt_trino_project.mart_top_songs_artists"
[0m10:29:41.341958 [debug] [Thread-1 (]: On model.my_dbt_trino_project.mart_top_songs_artists: /* {"app": "dbt", "dbt_version": "1.8.2", "profile_name": "my_dbt_trino_project", "target_name": "dev", "node_id": "model.my_dbt_trino_project.mart_top_songs_artists"} */
alter table "datalake"."analytics"."mart_top_songs_artists" rename to "datalake"."analytics"."mart_top_songs_artists__dbt_backup"
[0m10:29:41.452260 [debug] [Thread-1 (]: SQL status: SUCCESS in 0.0 seconds
[0m10:29:41.455373 [debug] [Thread-1 (]: Using trino connection "model.my_dbt_trino_project.mart_top_songs_artists"
[0m10:29:41.455890 [debug] [Thread-1 (]: On model.my_dbt_trino_project.mart_top_songs_artists: /* {"app": "dbt", "dbt_version": "1.8.2", "profile_name": "my_dbt_trino_project", "target_name": "dev", "node_id": "model.my_dbt_trino_project.mart_top_songs_artists"} */
alter table "datalake"."analytics"."mart_top_songs_artists__dbt_tmp" rename to "datalake"."analytics"."mart_top_songs_artists"
[0m10:29:41.565695 [debug] [Thread-1 (]: SQL status: SUCCESS in 0.0 seconds
[0m10:29:41.568848 [debug] [Thread-1 (]: Applying DROP to: "datalake"."analytics"."mart_top_songs_artists__dbt_backup"
[0m10:29:41.569374 [debug] [Thread-1 (]: Using trino connection "model.my_dbt_trino_project.mart_top_songs_artists"
[0m10:29:41.569896 [debug] [Thread-1 (]: On model.my_dbt_trino_project.mart_top_songs_artists: /* {"app": "dbt", "dbt_version": "1.8.2", "profile_name": "my_dbt_trino_project", "target_name": "dev", "node_id": "model.my_dbt_trino_project.mart_top_songs_artists"} */

    drop table if exists "datalake"."analytics"."mart_top_songs_artists__dbt_backup"
[0m10:29:41.724209 [debug] [Thread-1 (]: SQL status: SUCCESS in 0.0 seconds
[0m10:29:41.725794 [debug] [Thread-1 (]: On model.my_dbt_trino_project.mart_top_songs_artists: ROLLBACK
[0m10:29:41.726325 [debug] [Thread-1 (]: On model.my_dbt_trino_project.mart_top_songs_artists: Close
[0m10:29:41.726860 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '45d5dc60-c70f-4d66-9848-7613de854ac6', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000002332A1DE3D0>]}
[0m10:29:41.727902 [info ] [Thread-1 (]: 12 of 15 OK created sql table model analytics.mart_top_songs_artists ........... [[32mSUCCESS[0m in 0.77s]
[0m10:29:41.728530 [debug] [Thread-1 (]: Finished running node model.my_dbt_trino_project.mart_top_songs_artists
[0m10:29:41.729053 [debug] [Thread-1 (]: Began running node model.my_dbt_trino_project.mart_total_unique_users
[0m10:29:41.729575 [info ] [Thread-1 (]: 13 of 15 START sql table model analytics.mart_total_unique_users ............... [RUN]
[0m10:29:41.730104 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.my_dbt_trino_project.mart_top_songs_artists, now model.my_dbt_trino_project.mart_total_unique_users)
[0m10:29:41.730625 [debug] [Thread-1 (]: Began compiling node model.my_dbt_trino_project.mart_total_unique_users
[0m10:29:41.733299 [debug] [Thread-1 (]: Writing injected SQL for node "model.my_dbt_trino_project.mart_total_unique_users"
[0m10:29:41.734031 [debug] [Thread-1 (]: Began executing node model.my_dbt_trino_project.mart_total_unique_users
[0m10:29:41.735554 [debug] [Thread-1 (]: Writing runtime sql for node "model.my_dbt_trino_project.mart_total_unique_users"
[0m10:29:41.735554 [debug] [Thread-1 (]: Using trino connection "model.my_dbt_trino_project.mart_total_unique_users"
[0m10:29:41.735554 [debug] [Thread-1 (]: On model.my_dbt_trino_project.mart_total_unique_users: /* {"app": "dbt", "dbt_version": "1.8.2", "profile_name": "my_dbt_trino_project", "target_name": "dev", "node_id": "model.my_dbt_trino_project.mart_total_unique_users"} */

  
    

    create table "datalake"."analytics"."mart_total_unique_users__dbt_tmp"
      
      
    as (
      

SELECT
    total_unique_users
FROM "datalake"."analytics_stage"."stg_unique_users"
    )
[0m10:29:41.735554 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m10:29:42.067700 [debug] [Thread-1 (]: SQL status: SUCCESS in 0.0 seconds
[0m10:29:42.070874 [debug] [Thread-1 (]: Using trino connection "model.my_dbt_trino_project.mart_total_unique_users"
[0m10:29:42.071388 [debug] [Thread-1 (]: On model.my_dbt_trino_project.mart_total_unique_users: /* {"app": "dbt", "dbt_version": "1.8.2", "profile_name": "my_dbt_trino_project", "target_name": "dev", "node_id": "model.my_dbt_trino_project.mart_total_unique_users"} */
alter table "datalake"."analytics"."mart_total_unique_users" rename to "datalake"."analytics"."mart_total_unique_users__dbt_backup"
[0m10:29:42.180179 [debug] [Thread-1 (]: SQL status: SUCCESS in 0.0 seconds
[0m10:29:42.183301 [debug] [Thread-1 (]: Using trino connection "model.my_dbt_trino_project.mart_total_unique_users"
[0m10:29:42.183820 [debug] [Thread-1 (]: On model.my_dbt_trino_project.mart_total_unique_users: /* {"app": "dbt", "dbt_version": "1.8.2", "profile_name": "my_dbt_trino_project", "target_name": "dev", "node_id": "model.my_dbt_trino_project.mart_total_unique_users"} */
alter table "datalake"."analytics"."mart_total_unique_users__dbt_tmp" rename to "datalake"."analytics"."mart_total_unique_users"
[0m10:29:42.294095 [debug] [Thread-1 (]: SQL status: SUCCESS in 0.0 seconds
[0m10:29:42.298860 [debug] [Thread-1 (]: Applying DROP to: "datalake"."analytics"."mart_total_unique_users__dbt_backup"
[0m10:29:42.298860 [debug] [Thread-1 (]: Using trino connection "model.my_dbt_trino_project.mart_total_unique_users"
[0m10:29:42.298860 [debug] [Thread-1 (]: On model.my_dbt_trino_project.mart_total_unique_users: /* {"app": "dbt", "dbt_version": "1.8.2", "profile_name": "my_dbt_trino_project", "target_name": "dev", "node_id": "model.my_dbt_trino_project.mart_total_unique_users"} */

    drop table if exists "datalake"."analytics"."mart_total_unique_users__dbt_backup"
[0m10:29:42.447616 [debug] [Thread-1 (]: SQL status: SUCCESS in 0.0 seconds
[0m10:29:42.449217 [debug] [Thread-1 (]: On model.my_dbt_trino_project.mart_total_unique_users: ROLLBACK
[0m10:29:42.449755 [debug] [Thread-1 (]: On model.my_dbt_trino_project.mart_total_unique_users: Close
[0m10:29:42.450819 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '45d5dc60-c70f-4d66-9848-7613de854ac6', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x0000023329685ED0>]}
[0m10:29:42.451345 [info ] [Thread-1 (]: 13 of 15 OK created sql table model analytics.mart_total_unique_users .......... [[32mSUCCESS[0m in 0.72s]
[0m10:29:42.451873 [debug] [Thread-1 (]: Finished running node model.my_dbt_trino_project.mart_total_unique_users
[0m10:29:42.452404 [debug] [Thread-1 (]: Began running node model.my_dbt_trino_project.mart_user_activity_per_country
[0m10:29:42.452929 [info ] [Thread-1 (]: 14 of 15 SKIP relation analytics.mart_user_activity_per_country ................ [[33mSKIP[0m]
[0m10:29:42.453449 [debug] [Thread-1 (]: Finished running node model.my_dbt_trino_project.mart_user_activity_per_country
[0m10:29:42.453971 [debug] [Thread-1 (]: Began running node model.my_dbt_trino_project.mart_user_activity_per_state
[0m10:29:42.454490 [info ] [Thread-1 (]: 15 of 15 START sql table model analytics.mart_user_activity_per_state .......... [RUN]
[0m10:29:42.455010 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.my_dbt_trino_project.mart_total_unique_users, now model.my_dbt_trino_project.mart_user_activity_per_state)
[0m10:29:42.455537 [debug] [Thread-1 (]: Began compiling node model.my_dbt_trino_project.mart_user_activity_per_state
[0m10:29:42.458187 [debug] [Thread-1 (]: Writing injected SQL for node "model.my_dbt_trino_project.mart_user_activity_per_state"
[0m10:29:42.459199 [debug] [Thread-1 (]: Began executing node model.my_dbt_trino_project.mart_user_activity_per_state
[0m10:29:42.461601 [debug] [Thread-1 (]: Writing runtime sql for node "model.my_dbt_trino_project.mart_user_activity_per_state"
[0m10:29:42.462646 [debug] [Thread-1 (]: Using trino connection "model.my_dbt_trino_project.mart_user_activity_per_state"
[0m10:29:42.463647 [debug] [Thread-1 (]: On model.my_dbt_trino_project.mart_user_activity_per_state: /* {"app": "dbt", "dbt_version": "1.8.2", "profile_name": "my_dbt_trino_project", "target_name": "dev", "node_id": "model.my_dbt_trino_project.mart_user_activity_per_state"} */

  
    

    create table "datalake"."analytics"."mart_user_activity_per_state__dbt_tmp"
      
      
    as (
      

SELECT
  state,
  city,
  SUM(activity_count) AS total_activity
FROM "datalake"."analytics_stage"."stg_user_activity_per_location"
GROUP BY state, city
ORDER BY state, SUM(activity_count) DESC
    )
[0m10:29:42.463647 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m10:29:42.838628 [debug] [Thread-1 (]: SQL status: SUCCESS in 0.0 seconds
[0m10:29:42.841810 [debug] [Thread-1 (]: Using trino connection "model.my_dbt_trino_project.mart_user_activity_per_state"
[0m10:29:42.841863 [debug] [Thread-1 (]: On model.my_dbt_trino_project.mart_user_activity_per_state: /* {"app": "dbt", "dbt_version": "1.8.2", "profile_name": "my_dbt_trino_project", "target_name": "dev", "node_id": "model.my_dbt_trino_project.mart_user_activity_per_state"} */
alter table "datalake"."analytics"."mart_user_activity_per_state" rename to "datalake"."analytics"."mart_user_activity_per_state__dbt_backup"
[0m10:29:42.941703 [debug] [Thread-1 (]: SQL status: SUCCESS in 0.0 seconds
[0m10:29:42.944851 [debug] [Thread-1 (]: Using trino connection "model.my_dbt_trino_project.mart_user_activity_per_state"
[0m10:29:42.945371 [debug] [Thread-1 (]: On model.my_dbt_trino_project.mart_user_activity_per_state: /* {"app": "dbt", "dbt_version": "1.8.2", "profile_name": "my_dbt_trino_project", "target_name": "dev", "node_id": "model.my_dbt_trino_project.mart_user_activity_per_state"} */
alter table "datalake"."analytics"."mart_user_activity_per_state__dbt_tmp" rename to "datalake"."analytics"."mart_user_activity_per_state"
[0m10:29:43.036210 [debug] [Thread-1 (]: SQL status: SUCCESS in 0.0 seconds
[0m10:29:43.039451 [debug] [Thread-1 (]: Applying DROP to: "datalake"."analytics"."mart_user_activity_per_state__dbt_backup"
[0m10:29:43.039972 [debug] [Thread-1 (]: Using trino connection "model.my_dbt_trino_project.mart_user_activity_per_state"
[0m10:29:43.040522 [debug] [Thread-1 (]: On model.my_dbt_trino_project.mart_user_activity_per_state: /* {"app": "dbt", "dbt_version": "1.8.2", "profile_name": "my_dbt_trino_project", "target_name": "dev", "node_id": "model.my_dbt_trino_project.mart_user_activity_per_state"} */

    drop table if exists "datalake"."analytics"."mart_user_activity_per_state__dbt_backup"
[0m10:29:43.181378 [debug] [Thread-1 (]: SQL status: SUCCESS in 0.0 seconds
[0m10:29:43.182955 [debug] [Thread-1 (]: On model.my_dbt_trino_project.mart_user_activity_per_state: ROLLBACK
[0m10:29:43.183481 [debug] [Thread-1 (]: On model.my_dbt_trino_project.mart_user_activity_per_state: Close
[0m10:29:43.183586 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '45d5dc60-c70f-4d66-9848-7613de854ac6', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000002332AB3D0D0>]}
[0m10:29:43.184154 [info ] [Thread-1 (]: 15 of 15 OK created sql table model analytics.mart_user_activity_per_state ..... [[32mSUCCESS[0m in 0.73s]
[0m10:29:43.185189 [debug] [Thread-1 (]: Finished running node model.my_dbt_trino_project.mart_user_activity_per_state
[0m10:29:43.186235 [debug] [MainThread]: On master: COMMIT
[0m10:29:43.186235 [debug] [MainThread]: Connection 'master' was properly closed.
[0m10:29:43.186753 [debug] [MainThread]: Connection 'list_datalake' was properly closed.
[0m10:29:43.186753 [debug] [MainThread]: Connection 'list_datalake_analytics' was properly closed.
[0m10:29:43.187272 [debug] [MainThread]: Connection 'model.my_dbt_trino_project.mart_user_activity_per_state' was properly closed.
[0m10:29:43.187793 [info ] [MainThread]: 
[0m10:29:43.187793 [info ] [MainThread]: Finished running 3 incremental models, 5 view models, 7 table models in 0 hours 0 minutes and 11.78 seconds (11.78s).
[0m10:29:43.189884 [debug] [MainThread]: Command end result
[0m10:29:43.220030 [info ] [MainThread]: 
[0m10:29:43.221046 [info ] [MainThread]: [31mCompleted with 1 error and 0 warnings:[0m
[0m10:29:43.221768 [info ] [MainThread]: 
[0m10:29:43.221768 [error] [MainThread]:   Database Error in model stg_user_activity_per_country (models\stage\stg_user_activity_per_country.sql)
  TrinoUserError(type=USER_ERROR, name=TYPE_MISMATCH, message="line 17:3: UNION query has different number of fields: 4, 3", query_id=20240618_022939_00041_z97n2)
  compiled Code at target\run\my_dbt_trino_project\models\stage\stg_user_activity_per_country.sql
[0m10:29:43.221768 [info ] [MainThread]: 
[0m10:29:43.221768 [info ] [MainThread]: Done. PASS=13 WARN=0 ERROR=1 SKIP=1 TOTAL=15
[0m10:29:43.224453 [debug] [MainThread]: Command `dbt run` failed at 10:29:43.224453 after 12.60 seconds
[0m10:29:43.224453 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x00000233285A5B10>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000002332A1C2750>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000002332A1C3450>]}
[0m10:29:43.224453 [debug] [MainThread]: Flushing usage events
[0m10:47:37.851855 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x0000023B97626E90>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x0000023B97626010>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x0000023B97626B10>]}


============================== 10:47:37.853910 | 9917e066-0124-4d9a-8d3b-208b35f8ebc5 ==============================
[0m10:47:37.853910 [info ] [MainThread]: Running with dbt=1.8.2
[0m10:47:37.854916 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'indirect_selection': 'eager', 'write_json': 'True', 'log_cache_events': 'False', 'partial_parse': 'True', 'cache_selected_only': 'False', 'warn_error': 'None', 'fail_fast': 'False', 'profiles_dir': 'C:\\Users\\ASUS\\Desktop\\work\\Iceberg-Dbt-Trino-Hive-modern-open-source-data-stack-main\\dbt', 'log_path': 'C:\\Users\\ASUS\\Desktop\\work\\Iceberg-Dbt-Trino-Hive-modern-open-source-data-stack-main\\dbt\\logs', 'debug': 'False', 'version_check': 'True', 'use_colors': 'True', 'use_experimental_parser': 'False', 'no_print': 'None', 'quiet': 'False', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'invocation_command': 'dbt test', 'log_format': 'default', 'static_parser': 'True', 'target_path': 'None', 'introspect': 'True', 'send_anonymous_usage_stats': 'True'}
[0m10:47:38.169003 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': '9917e066-0124-4d9a-8d3b-208b35f8ebc5', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x0000023B97654250>]}
[0m10:47:38.221697 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': '9917e066-0124-4d9a-8d3b-208b35f8ebc5', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x0000023B947956D0>]}
[0m10:47:38.221697 [info ] [MainThread]: Registered adapter: trino=1.8.0
[0m10:47:38.242978 [debug] [MainThread]: checksum: f0a141b9de567cb7f131613ba2682f40b3a1c6a157f81c6e5435862eff68f109, vars: {}, profile: , target: , version: 1.8.2
[0m10:47:38.405293 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 0 files changed.
[0m10:47:38.406293 [debug] [MainThread]: Partial parsing enabled, no changes found, skipping parsing
[0m10:47:38.449854 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': '9917e066-0124-4d9a-8d3b-208b35f8ebc5', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x0000023B97CCDAD0>]}
[0m10:47:38.549370 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': '9917e066-0124-4d9a-8d3b-208b35f8ebc5', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x0000023B97B0CF10>]}
[0m10:47:38.550370 [info ] [MainThread]: Found 15 models, 7 data tests, 3 sources, 559 macros
[0m10:47:38.550370 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '9917e066-0124-4d9a-8d3b-208b35f8ebc5', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x0000023B97AD28D0>]}
[0m10:47:38.552368 [info ] [MainThread]: 
[0m10:47:38.553371 [debug] [MainThread]: Acquiring new trino connection 'master'
[0m10:47:38.557369 [debug] [ThreadPool]: Acquiring new trino connection 'list_datalake_analytics_source'
[0m10:47:38.620920 [debug] [ThreadPool]: Using trino connection "list_datalake_analytics_source"
[0m10:47:38.620920 [debug] [ThreadPool]: On list_datalake_analytics_source: /* {"app": "dbt", "dbt_version": "1.8.2", "profile_name": "my_dbt_trino_project", "target_name": "dev", "connection_name": "list_datalake_analytics_source"} */
select
      t.table_catalog as database,
      t.table_name as name,
      t.table_schema as schema,
      case when mv.name is not null then 'materialized_view'
           when t.table_type = 'BASE TABLE' then 'table'
           when t.table_type = 'VIEW' then 'view'
           else t.table_type
      end as table_type
    from "datalake".INFORMATION_SCHEMA.tables t
    left join (
            select * from system.metadata.materialized_views
            where catalog_name = 'datalake'
              and schema_name = 'analytics_source') mv
          on mv.catalog_name = t.table_catalog and mv.schema_name = t.table_schema and mv.name = t.table_name
    where t.table_schema = 'analytics_source'
[0m10:47:38.620920 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m10:47:38.748812 [debug] [ThreadPool]: SQL status: SUCCESS in 0.0 seconds
[0m10:47:38.750393 [debug] [ThreadPool]: On list_datalake_analytics_source: ROLLBACK
[0m10:47:38.750393 [debug] [ThreadPool]: On list_datalake_analytics_source: Close
[0m10:47:38.751453 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_datalake_analytics_source, now list_datalake_analytics)
[0m10:47:38.755738 [debug] [ThreadPool]: Using trino connection "list_datalake_analytics"
[0m10:47:38.756262 [debug] [ThreadPool]: On list_datalake_analytics: /* {"app": "dbt", "dbt_version": "1.8.2", "profile_name": "my_dbt_trino_project", "target_name": "dev", "connection_name": "list_datalake_analytics"} */
select
      t.table_catalog as database,
      t.table_name as name,
      t.table_schema as schema,
      case when mv.name is not null then 'materialized_view'
           when t.table_type = 'BASE TABLE' then 'table'
           when t.table_type = 'VIEW' then 'view'
           else t.table_type
      end as table_type
    from "datalake".INFORMATION_SCHEMA.tables t
    left join (
            select * from system.metadata.materialized_views
            where catalog_name = 'datalake'
              and schema_name = 'analytics') mv
          on mv.catalog_name = t.table_catalog and mv.schema_name = t.table_schema and mv.name = t.table_name
    where t.table_schema = 'analytics'
[0m10:47:38.756262 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m10:47:38.863907 [debug] [ThreadPool]: SQL status: SUCCESS in 0.0 seconds
[0m10:47:38.865544 [debug] [ThreadPool]: On list_datalake_analytics: ROLLBACK
[0m10:47:38.866075 [debug] [ThreadPool]: On list_datalake_analytics: Close
[0m10:47:38.867141 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_datalake_analytics, now list_datalake_analytics_stage)
[0m10:47:38.872952 [debug] [ThreadPool]: Using trino connection "list_datalake_analytics_stage"
[0m10:47:38.873639 [debug] [ThreadPool]: On list_datalake_analytics_stage: /* {"app": "dbt", "dbt_version": "1.8.2", "profile_name": "my_dbt_trino_project", "target_name": "dev", "connection_name": "list_datalake_analytics_stage"} */
select
      t.table_catalog as database,
      t.table_name as name,
      t.table_schema as schema,
      case when mv.name is not null then 'materialized_view'
           when t.table_type = 'BASE TABLE' then 'table'
           when t.table_type = 'VIEW' then 'view'
           else t.table_type
      end as table_type
    from "datalake".INFORMATION_SCHEMA.tables t
    left join (
            select * from system.metadata.materialized_views
            where catalog_name = 'datalake'
              and schema_name = 'analytics_stage') mv
          on mv.catalog_name = t.table_catalog and mv.schema_name = t.table_schema and mv.name = t.table_name
    where t.table_schema = 'analytics_stage'
[0m10:47:38.874683 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m10:47:38.955538 [debug] [ThreadPool]: SQL status: SUCCESS in 0.0 seconds
[0m10:47:38.957209 [debug] [ThreadPool]: On list_datalake_analytics_stage: ROLLBACK
[0m10:47:38.957209 [debug] [ThreadPool]: On list_datalake_analytics_stage: Close
[0m10:47:38.959324 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '9917e066-0124-4d9a-8d3b-208b35f8ebc5', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x0000023B991A0B10>]}
[0m10:47:38.959853 [debug] [MainThread]: On master: COMMIT
[0m10:47:38.960380 [info ] [MainThread]: Concurrency: 1 threads (target='dev')
[0m10:47:38.960905 [info ] [MainThread]: 
[0m10:47:38.963501 [debug] [Thread-1 (]: Began running node test.my_dbt_trino_project.accepted_values_src_auth_events_gender__F__M.888b091b87
[0m10:47:38.964019 [info ] [Thread-1 (]: 1 of 7 START test accepted_values_src_auth_events_gender__F__M ................. [RUN]
[0m10:47:38.964537 [debug] [Thread-1 (]: Acquiring new trino connection 'test.my_dbt_trino_project.accepted_values_src_auth_events_gender__F__M.888b091b87'
[0m10:47:38.965139 [debug] [Thread-1 (]: Began compiling node test.my_dbt_trino_project.accepted_values_src_auth_events_gender__F__M.888b091b87
[0m10:47:38.973986 [debug] [Thread-1 (]: Writing injected SQL for node "test.my_dbt_trino_project.accepted_values_src_auth_events_gender__F__M.888b091b87"
[0m10:47:38.975219 [debug] [Thread-1 (]: Began executing node test.my_dbt_trino_project.accepted_values_src_auth_events_gender__F__M.888b091b87
[0m10:47:38.990476 [debug] [Thread-1 (]: Writing runtime sql for node "test.my_dbt_trino_project.accepted_values_src_auth_events_gender__F__M.888b091b87"
[0m10:47:38.992498 [debug] [Thread-1 (]: Using trino connection "test.my_dbt_trino_project.accepted_values_src_auth_events_gender__F__M.888b091b87"
[0m10:47:38.992498 [debug] [Thread-1 (]: On test.my_dbt_trino_project.accepted_values_src_auth_events_gender__F__M.888b091b87: /* {"app": "dbt", "dbt_version": "1.8.2", "profile_name": "my_dbt_trino_project", "target_name": "dev", "node_id": "test.my_dbt_trino_project.accepted_values_src_auth_events_gender__F__M.888b091b87"} */
select
      count(*) as failures,
      count(*) != 0 as should_warn,
      count(*) != 0 as should_error
    from (
      
    
    

with all_values as (

    select
        gender as value_field,
        count(*) as n_records

    from "datalake"."analytics_source"."src_auth_events"
    group by gender

)

select *
from all_values
where value_field not in (
    'F','M'
)



      
    ) dbt_internal_test
[0m10:47:38.993959 [debug] [Thread-1 (]: Opening a new connection, currently in state init
[0m10:47:39.136085 [debug] [Thread-1 (]: SQL status: SUCCESS in 0.0 seconds
[0m10:47:39.140278 [debug] [Thread-1 (]: On test.my_dbt_trino_project.accepted_values_src_auth_events_gender__F__M.888b091b87: ROLLBACK
[0m10:47:39.140796 [debug] [Thread-1 (]: On test.my_dbt_trino_project.accepted_values_src_auth_events_gender__F__M.888b091b87: Close
[0m10:47:39.141853 [error] [Thread-1 (]: 1 of 7 FAIL 1 accepted_values_src_auth_events_gender__F__M ..................... [[31mFAIL 1[0m in 0.18s]
[0m10:47:39.142892 [debug] [Thread-1 (]: Finished running node test.my_dbt_trino_project.accepted_values_src_auth_events_gender__F__M.888b091b87
[0m10:47:39.143422 [debug] [Thread-1 (]: Began running node test.my_dbt_trino_project.accepted_values_src_auth_events_level__free__paid.2d853012e0
[0m10:47:39.143943 [info ] [Thread-1 (]: 2 of 7 START test accepted_values_src_auth_events_level__free__paid ............ [RUN]
[0m10:47:39.144479 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly test.my_dbt_trino_project.accepted_values_src_auth_events_gender__F__M.888b091b87, now test.my_dbt_trino_project.accepted_values_src_auth_events_level__free__paid.2d853012e0)
[0m10:47:39.145020 [debug] [Thread-1 (]: Began compiling node test.my_dbt_trino_project.accepted_values_src_auth_events_level__free__paid.2d853012e0
[0m10:47:39.148545 [debug] [Thread-1 (]: Writing injected SQL for node "test.my_dbt_trino_project.accepted_values_src_auth_events_level__free__paid.2d853012e0"
[0m10:47:39.149834 [debug] [Thread-1 (]: Began executing node test.my_dbt_trino_project.accepted_values_src_auth_events_level__free__paid.2d853012e0
[0m10:47:39.152386 [debug] [Thread-1 (]: Writing runtime sql for node "test.my_dbt_trino_project.accepted_values_src_auth_events_level__free__paid.2d853012e0"
[0m10:47:39.153572 [debug] [Thread-1 (]: Using trino connection "test.my_dbt_trino_project.accepted_values_src_auth_events_level__free__paid.2d853012e0"
[0m10:47:39.153572 [debug] [Thread-1 (]: On test.my_dbt_trino_project.accepted_values_src_auth_events_level__free__paid.2d853012e0: /* {"app": "dbt", "dbt_version": "1.8.2", "profile_name": "my_dbt_trino_project", "target_name": "dev", "node_id": "test.my_dbt_trino_project.accepted_values_src_auth_events_level__free__paid.2d853012e0"} */
select
      count(*) as failures,
      count(*) != 0 as should_warn,
      count(*) != 0 as should_error
    from (
      
    
    

with all_values as (

    select
        level as value_field,
        count(*) as n_records

    from "datalake"."analytics_source"."src_auth_events"
    group by level

)

select *
from all_values
where value_field not in (
    'free','paid'
)



      
    ) dbt_internal_test
[0m10:47:39.154581 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m10:47:39.282750 [debug] [Thread-1 (]: SQL status: SUCCESS in 0.0 seconds
[0m10:47:39.284308 [debug] [Thread-1 (]: On test.my_dbt_trino_project.accepted_values_src_auth_events_level__free__paid.2d853012e0: ROLLBACK
[0m10:47:39.284308 [debug] [Thread-1 (]: On test.my_dbt_trino_project.accepted_values_src_auth_events_level__free__paid.2d853012e0: Close
[0m10:47:39.285345 [info ] [Thread-1 (]: 2 of 7 PASS accepted_values_src_auth_events_level__free__paid .................. [[32mPASS[0m in 0.14s]
[0m10:47:39.285870 [debug] [Thread-1 (]: Finished running node test.my_dbt_trino_project.accepted_values_src_auth_events_level__free__paid.2d853012e0
[0m10:47:39.286401 [debug] [Thread-1 (]: Began running node test.my_dbt_trino_project.accepted_values_src_auth_events_success__True__False.5205206c4b
[0m10:47:39.286926 [info ] [Thread-1 (]: 3 of 7 START test accepted_values_src_auth_events_success__True__False ......... [RUN]
[0m10:47:39.287450 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly test.my_dbt_trino_project.accepted_values_src_auth_events_level__free__paid.2d853012e0, now test.my_dbt_trino_project.accepted_values_src_auth_events_success__True__False.5205206c4b)
[0m10:47:39.287983 [debug] [Thread-1 (]: Began compiling node test.my_dbt_trino_project.accepted_values_src_auth_events_success__True__False.5205206c4b
[0m10:47:39.291694 [debug] [Thread-1 (]: Writing injected SQL for node "test.my_dbt_trino_project.accepted_values_src_auth_events_success__True__False.5205206c4b"
[0m10:47:39.292882 [debug] [Thread-1 (]: Began executing node test.my_dbt_trino_project.accepted_values_src_auth_events_success__True__False.5205206c4b
[0m10:47:39.295890 [debug] [Thread-1 (]: Writing runtime sql for node "test.my_dbt_trino_project.accepted_values_src_auth_events_success__True__False.5205206c4b"
[0m10:47:39.297900 [debug] [Thread-1 (]: Using trino connection "test.my_dbt_trino_project.accepted_values_src_auth_events_success__True__False.5205206c4b"
[0m10:47:39.297900 [debug] [Thread-1 (]: On test.my_dbt_trino_project.accepted_values_src_auth_events_success__True__False.5205206c4b: /* {"app": "dbt", "dbt_version": "1.8.2", "profile_name": "my_dbt_trino_project", "target_name": "dev", "node_id": "test.my_dbt_trino_project.accepted_values_src_auth_events_success__True__False.5205206c4b"} */
select
      count(*) as failures,
      count(*) != 0 as should_warn,
      count(*) != 0 as should_error
    from (
      
    
    

with all_values as (

    select
        success as value_field,
        count(*) as n_records

    from "datalake"."analytics_source"."src_auth_events"
    group by success

)

select *
from all_values
where value_field not in (
    'True','False'
)



      
    ) dbt_internal_test
[0m10:47:39.299152 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m10:47:39.348472 [debug] [Thread-1 (]: Trino adapter: Trino query id: 20240618_024739_00068_z97n2
[0m10:47:39.348999 [debug] [Thread-1 (]: Trino adapter: Trino error: TrinoUserError(type=USER_ERROR, name=COLUMN_NOT_FOUND, message="line 14:9: Column 'success' cannot be resolved", query_id=20240618_024739_00068_z97n2)
[0m10:47:39.349525 [debug] [Thread-1 (]: On test.my_dbt_trino_project.accepted_values_src_auth_events_success__True__False.5205206c4b: ROLLBACK
[0m10:47:39.350062 [debug] [Thread-1 (]: On test.my_dbt_trino_project.accepted_values_src_auth_events_success__True__False.5205206c4b: Close
[0m10:47:39.353769 [debug] [Thread-1 (]: Database Error in test accepted_values_src_auth_events_success__True__False (models\source\schema.yml)
  TrinoUserError(type=USER_ERROR, name=COLUMN_NOT_FOUND, message="line 14:9: Column 'success' cannot be resolved", query_id=20240618_024739_00068_z97n2)
  compiled Code at target\run\my_dbt_trino_project\models\source\schema.yml\accepted_values_src_auth_events_success__True__False.sql
[0m10:47:39.354901 [error] [Thread-1 (]: 3 of 7 ERROR accepted_values_src_auth_events_success__True__False .............. [[31mERROR[0m in 0.07s]
[0m10:47:39.355946 [debug] [Thread-1 (]: Finished running node test.my_dbt_trino_project.accepted_values_src_auth_events_success__True__False.5205206c4b
[0m10:47:39.356997 [debug] [Thread-1 (]: Began running node test.my_dbt_trino_project.not_null_src_auth_events_sessionId.5faf81a495
[0m10:47:39.357520 [info ] [Thread-1 (]: 4 of 7 START test not_null_src_auth_events_sessionId ........................... [RUN]
[0m10:47:39.358049 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly test.my_dbt_trino_project.accepted_values_src_auth_events_success__True__False.5205206c4b, now test.my_dbt_trino_project.not_null_src_auth_events_sessionId.5faf81a495)
[0m10:47:39.358582 [debug] [Thread-1 (]: Began compiling node test.my_dbt_trino_project.not_null_src_auth_events_sessionId.5faf81a495
[0m10:47:39.364957 [debug] [Thread-1 (]: Writing injected SQL for node "test.my_dbt_trino_project.not_null_src_auth_events_sessionId.5faf81a495"
[0m10:47:39.364957 [debug] [Thread-1 (]: Began executing node test.my_dbt_trino_project.not_null_src_auth_events_sessionId.5faf81a495
[0m10:47:39.367273 [debug] [Thread-1 (]: Writing runtime sql for node "test.my_dbt_trino_project.not_null_src_auth_events_sessionId.5faf81a495"
[0m10:47:39.369272 [debug] [Thread-1 (]: Using trino connection "test.my_dbt_trino_project.not_null_src_auth_events_sessionId.5faf81a495"
[0m10:47:39.370272 [debug] [Thread-1 (]: On test.my_dbt_trino_project.not_null_src_auth_events_sessionId.5faf81a495: /* {"app": "dbt", "dbt_version": "1.8.2", "profile_name": "my_dbt_trino_project", "target_name": "dev", "node_id": "test.my_dbt_trino_project.not_null_src_auth_events_sessionId.5faf81a495"} */
select
      count(*) as failures,
      count(*) != 0 as should_warn,
      count(*) != 0 as should_error
    from (
      
    
    



select sessionId
from "datalake"."analytics_source"."src_auth_events"
where sessionId is null



      
    ) dbt_internal_test
[0m10:47:39.370779 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m10:47:39.467488 [debug] [Thread-1 (]: SQL status: SUCCESS in 0.0 seconds
[0m10:47:39.469050 [debug] [Thread-1 (]: On test.my_dbt_trino_project.not_null_src_auth_events_sessionId.5faf81a495: ROLLBACK
[0m10:47:39.469569 [debug] [Thread-1 (]: On test.my_dbt_trino_project.not_null_src_auth_events_sessionId.5faf81a495: Close
[0m10:47:39.470091 [info ] [Thread-1 (]: 4 of 7 PASS not_null_src_auth_events_sessionId ................................. [[32mPASS[0m in 0.11s]
[0m10:47:39.471677 [debug] [Thread-1 (]: Finished running node test.my_dbt_trino_project.not_null_src_auth_events_sessionId.5faf81a495
[0m10:47:39.471677 [debug] [Thread-1 (]: Began running node test.my_dbt_trino_project.not_null_src_auth_events_ts.179fe664b6
[0m10:47:39.472206 [info ] [Thread-1 (]: 5 of 7 START test not_null_src_auth_events_ts .................................. [RUN]
[0m10:47:39.473259 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly test.my_dbt_trino_project.not_null_src_auth_events_sessionId.5faf81a495, now test.my_dbt_trino_project.not_null_src_auth_events_ts.179fe664b6)
[0m10:47:39.473259 [debug] [Thread-1 (]: Began compiling node test.my_dbt_trino_project.not_null_src_auth_events_ts.179fe664b6
[0m10:47:39.478915 [debug] [Thread-1 (]: Writing injected SQL for node "test.my_dbt_trino_project.not_null_src_auth_events_ts.179fe664b6"
[0m10:47:39.480182 [debug] [Thread-1 (]: Began executing node test.my_dbt_trino_project.not_null_src_auth_events_ts.179fe664b6
[0m10:47:39.483188 [debug] [Thread-1 (]: Writing runtime sql for node "test.my_dbt_trino_project.not_null_src_auth_events_ts.179fe664b6"
[0m10:47:39.485190 [debug] [Thread-1 (]: Using trino connection "test.my_dbt_trino_project.not_null_src_auth_events_ts.179fe664b6"
[0m10:47:39.485190 [debug] [Thread-1 (]: On test.my_dbt_trino_project.not_null_src_auth_events_ts.179fe664b6: /* {"app": "dbt", "dbt_version": "1.8.2", "profile_name": "my_dbt_trino_project", "target_name": "dev", "node_id": "test.my_dbt_trino_project.not_null_src_auth_events_ts.179fe664b6"} */
select
      count(*) as failures,
      count(*) != 0 as should_warn,
      count(*) != 0 as should_error
    from (
      
    
    



select ts
from "datalake"."analytics_source"."src_auth_events"
where ts is null



      
    ) dbt_internal_test
[0m10:47:39.485190 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m10:47:39.565161 [debug] [Thread-1 (]: SQL status: SUCCESS in 0.0 seconds
[0m10:47:39.566747 [debug] [Thread-1 (]: On test.my_dbt_trino_project.not_null_src_auth_events_ts.179fe664b6: ROLLBACK
[0m10:47:39.567276 [debug] [Thread-1 (]: On test.my_dbt_trino_project.not_null_src_auth_events_ts.179fe664b6: Close
[0m10:47:39.568342 [info ] [Thread-1 (]: 5 of 7 PASS not_null_src_auth_events_ts ........................................ [[32mPASS[0m in 0.10s]
[0m10:47:39.569413 [debug] [Thread-1 (]: Finished running node test.my_dbt_trino_project.not_null_src_auth_events_ts.179fe664b6
[0m10:47:39.569948 [debug] [Thread-1 (]: Began running node test.my_dbt_trino_project.unique_src_auth_events_sessionId.86c4c7c26f
[0m10:47:39.570480 [info ] [Thread-1 (]: 6 of 7 START test unique_src_auth_events_sessionId ............................. [RUN]
[0m10:47:39.571039 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly test.my_dbt_trino_project.not_null_src_auth_events_ts.179fe664b6, now test.my_dbt_trino_project.unique_src_auth_events_sessionId.86c4c7c26f)
[0m10:47:39.571569 [debug] [Thread-1 (]: Began compiling node test.my_dbt_trino_project.unique_src_auth_events_sessionId.86c4c7c26f
[0m10:47:39.577420 [debug] [Thread-1 (]: Writing injected SQL for node "test.my_dbt_trino_project.unique_src_auth_events_sessionId.86c4c7c26f"
[0m10:47:39.578476 [debug] [Thread-1 (]: Began executing node test.my_dbt_trino_project.unique_src_auth_events_sessionId.86c4c7c26f
[0m10:47:39.582193 [debug] [Thread-1 (]: Writing runtime sql for node "test.my_dbt_trino_project.unique_src_auth_events_sessionId.86c4c7c26f"
[0m10:47:39.584816 [debug] [Thread-1 (]: Using trino connection "test.my_dbt_trino_project.unique_src_auth_events_sessionId.86c4c7c26f"
[0m10:47:39.585346 [debug] [Thread-1 (]: On test.my_dbt_trino_project.unique_src_auth_events_sessionId.86c4c7c26f: /* {"app": "dbt", "dbt_version": "1.8.2", "profile_name": "my_dbt_trino_project", "target_name": "dev", "node_id": "test.my_dbt_trino_project.unique_src_auth_events_sessionId.86c4c7c26f"} */
select
      count(*) as failures,
      count(*) != 0 as should_warn,
      count(*) != 0 as should_error
    from (
      
    
    

select
    sessionId as unique_field,
    count(*) as n_records

from "datalake"."analytics_source"."src_auth_events"
where sessionId is not null
group by sessionId
having count(*) > 1



      
    ) dbt_internal_test
[0m10:47:39.585940 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m10:47:39.711200 [debug] [Thread-1 (]: SQL status: SUCCESS in 0.0 seconds
[0m10:47:39.713334 [debug] [Thread-1 (]: On test.my_dbt_trino_project.unique_src_auth_events_sessionId.86c4c7c26f: ROLLBACK
[0m10:47:39.714378 [debug] [Thread-1 (]: On test.my_dbt_trino_project.unique_src_auth_events_sessionId.86c4c7c26f: Close
[0m10:47:39.715958 [error] [Thread-1 (]: 6 of 7 FAIL 13 unique_src_auth_events_sessionId ................................ [[31mFAIL 13[0m in 0.14s]
[0m10:47:39.717027 [debug] [Thread-1 (]: Finished running node test.my_dbt_trino_project.unique_src_auth_events_sessionId.86c4c7c26f
[0m10:47:39.717554 [debug] [Thread-1 (]: Began running node test.my_dbt_trino_project.unique_src_auth_events_userId.9244f51c84
[0m10:47:39.718105 [info ] [Thread-1 (]: 7 of 7 START test unique_src_auth_events_userId ................................ [RUN]
[0m10:47:39.719113 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly test.my_dbt_trino_project.unique_src_auth_events_sessionId.86c4c7c26f, now test.my_dbt_trino_project.unique_src_auth_events_userId.9244f51c84)
[0m10:47:39.719113 [debug] [Thread-1 (]: Began compiling node test.my_dbt_trino_project.unique_src_auth_events_userId.9244f51c84
[0m10:47:39.725188 [debug] [Thread-1 (]: Writing injected SQL for node "test.my_dbt_trino_project.unique_src_auth_events_userId.9244f51c84"
[0m10:47:39.726190 [debug] [Thread-1 (]: Began executing node test.my_dbt_trino_project.unique_src_auth_events_userId.9244f51c84
[0m10:47:39.729185 [debug] [Thread-1 (]: Writing runtime sql for node "test.my_dbt_trino_project.unique_src_auth_events_userId.9244f51c84"
[0m10:47:39.732182 [debug] [Thread-1 (]: Using trino connection "test.my_dbt_trino_project.unique_src_auth_events_userId.9244f51c84"
[0m10:47:39.732182 [debug] [Thread-1 (]: On test.my_dbt_trino_project.unique_src_auth_events_userId.9244f51c84: /* {"app": "dbt", "dbt_version": "1.8.2", "profile_name": "my_dbt_trino_project", "target_name": "dev", "node_id": "test.my_dbt_trino_project.unique_src_auth_events_userId.9244f51c84"} */
select
      count(*) as failures,
      count(*) != 0 as should_warn,
      count(*) != 0 as should_error
    from (
      
    
    

select
    userId as unique_field,
    count(*) as n_records

from "datalake"."analytics_source"."src_auth_events"
where userId is not null
group by userId
having count(*) > 1



      
    ) dbt_internal_test
[0m10:47:39.733509 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m10:47:39.870401 [debug] [Thread-1 (]: SQL status: SUCCESS in 0.0 seconds
[0m10:47:39.872492 [debug] [Thread-1 (]: On test.my_dbt_trino_project.unique_src_auth_events_userId.9244f51c84: ROLLBACK
[0m10:47:39.873016 [debug] [Thread-1 (]: On test.my_dbt_trino_project.unique_src_auth_events_userId.9244f51c84: Close
[0m10:47:39.874064 [error] [Thread-1 (]: 7 of 7 FAIL 6 unique_src_auth_events_userId .................................... [[31mFAIL 6[0m in 0.16s]
[0m10:47:39.875122 [debug] [Thread-1 (]: Finished running node test.my_dbt_trino_project.unique_src_auth_events_userId.9244f51c84
[0m10:47:39.876171 [debug] [MainThread]: On master: COMMIT
[0m10:47:39.877272 [debug] [MainThread]: Connection 'master' was properly closed.
[0m10:47:39.878333 [debug] [MainThread]: Connection 'list_datalake_analytics_stage' was properly closed.
[0m10:47:39.878333 [debug] [MainThread]: Connection 'test.my_dbt_trino_project.unique_src_auth_events_userId.9244f51c84' was properly closed.
[0m10:47:39.879383 [info ] [MainThread]: 
[0m10:47:39.879917 [info ] [MainThread]: Finished running 7 data tests in 0 hours 0 minutes and 1.33 seconds (1.33s).
[0m10:47:39.880927 [debug] [MainThread]: Command end result
[0m10:47:39.980570 [info ] [MainThread]: 
[0m10:47:39.981631 [info ] [MainThread]: [31mCompleted with 4 errors and 0 warnings:[0m
[0m10:47:39.982157 [info ] [MainThread]: 
[0m10:47:39.982675 [error] [MainThread]: [31mFailure in test accepted_values_src_auth_events_gender__F__M (models\source\schema.yml)[0m
[0m10:47:39.983194 [error] [MainThread]:   Got 1 result, configured to fail if != 0
[0m10:47:39.983733 [info ] [MainThread]: 
[0m10:47:39.984260 [info ] [MainThread]:   compiled code at target\compiled\my_dbt_trino_project\models\source\schema.yml\accepted_values_src_auth_events_gender__F__M.sql
[0m10:47:39.984782 [info ] [MainThread]: 
[0m10:47:39.985305 [error] [MainThread]:   Database Error in test accepted_values_src_auth_events_success__True__False (models\source\schema.yml)
  TrinoUserError(type=USER_ERROR, name=COLUMN_NOT_FOUND, message="line 14:9: Column 'success' cannot be resolved", query_id=20240618_024739_00068_z97n2)
  compiled Code at target\run\my_dbt_trino_project\models\source\schema.yml\accepted_values_src_auth_events_success__True__False.sql
[0m10:47:39.986350 [info ] [MainThread]: 
[0m10:47:39.986350 [error] [MainThread]: [31mFailure in test unique_src_auth_events_sessionId (models\source\schema.yml)[0m
[0m10:47:39.987870 [error] [MainThread]:   Got 13 results, configured to fail if != 0
[0m10:47:39.987870 [info ] [MainThread]: 
[0m10:47:39.988875 [info ] [MainThread]:   compiled code at target\compiled\my_dbt_trino_project\models\source\schema.yml\unique_src_auth_events_sessionId.sql
[0m10:47:39.988875 [info ] [MainThread]: 
[0m10:47:39.989884 [error] [MainThread]: [31mFailure in test unique_src_auth_events_userId (models\source\schema.yml)[0m
[0m10:47:39.991164 [error] [MainThread]:   Got 6 results, configured to fail if != 0
[0m10:47:39.991671 [info ] [MainThread]: 
[0m10:47:39.992190 [info ] [MainThread]:   compiled code at target\compiled\my_dbt_trino_project\models\source\schema.yml\unique_src_auth_events_userId.sql
[0m10:47:39.993202 [info ] [MainThread]: 
[0m10:47:39.994203 [info ] [MainThread]: Done. PASS=3 WARN=0 ERROR=4 SKIP=0 TOTAL=7
[0m10:47:39.995291 [debug] [MainThread]: Command `dbt test` failed at 10:47:39.995291 after 2.31 seconds
[0m10:47:39.996302 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x0000023B95F45B10>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x0000023B991139D0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x0000023B99732490>]}
[0m10:47:39.996302 [debug] [MainThread]: Flushing usage events
[0m13:18:20.281313 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000001A736BB3090>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000001A736BC9450>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000001A736BC9110>]}


============================== 13:18:20.285312 | 6978f2cf-d4e5-4c1a-ba80-af9cb03a3023 ==============================
[0m13:18:20.285312 [info ] [MainThread]: Running with dbt=1.8.2
[0m13:18:20.285312 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'indirect_selection': 'eager', 'log_cache_events': 'False', 'write_json': 'True', 'partial_parse': 'True', 'cache_selected_only': 'False', 'profiles_dir': 'C:\\Users\\ASUS\\Desktop\\work\\Iceberg-Dbt-Trino-Hive-modern-open-source-data-stack-main\\dbt', 'fail_fast': 'False', 'debug': 'False', 'log_path': 'C:\\Users\\ASUS\\Desktop\\work\\Iceberg-Dbt-Trino-Hive-modern-open-source-data-stack-main\\dbt\\logs', 'warn_error': 'None', 'version_check': 'True', 'use_colors': 'True', 'use_experimental_parser': 'False', 'no_print': 'None', 'quiet': 'False', 'log_format': 'default', 'introspect': 'True', 'static_parser': 'True', 'invocation_command': 'dbt test', 'target_path': 'None', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'send_anonymous_usage_stats': 'True'}
[0m13:18:20.859580 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': '6978f2cf-d4e5-4c1a-ba80-af9cb03a3023', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000001A736DB5010>]}
[0m13:18:20.892626 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': '6978f2cf-d4e5-4c1a-ba80-af9cb03a3023', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000001A733D055D0>]}
[0m13:18:20.893626 [info ] [MainThread]: Registered adapter: trino=1.8.0
[0m13:18:20.904136 [debug] [MainThread]: checksum: f0a141b9de567cb7f131613ba2682f40b3a1c6a157f81c6e5435862eff68f109, vars: {}, profile: , target: , version: 1.8.2
[0m13:18:21.101881 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 0 files changed.
[0m13:18:21.103533 [debug] [MainThread]: Partial parsing enabled, no changes found, skipping parsing
[0m13:18:21.137736 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': '6978f2cf-d4e5-4c1a-ba80-af9cb03a3023', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000001A7371AB250>]}
[0m13:18:21.255911 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': '6978f2cf-d4e5-4c1a-ba80-af9cb03a3023', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000001A736F1B210>]}
[0m13:18:21.256911 [info ] [MainThread]: Found 15 models, 7 data tests, 3 sources, 559 macros
[0m13:18:21.257911 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '6978f2cf-d4e5-4c1a-ba80-af9cb03a3023', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000001A73706D290>]}
[0m13:18:21.259419 [info ] [MainThread]: 
[0m13:18:21.260420 [debug] [MainThread]: Acquiring new trino connection 'master'
[0m13:18:21.264419 [debug] [ThreadPool]: Acquiring new trino connection 'list_datalake_analytics_source'
[0m13:18:21.440723 [debug] [ThreadPool]: Using trino connection "list_datalake_analytics_source"
[0m13:18:21.441722 [debug] [ThreadPool]: On list_datalake_analytics_source: /* {"app": "dbt", "dbt_version": "1.8.2", "profile_name": "my_dbt_trino_project", "target_name": "dev", "connection_name": "list_datalake_analytics_source"} */
select
      t.table_catalog as database,
      t.table_name as name,
      t.table_schema as schema,
      case when mv.name is not null then 'materialized_view'
           when t.table_type = 'BASE TABLE' then 'table'
           when t.table_type = 'VIEW' then 'view'
           else t.table_type
      end as table_type
    from "datalake".INFORMATION_SCHEMA.tables t
    left join (
            select * from system.metadata.materialized_views
            where catalog_name = 'datalake'
              and schema_name = 'analytics_source') mv
          on mv.catalog_name = t.table_catalog and mv.schema_name = t.table_schema and mv.name = t.table_name
    where t.table_schema = 'analytics_source'
[0m13:18:21.441722 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m13:18:22.084811 [debug] [ThreadPool]: SQL status: SUCCESS in 1.0 seconds
[0m13:18:22.086823 [debug] [ThreadPool]: On list_datalake_analytics_source: ROLLBACK
[0m13:18:22.087334 [debug] [ThreadPool]: On list_datalake_analytics_source: Close
[0m13:18:22.087880 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_datalake_analytics_source, now list_datalake_analytics)
[0m13:18:22.091554 [debug] [ThreadPool]: Using trino connection "list_datalake_analytics"
[0m13:18:22.092097 [debug] [ThreadPool]: On list_datalake_analytics: /* {"app": "dbt", "dbt_version": "1.8.2", "profile_name": "my_dbt_trino_project", "target_name": "dev", "connection_name": "list_datalake_analytics"} */
select
      t.table_catalog as database,
      t.table_name as name,
      t.table_schema as schema,
      case when mv.name is not null then 'materialized_view'
           when t.table_type = 'BASE TABLE' then 'table'
           when t.table_type = 'VIEW' then 'view'
           else t.table_type
      end as table_type
    from "datalake".INFORMATION_SCHEMA.tables t
    left join (
            select * from system.metadata.materialized_views
            where catalog_name = 'datalake'
              and schema_name = 'analytics') mv
          on mv.catalog_name = t.table_catalog and mv.schema_name = t.table_schema and mv.name = t.table_name
    where t.table_schema = 'analytics'
[0m13:18:22.092643 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m13:18:22.309095 [debug] [ThreadPool]: SQL status: SUCCESS in 0.0 seconds
[0m13:18:22.310145 [debug] [ThreadPool]: On list_datalake_analytics: ROLLBACK
[0m13:18:22.311286 [debug] [ThreadPool]: On list_datalake_analytics: Close
[0m13:18:22.312350 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_datalake_analytics, now list_datalake_analytics_stage)
[0m13:18:22.320111 [debug] [ThreadPool]: Using trino connection "list_datalake_analytics_stage"
[0m13:18:22.320652 [debug] [ThreadPool]: On list_datalake_analytics_stage: /* {"app": "dbt", "dbt_version": "1.8.2", "profile_name": "my_dbt_trino_project", "target_name": "dev", "connection_name": "list_datalake_analytics_stage"} */
select
      t.table_catalog as database,
      t.table_name as name,
      t.table_schema as schema,
      case when mv.name is not null then 'materialized_view'
           when t.table_type = 'BASE TABLE' then 'table'
           when t.table_type = 'VIEW' then 'view'
           else t.table_type
      end as table_type
    from "datalake".INFORMATION_SCHEMA.tables t
    left join (
            select * from system.metadata.materialized_views
            where catalog_name = 'datalake'
              and schema_name = 'analytics_stage') mv
          on mv.catalog_name = t.table_catalog and mv.schema_name = t.table_schema and mv.name = t.table_name
    where t.table_schema = 'analytics_stage'
[0m13:18:22.321178 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m13:18:22.699478 [debug] [ThreadPool]: SQL status: SUCCESS in 0.0 seconds
[0m13:18:22.701848 [debug] [ThreadPool]: On list_datalake_analytics_stage: ROLLBACK
[0m13:18:22.703016 [debug] [ThreadPool]: On list_datalake_analytics_stage: Close
[0m13:18:22.705770 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '6978f2cf-d4e5-4c1a-ba80-af9cb03a3023', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000001A7370A2A10>]}
[0m13:18:22.706838 [debug] [MainThread]: On master: COMMIT
[0m13:18:22.708890 [info ] [MainThread]: Concurrency: 1 threads (target='dev')
[0m13:18:22.710406 [info ] [MainThread]: 
[0m13:18:22.715924 [debug] [Thread-1 (]: Began running node test.my_dbt_trino_project.accepted_values_src_auth_events_gender__F__M.888b091b87
[0m13:18:22.716924 [info ] [Thread-1 (]: 1 of 7 START test accepted_values_src_auth_events_gender__F__M ................. [RUN]
[0m13:18:22.717926 [debug] [Thread-1 (]: Acquiring new trino connection 'test.my_dbt_trino_project.accepted_values_src_auth_events_gender__F__M.888b091b87'
[0m13:18:22.718926 [debug] [Thread-1 (]: Began compiling node test.my_dbt_trino_project.accepted_values_src_auth_events_gender__F__M.888b091b87
[0m13:18:22.736954 [debug] [Thread-1 (]: Writing injected SQL for node "test.my_dbt_trino_project.accepted_values_src_auth_events_gender__F__M.888b091b87"
[0m13:18:22.737956 [debug] [Thread-1 (]: Began executing node test.my_dbt_trino_project.accepted_values_src_auth_events_gender__F__M.888b091b87
[0m13:18:22.761495 [debug] [Thread-1 (]: Writing runtime sql for node "test.my_dbt_trino_project.accepted_values_src_auth_events_gender__F__M.888b091b87"
[0m13:18:22.764495 [debug] [Thread-1 (]: Using trino connection "test.my_dbt_trino_project.accepted_values_src_auth_events_gender__F__M.888b091b87"
[0m13:18:22.766001 [debug] [Thread-1 (]: On test.my_dbt_trino_project.accepted_values_src_auth_events_gender__F__M.888b091b87: /* {"app": "dbt", "dbt_version": "1.8.2", "profile_name": "my_dbt_trino_project", "target_name": "dev", "node_id": "test.my_dbt_trino_project.accepted_values_src_auth_events_gender__F__M.888b091b87"} */
select
      count(*) as failures,
      count(*) != 0 as should_warn,
      count(*) != 0 as should_error
    from (
      
    
    

with all_values as (

    select
        gender as value_field,
        count(*) as n_records

    from "datalake"."analytics_source"."src_auth_events"
    group by gender

)

select *
from all_values
where value_field not in (
    'F','M'
)



      
    ) dbt_internal_test
[0m13:18:22.767006 [debug] [Thread-1 (]: Opening a new connection, currently in state init
[0m13:18:23.451749 [debug] [Thread-1 (]: SQL status: SUCCESS in 1.0 seconds
[0m13:18:23.457683 [debug] [Thread-1 (]: On test.my_dbt_trino_project.accepted_values_src_auth_events_gender__F__M.888b091b87: ROLLBACK
[0m13:18:23.458204 [debug] [Thread-1 (]: On test.my_dbt_trino_project.accepted_values_src_auth_events_gender__F__M.888b091b87: Close
[0m13:18:23.459791 [error] [Thread-1 (]: 1 of 7 FAIL 1 accepted_values_src_auth_events_gender__F__M ..................... [[31mFAIL 1[0m in 0.74s]
[0m13:18:23.460834 [debug] [Thread-1 (]: Finished running node test.my_dbt_trino_project.accepted_values_src_auth_events_gender__F__M.888b091b87
[0m13:18:23.461955 [debug] [Thread-1 (]: Began running node test.my_dbt_trino_project.accepted_values_src_auth_events_level__free__paid.2d853012e0
[0m13:18:23.462472 [info ] [Thread-1 (]: 2 of 7 START test accepted_values_src_auth_events_level__free__paid ............ [RUN]
[0m13:18:23.463018 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly test.my_dbt_trino_project.accepted_values_src_auth_events_gender__F__M.888b091b87, now test.my_dbt_trino_project.accepted_values_src_auth_events_level__free__paid.2d853012e0)
[0m13:18:23.464100 [debug] [Thread-1 (]: Began compiling node test.my_dbt_trino_project.accepted_values_src_auth_events_level__free__paid.2d853012e0
[0m13:18:23.470931 [debug] [Thread-1 (]: Writing injected SQL for node "test.my_dbt_trino_project.accepted_values_src_auth_events_level__free__paid.2d853012e0"
[0m13:18:23.471985 [debug] [Thread-1 (]: Began executing node test.my_dbt_trino_project.accepted_values_src_auth_events_level__free__paid.2d853012e0
[0m13:18:23.475108 [debug] [Thread-1 (]: Writing runtime sql for node "test.my_dbt_trino_project.accepted_values_src_auth_events_level__free__paid.2d853012e0"
[0m13:18:23.477195 [debug] [Thread-1 (]: Using trino connection "test.my_dbt_trino_project.accepted_values_src_auth_events_level__free__paid.2d853012e0"
[0m13:18:23.477772 [debug] [Thread-1 (]: On test.my_dbt_trino_project.accepted_values_src_auth_events_level__free__paid.2d853012e0: /* {"app": "dbt", "dbt_version": "1.8.2", "profile_name": "my_dbt_trino_project", "target_name": "dev", "node_id": "test.my_dbt_trino_project.accepted_values_src_auth_events_level__free__paid.2d853012e0"} */
select
      count(*) as failures,
      count(*) != 0 as should_warn,
      count(*) != 0 as should_error
    from (
      
    
    

with all_values as (

    select
        level as value_field,
        count(*) as n_records

    from "datalake"."analytics_source"."src_auth_events"
    group by level

)

select *
from all_values
where value_field not in (
    'free','paid'
)



      
    ) dbt_internal_test
[0m13:18:23.477772 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m13:18:23.788825 [debug] [Thread-1 (]: SQL status: SUCCESS in 0.0 seconds
[0m13:18:23.791985 [debug] [Thread-1 (]: On test.my_dbt_trino_project.accepted_values_src_auth_events_level__free__paid.2d853012e0: ROLLBACK
[0m13:18:23.793028 [debug] [Thread-1 (]: On test.my_dbt_trino_project.accepted_values_src_auth_events_level__free__paid.2d853012e0: Close
[0m13:18:23.794071 [info ] [Thread-1 (]: 2 of 7 PASS accepted_values_src_auth_events_level__free__paid .................. [[32mPASS[0m in 0.33s]
[0m13:18:23.795648 [debug] [Thread-1 (]: Finished running node test.my_dbt_trino_project.accepted_values_src_auth_events_level__free__paid.2d853012e0
[0m13:18:23.796169 [debug] [Thread-1 (]: Began running node test.my_dbt_trino_project.accepted_values_src_auth_events_success__True__False.5205206c4b
[0m13:18:23.796692 [info ] [Thread-1 (]: 3 of 7 START test accepted_values_src_auth_events_success__True__False ......... [RUN]
[0m13:18:23.797206 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly test.my_dbt_trino_project.accepted_values_src_auth_events_level__free__paid.2d853012e0, now test.my_dbt_trino_project.accepted_values_src_auth_events_success__True__False.5205206c4b)
[0m13:18:23.797730 [debug] [Thread-1 (]: Began compiling node test.my_dbt_trino_project.accepted_values_src_auth_events_success__True__False.5205206c4b
[0m13:18:23.804282 [debug] [Thread-1 (]: Writing injected SQL for node "test.my_dbt_trino_project.accepted_values_src_auth_events_success__True__False.5205206c4b"
[0m13:18:23.805282 [debug] [Thread-1 (]: Began executing node test.my_dbt_trino_project.accepted_values_src_auth_events_success__True__False.5205206c4b
[0m13:18:23.808282 [debug] [Thread-1 (]: Writing runtime sql for node "test.my_dbt_trino_project.accepted_values_src_auth_events_success__True__False.5205206c4b"
[0m13:18:23.810319 [debug] [Thread-1 (]: Using trino connection "test.my_dbt_trino_project.accepted_values_src_auth_events_success__True__False.5205206c4b"
[0m13:18:23.810319 [debug] [Thread-1 (]: On test.my_dbt_trino_project.accepted_values_src_auth_events_success__True__False.5205206c4b: /* {"app": "dbt", "dbt_version": "1.8.2", "profile_name": "my_dbt_trino_project", "target_name": "dev", "node_id": "test.my_dbt_trino_project.accepted_values_src_auth_events_success__True__False.5205206c4b"} */
select
      count(*) as failures,
      count(*) != 0 as should_warn,
      count(*) != 0 as should_error
    from (
      
    
    

with all_values as (

    select
        success as value_field,
        count(*) as n_records

    from "datalake"."analytics_source"."src_auth_events"
    group by success

)

select *
from all_values
where value_field not in (
    'True','False'
)



      
    ) dbt_internal_test
[0m13:18:23.811315 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m13:18:23.877410 [debug] [Thread-1 (]: Trino adapter: Trino query id: 20240618_035237_00078_z97n2
[0m13:18:23.877943 [debug] [Thread-1 (]: Trino adapter: Trino error: TrinoUserError(type=USER_ERROR, name=COLUMN_NOT_FOUND, message="line 14:9: Column 'success' cannot be resolved", query_id=20240618_035237_00078_z97n2)
[0m13:18:23.879044 [debug] [Thread-1 (]: On test.my_dbt_trino_project.accepted_values_src_auth_events_success__True__False.5205206c4b: ROLLBACK
[0m13:18:23.879557 [debug] [Thread-1 (]: On test.my_dbt_trino_project.accepted_values_src_auth_events_success__True__False.5205206c4b: Close
[0m13:18:23.887392 [debug] [Thread-1 (]: Database Error in test accepted_values_src_auth_events_success__True__False (models\source\schema.yml)
  TrinoUserError(type=USER_ERROR, name=COLUMN_NOT_FOUND, message="line 14:9: Column 'success' cannot be resolved", query_id=20240618_035237_00078_z97n2)
  compiled Code at target\run\my_dbt_trino_project\models\source\schema.yml\accepted_values_src_auth_events_success__True__False.sql
[0m13:18:23.887392 [error] [Thread-1 (]: 3 of 7 ERROR accepted_values_src_auth_events_success__True__False .............. [[31mERROR[0m in 0.09s]
[0m13:18:23.888389 [debug] [Thread-1 (]: Finished running node test.my_dbt_trino_project.accepted_values_src_auth_events_success__True__False.5205206c4b
[0m13:18:23.888389 [debug] [Thread-1 (]: Began running node test.my_dbt_trino_project.not_null_src_auth_events_sessionId.5faf81a495
[0m13:18:23.889893 [info ] [Thread-1 (]: 4 of 7 START test not_null_src_auth_events_sessionId ........................... [RUN]
[0m13:18:23.890898 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly test.my_dbt_trino_project.accepted_values_src_auth_events_success__True__False.5205206c4b, now test.my_dbt_trino_project.not_null_src_auth_events_sessionId.5faf81a495)
[0m13:18:23.890898 [debug] [Thread-1 (]: Began compiling node test.my_dbt_trino_project.not_null_src_auth_events_sessionId.5faf81a495
[0m13:18:23.897898 [debug] [Thread-1 (]: Writing injected SQL for node "test.my_dbt_trino_project.not_null_src_auth_events_sessionId.5faf81a495"
[0m13:18:23.898899 [debug] [Thread-1 (]: Began executing node test.my_dbt_trino_project.not_null_src_auth_events_sessionId.5faf81a495
[0m13:18:23.901408 [debug] [Thread-1 (]: Writing runtime sql for node "test.my_dbt_trino_project.not_null_src_auth_events_sessionId.5faf81a495"
[0m13:18:23.903408 [debug] [Thread-1 (]: Using trino connection "test.my_dbt_trino_project.not_null_src_auth_events_sessionId.5faf81a495"
[0m13:18:23.903408 [debug] [Thread-1 (]: On test.my_dbt_trino_project.not_null_src_auth_events_sessionId.5faf81a495: /* {"app": "dbt", "dbt_version": "1.8.2", "profile_name": "my_dbt_trino_project", "target_name": "dev", "node_id": "test.my_dbt_trino_project.not_null_src_auth_events_sessionId.5faf81a495"} */
select
      count(*) as failures,
      count(*) != 0 as should_warn,
      count(*) != 0 as should_error
    from (
      
    
    



select sessionId
from "datalake"."analytics_source"."src_auth_events"
where sessionId is null



      
    ) dbt_internal_test
[0m13:18:23.904407 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m13:18:24.101260 [debug] [Thread-1 (]: SQL status: SUCCESS in 0.0 seconds
[0m13:18:24.102823 [debug] [Thread-1 (]: On test.my_dbt_trino_project.not_null_src_auth_events_sessionId.5faf81a495: ROLLBACK
[0m13:18:24.103357 [debug] [Thread-1 (]: On test.my_dbt_trino_project.not_null_src_auth_events_sessionId.5faf81a495: Close
[0m13:18:24.104401 [info ] [Thread-1 (]: 4 of 7 PASS not_null_src_auth_events_sessionId ................................. [[32mPASS[0m in 0.21s]
[0m13:18:24.105449 [debug] [Thread-1 (]: Finished running node test.my_dbt_trino_project.not_null_src_auth_events_sessionId.5faf81a495
[0m13:18:24.105973 [debug] [Thread-1 (]: Began running node test.my_dbt_trino_project.not_null_src_auth_events_ts.179fe664b6
[0m13:18:24.106503 [info ] [Thread-1 (]: 5 of 7 START test not_null_src_auth_events_ts .................................. [RUN]
[0m13:18:24.107549 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly test.my_dbt_trino_project.not_null_src_auth_events_sessionId.5faf81a495, now test.my_dbt_trino_project.not_null_src_auth_events_ts.179fe664b6)
[0m13:18:24.107549 [debug] [Thread-1 (]: Began compiling node test.my_dbt_trino_project.not_null_src_auth_events_ts.179fe664b6
[0m13:18:24.113765 [debug] [Thread-1 (]: Writing injected SQL for node "test.my_dbt_trino_project.not_null_src_auth_events_ts.179fe664b6"
[0m13:18:24.114765 [debug] [Thread-1 (]: Began executing node test.my_dbt_trino_project.not_null_src_auth_events_ts.179fe664b6
[0m13:18:24.116764 [debug] [Thread-1 (]: Writing runtime sql for node "test.my_dbt_trino_project.not_null_src_auth_events_ts.179fe664b6"
[0m13:18:24.118881 [debug] [Thread-1 (]: Using trino connection "test.my_dbt_trino_project.not_null_src_auth_events_ts.179fe664b6"
[0m13:18:24.119881 [debug] [Thread-1 (]: On test.my_dbt_trino_project.not_null_src_auth_events_ts.179fe664b6: /* {"app": "dbt", "dbt_version": "1.8.2", "profile_name": "my_dbt_trino_project", "target_name": "dev", "node_id": "test.my_dbt_trino_project.not_null_src_auth_events_ts.179fe664b6"} */
select
      count(*) as failures,
      count(*) != 0 as should_warn,
      count(*) != 0 as should_error
    from (
      
    
    



select ts
from "datalake"."analytics_source"."src_auth_events"
where ts is null



      
    ) dbt_internal_test
[0m13:18:24.119881 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m13:18:24.960886 [debug] [Thread-1 (]: SQL status: SUCCESS in 1.0 seconds
[0m13:18:24.962472 [debug] [Thread-1 (]: On test.my_dbt_trino_project.not_null_src_auth_events_ts.179fe664b6: ROLLBACK
[0m13:18:24.962992 [debug] [Thread-1 (]: On test.my_dbt_trino_project.not_null_src_auth_events_ts.179fe664b6: Close
[0m13:18:24.963515 [info ] [Thread-1 (]: 5 of 7 PASS not_null_src_auth_events_ts ........................................ [[32mPASS[0m in 0.86s]
[0m13:18:24.964565 [debug] [Thread-1 (]: Finished running node test.my_dbt_trino_project.not_null_src_auth_events_ts.179fe664b6
[0m13:18:24.965100 [debug] [Thread-1 (]: Began running node test.my_dbt_trino_project.unique_src_auth_events_sessionId.86c4c7c26f
[0m13:18:24.965100 [info ] [Thread-1 (]: 6 of 7 START test unique_src_auth_events_sessionId ............................. [RUN]
[0m13:18:24.966129 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly test.my_dbt_trino_project.not_null_src_auth_events_ts.179fe664b6, now test.my_dbt_trino_project.unique_src_auth_events_sessionId.86c4c7c26f)
[0m13:18:24.966129 [debug] [Thread-1 (]: Began compiling node test.my_dbt_trino_project.unique_src_auth_events_sessionId.86c4c7c26f
[0m13:18:24.971483 [debug] [Thread-1 (]: Writing injected SQL for node "test.my_dbt_trino_project.unique_src_auth_events_sessionId.86c4c7c26f"
[0m13:18:24.972389 [debug] [Thread-1 (]: Began executing node test.my_dbt_trino_project.unique_src_auth_events_sessionId.86c4c7c26f
[0m13:18:24.974389 [debug] [Thread-1 (]: Writing runtime sql for node "test.my_dbt_trino_project.unique_src_auth_events_sessionId.86c4c7c26f"
[0m13:18:24.976390 [debug] [Thread-1 (]: Using trino connection "test.my_dbt_trino_project.unique_src_auth_events_sessionId.86c4c7c26f"
[0m13:18:24.977389 [debug] [Thread-1 (]: On test.my_dbt_trino_project.unique_src_auth_events_sessionId.86c4c7c26f: /* {"app": "dbt", "dbt_version": "1.8.2", "profile_name": "my_dbt_trino_project", "target_name": "dev", "node_id": "test.my_dbt_trino_project.unique_src_auth_events_sessionId.86c4c7c26f"} */
select
      count(*) as failures,
      count(*) != 0 as should_warn,
      count(*) != 0 as should_error
    from (
      
    
    

select
    sessionId as unique_field,
    count(*) as n_records

from "datalake"."analytics_source"."src_auth_events"
where sessionId is not null
group by sessionId
having count(*) > 1



      
    ) dbt_internal_test
[0m13:18:24.978390 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m13:18:25.310517 [debug] [Thread-1 (]: SQL status: SUCCESS in 0.0 seconds
[0m13:18:25.312085 [debug] [Thread-1 (]: On test.my_dbt_trino_project.unique_src_auth_events_sessionId.86c4c7c26f: ROLLBACK
[0m13:18:25.312604 [debug] [Thread-1 (]: On test.my_dbt_trino_project.unique_src_auth_events_sessionId.86c4c7c26f: Close
[0m13:18:25.313647 [error] [Thread-1 (]: 6 of 7 FAIL 13 unique_src_auth_events_sessionId ................................ [[31mFAIL 13[0m in 0.35s]
[0m13:18:25.314726 [debug] [Thread-1 (]: Finished running node test.my_dbt_trino_project.unique_src_auth_events_sessionId.86c4c7c26f
[0m13:18:25.315248 [debug] [Thread-1 (]: Began running node test.my_dbt_trino_project.unique_src_auth_events_userId.9244f51c84
[0m13:18:25.315803 [info ] [Thread-1 (]: 7 of 7 START test unique_src_auth_events_userId ................................ [RUN]
[0m13:18:25.316325 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly test.my_dbt_trino_project.unique_src_auth_events_sessionId.86c4c7c26f, now test.my_dbt_trino_project.unique_src_auth_events_userId.9244f51c84)
[0m13:18:25.316858 [debug] [Thread-1 (]: Began compiling node test.my_dbt_trino_project.unique_src_auth_events_userId.9244f51c84
[0m13:18:25.321041 [debug] [Thread-1 (]: Writing injected SQL for node "test.my_dbt_trino_project.unique_src_auth_events_userId.9244f51c84"
[0m13:18:25.322044 [debug] [Thread-1 (]: Began executing node test.my_dbt_trino_project.unique_src_auth_events_userId.9244f51c84
[0m13:18:25.324558 [debug] [Thread-1 (]: Writing runtime sql for node "test.my_dbt_trino_project.unique_src_auth_events_userId.9244f51c84"
[0m13:18:25.326552 [debug] [Thread-1 (]: Using trino connection "test.my_dbt_trino_project.unique_src_auth_events_userId.9244f51c84"
[0m13:18:25.327552 [debug] [Thread-1 (]: On test.my_dbt_trino_project.unique_src_auth_events_userId.9244f51c84: /* {"app": "dbt", "dbt_version": "1.8.2", "profile_name": "my_dbt_trino_project", "target_name": "dev", "node_id": "test.my_dbt_trino_project.unique_src_auth_events_userId.9244f51c84"} */
select
      count(*) as failures,
      count(*) != 0 as should_warn,
      count(*) != 0 as should_error
    from (
      
    
    

select
    userId as unique_field,
    count(*) as n_records

from "datalake"."analytics_source"."src_auth_events"
where userId is not null
group by userId
having count(*) > 1



      
    ) dbt_internal_test
[0m13:18:25.327552 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m13:18:25.660837 [debug] [Thread-1 (]: SQL status: SUCCESS in 0.0 seconds
[0m13:18:25.661924 [debug] [Thread-1 (]: On test.my_dbt_trino_project.unique_src_auth_events_userId.9244f51c84: ROLLBACK
[0m13:18:25.662443 [debug] [Thread-1 (]: On test.my_dbt_trino_project.unique_src_auth_events_userId.9244f51c84: Close
[0m13:18:25.663490 [error] [Thread-1 (]: 7 of 7 FAIL 6 unique_src_auth_events_userId .................................... [[31mFAIL 6[0m in 0.35s]
[0m13:18:25.664016 [debug] [Thread-1 (]: Finished running node test.my_dbt_trino_project.unique_src_auth_events_userId.9244f51c84
[0m13:18:25.665592 [debug] [MainThread]: On master: COMMIT
[0m13:18:25.666110 [debug] [MainThread]: Connection 'master' was properly closed.
[0m13:18:25.666110 [debug] [MainThread]: Connection 'list_datalake_analytics_stage' was properly closed.
[0m13:18:25.666646 [debug] [MainThread]: Connection 'test.my_dbt_trino_project.unique_src_auth_events_userId.9244f51c84' was properly closed.
[0m13:18:25.667177 [info ] [MainThread]: 
[0m13:18:25.667707 [info ] [MainThread]: Finished running 7 data tests in 0 hours 0 minutes and 4.41 seconds (4.41s).
[0m13:18:25.669801 [debug] [MainThread]: Command end result
[0m13:18:25.771630 [info ] [MainThread]: 
[0m13:18:25.771630 [info ] [MainThread]: [31mCompleted with 4 errors and 0 warnings:[0m
[0m13:18:25.772627 [info ] [MainThread]: 
[0m13:18:25.773628 [error] [MainThread]: [31mFailure in test accepted_values_src_auth_events_gender__F__M (models\source\schema.yml)[0m
[0m13:18:25.773628 [error] [MainThread]:   Got 1 result, configured to fail if != 0
[0m13:18:25.774951 [info ] [MainThread]: 
[0m13:18:25.775989 [info ] [MainThread]:   compiled code at target\compiled\my_dbt_trino_project\models\source\schema.yml\accepted_values_src_auth_events_gender__F__M.sql
[0m13:18:25.776526 [info ] [MainThread]: 
[0m13:18:25.777053 [error] [MainThread]:   Database Error in test accepted_values_src_auth_events_success__True__False (models\source\schema.yml)
  TrinoUserError(type=USER_ERROR, name=COLUMN_NOT_FOUND, message="line 14:9: Column 'success' cannot be resolved", query_id=20240618_035237_00078_z97n2)
  compiled Code at target\run\my_dbt_trino_project\models\source\schema.yml\accepted_values_src_auth_events_success__True__False.sql
[0m13:18:25.778107 [info ] [MainThread]: 
[0m13:18:25.779705 [error] [MainThread]: [31mFailure in test unique_src_auth_events_sessionId (models\source\schema.yml)[0m
[0m13:18:25.781035 [error] [MainThread]:   Got 13 results, configured to fail if != 0
[0m13:18:25.781560 [info ] [MainThread]: 
[0m13:18:25.782612 [info ] [MainThread]:   compiled code at target\compiled\my_dbt_trino_project\models\source\schema.yml\unique_src_auth_events_sessionId.sql
[0m13:18:25.783676 [info ] [MainThread]: 
[0m13:18:25.784850 [error] [MainThread]: [31mFailure in test unique_src_auth_events_userId (models\source\schema.yml)[0m
[0m13:18:25.785896 [error] [MainThread]:   Got 6 results, configured to fail if != 0
[0m13:18:25.786963 [info ] [MainThread]: 
[0m13:18:25.788036 [info ] [MainThread]:   compiled code at target\compiled\my_dbt_trino_project\models\source\schema.yml\unique_src_auth_events_userId.sql
[0m13:18:25.789127 [info ] [MainThread]: 
[0m13:18:25.789650 [info ] [MainThread]: Done. PASS=3 WARN=0 ERROR=4 SKIP=0 TOTAL=7
[0m13:18:25.792305 [debug] [MainThread]: Command `dbt test` failed at 13:18:25.791768 after 5.64 seconds
[0m13:18:25.792835 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000001A731C3F590>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000001A73878D550>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000001A73878C7D0>]}
[0m13:18:25.794847 [debug] [MainThread]: Flushing usage events
[0m13:18:26.124907 [debug] [MainThread]: Error sending anonymous usage statistics. Disabling tracking for this execution. If you wish to permanently disable tracking, see: https://docs.getdbt.com/reference/global-configs#send-anonymous-usage-stats.
[0m14:02:04.864678 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000002580112A610>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x00000258027F5250>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x0000025802844B50>]}


============================== 14:02:04.866679 | 0b7d3988-6dcc-433f-9e21-4fea37ce13b4 ==============================
[0m14:02:04.866679 [info ] [MainThread]: Running with dbt=1.8.2
[0m14:02:04.867678 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'indirect_selection': 'eager', 'write_json': 'True', 'log_cache_events': 'False', 'partial_parse': 'True', 'cache_selected_only': 'False', 'warn_error': 'None', 'fail_fast': 'False', 'profiles_dir': 'C:\\Users\\ASUS\\Desktop\\work\\Iceberg-Dbt-Trino-Hive-modern-open-source-data-stack-main\\dbt', 'log_path': 'C:\\Users\\ASUS\\Desktop\\work\\Iceberg-Dbt-Trino-Hive-modern-open-source-data-stack-main\\dbt\\logs', 'version_check': 'True', 'debug': 'False', 'use_colors': 'True', 'use_experimental_parser': 'False', 'no_print': 'None', 'quiet': 'False', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'static_parser': 'True', 'invocation_command': 'dbt run', 'introspect': 'True', 'target_path': 'None', 'log_format': 'default', 'send_anonymous_usage_stats': 'True'}
[0m14:02:05.157848 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': '0b7d3988-6dcc-433f-9e21-4fea37ce13b4', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x0000025802C49490>]}
[0m14:02:05.190903 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': '0b7d3988-6dcc-433f-9e21-4fea37ce13b4', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000002587F945750>]}
[0m14:02:05.190903 [info ] [MainThread]: Registered adapter: trino=1.8.0
[0m14:02:05.200907 [debug] [MainThread]: checksum: f0a141b9de567cb7f131613ba2682f40b3a1c6a157f81c6e5435862eff68f109, vars: {}, profile: , target: , version: 1.8.2
[0m14:02:05.352746 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 0 files changed.
[0m14:02:05.352746 [debug] [MainThread]: Partial parsing enabled, no changes found, skipping parsing
[0m14:02:05.380390 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': '0b7d3988-6dcc-433f-9e21-4fea37ce13b4', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x0000025802E0EC50>]}
[0m14:02:05.445425 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': '0b7d3988-6dcc-433f-9e21-4fea37ce13b4', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x0000025802D27E10>]}
[0m14:02:05.446425 [info ] [MainThread]: Found 15 models, 7 data tests, 3 sources, 559 macros
[0m14:02:05.446425 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '0b7d3988-6dcc-433f-9e21-4fea37ce13b4', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x0000025802F81C50>]}
[0m14:02:05.448425 [info ] [MainThread]: 
[0m14:02:05.448425 [debug] [MainThread]: Acquiring new trino connection 'master'
[0m14:02:05.452427 [debug] [ThreadPool]: Acquiring new trino connection 'list_datalake'
[0m14:02:05.509654 [debug] [ThreadPool]: Using trino connection "list_datalake"
[0m14:02:05.510654 [debug] [ThreadPool]: On list_datalake: /* {"app": "dbt", "dbt_version": "1.8.2", "profile_name": "my_dbt_trino_project", "target_name": "dev", "connection_name": "list_datalake"} */

    select schema_name
    from "datalake".INFORMATION_SCHEMA.schemata
[0m14:02:05.510654 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m14:02:05.570740 [debug] [ThreadPool]: SQL status: SUCCESS in 0.0 seconds
[0m14:02:05.571779 [debug] [ThreadPool]: On list_datalake: Close
[0m14:02:05.574928 [debug] [ThreadPool]: Using trino connection "list_datalake"
[0m14:02:05.575445 [debug] [ThreadPool]: On list_datalake: /* {"app": "dbt", "dbt_version": "1.8.2", "profile_name": "my_dbt_trino_project", "target_name": "dev", "connection_name": "list_datalake"} */

    select schema_name
    from "datalake".INFORMATION_SCHEMA.schemata
[0m14:02:05.575445 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m14:02:05.599125 [debug] [ThreadPool]: SQL status: SUCCESS in 0.0 seconds
[0m14:02:05.600731 [debug] [ThreadPool]: On list_datalake: Close
[0m14:02:05.605003 [debug] [ThreadPool]: Using trino connection "list_datalake"
[0m14:02:05.605528 [debug] [ThreadPool]: On list_datalake: /* {"app": "dbt", "dbt_version": "1.8.2", "profile_name": "my_dbt_trino_project", "target_name": "dev", "connection_name": "list_datalake"} */

    select schema_name
    from "datalake".INFORMATION_SCHEMA.schemata
[0m14:02:05.606054 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m14:02:05.632169 [debug] [ThreadPool]: SQL status: SUCCESS in 0.0 seconds
[0m14:02:05.633226 [debug] [ThreadPool]: On list_datalake: Close
[0m14:02:05.635357 [debug] [ThreadPool]: Acquiring new trino connection 'list_datalake_analytics'
[0m14:02:05.645170 [debug] [ThreadPool]: Using trino connection "list_datalake_analytics"
[0m14:02:05.646170 [debug] [ThreadPool]: On list_datalake_analytics: /* {"app": "dbt", "dbt_version": "1.8.2", "profile_name": "my_dbt_trino_project", "target_name": "dev", "connection_name": "list_datalake_analytics"} */
select
      t.table_catalog as database,
      t.table_name as name,
      t.table_schema as schema,
      case when mv.name is not null then 'materialized_view'
           when t.table_type = 'BASE TABLE' then 'table'
           when t.table_type = 'VIEW' then 'view'
           else t.table_type
      end as table_type
    from "datalake".INFORMATION_SCHEMA.tables t
    left join (
            select * from system.metadata.materialized_views
            where catalog_name = 'datalake'
              and schema_name = 'analytics') mv
          on mv.catalog_name = t.table_catalog and mv.schema_name = t.table_schema and mv.name = t.table_name
    where t.table_schema = 'analytics'
[0m14:02:05.646170 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m14:02:05.717550 [debug] [ThreadPool]: SQL status: SUCCESS in 0.0 seconds
[0m14:02:05.718590 [debug] [ThreadPool]: On list_datalake_analytics: ROLLBACK
[0m14:02:05.719126 [debug] [ThreadPool]: On list_datalake_analytics: Close
[0m14:02:05.719657 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_datalake_analytics, now list_datalake_analytics_source)
[0m14:02:05.723836 [debug] [ThreadPool]: Using trino connection "list_datalake_analytics_source"
[0m14:02:05.723836 [debug] [ThreadPool]: On list_datalake_analytics_source: /* {"app": "dbt", "dbt_version": "1.8.2", "profile_name": "my_dbt_trino_project", "target_name": "dev", "connection_name": "list_datalake_analytics_source"} */
select
      t.table_catalog as database,
      t.table_name as name,
      t.table_schema as schema,
      case when mv.name is not null then 'materialized_view'
           when t.table_type = 'BASE TABLE' then 'table'
           when t.table_type = 'VIEW' then 'view'
           else t.table_type
      end as table_type
    from "datalake".INFORMATION_SCHEMA.tables t
    left join (
            select * from system.metadata.materialized_views
            where catalog_name = 'datalake'
              and schema_name = 'analytics_source') mv
          on mv.catalog_name = t.table_catalog and mv.schema_name = t.table_schema and mv.name = t.table_name
    where t.table_schema = 'analytics_source'
[0m14:02:05.724362 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m14:02:05.781614 [debug] [ThreadPool]: SQL status: SUCCESS in 0.0 seconds
[0m14:02:05.782713 [debug] [ThreadPool]: On list_datalake_analytics_source: ROLLBACK
[0m14:02:05.783234 [debug] [ThreadPool]: On list_datalake_analytics_source: Close
[0m14:02:05.783761 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_datalake_analytics_source, now list_datalake_analytics_stage)
[0m14:02:05.788514 [debug] [ThreadPool]: Using trino connection "list_datalake_analytics_stage"
[0m14:02:05.788514 [debug] [ThreadPool]: On list_datalake_analytics_stage: /* {"app": "dbt", "dbt_version": "1.8.2", "profile_name": "my_dbt_trino_project", "target_name": "dev", "connection_name": "list_datalake_analytics_stage"} */
select
      t.table_catalog as database,
      t.table_name as name,
      t.table_schema as schema,
      case when mv.name is not null then 'materialized_view'
           when t.table_type = 'BASE TABLE' then 'table'
           when t.table_type = 'VIEW' then 'view'
           else t.table_type
      end as table_type
    from "datalake".INFORMATION_SCHEMA.tables t
    left join (
            select * from system.metadata.materialized_views
            where catalog_name = 'datalake'
              and schema_name = 'analytics_stage') mv
          on mv.catalog_name = t.table_catalog and mv.schema_name = t.table_schema and mv.name = t.table_name
    where t.table_schema = 'analytics_stage'
[0m14:02:05.789041 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m14:02:05.842112 [debug] [ThreadPool]: SQL status: SUCCESS in 0.0 seconds
[0m14:02:05.843660 [debug] [ThreadPool]: On list_datalake_analytics_stage: ROLLBACK
[0m14:02:05.844229 [debug] [ThreadPool]: On list_datalake_analytics_stage: Close
[0m14:02:05.845262 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '0b7d3988-6dcc-433f-9e21-4fea37ce13b4', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x0000025802B7DF90>]}
[0m14:02:05.845791 [debug] [MainThread]: On master: COMMIT
[0m14:02:05.846323 [info ] [MainThread]: Concurrency: 1 threads (target='dev')
[0m14:02:05.846856 [info ] [MainThread]: 
[0m14:02:05.849504 [debug] [Thread-1 (]: Began running node model.my_dbt_trino_project.src_auth_events
[0m14:02:05.850045 [info ] [Thread-1 (]: 1 of 15 START sql incremental model analytics_source.src_auth_events ........... [RUN]
[0m14:02:05.851124 [debug] [Thread-1 (]: Acquiring new trino connection 'model.my_dbt_trino_project.src_auth_events'
[0m14:02:05.851636 [debug] [Thread-1 (]: Began compiling node model.my_dbt_trino_project.src_auth_events
[0m14:02:05.858954 [debug] [Thread-1 (]: Writing injected SQL for node "model.my_dbt_trino_project.src_auth_events"
[0m14:02:05.860006 [debug] [Thread-1 (]: Began executing node model.my_dbt_trino_project.src_auth_events
[0m14:02:05.906029 [debug] [Thread-1 (]: Using trino connection "model.my_dbt_trino_project.src_auth_events"
[0m14:02:05.907028 [debug] [Thread-1 (]: On model.my_dbt_trino_project.src_auth_events: /* {"app": "dbt", "dbt_version": "1.8.2", "profile_name": "my_dbt_trino_project", "target_name": "dev", "node_id": "model.my_dbt_trino_project.src_auth_events"} */

  
    

    create table "datalake"."analytics_source"."src_auth_events__dbt_tmp"
      
      
    as (
      

with source as (
    select
        CAST(ts AS VARCHAR) as id, 
        ts,
        CAST(sessionId AS VARCHAR) as sessionId,
        level,
        itemInSession,
        city,
        zip,
        state,
        userAgent,
        CAST(NULLIF(lon, '') AS double) as lon,
        CAST(NULLIF(lat, '') AS double) as lat,
        CAST(FLOOR(CAST(NULLIF(userId, '') AS DOUBLE)) AS INT) as userId, 
        lastName,
        firstName,
        gender,
        CAST(FLOOR(CAST(NULLIF(registration, '') AS DOUBLE)) AS BIGINT) as registration,
        success
    from "oltp"."public"."auth_events"
)

select
    id,
    ts,
    sessionId,
    level,
    itemInSession,
    city,
    zip,
    state,
    userAgent,
    lon,
    lat,
    userId,
    lastName,
    firstName,
    gender,
    registration, 
    CASE 
        WHEN CAST(success AS VARCHAR) = 't' THEN true 
        WHEN CAST(success AS VARCHAR) = 'f' THEN false
        ELSE NULL 
    END AS success_boolean
from source


    where ts > (select max(ts) from "datalake"."analytics_source"."src_auth_events")

    )
[0m14:02:05.908027 [debug] [Thread-1 (]: Opening a new connection, currently in state init
[0m14:02:06.235514 [debug] [Thread-1 (]: SQL status: SUCCESS in 0.0 seconds
[0m14:02:06.243357 [debug] [Thread-1 (]: Using trino connection "model.my_dbt_trino_project.src_auth_events"
[0m14:02:06.243874 [debug] [Thread-1 (]: On model.my_dbt_trino_project.src_auth_events: /* {"app": "dbt", "dbt_version": "1.8.2", "profile_name": "my_dbt_trino_project", "target_name": "dev", "node_id": "model.my_dbt_trino_project.src_auth_events"} */

    describe "datalake"."analytics_source"."src_auth_events__dbt_tmp"
[0m14:02:06.382040 [debug] [Thread-1 (]: SQL status: SUCCESS in 0.0 seconds
[0m14:02:06.385702 [debug] [Thread-1 (]: Using trino connection "model.my_dbt_trino_project.src_auth_events"
[0m14:02:06.386212 [debug] [Thread-1 (]: On model.my_dbt_trino_project.src_auth_events: /* {"app": "dbt", "dbt_version": "1.8.2", "profile_name": "my_dbt_trino_project", "target_name": "dev", "node_id": "model.my_dbt_trino_project.src_auth_events"} */

    describe "datalake"."analytics_source"."src_auth_events"
[0m14:02:06.503249 [debug] [Thread-1 (]: SQL status: SUCCESS in 0.0 seconds
[0m14:02:06.510069 [debug] [Thread-1 (]: Using trino connection "model.my_dbt_trino_project.src_auth_events"
[0m14:02:06.510596 [debug] [Thread-1 (]: On model.my_dbt_trino_project.src_auth_events: /* {"app": "dbt", "dbt_version": "1.8.2", "profile_name": "my_dbt_trino_project", "target_name": "dev", "node_id": "model.my_dbt_trino_project.src_auth_events"} */

    describe "datalake"."analytics_source"."src_auth_events"
[0m14:02:06.617060 [debug] [Thread-1 (]: SQL status: SUCCESS in 0.0 seconds
[0m14:02:06.624822 [debug] [Thread-1 (]: Writing runtime sql for node "model.my_dbt_trino_project.src_auth_events"
[0m14:02:06.626900 [debug] [Thread-1 (]: Using trino connection "model.my_dbt_trino_project.src_auth_events"
[0m14:02:06.627414 [debug] [Thread-1 (]: On model.my_dbt_trino_project.src_auth_events: /* {"app": "dbt", "dbt_version": "1.8.2", "profile_name": "my_dbt_trino_project", "target_name": "dev", "node_id": "model.my_dbt_trino_project.src_auth_events"} */
insert into "datalake"."analytics_source"."src_auth_events" ("id", "ts", "sessionid", "level", "iteminsession", "city", "zip", "state", "useragent", "lon", "lat", "userid", "lastname", "firstname", "gender", "registration", "success_boolean")
    (
        select "id", "ts", "sessionid", "level", "iteminsession", "city", "zip", "state", "useragent", "lon", "lat", "userid", "lastname", "firstname", "gender", "registration", "success_boolean"
        from "datalake"."analytics_source"."src_auth_events__dbt_tmp"
    )
[0m14:02:06.767006 [debug] [Thread-1 (]: SQL status: SUCCESS in 0.0 seconds
[0m14:02:06.772702 [debug] [Thread-1 (]: Applying DROP to: "datalake"."analytics_source"."src_auth_events__dbt_tmp"
[0m14:02:06.774277 [debug] [Thread-1 (]: Using trino connection "model.my_dbt_trino_project.src_auth_events"
[0m14:02:06.774811 [debug] [Thread-1 (]: On model.my_dbt_trino_project.src_auth_events: /* {"app": "dbt", "dbt_version": "1.8.2", "profile_name": "my_dbt_trino_project", "target_name": "dev", "node_id": "model.my_dbt_trino_project.src_auth_events"} */

    drop table if exists "datalake"."analytics_source"."src_auth_events__dbt_tmp"
[0m14:02:06.927428 [debug] [Thread-1 (]: SQL status: SUCCESS in 0.0 seconds
[0m14:02:06.938369 [debug] [Thread-1 (]: On model.my_dbt_trino_project.src_auth_events: ROLLBACK
[0m14:02:06.938369 [debug] [Thread-1 (]: On model.my_dbt_trino_project.src_auth_events: Close
[0m14:02:06.939375 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '0b7d3988-6dcc-433f-9e21-4fea37ce13b4', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x0000025803647DD0>]}
[0m14:02:06.940405 [info ] [Thread-1 (]: 1 of 15 OK created sql incremental model analytics_source.src_auth_events ...... [[32mSUCCESS[0m in 1.09s]
[0m14:02:06.941410 [debug] [Thread-1 (]: Finished running node model.my_dbt_trino_project.src_auth_events
[0m14:02:06.941410 [debug] [Thread-1 (]: Began running node model.my_dbt_trino_project.src_listen_events
[0m14:02:06.941410 [info ] [Thread-1 (]: 2 of 15 START sql incremental model analytics_source.src_listen_events ......... [RUN]
[0m14:02:06.942916 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.my_dbt_trino_project.src_auth_events, now model.my_dbt_trino_project.src_listen_events)
[0m14:02:06.943923 [debug] [Thread-1 (]: Began compiling node model.my_dbt_trino_project.src_listen_events
[0m14:02:06.946922 [debug] [Thread-1 (]: Writing injected SQL for node "model.my_dbt_trino_project.src_listen_events"
[0m14:02:06.946922 [debug] [Thread-1 (]: Began executing node model.my_dbt_trino_project.src_listen_events
[0m14:02:06.953924 [debug] [Thread-1 (]: Using trino connection "model.my_dbt_trino_project.src_listen_events"
[0m14:02:06.953924 [debug] [Thread-1 (]: On model.my_dbt_trino_project.src_listen_events: /* {"app": "dbt", "dbt_version": "1.8.2", "profile_name": "my_dbt_trino_project", "target_name": "dev", "node_id": "model.my_dbt_trino_project.src_listen_events"} */

  
    

    create table "datalake"."analytics_source"."src_listen_events__dbt_tmp"
      
      
    as (
      

with source as (

    select
        CAST(_id AS VARCHAR) as id,
        artist,
        song,
        CAST(NULLIF(duration, '') AS DOUBLE) as duration,
        ts,
        sessionid,
        auth,
        level,
        CAST(NULLIF(itemInSession, '') AS INTEGER) as itemInSession,
        city,
        zip,
        state,
        country,
        userAgent,
        CAST(NULLIF(lon, '') AS DOUBLE) as lon,
        CAST(NULLIF(lat, '') AS DOUBLE) as lat,
        CAST(CAST(NULLIF(userId, '') AS DOUBLE) AS INTEGER) as userId,
 -- Assurez-vous que userId peut aussi être converti de cette manière.
        lastName,
        firstName,
        gender,
        CAST(CAST(NULLIF(registration, '') AS DOUBLE) AS BIGINT) as registration
    from "website"."demo"."listen_events"

)

select * from source



    -- this filter will only be applied on an incremental run
    where ts > (select max(ts) from "datalake"."analytics_source"."src_listen_events")


    )
[0m14:02:06.954925 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m14:02:07.174972 [debug] [Thread-1 (]: SQL status: SUCCESS in 0.0 seconds
[0m14:02:07.177597 [debug] [Thread-1 (]: Using trino connection "model.my_dbt_trino_project.src_listen_events"
[0m14:02:07.178129 [debug] [Thread-1 (]: On model.my_dbt_trino_project.src_listen_events: /* {"app": "dbt", "dbt_version": "1.8.2", "profile_name": "my_dbt_trino_project", "target_name": "dev", "node_id": "model.my_dbt_trino_project.src_listen_events"} */

    describe "datalake"."analytics_source"."src_listen_events__dbt_tmp"
[0m14:02:07.285957 [debug] [Thread-1 (]: SQL status: SUCCESS in 0.0 seconds
[0m14:02:07.289579 [debug] [Thread-1 (]: Using trino connection "model.my_dbt_trino_project.src_listen_events"
[0m14:02:07.290097 [debug] [Thread-1 (]: On model.my_dbt_trino_project.src_listen_events: /* {"app": "dbt", "dbt_version": "1.8.2", "profile_name": "my_dbt_trino_project", "target_name": "dev", "node_id": "model.my_dbt_trino_project.src_listen_events"} */

    describe "datalake"."analytics_source"."src_listen_events"
[0m14:02:07.385005 [debug] [Thread-1 (]: SQL status: SUCCESS in 0.0 seconds
[0m14:02:07.388705 [debug] [Thread-1 (]: Using trino connection "model.my_dbt_trino_project.src_listen_events"
[0m14:02:07.388705 [debug] [Thread-1 (]: On model.my_dbt_trino_project.src_listen_events: /* {"app": "dbt", "dbt_version": "1.8.2", "profile_name": "my_dbt_trino_project", "target_name": "dev", "node_id": "model.my_dbt_trino_project.src_listen_events"} */

    describe "datalake"."analytics_source"."src_listen_events"
[0m14:02:07.498936 [debug] [Thread-1 (]: SQL status: SUCCESS in 0.0 seconds
[0m14:02:07.501029 [debug] [Thread-1 (]: Writing runtime sql for node "model.my_dbt_trino_project.src_listen_events"
[0m14:02:07.503123 [debug] [Thread-1 (]: Using trino connection "model.my_dbt_trino_project.src_listen_events"
[0m14:02:07.503643 [debug] [Thread-1 (]: On model.my_dbt_trino_project.src_listen_events: /* {"app": "dbt", "dbt_version": "1.8.2", "profile_name": "my_dbt_trino_project", "target_name": "dev", "node_id": "model.my_dbt_trino_project.src_listen_events"} */
insert into "datalake"."analytics_source"."src_listen_events" ("id", "artist", "song", "duration", "ts", "sessionid", "auth", "level", "iteminsession", "city", "zip", "state", "country", "useragent", "lon", "lat", "userid", "lastname", "firstname", "gender", "registration")
    (
        select "id", "artist", "song", "duration", "ts", "sessionid", "auth", "level", "iteminsession", "city", "zip", "state", "country", "useragent", "lon", "lat", "userid", "lastname", "firstname", "gender", "registration"
        from "datalake"."analytics_source"."src_listen_events__dbt_tmp"
    )
[0m14:02:07.660508 [debug] [Thread-1 (]: SQL status: SUCCESS in 0.0 seconds
[0m14:02:07.663614 [debug] [Thread-1 (]: Applying DROP to: "datalake"."analytics_source"."src_listen_events__dbt_tmp"
[0m14:02:07.664132 [debug] [Thread-1 (]: Using trino connection "model.my_dbt_trino_project.src_listen_events"
[0m14:02:07.664650 [debug] [Thread-1 (]: On model.my_dbt_trino_project.src_listen_events: /* {"app": "dbt", "dbt_version": "1.8.2", "profile_name": "my_dbt_trino_project", "target_name": "dev", "node_id": "model.my_dbt_trino_project.src_listen_events"} */

    drop table if exists "datalake"."analytics_source"."src_listen_events__dbt_tmp"
[0m14:02:07.795441 [debug] [Thread-1 (]: SQL status: SUCCESS in 0.0 seconds
[0m14:02:07.796987 [debug] [Thread-1 (]: On model.my_dbt_trino_project.src_listen_events: ROLLBACK
[0m14:02:07.796987 [debug] [Thread-1 (]: On model.my_dbt_trino_project.src_listen_events: Close
[0m14:02:07.797995 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '0b7d3988-6dcc-433f-9e21-4fea37ce13b4', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x0000025802E3B350>]}
[0m14:02:07.797995 [info ] [Thread-1 (]: 2 of 15 OK created sql incremental model analytics_source.src_listen_events .... [[32mSUCCESS[0m in 0.86s]
[0m14:02:07.799433 [debug] [Thread-1 (]: Finished running node model.my_dbt_trino_project.src_listen_events
[0m14:02:07.799433 [debug] [Thread-1 (]: Began running node model.my_dbt_trino_project.src_page_view_events
[0m14:02:07.800439 [info ] [Thread-1 (]: 3 of 15 START sql incremental model analytics_source.src_page_view_events ...... [RUN]
[0m14:02:07.800439 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.my_dbt_trino_project.src_listen_events, now model.my_dbt_trino_project.src_page_view_events)
[0m14:02:07.801441 [debug] [Thread-1 (]: Began compiling node model.my_dbt_trino_project.src_page_view_events
[0m14:02:07.803546 [debug] [Thread-1 (]: Writing injected SQL for node "model.my_dbt_trino_project.src_page_view_events"
[0m14:02:07.804549 [debug] [Thread-1 (]: Began executing node model.my_dbt_trino_project.src_page_view_events
[0m14:02:07.809548 [debug] [Thread-1 (]: Using trino connection "model.my_dbt_trino_project.src_page_view_events"
[0m14:02:07.810547 [debug] [Thread-1 (]: On model.my_dbt_trino_project.src_page_view_events: /* {"app": "dbt", "dbt_version": "1.8.2", "profile_name": "my_dbt_trino_project", "target_name": "dev", "node_id": "model.my_dbt_trino_project.src_page_view_events"} */

  
    

    create table "datalake"."analytics_source"."src_page_view_events__dbt_tmp"
      
      
    as (
      

with source as (
    select
        CAST(_id AS VARCHAR) as id,
        ts,
        CAST(sessionId AS VARCHAR) as sessionId,
        page,
        auth,
        level,
        CAST(CAST(NULLIF(itemInSession, '') AS DOUBLE) AS INTEGER) as itemInSession, 
        city,
        zip,
        state,
        userAgent,
        CAST(NULLIF(lon, '') AS double) as lon,
        CAST(NULLIF(lat, '') AS double) as lat,
        CAST(CAST(NULLIF(userId, '') AS DOUBLE) AS INTEGER) as userId, 
        lastName,
        firstName,
        gender,
        CAST(CAST(NULLIF(registration, '') AS DOUBLE) AS BIGINT) as registration, 
        artist,
        song,
        CAST(NULLIF(duration, '') AS double) as duration
    from "website"."demo"."page_view_events"
)

select * from source


    where ts > (select max(ts) from "datalake"."analytics_source"."src_page_view_events")

    )
[0m14:02:07.810547 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m14:02:08.029472 [debug] [Thread-1 (]: SQL status: SUCCESS in 0.0 seconds
[0m14:02:08.034248 [debug] [Thread-1 (]: Using trino connection "model.my_dbt_trino_project.src_page_view_events"
[0m14:02:08.034774 [debug] [Thread-1 (]: On model.my_dbt_trino_project.src_page_view_events: /* {"app": "dbt", "dbt_version": "1.8.2", "profile_name": "my_dbt_trino_project", "target_name": "dev", "node_id": "model.my_dbt_trino_project.src_page_view_events"} */

    describe "datalake"."analytics_source"."src_page_view_events__dbt_tmp"
[0m14:02:08.134331 [debug] [Thread-1 (]: SQL status: SUCCESS in 0.0 seconds
[0m14:02:08.195798 [debug] [Thread-1 (]: Using trino connection "model.my_dbt_trino_project.src_page_view_events"
[0m14:02:08.195798 [debug] [Thread-1 (]: On model.my_dbt_trino_project.src_page_view_events: /* {"app": "dbt", "dbt_version": "1.8.2", "profile_name": "my_dbt_trino_project", "target_name": "dev", "node_id": "model.my_dbt_trino_project.src_page_view_events"} */

    describe "datalake"."analytics_source"."src_page_view_events"
[0m14:02:08.297252 [debug] [Thread-1 (]: SQL status: SUCCESS in 0.0 seconds
[0m14:02:08.300352 [debug] [Thread-1 (]: Using trino connection "model.my_dbt_trino_project.src_page_view_events"
[0m14:02:08.300874 [debug] [Thread-1 (]: On model.my_dbt_trino_project.src_page_view_events: /* {"app": "dbt", "dbt_version": "1.8.2", "profile_name": "my_dbt_trino_project", "target_name": "dev", "node_id": "model.my_dbt_trino_project.src_page_view_events"} */

    describe "datalake"."analytics_source"."src_page_view_events"
[0m14:02:08.400883 [debug] [Thread-1 (]: SQL status: SUCCESS in 0.0 seconds
[0m14:02:08.402973 [debug] [Thread-1 (]: Writing runtime sql for node "model.my_dbt_trino_project.src_page_view_events"
[0m14:02:08.404551 [debug] [Thread-1 (]: Using trino connection "model.my_dbt_trino_project.src_page_view_events"
[0m14:02:08.405076 [debug] [Thread-1 (]: On model.my_dbt_trino_project.src_page_view_events: /* {"app": "dbt", "dbt_version": "1.8.2", "profile_name": "my_dbt_trino_project", "target_name": "dev", "node_id": "model.my_dbt_trino_project.src_page_view_events"} */
insert into "datalake"."analytics_source"."src_page_view_events" ("id", "ts", "sessionid", "page", "auth", "level", "iteminsession", "city", "zip", "state", "useragent", "lon", "lat", "userid", "lastname", "firstname", "gender", "registration", "artist", "song", "duration")
    (
        select "id", "ts", "sessionid", "page", "auth", "level", "iteminsession", "city", "zip", "state", "useragent", "lon", "lat", "userid", "lastname", "firstname", "gender", "registration", "artist", "song", "duration"
        from "datalake"."analytics_source"."src_page_view_events__dbt_tmp"
    )
[0m14:02:08.558003 [debug] [Thread-1 (]: SQL status: SUCCESS in 0.0 seconds
[0m14:02:08.560651 [debug] [Thread-1 (]: Applying DROP to: "datalake"."analytics_source"."src_page_view_events__dbt_tmp"
[0m14:02:08.561186 [debug] [Thread-1 (]: Using trino connection "model.my_dbt_trino_project.src_page_view_events"
[0m14:02:08.561708 [debug] [Thread-1 (]: On model.my_dbt_trino_project.src_page_view_events: /* {"app": "dbt", "dbt_version": "1.8.2", "profile_name": "my_dbt_trino_project", "target_name": "dev", "node_id": "model.my_dbt_trino_project.src_page_view_events"} */

    drop table if exists "datalake"."analytics_source"."src_page_view_events__dbt_tmp"
[0m14:02:08.687008 [debug] [Thread-1 (]: SQL status: SUCCESS in 0.0 seconds
[0m14:02:08.688607 [debug] [Thread-1 (]: On model.my_dbt_trino_project.src_page_view_events: ROLLBACK
[0m14:02:08.689134 [debug] [Thread-1 (]: On model.my_dbt_trino_project.src_page_view_events: Close
[0m14:02:08.689680 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '0b7d3988-6dcc-433f-9e21-4fea37ce13b4', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x0000025803682090>]}
[0m14:02:08.690192 [info ] [Thread-1 (]: 3 of 15 OK created sql incremental model analytics_source.src_page_view_events . [[32mSUCCESS[0m in 0.89s]
[0m14:02:08.691241 [debug] [Thread-1 (]: Finished running node model.my_dbt_trino_project.src_page_view_events
[0m14:02:08.691782 [debug] [Thread-1 (]: Began running node model.my_dbt_trino_project.stg_user_level_by_gender
[0m14:02:08.692307 [info ] [Thread-1 (]: 4 of 15 START sql view model analytics_stage.stg_user_level_by_gender .......... [RUN]
[0m14:02:08.692845 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.my_dbt_trino_project.src_page_view_events, now model.my_dbt_trino_project.stg_user_level_by_gender)
[0m14:02:08.692845 [debug] [Thread-1 (]: Began compiling node model.my_dbt_trino_project.stg_user_level_by_gender
[0m14:02:08.695479 [debug] [Thread-1 (]: Writing injected SQL for node "model.my_dbt_trino_project.stg_user_level_by_gender"
[0m14:02:08.696005 [debug] [Thread-1 (]: Began executing node model.my_dbt_trino_project.stg_user_level_by_gender
[0m14:02:08.707602 [debug] [Thread-1 (]: Writing runtime sql for node "model.my_dbt_trino_project.stg_user_level_by_gender"
[0m14:02:08.710599 [debug] [Thread-1 (]: Using trino connection "model.my_dbt_trino_project.stg_user_level_by_gender"
[0m14:02:08.710599 [debug] [Thread-1 (]: On model.my_dbt_trino_project.stg_user_level_by_gender: /* {"app": "dbt", "dbt_version": "1.8.2", "profile_name": "my_dbt_trino_project", "target_name": "dev", "node_id": "model.my_dbt_trino_project.stg_user_level_by_gender"} */

  create or replace view
    "datalake"."analytics_stage"."stg_user_level_by_gender"
  security definer
  as
    

WITH user_subscriptions AS (
    SELECT
        gender,
        level, 
        COUNT(DISTINCT userId) AS user_count
    FROM "datalake"."analytics_source"."src_auth_events"
    WHERE gender IS NOT NULL AND level IS NOT NULL
    GROUP BY gender, level
)

SELECT
    gender,
    level,
    user_count
FROM user_subscriptions
  
[0m14:02:08.710599 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m14:02:08.807591 [debug] [Thread-1 (]: SQL status: SUCCESS in 0.0 seconds
[0m14:02:08.811304 [debug] [Thread-1 (]: On model.my_dbt_trino_project.stg_user_level_by_gender: ROLLBACK
[0m14:02:08.811304 [debug] [Thread-1 (]: On model.my_dbt_trino_project.stg_user_level_by_gender: Close
[0m14:02:08.812386 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '0b7d3988-6dcc-433f-9e21-4fea37ce13b4', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x0000025801BEC1D0>]}
[0m14:02:08.812914 [info ] [Thread-1 (]: 4 of 15 OK created sql view model analytics_stage.stg_user_level_by_gender ..... [[32mSUCCESS[0m in 0.12s]
[0m14:02:08.813440 [debug] [Thread-1 (]: Finished running node model.my_dbt_trino_project.stg_user_level_by_gender
[0m14:02:08.813961 [debug] [Thread-1 (]: Began running node model.my_dbt_trino_project.stg_streams_hourly
[0m14:02:08.814481 [info ] [Thread-1 (]: 5 of 15 START sql table model analytics_stage.stg_streams_hourly ............... [RUN]
[0m14:02:08.815531 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.my_dbt_trino_project.stg_user_level_by_gender, now model.my_dbt_trino_project.stg_streams_hourly)
[0m14:02:08.815531 [debug] [Thread-1 (]: Began compiling node model.my_dbt_trino_project.stg_streams_hourly
[0m14:02:08.818237 [debug] [Thread-1 (]: Writing injected SQL for node "model.my_dbt_trino_project.stg_streams_hourly"
[0m14:02:08.818237 [debug] [Thread-1 (]: Began executing node model.my_dbt_trino_project.stg_streams_hourly
[0m14:02:08.829458 [debug] [Thread-1 (]: Writing runtime sql for node "model.my_dbt_trino_project.stg_streams_hourly"
[0m14:02:08.832973 [debug] [Thread-1 (]: Using trino connection "model.my_dbt_trino_project.stg_streams_hourly"
[0m14:02:08.834379 [debug] [Thread-1 (]: On model.my_dbt_trino_project.stg_streams_hourly: /* {"app": "dbt", "dbt_version": "1.8.2", "profile_name": "my_dbt_trino_project", "target_name": "dev", "node_id": "model.my_dbt_trino_project.stg_streams_hourly"} */

  
    

    create table "datalake"."analytics_stage"."stg_streams_hourly__dbt_tmp"
      
      
    as (
      

SELECT
    DATE_FORMAT(FROM_UNIXTIME(ts), '%Y-%m-%d') AS stream_date, 
    DATE_FORMAT(FROM_UNIXTIME(ts), '%H') AS stream_hour,
    COUNT(*) AS total_streams
FROM "datalake"."analytics_source"."src_listen_events"
GROUP BY
    DATE_FORMAT(FROM_UNIXTIME(ts), '%Y-%m-%d'),
    DATE_FORMAT(FROM_UNIXTIME(ts), '%H')
    )
[0m14:02:08.834379 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m14:02:09.163034 [debug] [Thread-1 (]: SQL status: SUCCESS in 0.0 seconds
[0m14:02:09.170371 [debug] [Thread-1 (]: Using trino connection "model.my_dbt_trino_project.stg_streams_hourly"
[0m14:02:09.170893 [debug] [Thread-1 (]: On model.my_dbt_trino_project.stg_streams_hourly: /* {"app": "dbt", "dbt_version": "1.8.2", "profile_name": "my_dbt_trino_project", "target_name": "dev", "node_id": "model.my_dbt_trino_project.stg_streams_hourly"} */
alter table "datalake"."analytics_stage"."stg_streams_hourly" rename to "datalake"."analytics_stage"."stg_streams_hourly__dbt_backup"
[0m14:02:09.281653 [debug] [Thread-1 (]: SQL status: SUCCESS in 0.0 seconds
[0m14:02:09.284770 [debug] [Thread-1 (]: Using trino connection "model.my_dbt_trino_project.stg_streams_hourly"
[0m14:02:09.285288 [debug] [Thread-1 (]: On model.my_dbt_trino_project.stg_streams_hourly: /* {"app": "dbt", "dbt_version": "1.8.2", "profile_name": "my_dbt_trino_project", "target_name": "dev", "node_id": "model.my_dbt_trino_project.stg_streams_hourly"} */
alter table "datalake"."analytics_stage"."stg_streams_hourly__dbt_tmp" rename to "datalake"."analytics_stage"."stg_streams_hourly"
[0m14:02:09.402136 [debug] [Thread-1 (]: SQL status: SUCCESS in 0.0 seconds
[0m14:02:09.405257 [debug] [Thread-1 (]: Applying DROP to: "datalake"."analytics_stage"."stg_streams_hourly__dbt_backup"
[0m14:02:09.405777 [debug] [Thread-1 (]: Using trino connection "model.my_dbt_trino_project.stg_streams_hourly"
[0m14:02:09.406300 [debug] [Thread-1 (]: On model.my_dbt_trino_project.stg_streams_hourly: /* {"app": "dbt", "dbt_version": "1.8.2", "profile_name": "my_dbt_trino_project", "target_name": "dev", "node_id": "model.my_dbt_trino_project.stg_streams_hourly"} */

    drop table if exists "datalake"."analytics_stage"."stg_streams_hourly__dbt_backup"
[0m14:02:09.564926 [debug] [Thread-1 (]: SQL status: SUCCESS in 0.0 seconds
[0m14:02:09.566469 [debug] [Thread-1 (]: On model.my_dbt_trino_project.stg_streams_hourly: ROLLBACK
[0m14:02:09.566986 [debug] [Thread-1 (]: On model.my_dbt_trino_project.stg_streams_hourly: Close
[0m14:02:09.567502 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '0b7d3988-6dcc-433f-9e21-4fea37ce13b4', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x00000258031F4210>]}
[0m14:02:09.568016 [info ] [Thread-1 (]: 5 of 15 OK created sql table model analytics_stage.stg_streams_hourly .......... [[32mSUCCESS[0m in 0.75s]
[0m14:02:09.569056 [debug] [Thread-1 (]: Finished running node model.my_dbt_trino_project.stg_streams_hourly
[0m14:02:09.569570 [debug] [Thread-1 (]: Began running node model.my_dbt_trino_project.stg_top_songs_artists
[0m14:02:09.570087 [info ] [Thread-1 (]: 6 of 15 START sql view model analytics_stage.stg_top_songs_artists ............. [RUN]
[0m14:02:09.570605 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.my_dbt_trino_project.stg_streams_hourly, now model.my_dbt_trino_project.stg_top_songs_artists)
[0m14:02:09.570605 [debug] [Thread-1 (]: Began compiling node model.my_dbt_trino_project.stg_top_songs_artists
[0m14:02:09.573197 [debug] [Thread-1 (]: Writing injected SQL for node "model.my_dbt_trino_project.stg_top_songs_artists"
[0m14:02:09.573718 [debug] [Thread-1 (]: Began executing node model.my_dbt_trino_project.stg_top_songs_artists
[0m14:02:09.575723 [debug] [Thread-1 (]: Writing runtime sql for node "model.my_dbt_trino_project.stg_top_songs_artists"
[0m14:02:09.576723 [debug] [Thread-1 (]: Using trino connection "model.my_dbt_trino_project.stg_top_songs_artists"
[0m14:02:09.576723 [debug] [Thread-1 (]: On model.my_dbt_trino_project.stg_top_songs_artists: /* {"app": "dbt", "dbt_version": "1.8.2", "profile_name": "my_dbt_trino_project", "target_name": "dev", "node_id": "model.my_dbt_trino_project.stg_top_songs_artists"} */

  create or replace view
    "datalake"."analytics_stage"."stg_top_songs_artists"
  security definer
  as
    

WITH song_plays AS (
    SELECT
        artist,
        song,
        COUNT(*) AS play_count
    FROM "datalake"."analytics_source"."src_listen_events"
    GROUP BY artist, song
)

SELECT
    artist,
    song,
    play_count
FROM song_plays
ORDER BY play_count DESC
  
[0m14:02:09.578226 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m14:02:09.658138 [debug] [Thread-1 (]: SQL status: SUCCESS in 0.0 seconds
[0m14:02:09.660236 [debug] [Thread-1 (]: On model.my_dbt_trino_project.stg_top_songs_artists: ROLLBACK
[0m14:02:09.660758 [debug] [Thread-1 (]: On model.my_dbt_trino_project.stg_top_songs_artists: Close
[0m14:02:09.661290 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '0b7d3988-6dcc-433f-9e21-4fea37ce13b4', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x0000025801631690>]}
[0m14:02:09.661816 [info ] [Thread-1 (]: 6 of 15 OK created sql view model analytics_stage.stg_top_songs_artists ........ [[32mSUCCESS[0m in 0.09s]
[0m14:02:09.662854 [debug] [Thread-1 (]: Finished running node model.my_dbt_trino_project.stg_top_songs_artists
[0m14:02:09.662854 [debug] [Thread-1 (]: Began running node model.my_dbt_trino_project.stg_unique_users
[0m14:02:09.663886 [info ] [Thread-1 (]: 7 of 15 START sql view model analytics_stage.stg_unique_users .................. [RUN]
[0m14:02:09.664399 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.my_dbt_trino_project.stg_top_songs_artists, now model.my_dbt_trino_project.stg_unique_users)
[0m14:02:09.664399 [debug] [Thread-1 (]: Began compiling node model.my_dbt_trino_project.stg_unique_users
[0m14:02:09.667008 [debug] [Thread-1 (]: Writing injected SQL for node "model.my_dbt_trino_project.stg_unique_users"
[0m14:02:09.667523 [debug] [Thread-1 (]: Began executing node model.my_dbt_trino_project.stg_unique_users
[0m14:02:09.670115 [debug] [Thread-1 (]: Writing runtime sql for node "model.my_dbt_trino_project.stg_unique_users"
[0m14:02:09.671232 [debug] [Thread-1 (]: Using trino connection "model.my_dbt_trino_project.stg_unique_users"
[0m14:02:09.671232 [debug] [Thread-1 (]: On model.my_dbt_trino_project.stg_unique_users: /* {"app": "dbt", "dbt_version": "1.8.2", "profile_name": "my_dbt_trino_project", "target_name": "dev", "node_id": "model.my_dbt_trino_project.stg_unique_users"} */

  create or replace view
    "datalake"."analytics_stage"."stg_unique_users"
  security definer
  as
    

SELECT
    COUNT(DISTINCT userid) AS total_unique_users
FROM "datalake"."analytics_source"."src_listen_events"
WHERE userid IS NOT NULL
  
[0m14:02:09.672241 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m14:02:09.758969 [debug] [Thread-1 (]: SQL status: SUCCESS in 0.0 seconds
[0m14:02:09.760555 [debug] [Thread-1 (]: On model.my_dbt_trino_project.stg_unique_users: ROLLBACK
[0m14:02:09.761081 [debug] [Thread-1 (]: On model.my_dbt_trino_project.stg_unique_users: Close
[0m14:02:09.761607 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '0b7d3988-6dcc-433f-9e21-4fea37ce13b4', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x00000258021F5FD0>]}
[0m14:02:09.762654 [info ] [Thread-1 (]: 7 of 15 OK created sql view model analytics_stage.stg_unique_users ............. [[32mSUCCESS[0m in 0.10s]
[0m14:02:09.763714 [debug] [Thread-1 (]: Finished running node model.my_dbt_trino_project.stg_unique_users
[0m14:02:09.764255 [debug] [Thread-1 (]: Began running node model.my_dbt_trino_project.stg_user_activity_per_country
[0m14:02:09.764783 [info ] [Thread-1 (]: 8 of 15 START sql view model analytics_stage.stg_user_activity_per_country ..... [RUN]
[0m14:02:09.765304 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.my_dbt_trino_project.stg_unique_users, now model.my_dbt_trino_project.stg_user_activity_per_country)
[0m14:02:09.765835 [debug] [Thread-1 (]: Began compiling node model.my_dbt_trino_project.stg_user_activity_per_country
[0m14:02:09.767708 [debug] [Thread-1 (]: Writing injected SQL for node "model.my_dbt_trino_project.stg_user_activity_per_country"
[0m14:02:09.769110 [debug] [Thread-1 (]: Began executing node model.my_dbt_trino_project.stg_user_activity_per_country
[0m14:02:09.771581 [debug] [Thread-1 (]: Writing runtime sql for node "model.my_dbt_trino_project.stg_user_activity_per_country"
[0m14:02:09.773588 [debug] [Thread-1 (]: Using trino connection "model.my_dbt_trino_project.stg_user_activity_per_country"
[0m14:02:09.773588 [debug] [Thread-1 (]: On model.my_dbt_trino_project.stg_user_activity_per_country: /* {"app": "dbt", "dbt_version": "1.8.2", "profile_name": "my_dbt_trino_project", "target_name": "dev", "node_id": "model.my_dbt_trino_project.stg_user_activity_per_country"} */

  create or replace view
    "datalake"."analytics_stage"."stg_user_activity_per_country"
  security definer
  as
    

WITH combined_activities AS (
  SELECT
    country,
    'listen_event' AS event_type,
    ts,
    userid
  FROM "datalake"."analytics_source"."src_listen_events"
  WHERE country IS NOT NULL
  UNION ALL
  SELECT
    'Unknown' AS country, 
    ts,
    userid
  FROM "datalake"."analytics_source"."src_auth_events"
  UNION ALL
  SELECT
    'Unknown' AS country, 
    'page_view_event' AS event_type,
    ts,
    userid
  FROM "datalake"."analytics_source"."src_page_view_events"
)

SELECT
  country,
  COUNT(*) AS activity_count
FROM combined_activities
GROUP BY country
  
[0m14:02:09.774586 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m14:02:09.850071 [debug] [Thread-1 (]: Trino adapter: Trino query id: 20240618_043623_00137_z97n2
[0m14:02:09.850584 [debug] [Thread-1 (]: Trino adapter: Trino error: TrinoUserError(type=USER_ERROR, name=TYPE_MISMATCH, message="line 17:3: UNION query has different number of fields: 4, 3", query_id=20240618_043623_00137_z97n2)
[0m14:02:09.851107 [debug] [Thread-1 (]: On model.my_dbt_trino_project.stg_user_activity_per_country: ROLLBACK
[0m14:02:09.851628 [debug] [Thread-1 (]: On model.my_dbt_trino_project.stg_user_activity_per_country: Close
[0m14:02:09.856388 [debug] [Thread-1 (]: Database Error in model stg_user_activity_per_country (models\stage\stg_user_activity_per_country.sql)
  TrinoUserError(type=USER_ERROR, name=TYPE_MISMATCH, message="line 17:3: UNION query has different number of fields: 4, 3", query_id=20240618_043623_00137_z97n2)
  compiled Code at target\run\my_dbt_trino_project\models\stage\stg_user_activity_per_country.sql
[0m14:02:09.856919 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '0b7d3988-6dcc-433f-9e21-4fea37ce13b4', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000002580363FB10>]}
[0m14:02:09.857977 [error] [Thread-1 (]: 8 of 15 ERROR creating sql view model analytics_stage.stg_user_activity_per_country  [[31mERROR[0m in 0.09s]
[0m14:02:09.858519 [debug] [Thread-1 (]: Finished running node model.my_dbt_trino_project.stg_user_activity_per_country
[0m14:02:09.859041 [debug] [Thread-1 (]: Began running node model.my_dbt_trino_project.stg_user_activity_per_location
[0m14:02:09.859625 [info ] [Thread-1 (]: 9 of 15 START sql view model analytics_stage.stg_user_activity_per_location .... [RUN]
[0m14:02:09.860673 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.my_dbt_trino_project.stg_user_activity_per_country, now model.my_dbt_trino_project.stg_user_activity_per_location)
[0m14:02:09.860673 [debug] [Thread-1 (]: Began compiling node model.my_dbt_trino_project.stg_user_activity_per_location
[0m14:02:09.863682 [debug] [Thread-1 (]: Writing injected SQL for node "model.my_dbt_trino_project.stg_user_activity_per_location"
[0m14:02:09.864682 [debug] [Thread-1 (]: Began executing node model.my_dbt_trino_project.stg_user_activity_per_location
[0m14:02:09.866035 [debug] [Thread-1 (]: Writing runtime sql for node "model.my_dbt_trino_project.stg_user_activity_per_location"
[0m14:02:09.868758 [debug] [Thread-1 (]: Using trino connection "model.my_dbt_trino_project.stg_user_activity_per_location"
[0m14:02:09.868758 [debug] [Thread-1 (]: On model.my_dbt_trino_project.stg_user_activity_per_location: /* {"app": "dbt", "dbt_version": "1.8.2", "profile_name": "my_dbt_trino_project", "target_name": "dev", "node_id": "model.my_dbt_trino_project.stg_user_activity_per_location"} */

  create or replace view
    "datalake"."analytics_stage"."stg_user_activity_per_location"
  security definer
  as
    

WITH combined_activities AS (
  SELECT
    city,
    state,
    'auth_event' AS event_type,
    ts,
    userid
 FROM "datalake"."analytics_source"."src_auth_events"
  UNION ALL
  SELECT
    city,
    state,
    'listen_event' AS event_type,
    ts,
    userid
  FROM "datalake"."analytics_source"."src_listen_events"
  UNION ALL
  SELECT
    city,
    state,
    'page_view_event' AS event_type,
    ts,
    userid
  FROM "datalake"."analytics_source"."src_page_view_events"
)

SELECT
  state,
  city,
  COUNT(*) AS activity_count
FROM combined_activities
GROUP BY state, city
  
[0m14:02:09.868758 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m14:02:09.993859 [debug] [Thread-1 (]: SQL status: SUCCESS in 0.0 seconds
[0m14:02:09.995957 [debug] [Thread-1 (]: On model.my_dbt_trino_project.stg_user_activity_per_location: ROLLBACK
[0m14:02:09.996486 [debug] [Thread-1 (]: On model.my_dbt_trino_project.stg_user_activity_per_location: Close
[0m14:02:09.997014 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '0b7d3988-6dcc-433f-9e21-4fea37ce13b4', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x0000025802E28B90>]}
[0m14:02:09.997543 [info ] [Thread-1 (]: 9 of 15 OK created sql view model analytics_stage.stg_user_activity_per_location  [[32mSUCCESS[0m in 0.14s]
[0m14:02:09.998604 [debug] [Thread-1 (]: Finished running node model.my_dbt_trino_project.stg_user_activity_per_location
[0m14:02:09.999130 [debug] [Thread-1 (]: Began running node model.my_dbt_trino_project.mart_user_level_by_gender
[0m14:02:09.999659 [info ] [Thread-1 (]: 10 of 15 START sql table model analytics.mart_user_level_by_gender ............. [RUN]
[0m14:02:10.000187 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.my_dbt_trino_project.stg_user_activity_per_location, now model.my_dbt_trino_project.mart_user_level_by_gender)
[0m14:02:10.000187 [debug] [Thread-1 (]: Began compiling node model.my_dbt_trino_project.mart_user_level_by_gender
[0m14:02:10.002785 [debug] [Thread-1 (]: Writing injected SQL for node "model.my_dbt_trino_project.mart_user_level_by_gender"
[0m14:02:10.003784 [debug] [Thread-1 (]: Began executing node model.my_dbt_trino_project.mart_user_level_by_gender
[0m14:02:10.006180 [debug] [Thread-1 (]: Writing runtime sql for node "model.my_dbt_trino_project.mart_user_level_by_gender"
[0m14:02:10.008183 [debug] [Thread-1 (]: Using trino connection "model.my_dbt_trino_project.mart_user_level_by_gender"
[0m14:02:10.008183 [debug] [Thread-1 (]: On model.my_dbt_trino_project.mart_user_level_by_gender: /* {"app": "dbt", "dbt_version": "1.8.2", "profile_name": "my_dbt_trino_project", "target_name": "dev", "node_id": "model.my_dbt_trino_project.mart_user_level_by_gender"} */

  
    

    create table "datalake"."analytics"."mart_user_level_by_gender__dbt_tmp"
      
      
    as (
      

SELECT
    gender,
    level,
    SUM(user_count) AS total_users,
    ROUND(SUM(user_count) * 100.0 / SUM(SUM(user_count)) OVER (), 2) AS percentage_of_total_users
FROM "datalake"."analytics_stage"."stg_user_level_by_gender"
GROUP BY gender, level
    )
[0m14:02:10.008183 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m14:02:10.348992 [debug] [Thread-1 (]: SQL status: SUCCESS in 0.0 seconds
[0m14:02:10.352138 [debug] [Thread-1 (]: Using trino connection "model.my_dbt_trino_project.mart_user_level_by_gender"
[0m14:02:10.352656 [debug] [Thread-1 (]: On model.my_dbt_trino_project.mart_user_level_by_gender: /* {"app": "dbt", "dbt_version": "1.8.2", "profile_name": "my_dbt_trino_project", "target_name": "dev", "node_id": "model.my_dbt_trino_project.mart_user_level_by_gender"} */
alter table "datalake"."analytics"."mart_user_level_by_gender" rename to "datalake"."analytics"."mart_user_level_by_gender__dbt_backup"
[0m14:02:10.470137 [debug] [Thread-1 (]: SQL status: SUCCESS in 0.0 seconds
[0m14:02:10.473336 [debug] [Thread-1 (]: Using trino connection "model.my_dbt_trino_project.mart_user_level_by_gender"
[0m14:02:10.473869 [debug] [Thread-1 (]: On model.my_dbt_trino_project.mart_user_level_by_gender: /* {"app": "dbt", "dbt_version": "1.8.2", "profile_name": "my_dbt_trino_project", "target_name": "dev", "node_id": "model.my_dbt_trino_project.mart_user_level_by_gender"} */
alter table "datalake"."analytics"."mart_user_level_by_gender__dbt_tmp" rename to "datalake"."analytics"."mart_user_level_by_gender"
[0m14:02:10.539118 [debug] [Thread-1 (]: SQL status: SUCCESS in 0.0 seconds
[0m14:02:10.541724 [debug] [Thread-1 (]: Applying DROP to: "datalake"."analytics"."mart_user_level_by_gender__dbt_backup"
[0m14:02:10.542757 [debug] [Thread-1 (]: Using trino connection "model.my_dbt_trino_project.mart_user_level_by_gender"
[0m14:02:10.542757 [debug] [Thread-1 (]: On model.my_dbt_trino_project.mart_user_level_by_gender: /* {"app": "dbt", "dbt_version": "1.8.2", "profile_name": "my_dbt_trino_project", "target_name": "dev", "node_id": "model.my_dbt_trino_project.mart_user_level_by_gender"} */

    drop table if exists "datalake"."analytics"."mart_user_level_by_gender__dbt_backup"
[0m14:02:10.693149 [debug] [Thread-1 (]: SQL status: SUCCESS in 0.0 seconds
[0m14:02:10.694720 [debug] [Thread-1 (]: On model.my_dbt_trino_project.mart_user_level_by_gender: ROLLBACK
[0m14:02:10.695237 [debug] [Thread-1 (]: On model.my_dbt_trino_project.mart_user_level_by_gender: Close
[0m14:02:10.695749 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '0b7d3988-6dcc-433f-9e21-4fea37ce13b4', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000002580320EC10>]}
[0m14:02:10.696270 [info ] [Thread-1 (]: 10 of 15 OK created sql table model analytics.mart_user_level_by_gender ........ [[32mSUCCESS[0m in 0.70s]
[0m14:02:10.697330 [debug] [Thread-1 (]: Finished running node model.my_dbt_trino_project.mart_user_level_by_gender
[0m14:02:10.697849 [debug] [Thread-1 (]: Began running node model.my_dbt_trino_project.mart_hourly_stream_evolution
[0m14:02:10.698373 [info ] [Thread-1 (]: 11 of 15 START sql table model analytics.mart_hourly_stream_evolution .......... [RUN]
[0m14:02:10.698928 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.my_dbt_trino_project.mart_user_level_by_gender, now model.my_dbt_trino_project.mart_hourly_stream_evolution)
[0m14:02:10.698928 [debug] [Thread-1 (]: Began compiling node model.my_dbt_trino_project.mart_hourly_stream_evolution
[0m14:02:10.701537 [debug] [Thread-1 (]: Writing injected SQL for node "model.my_dbt_trino_project.mart_hourly_stream_evolution"
[0m14:02:10.701537 [debug] [Thread-1 (]: Began executing node model.my_dbt_trino_project.mart_hourly_stream_evolution
[0m14:02:10.707074 [debug] [Thread-1 (]: Writing runtime sql for node "model.my_dbt_trino_project.mart_hourly_stream_evolution"
[0m14:02:10.709077 [debug] [Thread-1 (]: Using trino connection "model.my_dbt_trino_project.mart_hourly_stream_evolution"
[0m14:02:10.709077 [debug] [Thread-1 (]: On model.my_dbt_trino_project.mart_hourly_stream_evolution: /* {"app": "dbt", "dbt_version": "1.8.2", "profile_name": "my_dbt_trino_project", "target_name": "dev", "node_id": "model.my_dbt_trino_project.mart_hourly_stream_evolution"} */

  
    

    create table "datalake"."analytics"."mart_hourly_stream_evolution__dbt_tmp"
      
      
    as (
      

SELECT
    stream_date,
    stream_hour,
    total_streams,
    SUM(total_streams) OVER (PARTITION BY stream_date ORDER BY stream_hour) AS cumulative_streams
FROM "datalake"."analytics_stage"."stg_streams_hourly"
ORDER BY
    stream_date,
    stream_hour
    )
[0m14:02:10.709077 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m14:02:11.032832 [debug] [Thread-1 (]: SQL status: SUCCESS in 0.0 seconds
[0m14:02:11.036076 [debug] [Thread-1 (]: Using trino connection "model.my_dbt_trino_project.mart_hourly_stream_evolution"
[0m14:02:11.036076 [debug] [Thread-1 (]: On model.my_dbt_trino_project.mart_hourly_stream_evolution: /* {"app": "dbt", "dbt_version": "1.8.2", "profile_name": "my_dbt_trino_project", "target_name": "dev", "node_id": "model.my_dbt_trino_project.mart_hourly_stream_evolution"} */
alter table "datalake"."analytics"."mart_hourly_stream_evolution" rename to "datalake"."analytics"."mart_hourly_stream_evolution__dbt_backup"
[0m14:02:11.152405 [debug] [Thread-1 (]: SQL status: SUCCESS in 0.0 seconds
[0m14:02:11.155051 [debug] [Thread-1 (]: Using trino connection "model.my_dbt_trino_project.mart_hourly_stream_evolution"
[0m14:02:11.155587 [debug] [Thread-1 (]: On model.my_dbt_trino_project.mart_hourly_stream_evolution: /* {"app": "dbt", "dbt_version": "1.8.2", "profile_name": "my_dbt_trino_project", "target_name": "dev", "node_id": "model.my_dbt_trino_project.mart_hourly_stream_evolution"} */
alter table "datalake"."analytics"."mart_hourly_stream_evolution__dbt_tmp" rename to "datalake"."analytics"."mart_hourly_stream_evolution"
[0m14:02:11.263977 [debug] [Thread-1 (]: SQL status: SUCCESS in 0.0 seconds
[0m14:02:11.266615 [debug] [Thread-1 (]: Applying DROP to: "datalake"."analytics"."mart_hourly_stream_evolution__dbt_backup"
[0m14:02:11.267693 [debug] [Thread-1 (]: Using trino connection "model.my_dbt_trino_project.mart_hourly_stream_evolution"
[0m14:02:11.267693 [debug] [Thread-1 (]: On model.my_dbt_trino_project.mart_hourly_stream_evolution: /* {"app": "dbt", "dbt_version": "1.8.2", "profile_name": "my_dbt_trino_project", "target_name": "dev", "node_id": "model.my_dbt_trino_project.mart_hourly_stream_evolution"} */

    drop table if exists "datalake"."analytics"."mart_hourly_stream_evolution__dbt_backup"
[0m14:02:11.445795 [debug] [Thread-1 (]: SQL status: SUCCESS in 0.0 seconds
[0m14:02:11.447399 [debug] [Thread-1 (]: On model.my_dbt_trino_project.mart_hourly_stream_evolution: ROLLBACK
[0m14:02:11.447956 [debug] [Thread-1 (]: On model.my_dbt_trino_project.mart_hourly_stream_evolution: Close
[0m14:02:11.448485 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '0b7d3988-6dcc-433f-9e21-4fea37ce13b4', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x0000025802850F90>]}
[0m14:02:11.449003 [info ] [Thread-1 (]: 11 of 15 OK created sql table model analytics.mart_hourly_stream_evolution ..... [[32mSUCCESS[0m in 0.75s]
[0m14:02:11.450049 [debug] [Thread-1 (]: Finished running node model.my_dbt_trino_project.mart_hourly_stream_evolution
[0m14:02:11.450570 [debug] [Thread-1 (]: Began running node model.my_dbt_trino_project.mart_top_songs_artists
[0m14:02:11.451094 [info ] [Thread-1 (]: 12 of 15 START sql table model analytics.mart_top_songs_artists ................ [RUN]
[0m14:02:11.451619 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.my_dbt_trino_project.mart_hourly_stream_evolution, now model.my_dbt_trino_project.mart_top_songs_artists)
[0m14:02:11.451619 [debug] [Thread-1 (]: Began compiling node model.my_dbt_trino_project.mart_top_songs_artists
[0m14:02:11.454783 [debug] [Thread-1 (]: Writing injected SQL for node "model.my_dbt_trino_project.mart_top_songs_artists"
[0m14:02:11.455317 [debug] [Thread-1 (]: Began executing node model.my_dbt_trino_project.mart_top_songs_artists
[0m14:02:11.457559 [debug] [Thread-1 (]: Writing runtime sql for node "model.my_dbt_trino_project.mart_top_songs_artists"
[0m14:02:11.459568 [debug] [Thread-1 (]: Using trino connection "model.my_dbt_trino_project.mart_top_songs_artists"
[0m14:02:11.459568 [debug] [Thread-1 (]: On model.my_dbt_trino_project.mart_top_songs_artists: /* {"app": "dbt", "dbt_version": "1.8.2", "profile_name": "my_dbt_trino_project", "target_name": "dev", "node_id": "model.my_dbt_trino_project.mart_top_songs_artists"} */

  
    

    create table "datalake"."analytics"."mart_top_songs_artists__dbt_tmp"
      
      
    as (
      

WITH top_songs AS (
    SELECT
        artist,
        song,
        play_count
    FROM "datalake"."analytics_stage"."stg_top_songs_artists"
)

SELECT
    artist,
    song,
    play_count
FROM top_songs
    )
[0m14:02:11.459568 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m14:02:11.752120 [debug] [Thread-1 (]: SQL status: SUCCESS in 0.0 seconds
[0m14:02:11.755269 [debug] [Thread-1 (]: Using trino connection "model.my_dbt_trino_project.mart_top_songs_artists"
[0m14:02:11.755799 [debug] [Thread-1 (]: On model.my_dbt_trino_project.mart_top_songs_artists: /* {"app": "dbt", "dbt_version": "1.8.2", "profile_name": "my_dbt_trino_project", "target_name": "dev", "node_id": "model.my_dbt_trino_project.mart_top_songs_artists"} */
alter table "datalake"."analytics"."mart_top_songs_artists" rename to "datalake"."analytics"."mart_top_songs_artists__dbt_backup"
[0m14:02:11.857669 [debug] [Thread-1 (]: SQL status: SUCCESS in 0.0 seconds
[0m14:02:11.860827 [debug] [Thread-1 (]: Using trino connection "model.my_dbt_trino_project.mart_top_songs_artists"
[0m14:02:11.861347 [debug] [Thread-1 (]: On model.my_dbt_trino_project.mart_top_songs_artists: /* {"app": "dbt", "dbt_version": "1.8.2", "profile_name": "my_dbt_trino_project", "target_name": "dev", "node_id": "model.my_dbt_trino_project.mart_top_songs_artists"} */
alter table "datalake"."analytics"."mart_top_songs_artists__dbt_tmp" rename to "datalake"."analytics"."mart_top_songs_artists"
[0m14:02:11.949930 [debug] [Thread-1 (]: SQL status: SUCCESS in 0.0 seconds
[0m14:02:11.953048 [debug] [Thread-1 (]: Applying DROP to: "datalake"."analytics"."mart_top_songs_artists__dbt_backup"
[0m14:02:11.953573 [debug] [Thread-1 (]: Using trino connection "model.my_dbt_trino_project.mart_top_songs_artists"
[0m14:02:11.954092 [debug] [Thread-1 (]: On model.my_dbt_trino_project.mart_top_songs_artists: /* {"app": "dbt", "dbt_version": "1.8.2", "profile_name": "my_dbt_trino_project", "target_name": "dev", "node_id": "model.my_dbt_trino_project.mart_top_songs_artists"} */

    drop table if exists "datalake"."analytics"."mart_top_songs_artists__dbt_backup"
[0m14:02:12.103314 [debug] [Thread-1 (]: SQL status: SUCCESS in 0.0 seconds
[0m14:02:12.104900 [debug] [Thread-1 (]: On model.my_dbt_trino_project.mart_top_songs_artists: ROLLBACK
[0m14:02:12.105427 [debug] [Thread-1 (]: On model.my_dbt_trino_project.mart_top_songs_artists: Close
[0m14:02:12.105947 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '0b7d3988-6dcc-433f-9e21-4fea37ce13b4', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000002580287A890>]}
[0m14:02:12.106481 [info ] [Thread-1 (]: 12 of 15 OK created sql table model analytics.mart_top_songs_artists ........... [[32mSUCCESS[0m in 0.65s]
[0m14:02:12.107014 [debug] [Thread-1 (]: Finished running node model.my_dbt_trino_project.mart_top_songs_artists
[0m14:02:12.107538 [debug] [Thread-1 (]: Began running node model.my_dbt_trino_project.mart_total_unique_users
[0m14:02:12.108078 [info ] [Thread-1 (]: 13 of 15 START sql table model analytics.mart_total_unique_users ............... [RUN]
[0m14:02:12.108601 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.my_dbt_trino_project.mart_top_songs_artists, now model.my_dbt_trino_project.mart_total_unique_users)
[0m14:02:12.109123 [debug] [Thread-1 (]: Began compiling node model.my_dbt_trino_project.mart_total_unique_users
[0m14:02:12.111744 [debug] [Thread-1 (]: Writing injected SQL for node "model.my_dbt_trino_project.mart_total_unique_users"
[0m14:02:12.112289 [debug] [Thread-1 (]: Began executing node model.my_dbt_trino_project.mart_total_unique_users
[0m14:02:12.117643 [debug] [Thread-1 (]: Writing runtime sql for node "model.my_dbt_trino_project.mart_total_unique_users"
[0m14:02:12.118729 [debug] [Thread-1 (]: Using trino connection "model.my_dbt_trino_project.mart_total_unique_users"
[0m14:02:12.118729 [debug] [Thread-1 (]: On model.my_dbt_trino_project.mart_total_unique_users: /* {"app": "dbt", "dbt_version": "1.8.2", "profile_name": "my_dbt_trino_project", "target_name": "dev", "node_id": "model.my_dbt_trino_project.mart_total_unique_users"} */

  
    

    create table "datalake"."analytics"."mart_total_unique_users__dbt_tmp"
      
      
    as (
      

SELECT
    total_unique_users
FROM "datalake"."analytics_stage"."stg_unique_users"
    )
[0m14:02:12.119725 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m14:02:12.379409 [debug] [Thread-1 (]: SQL status: SUCCESS in 0.0 seconds
[0m14:02:12.382551 [debug] [Thread-1 (]: Using trino connection "model.my_dbt_trino_project.mart_total_unique_users"
[0m14:02:12.383071 [debug] [Thread-1 (]: On model.my_dbt_trino_project.mart_total_unique_users: /* {"app": "dbt", "dbt_version": "1.8.2", "profile_name": "my_dbt_trino_project", "target_name": "dev", "node_id": "model.my_dbt_trino_project.mart_total_unique_users"} */
alter table "datalake"."analytics"."mart_total_unique_users" rename to "datalake"."analytics"."mart_total_unique_users__dbt_backup"
[0m14:02:12.475729 [debug] [Thread-1 (]: SQL status: SUCCESS in 0.0 seconds
[0m14:02:12.478906 [debug] [Thread-1 (]: Using trino connection "model.my_dbt_trino_project.mart_total_unique_users"
[0m14:02:12.478906 [debug] [Thread-1 (]: On model.my_dbt_trino_project.mart_total_unique_users: /* {"app": "dbt", "dbt_version": "1.8.2", "profile_name": "my_dbt_trino_project", "target_name": "dev", "node_id": "model.my_dbt_trino_project.mart_total_unique_users"} */
alter table "datalake"."analytics"."mart_total_unique_users__dbt_tmp" rename to "datalake"."analytics"."mart_total_unique_users"
[0m14:02:12.575797 [debug] [Thread-1 (]: SQL status: SUCCESS in 0.0 seconds
[0m14:02:12.578458 [debug] [Thread-1 (]: Applying DROP to: "datalake"."analytics"."mart_total_unique_users__dbt_backup"
[0m14:02:12.579561 [debug] [Thread-1 (]: Using trino connection "model.my_dbt_trino_project.mart_total_unique_users"
[0m14:02:12.580102 [debug] [Thread-1 (]: On model.my_dbt_trino_project.mart_total_unique_users: /* {"app": "dbt", "dbt_version": "1.8.2", "profile_name": "my_dbt_trino_project", "target_name": "dev", "node_id": "model.my_dbt_trino_project.mart_total_unique_users"} */

    drop table if exists "datalake"."analytics"."mart_total_unique_users__dbt_backup"
[0m14:02:12.722742 [debug] [Thread-1 (]: SQL status: SUCCESS in 0.0 seconds
[0m14:02:12.724335 [debug] [Thread-1 (]: On model.my_dbt_trino_project.mart_total_unique_users: ROLLBACK
[0m14:02:12.724856 [debug] [Thread-1 (]: On model.my_dbt_trino_project.mart_total_unique_users: Close
[0m14:02:12.725379 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '0b7d3988-6dcc-433f-9e21-4fea37ce13b4', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x0000025803675950>]}
[0m14:02:12.725901 [info ] [Thread-1 (]: 13 of 15 OK created sql table model analytics.mart_total_unique_users .......... [[32mSUCCESS[0m in 0.62s]
[0m14:02:12.726961 [debug] [Thread-1 (]: Finished running node model.my_dbt_trino_project.mart_total_unique_users
[0m14:02:12.726961 [debug] [Thread-1 (]: Began running node model.my_dbt_trino_project.mart_user_activity_per_country
[0m14:02:12.727493 [info ] [Thread-1 (]: 14 of 15 SKIP relation analytics.mart_user_activity_per_country ................ [[33mSKIP[0m]
[0m14:02:12.728019 [debug] [Thread-1 (]: Finished running node model.my_dbt_trino_project.mart_user_activity_per_country
[0m14:02:12.728540 [debug] [Thread-1 (]: Began running node model.my_dbt_trino_project.mart_user_activity_per_state
[0m14:02:12.729063 [info ] [Thread-1 (]: 15 of 15 START sql table model analytics.mart_user_activity_per_state .......... [RUN]
[0m14:02:12.729586 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.my_dbt_trino_project.mart_total_unique_users, now model.my_dbt_trino_project.mart_user_activity_per_state)
[0m14:02:12.730113 [debug] [Thread-1 (]: Began compiling node model.my_dbt_trino_project.mart_user_activity_per_state
[0m14:02:12.732755 [debug] [Thread-1 (]: Writing injected SQL for node "model.my_dbt_trino_project.mart_user_activity_per_state"
[0m14:02:12.733283 [debug] [Thread-1 (]: Began executing node model.my_dbt_trino_project.mart_user_activity_per_state
[0m14:02:12.735688 [debug] [Thread-1 (]: Writing runtime sql for node "model.my_dbt_trino_project.mart_user_activity_per_state"
[0m14:02:12.737695 [debug] [Thread-1 (]: Using trino connection "model.my_dbt_trino_project.mart_user_activity_per_state"
[0m14:02:12.737695 [debug] [Thread-1 (]: On model.my_dbt_trino_project.mart_user_activity_per_state: /* {"app": "dbt", "dbt_version": "1.8.2", "profile_name": "my_dbt_trino_project", "target_name": "dev", "node_id": "model.my_dbt_trino_project.mart_user_activity_per_state"} */

  
    

    create table "datalake"."analytics"."mart_user_activity_per_state__dbt_tmp"
      
      
    as (
      

SELECT
  state,
  city,
  SUM(activity_count) AS total_activity
FROM "datalake"."analytics_stage"."stg_user_activity_per_location"
GROUP BY state, city
ORDER BY state, SUM(activity_count) DESC
    )
[0m14:02:12.737695 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m14:02:13.067521 [debug] [Thread-1 (]: SQL status: SUCCESS in 0.0 seconds
[0m14:02:13.071231 [debug] [Thread-1 (]: Using trino connection "model.my_dbt_trino_project.mart_user_activity_per_state"
[0m14:02:13.071761 [debug] [Thread-1 (]: On model.my_dbt_trino_project.mart_user_activity_per_state: /* {"app": "dbt", "dbt_version": "1.8.2", "profile_name": "my_dbt_trino_project", "target_name": "dev", "node_id": "model.my_dbt_trino_project.mart_user_activity_per_state"} */
alter table "datalake"."analytics"."mart_user_activity_per_state" rename to "datalake"."analytics"."mart_user_activity_per_state__dbt_backup"
[0m14:02:13.174067 [debug] [Thread-1 (]: SQL status: SUCCESS in 0.0 seconds
[0m14:02:13.177252 [debug] [Thread-1 (]: Using trino connection "model.my_dbt_trino_project.mart_user_activity_per_state"
[0m14:02:13.178329 [debug] [Thread-1 (]: On model.my_dbt_trino_project.mart_user_activity_per_state: /* {"app": "dbt", "dbt_version": "1.8.2", "profile_name": "my_dbt_trino_project", "target_name": "dev", "node_id": "model.my_dbt_trino_project.mart_user_activity_per_state"} */
alter table "datalake"."analytics"."mart_user_activity_per_state__dbt_tmp" rename to "datalake"."analytics"."mart_user_activity_per_state"
[0m14:02:13.272898 [debug] [Thread-1 (]: SQL status: SUCCESS in 0.0 seconds
[0m14:02:13.277121 [debug] [Thread-1 (]: Applying DROP to: "datalake"."analytics"."mart_user_activity_per_state__dbt_backup"
[0m14:02:13.278190 [debug] [Thread-1 (]: Using trino connection "model.my_dbt_trino_project.mart_user_activity_per_state"
[0m14:02:13.279256 [debug] [Thread-1 (]: On model.my_dbt_trino_project.mart_user_activity_per_state: /* {"app": "dbt", "dbt_version": "1.8.2", "profile_name": "my_dbt_trino_project", "target_name": "dev", "node_id": "model.my_dbt_trino_project.mart_user_activity_per_state"} */

    drop table if exists "datalake"."analytics"."mart_user_activity_per_state__dbt_backup"
[0m14:02:13.435074 [debug] [Thread-1 (]: SQL status: SUCCESS in 0.0 seconds
[0m14:02:13.437239 [debug] [Thread-1 (]: On model.my_dbt_trino_project.mart_user_activity_per_state: ROLLBACK
[0m14:02:13.437745 [debug] [Thread-1 (]: On model.my_dbt_trino_project.mart_user_activity_per_state: Close
[0m14:02:13.438270 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '0b7d3988-6dcc-433f-9e21-4fea37ce13b4', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x0000025802E67BD0>]}
[0m14:02:13.439319 [info ] [Thread-1 (]: 15 of 15 OK created sql table model analytics.mart_user_activity_per_state ..... [[32mSUCCESS[0m in 0.71s]
[0m14:02:13.440362 [debug] [Thread-1 (]: Finished running node model.my_dbt_trino_project.mart_user_activity_per_state
[0m14:02:13.441418 [debug] [MainThread]: On master: COMMIT
[0m14:02:13.441957 [debug] [MainThread]: Connection 'master' was properly closed.
[0m14:02:13.442490 [debug] [MainThread]: Connection 'list_datalake' was properly closed.
[0m14:02:13.443022 [debug] [MainThread]: Connection 'list_datalake_analytics_stage' was properly closed.
[0m14:02:13.443022 [debug] [MainThread]: Connection 'model.my_dbt_trino_project.mart_user_activity_per_state' was properly closed.
[0m14:02:13.443551 [info ] [MainThread]: 
[0m14:02:13.444075 [info ] [MainThread]: Finished running 3 incremental models, 5 view models, 7 table models in 0 hours 0 minutes and 8.00 seconds (8.00s).
[0m14:02:13.446672 [debug] [MainThread]: Command end result
[0m14:02:13.498380 [info ] [MainThread]: 
[0m14:02:13.499900 [info ] [MainThread]: [31mCompleted with 1 error and 0 warnings:[0m
[0m14:02:13.500927 [info ] [MainThread]: 
[0m14:02:13.500927 [error] [MainThread]:   Database Error in model stg_user_activity_per_country (models\stage\stg_user_activity_per_country.sql)
  TrinoUserError(type=USER_ERROR, name=TYPE_MISMATCH, message="line 17:3: UNION query has different number of fields: 4, 3", query_id=20240618_043623_00137_z97n2)
  compiled Code at target\run\my_dbt_trino_project\models\stage\stg_user_activity_per_country.sql
[0m14:02:13.501921 [info ] [MainThread]: 
[0m14:02:13.502922 [info ] [MainThread]: Done. PASS=13 WARN=0 ERROR=1 SKIP=1 TOTAL=15
[0m14:02:13.504920 [debug] [MainThread]: Command `dbt run` failed at 14:02:13.504920 after 8.77 seconds
[0m14:02:13.505921 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000002587D87F590>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000002587D87F410>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x00000258015ED190>]}
[0m14:02:13.505921 [debug] [MainThread]: Flushing usage events
[0m14:03:02.048003 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000001F25A695F10>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000001F25A694DD0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000001F25A695DD0>]}


============================== 14:03:02.051008 | ff6e2e2c-a817-43ef-a463-d301d145a75f ==============================
[0m14:03:02.051008 [info ] [MainThread]: Running with dbt=1.8.2
[0m14:03:02.051008 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'indirect_selection': 'eager', 'log_cache_events': 'False', 'write_json': 'True', 'partial_parse': 'True', 'cache_selected_only': 'False', 'warn_error': 'None', 'version_check': 'True', 'fail_fast': 'False', 'log_path': 'C:\\Users\\ASUS\\Desktop\\work\\Iceberg-Dbt-Trino-Hive-modern-open-source-data-stack-main\\dbt\\logs', 'profiles_dir': 'C:\\Users\\ASUS\\Desktop\\work\\Iceberg-Dbt-Trino-Hive-modern-open-source-data-stack-main\\dbt', 'debug': 'False', 'use_colors': 'True', 'use_experimental_parser': 'False', 'no_print': 'None', 'quiet': 'False', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'static_parser': 'True', 'log_format': 'default', 'introspect': 'True', 'target_path': 'None', 'invocation_command': 'dbt run', 'send_anonymous_usage_stats': 'True'}
[0m14:03:02.385597 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': 'ff6e2e2c-a817-43ef-a463-d301d145a75f', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000001F25A9E5190>]}
[0m14:03:02.421530 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': 'ff6e2e2c-a817-43ef-a463-d301d145a75f', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000001F257815710>]}
[0m14:03:02.422529 [info ] [MainThread]: Registered adapter: trino=1.8.0
[0m14:03:02.433826 [debug] [MainThread]: checksum: f0a141b9de567cb7f131613ba2682f40b3a1c6a157f81c6e5435862eff68f109, vars: {}, profile: , target: , version: 1.8.2
[0m14:03:02.594308 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 1 files changed.
[0m14:03:02.595308 [debug] [MainThread]: Partial parsing: updated file: my_dbt_trino_project://models\source\src_auth_events.sql
[0m14:03:02.736351 [warn ] [MainThread]: [[33mWARNING[0m]: Deprecated functionality
The `tests` config has been renamed to `data_tests`. Please see
https://docs.getdbt.com/docs/build/data-tests#new-data_tests-syntax for more
information.
[0m14:03:02.737353 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'deprecation', 'label': 'ff6e2e2c-a817-43ef-a463-d301d145a75f', 'property_': 'warn', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000001F25AD9D610>]}
[0m14:03:02.889444 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': 'ff6e2e2c-a817-43ef-a463-d301d145a75f', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000001F25ABB05D0>]}
[0m14:03:02.953972 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': 'ff6e2e2c-a817-43ef-a463-d301d145a75f', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000001F25ACF0350>]}
[0m14:03:02.954971 [info ] [MainThread]: Found 15 models, 7 data tests, 3 sources, 559 macros
[0m14:03:02.954971 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': 'ff6e2e2c-a817-43ef-a463-d301d145a75f', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000001F25A697F50>]}
[0m14:03:02.956972 [info ] [MainThread]: 
[0m14:03:02.956972 [debug] [MainThread]: Acquiring new trino connection 'master'
[0m14:03:02.964531 [debug] [ThreadPool]: Acquiring new trino connection 'list_datalake'
[0m14:03:03.075110 [debug] [ThreadPool]: Using trino connection "list_datalake"
[0m14:03:03.076111 [debug] [ThreadPool]: On list_datalake: /* {"app": "dbt", "dbt_version": "1.8.2", "profile_name": "my_dbt_trino_project", "target_name": "dev", "connection_name": "list_datalake"} */

    select schema_name
    from "datalake".INFORMATION_SCHEMA.schemata
[0m14:03:03.076111 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m14:03:03.104995 [debug] [ThreadPool]: SQL status: SUCCESS in 0.0 seconds
[0m14:03:03.106039 [debug] [ThreadPool]: On list_datalake: Close
[0m14:03:03.109210 [debug] [ThreadPool]: Using trino connection "list_datalake"
[0m14:03:03.109730 [debug] [ThreadPool]: On list_datalake: /* {"app": "dbt", "dbt_version": "1.8.2", "profile_name": "my_dbt_trino_project", "target_name": "dev", "connection_name": "list_datalake"} */

    select schema_name
    from "datalake".INFORMATION_SCHEMA.schemata
[0m14:03:03.110248 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m14:03:03.132759 [debug] [ThreadPool]: SQL status: SUCCESS in 0.0 seconds
[0m14:03:03.134340 [debug] [ThreadPool]: On list_datalake: Close
[0m14:03:03.139984 [debug] [ThreadPool]: Using trino connection "list_datalake"
[0m14:03:03.140503 [debug] [ThreadPool]: On list_datalake: /* {"app": "dbt", "dbt_version": "1.8.2", "profile_name": "my_dbt_trino_project", "target_name": "dev", "connection_name": "list_datalake"} */

    select schema_name
    from "datalake".INFORMATION_SCHEMA.schemata
[0m14:03:03.141022 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m14:03:03.164217 [debug] [ThreadPool]: SQL status: SUCCESS in 0.0 seconds
[0m14:03:03.165264 [debug] [ThreadPool]: On list_datalake: Close
[0m14:03:03.167933 [debug] [ThreadPool]: Acquiring new trino connection 'list_datalake_analytics_source'
[0m14:03:03.180353 [debug] [ThreadPool]: Using trino connection "list_datalake_analytics_source"
[0m14:03:03.181352 [debug] [ThreadPool]: On list_datalake_analytics_source: /* {"app": "dbt", "dbt_version": "1.8.2", "profile_name": "my_dbt_trino_project", "target_name": "dev", "connection_name": "list_datalake_analytics_source"} */
select
      t.table_catalog as database,
      t.table_name as name,
      t.table_schema as schema,
      case when mv.name is not null then 'materialized_view'
           when t.table_type = 'BASE TABLE' then 'table'
           when t.table_type = 'VIEW' then 'view'
           else t.table_type
      end as table_type
    from "datalake".INFORMATION_SCHEMA.tables t
    left join (
            select * from system.metadata.materialized_views
            where catalog_name = 'datalake'
              and schema_name = 'analytics_source') mv
          on mv.catalog_name = t.table_catalog and mv.schema_name = t.table_schema and mv.name = t.table_name
    where t.table_schema = 'analytics_source'
[0m14:03:03.181352 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m14:03:03.258810 [debug] [ThreadPool]: SQL status: SUCCESS in 0.0 seconds
[0m14:03:03.260393 [debug] [ThreadPool]: On list_datalake_analytics_source: ROLLBACK
[0m14:03:03.260915 [debug] [ThreadPool]: On list_datalake_analytics_source: Close
[0m14:03:03.261958 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_datalake_analytics_source, now list_datalake_analytics)
[0m14:03:03.267334 [debug] [ThreadPool]: Using trino connection "list_datalake_analytics"
[0m14:03:03.267863 [debug] [ThreadPool]: On list_datalake_analytics: /* {"app": "dbt", "dbt_version": "1.8.2", "profile_name": "my_dbt_trino_project", "target_name": "dev", "connection_name": "list_datalake_analytics"} */
select
      t.table_catalog as database,
      t.table_name as name,
      t.table_schema as schema,
      case when mv.name is not null then 'materialized_view'
           when t.table_type = 'BASE TABLE' then 'table'
           when t.table_type = 'VIEW' then 'view'
           else t.table_type
      end as table_type
    from "datalake".INFORMATION_SCHEMA.tables t
    left join (
            select * from system.metadata.materialized_views
            where catalog_name = 'datalake'
              and schema_name = 'analytics') mv
          on mv.catalog_name = t.table_catalog and mv.schema_name = t.table_schema and mv.name = t.table_name
    where t.table_schema = 'analytics'
[0m14:03:03.268384 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m14:03:03.333932 [debug] [ThreadPool]: SQL status: SUCCESS in 0.0 seconds
[0m14:03:03.334937 [debug] [ThreadPool]: On list_datalake_analytics: ROLLBACK
[0m14:03:03.335950 [debug] [ThreadPool]: On list_datalake_analytics: Close
[0m14:03:03.335950 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_datalake_analytics, now list_datalake_analytics_stage)
[0m14:03:03.341622 [debug] [ThreadPool]: Using trino connection "list_datalake_analytics_stage"
[0m14:03:03.341622 [debug] [ThreadPool]: On list_datalake_analytics_stage: /* {"app": "dbt", "dbt_version": "1.8.2", "profile_name": "my_dbt_trino_project", "target_name": "dev", "connection_name": "list_datalake_analytics_stage"} */
select
      t.table_catalog as database,
      t.table_name as name,
      t.table_schema as schema,
      case when mv.name is not null then 'materialized_view'
           when t.table_type = 'BASE TABLE' then 'table'
           when t.table_type = 'VIEW' then 'view'
           else t.table_type
      end as table_type
    from "datalake".INFORMATION_SCHEMA.tables t
    left join (
            select * from system.metadata.materialized_views
            where catalog_name = 'datalake'
              and schema_name = 'analytics_stage') mv
          on mv.catalog_name = t.table_catalog and mv.schema_name = t.table_schema and mv.name = t.table_name
    where t.table_schema = 'analytics_stage'
[0m14:03:03.342631 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m14:03:03.414524 [debug] [ThreadPool]: SQL status: SUCCESS in 0.0 seconds
[0m14:03:03.415585 [debug] [ThreadPool]: On list_datalake_analytics_stage: ROLLBACK
[0m14:03:03.416112 [debug] [ThreadPool]: On list_datalake_analytics_stage: Close
[0m14:03:03.417702 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': 'ff6e2e2c-a817-43ef-a463-d301d145a75f', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000001F25C2FE410>]}
[0m14:03:03.418240 [debug] [MainThread]: On master: COMMIT
[0m14:03:03.418764 [info ] [MainThread]: Concurrency: 1 threads (target='dev')
[0m14:03:03.419448 [info ] [MainThread]: 
[0m14:03:03.422653 [debug] [Thread-1 (]: Began running node model.my_dbt_trino_project.src_auth_events
[0m14:03:03.423194 [info ] [Thread-1 (]: 1 of 15 START sql table model analytics_source.src_auth_events ................. [RUN]
[0m14:03:03.424260 [debug] [Thread-1 (]: Acquiring new trino connection 'model.my_dbt_trino_project.src_auth_events'
[0m14:03:03.424775 [debug] [Thread-1 (]: Began compiling node model.my_dbt_trino_project.src_auth_events
[0m14:03:03.432186 [debug] [Thread-1 (]: Writing injected SQL for node "model.my_dbt_trino_project.src_auth_events"
[0m14:03:03.433746 [debug] [Thread-1 (]: Began executing node model.my_dbt_trino_project.src_auth_events
[0m14:03:03.473746 [debug] [Thread-1 (]: Writing runtime sql for node "model.my_dbt_trino_project.src_auth_events"
[0m14:03:03.477985 [debug] [Thread-1 (]: Using trino connection "model.my_dbt_trino_project.src_auth_events"
[0m14:03:03.478521 [debug] [Thread-1 (]: On model.my_dbt_trino_project.src_auth_events: /* {"app": "dbt", "dbt_version": "1.8.2", "profile_name": "my_dbt_trino_project", "target_name": "dev", "node_id": "model.my_dbt_trino_project.src_auth_events"} */

  
    

    create table "datalake"."analytics_source"."src_auth_events__dbt_tmp"
      
      
    as (
      

with source as (
    select
        CAST(ts AS VARCHAR) as id, 
        ts,
        CAST(sessionId AS VARCHAR) as sessionId,
        level,
        itemInSession,
        city,
        zip,
        state,
        userAgent,
        CAST(NULLIF(lon, '') AS double) as lon,
        CAST(NULLIF(lat, '') AS double) as lat,
        CAST(FLOOR(CAST(NULLIF(userId, '') AS DOUBLE)) AS INT) as userId, 
        lastName,
        firstName,
        gender,
        CAST(FLOOR(CAST(NULLIF(registration, '') AS DOUBLE)) AS BIGINT) as registration,
        success
    from "oltp"."public"."auth_events"
)

select
    id,
    ts,
    sessionId,
    level,
    itemInSession,
    city,
    zip,
    state,
    userAgent,
    lon,
    lat,
    userId,
    lastName,
    firstName,
    gender,
    registration, 
    CASE 
        WHEN CAST(success AS VARCHAR) = 't' THEN true 
        WHEN CAST(success AS VARCHAR) = 'f' THEN false
        ELSE NULL 
    END AS success_boolean
from source


    )
[0m14:03:03.479579 [debug] [Thread-1 (]: Opening a new connection, currently in state init
[0m14:03:03.801693 [debug] [Thread-1 (]: SQL status: SUCCESS in 0.0 seconds
[0m14:03:03.808482 [debug] [Thread-1 (]: Using trino connection "model.my_dbt_trino_project.src_auth_events"
[0m14:03:03.809014 [debug] [Thread-1 (]: On model.my_dbt_trino_project.src_auth_events: /* {"app": "dbt", "dbt_version": "1.8.2", "profile_name": "my_dbt_trino_project", "target_name": "dev", "node_id": "model.my_dbt_trino_project.src_auth_events"} */
alter table "datalake"."analytics_source"."src_auth_events" rename to "datalake"."analytics_source"."src_auth_events__dbt_backup"
[0m14:03:03.892807 [debug] [Thread-1 (]: SQL status: SUCCESS in 0.0 seconds
[0m14:03:03.895992 [debug] [Thread-1 (]: Using trino connection "model.my_dbt_trino_project.src_auth_events"
[0m14:03:03.896519 [debug] [Thread-1 (]: On model.my_dbt_trino_project.src_auth_events: /* {"app": "dbt", "dbt_version": "1.8.2", "profile_name": "my_dbt_trino_project", "target_name": "dev", "node_id": "model.my_dbt_trino_project.src_auth_events"} */
alter table "datalake"."analytics_source"."src_auth_events__dbt_tmp" rename to "datalake"."analytics_source"."src_auth_events"
[0m14:03:03.984123 [debug] [Thread-1 (]: SQL status: SUCCESS in 0.0 seconds
[0m14:03:03.989897 [debug] [Thread-1 (]: Applying DROP to: "datalake"."analytics_source"."src_auth_events__dbt_backup"
[0m14:03:03.991977 [debug] [Thread-1 (]: Using trino connection "model.my_dbt_trino_project.src_auth_events"
[0m14:03:03.991977 [debug] [Thread-1 (]: On model.my_dbt_trino_project.src_auth_events: /* {"app": "dbt", "dbt_version": "1.8.2", "profile_name": "my_dbt_trino_project", "target_name": "dev", "node_id": "model.my_dbt_trino_project.src_auth_events"} */

    drop table if exists "datalake"."analytics_source"."src_auth_events__dbt_backup"
[0m14:03:04.115296 [debug] [Thread-1 (]: SQL status: SUCCESS in 0.0 seconds
[0m14:03:04.127548 [debug] [Thread-1 (]: On model.my_dbt_trino_project.src_auth_events: ROLLBACK
[0m14:03:04.128552 [debug] [Thread-1 (]: On model.my_dbt_trino_project.src_auth_events: Close
[0m14:03:04.129716 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'ff6e2e2c-a817-43ef-a463-d301d145a75f', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000001F25BF39690>]}
[0m14:03:04.129716 [info ] [Thread-1 (]: 1 of 15 OK created sql table model analytics_source.src_auth_events ............ [[32mSUCCESS[0m in 0.70s]
[0m14:03:04.130724 [debug] [Thread-1 (]: Finished running node model.my_dbt_trino_project.src_auth_events
[0m14:03:04.130724 [debug] [Thread-1 (]: Began running node model.my_dbt_trino_project.src_listen_events
[0m14:03:04.131723 [info ] [Thread-1 (]: 2 of 15 START sql incremental model analytics_source.src_listen_events ......... [RUN]
[0m14:03:04.132722 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.my_dbt_trino_project.src_auth_events, now model.my_dbt_trino_project.src_listen_events)
[0m14:03:04.132722 [debug] [Thread-1 (]: Began compiling node model.my_dbt_trino_project.src_listen_events
[0m14:03:04.136857 [debug] [Thread-1 (]: Writing injected SQL for node "model.my_dbt_trino_project.src_listen_events"
[0m14:03:04.136857 [debug] [Thread-1 (]: Began executing node model.my_dbt_trino_project.src_listen_events
[0m14:03:04.167358 [debug] [Thread-1 (]: Using trino connection "model.my_dbt_trino_project.src_listen_events"
[0m14:03:04.167358 [debug] [Thread-1 (]: On model.my_dbt_trino_project.src_listen_events: /* {"app": "dbt", "dbt_version": "1.8.2", "profile_name": "my_dbt_trino_project", "target_name": "dev", "node_id": "model.my_dbt_trino_project.src_listen_events"} */

  
    

    create table "datalake"."analytics_source"."src_listen_events__dbt_tmp"
      
      
    as (
      

with source as (

    select
        CAST(_id AS VARCHAR) as id,
        artist,
        song,
        CAST(NULLIF(duration, '') AS DOUBLE) as duration,
        ts,
        sessionid,
        auth,
        level,
        CAST(NULLIF(itemInSession, '') AS INTEGER) as itemInSession,
        city,
        zip,
        state,
        country,
        userAgent,
        CAST(NULLIF(lon, '') AS DOUBLE) as lon,
        CAST(NULLIF(lat, '') AS DOUBLE) as lat,
        CAST(CAST(NULLIF(userId, '') AS DOUBLE) AS INTEGER) as userId,
 -- Assurez-vous que userId peut aussi être converti de cette manière.
        lastName,
        firstName,
        gender,
        CAST(CAST(NULLIF(registration, '') AS DOUBLE) AS BIGINT) as registration
    from "website"."demo"."listen_events"

)

select * from source



    -- this filter will only be applied on an incremental run
    where ts > (select max(ts) from "datalake"."analytics_source"."src_listen_events")


    )
[0m14:03:04.168363 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m14:03:04.329423 [debug] [Thread-1 (]: SQL status: SUCCESS in 0.0 seconds
[0m14:03:04.336824 [debug] [Thread-1 (]: Using trino connection "model.my_dbt_trino_project.src_listen_events"
[0m14:03:04.337355 [debug] [Thread-1 (]: On model.my_dbt_trino_project.src_listen_events: /* {"app": "dbt", "dbt_version": "1.8.2", "profile_name": "my_dbt_trino_project", "target_name": "dev", "node_id": "model.my_dbt_trino_project.src_listen_events"} */

    describe "datalake"."analytics_source"."src_listen_events__dbt_tmp"
[0m14:03:04.424741 [debug] [Thread-1 (]: SQL status: SUCCESS in 0.0 seconds
[0m14:03:04.428508 [debug] [Thread-1 (]: Using trino connection "model.my_dbt_trino_project.src_listen_events"
[0m14:03:04.429044 [debug] [Thread-1 (]: On model.my_dbt_trino_project.src_listen_events: /* {"app": "dbt", "dbt_version": "1.8.2", "profile_name": "my_dbt_trino_project", "target_name": "dev", "node_id": "model.my_dbt_trino_project.src_listen_events"} */

    describe "datalake"."analytics_source"."src_listen_events"
[0m14:03:04.514043 [debug] [Thread-1 (]: SQL status: SUCCESS in 0.0 seconds
[0m14:03:04.520387 [debug] [Thread-1 (]: Using trino connection "model.my_dbt_trino_project.src_listen_events"
[0m14:03:04.520913 [debug] [Thread-1 (]: On model.my_dbt_trino_project.src_listen_events: /* {"app": "dbt", "dbt_version": "1.8.2", "profile_name": "my_dbt_trino_project", "target_name": "dev", "node_id": "model.my_dbt_trino_project.src_listen_events"} */

    describe "datalake"."analytics_source"."src_listen_events"
[0m14:03:04.609412 [debug] [Thread-1 (]: SQL status: SUCCESS in 0.0 seconds
[0m14:03:04.617359 [debug] [Thread-1 (]: Writing runtime sql for node "model.my_dbt_trino_project.src_listen_events"
[0m14:03:04.620005 [debug] [Thread-1 (]: Using trino connection "model.my_dbt_trino_project.src_listen_events"
[0m14:03:04.620541 [debug] [Thread-1 (]: On model.my_dbt_trino_project.src_listen_events: /* {"app": "dbt", "dbt_version": "1.8.2", "profile_name": "my_dbt_trino_project", "target_name": "dev", "node_id": "model.my_dbt_trino_project.src_listen_events"} */
insert into "datalake"."analytics_source"."src_listen_events" ("id", "artist", "song", "duration", "ts", "sessionid", "auth", "level", "iteminsession", "city", "zip", "state", "country", "useragent", "lon", "lat", "userid", "lastname", "firstname", "gender", "registration")
    (
        select "id", "artist", "song", "duration", "ts", "sessionid", "auth", "level", "iteminsession", "city", "zip", "state", "country", "useragent", "lon", "lat", "userid", "lastname", "firstname", "gender", "registration"
        from "datalake"."analytics_source"."src_listen_events__dbt_tmp"
    )
[0m14:03:04.736237 [debug] [Thread-1 (]: SQL status: SUCCESS in 0.0 seconds
[0m14:03:04.738841 [debug] [Thread-1 (]: Applying DROP to: "datalake"."analytics_source"."src_listen_events__dbt_tmp"
[0m14:03:04.739359 [debug] [Thread-1 (]: Using trino connection "model.my_dbt_trino_project.src_listen_events"
[0m14:03:04.739871 [debug] [Thread-1 (]: On model.my_dbt_trino_project.src_listen_events: /* {"app": "dbt", "dbt_version": "1.8.2", "profile_name": "my_dbt_trino_project", "target_name": "dev", "node_id": "model.my_dbt_trino_project.src_listen_events"} */

    drop table if exists "datalake"."analytics_source"."src_listen_events__dbt_tmp"
[0m14:03:04.833673 [debug] [Thread-1 (]: SQL status: SUCCESS in 0.0 seconds
[0m14:03:04.835683 [debug] [Thread-1 (]: On model.my_dbt_trino_project.src_listen_events: ROLLBACK
[0m14:03:04.835683 [debug] [Thread-1 (]: On model.my_dbt_trino_project.src_listen_events: Close
[0m14:03:04.835683 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'ff6e2e2c-a817-43ef-a463-d301d145a75f', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000001F25AD7ABD0>]}
[0m14:03:04.836680 [info ] [Thread-1 (]: 2 of 15 OK created sql incremental model analytics_source.src_listen_events .... [[32mSUCCESS[0m in 0.70s]
[0m14:03:04.837679 [debug] [Thread-1 (]: Finished running node model.my_dbt_trino_project.src_listen_events
[0m14:03:04.837679 [debug] [Thread-1 (]: Began running node model.my_dbt_trino_project.src_page_view_events
[0m14:03:04.838679 [info ] [Thread-1 (]: 3 of 15 START sql incremental model analytics_source.src_page_view_events ...... [RUN]
[0m14:03:04.838679 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.my_dbt_trino_project.src_listen_events, now model.my_dbt_trino_project.src_page_view_events)
[0m14:03:04.839695 [debug] [Thread-1 (]: Began compiling node model.my_dbt_trino_project.src_page_view_events
[0m14:03:04.842703 [debug] [Thread-1 (]: Writing injected SQL for node "model.my_dbt_trino_project.src_page_view_events"
[0m14:03:04.842703 [debug] [Thread-1 (]: Began executing node model.my_dbt_trino_project.src_page_view_events
[0m14:03:04.848526 [debug] [Thread-1 (]: Using trino connection "model.my_dbt_trino_project.src_page_view_events"
[0m14:03:04.848526 [debug] [Thread-1 (]: On model.my_dbt_trino_project.src_page_view_events: /* {"app": "dbt", "dbt_version": "1.8.2", "profile_name": "my_dbt_trino_project", "target_name": "dev", "node_id": "model.my_dbt_trino_project.src_page_view_events"} */

  
    

    create table "datalake"."analytics_source"."src_page_view_events__dbt_tmp"
      
      
    as (
      

with source as (
    select
        CAST(_id AS VARCHAR) as id,
        ts,
        CAST(sessionId AS VARCHAR) as sessionId,
        page,
        auth,
        level,
        CAST(CAST(NULLIF(itemInSession, '') AS DOUBLE) AS INTEGER) as itemInSession, 
        city,
        zip,
        state,
        userAgent,
        CAST(NULLIF(lon, '') AS double) as lon,
        CAST(NULLIF(lat, '') AS double) as lat,
        CAST(CAST(NULLIF(userId, '') AS DOUBLE) AS INTEGER) as userId, 
        lastName,
        firstName,
        gender,
        CAST(CAST(NULLIF(registration, '') AS DOUBLE) AS BIGINT) as registration, 
        artist,
        song,
        CAST(NULLIF(duration, '') AS double) as duration
    from "website"."demo"."page_view_events"
)

select * from source


    where ts > (select max(ts) from "datalake"."analytics_source"."src_page_view_events")

    )
[0m14:03:04.848968 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m14:03:05.024231 [debug] [Thread-1 (]: SQL status: SUCCESS in 0.0 seconds
[0m14:03:05.026875 [debug] [Thread-1 (]: Using trino connection "model.my_dbt_trino_project.src_page_view_events"
[0m14:03:05.026875 [debug] [Thread-1 (]: On model.my_dbt_trino_project.src_page_view_events: /* {"app": "dbt", "dbt_version": "1.8.2", "profile_name": "my_dbt_trino_project", "target_name": "dev", "node_id": "model.my_dbt_trino_project.src_page_view_events"} */

    describe "datalake"."analytics_source"."src_page_view_events__dbt_tmp"
[0m14:03:05.114460 [debug] [Thread-1 (]: SQL status: SUCCESS in 0.0 seconds
[0m14:03:05.117632 [debug] [Thread-1 (]: Using trino connection "model.my_dbt_trino_project.src_page_view_events"
[0m14:03:05.118215 [debug] [Thread-1 (]: On model.my_dbt_trino_project.src_page_view_events: /* {"app": "dbt", "dbt_version": "1.8.2", "profile_name": "my_dbt_trino_project", "target_name": "dev", "node_id": "model.my_dbt_trino_project.src_page_view_events"} */

    describe "datalake"."analytics_source"."src_page_view_events"
[0m14:03:05.210613 [debug] [Thread-1 (]: SQL status: SUCCESS in 0.0 seconds
[0m14:03:05.214793 [debug] [Thread-1 (]: Using trino connection "model.my_dbt_trino_project.src_page_view_events"
[0m14:03:05.215309 [debug] [Thread-1 (]: On model.my_dbt_trino_project.src_page_view_events: /* {"app": "dbt", "dbt_version": "1.8.2", "profile_name": "my_dbt_trino_project", "target_name": "dev", "node_id": "model.my_dbt_trino_project.src_page_view_events"} */

    describe "datalake"."analytics_source"."src_page_view_events"
[0m14:03:05.306231 [debug] [Thread-1 (]: SQL status: SUCCESS in 0.0 seconds
[0m14:03:05.308433 [debug] [Thread-1 (]: Writing runtime sql for node "model.my_dbt_trino_project.src_page_view_events"
[0m14:03:05.310517 [debug] [Thread-1 (]: Using trino connection "model.my_dbt_trino_project.src_page_view_events"
[0m14:03:05.311043 [debug] [Thread-1 (]: On model.my_dbt_trino_project.src_page_view_events: /* {"app": "dbt", "dbt_version": "1.8.2", "profile_name": "my_dbt_trino_project", "target_name": "dev", "node_id": "model.my_dbt_trino_project.src_page_view_events"} */
insert into "datalake"."analytics_source"."src_page_view_events" ("id", "ts", "sessionid", "page", "auth", "level", "iteminsession", "city", "zip", "state", "useragent", "lon", "lat", "userid", "lastname", "firstname", "gender", "registration", "artist", "song", "duration")
    (
        select "id", "ts", "sessionid", "page", "auth", "level", "iteminsession", "city", "zip", "state", "useragent", "lon", "lat", "userid", "lastname", "firstname", "gender", "registration", "artist", "song", "duration"
        from "datalake"."analytics_source"."src_page_view_events__dbt_tmp"
    )
[0m14:03:05.441718 [debug] [Thread-1 (]: SQL status: SUCCESS in 0.0 seconds
[0m14:03:05.444895 [debug] [Thread-1 (]: Applying DROP to: "datalake"."analytics_source"."src_page_view_events__dbt_tmp"
[0m14:03:05.445956 [debug] [Thread-1 (]: Using trino connection "model.my_dbt_trino_project.src_page_view_events"
[0m14:03:05.446484 [debug] [Thread-1 (]: On model.my_dbt_trino_project.src_page_view_events: /* {"app": "dbt", "dbt_version": "1.8.2", "profile_name": "my_dbt_trino_project", "target_name": "dev", "node_id": "model.my_dbt_trino_project.src_page_view_events"} */

    drop table if exists "datalake"."analytics_source"."src_page_view_events__dbt_tmp"
[0m14:03:05.614544 [debug] [Thread-1 (]: SQL status: SUCCESS in 0.0 seconds
[0m14:03:05.616135 [debug] [Thread-1 (]: On model.my_dbt_trino_project.src_page_view_events: ROLLBACK
[0m14:03:05.616660 [debug] [Thread-1 (]: On model.my_dbt_trino_project.src_page_view_events: Close
[0m14:03:05.617720 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'ff6e2e2c-a817-43ef-a463-d301d145a75f', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000001F25ACF3690>]}
[0m14:03:05.618244 [info ] [Thread-1 (]: 3 of 15 OK created sql incremental model analytics_source.src_page_view_events . [[32mSUCCESS[0m in 0.78s]
[0m14:03:05.619295 [debug] [Thread-1 (]: Finished running node model.my_dbt_trino_project.src_page_view_events
[0m14:03:05.619840 [debug] [Thread-1 (]: Began running node model.my_dbt_trino_project.stg_user_level_by_gender
[0m14:03:05.620379 [info ] [Thread-1 (]: 4 of 15 START sql view model analytics_stage.stg_user_level_by_gender .......... [RUN]
[0m14:03:05.620910 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.my_dbt_trino_project.src_page_view_events, now model.my_dbt_trino_project.stg_user_level_by_gender)
[0m14:03:05.621436 [debug] [Thread-1 (]: Began compiling node model.my_dbt_trino_project.stg_user_level_by_gender
[0m14:03:05.625172 [debug] [Thread-1 (]: Writing injected SQL for node "model.my_dbt_trino_project.stg_user_level_by_gender"
[0m14:03:05.626372 [debug] [Thread-1 (]: Began executing node model.my_dbt_trino_project.stg_user_level_by_gender
[0m14:03:05.641669 [debug] [Thread-1 (]: Writing runtime sql for node "model.my_dbt_trino_project.stg_user_level_by_gender"
[0m14:03:05.644061 [debug] [Thread-1 (]: Using trino connection "model.my_dbt_trino_project.stg_user_level_by_gender"
[0m14:03:05.644061 [debug] [Thread-1 (]: On model.my_dbt_trino_project.stg_user_level_by_gender: /* {"app": "dbt", "dbt_version": "1.8.2", "profile_name": "my_dbt_trino_project", "target_name": "dev", "node_id": "model.my_dbt_trino_project.stg_user_level_by_gender"} */

  create or replace view
    "datalake"."analytics_stage"."stg_user_level_by_gender"
  security definer
  as
    

WITH user_subscriptions AS (
    SELECT
        gender,
        level, 
        COUNT(DISTINCT userId) AS user_count
    FROM "datalake"."analytics_source"."src_auth_events"
    WHERE gender IS NOT NULL AND level IS NOT NULL
    GROUP BY gender, level
)

SELECT
    gender,
    level,
    user_count
FROM user_subscriptions
  
[0m14:03:05.645439 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m14:03:05.710029 [debug] [Thread-1 (]: SQL status: SUCCESS in 0.0 seconds
[0m14:03:05.712638 [debug] [Thread-1 (]: On model.my_dbt_trino_project.stg_user_level_by_gender: ROLLBACK
[0m14:03:05.713163 [debug] [Thread-1 (]: On model.my_dbt_trino_project.stg_user_level_by_gender: Close
[0m14:03:05.714211 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'ff6e2e2c-a817-43ef-a463-d301d145a75f', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000001F25BEEA490>]}
[0m14:03:05.714741 [info ] [Thread-1 (]: 4 of 15 OK created sql view model analytics_stage.stg_user_level_by_gender ..... [[32mSUCCESS[0m in 0.09s]
[0m14:03:05.715787 [debug] [Thread-1 (]: Finished running node model.my_dbt_trino_project.stg_user_level_by_gender
[0m14:03:05.716317 [debug] [Thread-1 (]: Began running node model.my_dbt_trino_project.stg_streams_hourly
[0m14:03:05.716842 [info ] [Thread-1 (]: 5 of 15 START sql table model analytics_stage.stg_streams_hourly ............... [RUN]
[0m14:03:05.717896 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.my_dbt_trino_project.stg_user_level_by_gender, now model.my_dbt_trino_project.stg_streams_hourly)
[0m14:03:05.718433 [debug] [Thread-1 (]: Began compiling node model.my_dbt_trino_project.stg_streams_hourly
[0m14:03:05.722444 [debug] [Thread-1 (]: Writing injected SQL for node "model.my_dbt_trino_project.stg_streams_hourly"
[0m14:03:05.723535 [debug] [Thread-1 (]: Began executing node model.my_dbt_trino_project.stg_streams_hourly
[0m14:03:05.726444 [debug] [Thread-1 (]: Writing runtime sql for node "model.my_dbt_trino_project.stg_streams_hourly"
[0m14:03:05.728444 [debug] [Thread-1 (]: Using trino connection "model.my_dbt_trino_project.stg_streams_hourly"
[0m14:03:05.728444 [debug] [Thread-1 (]: On model.my_dbt_trino_project.stg_streams_hourly: /* {"app": "dbt", "dbt_version": "1.8.2", "profile_name": "my_dbt_trino_project", "target_name": "dev", "node_id": "model.my_dbt_trino_project.stg_streams_hourly"} */

  
    

    create table "datalake"."analytics_stage"."stg_streams_hourly__dbt_tmp"
      
      
    as (
      

SELECT
    DATE_FORMAT(FROM_UNIXTIME(ts), '%Y-%m-%d') AS stream_date, 
    DATE_FORMAT(FROM_UNIXTIME(ts), '%H') AS stream_hour,
    COUNT(*) AS total_streams
FROM "datalake"."analytics_source"."src_listen_events"
GROUP BY
    DATE_FORMAT(FROM_UNIXTIME(ts), '%Y-%m-%d'),
    DATE_FORMAT(FROM_UNIXTIME(ts), '%H')
    )
[0m14:03:05.729445 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m14:03:05.970237 [debug] [Thread-1 (]: SQL status: SUCCESS in 0.0 seconds
[0m14:03:05.973342 [debug] [Thread-1 (]: Using trino connection "model.my_dbt_trino_project.stg_streams_hourly"
[0m14:03:05.973869 [debug] [Thread-1 (]: On model.my_dbt_trino_project.stg_streams_hourly: /* {"app": "dbt", "dbt_version": "1.8.2", "profile_name": "my_dbt_trino_project", "target_name": "dev", "node_id": "model.my_dbt_trino_project.stg_streams_hourly"} */
alter table "datalake"."analytics_stage"."stg_streams_hourly" rename to "datalake"."analytics_stage"."stg_streams_hourly__dbt_backup"
[0m14:03:06.066059 [debug] [Thread-1 (]: SQL status: SUCCESS in 0.0 seconds
[0m14:03:06.069210 [debug] [Thread-1 (]: Using trino connection "model.my_dbt_trino_project.stg_streams_hourly"
[0m14:03:06.069733 [debug] [Thread-1 (]: On model.my_dbt_trino_project.stg_streams_hourly: /* {"app": "dbt", "dbt_version": "1.8.2", "profile_name": "my_dbt_trino_project", "target_name": "dev", "node_id": "model.my_dbt_trino_project.stg_streams_hourly"} */
alter table "datalake"."analytics_stage"."stg_streams_hourly__dbt_tmp" rename to "datalake"."analytics_stage"."stg_streams_hourly"
[0m14:03:06.153847 [debug] [Thread-1 (]: SQL status: SUCCESS in 0.0 seconds
[0m14:03:06.156530 [debug] [Thread-1 (]: Applying DROP to: "datalake"."analytics_stage"."stg_streams_hourly__dbt_backup"
[0m14:03:06.157063 [debug] [Thread-1 (]: Using trino connection "model.my_dbt_trino_project.stg_streams_hourly"
[0m14:03:06.157589 [debug] [Thread-1 (]: On model.my_dbt_trino_project.stg_streams_hourly: /* {"app": "dbt", "dbt_version": "1.8.2", "profile_name": "my_dbt_trino_project", "target_name": "dev", "node_id": "model.my_dbt_trino_project.stg_streams_hourly"} */

    drop table if exists "datalake"."analytics_stage"."stg_streams_hourly__dbt_backup"
[0m14:03:06.273387 [debug] [Thread-1 (]: SQL status: SUCCESS in 0.0 seconds
[0m14:03:06.274979 [debug] [Thread-1 (]: On model.my_dbt_trino_project.stg_streams_hourly: ROLLBACK
[0m14:03:06.274979 [debug] [Thread-1 (]: On model.my_dbt_trino_project.stg_streams_hourly: Close
[0m14:03:06.275514 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'ff6e2e2c-a817-43ef-a463-d301d145a75f', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000001F25AC63310>]}
[0m14:03:06.276574 [info ] [Thread-1 (]: 5 of 15 OK created sql table model analytics_stage.stg_streams_hourly .......... [[32mSUCCESS[0m in 0.56s]
[0m14:03:06.277103 [debug] [Thread-1 (]: Finished running node model.my_dbt_trino_project.stg_streams_hourly
[0m14:03:06.277639 [debug] [Thread-1 (]: Began running node model.my_dbt_trino_project.stg_top_songs_artists
[0m14:03:06.278171 [info ] [Thread-1 (]: 6 of 15 START sql view model analytics_stage.stg_top_songs_artists ............. [RUN]
[0m14:03:06.278708 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.my_dbt_trino_project.stg_streams_hourly, now model.my_dbt_trino_project.stg_top_songs_artists)
[0m14:03:06.279224 [debug] [Thread-1 (]: Began compiling node model.my_dbt_trino_project.stg_top_songs_artists
[0m14:03:06.281356 [debug] [Thread-1 (]: Writing injected SQL for node "model.my_dbt_trino_project.stg_top_songs_artists"
[0m14:03:06.282361 [debug] [Thread-1 (]: Began executing node model.my_dbt_trino_project.stg_top_songs_artists
[0m14:03:06.284363 [debug] [Thread-1 (]: Writing runtime sql for node "model.my_dbt_trino_project.stg_top_songs_artists"
[0m14:03:06.285365 [debug] [Thread-1 (]: Using trino connection "model.my_dbt_trino_project.stg_top_songs_artists"
[0m14:03:06.286367 [debug] [Thread-1 (]: On model.my_dbt_trino_project.stg_top_songs_artists: /* {"app": "dbt", "dbt_version": "1.8.2", "profile_name": "my_dbt_trino_project", "target_name": "dev", "node_id": "model.my_dbt_trino_project.stg_top_songs_artists"} */

  create or replace view
    "datalake"."analytics_stage"."stg_top_songs_artists"
  security definer
  as
    

WITH song_plays AS (
    SELECT
        artist,
        song,
        COUNT(*) AS play_count
    FROM "datalake"."analytics_source"."src_listen_events"
    GROUP BY artist, song
)

SELECT
    artist,
    song,
    play_count
FROM song_plays
ORDER BY play_count DESC
  
[0m14:03:06.286367 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m14:03:06.355932 [debug] [Thread-1 (]: SQL status: SUCCESS in 0.0 seconds
[0m14:03:06.357516 [debug] [Thread-1 (]: On model.my_dbt_trino_project.stg_top_songs_artists: ROLLBACK
[0m14:03:06.358053 [debug] [Thread-1 (]: On model.my_dbt_trino_project.stg_top_songs_artists: Close
[0m14:03:06.358580 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'ff6e2e2c-a817-43ef-a463-d301d145a75f', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000001F25AB0DE50>]}
[0m14:03:06.359643 [info ] [Thread-1 (]: 6 of 15 OK created sql view model analytics_stage.stg_top_songs_artists ........ [[32mSUCCESS[0m in 0.08s]
[0m14:03:06.360177 [debug] [Thread-1 (]: Finished running node model.my_dbt_trino_project.stg_top_songs_artists
[0m14:03:06.360705 [debug] [Thread-1 (]: Began running node model.my_dbt_trino_project.stg_unique_users
[0m14:03:06.361234 [info ] [Thread-1 (]: 7 of 15 START sql view model analytics_stage.stg_unique_users .................. [RUN]
[0m14:03:06.361767 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.my_dbt_trino_project.stg_top_songs_artists, now model.my_dbt_trino_project.stg_unique_users)
[0m14:03:06.361767 [debug] [Thread-1 (]: Began compiling node model.my_dbt_trino_project.stg_unique_users
[0m14:03:06.364454 [debug] [Thread-1 (]: Writing injected SQL for node "model.my_dbt_trino_project.stg_unique_users"
[0m14:03:06.365457 [debug] [Thread-1 (]: Began executing node model.my_dbt_trino_project.stg_unique_users
[0m14:03:06.367462 [debug] [Thread-1 (]: Writing runtime sql for node "model.my_dbt_trino_project.stg_unique_users"
[0m14:03:06.368461 [debug] [Thread-1 (]: Using trino connection "model.my_dbt_trino_project.stg_unique_users"
[0m14:03:06.369462 [debug] [Thread-1 (]: On model.my_dbt_trino_project.stg_unique_users: /* {"app": "dbt", "dbt_version": "1.8.2", "profile_name": "my_dbt_trino_project", "target_name": "dev", "node_id": "model.my_dbt_trino_project.stg_unique_users"} */

  create or replace view
    "datalake"."analytics_stage"."stg_unique_users"
  security definer
  as
    

SELECT
    COUNT(DISTINCT userid) AS total_unique_users
FROM "datalake"."analytics_source"."src_listen_events"
WHERE userid IS NOT NULL
  
[0m14:03:06.369462 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m14:03:06.438186 [debug] [Thread-1 (]: SQL status: SUCCESS in 0.0 seconds
[0m14:03:06.439765 [debug] [Thread-1 (]: On model.my_dbt_trino_project.stg_unique_users: ROLLBACK
[0m14:03:06.440287 [debug] [Thread-1 (]: On model.my_dbt_trino_project.stg_unique_users: Close
[0m14:03:06.440811 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'ff6e2e2c-a817-43ef-a463-d301d145a75f', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000001F25C344510>]}
[0m14:03:06.441361 [info ] [Thread-1 (]: 7 of 15 OK created sql view model analytics_stage.stg_unique_users ............. [[32mSUCCESS[0m in 0.08s]
[0m14:03:06.441892 [debug] [Thread-1 (]: Finished running node model.my_dbt_trino_project.stg_unique_users
[0m14:03:06.442426 [debug] [Thread-1 (]: Began running node model.my_dbt_trino_project.stg_user_activity_per_country
[0m14:03:06.442946 [info ] [Thread-1 (]: 8 of 15 START sql view model analytics_stage.stg_user_activity_per_country ..... [RUN]
[0m14:03:06.443478 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.my_dbt_trino_project.stg_unique_users, now model.my_dbt_trino_project.stg_user_activity_per_country)
[0m14:03:06.444012 [debug] [Thread-1 (]: Began compiling node model.my_dbt_trino_project.stg_user_activity_per_country
[0m14:03:06.446093 [debug] [Thread-1 (]: Writing injected SQL for node "model.my_dbt_trino_project.stg_user_activity_per_country"
[0m14:03:06.447099 [debug] [Thread-1 (]: Began executing node model.my_dbt_trino_project.stg_user_activity_per_country
[0m14:03:06.450098 [debug] [Thread-1 (]: Writing runtime sql for node "model.my_dbt_trino_project.stg_user_activity_per_country"
[0m14:03:06.455097 [debug] [Thread-1 (]: Using trino connection "model.my_dbt_trino_project.stg_user_activity_per_country"
[0m14:03:06.455097 [debug] [Thread-1 (]: On model.my_dbt_trino_project.stg_user_activity_per_country: /* {"app": "dbt", "dbt_version": "1.8.2", "profile_name": "my_dbt_trino_project", "target_name": "dev", "node_id": "model.my_dbt_trino_project.stg_user_activity_per_country"} */

  create or replace view
    "datalake"."analytics_stage"."stg_user_activity_per_country"
  security definer
  as
    

WITH combined_activities AS (
  SELECT
    country,
    'listen_event' AS event_type,
    ts,
    userid
  FROM "datalake"."analytics_source"."src_listen_events"
  WHERE country IS NOT NULL
  UNION ALL
  SELECT
    'Unknown' AS country, 
    ts,
    userid
  FROM "datalake"."analytics_source"."src_auth_events"
  UNION ALL
  SELECT
    'Unknown' AS country, 
    'page_view_event' AS event_type,
    ts,
    userid
  FROM "datalake"."analytics_source"."src_page_view_events"
)

SELECT
  country,
  COUNT(*) AS activity_count
FROM combined_activities
GROUP BY country
  
[0m14:03:06.455097 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m14:03:06.504585 [debug] [Thread-1 (]: Trino adapter: Trino query id: 20240618_043720_00188_z97n2
[0m14:03:06.505092 [debug] [Thread-1 (]: Trino adapter: Trino error: TrinoUserError(type=USER_ERROR, name=TYPE_MISMATCH, message="line 17:3: UNION query has different number of fields: 4, 3", query_id=20240618_043720_00188_z97n2)
[0m14:03:06.505609 [debug] [Thread-1 (]: On model.my_dbt_trino_project.stg_user_activity_per_country: ROLLBACK
[0m14:03:06.505609 [debug] [Thread-1 (]: On model.my_dbt_trino_project.stg_user_activity_per_country: Close
[0m14:03:06.509746 [debug] [Thread-1 (]: Database Error in model stg_user_activity_per_country (models\stage\stg_user_activity_per_country.sql)
  TrinoUserError(type=USER_ERROR, name=TYPE_MISMATCH, message="line 17:3: UNION query has different number of fields: 4, 3", query_id=20240618_043720_00188_z97n2)
  compiled Code at target\run\my_dbt_trino_project\models\stage\stg_user_activity_per_country.sql
[0m14:03:06.510262 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'ff6e2e2c-a817-43ef-a463-d301d145a75f', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000001F25568CB50>]}
[0m14:03:06.510776 [error] [Thread-1 (]: 8 of 15 ERROR creating sql view model analytics_stage.stg_user_activity_per_country  [[31mERROR[0m in 0.07s]
[0m14:03:06.511828 [debug] [Thread-1 (]: Finished running node model.my_dbt_trino_project.stg_user_activity_per_country
[0m14:03:06.512343 [debug] [Thread-1 (]: Began running node model.my_dbt_trino_project.stg_user_activity_per_location
[0m14:03:06.512857 [info ] [Thread-1 (]: 9 of 15 START sql view model analytics_stage.stg_user_activity_per_location .... [RUN]
[0m14:03:06.513371 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.my_dbt_trino_project.stg_user_activity_per_country, now model.my_dbt_trino_project.stg_user_activity_per_location)
[0m14:03:06.513887 [debug] [Thread-1 (]: Began compiling node model.my_dbt_trino_project.stg_user_activity_per_location
[0m14:03:06.516945 [debug] [Thread-1 (]: Writing injected SQL for node "model.my_dbt_trino_project.stg_user_activity_per_location"
[0m14:03:06.516945 [debug] [Thread-1 (]: Began executing node model.my_dbt_trino_project.stg_user_activity_per_location
[0m14:03:06.518949 [debug] [Thread-1 (]: Writing runtime sql for node "model.my_dbt_trino_project.stg_user_activity_per_location"
[0m14:03:06.520949 [debug] [Thread-1 (]: Using trino connection "model.my_dbt_trino_project.stg_user_activity_per_location"
[0m14:03:06.521949 [debug] [Thread-1 (]: On model.my_dbt_trino_project.stg_user_activity_per_location: /* {"app": "dbt", "dbt_version": "1.8.2", "profile_name": "my_dbt_trino_project", "target_name": "dev", "node_id": "model.my_dbt_trino_project.stg_user_activity_per_location"} */

  create or replace view
    "datalake"."analytics_stage"."stg_user_activity_per_location"
  security definer
  as
    

WITH combined_activities AS (
  SELECT
    city,
    state,
    'auth_event' AS event_type,
    ts,
    userid
 FROM "datalake"."analytics_source"."src_auth_events"
  UNION ALL
  SELECT
    city,
    state,
    'listen_event' AS event_type,
    ts,
    userid
  FROM "datalake"."analytics_source"."src_listen_events"
  UNION ALL
  SELECT
    city,
    state,
    'page_view_event' AS event_type,
    ts,
    userid
  FROM "datalake"."analytics_source"."src_page_view_events"
)

SELECT
  state,
  city,
  COUNT(*) AS activity_count
FROM combined_activities
GROUP BY state, city
  
[0m14:03:06.521949 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m14:03:06.599320 [debug] [Thread-1 (]: SQL status: SUCCESS in 0.0 seconds
[0m14:03:06.600906 [debug] [Thread-1 (]: On model.my_dbt_trino_project.stg_user_activity_per_location: ROLLBACK
[0m14:03:06.601434 [debug] [Thread-1 (]: On model.my_dbt_trino_project.stg_user_activity_per_location: Close
[0m14:03:06.601960 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'ff6e2e2c-a817-43ef-a463-d301d145a75f', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000001F25C3C4850>]}
[0m14:03:06.603009 [info ] [Thread-1 (]: 9 of 15 OK created sql view model analytics_stage.stg_user_activity_per_location  [[32mSUCCESS[0m in 0.09s]
[0m14:03:06.603542 [debug] [Thread-1 (]: Finished running node model.my_dbt_trino_project.stg_user_activity_per_location
[0m14:03:06.604071 [debug] [Thread-1 (]: Began running node model.my_dbt_trino_project.mart_user_level_by_gender
[0m14:03:06.604599 [info ] [Thread-1 (]: 10 of 15 START sql table model analytics.mart_user_level_by_gender ............. [RUN]
[0m14:03:06.605126 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.my_dbt_trino_project.stg_user_activity_per_location, now model.my_dbt_trino_project.mart_user_level_by_gender)
[0m14:03:06.605655 [debug] [Thread-1 (]: Began compiling node model.my_dbt_trino_project.mart_user_level_by_gender
[0m14:03:06.607770 [debug] [Thread-1 (]: Writing injected SQL for node "model.my_dbt_trino_project.mart_user_level_by_gender"
[0m14:03:06.608777 [debug] [Thread-1 (]: Began executing node model.my_dbt_trino_project.mart_user_level_by_gender
[0m14:03:06.611313 [debug] [Thread-1 (]: Writing runtime sql for node "model.my_dbt_trino_project.mart_user_level_by_gender"
[0m14:03:06.612321 [debug] [Thread-1 (]: Using trino connection "model.my_dbt_trino_project.mart_user_level_by_gender"
[0m14:03:06.613321 [debug] [Thread-1 (]: On model.my_dbt_trino_project.mart_user_level_by_gender: /* {"app": "dbt", "dbt_version": "1.8.2", "profile_name": "my_dbt_trino_project", "target_name": "dev", "node_id": "model.my_dbt_trino_project.mart_user_level_by_gender"} */

  
    

    create table "datalake"."analytics"."mart_user_level_by_gender__dbt_tmp"
      
      
    as (
      

SELECT
    gender,
    level,
    SUM(user_count) AS total_users,
    ROUND(SUM(user_count) * 100.0 / SUM(SUM(user_count)) OVER (), 2) AS percentage_of_total_users
FROM "datalake"."analytics_stage"."stg_user_level_by_gender"
GROUP BY gender, level
    )
[0m14:03:06.613321 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m14:03:06.851833 [debug] [Thread-1 (]: SQL status: SUCCESS in 0.0 seconds
[0m14:03:06.854470 [debug] [Thread-1 (]: Using trino connection "model.my_dbt_trino_project.mart_user_level_by_gender"
[0m14:03:06.854997 [debug] [Thread-1 (]: On model.my_dbt_trino_project.mart_user_level_by_gender: /* {"app": "dbt", "dbt_version": "1.8.2", "profile_name": "my_dbt_trino_project", "target_name": "dev", "node_id": "model.my_dbt_trino_project.mart_user_level_by_gender"} */
alter table "datalake"."analytics"."mart_user_level_by_gender" rename to "datalake"."analytics"."mart_user_level_by_gender__dbt_backup"
[0m14:03:06.958636 [debug] [Thread-1 (]: SQL status: SUCCESS in 0.0 seconds
[0m14:03:06.961818 [debug] [Thread-1 (]: Using trino connection "model.my_dbt_trino_project.mart_user_level_by_gender"
[0m14:03:06.962346 [debug] [Thread-1 (]: On model.my_dbt_trino_project.mart_user_level_by_gender: /* {"app": "dbt", "dbt_version": "1.8.2", "profile_name": "my_dbt_trino_project", "target_name": "dev", "node_id": "model.my_dbt_trino_project.mart_user_level_by_gender"} */
alter table "datalake"."analytics"."mart_user_level_by_gender__dbt_tmp" rename to "datalake"."analytics"."mart_user_level_by_gender"
[0m14:03:07.067756 [debug] [Thread-1 (]: SQL status: SUCCESS in 0.0 seconds
[0m14:03:07.070396 [debug] [Thread-1 (]: Applying DROP to: "datalake"."analytics"."mart_user_level_by_gender__dbt_backup"
[0m14:03:07.071450 [debug] [Thread-1 (]: Using trino connection "model.my_dbt_trino_project.mart_user_level_by_gender"
[0m14:03:07.071450 [debug] [Thread-1 (]: On model.my_dbt_trino_project.mart_user_level_by_gender: /* {"app": "dbt", "dbt_version": "1.8.2", "profile_name": "my_dbt_trino_project", "target_name": "dev", "node_id": "model.my_dbt_trino_project.mart_user_level_by_gender"} */

    drop table if exists "datalake"."analytics"."mart_user_level_by_gender__dbt_backup"
[0m14:03:07.189725 [debug] [Thread-1 (]: SQL status: SUCCESS in 0.0 seconds
[0m14:03:07.191324 [debug] [Thread-1 (]: On model.my_dbt_trino_project.mart_user_level_by_gender: ROLLBACK
[0m14:03:07.191879 [debug] [Thread-1 (]: On model.my_dbt_trino_project.mart_user_level_by_gender: Close
[0m14:03:07.192406 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'ff6e2e2c-a817-43ef-a463-d301d145a75f', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000001F25AD5C190>]}
[0m14:03:07.192911 [info ] [Thread-1 (]: 10 of 15 OK created sql table model analytics.mart_user_level_by_gender ........ [[32mSUCCESS[0m in 0.59s]
[0m14:03:07.193439 [debug] [Thread-1 (]: Finished running node model.my_dbt_trino_project.mart_user_level_by_gender
[0m14:03:07.193959 [debug] [Thread-1 (]: Began running node model.my_dbt_trino_project.mart_hourly_stream_evolution
[0m14:03:07.194482 [info ] [Thread-1 (]: 11 of 15 START sql table model analytics.mart_hourly_stream_evolution .......... [RUN]
[0m14:03:07.195003 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.my_dbt_trino_project.mart_user_level_by_gender, now model.my_dbt_trino_project.mart_hourly_stream_evolution)
[0m14:03:07.195537 [debug] [Thread-1 (]: Began compiling node model.my_dbt_trino_project.mart_hourly_stream_evolution
[0m14:03:07.198240 [debug] [Thread-1 (]: Writing injected SQL for node "model.my_dbt_trino_project.mart_hourly_stream_evolution"
[0m14:03:07.199249 [debug] [Thread-1 (]: Began executing node model.my_dbt_trino_project.mart_hourly_stream_evolution
[0m14:03:07.204248 [debug] [Thread-1 (]: Writing runtime sql for node "model.my_dbt_trino_project.mart_hourly_stream_evolution"
[0m14:03:07.205250 [debug] [Thread-1 (]: Using trino connection "model.my_dbt_trino_project.mart_hourly_stream_evolution"
[0m14:03:07.205250 [debug] [Thread-1 (]: On model.my_dbt_trino_project.mart_hourly_stream_evolution: /* {"app": "dbt", "dbt_version": "1.8.2", "profile_name": "my_dbt_trino_project", "target_name": "dev", "node_id": "model.my_dbt_trino_project.mart_hourly_stream_evolution"} */

  
    

    create table "datalake"."analytics"."mart_hourly_stream_evolution__dbt_tmp"
      
      
    as (
      

SELECT
    stream_date,
    stream_hour,
    total_streams,
    SUM(total_streams) OVER (PARTITION BY stream_date ORDER BY stream_hour) AS cumulative_streams
FROM "datalake"."analytics_stage"."stg_streams_hourly"
ORDER BY
    stream_date,
    stream_hour
    )
[0m14:03:07.206251 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m14:03:07.447277 [debug] [Thread-1 (]: SQL status: SUCCESS in 0.0 seconds
[0m14:03:07.450413 [debug] [Thread-1 (]: Using trino connection "model.my_dbt_trino_project.mart_hourly_stream_evolution"
[0m14:03:07.450936 [debug] [Thread-1 (]: On model.my_dbt_trino_project.mart_hourly_stream_evolution: /* {"app": "dbt", "dbt_version": "1.8.2", "profile_name": "my_dbt_trino_project", "target_name": "dev", "node_id": "model.my_dbt_trino_project.mart_hourly_stream_evolution"} */
alter table "datalake"."analytics"."mart_hourly_stream_evolution" rename to "datalake"."analytics"."mart_hourly_stream_evolution__dbt_backup"
[0m14:03:07.536096 [debug] [Thread-1 (]: SQL status: SUCCESS in 0.0 seconds
[0m14:03:07.539792 [debug] [Thread-1 (]: Using trino connection "model.my_dbt_trino_project.mart_hourly_stream_evolution"
[0m14:03:07.539792 [debug] [Thread-1 (]: On model.my_dbt_trino_project.mart_hourly_stream_evolution: /* {"app": "dbt", "dbt_version": "1.8.2", "profile_name": "my_dbt_trino_project", "target_name": "dev", "node_id": "model.my_dbt_trino_project.mart_hourly_stream_evolution"} */
alter table "datalake"."analytics"."mart_hourly_stream_evolution__dbt_tmp" rename to "datalake"."analytics"."mart_hourly_stream_evolution"
[0m14:03:07.626152 [debug] [Thread-1 (]: SQL status: SUCCESS in 0.0 seconds
[0m14:03:07.628795 [debug] [Thread-1 (]: Applying DROP to: "datalake"."analytics"."mart_hourly_stream_evolution__dbt_backup"
[0m14:03:07.629849 [debug] [Thread-1 (]: Using trino connection "model.my_dbt_trino_project.mart_hourly_stream_evolution"
[0m14:03:07.630382 [debug] [Thread-1 (]: On model.my_dbt_trino_project.mart_hourly_stream_evolution: /* {"app": "dbt", "dbt_version": "1.8.2", "profile_name": "my_dbt_trino_project", "target_name": "dev", "node_id": "model.my_dbt_trino_project.mart_hourly_stream_evolution"} */

    drop table if exists "datalake"."analytics"."mart_hourly_stream_evolution__dbt_backup"
[0m14:03:07.755754 [debug] [Thread-1 (]: SQL status: SUCCESS in 0.0 seconds
[0m14:03:07.757877 [debug] [Thread-1 (]: On model.my_dbt_trino_project.mart_hourly_stream_evolution: ROLLBACK
[0m14:03:07.757877 [debug] [Thread-1 (]: On model.my_dbt_trino_project.mart_hourly_stream_evolution: Close
[0m14:03:07.758934 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'ff6e2e2c-a817-43ef-a463-d301d145a75f', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000001F25ABD2150>]}
[0m14:03:07.759457 [info ] [Thread-1 (]: 11 of 15 OK created sql table model analytics.mart_hourly_stream_evolution ..... [[32mSUCCESS[0m in 0.56s]
[0m14:03:07.760524 [debug] [Thread-1 (]: Finished running node model.my_dbt_trino_project.mart_hourly_stream_evolution
[0m14:03:07.761059 [debug] [Thread-1 (]: Began running node model.my_dbt_trino_project.mart_top_songs_artists
[0m14:03:07.761582 [info ] [Thread-1 (]: 12 of 15 START sql table model analytics.mart_top_songs_artists ................ [RUN]
[0m14:03:07.762108 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.my_dbt_trino_project.mart_hourly_stream_evolution, now model.my_dbt_trino_project.mart_top_songs_artists)
[0m14:03:07.762654 [debug] [Thread-1 (]: Began compiling node model.my_dbt_trino_project.mart_top_songs_artists
[0m14:03:07.766256 [debug] [Thread-1 (]: Writing injected SQL for node "model.my_dbt_trino_project.mart_top_songs_artists"
[0m14:03:07.766762 [debug] [Thread-1 (]: Began executing node model.my_dbt_trino_project.mart_top_songs_artists
[0m14:03:07.769770 [debug] [Thread-1 (]: Writing runtime sql for node "model.my_dbt_trino_project.mart_top_songs_artists"
[0m14:03:07.771112 [debug] [Thread-1 (]: Using trino connection "model.my_dbt_trino_project.mart_top_songs_artists"
[0m14:03:07.771112 [debug] [Thread-1 (]: On model.my_dbt_trino_project.mart_top_songs_artists: /* {"app": "dbt", "dbt_version": "1.8.2", "profile_name": "my_dbt_trino_project", "target_name": "dev", "node_id": "model.my_dbt_trino_project.mart_top_songs_artists"} */

  
    

    create table "datalake"."analytics"."mart_top_songs_artists__dbt_tmp"
      
      
    as (
      

WITH top_songs AS (
    SELECT
        artist,
        song,
        play_count
    FROM "datalake"."analytics_stage"."stg_top_songs_artists"
)

SELECT
    artist,
    song,
    play_count
FROM top_songs
    )
[0m14:03:07.771112 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m14:03:07.993063 [debug] [Thread-1 (]: SQL status: SUCCESS in 0.0 seconds
[0m14:03:07.995683 [debug] [Thread-1 (]: Using trino connection "model.my_dbt_trino_project.mart_top_songs_artists"
[0m14:03:07.996205 [debug] [Thread-1 (]: On model.my_dbt_trino_project.mart_top_songs_artists: /* {"app": "dbt", "dbt_version": "1.8.2", "profile_name": "my_dbt_trino_project", "target_name": "dev", "node_id": "model.my_dbt_trino_project.mart_top_songs_artists"} */
alter table "datalake"."analytics"."mart_top_songs_artists" rename to "datalake"."analytics"."mart_top_songs_artists__dbt_backup"
[0m14:03:08.089785 [debug] [Thread-1 (]: SQL status: SUCCESS in 0.0 seconds
[0m14:03:08.095103 [debug] [Thread-1 (]: Using trino connection "model.my_dbt_trino_project.mart_top_songs_artists"
[0m14:03:08.096121 [debug] [Thread-1 (]: On model.my_dbt_trino_project.mart_top_songs_artists: /* {"app": "dbt", "dbt_version": "1.8.2", "profile_name": "my_dbt_trino_project", "target_name": "dev", "node_id": "model.my_dbt_trino_project.mart_top_songs_artists"} */
alter table "datalake"."analytics"."mart_top_songs_artists__dbt_tmp" rename to "datalake"."analytics"."mart_top_songs_artists"
[0m14:03:08.181330 [debug] [Thread-1 (]: SQL status: SUCCESS in 0.0 seconds
[0m14:03:08.184499 [debug] [Thread-1 (]: Applying DROP to: "datalake"."analytics"."mart_top_songs_artists__dbt_backup"
[0m14:03:08.185028 [debug] [Thread-1 (]: Using trino connection "model.my_dbt_trino_project.mart_top_songs_artists"
[0m14:03:08.185557 [debug] [Thread-1 (]: On model.my_dbt_trino_project.mart_top_songs_artists: /* {"app": "dbt", "dbt_version": "1.8.2", "profile_name": "my_dbt_trino_project", "target_name": "dev", "node_id": "model.my_dbt_trino_project.mart_top_songs_artists"} */

    drop table if exists "datalake"."analytics"."mart_top_songs_artists__dbt_backup"
[0m14:03:08.299927 [debug] [Thread-1 (]: SQL status: SUCCESS in 0.0 seconds
[0m14:03:08.301539 [debug] [Thread-1 (]: On model.my_dbt_trino_project.mart_top_songs_artists: ROLLBACK
[0m14:03:08.302056 [debug] [Thread-1 (]: On model.my_dbt_trino_project.mart_top_songs_artists: Close
[0m14:03:08.302574 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'ff6e2e2c-a817-43ef-a463-d301d145a75f', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000001F25C7CE050>]}
[0m14:03:08.303625 [info ] [Thread-1 (]: 12 of 15 OK created sql table model analytics.mart_top_songs_artists ........... [[32mSUCCESS[0m in 0.54s]
[0m14:03:08.304149 [debug] [Thread-1 (]: Finished running node model.my_dbt_trino_project.mart_top_songs_artists
[0m14:03:08.304667 [debug] [Thread-1 (]: Began running node model.my_dbt_trino_project.mart_total_unique_users
[0m14:03:08.305194 [info ] [Thread-1 (]: 13 of 15 START sql table model analytics.mart_total_unique_users ............... [RUN]
[0m14:03:08.305710 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.my_dbt_trino_project.mart_top_songs_artists, now model.my_dbt_trino_project.mart_total_unique_users)
[0m14:03:08.306254 [debug] [Thread-1 (]: Began compiling node model.my_dbt_trino_project.mart_total_unique_users
[0m14:03:08.308901 [debug] [Thread-1 (]: Writing injected SQL for node "model.my_dbt_trino_project.mart_total_unique_users"
[0m14:03:08.309420 [debug] [Thread-1 (]: Began executing node model.my_dbt_trino_project.mart_total_unique_users
[0m14:03:08.314253 [debug] [Thread-1 (]: Writing runtime sql for node "model.my_dbt_trino_project.mart_total_unique_users"
[0m14:03:08.315294 [debug] [Thread-1 (]: Using trino connection "model.my_dbt_trino_project.mart_total_unique_users"
[0m14:03:08.315823 [debug] [Thread-1 (]: On model.my_dbt_trino_project.mart_total_unique_users: /* {"app": "dbt", "dbt_version": "1.8.2", "profile_name": "my_dbt_trino_project", "target_name": "dev", "node_id": "model.my_dbt_trino_project.mart_total_unique_users"} */

  
    

    create table "datalake"."analytics"."mart_total_unique_users__dbt_tmp"
      
      
    as (
      

SELECT
    total_unique_users
FROM "datalake"."analytics_stage"."stg_unique_users"
    )
[0m14:03:08.316363 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m14:03:08.553632 [debug] [Thread-1 (]: SQL status: SUCCESS in 0.0 seconds
[0m14:03:08.556261 [debug] [Thread-1 (]: Using trino connection "model.my_dbt_trino_project.mart_total_unique_users"
[0m14:03:08.556788 [debug] [Thread-1 (]: On model.my_dbt_trino_project.mart_total_unique_users: /* {"app": "dbt", "dbt_version": "1.8.2", "profile_name": "my_dbt_trino_project", "target_name": "dev", "node_id": "model.my_dbt_trino_project.mart_total_unique_users"} */
alter table "datalake"."analytics"."mart_total_unique_users" rename to "datalake"."analytics"."mart_total_unique_users__dbt_backup"
[0m14:03:08.641485 [debug] [Thread-1 (]: SQL status: SUCCESS in 0.0 seconds
[0m14:03:08.644657 [debug] [Thread-1 (]: Using trino connection "model.my_dbt_trino_project.mart_total_unique_users"
[0m14:03:08.645187 [debug] [Thread-1 (]: On model.my_dbt_trino_project.mart_total_unique_users: /* {"app": "dbt", "dbt_version": "1.8.2", "profile_name": "my_dbt_trino_project", "target_name": "dev", "node_id": "model.my_dbt_trino_project.mart_total_unique_users"} */
alter table "datalake"."analytics"."mart_total_unique_users__dbt_tmp" rename to "datalake"."analytics"."mart_total_unique_users"
[0m14:03:08.742140 [debug] [Thread-1 (]: SQL status: SUCCESS in 0.0 seconds
[0m14:03:08.744818 [debug] [Thread-1 (]: Applying DROP to: "datalake"."analytics"."mart_total_unique_users__dbt_backup"
[0m14:03:08.745875 [debug] [Thread-1 (]: Using trino connection "model.my_dbt_trino_project.mart_total_unique_users"
[0m14:03:08.746407 [debug] [Thread-1 (]: On model.my_dbt_trino_project.mart_total_unique_users: /* {"app": "dbt", "dbt_version": "1.8.2", "profile_name": "my_dbt_trino_project", "target_name": "dev", "node_id": "model.my_dbt_trino_project.mart_total_unique_users"} */

    drop table if exists "datalake"."analytics"."mart_total_unique_users__dbt_backup"
[0m14:03:08.862515 [debug] [Thread-1 (]: SQL status: SUCCESS in 0.0 seconds
[0m14:03:08.864614 [debug] [Thread-1 (]: On model.my_dbt_trino_project.mart_total_unique_users: ROLLBACK
[0m14:03:08.864614 [debug] [Thread-1 (]: On model.my_dbt_trino_project.mart_total_unique_users: Close
[0m14:03:08.865668 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'ff6e2e2c-a817-43ef-a463-d301d145a75f', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000001F25BF5BFD0>]}
[0m14:03:08.866216 [info ] [Thread-1 (]: 13 of 15 OK created sql table model analytics.mart_total_unique_users .......... [[32mSUCCESS[0m in 0.56s]
[0m14:03:08.867814 [debug] [Thread-1 (]: Finished running node model.my_dbt_trino_project.mart_total_unique_users
[0m14:03:08.868346 [debug] [Thread-1 (]: Began running node model.my_dbt_trino_project.mart_user_activity_per_country
[0m14:03:08.868886 [info ] [Thread-1 (]: 14 of 15 SKIP relation analytics.mart_user_activity_per_country ................ [[33mSKIP[0m]
[0m14:03:08.869560 [debug] [Thread-1 (]: Finished running node model.my_dbt_trino_project.mart_user_activity_per_country
[0m14:03:08.870068 [debug] [Thread-1 (]: Began running node model.my_dbt_trino_project.mart_user_activity_per_state
[0m14:03:08.871134 [info ] [Thread-1 (]: 15 of 15 START sql table model analytics.mart_user_activity_per_state .......... [RUN]
[0m14:03:08.872187 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.my_dbt_trino_project.mart_total_unique_users, now model.my_dbt_trino_project.mart_user_activity_per_state)
[0m14:03:08.873237 [debug] [Thread-1 (]: Began compiling node model.my_dbt_trino_project.mart_user_activity_per_state
[0m14:03:08.877245 [debug] [Thread-1 (]: Writing injected SQL for node "model.my_dbt_trino_project.mart_user_activity_per_state"
[0m14:03:08.878243 [debug] [Thread-1 (]: Began executing node model.my_dbt_trino_project.mart_user_activity_per_state
[0m14:03:08.883244 [debug] [Thread-1 (]: Writing runtime sql for node "model.my_dbt_trino_project.mart_user_activity_per_state"
[0m14:03:08.885244 [debug] [Thread-1 (]: Using trino connection "model.my_dbt_trino_project.mart_user_activity_per_state"
[0m14:03:08.885244 [debug] [Thread-1 (]: On model.my_dbt_trino_project.mart_user_activity_per_state: /* {"app": "dbt", "dbt_version": "1.8.2", "profile_name": "my_dbt_trino_project", "target_name": "dev", "node_id": "model.my_dbt_trino_project.mart_user_activity_per_state"} */

  
    

    create table "datalake"."analytics"."mart_user_activity_per_state__dbt_tmp"
      
      
    as (
      

SELECT
  state,
  city,
  SUM(activity_count) AS total_activity
FROM "datalake"."analytics_stage"."stg_user_activity_per_location"
GROUP BY state, city
ORDER BY state, SUM(activity_count) DESC
    )
[0m14:03:08.886243 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m14:03:09.224244 [debug] [Thread-1 (]: SQL status: SUCCESS in 0.0 seconds
[0m14:03:09.227455 [debug] [Thread-1 (]: Using trino connection "model.my_dbt_trino_project.mart_user_activity_per_state"
[0m14:03:09.227987 [debug] [Thread-1 (]: On model.my_dbt_trino_project.mart_user_activity_per_state: /* {"app": "dbt", "dbt_version": "1.8.2", "profile_name": "my_dbt_trino_project", "target_name": "dev", "node_id": "model.my_dbt_trino_project.mart_user_activity_per_state"} */
alter table "datalake"."analytics"."mart_user_activity_per_state" rename to "datalake"."analytics"."mart_user_activity_per_state__dbt_backup"
[0m14:03:09.313474 [debug] [Thread-1 (]: SQL status: SUCCESS in 0.0 seconds
[0m14:03:09.317109 [debug] [Thread-1 (]: Using trino connection "model.my_dbt_trino_project.mart_user_activity_per_state"
[0m14:03:09.317638 [debug] [Thread-1 (]: On model.my_dbt_trino_project.mart_user_activity_per_state: /* {"app": "dbt", "dbt_version": "1.8.2", "profile_name": "my_dbt_trino_project", "target_name": "dev", "node_id": "model.my_dbt_trino_project.mart_user_activity_per_state"} */
alter table "datalake"."analytics"."mart_user_activity_per_state__dbt_tmp" rename to "datalake"."analytics"."mart_user_activity_per_state"
[0m14:03:09.407909 [debug] [Thread-1 (]: SQL status: SUCCESS in 0.0 seconds
[0m14:03:09.410574 [debug] [Thread-1 (]: Applying DROP to: "datalake"."analytics"."mart_user_activity_per_state__dbt_backup"
[0m14:03:09.411635 [debug] [Thread-1 (]: Using trino connection "model.my_dbt_trino_project.mart_user_activity_per_state"
[0m14:03:09.411635 [debug] [Thread-1 (]: On model.my_dbt_trino_project.mart_user_activity_per_state: /* {"app": "dbt", "dbt_version": "1.8.2", "profile_name": "my_dbt_trino_project", "target_name": "dev", "node_id": "model.my_dbt_trino_project.mart_user_activity_per_state"} */

    drop table if exists "datalake"."analytics"."mart_user_activity_per_state__dbt_backup"
[0m14:03:09.543709 [debug] [Thread-1 (]: SQL status: SUCCESS in 0.0 seconds
[0m14:03:09.545284 [debug] [Thread-1 (]: On model.my_dbt_trino_project.mart_user_activity_per_state: ROLLBACK
[0m14:03:09.545803 [debug] [Thread-1 (]: On model.my_dbt_trino_project.mart_user_activity_per_state: Close
[0m14:03:09.546319 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'ff6e2e2c-a817-43ef-a463-d301d145a75f', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000001F25AB402D0>]}
[0m14:03:09.547386 [info ] [Thread-1 (]: 15 of 15 OK created sql table model analytics.mart_user_activity_per_state ..... [[32mSUCCESS[0m in 0.67s]
[0m14:03:09.547926 [debug] [Thread-1 (]: Finished running node model.my_dbt_trino_project.mart_user_activity_per_state
[0m14:03:09.549135 [debug] [MainThread]: On master: COMMIT
[0m14:03:09.549667 [debug] [MainThread]: Connection 'master' was properly closed.
[0m14:03:09.550198 [debug] [MainThread]: Connection 'list_datalake' was properly closed.
[0m14:03:09.550198 [debug] [MainThread]: Connection 'list_datalake_analytics_stage' was properly closed.
[0m14:03:09.550715 [debug] [MainThread]: Connection 'model.my_dbt_trino_project.mart_user_activity_per_state' was properly closed.
[0m14:03:09.551233 [info ] [MainThread]: 
[0m14:03:09.551747 [info ] [MainThread]: Finished running 8 table models, 2 incremental models, 5 view models in 0 hours 0 minutes and 6.59 seconds (6.59s).
[0m14:03:09.553826 [debug] [MainThread]: Command end result
[0m14:03:09.585188 [info ] [MainThread]: 
[0m14:03:09.586185 [info ] [MainThread]: [31mCompleted with 1 error and 0 warnings:[0m
[0m14:03:09.587184 [info ] [MainThread]: 
[0m14:03:09.587184 [error] [MainThread]:   Database Error in model stg_user_activity_per_country (models\stage\stg_user_activity_per_country.sql)
  TrinoUserError(type=USER_ERROR, name=TYPE_MISMATCH, message="line 17:3: UNION query has different number of fields: 4, 3", query_id=20240618_043720_00188_z97n2)
  compiled Code at target\run\my_dbt_trino_project\models\stage\stg_user_activity_per_country.sql
[0m14:03:09.588183 [info ] [MainThread]: 
[0m14:03:09.589184 [info ] [MainThread]: Done. PASS=13 WARN=0 ERROR=1 SKIP=1 TOTAL=15
[0m14:03:09.590185 [debug] [MainThread]: Command `dbt run` failed at 14:03:09.590185 after 7.69 seconds
[0m14:03:09.590185 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000001F25574F590>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000001F25574F910>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000001F25574F490>]}
[0m14:03:09.591186 [debug] [MainThread]: Flushing usage events
[0m14:08:57.654093 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000001CD1CEB6510>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000001CD1CEF3490>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000001CD1CEB8C10>]}


============================== 14:08:57.658147 | 57a20281-fad0-4949-9f09-0caec42a9290 ==============================
[0m14:08:57.658147 [info ] [MainThread]: Running with dbt=1.8.2
[0m14:08:57.659159 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'indirect_selection': 'eager', 'log_cache_events': 'False', 'write_json': 'True', 'partial_parse': 'True', 'cache_selected_only': 'False', 'warn_error': 'None', 'version_check': 'True', 'debug': 'False', 'log_path': 'C:\\Users\\ASUS\\Desktop\\work\\Iceberg-Dbt-Trino-Hive-modern-open-source-data-stack-main\\dbt\\logs', 'fail_fast': 'False', 'profiles_dir': 'C:\\Users\\ASUS\\Desktop\\work\\Iceberg-Dbt-Trino-Hive-modern-open-source-data-stack-main\\dbt', 'use_colors': 'True', 'use_experimental_parser': 'False', 'no_print': 'None', 'quiet': 'False', 'log_format': 'default', 'introspect': 'True', 'static_parser': 'True', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'target_path': 'None', 'invocation_command': 'dbt run', 'send_anonymous_usage_stats': 'True'}
[0m14:08:57.990852 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': '57a20281-fad0-4949-9f09-0caec42a9290', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000001CD1D25B350>]}
[0m14:08:58.026156 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': '57a20281-fad0-4949-9f09-0caec42a9290', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000001CD1A035810>]}
[0m14:08:58.027160 [info ] [MainThread]: Registered adapter: trino=1.8.0
[0m14:08:58.037754 [debug] [MainThread]: checksum: f0a141b9de567cb7f131613ba2682f40b3a1c6a157f81c6e5435862eff68f109, vars: {}, profile: , target: , version: 1.8.2
[0m14:08:58.191884 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 0 files changed.
[0m14:08:58.191884 [debug] [MainThread]: Partial parsing enabled, no changes found, skipping parsing
[0m14:08:58.224653 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': '57a20281-fad0-4949-9f09-0caec42a9290', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000001CD1D2C8D90>]}
[0m14:08:58.301641 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': '57a20281-fad0-4949-9f09-0caec42a9290', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000001CD1D3F3C10>]}
[0m14:08:58.302879 [info ] [MainThread]: Found 15 models, 7 data tests, 3 sources, 559 macros
[0m14:08:58.302879 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '57a20281-fad0-4949-9f09-0caec42a9290', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000001CD1D39D910>]}
[0m14:08:58.305896 [info ] [MainThread]: 
[0m14:08:58.305896 [debug] [MainThread]: Acquiring new trino connection 'master'
[0m14:08:58.311660 [debug] [ThreadPool]: Acquiring new trino connection 'list_datalake'
[0m14:08:58.368061 [debug] [ThreadPool]: Using trino connection "list_datalake"
[0m14:08:58.369063 [debug] [ThreadPool]: On list_datalake: /* {"app": "dbt", "dbt_version": "1.8.2", "profile_name": "my_dbt_trino_project", "target_name": "dev", "connection_name": "list_datalake"} */

    select schema_name
    from "datalake".INFORMATION_SCHEMA.schemata
[0m14:08:58.369063 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m14:08:58.402289 [debug] [ThreadPool]: SQL status: SUCCESS in 0.0 seconds
[0m14:08:58.403332 [debug] [ThreadPool]: On list_datalake: Close
[0m14:08:58.407090 [debug] [ThreadPool]: Using trino connection "list_datalake"
[0m14:08:58.408156 [debug] [ThreadPool]: On list_datalake: /* {"app": "dbt", "dbt_version": "1.8.2", "profile_name": "my_dbt_trino_project", "target_name": "dev", "connection_name": "list_datalake"} */

    select schema_name
    from "datalake".INFORMATION_SCHEMA.schemata
[0m14:08:58.408689 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m14:08:58.456028 [debug] [ThreadPool]: SQL status: SUCCESS in 0.0 seconds
[0m14:08:58.457099 [debug] [ThreadPool]: On list_datalake: Close
[0m14:08:58.459746 [debug] [ThreadPool]: Using trino connection "list_datalake"
[0m14:08:58.459746 [debug] [ThreadPool]: On list_datalake: /* {"app": "dbt", "dbt_version": "1.8.2", "profile_name": "my_dbt_trino_project", "target_name": "dev", "connection_name": "list_datalake"} */

    select schema_name
    from "datalake".INFORMATION_SCHEMA.schemata
[0m14:08:58.460261 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m14:08:58.504728 [debug] [ThreadPool]: SQL status: SUCCESS in 0.0 seconds
[0m14:08:58.505830 [debug] [ThreadPool]: On list_datalake: Close
[0m14:08:58.509066 [debug] [ThreadPool]: Acquiring new trino connection 'list_datalake_analytics_stage'
[0m14:08:58.520013 [debug] [ThreadPool]: Using trino connection "list_datalake_analytics_stage"
[0m14:08:58.520013 [debug] [ThreadPool]: On list_datalake_analytics_stage: /* {"app": "dbt", "dbt_version": "1.8.2", "profile_name": "my_dbt_trino_project", "target_name": "dev", "connection_name": "list_datalake_analytics_stage"} */
select
      t.table_catalog as database,
      t.table_name as name,
      t.table_schema as schema,
      case when mv.name is not null then 'materialized_view'
           when t.table_type = 'BASE TABLE' then 'table'
           when t.table_type = 'VIEW' then 'view'
           else t.table_type
      end as table_type
    from "datalake".INFORMATION_SCHEMA.tables t
    left join (
            select * from system.metadata.materialized_views
            where catalog_name = 'datalake'
              and schema_name = 'analytics_stage') mv
          on mv.catalog_name = t.table_catalog and mv.schema_name = t.table_schema and mv.name = t.table_name
    where t.table_schema = 'analytics_stage'
[0m14:08:58.521131 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m14:08:58.603613 [debug] [ThreadPool]: SQL status: SUCCESS in 0.0 seconds
[0m14:08:58.604665 [debug] [ThreadPool]: On list_datalake_analytics_stage: ROLLBACK
[0m14:08:58.605185 [debug] [ThreadPool]: On list_datalake_analytics_stage: Close
[0m14:08:58.605702 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_datalake_analytics_stage, now list_datalake_analytics_source)
[0m14:08:58.610960 [debug] [ThreadPool]: Using trino connection "list_datalake_analytics_source"
[0m14:08:58.611509 [debug] [ThreadPool]: On list_datalake_analytics_source: /* {"app": "dbt", "dbt_version": "1.8.2", "profile_name": "my_dbt_trino_project", "target_name": "dev", "connection_name": "list_datalake_analytics_source"} */
select
      t.table_catalog as database,
      t.table_name as name,
      t.table_schema as schema,
      case when mv.name is not null then 'materialized_view'
           when t.table_type = 'BASE TABLE' then 'table'
           when t.table_type = 'VIEW' then 'view'
           else t.table_type
      end as table_type
    from "datalake".INFORMATION_SCHEMA.tables t
    left join (
            select * from system.metadata.materialized_views
            where catalog_name = 'datalake'
              and schema_name = 'analytics_source') mv
          on mv.catalog_name = t.table_catalog and mv.schema_name = t.table_schema and mv.name = t.table_name
    where t.table_schema = 'analytics_source'
[0m14:08:58.611509 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m14:08:58.686016 [debug] [ThreadPool]: SQL status: SUCCESS in 0.0 seconds
[0m14:08:58.687647 [debug] [ThreadPool]: On list_datalake_analytics_source: ROLLBACK
[0m14:08:58.688175 [debug] [ThreadPool]: On list_datalake_analytics_source: Close
[0m14:08:58.688918 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_datalake_analytics_source, now list_datalake_analytics)
[0m14:08:58.693682 [debug] [ThreadPool]: Using trino connection "list_datalake_analytics"
[0m14:08:58.694287 [debug] [ThreadPool]: On list_datalake_analytics: /* {"app": "dbt", "dbt_version": "1.8.2", "profile_name": "my_dbt_trino_project", "target_name": "dev", "connection_name": "list_datalake_analytics"} */
select
      t.table_catalog as database,
      t.table_name as name,
      t.table_schema as schema,
      case when mv.name is not null then 'materialized_view'
           when t.table_type = 'BASE TABLE' then 'table'
           when t.table_type = 'VIEW' then 'view'
           else t.table_type
      end as table_type
    from "datalake".INFORMATION_SCHEMA.tables t
    left join (
            select * from system.metadata.materialized_views
            where catalog_name = 'datalake'
              and schema_name = 'analytics') mv
          on mv.catalog_name = t.table_catalog and mv.schema_name = t.table_schema and mv.name = t.table_name
    where t.table_schema = 'analytics'
[0m14:08:58.695382 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m14:08:58.792160 [debug] [ThreadPool]: SQL status: SUCCESS in 0.0 seconds
[0m14:08:58.793788 [debug] [ThreadPool]: On list_datalake_analytics: ROLLBACK
[0m14:08:58.794307 [debug] [ThreadPool]: On list_datalake_analytics: Close
[0m14:08:58.795967 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '57a20281-fad0-4949-9f09-0caec42a9290', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000001CD1E8AC190>]}
[0m14:08:58.796743 [debug] [MainThread]: On master: COMMIT
[0m14:08:58.797255 [info ] [MainThread]: Concurrency: 1 threads (target='dev')
[0m14:08:58.797776 [info ] [MainThread]: 
[0m14:08:58.801511 [debug] [Thread-1 (]: Began running node model.my_dbt_trino_project.src_auth_events
[0m14:08:58.802019 [info ] [Thread-1 (]: 1 of 15 START sql table model analytics_source.src_auth_events ................. [RUN]
[0m14:08:58.803523 [debug] [Thread-1 (]: Acquiring new trino connection 'model.my_dbt_trino_project.src_auth_events'
[0m14:08:58.803523 [debug] [Thread-1 (]: Began compiling node model.my_dbt_trino_project.src_auth_events
[0m14:08:58.809608 [debug] [Thread-1 (]: Writing injected SQL for node "model.my_dbt_trino_project.src_auth_events"
[0m14:08:58.809608 [debug] [Thread-1 (]: Began executing node model.my_dbt_trino_project.src_auth_events
[0m14:08:58.843417 [debug] [Thread-1 (]: Writing runtime sql for node "model.my_dbt_trino_project.src_auth_events"
[0m14:08:58.847421 [debug] [Thread-1 (]: Using trino connection "model.my_dbt_trino_project.src_auth_events"
[0m14:08:58.848431 [debug] [Thread-1 (]: On model.my_dbt_trino_project.src_auth_events: /* {"app": "dbt", "dbt_version": "1.8.2", "profile_name": "my_dbt_trino_project", "target_name": "dev", "node_id": "model.my_dbt_trino_project.src_auth_events"} */

  
    

    create table "datalake"."analytics_source"."src_auth_events__dbt_tmp"
      
      
    as (
      

with source as (
    select
        CAST(ts AS VARCHAR) as id, 
        ts,
        CAST(sessionId AS VARCHAR) as sessionId,
        level,
        itemInSession,
        city,
        zip,
        state,
        userAgent,
        CAST(NULLIF(lon, '') AS double) as lon,
        CAST(NULLIF(lat, '') AS double) as lat,
        CAST(FLOOR(CAST(NULLIF(userId, '') AS DOUBLE)) AS INT) as userId, 
        lastName,
        firstName,
        gender,
        CAST(FLOOR(CAST(NULLIF(registration, '') AS DOUBLE)) AS BIGINT) as registration,
        success
    from "oltp"."public"."auth_events"
)

select
    id,
    ts,
    sessionId,
    level,
    itemInSession,
    city,
    zip,
    state,
    userAgent,
    lon,
    lat,
    userId,
    lastName,
    firstName,
    gender,
    registration, 
    CASE 
        WHEN CAST(success AS VARCHAR) = 't' THEN true 
        WHEN CAST(success AS VARCHAR) = 'f' THEN false
        ELSE NULL 
    END AS success_boolean
from source


    )
[0m14:08:58.848431 [debug] [Thread-1 (]: Opening a new connection, currently in state init
[0m14:08:59.161111 [debug] [Thread-1 (]: SQL status: SUCCESS in 0.0 seconds
[0m14:08:59.166996 [debug] [Thread-1 (]: Using trino connection "model.my_dbt_trino_project.src_auth_events"
[0m14:08:59.167508 [debug] [Thread-1 (]: On model.my_dbt_trino_project.src_auth_events: /* {"app": "dbt", "dbt_version": "1.8.2", "profile_name": "my_dbt_trino_project", "target_name": "dev", "node_id": "model.my_dbt_trino_project.src_auth_events"} */
alter table "datalake"."analytics_source"."src_auth_events" rename to "datalake"."analytics_source"."src_auth_events__dbt_backup"
[0m14:08:59.301248 [debug] [Thread-1 (]: SQL status: SUCCESS in 0.0 seconds
[0m14:08:59.304892 [debug] [Thread-1 (]: Using trino connection "model.my_dbt_trino_project.src_auth_events"
[0m14:08:59.304892 [debug] [Thread-1 (]: On model.my_dbt_trino_project.src_auth_events: /* {"app": "dbt", "dbt_version": "1.8.2", "profile_name": "my_dbt_trino_project", "target_name": "dev", "node_id": "model.my_dbt_trino_project.src_auth_events"} */
alter table "datalake"."analytics_source"."src_auth_events__dbt_tmp" rename to "datalake"."analytics_source"."src_auth_events"
[0m14:08:59.411924 [debug] [Thread-1 (]: SQL status: SUCCESS in 0.0 seconds
[0m14:08:59.418189 [debug] [Thread-1 (]: Applying DROP to: "datalake"."analytics_source"."src_auth_events__dbt_backup"
[0m14:08:59.419785 [debug] [Thread-1 (]: Using trino connection "model.my_dbt_trino_project.src_auth_events"
[0m14:08:59.419785 [debug] [Thread-1 (]: On model.my_dbt_trino_project.src_auth_events: /* {"app": "dbt", "dbt_version": "1.8.2", "profile_name": "my_dbt_trino_project", "target_name": "dev", "node_id": "model.my_dbt_trino_project.src_auth_events"} */

    drop table if exists "datalake"."analytics_source"."src_auth_events__dbt_backup"
[0m14:08:59.556997 [debug] [Thread-1 (]: SQL status: SUCCESS in 0.0 seconds
[0m14:08:59.567942 [debug] [Thread-1 (]: On model.my_dbt_trino_project.src_auth_events: ROLLBACK
[0m14:08:59.568953 [debug] [Thread-1 (]: On model.my_dbt_trino_project.src_auth_events: Close
[0m14:08:59.570688 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '57a20281-fad0-4949-9f09-0caec42a9290', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000001CD1ED48790>]}
[0m14:08:59.571665 [info ] [Thread-1 (]: 1 of 15 OK created sql table model analytics_source.src_auth_events ............ [[32mSUCCESS[0m in 0.77s]
[0m14:08:59.572662 [debug] [Thread-1 (]: Finished running node model.my_dbt_trino_project.src_auth_events
[0m14:08:59.572662 [debug] [Thread-1 (]: Began running node model.my_dbt_trino_project.src_listen_events
[0m14:08:59.573692 [info ] [Thread-1 (]: 2 of 15 START sql incremental model analytics_source.src_listen_events ......... [RUN]
[0m14:08:59.573692 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.my_dbt_trino_project.src_auth_events, now model.my_dbt_trino_project.src_listen_events)
[0m14:08:59.574685 [debug] [Thread-1 (]: Began compiling node model.my_dbt_trino_project.src_listen_events
[0m14:08:59.579692 [debug] [Thread-1 (]: Writing injected SQL for node "model.my_dbt_trino_project.src_listen_events"
[0m14:08:59.580692 [debug] [Thread-1 (]: Began executing node model.my_dbt_trino_project.src_listen_events
[0m14:08:59.604082 [debug] [Thread-1 (]: Using trino connection "model.my_dbt_trino_project.src_listen_events"
[0m14:08:59.604082 [debug] [Thread-1 (]: On model.my_dbt_trino_project.src_listen_events: /* {"app": "dbt", "dbt_version": "1.8.2", "profile_name": "my_dbt_trino_project", "target_name": "dev", "node_id": "model.my_dbt_trino_project.src_listen_events"} */

  
    

    create table "datalake"."analytics_source"."src_listen_events__dbt_tmp"
      
      
    as (
      

with source as (

    select
        CAST(_id AS VARCHAR) as id,
        artist,
        song,
        CAST(NULLIF(duration, '') AS DOUBLE) as duration,
        ts,
        sessionid,
        auth,
        level,
        CAST(NULLIF(itemInSession, '') AS INTEGER) as itemInSession,
        city,
        zip,
        state,
        country,
        userAgent,
        CAST(NULLIF(lon, '') AS DOUBLE) as lon,
        CAST(NULLIF(lat, '') AS DOUBLE) as lat,
        CAST(CAST(NULLIF(userId, '') AS DOUBLE) AS INTEGER) as userId,
 -- Assurez-vous que userId peut aussi être converti de cette manière.
        lastName,
        firstName,
        gender,
        CAST(CAST(NULLIF(registration, '') AS DOUBLE) AS BIGINT) as registration
    from "website"."demo"."listen_events"

)

select * from source



    -- this filter will only be applied on an incremental run
    where ts > (select max(ts) from "datalake"."analytics_source"."src_listen_events")


    )
[0m14:08:59.605094 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m14:08:59.799544 [debug] [Thread-1 (]: SQL status: SUCCESS in 0.0 seconds
[0m14:08:59.810251 [debug] [Thread-1 (]: Using trino connection "model.my_dbt_trino_project.src_listen_events"
[0m14:08:59.810251 [debug] [Thread-1 (]: On model.my_dbt_trino_project.src_listen_events: /* {"app": "dbt", "dbt_version": "1.8.2", "profile_name": "my_dbt_trino_project", "target_name": "dev", "node_id": "model.my_dbt_trino_project.src_listen_events"} */

    describe "datalake"."analytics_source"."src_listen_events__dbt_tmp"
[0m14:08:59.922271 [debug] [Thread-1 (]: SQL status: SUCCESS in 0.0 seconds
[0m14:08:59.926568 [debug] [Thread-1 (]: Using trino connection "model.my_dbt_trino_project.src_listen_events"
[0m14:08:59.927108 [debug] [Thread-1 (]: On model.my_dbt_trino_project.src_listen_events: /* {"app": "dbt", "dbt_version": "1.8.2", "profile_name": "my_dbt_trino_project", "target_name": "dev", "node_id": "model.my_dbt_trino_project.src_listen_events"} */

    describe "datalake"."analytics_source"."src_listen_events"
[0m14:09:00.046417 [debug] [Thread-1 (]: SQL status: SUCCESS in 0.0 seconds
[0m14:09:00.058184 [debug] [Thread-1 (]: Using trino connection "model.my_dbt_trino_project.src_listen_events"
[0m14:09:00.058184 [debug] [Thread-1 (]: On model.my_dbt_trino_project.src_listen_events: /* {"app": "dbt", "dbt_version": "1.8.2", "profile_name": "my_dbt_trino_project", "target_name": "dev", "node_id": "model.my_dbt_trino_project.src_listen_events"} */

    describe "datalake"."analytics_source"."src_listen_events"
[0m14:09:00.150115 [debug] [Thread-1 (]: SQL status: SUCCESS in 0.0 seconds
[0m14:09:00.159293 [debug] [Thread-1 (]: Writing runtime sql for node "model.my_dbt_trino_project.src_listen_events"
[0m14:09:00.160938 [debug] [Thread-1 (]: Using trino connection "model.my_dbt_trino_project.src_listen_events"
[0m14:09:00.160938 [debug] [Thread-1 (]: On model.my_dbt_trino_project.src_listen_events: /* {"app": "dbt", "dbt_version": "1.8.2", "profile_name": "my_dbt_trino_project", "target_name": "dev", "node_id": "model.my_dbt_trino_project.src_listen_events"} */
insert into "datalake"."analytics_source"."src_listen_events" ("id", "artist", "song", "duration", "ts", "sessionid", "auth", "level", "iteminsession", "city", "zip", "state", "country", "useragent", "lon", "lat", "userid", "lastname", "firstname", "gender", "registration")
    (
        select "id", "artist", "song", "duration", "ts", "sessionid", "auth", "level", "iteminsession", "city", "zip", "state", "country", "useragent", "lon", "lat", "userid", "lastname", "firstname", "gender", "registration"
        from "datalake"."analytics_source"."src_listen_events__dbt_tmp"
    )
[0m14:09:00.305032 [debug] [Thread-1 (]: SQL status: SUCCESS in 0.0 seconds
[0m14:09:00.308176 [debug] [Thread-1 (]: Applying DROP to: "datalake"."analytics_source"."src_listen_events__dbt_tmp"
[0m14:09:00.308716 [debug] [Thread-1 (]: Using trino connection "model.my_dbt_trino_project.src_listen_events"
[0m14:09:00.309262 [debug] [Thread-1 (]: On model.my_dbt_trino_project.src_listen_events: /* {"app": "dbt", "dbt_version": "1.8.2", "profile_name": "my_dbt_trino_project", "target_name": "dev", "node_id": "model.my_dbt_trino_project.src_listen_events"} */

    drop table if exists "datalake"."analytics_source"."src_listen_events__dbt_tmp"
[0m14:09:00.424379 [debug] [Thread-1 (]: SQL status: SUCCESS in 0.0 seconds
[0m14:09:00.425920 [debug] [Thread-1 (]: On model.my_dbt_trino_project.src_listen_events: ROLLBACK
[0m14:09:00.425920 [debug] [Thread-1 (]: On model.my_dbt_trino_project.src_listen_events: Close
[0m14:09:00.426909 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '57a20281-fad0-4949-9f09-0caec42a9290', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000001CD1E90BD10>]}
[0m14:09:00.428393 [info ] [Thread-1 (]: 2 of 15 OK created sql incremental model analytics_source.src_listen_events .... [[32mSUCCESS[0m in 0.85s]
[0m14:09:00.428393 [debug] [Thread-1 (]: Finished running node model.my_dbt_trino_project.src_listen_events
[0m14:09:00.429614 [debug] [Thread-1 (]: Began running node model.my_dbt_trino_project.src_page_view_events
[0m14:09:00.429614 [info ] [Thread-1 (]: 3 of 15 START sql incremental model analytics_source.src_page_view_events ...... [RUN]
[0m14:09:00.430619 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.my_dbt_trino_project.src_listen_events, now model.my_dbt_trino_project.src_page_view_events)
[0m14:09:00.430619 [debug] [Thread-1 (]: Began compiling node model.my_dbt_trino_project.src_page_view_events
[0m14:09:00.433981 [debug] [Thread-1 (]: Writing injected SQL for node "model.my_dbt_trino_project.src_page_view_events"
[0m14:09:00.435458 [debug] [Thread-1 (]: Began executing node model.my_dbt_trino_project.src_page_view_events
[0m14:09:00.442192 [debug] [Thread-1 (]: Using trino connection "model.my_dbt_trino_project.src_page_view_events"
[0m14:09:00.442192 [debug] [Thread-1 (]: On model.my_dbt_trino_project.src_page_view_events: /* {"app": "dbt", "dbt_version": "1.8.2", "profile_name": "my_dbt_trino_project", "target_name": "dev", "node_id": "model.my_dbt_trino_project.src_page_view_events"} */

  
    

    create table "datalake"."analytics_source"."src_page_view_events__dbt_tmp"
      
      
    as (
      

with source as (
    select
        CAST(_id AS VARCHAR) as id,
        ts,
        CAST(sessionId AS VARCHAR) as sessionId,
        page,
        auth,
        level,
        CAST(CAST(NULLIF(itemInSession, '') AS DOUBLE) AS INTEGER) as itemInSession, 
        city,
        zip,
        state,
        userAgent,
        CAST(NULLIF(lon, '') AS double) as lon,
        CAST(NULLIF(lat, '') AS double) as lat,
        CAST(CAST(NULLIF(userId, '') AS DOUBLE) AS INTEGER) as userId, 
        lastName,
        firstName,
        gender,
        CAST(CAST(NULLIF(registration, '') AS DOUBLE) AS BIGINT) as registration, 
        artist,
        song,
        CAST(NULLIF(duration, '') AS double) as duration
    from "website"."demo"."page_view_events"
)

select * from source


    where ts > (select max(ts) from "datalake"."analytics_source"."src_page_view_events")

    )
[0m14:09:00.443615 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m14:09:00.631802 [debug] [Thread-1 (]: SQL status: SUCCESS in 0.0 seconds
[0m14:09:00.634935 [debug] [Thread-1 (]: Using trino connection "model.my_dbt_trino_project.src_page_view_events"
[0m14:09:00.635467 [debug] [Thread-1 (]: On model.my_dbt_trino_project.src_page_view_events: /* {"app": "dbt", "dbt_version": "1.8.2", "profile_name": "my_dbt_trino_project", "target_name": "dev", "node_id": "model.my_dbt_trino_project.src_page_view_events"} */

    describe "datalake"."analytics_source"."src_page_view_events__dbt_tmp"
[0m14:09:00.735609 [debug] [Thread-1 (]: SQL status: SUCCESS in 0.0 seconds
[0m14:09:00.740472 [debug] [Thread-1 (]: Using trino connection "model.my_dbt_trino_project.src_page_view_events"
[0m14:09:00.740472 [debug] [Thread-1 (]: On model.my_dbt_trino_project.src_page_view_events: /* {"app": "dbt", "dbt_version": "1.8.2", "profile_name": "my_dbt_trino_project", "target_name": "dev", "node_id": "model.my_dbt_trino_project.src_page_view_events"} */

    describe "datalake"."analytics_source"."src_page_view_events"
[0m14:09:00.827354 [debug] [Thread-1 (]: SQL status: SUCCESS in 0.0 seconds
[0m14:09:00.881091 [debug] [Thread-1 (]: Using trino connection "model.my_dbt_trino_project.src_page_view_events"
[0m14:09:00.881091 [debug] [Thread-1 (]: On model.my_dbt_trino_project.src_page_view_events: /* {"app": "dbt", "dbt_version": "1.8.2", "profile_name": "my_dbt_trino_project", "target_name": "dev", "node_id": "model.my_dbt_trino_project.src_page_view_events"} */

    describe "datalake"."analytics_source"."src_page_view_events"
[0m14:09:00.984903 [debug] [Thread-1 (]: SQL status: SUCCESS in 0.0 seconds
[0m14:09:00.987690 [debug] [Thread-1 (]: Writing runtime sql for node "model.my_dbt_trino_project.src_page_view_events"
[0m14:09:00.989345 [debug] [Thread-1 (]: Using trino connection "model.my_dbt_trino_project.src_page_view_events"
[0m14:09:00.989934 [debug] [Thread-1 (]: On model.my_dbt_trino_project.src_page_view_events: /* {"app": "dbt", "dbt_version": "1.8.2", "profile_name": "my_dbt_trino_project", "target_name": "dev", "node_id": "model.my_dbt_trino_project.src_page_view_events"} */
insert into "datalake"."analytics_source"."src_page_view_events" ("id", "ts", "sessionid", "page", "auth", "level", "iteminsession", "city", "zip", "state", "useragent", "lon", "lat", "userid", "lastname", "firstname", "gender", "registration", "artist", "song", "duration")
    (
        select "id", "ts", "sessionid", "page", "auth", "level", "iteminsession", "city", "zip", "state", "useragent", "lon", "lat", "userid", "lastname", "firstname", "gender", "registration", "artist", "song", "duration"
        from "datalake"."analytics_source"."src_page_view_events__dbt_tmp"
    )
[0m14:09:01.122168 [debug] [Thread-1 (]: SQL status: SUCCESS in 0.0 seconds
[0m14:09:01.125340 [debug] [Thread-1 (]: Applying DROP to: "datalake"."analytics_source"."src_page_view_events__dbt_tmp"
[0m14:09:01.125875 [debug] [Thread-1 (]: Using trino connection "model.my_dbt_trino_project.src_page_view_events"
[0m14:09:01.126427 [debug] [Thread-1 (]: On model.my_dbt_trino_project.src_page_view_events: /* {"app": "dbt", "dbt_version": "1.8.2", "profile_name": "my_dbt_trino_project", "target_name": "dev", "node_id": "model.my_dbt_trino_project.src_page_view_events"} */

    drop table if exists "datalake"."analytics_source"."src_page_view_events__dbt_tmp"
[0m14:09:01.251924 [debug] [Thread-1 (]: SQL status: SUCCESS in 0.0 seconds
[0m14:09:01.253485 [debug] [Thread-1 (]: On model.my_dbt_trino_project.src_page_view_events: ROLLBACK
[0m14:09:01.254009 [debug] [Thread-1 (]: On model.my_dbt_trino_project.src_page_view_events: Close
[0m14:09:01.254974 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '57a20281-fad0-4949-9f09-0caec42a9290', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000001CD1EE20250>]}
[0m14:09:01.255481 [info ] [Thread-1 (]: 3 of 15 OK created sql incremental model analytics_source.src_page_view_events . [[32mSUCCESS[0m in 0.82s]
[0m14:09:01.256017 [debug] [Thread-1 (]: Finished running node model.my_dbt_trino_project.src_page_view_events
[0m14:09:01.256541 [debug] [Thread-1 (]: Began running node model.my_dbt_trino_project.stg_user_level_by_gender
[0m14:09:01.257599 [info ] [Thread-1 (]: 4 of 15 START sql view model analytics_stage.stg_user_level_by_gender .......... [RUN]
[0m14:09:01.258663 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.my_dbt_trino_project.src_page_view_events, now model.my_dbt_trino_project.stg_user_level_by_gender)
[0m14:09:01.259195 [debug] [Thread-1 (]: Began compiling node model.my_dbt_trino_project.stg_user_level_by_gender
[0m14:09:01.261843 [debug] [Thread-1 (]: Writing injected SQL for node "model.my_dbt_trino_project.stg_user_level_by_gender"
[0m14:09:01.262398 [debug] [Thread-1 (]: Began executing node model.my_dbt_trino_project.stg_user_level_by_gender
[0m14:09:01.272958 [debug] [Thread-1 (]: Writing runtime sql for node "model.my_dbt_trino_project.stg_user_level_by_gender"
[0m14:09:01.275461 [debug] [Thread-1 (]: Using trino connection "model.my_dbt_trino_project.stg_user_level_by_gender"
[0m14:09:01.275461 [debug] [Thread-1 (]: On model.my_dbt_trino_project.stg_user_level_by_gender: /* {"app": "dbt", "dbt_version": "1.8.2", "profile_name": "my_dbt_trino_project", "target_name": "dev", "node_id": "model.my_dbt_trino_project.stg_user_level_by_gender"} */

  create or replace view
    "datalake"."analytics_stage"."stg_user_level_by_gender"
  security definer
  as
    

WITH user_subscriptions AS (
    SELECT
        gender,
        level, 
        COUNT(DISTINCT userId) AS user_count
    FROM "datalake"."analytics_source"."src_auth_events"
    WHERE gender IS NOT NULL AND level IS NOT NULL
    GROUP BY gender, level
)

SELECT
    gender,
    level,
    user_count
FROM user_subscriptions
  
[0m14:09:01.276470 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m14:09:01.350158 [debug] [Thread-1 (]: SQL status: SUCCESS in 0.0 seconds
[0m14:09:01.351727 [debug] [Thread-1 (]: On model.my_dbt_trino_project.stg_user_level_by_gender: ROLLBACK
[0m14:09:01.351727 [debug] [Thread-1 (]: On model.my_dbt_trino_project.stg_user_level_by_gender: Close
[0m14:09:01.352244 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '57a20281-fad0-4949-9f09-0caec42a9290', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000001CD1CF40110>]}
[0m14:09:01.353367 [info ] [Thread-1 (]: 4 of 15 OK created sql view model analytics_stage.stg_user_level_by_gender ..... [[32mSUCCESS[0m in 0.09s]
[0m14:09:01.354404 [debug] [Thread-1 (]: Finished running node model.my_dbt_trino_project.stg_user_level_by_gender
[0m14:09:01.354932 [debug] [Thread-1 (]: Began running node model.my_dbt_trino_project.stg_streams_hourly
[0m14:09:01.355474 [info ] [Thread-1 (]: 5 of 15 START sql table model analytics_stage.stg_streams_hourly ............... [RUN]
[0m14:09:01.357075 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.my_dbt_trino_project.stg_user_level_by_gender, now model.my_dbt_trino_project.stg_streams_hourly)
[0m14:09:01.358087 [debug] [Thread-1 (]: Began compiling node model.my_dbt_trino_project.stg_streams_hourly
[0m14:09:01.360108 [debug] [Thread-1 (]: Writing injected SQL for node "model.my_dbt_trino_project.stg_streams_hourly"
[0m14:09:01.361109 [debug] [Thread-1 (]: Began executing node model.my_dbt_trino_project.stg_streams_hourly
[0m14:09:01.364113 [debug] [Thread-1 (]: Writing runtime sql for node "model.my_dbt_trino_project.stg_streams_hourly"
[0m14:09:01.365572 [debug] [Thread-1 (]: Using trino connection "model.my_dbt_trino_project.stg_streams_hourly"
[0m14:09:01.365572 [debug] [Thread-1 (]: On model.my_dbt_trino_project.stg_streams_hourly: /* {"app": "dbt", "dbt_version": "1.8.2", "profile_name": "my_dbt_trino_project", "target_name": "dev", "node_id": "model.my_dbt_trino_project.stg_streams_hourly"} */

  
    

    create table "datalake"."analytics_stage"."stg_streams_hourly__dbt_tmp"
      
      
    as (
      

SELECT
    DATE_FORMAT(FROM_UNIXTIME(ts), '%Y-%m-%d') AS stream_date, 
    DATE_FORMAT(FROM_UNIXTIME(ts), '%H') AS stream_hour,
    COUNT(*) AS total_streams
FROM "datalake"."analytics_source"."src_listen_events"
GROUP BY
    DATE_FORMAT(FROM_UNIXTIME(ts), '%Y-%m-%d'),
    DATE_FORMAT(FROM_UNIXTIME(ts), '%H')
    )
[0m14:09:01.365572 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m14:09:01.656770 [debug] [Thread-1 (]: SQL status: SUCCESS in 0.0 seconds
[0m14:09:01.659924 [debug] [Thread-1 (]: Using trino connection "model.my_dbt_trino_project.stg_streams_hourly"
[0m14:09:01.660442 [debug] [Thread-1 (]: On model.my_dbt_trino_project.stg_streams_hourly: /* {"app": "dbt", "dbt_version": "1.8.2", "profile_name": "my_dbt_trino_project", "target_name": "dev", "node_id": "model.my_dbt_trino_project.stg_streams_hourly"} */
alter table "datalake"."analytics_stage"."stg_streams_hourly" rename to "datalake"."analytics_stage"."stg_streams_hourly__dbt_backup"
[0m14:09:01.752255 [debug] [Thread-1 (]: SQL status: SUCCESS in 0.0 seconds
[0m14:09:01.756597 [debug] [Thread-1 (]: Using trino connection "model.my_dbt_trino_project.stg_streams_hourly"
[0m14:09:01.757126 [debug] [Thread-1 (]: On model.my_dbt_trino_project.stg_streams_hourly: /* {"app": "dbt", "dbt_version": "1.8.2", "profile_name": "my_dbt_trino_project", "target_name": "dev", "node_id": "model.my_dbt_trino_project.stg_streams_hourly"} */
alter table "datalake"."analytics_stage"."stg_streams_hourly__dbt_tmp" rename to "datalake"."analytics_stage"."stg_streams_hourly"
[0m14:09:01.851416 [debug] [Thread-1 (]: SQL status: SUCCESS in 0.0 seconds
[0m14:09:01.854090 [debug] [Thread-1 (]: Applying DROP to: "datalake"."analytics_stage"."stg_streams_hourly__dbt_backup"
[0m14:09:01.855145 [debug] [Thread-1 (]: Using trino connection "model.my_dbt_trino_project.stg_streams_hourly"
[0m14:09:01.855669 [debug] [Thread-1 (]: On model.my_dbt_trino_project.stg_streams_hourly: /* {"app": "dbt", "dbt_version": "1.8.2", "profile_name": "my_dbt_trino_project", "target_name": "dev", "node_id": "model.my_dbt_trino_project.stg_streams_hourly"} */

    drop table if exists "datalake"."analytics_stage"."stg_streams_hourly__dbt_backup"
[0m14:09:01.992034 [debug] [Thread-1 (]: SQL status: SUCCESS in 0.0 seconds
[0m14:09:01.994707 [debug] [Thread-1 (]: On model.my_dbt_trino_project.stg_streams_hourly: ROLLBACK
[0m14:09:01.995230 [debug] [Thread-1 (]: On model.my_dbt_trino_project.stg_streams_hourly: Close
[0m14:09:01.996298 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '57a20281-fad0-4949-9f09-0caec42a9290', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000001CD1D24CD90>]}
[0m14:09:01.997375 [info ] [Thread-1 (]: 5 of 15 OK created sql table model analytics_stage.stg_streams_hourly .......... [[32mSUCCESS[0m in 0.64s]
[0m14:09:01.998436 [debug] [Thread-1 (]: Finished running node model.my_dbt_trino_project.stg_streams_hourly
[0m14:09:01.998970 [debug] [Thread-1 (]: Began running node model.my_dbt_trino_project.stg_top_songs_artists
[0m14:09:01.999492 [info ] [Thread-1 (]: 6 of 15 START sql view model analytics_stage.stg_top_songs_artists ............. [RUN]
[0m14:09:02.000558 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.my_dbt_trino_project.stg_streams_hourly, now model.my_dbt_trino_project.stg_top_songs_artists)
[0m14:09:02.000558 [debug] [Thread-1 (]: Began compiling node model.my_dbt_trino_project.stg_top_songs_artists
[0m14:09:02.004566 [debug] [Thread-1 (]: Writing injected SQL for node "model.my_dbt_trino_project.stg_top_songs_artists"
[0m14:09:02.005573 [debug] [Thread-1 (]: Began executing node model.my_dbt_trino_project.stg_top_songs_artists
[0m14:09:02.008568 [debug] [Thread-1 (]: Writing runtime sql for node "model.my_dbt_trino_project.stg_top_songs_artists"
[0m14:09:02.010781 [debug] [Thread-1 (]: Using trino connection "model.my_dbt_trino_project.stg_top_songs_artists"
[0m14:09:02.011784 [debug] [Thread-1 (]: On model.my_dbt_trino_project.stg_top_songs_artists: /* {"app": "dbt", "dbt_version": "1.8.2", "profile_name": "my_dbt_trino_project", "target_name": "dev", "node_id": "model.my_dbt_trino_project.stg_top_songs_artists"} */

  create or replace view
    "datalake"."analytics_stage"."stg_top_songs_artists"
  security definer
  as
    

WITH song_plays AS (
    SELECT
        artist,
        song,
        COUNT(*) AS play_count
    FROM "datalake"."analytics_source"."src_listen_events"
    GROUP BY artist, song
)

SELECT
    artist,
    song,
    play_count
FROM song_plays
ORDER BY play_count DESC
  
[0m14:09:02.011784 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m14:09:02.104055 [debug] [Thread-1 (]: SQL status: SUCCESS in 0.0 seconds
[0m14:09:02.106171 [debug] [Thread-1 (]: On model.my_dbt_trino_project.stg_top_songs_artists: ROLLBACK
[0m14:09:02.106696 [debug] [Thread-1 (]: On model.my_dbt_trino_project.stg_top_songs_artists: Close
[0m14:09:02.107217 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '57a20281-fad0-4949-9f09-0caec42a9290', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000001CD1ECF3490>]}
[0m14:09:02.107743 [info ] [Thread-1 (]: 6 of 15 OK created sql view model analytics_stage.stg_top_songs_artists ........ [[32mSUCCESS[0m in 0.11s]
[0m14:09:02.109343 [debug] [Thread-1 (]: Finished running node model.my_dbt_trino_project.stg_top_songs_artists
[0m14:09:02.109869 [debug] [Thread-1 (]: Began running node model.my_dbt_trino_project.stg_unique_users
[0m14:09:02.110400 [info ] [Thread-1 (]: 7 of 15 START sql view model analytics_stage.stg_unique_users .................. [RUN]
[0m14:09:02.110930 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.my_dbt_trino_project.stg_top_songs_artists, now model.my_dbt_trino_project.stg_unique_users)
[0m14:09:02.111458 [debug] [Thread-1 (]: Began compiling node model.my_dbt_trino_project.stg_unique_users
[0m14:09:02.114300 [debug] [Thread-1 (]: Writing injected SQL for node "model.my_dbt_trino_project.stg_unique_users"
[0m14:09:02.115356 [debug] [Thread-1 (]: Began executing node model.my_dbt_trino_project.stg_unique_users
[0m14:09:02.118023 [debug] [Thread-1 (]: Writing runtime sql for node "model.my_dbt_trino_project.stg_unique_users"
[0m14:09:02.119088 [debug] [Thread-1 (]: Using trino connection "model.my_dbt_trino_project.stg_unique_users"
[0m14:09:02.119637 [debug] [Thread-1 (]: On model.my_dbt_trino_project.stg_unique_users: /* {"app": "dbt", "dbt_version": "1.8.2", "profile_name": "my_dbt_trino_project", "target_name": "dev", "node_id": "model.my_dbt_trino_project.stg_unique_users"} */

  create or replace view
    "datalake"."analytics_stage"."stg_unique_users"
  security definer
  as
    

SELECT
    COUNT(DISTINCT userid) AS total_unique_users
FROM "datalake"."analytics_source"."src_listen_events"
WHERE userid IS NOT NULL
  
[0m14:09:02.120172 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m14:09:02.203406 [debug] [Thread-1 (]: SQL status: SUCCESS in 0.0 seconds
[0m14:09:02.205627 [debug] [Thread-1 (]: On model.my_dbt_trino_project.stg_unique_users: ROLLBACK
[0m14:09:02.206155 [debug] [Thread-1 (]: On model.my_dbt_trino_project.stg_unique_users: Close
[0m14:09:02.206701 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '57a20281-fad0-4949-9f09-0caec42a9290', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000001CD1D261810>]}
[0m14:09:02.207803 [info ] [Thread-1 (]: 7 of 15 OK created sql view model analytics_stage.stg_unique_users ............. [[32mSUCCESS[0m in 0.10s]
[0m14:09:02.208347 [debug] [Thread-1 (]: Finished running node model.my_dbt_trino_project.stg_unique_users
[0m14:09:02.208878 [debug] [Thread-1 (]: Began running node model.my_dbt_trino_project.stg_user_activity_per_country
[0m14:09:02.209938 [info ] [Thread-1 (]: 8 of 15 START sql view model analytics_stage.stg_user_activity_per_country ..... [RUN]
[0m14:09:02.211014 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.my_dbt_trino_project.stg_unique_users, now model.my_dbt_trino_project.stg_user_activity_per_country)
[0m14:09:02.211561 [debug] [Thread-1 (]: Began compiling node model.my_dbt_trino_project.stg_user_activity_per_country
[0m14:09:02.216222 [debug] [Thread-1 (]: Writing injected SQL for node "model.my_dbt_trino_project.stg_user_activity_per_country"
[0m14:09:02.217219 [debug] [Thread-1 (]: Began executing node model.my_dbt_trino_project.stg_user_activity_per_country
[0m14:09:02.219218 [debug] [Thread-1 (]: Writing runtime sql for node "model.my_dbt_trino_project.stg_user_activity_per_country"
[0m14:09:02.222217 [debug] [Thread-1 (]: Using trino connection "model.my_dbt_trino_project.stg_user_activity_per_country"
[0m14:09:02.222388 [debug] [Thread-1 (]: On model.my_dbt_trino_project.stg_user_activity_per_country: /* {"app": "dbt", "dbt_version": "1.8.2", "profile_name": "my_dbt_trino_project", "target_name": "dev", "node_id": "model.my_dbt_trino_project.stg_user_activity_per_country"} */

  create or replace view
    "datalake"."analytics_stage"."stg_user_activity_per_country"
  security definer
  as
    

WITH combined_activities AS (
  SELECT
    country,
    'listen_event' AS event_type,
    ts,
    userid
  FROM "datalake"."analytics_source"."src_listen_events"
  WHERE country IS NOT NULL
  UNION ALL
  SELECT
    'Unknown' AS country, 
    ts,
    userid
  FROM "datalake"."analytics_source"."src_auth_events"
  UNION ALL
  SELECT
    'Unknown' AS country, 
    'page_view_event' AS event_type,
    ts,
    userid
  FROM "datalake"."analytics_source"."src_page_view_events"
)

SELECT
  country,
  COUNT(*) AS activity_count
FROM combined_activities
GROUP BY country
  
[0m14:09:02.222891 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m14:09:02.269502 [debug] [Thread-1 (]: Trino adapter: Trino query id: 20240618_044315_00244_z97n2
[0m14:09:02.270541 [debug] [Thread-1 (]: Trino adapter: Trino error: TrinoUserError(type=USER_ERROR, name=TYPE_MISMATCH, message="line 17:3: UNION query has different number of fields: 4, 3", query_id=20240618_044315_00244_z97n2)
[0m14:09:02.271070 [debug] [Thread-1 (]: On model.my_dbt_trino_project.stg_user_activity_per_country: ROLLBACK
[0m14:09:02.271598 [debug] [Thread-1 (]: On model.my_dbt_trino_project.stg_user_activity_per_country: Close
[0m14:09:02.276241 [debug] [Thread-1 (]: Database Error in model stg_user_activity_per_country (models\stage\stg_user_activity_per_country.sql)
  TrinoUserError(type=USER_ERROR, name=TYPE_MISMATCH, message="line 17:3: UNION query has different number of fields: 4, 3", query_id=20240618_044315_00244_z97n2)
  compiled Code at target\run\my_dbt_trino_project\models\stage\stg_user_activity_per_country.sql
[0m14:09:02.277491 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '57a20281-fad0-4949-9f09-0caec42a9290', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000001CD1D03BAD0>]}
[0m14:09:02.278652 [error] [Thread-1 (]: 8 of 15 ERROR creating sql view model analytics_stage.stg_user_activity_per_country  [[31mERROR[0m in 0.07s]
[0m14:09:02.280943 [debug] [Thread-1 (]: Finished running node model.my_dbt_trino_project.stg_user_activity_per_country
[0m14:09:02.281955 [debug] [Thread-1 (]: Began running node model.my_dbt_trino_project.stg_user_activity_per_location
[0m14:09:02.282955 [info ] [Thread-1 (]: 9 of 15 START sql view model analytics_stage.stg_user_activity_per_location .... [RUN]
[0m14:09:02.283953 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.my_dbt_trino_project.stg_user_activity_per_country, now model.my_dbt_trino_project.stg_user_activity_per_location)
[0m14:09:02.283953 [debug] [Thread-1 (]: Began compiling node model.my_dbt_trino_project.stg_user_activity_per_location
[0m14:09:02.288017 [debug] [Thread-1 (]: Writing injected SQL for node "model.my_dbt_trino_project.stg_user_activity_per_location"
[0m14:09:02.289030 [debug] [Thread-1 (]: Began executing node model.my_dbt_trino_project.stg_user_activity_per_location
[0m14:09:02.296142 [debug] [Thread-1 (]: Writing runtime sql for node "model.my_dbt_trino_project.stg_user_activity_per_location"
[0m14:09:02.298920 [debug] [Thread-1 (]: Using trino connection "model.my_dbt_trino_project.stg_user_activity_per_location"
[0m14:09:02.300123 [debug] [Thread-1 (]: On model.my_dbt_trino_project.stg_user_activity_per_location: /* {"app": "dbt", "dbt_version": "1.8.2", "profile_name": "my_dbt_trino_project", "target_name": "dev", "node_id": "model.my_dbt_trino_project.stg_user_activity_per_location"} */

  create or replace view
    "datalake"."analytics_stage"."stg_user_activity_per_location"
  security definer
  as
    

WITH combined_activities AS (
  SELECT
    city,
    state,
    'auth_event' AS event_type,
    ts,
    userid
 FROM "datalake"."analytics_source"."src_auth_events"
  UNION ALL
  SELECT
    city,
    state,
    'listen_event' AS event_type,
    ts,
    userid
  FROM "datalake"."analytics_source"."src_listen_events"
  UNION ALL
  SELECT
    city,
    state,
    'page_view_event' AS event_type,
    ts,
    userid
  FROM "datalake"."analytics_source"."src_page_view_events"
)

SELECT
  state,
  city,
  COUNT(*) AS activity_count
FROM combined_activities
GROUP BY state, city
  
[0m14:09:02.301124 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m14:09:02.409270 [debug] [Thread-1 (]: SQL status: SUCCESS in 0.0 seconds
[0m14:09:02.412954 [debug] [Thread-1 (]: On model.my_dbt_trino_project.stg_user_activity_per_location: ROLLBACK
[0m14:09:02.413492 [debug] [Thread-1 (]: On model.my_dbt_trino_project.stg_user_activity_per_location: Close
[0m14:09:02.414568 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '57a20281-fad0-4949-9f09-0caec42a9290', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000001CD1ED81C50>]}
[0m14:09:02.416168 [info ] [Thread-1 (]: 9 of 15 OK created sql view model analytics_stage.stg_user_activity_per_location  [[32mSUCCESS[0m in 0.13s]
[0m14:09:02.417232 [debug] [Thread-1 (]: Finished running node model.my_dbt_trino_project.stg_user_activity_per_location
[0m14:09:02.417757 [debug] [Thread-1 (]: Began running node model.my_dbt_trino_project.mart_user_level_by_gender
[0m14:09:02.418821 [info ] [Thread-1 (]: 10 of 15 START sql table model analytics.mart_user_level_by_gender ............. [RUN]
[0m14:09:02.419868 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.my_dbt_trino_project.stg_user_activity_per_location, now model.my_dbt_trino_project.mart_user_level_by_gender)
[0m14:09:02.420397 [debug] [Thread-1 (]: Began compiling node model.my_dbt_trino_project.mart_user_level_by_gender
[0m14:09:02.424681 [debug] [Thread-1 (]: Writing injected SQL for node "model.my_dbt_trino_project.mart_user_level_by_gender"
[0m14:09:02.426296 [debug] [Thread-1 (]: Began executing node model.my_dbt_trino_project.mart_user_level_by_gender
[0m14:09:02.431608 [debug] [Thread-1 (]: Writing runtime sql for node "model.my_dbt_trino_project.mart_user_level_by_gender"
[0m14:09:02.435102 [debug] [Thread-1 (]: Using trino connection "model.my_dbt_trino_project.mart_user_level_by_gender"
[0m14:09:02.435733 [debug] [Thread-1 (]: On model.my_dbt_trino_project.mart_user_level_by_gender: /* {"app": "dbt", "dbt_version": "1.8.2", "profile_name": "my_dbt_trino_project", "target_name": "dev", "node_id": "model.my_dbt_trino_project.mart_user_level_by_gender"} */

  
    

    create table "datalake"."analytics"."mart_user_level_by_gender__dbt_tmp"
      
      
    as (
      

SELECT
    gender,
    level,
    SUM(user_count) AS total_users,
    ROUND(SUM(user_count) * 100.0 / SUM(SUM(user_count)) OVER (), 2) AS percentage_of_total_users
FROM "datalake"."analytics_stage"."stg_user_level_by_gender"
GROUP BY gender, level
    )
[0m14:09:02.436844 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m14:09:02.791878 [debug] [Thread-1 (]: SQL status: SUCCESS in 0.0 seconds
[0m14:09:02.795655 [debug] [Thread-1 (]: Using trino connection "model.my_dbt_trino_project.mart_user_level_by_gender"
[0m14:09:02.796195 [debug] [Thread-1 (]: On model.my_dbt_trino_project.mart_user_level_by_gender: /* {"app": "dbt", "dbt_version": "1.8.2", "profile_name": "my_dbt_trino_project", "target_name": "dev", "node_id": "model.my_dbt_trino_project.mart_user_level_by_gender"} */
alter table "datalake"."analytics"."mart_user_level_by_gender" rename to "datalake"."analytics"."mart_user_level_by_gender__dbt_backup"
[0m14:09:02.892321 [debug] [Thread-1 (]: SQL status: SUCCESS in 0.0 seconds
[0m14:09:02.895530 [debug] [Thread-1 (]: Using trino connection "model.my_dbt_trino_project.mart_user_level_by_gender"
[0m14:09:02.896066 [debug] [Thread-1 (]: On model.my_dbt_trino_project.mart_user_level_by_gender: /* {"app": "dbt", "dbt_version": "1.8.2", "profile_name": "my_dbt_trino_project", "target_name": "dev", "node_id": "model.my_dbt_trino_project.mart_user_level_by_gender"} */
alter table "datalake"."analytics"."mart_user_level_by_gender__dbt_tmp" rename to "datalake"."analytics"."mart_user_level_by_gender"
[0m14:09:02.999937 [debug] [Thread-1 (]: SQL status: SUCCESS in 0.0 seconds
[0m14:09:03.003704 [debug] [Thread-1 (]: Applying DROP to: "datalake"."analytics"."mart_user_level_by_gender__dbt_backup"
[0m14:09:03.004249 [debug] [Thread-1 (]: Using trino connection "model.my_dbt_trino_project.mart_user_level_by_gender"
[0m14:09:03.004783 [debug] [Thread-1 (]: On model.my_dbt_trino_project.mart_user_level_by_gender: /* {"app": "dbt", "dbt_version": "1.8.2", "profile_name": "my_dbt_trino_project", "target_name": "dev", "node_id": "model.my_dbt_trino_project.mart_user_level_by_gender"} */

    drop table if exists "datalake"."analytics"."mart_user_level_by_gender__dbt_backup"
[0m14:09:03.145973 [debug] [Thread-1 (]: SQL status: SUCCESS in 0.0 seconds
[0m14:09:03.147574 [debug] [Thread-1 (]: On model.my_dbt_trino_project.mart_user_level_by_gender: ROLLBACK
[0m14:09:03.148119 [debug] [Thread-1 (]: On model.my_dbt_trino_project.mart_user_level_by_gender: Close
[0m14:09:03.148670 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '57a20281-fad0-4949-9f09-0caec42a9290', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000001CD1E906550>]}
[0m14:09:03.149752 [info ] [Thread-1 (]: 10 of 15 OK created sql table model analytics.mart_user_level_by_gender ........ [[32mSUCCESS[0m in 0.73s]
[0m14:09:03.150815 [debug] [Thread-1 (]: Finished running node model.my_dbt_trino_project.mart_user_level_by_gender
[0m14:09:03.151338 [debug] [Thread-1 (]: Began running node model.my_dbt_trino_project.mart_hourly_stream_evolution
[0m14:09:03.151868 [info ] [Thread-1 (]: 11 of 15 START sql table model analytics.mart_hourly_stream_evolution .......... [RUN]
[0m14:09:03.152935 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.my_dbt_trino_project.mart_user_level_by_gender, now model.my_dbt_trino_project.mart_hourly_stream_evolution)
[0m14:09:03.153450 [debug] [Thread-1 (]: Began compiling node model.my_dbt_trino_project.mart_hourly_stream_evolution
[0m14:09:03.156054 [debug] [Thread-1 (]: Writing injected SQL for node "model.my_dbt_trino_project.mart_hourly_stream_evolution"
[0m14:09:03.156054 [debug] [Thread-1 (]: Began executing node model.my_dbt_trino_project.mart_hourly_stream_evolution
[0m14:09:03.159030 [debug] [Thread-1 (]: Writing runtime sql for node "model.my_dbt_trino_project.mart_hourly_stream_evolution"
[0m14:09:03.160044 [debug] [Thread-1 (]: Using trino connection "model.my_dbt_trino_project.mart_hourly_stream_evolution"
[0m14:09:03.161046 [debug] [Thread-1 (]: On model.my_dbt_trino_project.mart_hourly_stream_evolution: /* {"app": "dbt", "dbt_version": "1.8.2", "profile_name": "my_dbt_trino_project", "target_name": "dev", "node_id": "model.my_dbt_trino_project.mart_hourly_stream_evolution"} */

  
    

    create table "datalake"."analytics"."mart_hourly_stream_evolution__dbt_tmp"
      
      
    as (
      

SELECT
    stream_date,
    stream_hour,
    total_streams,
    SUM(total_streams) OVER (PARTITION BY stream_date ORDER BY stream_hour) AS cumulative_streams
FROM "datalake"."analytics_stage"."stg_streams_hourly"
ORDER BY
    stream_date,
    stream_hour
    )
[0m14:09:03.161046 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m14:09:03.456542 [debug] [Thread-1 (]: SQL status: SUCCESS in 0.0 seconds
[0m14:09:03.460281 [debug] [Thread-1 (]: Using trino connection "model.my_dbt_trino_project.mart_hourly_stream_evolution"
[0m14:09:03.460809 [debug] [Thread-1 (]: On model.my_dbt_trino_project.mart_hourly_stream_evolution: /* {"app": "dbt", "dbt_version": "1.8.2", "profile_name": "my_dbt_trino_project", "target_name": "dev", "node_id": "model.my_dbt_trino_project.mart_hourly_stream_evolution"} */
alter table "datalake"."analytics"."mart_hourly_stream_evolution" rename to "datalake"."analytics"."mart_hourly_stream_evolution__dbt_backup"
[0m14:09:03.553429 [debug] [Thread-1 (]: SQL status: SUCCESS in 0.0 seconds
[0m14:09:03.557800 [debug] [Thread-1 (]: Using trino connection "model.my_dbt_trino_project.mart_hourly_stream_evolution"
[0m14:09:03.558326 [debug] [Thread-1 (]: On model.my_dbt_trino_project.mart_hourly_stream_evolution: /* {"app": "dbt", "dbt_version": "1.8.2", "profile_name": "my_dbt_trino_project", "target_name": "dev", "node_id": "model.my_dbt_trino_project.mart_hourly_stream_evolution"} */
alter table "datalake"."analytics"."mart_hourly_stream_evolution__dbt_tmp" rename to "datalake"."analytics"."mart_hourly_stream_evolution"
[0m14:09:03.659307 [debug] [Thread-1 (]: SQL status: SUCCESS in 0.0 seconds
[0m14:09:03.663170 [debug] [Thread-1 (]: Applying DROP to: "datalake"."analytics"."mart_hourly_stream_evolution__dbt_backup"
[0m14:09:03.663722 [debug] [Thread-1 (]: Using trino connection "model.my_dbt_trino_project.mart_hourly_stream_evolution"
[0m14:09:03.664793 [debug] [Thread-1 (]: On model.my_dbt_trino_project.mart_hourly_stream_evolution: /* {"app": "dbt", "dbt_version": "1.8.2", "profile_name": "my_dbt_trino_project", "target_name": "dev", "node_id": "model.my_dbt_trino_project.mart_hourly_stream_evolution"} */

    drop table if exists "datalake"."analytics"."mart_hourly_stream_evolution__dbt_backup"
[0m14:09:03.809592 [debug] [Thread-1 (]: SQL status: SUCCESS in 0.0 seconds
[0m14:09:03.811198 [debug] [Thread-1 (]: On model.my_dbt_trino_project.mart_hourly_stream_evolution: ROLLBACK
[0m14:09:03.812303 [debug] [Thread-1 (]: On model.my_dbt_trino_project.mart_hourly_stream_evolution: Close
[0m14:09:03.812817 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '57a20281-fad0-4949-9f09-0caec42a9290', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000001CD1ECF9610>]}
[0m14:09:03.813891 [info ] [Thread-1 (]: 11 of 15 OK created sql table model analytics.mart_hourly_stream_evolution ..... [[32mSUCCESS[0m in 0.66s]
[0m14:09:03.814414 [debug] [Thread-1 (]: Finished running node model.my_dbt_trino_project.mart_hourly_stream_evolution
[0m14:09:03.814955 [debug] [Thread-1 (]: Began running node model.my_dbt_trino_project.mart_top_songs_artists
[0m14:09:03.815502 [info ] [Thread-1 (]: 12 of 15 START sql table model analytics.mart_top_songs_artists ................ [RUN]
[0m14:09:03.816021 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.my_dbt_trino_project.mart_hourly_stream_evolution, now model.my_dbt_trino_project.mart_top_songs_artists)
[0m14:09:03.816548 [debug] [Thread-1 (]: Began compiling node model.my_dbt_trino_project.mart_top_songs_artists
[0m14:09:03.819290 [debug] [Thread-1 (]: Writing injected SQL for node "model.my_dbt_trino_project.mart_top_songs_artists"
[0m14:09:03.819873 [debug] [Thread-1 (]: Began executing node model.my_dbt_trino_project.mart_top_songs_artists
[0m14:09:03.821588 [debug] [Thread-1 (]: Writing runtime sql for node "model.my_dbt_trino_project.mart_top_songs_artists"
[0m14:09:03.823598 [debug] [Thread-1 (]: Using trino connection "model.my_dbt_trino_project.mart_top_songs_artists"
[0m14:09:03.824598 [debug] [Thread-1 (]: On model.my_dbt_trino_project.mart_top_songs_artists: /* {"app": "dbt", "dbt_version": "1.8.2", "profile_name": "my_dbt_trino_project", "target_name": "dev", "node_id": "model.my_dbt_trino_project.mart_top_songs_artists"} */

  
    

    create table "datalake"."analytics"."mart_top_songs_artists__dbt_tmp"
      
      
    as (
      

WITH top_songs AS (
    SELECT
        artist,
        song,
        play_count
    FROM "datalake"."analytics_stage"."stg_top_songs_artists"
)

SELECT
    artist,
    song,
    play_count
FROM top_songs
    )
[0m14:09:03.824598 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m14:09:04.128277 [debug] [Thread-1 (]: SQL status: SUCCESS in 0.0 seconds
[0m14:09:04.131471 [debug] [Thread-1 (]: Using trino connection "model.my_dbt_trino_project.mart_top_songs_artists"
[0m14:09:04.132064 [debug] [Thread-1 (]: On model.my_dbt_trino_project.mart_top_songs_artists: /* {"app": "dbt", "dbt_version": "1.8.2", "profile_name": "my_dbt_trino_project", "target_name": "dev", "node_id": "model.my_dbt_trino_project.mart_top_songs_artists"} */
alter table "datalake"."analytics"."mart_top_songs_artists" rename to "datalake"."analytics"."mart_top_songs_artists__dbt_backup"
[0m14:09:04.236844 [debug] [Thread-1 (]: SQL status: SUCCESS in 0.0 seconds
[0m14:09:04.240044 [debug] [Thread-1 (]: Using trino connection "model.my_dbt_trino_project.mart_top_songs_artists"
[0m14:09:04.240044 [debug] [Thread-1 (]: On model.my_dbt_trino_project.mart_top_songs_artists: /* {"app": "dbt", "dbt_version": "1.8.2", "profile_name": "my_dbt_trino_project", "target_name": "dev", "node_id": "model.my_dbt_trino_project.mart_top_songs_artists"} */
alter table "datalake"."analytics"."mart_top_songs_artists__dbt_tmp" rename to "datalake"."analytics"."mart_top_songs_artists"
[0m14:09:04.343696 [debug] [Thread-1 (]: SQL status: SUCCESS in 0.0 seconds
[0m14:09:04.346451 [debug] [Thread-1 (]: Applying DROP to: "datalake"."analytics"."mart_top_songs_artists__dbt_backup"
[0m14:09:04.347018 [debug] [Thread-1 (]: Using trino connection "model.my_dbt_trino_project.mart_top_songs_artists"
[0m14:09:04.347578 [debug] [Thread-1 (]: On model.my_dbt_trino_project.mart_top_songs_artists: /* {"app": "dbt", "dbt_version": "1.8.2", "profile_name": "my_dbt_trino_project", "target_name": "dev", "node_id": "model.my_dbt_trino_project.mart_top_songs_artists"} */

    drop table if exists "datalake"."analytics"."mart_top_songs_artists__dbt_backup"
[0m14:09:04.490690 [debug] [Thread-1 (]: SQL status: SUCCESS in 0.0 seconds
[0m14:09:04.492912 [debug] [Thread-1 (]: On model.my_dbt_trino_project.mart_top_songs_artists: ROLLBACK
[0m14:09:04.493517 [debug] [Thread-1 (]: On model.my_dbt_trino_project.mart_top_songs_artists: Close
[0m14:09:04.494618 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '57a20281-fad0-4949-9f09-0caec42a9290', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000001CD1ED57D90>]}
[0m14:09:04.495140 [info ] [Thread-1 (]: 12 of 15 OK created sql table model analytics.mart_top_songs_artists ........... [[32mSUCCESS[0m in 0.68s]
[0m14:09:04.496202 [debug] [Thread-1 (]: Finished running node model.my_dbt_trino_project.mart_top_songs_artists
[0m14:09:04.496735 [debug] [Thread-1 (]: Began running node model.my_dbt_trino_project.mart_total_unique_users
[0m14:09:04.497257 [info ] [Thread-1 (]: 13 of 15 START sql table model analytics.mart_total_unique_users ............... [RUN]
[0m14:09:04.498306 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.my_dbt_trino_project.mart_top_songs_artists, now model.my_dbt_trino_project.mart_total_unique_users)
[0m14:09:04.498838 [debug] [Thread-1 (]: Began compiling node model.my_dbt_trino_project.mart_total_unique_users
[0m14:09:04.502537 [debug] [Thread-1 (]: Writing injected SQL for node "model.my_dbt_trino_project.mart_total_unique_users"
[0m14:09:04.503065 [debug] [Thread-1 (]: Began executing node model.my_dbt_trino_project.mart_total_unique_users
[0m14:09:04.506937 [debug] [Thread-1 (]: Writing runtime sql for node "model.my_dbt_trino_project.mart_total_unique_users"
[0m14:09:04.508554 [debug] [Thread-1 (]: Using trino connection "model.my_dbt_trino_project.mart_total_unique_users"
[0m14:09:04.509088 [debug] [Thread-1 (]: On model.my_dbt_trino_project.mart_total_unique_users: /* {"app": "dbt", "dbt_version": "1.8.2", "profile_name": "my_dbt_trino_project", "target_name": "dev", "node_id": "model.my_dbt_trino_project.mart_total_unique_users"} */

  
    

    create table "datalake"."analytics"."mart_total_unique_users__dbt_tmp"
      
      
    as (
      

SELECT
    total_unique_users
FROM "datalake"."analytics_stage"."stg_unique_users"
    )
[0m14:09:04.509675 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m14:09:04.813808 [debug] [Thread-1 (]: SQL status: SUCCESS in 0.0 seconds
[0m14:09:04.819735 [debug] [Thread-1 (]: Using trino connection "model.my_dbt_trino_project.mart_total_unique_users"
[0m14:09:04.820277 [debug] [Thread-1 (]: On model.my_dbt_trino_project.mart_total_unique_users: /* {"app": "dbt", "dbt_version": "1.8.2", "profile_name": "my_dbt_trino_project", "target_name": "dev", "node_id": "model.my_dbt_trino_project.mart_total_unique_users"} */
alter table "datalake"."analytics"."mart_total_unique_users" rename to "datalake"."analytics"."mart_total_unique_users__dbt_backup"
[0m14:09:04.911435 [debug] [Thread-1 (]: SQL status: SUCCESS in 0.0 seconds
[0m14:09:04.914718 [debug] [Thread-1 (]: Using trino connection "model.my_dbt_trino_project.mart_total_unique_users"
[0m14:09:04.915256 [debug] [Thread-1 (]: On model.my_dbt_trino_project.mart_total_unique_users: /* {"app": "dbt", "dbt_version": "1.8.2", "profile_name": "my_dbt_trino_project", "target_name": "dev", "node_id": "model.my_dbt_trino_project.mart_total_unique_users"} */
alter table "datalake"."analytics"."mart_total_unique_users__dbt_tmp" rename to "datalake"."analytics"."mart_total_unique_users"
[0m14:09:05.015036 [debug] [Thread-1 (]: SQL status: SUCCESS in 0.0 seconds
[0m14:09:05.017791 [debug] [Thread-1 (]: Applying DROP to: "datalake"."analytics"."mart_total_unique_users__dbt_backup"
[0m14:09:05.018856 [debug] [Thread-1 (]: Using trino connection "model.my_dbt_trino_project.mart_total_unique_users"
[0m14:09:05.019398 [debug] [Thread-1 (]: On model.my_dbt_trino_project.mart_total_unique_users: /* {"app": "dbt", "dbt_version": "1.8.2", "profile_name": "my_dbt_trino_project", "target_name": "dev", "node_id": "model.my_dbt_trino_project.mart_total_unique_users"} */

    drop table if exists "datalake"."analytics"."mart_total_unique_users__dbt_backup"
[0m14:09:05.160003 [debug] [Thread-1 (]: SQL status: SUCCESS in 0.0 seconds
[0m14:09:05.161607 [debug] [Thread-1 (]: On model.my_dbt_trino_project.mart_total_unique_users: ROLLBACK
[0m14:09:05.162152 [debug] [Thread-1 (]: On model.my_dbt_trino_project.mart_total_unique_users: Close
[0m14:09:05.162694 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '57a20281-fad0-4949-9f09-0caec42a9290', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000001CD1EE940D0>]}
[0m14:09:05.163791 [info ] [Thread-1 (]: 13 of 15 OK created sql table model analytics.mart_total_unique_users .......... [[32mSUCCESS[0m in 0.66s]
[0m14:09:05.164851 [debug] [Thread-1 (]: Finished running node model.my_dbt_trino_project.mart_total_unique_users
[0m14:09:05.165385 [debug] [Thread-1 (]: Began running node model.my_dbt_trino_project.mart_user_activity_per_country
[0m14:09:05.165936 [info ] [Thread-1 (]: 14 of 15 SKIP relation analytics.mart_user_activity_per_country ................ [[33mSKIP[0m]
[0m14:09:05.166473 [debug] [Thread-1 (]: Finished running node model.my_dbt_trino_project.mart_user_activity_per_country
[0m14:09:05.166988 [debug] [Thread-1 (]: Began running node model.my_dbt_trino_project.mart_user_activity_per_state
[0m14:09:05.167512 [info ] [Thread-1 (]: 15 of 15 START sql table model analytics.mart_user_activity_per_state .......... [RUN]
[0m14:09:05.168584 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.my_dbt_trino_project.mart_total_unique_users, now model.my_dbt_trino_project.mart_user_activity_per_state)
[0m14:09:05.169129 [debug] [Thread-1 (]: Began compiling node model.my_dbt_trino_project.mart_user_activity_per_state
[0m14:09:05.171784 [debug] [Thread-1 (]: Writing injected SQL for node "model.my_dbt_trino_project.mart_user_activity_per_state"
[0m14:09:05.172784 [debug] [Thread-1 (]: Began executing node model.my_dbt_trino_project.mart_user_activity_per_state
[0m14:09:05.175811 [debug] [Thread-1 (]: Writing runtime sql for node "model.my_dbt_trino_project.mart_user_activity_per_state"
[0m14:09:05.177790 [debug] [Thread-1 (]: Using trino connection "model.my_dbt_trino_project.mart_user_activity_per_state"
[0m14:09:05.177790 [debug] [Thread-1 (]: On model.my_dbt_trino_project.mart_user_activity_per_state: /* {"app": "dbt", "dbt_version": "1.8.2", "profile_name": "my_dbt_trino_project", "target_name": "dev", "node_id": "model.my_dbt_trino_project.mart_user_activity_per_state"} */

  
    

    create table "datalake"."analytics"."mart_user_activity_per_state__dbt_tmp"
      
      
    as (
      

SELECT
  state,
  city,
  SUM(activity_count) AS total_activity
FROM "datalake"."analytics_stage"."stg_user_activity_per_location"
GROUP BY state, city
ORDER BY state, SUM(activity_count) DESC
    )
[0m14:09:05.177790 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m14:09:05.541738 [debug] [Thread-1 (]: SQL status: SUCCESS in 0.0 seconds
[0m14:09:05.544980 [debug] [Thread-1 (]: Using trino connection "model.my_dbt_trino_project.mart_user_activity_per_state"
[0m14:09:05.544980 [debug] [Thread-1 (]: On model.my_dbt_trino_project.mart_user_activity_per_state: /* {"app": "dbt", "dbt_version": "1.8.2", "profile_name": "my_dbt_trino_project", "target_name": "dev", "node_id": "model.my_dbt_trino_project.mart_user_activity_per_state"} */
alter table "datalake"."analytics"."mart_user_activity_per_state" rename to "datalake"."analytics"."mart_user_activity_per_state__dbt_backup"
[0m14:09:05.650852 [debug] [Thread-1 (]: SQL status: SUCCESS in 0.0 seconds
[0m14:09:05.654056 [debug] [Thread-1 (]: Using trino connection "model.my_dbt_trino_project.mart_user_activity_per_state"
[0m14:09:05.654056 [debug] [Thread-1 (]: On model.my_dbt_trino_project.mart_user_activity_per_state: /* {"app": "dbt", "dbt_version": "1.8.2", "profile_name": "my_dbt_trino_project", "target_name": "dev", "node_id": "model.my_dbt_trino_project.mart_user_activity_per_state"} */
alter table "datalake"."analytics"."mart_user_activity_per_state__dbt_tmp" rename to "datalake"."analytics"."mart_user_activity_per_state"
[0m14:09:05.760668 [debug] [Thread-1 (]: SQL status: SUCCESS in 0.0 seconds
[0m14:09:05.763895 [debug] [Thread-1 (]: Applying DROP to: "datalake"."analytics"."mart_user_activity_per_state__dbt_backup"
[0m14:09:05.764525 [debug] [Thread-1 (]: Using trino connection "model.my_dbt_trino_project.mart_user_activity_per_state"
[0m14:09:05.765044 [debug] [Thread-1 (]: On model.my_dbt_trino_project.mart_user_activity_per_state: /* {"app": "dbt", "dbt_version": "1.8.2", "profile_name": "my_dbt_trino_project", "target_name": "dev", "node_id": "model.my_dbt_trino_project.mart_user_activity_per_state"} */

    drop table if exists "datalake"."analytics"."mart_user_activity_per_state__dbt_backup"
[0m14:09:05.901652 [debug] [Thread-1 (]: SQL status: SUCCESS in 0.0 seconds
[0m14:09:05.904330 [debug] [Thread-1 (]: On model.my_dbt_trino_project.mart_user_activity_per_state: ROLLBACK
[0m14:09:05.904835 [debug] [Thread-1 (]: On model.my_dbt_trino_project.mart_user_activity_per_state: Close
[0m14:09:05.905394 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '57a20281-fad0-4949-9f09-0caec42a9290', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000001CD1ED98050>]}
[0m14:09:05.906490 [info ] [Thread-1 (]: 15 of 15 OK created sql table model analytics.mart_user_activity_per_state ..... [[32mSUCCESS[0m in 0.74s]
[0m14:09:05.907069 [debug] [Thread-1 (]: Finished running node model.my_dbt_trino_project.mart_user_activity_per_state
[0m14:09:05.908137 [debug] [MainThread]: On master: COMMIT
[0m14:09:05.908669 [debug] [MainThread]: Connection 'master' was properly closed.
[0m14:09:05.908669 [debug] [MainThread]: Connection 'list_datalake' was properly closed.
[0m14:09:05.909214 [debug] [MainThread]: Connection 'list_datalake_analytics' was properly closed.
[0m14:09:05.909214 [debug] [MainThread]: Connection 'model.my_dbt_trino_project.mart_user_activity_per_state' was properly closed.
[0m14:09:05.909727 [info ] [MainThread]: 
[0m14:09:05.910265 [info ] [MainThread]: Finished running 8 table models, 2 incremental models, 5 view models in 0 hours 0 minutes and 7.60 seconds (7.60s).
[0m14:09:05.912968 [debug] [MainThread]: Command end result
[0m14:09:05.944938 [info ] [MainThread]: 
[0m14:09:05.945919 [info ] [MainThread]: [31mCompleted with 1 error and 0 warnings:[0m
[0m14:09:05.946917 [info ] [MainThread]: 
[0m14:09:05.947916 [error] [MainThread]:   Database Error in model stg_user_activity_per_country (models\stage\stg_user_activity_per_country.sql)
  TrinoUserError(type=USER_ERROR, name=TYPE_MISMATCH, message="line 17:3: UNION query has different number of fields: 4, 3", query_id=20240618_044315_00244_z97n2)
  compiled Code at target\run\my_dbt_trino_project\models\stage\stg_user_activity_per_country.sql
[0m14:09:05.950216 [info ] [MainThread]: 
[0m14:09:05.951234 [info ] [MainThread]: Done. PASS=13 WARN=0 ERROR=1 SKIP=1 TOTAL=15
[0m14:09:05.953225 [debug] [MainThread]: Command `dbt run` failed at 14:09:05.953225 after 8.46 seconds
[0m14:09:05.954230 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000001CD17F6E8D0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000001CD17F6F910>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000001CD1E914DD0>]}
[0m14:09:05.955226 [debug] [MainThread]: Flushing usage events
[0m15:21:37.503510 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x00000234834F68D0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x0000023483534A50>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x00000234834F8810>]}


============================== 15:21:37.503510 | d25bf2fa-805d-4fea-9c8c-8cda90f60c93 ==============================
[0m15:21:37.503510 [info ] [MainThread]: Running with dbt=1.8.2
[0m15:21:37.503510 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'indirect_selection': 'eager', 'log_cache_events': 'False', 'write_json': 'True', 'partial_parse': 'True', 'cache_selected_only': 'False', 'profiles_dir': 'C:\\Users\\ASUS\\Desktop\\work\\Iceberg-Dbt-Trino-Hive-modern-open-source-data-stack-main\\dbt', 'debug': 'False', 'warn_error': 'None', 'log_path': 'C:\\Users\\ASUS\\Desktop\\work\\Iceberg-Dbt-Trino-Hive-modern-open-source-data-stack-main\\dbt\\logs', 'fail_fast': 'False', 'version_check': 'True', 'use_colors': 'True', 'use_experimental_parser': 'False', 'no_print': 'None', 'quiet': 'False', 'log_format': 'default', 'invocation_command': 'dbt run', 'introspect': 'True', 'static_parser': 'True', 'target_path': 'None', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'send_anonymous_usage_stats': 'True'}
[0m15:21:37.825978 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': 'd25bf2fa-805d-4fea-9c8c-8cda90f60c93', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x0000023483534CD0>]}
[0m15:21:37.857809 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': 'd25bf2fa-805d-4fea-9c8c-8cda90f60c93', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x00000234806651D0>]}
[0m15:21:37.873316 [info ] [MainThread]: Registered adapter: trino=1.8.0
[0m15:21:37.873316 [debug] [MainThread]: checksum: f0a141b9de567cb7f131613ba2682f40b3a1c6a157f81c6e5435862eff68f109, vars: {}, profile: , target: , version: 1.8.2
[0m15:21:38.052218 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 0 files changed.
[0m15:21:38.053231 [debug] [MainThread]: Partial parsing enabled, no changes found, skipping parsing
[0m15:21:38.068242 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': 'd25bf2fa-805d-4fea-9c8c-8cda90f60c93', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x0000023483B94D50>]}
[0m15:21:38.147211 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': 'd25bf2fa-805d-4fea-9c8c-8cda90f60c93', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x0000023483A57B90>]}
[0m15:21:38.147211 [info ] [MainThread]: Found 15 models, 7 data tests, 3 sources, 559 macros
[0m15:21:38.147211 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': 'd25bf2fa-805d-4fea-9c8c-8cda90f60c93', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x0000023483C999D0>]}
[0m15:21:38.147211 [info ] [MainThread]: 
[0m15:21:38.147211 [debug] [MainThread]: Acquiring new trino connection 'master'
[0m15:21:38.163620 [debug] [ThreadPool]: Acquiring new trino connection 'list_datalake'
[0m15:21:38.243153 [debug] [ThreadPool]: Using trino connection "list_datalake"
[0m15:21:38.243153 [debug] [ThreadPool]: On list_datalake: /* {"app": "dbt", "dbt_version": "1.8.2", "profile_name": "my_dbt_trino_project", "target_name": "dev", "connection_name": "list_datalake"} */

    select schema_name
    from "datalake".INFORMATION_SCHEMA.schemata
[0m15:21:38.246534 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m15:21:38.356211 [debug] [ThreadPool]: SQL status: SUCCESS in 0.0 seconds
[0m15:21:38.357270 [debug] [ThreadPool]: On list_datalake: Close
[0m15:21:38.359225 [debug] [ThreadPool]: Using trino connection "list_datalake"
[0m15:21:38.359225 [debug] [ThreadPool]: On list_datalake: /* {"app": "dbt", "dbt_version": "1.8.2", "profile_name": "my_dbt_trino_project", "target_name": "dev", "connection_name": "list_datalake"} */

    select schema_name
    from "datalake".INFORMATION_SCHEMA.schemata
[0m15:21:38.359225 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m15:21:38.420321 [debug] [ThreadPool]: SQL status: SUCCESS in 0.0 seconds
[0m15:21:38.421372 [debug] [ThreadPool]: On list_datalake: Close
[0m15:21:38.424022 [debug] [ThreadPool]: Using trino connection "list_datalake"
[0m15:21:38.424550 [debug] [ThreadPool]: On list_datalake: /* {"app": "dbt", "dbt_version": "1.8.2", "profile_name": "my_dbt_trino_project", "target_name": "dev", "connection_name": "list_datalake"} */

    select schema_name
    from "datalake".INFORMATION_SCHEMA.schemata
[0m15:21:38.424550 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m15:21:38.484387 [debug] [ThreadPool]: SQL status: SUCCESS in 0.0 seconds
[0m15:21:38.485448 [debug] [ThreadPool]: On list_datalake: Close
[0m15:21:38.487576 [debug] [ThreadPool]: Acquiring new trino connection 'list_datalake_analytics_source'
[0m15:21:38.492595 [debug] [ThreadPool]: Using trino connection "list_datalake_analytics_source"
[0m15:21:38.492595 [debug] [ThreadPool]: On list_datalake_analytics_source: /* {"app": "dbt", "dbt_version": "1.8.2", "profile_name": "my_dbt_trino_project", "target_name": "dev", "connection_name": "list_datalake_analytics_source"} */
select
      t.table_catalog as database,
      t.table_name as name,
      t.table_schema as schema,
      case when mv.name is not null then 'materialized_view'
           when t.table_type = 'BASE TABLE' then 'table'
           when t.table_type = 'VIEW' then 'view'
           else t.table_type
      end as table_type
    from "datalake".INFORMATION_SCHEMA.tables t
    left join (
            select * from system.metadata.materialized_views
            where catalog_name = 'datalake'
              and schema_name = 'analytics_source') mv
          on mv.catalog_name = t.table_catalog and mv.schema_name = t.table_schema and mv.name = t.table_name
    where t.table_schema = 'analytics_source'
[0m15:21:38.492595 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m15:21:38.669932 [debug] [ThreadPool]: SQL status: SUCCESS in 0.0 seconds
[0m15:21:38.670968 [debug] [ThreadPool]: On list_datalake_analytics_source: ROLLBACK
[0m15:21:38.671488 [debug] [ThreadPool]: On list_datalake_analytics_source: Close
[0m15:21:38.672010 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_datalake_analytics_source, now list_datalake_analytics)
[0m15:21:38.675177 [debug] [ThreadPool]: Using trino connection "list_datalake_analytics"
[0m15:21:38.675711 [debug] [ThreadPool]: On list_datalake_analytics: /* {"app": "dbt", "dbt_version": "1.8.2", "profile_name": "my_dbt_trino_project", "target_name": "dev", "connection_name": "list_datalake_analytics"} */
select
      t.table_catalog as database,
      t.table_name as name,
      t.table_schema as schema,
      case when mv.name is not null then 'materialized_view'
           when t.table_type = 'BASE TABLE' then 'table'
           when t.table_type = 'VIEW' then 'view'
           else t.table_type
      end as table_type
    from "datalake".INFORMATION_SCHEMA.tables t
    left join (
            select * from system.metadata.materialized_views
            where catalog_name = 'datalake'
              and schema_name = 'analytics') mv
          on mv.catalog_name = t.table_catalog and mv.schema_name = t.table_schema and mv.name = t.table_name
    where t.table_schema = 'analytics'
[0m15:21:38.675711 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m15:21:38.818782 [debug] [ThreadPool]: SQL status: SUCCESS in 0.0 seconds
[0m15:21:38.819825 [debug] [ThreadPool]: On list_datalake_analytics: ROLLBACK
[0m15:21:38.820348 [debug] [ThreadPool]: On list_datalake_analytics: Close
[0m15:21:38.820881 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_datalake_analytics, now list_datalake_analytics_stage)
[0m15:21:38.824543 [debug] [ThreadPool]: Using trino connection "list_datalake_analytics_stage"
[0m15:21:38.824543 [debug] [ThreadPool]: On list_datalake_analytics_stage: /* {"app": "dbt", "dbt_version": "1.8.2", "profile_name": "my_dbt_trino_project", "target_name": "dev", "connection_name": "list_datalake_analytics_stage"} */
select
      t.table_catalog as database,
      t.table_name as name,
      t.table_schema as schema,
      case when mv.name is not null then 'materialized_view'
           when t.table_type = 'BASE TABLE' then 'table'
           when t.table_type = 'VIEW' then 'view'
           else t.table_type
      end as table_type
    from "datalake".INFORMATION_SCHEMA.tables t
    left join (
            select * from system.metadata.materialized_views
            where catalog_name = 'datalake'
              and schema_name = 'analytics_stage') mv
          on mv.catalog_name = t.table_catalog and mv.schema_name = t.table_schema and mv.name = t.table_name
    where t.table_schema = 'analytics_stage'
[0m15:21:38.825065 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m15:21:38.968963 [debug] [ThreadPool]: SQL status: SUCCESS in 0.0 seconds
[0m15:21:38.970015 [debug] [ThreadPool]: On list_datalake_analytics_stage: ROLLBACK
[0m15:21:38.970535 [debug] [ThreadPool]: On list_datalake_analytics_stage: Close
[0m15:21:38.972141 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': 'd25bf2fa-805d-4fea-9c8c-8cda90f60c93', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x0000023483F500D0>]}
[0m15:21:38.972141 [debug] [MainThread]: On master: COMMIT
[0m15:21:38.972666 [info ] [MainThread]: Concurrency: 1 threads (target='dev')
[0m15:21:38.973197 [info ] [MainThread]: 
[0m15:21:38.975826 [debug] [Thread-1 (]: Began running node model.my_dbt_trino_project.src_auth_events
[0m15:21:38.976350 [info ] [Thread-1 (]: 1 of 15 START sql table model analytics_source.src_auth_events ................. [RUN]
[0m15:21:38.976880 [debug] [Thread-1 (]: Acquiring new trino connection 'model.my_dbt_trino_project.src_auth_events'
[0m15:21:38.977407 [debug] [Thread-1 (]: Began compiling node model.my_dbt_trino_project.src_auth_events
[0m15:21:38.978994 [debug] [Thread-1 (]: Writing injected SQL for node "model.my_dbt_trino_project.src_auth_events"
[0m15:21:38.978994 [debug] [Thread-1 (]: Began executing node model.my_dbt_trino_project.src_auth_events
[0m15:21:39.018025 [debug] [Thread-1 (]: Writing runtime sql for node "model.my_dbt_trino_project.src_auth_events"
[0m15:21:39.023336 [debug] [Thread-1 (]: Using trino connection "model.my_dbt_trino_project.src_auth_events"
[0m15:21:39.023336 [debug] [Thread-1 (]: On model.my_dbt_trino_project.src_auth_events: /* {"app": "dbt", "dbt_version": "1.8.2", "profile_name": "my_dbt_trino_project", "target_name": "dev", "node_id": "model.my_dbt_trino_project.src_auth_events"} */

  
    

    create table "datalake"."analytics_source"."src_auth_events__dbt_tmp"
      
      
    as (
      

with source as (
    select
        CAST(ts AS VARCHAR) as id, 
        ts,
        CAST(sessionId AS VARCHAR) as sessionId,
        level,
        itemInSession,
        city,
        zip,
        state,
        userAgent,
        CAST(NULLIF(lon, '') AS double) as lon,
        CAST(NULLIF(lat, '') AS double) as lat,
        CAST(FLOOR(CAST(NULLIF(userId, '') AS DOUBLE)) AS INT) as userId, 
        lastName,
        firstName,
        gender,
        CAST(FLOOR(CAST(NULLIF(registration, '') AS DOUBLE)) AS BIGINT) as registration,
        success
    from "oltp"."public"."auth_events"
)

select
    id,
    ts,
    sessionId,
    level,
    itemInSession,
    city,
    zip,
    state,
    userAgent,
    lon,
    lat,
    userId,
    lastName,
    firstName,
    gender,
    registration, 
    CASE 
        WHEN CAST(success AS VARCHAR) = 't' THEN true 
        WHEN CAST(success AS VARCHAR) = 'f' THEN false
        ELSE NULL 
    END AS success_boolean
from source


    )
[0m15:21:39.023336 [debug] [Thread-1 (]: Opening a new connection, currently in state init
[0m15:21:39.771233 [debug] [Thread-1 (]: SQL status: SUCCESS in 1.0 seconds
[0m15:21:39.772303 [debug] [Thread-1 (]: Using trino connection "model.my_dbt_trino_project.src_auth_events"
[0m15:21:39.772303 [debug] [Thread-1 (]: On model.my_dbt_trino_project.src_auth_events: /* {"app": "dbt", "dbt_version": "1.8.2", "profile_name": "my_dbt_trino_project", "target_name": "dev", "node_id": "model.my_dbt_trino_project.src_auth_events"} */
alter table "datalake"."analytics_source"."src_auth_events" rename to "datalake"."analytics_source"."src_auth_events__dbt_backup"
[0m15:21:39.884295 [debug] [Thread-1 (]: SQL status: SUCCESS in 0.0 seconds
[0m15:21:39.887459 [debug] [Thread-1 (]: Using trino connection "model.my_dbt_trino_project.src_auth_events"
[0m15:21:39.887459 [debug] [Thread-1 (]: On model.my_dbt_trino_project.src_auth_events: /* {"app": "dbt", "dbt_version": "1.8.2", "profile_name": "my_dbt_trino_project", "target_name": "dev", "node_id": "model.my_dbt_trino_project.src_auth_events"} */
alter table "datalake"."analytics_source"."src_auth_events__dbt_tmp" rename to "datalake"."analytics_source"."src_auth_events"
[0m15:21:39.948708 [debug] [Thread-1 (]: SQL status: SUCCESS in 0.0 seconds
[0m15:21:39.954465 [debug] [Thread-1 (]: Applying DROP to: "datalake"."analytics_source"."src_auth_events__dbt_backup"
[0m15:21:39.956059 [debug] [Thread-1 (]: Using trino connection "model.my_dbt_trino_project.src_auth_events"
[0m15:21:39.956059 [debug] [Thread-1 (]: On model.my_dbt_trino_project.src_auth_events: /* {"app": "dbt", "dbt_version": "1.8.2", "profile_name": "my_dbt_trino_project", "target_name": "dev", "node_id": "model.my_dbt_trino_project.src_auth_events"} */

    drop table if exists "datalake"."analytics_source"."src_auth_events__dbt_backup"
[0m15:21:40.141591 [debug] [Thread-1 (]: SQL status: SUCCESS in 0.0 seconds
[0m15:21:40.153040 [debug] [Thread-1 (]: On model.my_dbt_trino_project.src_auth_events: ROLLBACK
[0m15:21:40.153040 [debug] [Thread-1 (]: On model.my_dbt_trino_project.src_auth_events: Close
[0m15:21:40.153040 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'd25bf2fa-805d-4fea-9c8c-8cda90f60c93', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x0000023484398350>]}
[0m15:21:40.153040 [info ] [Thread-1 (]: 1 of 15 OK created sql table model analytics_source.src_auth_events ............ [[32mSUCCESS[0m in 1.18s]
[0m15:21:40.153040 [debug] [Thread-1 (]: Finished running node model.my_dbt_trino_project.src_auth_events
[0m15:21:40.153040 [debug] [Thread-1 (]: Began running node model.my_dbt_trino_project.src_listen_events
[0m15:21:40.153040 [info ] [Thread-1 (]: 2 of 15 START sql incremental model analytics_source.src_listen_events ......... [RUN]
[0m15:21:40.153040 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.my_dbt_trino_project.src_auth_events, now model.my_dbt_trino_project.src_listen_events)
[0m15:21:40.158047 [debug] [Thread-1 (]: Began compiling node model.my_dbt_trino_project.src_listen_events
[0m15:21:40.158594 [debug] [Thread-1 (]: Writing injected SQL for node "model.my_dbt_trino_project.src_listen_events"
[0m15:21:40.158594 [debug] [Thread-1 (]: Began executing node model.my_dbt_trino_project.src_listen_events
[0m15:21:40.175496 [debug] [Thread-1 (]: Using trino connection "model.my_dbt_trino_project.src_listen_events"
[0m15:21:40.175496 [debug] [Thread-1 (]: On model.my_dbt_trino_project.src_listen_events: /* {"app": "dbt", "dbt_version": "1.8.2", "profile_name": "my_dbt_trino_project", "target_name": "dev", "node_id": "model.my_dbt_trino_project.src_listen_events"} */

  
    

    create table "datalake"."analytics_source"."src_listen_events__dbt_tmp"
      
      
    as (
      

with source as (

    select
        CAST(_id AS VARCHAR) as id,
        artist,
        song,
        CAST(NULLIF(duration, '') AS DOUBLE) as duration,
        ts,
        sessionid,
        auth,
        level,
        CAST(NULLIF(itemInSession, '') AS INTEGER) as itemInSession,
        city,
        zip,
        state,
        country,
        userAgent,
        CAST(NULLIF(lon, '') AS DOUBLE) as lon,
        CAST(NULLIF(lat, '') AS DOUBLE) as lat,
        CAST(CAST(NULLIF(userId, '') AS DOUBLE) AS INTEGER) as userId,
 -- Assurez-vous que userId peut aussi être converti de cette manière.
        lastName,
        firstName,
        gender,
        CAST(CAST(NULLIF(registration, '') AS DOUBLE) AS BIGINT) as registration
    from "website"."demo"."listen_events"

)

select * from source



    -- this filter will only be applied on an incremental run
    where ts > (select max(ts) from "datalake"."analytics_source"."src_listen_events")


    )
[0m15:21:40.175496 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m15:21:40.580121 [debug] [Thread-1 (]: SQL status: SUCCESS in 0.0 seconds
[0m15:21:40.590163 [debug] [Thread-1 (]: Using trino connection "model.my_dbt_trino_project.src_listen_events"
[0m15:21:40.590163 [debug] [Thread-1 (]: On model.my_dbt_trino_project.src_listen_events: /* {"app": "dbt", "dbt_version": "1.8.2", "profile_name": "my_dbt_trino_project", "target_name": "dev", "node_id": "model.my_dbt_trino_project.src_listen_events"} */

    describe "datalake"."analytics_source"."src_listen_events__dbt_tmp"
[0m15:21:40.742987 [debug] [Thread-1 (]: SQL status: SUCCESS in 0.0 seconds
[0m15:21:40.746180 [debug] [Thread-1 (]: Using trino connection "model.my_dbt_trino_project.src_listen_events"
[0m15:21:40.746688 [debug] [Thread-1 (]: On model.my_dbt_trino_project.src_listen_events: /* {"app": "dbt", "dbt_version": "1.8.2", "profile_name": "my_dbt_trino_project", "target_name": "dev", "node_id": "model.my_dbt_trino_project.src_listen_events"} */

    describe "datalake"."analytics_source"."src_listen_events"
[0m15:21:40.882803 [debug] [Thread-1 (]: SQL status: SUCCESS in 0.0 seconds
[0m15:21:40.889187 [debug] [Thread-1 (]: Using trino connection "model.my_dbt_trino_project.src_listen_events"
[0m15:21:40.889709 [debug] [Thread-1 (]: On model.my_dbt_trino_project.src_listen_events: /* {"app": "dbt", "dbt_version": "1.8.2", "profile_name": "my_dbt_trino_project", "target_name": "dev", "node_id": "model.my_dbt_trino_project.src_listen_events"} */

    describe "datalake"."analytics_source"."src_listen_events"
[0m15:21:41.030743 [debug] [Thread-1 (]: SQL status: SUCCESS in 0.0 seconds
[0m15:21:41.039241 [debug] [Thread-1 (]: Writing runtime sql for node "model.my_dbt_trino_project.src_listen_events"
[0m15:21:41.040846 [debug] [Thread-1 (]: Using trino connection "model.my_dbt_trino_project.src_listen_events"
[0m15:21:41.040846 [debug] [Thread-1 (]: On model.my_dbt_trino_project.src_listen_events: /* {"app": "dbt", "dbt_version": "1.8.2", "profile_name": "my_dbt_trino_project", "target_name": "dev", "node_id": "model.my_dbt_trino_project.src_listen_events"} */
insert into "datalake"."analytics_source"."src_listen_events" ("id", "artist", "song", "duration", "ts", "sessionid", "auth", "level", "iteminsession", "city", "zip", "state", "country", "useragent", "lon", "lat", "userid", "lastname", "firstname", "gender", "registration")
    (
        select "id", "artist", "song", "duration", "ts", "sessionid", "auth", "level", "iteminsession", "city", "zip", "state", "country", "useragent", "lon", "lat", "userid", "lastname", "firstname", "gender", "registration"
        from "datalake"."analytics_source"."src_listen_events__dbt_tmp"
    )
[0m15:21:41.226102 [debug] [Thread-1 (]: SQL status: SUCCESS in 0.0 seconds
[0m15:21:41.229332 [debug] [Thread-1 (]: Applying DROP to: "datalake"."analytics_source"."src_listen_events__dbt_tmp"
[0m15:21:41.229867 [debug] [Thread-1 (]: Using trino connection "model.my_dbt_trino_project.src_listen_events"
[0m15:21:41.230400 [debug] [Thread-1 (]: On model.my_dbt_trino_project.src_listen_events: /* {"app": "dbt", "dbt_version": "1.8.2", "profile_name": "my_dbt_trino_project", "target_name": "dev", "node_id": "model.my_dbt_trino_project.src_listen_events"} */

    drop table if exists "datalake"."analytics_source"."src_listen_events__dbt_tmp"
[0m15:21:41.356238 [debug] [Thread-1 (]: SQL status: SUCCESS in 0.0 seconds
[0m15:21:41.357838 [debug] [Thread-1 (]: On model.my_dbt_trino_project.src_listen_events: ROLLBACK
[0m15:21:41.357838 [debug] [Thread-1 (]: On model.my_dbt_trino_project.src_listen_events: Close
[0m15:21:41.358915 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'd25bf2fa-805d-4fea-9c8c-8cda90f60c93', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x0000023483F76F50>]}
[0m15:21:41.359448 [info ] [Thread-1 (]: 2 of 15 OK created sql incremental model analytics_source.src_listen_events .... [[32mSUCCESS[0m in 1.21s]
[0m15:21:41.360507 [debug] [Thread-1 (]: Finished running node model.my_dbt_trino_project.src_listen_events
[0m15:21:41.361029 [debug] [Thread-1 (]: Began running node model.my_dbt_trino_project.src_page_view_events
[0m15:21:41.361549 [info ] [Thread-1 (]: 3 of 15 START sql incremental model analytics_source.src_page_view_events ...... [RUN]
[0m15:21:41.362071 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.my_dbt_trino_project.src_listen_events, now model.my_dbt_trino_project.src_page_view_events)
[0m15:21:41.362587 [debug] [Thread-1 (]: Began compiling node model.my_dbt_trino_project.src_page_view_events
[0m15:21:41.365745 [debug] [Thread-1 (]: Writing injected SQL for node "model.my_dbt_trino_project.src_page_view_events"
[0m15:21:41.366800 [debug] [Thread-1 (]: Began executing node model.my_dbt_trino_project.src_page_view_events
[0m15:21:41.366800 [debug] [Thread-1 (]: Using trino connection "model.my_dbt_trino_project.src_page_view_events"
[0m15:21:41.366800 [debug] [Thread-1 (]: On model.my_dbt_trino_project.src_page_view_events: /* {"app": "dbt", "dbt_version": "1.8.2", "profile_name": "my_dbt_trino_project", "target_name": "dev", "node_id": "model.my_dbt_trino_project.src_page_view_events"} */

  
    

    create table "datalake"."analytics_source"."src_page_view_events__dbt_tmp"
      
      
    as (
      

with source as (
    select
        CAST(_id AS VARCHAR) as id,
        ts,
        CAST(sessionId AS VARCHAR) as sessionId,
        page,
        auth,
        level,
        CAST(CAST(NULLIF(itemInSession, '') AS DOUBLE) AS INTEGER) as itemInSession, 
        city,
        zip,
        state,
        userAgent,
        CAST(NULLIF(lon, '') AS double) as lon,
        CAST(NULLIF(lat, '') AS double) as lat,
        CAST(CAST(NULLIF(userId, '') AS DOUBLE) AS INTEGER) as userId, 
        lastName,
        firstName,
        gender,
        CAST(CAST(NULLIF(registration, '') AS DOUBLE) AS BIGINT) as registration, 
        artist,
        song,
        CAST(NULLIF(duration, '') AS double) as duration
    from "website"."demo"."page_view_events"
)

select * from source


    where ts > (select max(ts) from "datalake"."analytics_source"."src_page_view_events")

    )
[0m15:21:41.366800 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m15:21:41.683915 [debug] [Thread-1 (]: SQL status: SUCCESS in 0.0 seconds
[0m15:21:41.686522 [debug] [Thread-1 (]: Using trino connection "model.my_dbt_trino_project.src_page_view_events"
[0m15:21:41.687041 [debug] [Thread-1 (]: On model.my_dbt_trino_project.src_page_view_events: /* {"app": "dbt", "dbt_version": "1.8.2", "profile_name": "my_dbt_trino_project", "target_name": "dev", "node_id": "model.my_dbt_trino_project.src_page_view_events"} */

    describe "datalake"."analytics_source"."src_page_view_events__dbt_tmp"
[0m15:21:41.821766 [debug] [Thread-1 (]: SQL status: SUCCESS in 0.0 seconds
[0m15:21:41.825934 [debug] [Thread-1 (]: Using trino connection "model.my_dbt_trino_project.src_page_view_events"
[0m15:21:41.826457 [debug] [Thread-1 (]: On model.my_dbt_trino_project.src_page_view_events: /* {"app": "dbt", "dbt_version": "1.8.2", "profile_name": "my_dbt_trino_project", "target_name": "dev", "node_id": "model.my_dbt_trino_project.src_page_view_events"} */

    describe "datalake"."analytics_source"."src_page_view_events"
[0m15:21:41.962501 [debug] [Thread-1 (]: SQL status: SUCCESS in 0.0 seconds
[0m15:21:42.002079 [debug] [Thread-1 (]: Using trino connection "model.my_dbt_trino_project.src_page_view_events"
[0m15:21:42.002079 [debug] [Thread-1 (]: On model.my_dbt_trino_project.src_page_view_events: /* {"app": "dbt", "dbt_version": "1.8.2", "profile_name": "my_dbt_trino_project", "target_name": "dev", "node_id": "model.my_dbt_trino_project.src_page_view_events"} */

    describe "datalake"."analytics_source"."src_page_view_events"
[0m15:21:42.159056 [debug] [Thread-1 (]: SQL status: SUCCESS in 0.0 seconds
[0m15:21:42.160635 [debug] [Thread-1 (]: Writing runtime sql for node "model.my_dbt_trino_project.src_page_view_events"
[0m15:21:42.162718 [debug] [Thread-1 (]: Using trino connection "model.my_dbt_trino_project.src_page_view_events"
[0m15:21:42.163246 [debug] [Thread-1 (]: On model.my_dbt_trino_project.src_page_view_events: /* {"app": "dbt", "dbt_version": "1.8.2", "profile_name": "my_dbt_trino_project", "target_name": "dev", "node_id": "model.my_dbt_trino_project.src_page_view_events"} */
insert into "datalake"."analytics_source"."src_page_view_events" ("id", "ts", "sessionid", "page", "auth", "level", "iteminsession", "city", "zip", "state", "useragent", "lon", "lat", "userid", "lastname", "firstname", "gender", "registration", "artist", "song", "duration")
    (
        select "id", "ts", "sessionid", "page", "auth", "level", "iteminsession", "city", "zip", "state", "useragent", "lon", "lat", "userid", "lastname", "firstname", "gender", "registration", "artist", "song", "duration"
        from "datalake"."analytics_source"."src_page_view_events__dbt_tmp"
    )
[0m15:21:42.358499 [debug] [Thread-1 (]: SQL status: SUCCESS in 0.0 seconds
[0m15:21:42.361153 [debug] [Thread-1 (]: Applying DROP to: "datalake"."analytics_source"."src_page_view_events__dbt_tmp"
[0m15:21:42.361676 [debug] [Thread-1 (]: Using trino connection "model.my_dbt_trino_project.src_page_view_events"
[0m15:21:42.362196 [debug] [Thread-1 (]: On model.my_dbt_trino_project.src_page_view_events: /* {"app": "dbt", "dbt_version": "1.8.2", "profile_name": "my_dbt_trino_project", "target_name": "dev", "node_id": "model.my_dbt_trino_project.src_page_view_events"} */

    drop table if exists "datalake"."analytics_source"."src_page_view_events__dbt_tmp"
[0m15:21:42.481232 [debug] [Thread-1 (]: SQL status: SUCCESS in 0.0 seconds
[0m15:21:42.482819 [debug] [Thread-1 (]: On model.my_dbt_trino_project.src_page_view_events: ROLLBACK
[0m15:21:42.482819 [debug] [Thread-1 (]: On model.my_dbt_trino_project.src_page_view_events: Close
[0m15:21:42.483338 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'd25bf2fa-805d-4fea-9c8c-8cda90f60c93', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x0000023484465310>]}
[0m15:21:42.483871 [info ] [Thread-1 (]: 3 of 15 OK created sql incremental model analytics_source.src_page_view_events . [[32mSUCCESS[0m in 1.12s]
[0m15:21:42.484940 [debug] [Thread-1 (]: Finished running node model.my_dbt_trino_project.src_page_view_events
[0m15:21:42.484940 [debug] [Thread-1 (]: Began running node model.my_dbt_trino_project.stg_user_level_by_gender
[0m15:21:42.485467 [info ] [Thread-1 (]: 4 of 15 START sql view model analytics_stage.stg_user_level_by_gender .......... [RUN]
[0m15:21:42.486513 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.my_dbt_trino_project.src_page_view_events, now model.my_dbt_trino_project.stg_user_level_by_gender)
[0m15:21:42.486513 [debug] [Thread-1 (]: Began compiling node model.my_dbt_trino_project.stg_user_level_by_gender
[0m15:21:42.489149 [debug] [Thread-1 (]: Writing injected SQL for node "model.my_dbt_trino_project.stg_user_level_by_gender"
[0m15:21:42.489681 [debug] [Thread-1 (]: Began executing node model.my_dbt_trino_project.stg_user_level_by_gender
[0m15:21:42.494175 [debug] [Thread-1 (]: Writing runtime sql for node "model.my_dbt_trino_project.stg_user_level_by_gender"
[0m15:21:42.494175 [debug] [Thread-1 (]: Using trino connection "model.my_dbt_trino_project.stg_user_level_by_gender"
[0m15:21:42.494175 [debug] [Thread-1 (]: On model.my_dbt_trino_project.stg_user_level_by_gender: /* {"app": "dbt", "dbt_version": "1.8.2", "profile_name": "my_dbt_trino_project", "target_name": "dev", "node_id": "model.my_dbt_trino_project.stg_user_level_by_gender"} */

  create or replace view
    "datalake"."analytics_stage"."stg_user_level_by_gender"
  security definer
  as
    

WITH user_subscriptions AS (
    SELECT
        gender,
        level, 
        COUNT(DISTINCT userId) AS user_count
    FROM "datalake"."analytics_source"."src_auth_events"
    WHERE gender IS NOT NULL AND level IS NOT NULL
    GROUP BY gender, level
)

SELECT
    gender,
    level,
    user_count
FROM user_subscriptions
  
[0m15:21:42.494175 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m15:21:42.589396 [debug] [Thread-1 (]: SQL status: SUCCESS in 0.0 seconds
[0m15:21:42.590956 [debug] [Thread-1 (]: On model.my_dbt_trino_project.stg_user_level_by_gender: ROLLBACK
[0m15:21:42.591474 [debug] [Thread-1 (]: On model.my_dbt_trino_project.stg_user_level_by_gender: Close
[0m15:21:42.592019 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'd25bf2fa-805d-4fea-9c8c-8cda90f60c93', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x0000023482F15B50>]}
[0m15:21:42.592546 [info ] [Thread-1 (]: 4 of 15 OK created sql view model analytics_stage.stg_user_level_by_gender ..... [[32mSUCCESS[0m in 0.11s]
[0m15:21:42.593603 [debug] [Thread-1 (]: Finished running node model.my_dbt_trino_project.stg_user_level_by_gender
[0m15:21:42.593603 [debug] [Thread-1 (]: Began running node model.my_dbt_trino_project.stg_streams_hourly
[0m15:21:42.594131 [info ] [Thread-1 (]: 5 of 15 START sql table model analytics_stage.stg_streams_hourly ............... [RUN]
[0m15:21:42.594652 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.my_dbt_trino_project.stg_user_level_by_gender, now model.my_dbt_trino_project.stg_streams_hourly)
[0m15:21:42.595178 [debug] [Thread-1 (]: Began compiling node model.my_dbt_trino_project.stg_streams_hourly
[0m15:21:42.597805 [debug] [Thread-1 (]: Writing injected SQL for node "model.my_dbt_trino_project.stg_streams_hourly"
[0m15:21:42.598335 [debug] [Thread-1 (]: Began executing node model.my_dbt_trino_project.stg_streams_hourly
[0m15:21:42.600941 [debug] [Thread-1 (]: Writing runtime sql for node "model.my_dbt_trino_project.stg_streams_hourly"
[0m15:21:42.601982 [debug] [Thread-1 (]: Using trino connection "model.my_dbt_trino_project.stg_streams_hourly"
[0m15:21:42.602506 [debug] [Thread-1 (]: On model.my_dbt_trino_project.stg_streams_hourly: /* {"app": "dbt", "dbt_version": "1.8.2", "profile_name": "my_dbt_trino_project", "target_name": "dev", "node_id": "model.my_dbt_trino_project.stg_streams_hourly"} */

  
    

    create table "datalake"."analytics_stage"."stg_streams_hourly__dbt_tmp"
      
      
    as (
      

SELECT
    DATE_FORMAT(FROM_UNIXTIME(ts), '%Y-%m-%d') AS stream_date, 
    DATE_FORMAT(FROM_UNIXTIME(ts), '%H') AS stream_hour,
    COUNT(*) AS total_streams
FROM "datalake"."analytics_source"."src_listen_events"
GROUP BY
    DATE_FORMAT(FROM_UNIXTIME(ts), '%Y-%m-%d'),
    DATE_FORMAT(FROM_UNIXTIME(ts), '%H')
    )
[0m15:21:42.603034 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m15:21:42.988260 [debug] [Thread-1 (]: SQL status: SUCCESS in 0.0 seconds
[0m15:21:42.991416 [debug] [Thread-1 (]: Using trino connection "model.my_dbt_trino_project.stg_streams_hourly"
[0m15:21:42.991942 [debug] [Thread-1 (]: On model.my_dbt_trino_project.stg_streams_hourly: /* {"app": "dbt", "dbt_version": "1.8.2", "profile_name": "my_dbt_trino_project", "target_name": "dev", "node_id": "model.my_dbt_trino_project.stg_streams_hourly"} */
alter table "datalake"."analytics_stage"."stg_streams_hourly" rename to "datalake"."analytics_stage"."stg_streams_hourly__dbt_backup"
[0m15:21:43.101824 [debug] [Thread-1 (]: SQL status: SUCCESS in 0.0 seconds
[0m15:21:43.106030 [debug] [Thread-1 (]: Using trino connection "model.my_dbt_trino_project.stg_streams_hourly"
[0m15:21:43.106030 [debug] [Thread-1 (]: On model.my_dbt_trino_project.stg_streams_hourly: /* {"app": "dbt", "dbt_version": "1.8.2", "profile_name": "my_dbt_trino_project", "target_name": "dev", "node_id": "model.my_dbt_trino_project.stg_streams_hourly"} */
alter table "datalake"."analytics_stage"."stg_streams_hourly__dbt_tmp" rename to "datalake"."analytics_stage"."stg_streams_hourly"
[0m15:21:43.208591 [debug] [Thread-1 (]: SQL status: SUCCESS in 0.0 seconds
[0m15:21:43.211251 [debug] [Thread-1 (]: Applying DROP to: "datalake"."analytics_stage"."stg_streams_hourly__dbt_backup"
[0m15:21:43.212301 [debug] [Thread-1 (]: Using trino connection "model.my_dbt_trino_project.stg_streams_hourly"
[0m15:21:43.212301 [debug] [Thread-1 (]: On model.my_dbt_trino_project.stg_streams_hourly: /* {"app": "dbt", "dbt_version": "1.8.2", "profile_name": "my_dbt_trino_project", "target_name": "dev", "node_id": "model.my_dbt_trino_project.stg_streams_hourly"} */

    drop table if exists "datalake"."analytics_stage"."stg_streams_hourly__dbt_backup"
[0m15:21:43.368999 [debug] [Thread-1 (]: SQL status: SUCCESS in 0.0 seconds
[0m15:21:43.370579 [debug] [Thread-1 (]: On model.my_dbt_trino_project.stg_streams_hourly: ROLLBACK
[0m15:21:43.371111 [debug] [Thread-1 (]: On model.my_dbt_trino_project.stg_streams_hourly: Close
[0m15:21:43.371630 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'd25bf2fa-805d-4fea-9c8c-8cda90f60c93', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x00000234843C3A10>]}
[0m15:21:43.372156 [info ] [Thread-1 (]: 5 of 15 OK created sql table model analytics_stage.stg_streams_hourly .......... [[32mSUCCESS[0m in 0.78s]
[0m15:21:43.372688 [debug] [Thread-1 (]: Finished running node model.my_dbt_trino_project.stg_streams_hourly
[0m15:21:43.373208 [debug] [Thread-1 (]: Began running node model.my_dbt_trino_project.stg_top_songs_artists
[0m15:21:43.373730 [info ] [Thread-1 (]: 6 of 15 START sql view model analytics_stage.stg_top_songs_artists ............. [RUN]
[0m15:21:43.374252 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.my_dbt_trino_project.stg_streams_hourly, now model.my_dbt_trino_project.stg_top_songs_artists)
[0m15:21:43.374797 [debug] [Thread-1 (]: Began compiling node model.my_dbt_trino_project.stg_top_songs_artists
[0m15:21:43.376912 [debug] [Thread-1 (]: Writing injected SQL for node "model.my_dbt_trino_project.stg_top_songs_artists"
[0m15:21:43.377433 [debug] [Thread-1 (]: Began executing node model.my_dbt_trino_project.stg_top_songs_artists
[0m15:21:43.379567 [debug] [Thread-1 (]: Writing runtime sql for node "model.my_dbt_trino_project.stg_top_songs_artists"
[0m15:21:43.381171 [debug] [Thread-1 (]: Using trino connection "model.my_dbt_trino_project.stg_top_songs_artists"
[0m15:21:43.381703 [debug] [Thread-1 (]: On model.my_dbt_trino_project.stg_top_songs_artists: /* {"app": "dbt", "dbt_version": "1.8.2", "profile_name": "my_dbt_trino_project", "target_name": "dev", "node_id": "model.my_dbt_trino_project.stg_top_songs_artists"} */

  create or replace view
    "datalake"."analytics_stage"."stg_top_songs_artists"
  security definer
  as
    

WITH song_plays AS (
    SELECT
        artist,
        song,
        COUNT(*) AS play_count
    FROM "datalake"."analytics_source"."src_listen_events"
    GROUP BY artist, song
)

SELECT
    artist,
    song,
    play_count
FROM song_plays
ORDER BY play_count DESC
  
[0m15:21:43.381703 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m15:21:43.464161 [debug] [Thread-1 (]: SQL status: SUCCESS in 0.0 seconds
[0m15:21:43.465744 [debug] [Thread-1 (]: On model.my_dbt_trino_project.stg_top_songs_artists: ROLLBACK
[0m15:21:43.466270 [debug] [Thread-1 (]: On model.my_dbt_trino_project.stg_top_songs_artists: Close
[0m15:21:43.466795 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'd25bf2fa-805d-4fea-9c8c-8cda90f60c93', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x0000023483BBCD90>]}
[0m15:21:43.467316 [info ] [Thread-1 (]: 6 of 15 OK created sql view model analytics_stage.stg_top_songs_artists ........ [[32mSUCCESS[0m in 0.09s]
[0m15:21:43.468393 [debug] [Thread-1 (]: Finished running node model.my_dbt_trino_project.stg_top_songs_artists
[0m15:21:43.468945 [debug] [Thread-1 (]: Began running node model.my_dbt_trino_project.stg_unique_users
[0m15:21:43.469468 [info ] [Thread-1 (]: 7 of 15 START sql view model analytics_stage.stg_unique_users .................. [RUN]
[0m15:21:43.469994 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.my_dbt_trino_project.stg_top_songs_artists, now model.my_dbt_trino_project.stg_unique_users)
[0m15:21:43.470528 [debug] [Thread-1 (]: Began compiling node model.my_dbt_trino_project.stg_unique_users
[0m15:21:43.473122 [debug] [Thread-1 (]: Writing injected SQL for node "model.my_dbt_trino_project.stg_unique_users"
[0m15:21:43.473644 [debug] [Thread-1 (]: Began executing node model.my_dbt_trino_project.stg_unique_users
[0m15:21:43.474170 [debug] [Thread-1 (]: Writing runtime sql for node "model.my_dbt_trino_project.stg_unique_users"
[0m15:21:43.474170 [debug] [Thread-1 (]: Using trino connection "model.my_dbt_trino_project.stg_unique_users"
[0m15:21:43.474170 [debug] [Thread-1 (]: On model.my_dbt_trino_project.stg_unique_users: /* {"app": "dbt", "dbt_version": "1.8.2", "profile_name": "my_dbt_trino_project", "target_name": "dev", "node_id": "model.my_dbt_trino_project.stg_unique_users"} */

  create or replace view
    "datalake"."analytics_stage"."stg_unique_users"
  security definer
  as
    

SELECT
    COUNT(DISTINCT userid) AS total_unique_users
FROM "datalake"."analytics_source"."src_listen_events"
WHERE userid IS NOT NULL
  
[0m15:21:43.474170 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m15:21:43.621778 [debug] [Thread-1 (]: SQL status: SUCCESS in 0.0 seconds
[0m15:21:43.623358 [debug] [Thread-1 (]: On model.my_dbt_trino_project.stg_unique_users: ROLLBACK
[0m15:21:43.623888 [debug] [Thread-1 (]: On model.my_dbt_trino_project.stg_unique_users: Close
[0m15:21:43.624406 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'd25bf2fa-805d-4fea-9c8c-8cda90f60c93', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x00000234830E7490>]}
[0m15:21:43.625455 [info ] [Thread-1 (]: 7 of 15 OK created sql view model analytics_stage.stg_unique_users ............. [[32mSUCCESS[0m in 0.15s]
[0m15:21:43.625979 [debug] [Thread-1 (]: Finished running node model.my_dbt_trino_project.stg_unique_users
[0m15:21:43.626504 [debug] [Thread-1 (]: Began running node model.my_dbt_trino_project.stg_user_activity_per_country
[0m15:21:43.627039 [info ] [Thread-1 (]: 8 of 15 START sql view model analytics_stage.stg_user_activity_per_country ..... [RUN]
[0m15:21:43.627558 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.my_dbt_trino_project.stg_unique_users, now model.my_dbt_trino_project.stg_user_activity_per_country)
[0m15:21:43.628090 [debug] [Thread-1 (]: Began compiling node model.my_dbt_trino_project.stg_user_activity_per_country
[0m15:21:43.630731 [debug] [Thread-1 (]: Writing injected SQL for node "model.my_dbt_trino_project.stg_user_activity_per_country"
[0m15:21:43.631258 [debug] [Thread-1 (]: Began executing node model.my_dbt_trino_project.stg_user_activity_per_country
[0m15:21:43.631784 [debug] [Thread-1 (]: Writing runtime sql for node "model.my_dbt_trino_project.stg_user_activity_per_country"
[0m15:21:43.631784 [debug] [Thread-1 (]: Using trino connection "model.my_dbt_trino_project.stg_user_activity_per_country"
[0m15:21:43.631784 [debug] [Thread-1 (]: On model.my_dbt_trino_project.stg_user_activity_per_country: /* {"app": "dbt", "dbt_version": "1.8.2", "profile_name": "my_dbt_trino_project", "target_name": "dev", "node_id": "model.my_dbt_trino_project.stg_user_activity_per_country"} */

  create or replace view
    "datalake"."analytics_stage"."stg_user_activity_per_country"
  security definer
  as
    

WITH combined_activities AS (
  SELECT
    country,
    'listen_event' AS event_type,
    ts,
    userid
  FROM "datalake"."analytics_source"."src_listen_events"
  WHERE country IS NOT NULL
  UNION ALL
  SELECT
    'Unknown' AS country, 
    ts,
    userid
  FROM "datalake"."analytics_source"."src_auth_events"
  UNION ALL
  SELECT
    'Unknown' AS country, 
    'page_view_event' AS event_type,
    ts,
    userid
  FROM "datalake"."analytics_source"."src_page_view_events"
)

SELECT
  country,
  COUNT(*) AS activity_count
FROM combined_activities
GROUP BY country
  
[0m15:21:43.631784 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m15:21:43.693336 [debug] [Thread-1 (]: Trino adapter: Trino query id: 20240618_055557_00298_z97n2
[0m15:21:43.693336 [debug] [Thread-1 (]: Trino adapter: Trino error: TrinoUserError(type=USER_ERROR, name=TYPE_MISMATCH, message="line 17:3: UNION query has different number of fields: 4, 3", query_id=20240618_055557_00298_z97n2)
[0m15:21:43.693862 [debug] [Thread-1 (]: On model.my_dbt_trino_project.stg_user_activity_per_country: ROLLBACK
[0m15:21:43.694387 [debug] [Thread-1 (]: On model.my_dbt_trino_project.stg_user_activity_per_country: Close
[0m15:21:43.698015 [debug] [Thread-1 (]: Database Error in model stg_user_activity_per_country (models\stage\stg_user_activity_per_country.sql)
  TrinoUserError(type=USER_ERROR, name=TYPE_MISMATCH, message="line 17:3: UNION query has different number of fields: 4, 3", query_id=20240618_055557_00298_z97n2)
  compiled Code at target\run\my_dbt_trino_project\models\stage\stg_user_activity_per_country.sql
[0m15:21:43.698015 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'd25bf2fa-805d-4fea-9c8c-8cda90f60c93', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x0000023483F1E350>]}
[0m15:21:43.698015 [error] [Thread-1 (]: 8 of 15 ERROR creating sql view model analytics_stage.stg_user_activity_per_country  [[31mERROR[0m in 0.07s]
[0m15:21:43.698015 [debug] [Thread-1 (]: Finished running node model.my_dbt_trino_project.stg_user_activity_per_country
[0m15:21:43.698015 [debug] [Thread-1 (]: Began running node model.my_dbt_trino_project.stg_user_activity_per_location
[0m15:21:43.698015 [info ] [Thread-1 (]: 9 of 15 START sql view model analytics_stage.stg_user_activity_per_location .... [RUN]
[0m15:21:43.698015 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.my_dbt_trino_project.stg_user_activity_per_country, now model.my_dbt_trino_project.stg_user_activity_per_location)
[0m15:21:43.698015 [debug] [Thread-1 (]: Began compiling node model.my_dbt_trino_project.stg_user_activity_per_location
[0m15:21:43.698015 [debug] [Thread-1 (]: Writing injected SQL for node "model.my_dbt_trino_project.stg_user_activity_per_location"
[0m15:21:43.698015 [debug] [Thread-1 (]: Began executing node model.my_dbt_trino_project.stg_user_activity_per_location
[0m15:21:43.698015 [debug] [Thread-1 (]: Writing runtime sql for node "model.my_dbt_trino_project.stg_user_activity_per_location"
[0m15:21:43.698015 [debug] [Thread-1 (]: Using trino connection "model.my_dbt_trino_project.stg_user_activity_per_location"
[0m15:21:43.698015 [debug] [Thread-1 (]: On model.my_dbt_trino_project.stg_user_activity_per_location: /* {"app": "dbt", "dbt_version": "1.8.2", "profile_name": "my_dbt_trino_project", "target_name": "dev", "node_id": "model.my_dbt_trino_project.stg_user_activity_per_location"} */

  create or replace view
    "datalake"."analytics_stage"."stg_user_activity_per_location"
  security definer
  as
    

WITH combined_activities AS (
  SELECT
    city,
    state,
    'auth_event' AS event_type,
    ts,
    userid
 FROM "datalake"."analytics_source"."src_auth_events"
  UNION ALL
  SELECT
    city,
    state,
    'listen_event' AS event_type,
    ts,
    userid
  FROM "datalake"."analytics_source"."src_listen_events"
  UNION ALL
  SELECT
    city,
    state,
    'page_view_event' AS event_type,
    ts,
    userid
  FROM "datalake"."analytics_source"."src_page_view_events"
)

SELECT
  state,
  city,
  COUNT(*) AS activity_count
FROM combined_activities
GROUP BY state, city
  
[0m15:21:43.698015 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m15:21:43.826893 [debug] [Thread-1 (]: SQL status: SUCCESS in 0.0 seconds
[0m15:21:43.829017 [debug] [Thread-1 (]: On model.my_dbt_trino_project.stg_user_activity_per_location: ROLLBACK
[0m15:21:43.829017 [debug] [Thread-1 (]: On model.my_dbt_trino_project.stg_user_activity_per_location: Close
[0m15:21:43.829565 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'd25bf2fa-805d-4fea-9c8c-8cda90f60c93', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x0000023483B74190>]}
[0m15:21:43.830082 [info ] [Thread-1 (]: 9 of 15 OK created sql view model analytics_stage.stg_user_activity_per_location  [[32mSUCCESS[0m in 0.13s]
[0m15:21:43.831125 [debug] [Thread-1 (]: Finished running node model.my_dbt_trino_project.stg_user_activity_per_location
[0m15:21:43.831639 [debug] [Thread-1 (]: Began running node model.my_dbt_trino_project.mart_user_level_by_gender
[0m15:21:43.832167 [info ] [Thread-1 (]: 10 of 15 START sql table model analytics.mart_user_level_by_gender ............. [RUN]
[0m15:21:43.832690 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.my_dbt_trino_project.stg_user_activity_per_location, now model.my_dbt_trino_project.mart_user_level_by_gender)
[0m15:21:43.832690 [debug] [Thread-1 (]: Began compiling node model.my_dbt_trino_project.mart_user_level_by_gender
[0m15:21:43.834281 [debug] [Thread-1 (]: Writing injected SQL for node "model.my_dbt_trino_project.mart_user_level_by_gender"
[0m15:21:43.834281 [debug] [Thread-1 (]: Began executing node model.my_dbt_trino_project.mart_user_level_by_gender
[0m15:21:43.837155 [debug] [Thread-1 (]: Writing runtime sql for node "model.my_dbt_trino_project.mart_user_level_by_gender"
[0m15:21:43.837155 [debug] [Thread-1 (]: Using trino connection "model.my_dbt_trino_project.mart_user_level_by_gender"
[0m15:21:43.837155 [debug] [Thread-1 (]: On model.my_dbt_trino_project.mart_user_level_by_gender: /* {"app": "dbt", "dbt_version": "1.8.2", "profile_name": "my_dbt_trino_project", "target_name": "dev", "node_id": "model.my_dbt_trino_project.mart_user_level_by_gender"} */

  
    

    create table "datalake"."analytics"."mart_user_level_by_gender__dbt_tmp"
      
      
    as (
      

SELECT
    gender,
    level,
    SUM(user_count) AS total_users,
    ROUND(SUM(user_count) * 100.0 / SUM(SUM(user_count)) OVER (), 2) AS percentage_of_total_users
FROM "datalake"."analytics_stage"."stg_user_level_by_gender"
GROUP BY gender, level
    )
[0m15:21:43.837155 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m15:21:44.321776 [debug] [Thread-1 (]: SQL status: SUCCESS in 0.0 seconds
[0m15:21:44.324402 [debug] [Thread-1 (]: Using trino connection "model.my_dbt_trino_project.mart_user_level_by_gender"
[0m15:21:44.324920 [debug] [Thread-1 (]: On model.my_dbt_trino_project.mart_user_level_by_gender: /* {"app": "dbt", "dbt_version": "1.8.2", "profile_name": "my_dbt_trino_project", "target_name": "dev", "node_id": "model.my_dbt_trino_project.mart_user_level_by_gender"} */
alter table "datalake"."analytics"."mart_user_level_by_gender" rename to "datalake"."analytics"."mart_user_level_by_gender__dbt_backup"
[0m15:21:44.431605 [debug] [Thread-1 (]: SQL status: SUCCESS in 0.0 seconds
[0m15:21:44.434272 [debug] [Thread-1 (]: Using trino connection "model.my_dbt_trino_project.mart_user_level_by_gender"
[0m15:21:44.434825 [debug] [Thread-1 (]: On model.my_dbt_trino_project.mart_user_level_by_gender: /* {"app": "dbt", "dbt_version": "1.8.2", "profile_name": "my_dbt_trino_project", "target_name": "dev", "node_id": "model.my_dbt_trino_project.mart_user_level_by_gender"} */
alter table "datalake"."analytics"."mart_user_level_by_gender__dbt_tmp" rename to "datalake"."analytics"."mart_user_level_by_gender"
[0m15:21:44.531237 [debug] [Thread-1 (]: SQL status: SUCCESS in 0.0 seconds
[0m15:21:44.533890 [debug] [Thread-1 (]: Applying DROP to: "datalake"."analytics"."mart_user_level_by_gender__dbt_backup"
[0m15:21:44.534425 [debug] [Thread-1 (]: Using trino connection "model.my_dbt_trino_project.mart_user_level_by_gender"
[0m15:21:44.534962 [debug] [Thread-1 (]: On model.my_dbt_trino_project.mart_user_level_by_gender: /* {"app": "dbt", "dbt_version": "1.8.2", "profile_name": "my_dbt_trino_project", "target_name": "dev", "node_id": "model.my_dbt_trino_project.mart_user_level_by_gender"} */

    drop table if exists "datalake"."analytics"."mart_user_level_by_gender__dbt_backup"
[0m15:21:44.689635 [debug] [Thread-1 (]: SQL status: SUCCESS in 0.0 seconds
[0m15:21:44.691222 [debug] [Thread-1 (]: On model.my_dbt_trino_project.mart_user_level_by_gender: ROLLBACK
[0m15:21:44.691749 [debug] [Thread-1 (]: On model.my_dbt_trino_project.mart_user_level_by_gender: Close
[0m15:21:44.692276 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'd25bf2fa-805d-4fea-9c8c-8cda90f60c93', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x0000023483ED9810>]}
[0m15:21:44.692806 [info ] [Thread-1 (]: 10 of 15 OK created sql table model analytics.mart_user_level_by_gender ........ [[32mSUCCESS[0m in 0.86s]
[0m15:21:44.693861 [debug] [Thread-1 (]: Finished running node model.my_dbt_trino_project.mart_user_level_by_gender
[0m15:21:44.693861 [debug] [Thread-1 (]: Began running node model.my_dbt_trino_project.mart_hourly_stream_evolution
[0m15:21:44.694391 [info ] [Thread-1 (]: 11 of 15 START sql table model analytics.mart_hourly_stream_evolution .......... [RUN]
[0m15:21:44.694928 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.my_dbt_trino_project.mart_user_level_by_gender, now model.my_dbt_trino_project.mart_hourly_stream_evolution)
[0m15:21:44.695456 [debug] [Thread-1 (]: Began compiling node model.my_dbt_trino_project.mart_hourly_stream_evolution
[0m15:21:44.697583 [debug] [Thread-1 (]: Writing injected SQL for node "model.my_dbt_trino_project.mart_hourly_stream_evolution"
[0m15:21:44.698635 [debug] [Thread-1 (]: Began executing node model.my_dbt_trino_project.mart_hourly_stream_evolution
[0m15:21:44.700210 [debug] [Thread-1 (]: Writing runtime sql for node "model.my_dbt_trino_project.mart_hourly_stream_evolution"
[0m15:21:44.702717 [debug] [Thread-1 (]: Using trino connection "model.my_dbt_trino_project.mart_hourly_stream_evolution"
[0m15:21:44.702717 [debug] [Thread-1 (]: On model.my_dbt_trino_project.mart_hourly_stream_evolution: /* {"app": "dbt", "dbt_version": "1.8.2", "profile_name": "my_dbt_trino_project", "target_name": "dev", "node_id": "model.my_dbt_trino_project.mart_hourly_stream_evolution"} */

  
    

    create table "datalake"."analytics"."mart_hourly_stream_evolution__dbt_tmp"
      
      
    as (
      

SELECT
    stream_date,
    stream_hour,
    total_streams,
    SUM(total_streams) OVER (PARTITION BY stream_date ORDER BY stream_hour) AS cumulative_streams
FROM "datalake"."analytics_stage"."stg_streams_hourly"
ORDER BY
    stream_date,
    stream_hour
    )
[0m15:21:44.702717 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m15:21:45.064383 [debug] [Thread-1 (]: SQL status: SUCCESS in 0.0 seconds
[0m15:21:45.067509 [debug] [Thread-1 (]: Using trino connection "model.my_dbt_trino_project.mart_hourly_stream_evolution"
[0m15:21:45.067509 [debug] [Thread-1 (]: On model.my_dbt_trino_project.mart_hourly_stream_evolution: /* {"app": "dbt", "dbt_version": "1.8.2", "profile_name": "my_dbt_trino_project", "target_name": "dev", "node_id": "model.my_dbt_trino_project.mart_hourly_stream_evolution"} */
alter table "datalake"."analytics"."mart_hourly_stream_evolution" rename to "datalake"."analytics"."mart_hourly_stream_evolution__dbt_backup"
[0m15:21:45.169155 [debug] [Thread-1 (]: SQL status: SUCCESS in 0.0 seconds
[0m15:21:45.173474 [debug] [Thread-1 (]: Using trino connection "model.my_dbt_trino_project.mart_hourly_stream_evolution"
[0m15:21:45.173474 [debug] [Thread-1 (]: On model.my_dbt_trino_project.mart_hourly_stream_evolution: /* {"app": "dbt", "dbt_version": "1.8.2", "profile_name": "my_dbt_trino_project", "target_name": "dev", "node_id": "model.my_dbt_trino_project.mart_hourly_stream_evolution"} */
alter table "datalake"."analytics"."mart_hourly_stream_evolution__dbt_tmp" rename to "datalake"."analytics"."mart_hourly_stream_evolution"
[0m15:21:45.274010 [debug] [Thread-1 (]: SQL status: SUCCESS in 0.0 seconds
[0m15:21:45.277205 [debug] [Thread-1 (]: Applying DROP to: "datalake"."analytics"."mart_hourly_stream_evolution__dbt_backup"
[0m15:21:45.277745 [debug] [Thread-1 (]: Using trino connection "model.my_dbt_trino_project.mart_hourly_stream_evolution"
[0m15:21:45.278271 [debug] [Thread-1 (]: On model.my_dbt_trino_project.mart_hourly_stream_evolution: /* {"app": "dbt", "dbt_version": "1.8.2", "profile_name": "my_dbt_trino_project", "target_name": "dev", "node_id": "model.my_dbt_trino_project.mart_hourly_stream_evolution"} */

    drop table if exists "datalake"."analytics"."mart_hourly_stream_evolution__dbt_backup"
[0m15:21:45.434604 [debug] [Thread-1 (]: SQL status: SUCCESS in 0.0 seconds
[0m15:21:45.436715 [debug] [Thread-1 (]: On model.my_dbt_trino_project.mart_hourly_stream_evolution: ROLLBACK
[0m15:21:45.436715 [debug] [Thread-1 (]: On model.my_dbt_trino_project.mart_hourly_stream_evolution: Close
[0m15:21:45.437765 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'd25bf2fa-805d-4fea-9c8c-8cda90f60c93', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000002348390DB50>]}
[0m15:21:45.438318 [info ] [Thread-1 (]: 11 of 15 OK created sql table model analytics.mart_hourly_stream_evolution ..... [[32mSUCCESS[0m in 0.74s]
[0m15:21:45.439377 [debug] [Thread-1 (]: Finished running node model.my_dbt_trino_project.mart_hourly_stream_evolution
[0m15:21:45.439900 [debug] [Thread-1 (]: Began running node model.my_dbt_trino_project.mart_top_songs_artists
[0m15:21:45.440423 [info ] [Thread-1 (]: 12 of 15 START sql table model analytics.mart_top_songs_artists ................ [RUN]
[0m15:21:45.440943 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.my_dbt_trino_project.mart_hourly_stream_evolution, now model.my_dbt_trino_project.mart_top_songs_artists)
[0m15:21:45.441461 [debug] [Thread-1 (]: Began compiling node model.my_dbt_trino_project.mart_top_songs_artists
[0m15:21:45.444058 [debug] [Thread-1 (]: Writing injected SQL for node "model.my_dbt_trino_project.mart_top_songs_artists"
[0m15:21:45.444572 [debug] [Thread-1 (]: Began executing node model.my_dbt_trino_project.mart_top_songs_artists
[0m15:21:45.447165 [debug] [Thread-1 (]: Writing runtime sql for node "model.my_dbt_trino_project.mart_top_songs_artists"
[0m15:21:45.449271 [debug] [Thread-1 (]: Using trino connection "model.my_dbt_trino_project.mart_top_songs_artists"
[0m15:21:45.450334 [debug] [Thread-1 (]: On model.my_dbt_trino_project.mart_top_songs_artists: /* {"app": "dbt", "dbt_version": "1.8.2", "profile_name": "my_dbt_trino_project", "target_name": "dev", "node_id": "model.my_dbt_trino_project.mart_top_songs_artists"} */

  
    

    create table "datalake"."analytics"."mart_top_songs_artists__dbt_tmp"
      
      
    as (
      

WITH top_songs AS (
    SELECT
        artist,
        song,
        play_count
    FROM "datalake"."analytics_stage"."stg_top_songs_artists"
)

SELECT
    artist,
    song,
    play_count
FROM top_songs
    )
[0m15:21:45.450895 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m15:21:45.811442 [debug] [Thread-1 (]: SQL status: SUCCESS in 0.0 seconds
[0m15:21:45.814620 [debug] [Thread-1 (]: Using trino connection "model.my_dbt_trino_project.mart_top_songs_artists"
[0m15:21:45.815145 [debug] [Thread-1 (]: On model.my_dbt_trino_project.mart_top_songs_artists: /* {"app": "dbt", "dbt_version": "1.8.2", "profile_name": "my_dbt_trino_project", "target_name": "dev", "node_id": "model.my_dbt_trino_project.mart_top_songs_artists"} */
alter table "datalake"."analytics"."mart_top_songs_artists" rename to "datalake"."analytics"."mart_top_songs_artists__dbt_backup"
[0m15:21:45.901394 [debug] [Thread-1 (]: SQL status: SUCCESS in 0.0 seconds
[0m15:21:45.904046 [debug] [Thread-1 (]: Using trino connection "model.my_dbt_trino_project.mart_top_songs_artists"
[0m15:21:45.904574 [debug] [Thread-1 (]: On model.my_dbt_trino_project.mart_top_songs_artists: /* {"app": "dbt", "dbt_version": "1.8.2", "profile_name": "my_dbt_trino_project", "target_name": "dev", "node_id": "model.my_dbt_trino_project.mart_top_songs_artists"} */
alter table "datalake"."analytics"."mart_top_songs_artists__dbt_tmp" rename to "datalake"."analytics"."mart_top_songs_artists"
[0m15:21:45.985216 [debug] [Thread-1 (]: SQL status: SUCCESS in 0.0 seconds
[0m15:21:45.987858 [debug] [Thread-1 (]: Applying DROP to: "datalake"."analytics"."mart_top_songs_artists__dbt_backup"
[0m15:21:45.988377 [debug] [Thread-1 (]: Using trino connection "model.my_dbt_trino_project.mart_top_songs_artists"
[0m15:21:45.988895 [debug] [Thread-1 (]: On model.my_dbt_trino_project.mart_top_songs_artists: /* {"app": "dbt", "dbt_version": "1.8.2", "profile_name": "my_dbt_trino_project", "target_name": "dev", "node_id": "model.my_dbt_trino_project.mart_top_songs_artists"} */

    drop table if exists "datalake"."analytics"."mart_top_songs_artists__dbt_backup"
[0m15:21:46.130506 [debug] [Thread-1 (]: SQL status: SUCCESS in 0.0 seconds
[0m15:21:46.132117 [debug] [Thread-1 (]: On model.my_dbt_trino_project.mart_top_songs_artists: ROLLBACK
[0m15:21:46.132117 [debug] [Thread-1 (]: On model.my_dbt_trino_project.mart_top_songs_artists: Close
[0m15:21:46.132643 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'd25bf2fa-805d-4fea-9c8c-8cda90f60c93', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x0000023482ED9190>]}
[0m15:21:46.133720 [info ] [Thread-1 (]: 12 of 15 OK created sql table model analytics.mart_top_songs_artists ........... [[32mSUCCESS[0m in 0.69s]
[0m15:21:46.134243 [debug] [Thread-1 (]: Finished running node model.my_dbt_trino_project.mart_top_songs_artists
[0m15:21:46.134783 [debug] [Thread-1 (]: Began running node model.my_dbt_trino_project.mart_total_unique_users
[0m15:21:46.135304 [info ] [Thread-1 (]: 13 of 15 START sql table model analytics.mart_total_unique_users ............... [RUN]
[0m15:21:46.135830 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.my_dbt_trino_project.mart_top_songs_artists, now model.my_dbt_trino_project.mart_total_unique_users)
[0m15:21:46.135830 [debug] [Thread-1 (]: Began compiling node model.my_dbt_trino_project.mart_total_unique_users
[0m15:21:46.138497 [debug] [Thread-1 (]: Writing injected SQL for node "model.my_dbt_trino_project.mart_total_unique_users"
[0m15:21:46.139024 [debug] [Thread-1 (]: Began executing node model.my_dbt_trino_project.mart_total_unique_users
[0m15:21:46.141791 [debug] [Thread-1 (]: Writing runtime sql for node "model.my_dbt_trino_project.mart_total_unique_users"
[0m15:21:46.142821 [debug] [Thread-1 (]: Using trino connection "model.my_dbt_trino_project.mart_total_unique_users"
[0m15:21:46.142821 [debug] [Thread-1 (]: On model.my_dbt_trino_project.mart_total_unique_users: /* {"app": "dbt", "dbt_version": "1.8.2", "profile_name": "my_dbt_trino_project", "target_name": "dev", "node_id": "model.my_dbt_trino_project.mart_total_unique_users"} */

  
    

    create table "datalake"."analytics"."mart_total_unique_users__dbt_tmp"
      
      
    as (
      

SELECT
    total_unique_users
FROM "datalake"."analytics_stage"."stg_unique_users"
    )
[0m15:21:46.143825 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m15:21:46.504661 [debug] [Thread-1 (]: SQL status: SUCCESS in 0.0 seconds
[0m15:21:46.508889 [debug] [Thread-1 (]: Using trino connection "model.my_dbt_trino_project.mart_total_unique_users"
[0m15:21:46.509446 [debug] [Thread-1 (]: On model.my_dbt_trino_project.mart_total_unique_users: /* {"app": "dbt", "dbt_version": "1.8.2", "profile_name": "my_dbt_trino_project", "target_name": "dev", "node_id": "model.my_dbt_trino_project.mart_total_unique_users"} */
alter table "datalake"."analytics"."mart_total_unique_users" rename to "datalake"."analytics"."mart_total_unique_users__dbt_backup"
[0m15:21:46.598815 [debug] [Thread-1 (]: SQL status: SUCCESS in 0.0 seconds
[0m15:21:46.601979 [debug] [Thread-1 (]: Using trino connection "model.my_dbt_trino_project.mart_total_unique_users"
[0m15:21:46.602493 [debug] [Thread-1 (]: On model.my_dbt_trino_project.mart_total_unique_users: /* {"app": "dbt", "dbt_version": "1.8.2", "profile_name": "my_dbt_trino_project", "target_name": "dev", "node_id": "model.my_dbt_trino_project.mart_total_unique_users"} */
alter table "datalake"."analytics"."mart_total_unique_users__dbt_tmp" rename to "datalake"."analytics"."mart_total_unique_users"
[0m15:21:46.696657 [debug] [Thread-1 (]: SQL status: SUCCESS in 0.0 seconds
[0m15:21:46.699260 [debug] [Thread-1 (]: Applying DROP to: "datalake"."analytics"."mart_total_unique_users__dbt_backup"
[0m15:21:46.699260 [debug] [Thread-1 (]: Using trino connection "model.my_dbt_trino_project.mart_total_unique_users"
[0m15:21:46.699260 [debug] [Thread-1 (]: On model.my_dbt_trino_project.mart_total_unique_users: /* {"app": "dbt", "dbt_version": "1.8.2", "profile_name": "my_dbt_trino_project", "target_name": "dev", "node_id": "model.my_dbt_trino_project.mart_total_unique_users"} */

    drop table if exists "datalake"."analytics"."mart_total_unique_users__dbt_backup"
[0m15:21:46.850272 [debug] [Thread-1 (]: SQL status: SUCCESS in 0.0 seconds
[0m15:21:46.851347 [debug] [Thread-1 (]: On model.my_dbt_trino_project.mart_total_unique_users: ROLLBACK
[0m15:21:46.851873 [debug] [Thread-1 (]: On model.my_dbt_trino_project.mart_total_unique_users: Close
[0m15:21:46.852396 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'd25bf2fa-805d-4fea-9c8c-8cda90f60c93', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x0000023483EC2050>]}
[0m15:21:46.852917 [info ] [Thread-1 (]: 13 of 15 OK created sql table model analytics.mart_total_unique_users .......... [[32mSUCCESS[0m in 0.72s]
[0m15:21:46.853460 [debug] [Thread-1 (]: Finished running node model.my_dbt_trino_project.mart_total_unique_users
[0m15:21:46.854031 [debug] [Thread-1 (]: Began running node model.my_dbt_trino_project.mart_user_activity_per_country
[0m15:21:46.854538 [info ] [Thread-1 (]: 14 of 15 SKIP relation analytics.mart_user_activity_per_country ................ [[33mSKIP[0m]
[0m15:21:46.855074 [debug] [Thread-1 (]: Finished running node model.my_dbt_trino_project.mart_user_activity_per_country
[0m15:21:46.855074 [debug] [Thread-1 (]: Began running node model.my_dbt_trino_project.mart_user_activity_per_state
[0m15:21:46.855612 [info ] [Thread-1 (]: 15 of 15 START sql table model analytics.mart_user_activity_per_state .......... [RUN]
[0m15:21:46.856145 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.my_dbt_trino_project.mart_total_unique_users, now model.my_dbt_trino_project.mart_user_activity_per_state)
[0m15:21:46.856668 [debug] [Thread-1 (]: Began compiling node model.my_dbt_trino_project.mart_user_activity_per_state
[0m15:21:46.858758 [debug] [Thread-1 (]: Writing injected SQL for node "model.my_dbt_trino_project.mart_user_activity_per_state"
[0m15:21:46.859801 [debug] [Thread-1 (]: Began executing node model.my_dbt_trino_project.mart_user_activity_per_state
[0m15:21:46.860850 [debug] [Thread-1 (]: Writing runtime sql for node "model.my_dbt_trino_project.mart_user_activity_per_state"
[0m15:21:46.860850 [debug] [Thread-1 (]: Using trino connection "model.my_dbt_trino_project.mart_user_activity_per_state"
[0m15:21:46.860850 [debug] [Thread-1 (]: On model.my_dbt_trino_project.mart_user_activity_per_state: /* {"app": "dbt", "dbt_version": "1.8.2", "profile_name": "my_dbt_trino_project", "target_name": "dev", "node_id": "model.my_dbt_trino_project.mart_user_activity_per_state"} */

  
    

    create table "datalake"."analytics"."mart_user_activity_per_state__dbt_tmp"
      
      
    as (
      

SELECT
  state,
  city,
  SUM(activity_count) AS total_activity
FROM "datalake"."analytics_stage"."stg_user_activity_per_location"
GROUP BY state, city
ORDER BY state, SUM(activity_count) DESC
    )
[0m15:21:46.860850 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m15:21:47.323533 [debug] [Thread-1 (]: SQL status: SUCCESS in 0.0 seconds
[0m15:21:47.326999 [debug] [Thread-1 (]: Using trino connection "model.my_dbt_trino_project.mart_user_activity_per_state"
[0m15:21:47.327524 [debug] [Thread-1 (]: On model.my_dbt_trino_project.mart_user_activity_per_state: /* {"app": "dbt", "dbt_version": "1.8.2", "profile_name": "my_dbt_trino_project", "target_name": "dev", "node_id": "model.my_dbt_trino_project.mart_user_activity_per_state"} */
alter table "datalake"."analytics"."mart_user_activity_per_state" rename to "datalake"."analytics"."mart_user_activity_per_state__dbt_backup"
[0m15:21:47.434452 [debug] [Thread-1 (]: SQL status: SUCCESS in 0.0 seconds
[0m15:21:47.437605 [debug] [Thread-1 (]: Using trino connection "model.my_dbt_trino_project.mart_user_activity_per_state"
[0m15:21:47.438020 [debug] [Thread-1 (]: On model.my_dbt_trino_project.mart_user_activity_per_state: /* {"app": "dbt", "dbt_version": "1.8.2", "profile_name": "my_dbt_trino_project", "target_name": "dev", "node_id": "model.my_dbt_trino_project.mart_user_activity_per_state"} */
alter table "datalake"."analytics"."mart_user_activity_per_state__dbt_tmp" rename to "datalake"."analytics"."mart_user_activity_per_state"
[0m15:21:47.532848 [debug] [Thread-1 (]: SQL status: SUCCESS in 0.0 seconds
[0m15:21:47.536038 [debug] [Thread-1 (]: Applying DROP to: "datalake"."analytics"."mart_user_activity_per_state__dbt_backup"
[0m15:21:47.537100 [debug] [Thread-1 (]: Using trino connection "model.my_dbt_trino_project.mart_user_activity_per_state"
[0m15:21:47.537639 [debug] [Thread-1 (]: On model.my_dbt_trino_project.mart_user_activity_per_state: /* {"app": "dbt", "dbt_version": "1.8.2", "profile_name": "my_dbt_trino_project", "target_name": "dev", "node_id": "model.my_dbt_trino_project.mart_user_activity_per_state"} */

    drop table if exists "datalake"."analytics"."mart_user_activity_per_state__dbt_backup"
[0m15:21:47.692949 [debug] [Thread-1 (]: SQL status: SUCCESS in 0.0 seconds
[0m15:21:47.694513 [debug] [Thread-1 (]: On model.my_dbt_trino_project.mart_user_activity_per_state: ROLLBACK
[0m15:21:47.694513 [debug] [Thread-1 (]: On model.my_dbt_trino_project.mart_user_activity_per_state: Close
[0m15:21:47.694513 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'd25bf2fa-805d-4fea-9c8c-8cda90f60c93', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x00000234828AE850>]}
[0m15:21:47.694513 [info ] [Thread-1 (]: 15 of 15 OK created sql table model analytics.mart_user_activity_per_state ..... [[32mSUCCESS[0m in 0.84s]
[0m15:21:47.694513 [debug] [Thread-1 (]: Finished running node model.my_dbt_trino_project.mart_user_activity_per_state
[0m15:21:47.698992 [debug] [MainThread]: On master: COMMIT
[0m15:21:47.698992 [debug] [MainThread]: Connection 'master' was properly closed.
[0m15:21:47.698992 [debug] [MainThread]: Connection 'list_datalake' was properly closed.
[0m15:21:47.700400 [debug] [MainThread]: Connection 'list_datalake_analytics_stage' was properly closed.
[0m15:21:47.700400 [debug] [MainThread]: Connection 'model.my_dbt_trino_project.mart_user_activity_per_state' was properly closed.
[0m15:21:47.700400 [info ] [MainThread]: 
[0m15:21:47.701607 [info ] [MainThread]: Finished running 8 table models, 2 incremental models, 5 view models in 0 hours 0 minutes and 9.55 seconds (9.55s).
[0m15:21:47.702157 [debug] [MainThread]: Command end result
[0m15:21:47.737821 [info ] [MainThread]: 
[0m15:21:47.737821 [info ] [MainThread]: [31mCompleted with 1 error and 0 warnings:[0m
[0m15:21:47.737821 [info ] [MainThread]: 
[0m15:21:47.737821 [error] [MainThread]:   Database Error in model stg_user_activity_per_country (models\stage\stg_user_activity_per_country.sql)
  TrinoUserError(type=USER_ERROR, name=TYPE_MISMATCH, message="line 17:3: UNION query has different number of fields: 4, 3", query_id=20240618_055557_00298_z97n2)
  compiled Code at target\run\my_dbt_trino_project\models\stage\stg_user_activity_per_country.sql
[0m15:21:47.737821 [info ] [MainThread]: 
[0m15:21:47.737821 [info ] [MainThread]: Done. PASS=13 WARN=0 ERROR=1 SKIP=1 TOTAL=15
[0m15:21:47.742218 [debug] [MainThread]: Command `dbt run` failed at 15:21:47.742218 after 10.36 seconds
[0m15:21:47.742218 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x00000234FE52F2D0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x00000234FE52E210>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x00000234FE52E290>]}
[0m15:21:47.742218 [debug] [MainThread]: Flushing usage events
[0m15:21:58.114212 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000001E3F75A8CD0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000001E3F7567550>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000001E3F75B7FD0>]}


============================== 15:21:58.117378 | e9634c06-aae1-494d-a821-058ec7a1af86 ==============================
[0m15:21:58.117378 [info ] [MainThread]: Running with dbt=1.8.2
[0m15:21:58.118435 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'indirect_selection': 'eager', 'log_cache_events': 'False', 'write_json': 'True', 'partial_parse': 'True', 'cache_selected_only': 'False', 'profiles_dir': 'C:\\Users\\ASUS\\Desktop\\work\\Iceberg-Dbt-Trino-Hive-modern-open-source-data-stack-main\\dbt', 'debug': 'False', 'version_check': 'True', 'log_path': 'C:\\Users\\ASUS\\Desktop\\work\\Iceberg-Dbt-Trino-Hive-modern-open-source-data-stack-main\\dbt\\logs', 'fail_fast': 'False', 'warn_error': 'None', 'use_colors': 'True', 'use_experimental_parser': 'False', 'no_print': 'None', 'quiet': 'False', 'log_format': 'default', 'static_parser': 'True', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'introspect': 'True', 'target_path': 'None', 'invocation_command': 'dbt debug', 'send_anonymous_usage_stats': 'True'}
[0m15:21:58.130093 [info ] [MainThread]: dbt version: 1.8.2
[0m15:21:58.130630 [info ] [MainThread]: python version: 3.11.5
[0m15:21:58.131622 [info ] [MainThread]: python path: C:\Users\ASUS\anaconda3\python.exe
[0m15:21:58.132180 [info ] [MainThread]: os info: Windows-10-10.0.22631-SP0
[0m15:21:58.303829 [info ] [MainThread]: Using profiles dir at C:\Users\ASUS\Desktop\work\Iceberg-Dbt-Trino-Hive-modern-open-source-data-stack-main\dbt
[0m15:21:58.304868 [info ] [MainThread]: Using profiles.yml file at C:\Users\ASUS\Desktop\work\Iceberg-Dbt-Trino-Hive-modern-open-source-data-stack-main\dbt\profiles.yml
[0m15:21:58.305402 [info ] [MainThread]: Using dbt_project.yml file at C:\Users\ASUS\Desktop\work\Iceberg-Dbt-Trino-Hive-modern-open-source-data-stack-main\dbt\dbt_project.yml
[0m15:21:58.305402 [info ] [MainThread]: adapter type: trino
[0m15:21:58.306324 [info ] [MainThread]: adapter version: 1.8.0
[0m15:21:58.373411 [info ] [MainThread]: Configuration:
[0m15:21:58.375207 [info ] [MainThread]:   profiles.yml file [[32mOK found and valid[0m]
[0m15:21:58.375207 [info ] [MainThread]:   dbt_project.yml file [[32mOK found and valid[0m]
[0m15:21:58.375207 [info ] [MainThread]: Required dependencies:
[0m15:21:58.376843 [debug] [MainThread]: Executing "git --help"
[0m15:21:58.468690 [debug] [MainThread]: STDOUT: "b"usage: git [-v | --version] [-h | --help] [-C <path>] [-c <name>=<value>]\n           [--exec-path[=<path>]] [--html-path] [--man-path] [--info-path]\n           [-p | --paginate | -P | --no-pager] [--no-replace-objects] [--bare]\n           [--git-dir=<path>] [--work-tree=<path>] [--namespace=<name>]\n           [--config-env=<name>=<envvar>] <command> [<args>]\n\nThese are common Git commands used in various situations:\n\nstart a working area (see also: git help tutorial)\n   clone     Clone a repository into a new directory\n   init      Create an empty Git repository or reinitialize an existing one\n\nwork on the current change (see also: git help everyday)\n   add       Add file contents to the index\n   mv        Move or rename a file, a directory, or a symlink\n   restore   Restore working tree files\n   rm        Remove files from the working tree and from the index\n\nexamine the history and state (see also: git help revisions)\n   bisect    Use binary search to find the commit that introduced a bug\n   diff      Show changes between commits, commit and working tree, etc\n   grep      Print lines matching a pattern\n   log       Show commit logs\n   show      Show various types of objects\n   status    Show the working tree status\n\ngrow, mark and tweak your common history\n   branch    List, create, or delete branches\n   commit    Record changes to the repository\n   merge     Join two or more development histories together\n   rebase    Reapply commits on top of another base tip\n   reset     Reset current HEAD to the specified state\n   switch    Switch branches\n   tag       Create, list, delete or verify a tag object signed with GPG\n\ncollaborate (see also: git help workflows)\n   fetch     Download objects and refs from another repository\n   pull      Fetch from and integrate with another repository or a local branch\n   push      Update remote refs along with associated objects\n\n'git help -a' and 'git help -g' list available subcommands and some\nconcept guides. See 'git help <command>' or 'git help <concept>'\nto read about a specific subcommand or concept.\nSee 'git help git' for an overview of the system.\n""
[0m15:21:58.468690 [debug] [MainThread]: STDERR: "b''"
[0m15:21:58.468690 [info ] [MainThread]:  - git [[32mOK found[0m]

[0m15:21:58.468690 [info ] [MainThread]: Connection:
[0m15:21:58.471861 [info ] [MainThread]:   host: localhost
[0m15:21:58.471861 [info ] [MainThread]:   port: 8080
[0m15:21:58.471861 [info ] [MainThread]:   user: admin
[0m15:21:58.471861 [info ] [MainThread]:   database: datalake
[0m15:21:58.471861 [info ] [MainThread]:   schema: analytics
[0m15:21:58.471861 [info ] [MainThread]:   cert: None
[0m15:21:58.471861 [info ] [MainThread]:   prepared_statements_enabled: True
[0m15:21:58.471861 [info ] [MainThread]: Registered adapter: trino=1.8.0
[0m15:21:58.471861 [debug] [MainThread]: Acquiring new trino connection 'debug'
[0m15:21:58.520845 [debug] [MainThread]: Using trino connection "debug"
[0m15:21:58.520845 [debug] [MainThread]: On debug: select 1 as id
[0m15:21:58.525166 [debug] [MainThread]: Opening a new connection, currently in state init
[0m15:21:58.593872 [debug] [MainThread]: SQL status: SUCCESS in 0.0 seconds
[0m15:21:58.594918 [debug] [MainThread]: On debug: Close
[0m15:21:58.595464 [info ] [MainThread]:   Connection test: [[32mOK connection ok[0m]

[0m15:21:58.595987 [info ] [MainThread]: [32mAll checks passed![0m
[0m15:21:58.597549 [debug] [MainThread]: Command `dbt debug` succeeded at 15:21:58.597549 after 0.64 seconds
[0m15:21:58.597549 [debug] [MainThread]: Connection 'debug' was properly closed.
[0m15:21:58.598068 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000001E3F6000DD0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000001E3F757B850>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000001E3F26C4410>]}
[0m15:21:58.598587 [debug] [MainThread]: Flushing usage events
[0m10:13:23.772689 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x0000026735646CD0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x0000026736837F10>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x00000267368376D0>]}


============================== 10:13:23.772689 | cbb67935-b3b1-4977-9361-092c40e39c42 ==============================
[0m10:13:23.772689 [info ] [MainThread]: Running with dbt=1.8.2
[0m10:13:23.787172 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'indirect_selection': 'eager', 'log_cache_events': 'False', 'write_json': 'True', 'partial_parse': 'True', 'cache_selected_only': 'False', 'profiles_dir': 'C:\\Users\\ASUS\\Desktop\\work\\Iceberg-Dbt-Trino-Hive-modern-open-source-data-stack-main\\dbt', 'debug': 'False', 'version_check': 'True', 'log_path': 'C:\\Users\\ASUS\\Desktop\\work\\Iceberg-Dbt-Trino-Hive-modern-open-source-data-stack-main\\dbt\\logs', 'fail_fast': 'False', 'warn_error': 'None', 'use_colors': 'True', 'use_experimental_parser': 'False', 'no_print': 'None', 'quiet': 'False', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'static_parser': 'True', 'log_format': 'default', 'invocation_command': 'dbt debug', 'target_path': 'None', 'introspect': 'True', 'send_anonymous_usage_stats': 'True'}
[0m10:13:23.799160 [info ] [MainThread]: dbt version: 1.8.2
[0m10:13:23.799160 [info ] [MainThread]: python version: 3.11.5
[0m10:13:23.799160 [info ] [MainThread]: python path: C:\Users\ASUS\anaconda3\python.exe
[0m10:13:23.799160 [info ] [MainThread]: os info: Windows-10-10.0.22631-SP0
[0m10:13:23.967747 [info ] [MainThread]: Using profiles dir at C:\Users\ASUS\Desktop\work\Iceberg-Dbt-Trino-Hive-modern-open-source-data-stack-main\dbt
[0m10:13:23.967747 [info ] [MainThread]: Using profiles.yml file at C:\Users\ASUS\Desktop\work\Iceberg-Dbt-Trino-Hive-modern-open-source-data-stack-main\dbt\profiles.yml
[0m10:13:23.969421 [info ] [MainThread]: Using dbt_project.yml file at C:\Users\ASUS\Desktop\work\Iceberg-Dbt-Trino-Hive-modern-open-source-data-stack-main\dbt\dbt_project.yml
[0m10:13:23.970039 [info ] [MainThread]: adapter type: trino
[0m10:13:23.970039 [info ] [MainThread]: adapter version: 1.8.0
[0m10:13:24.039332 [info ] [MainThread]: Configuration:
[0m10:13:24.040330 [info ] [MainThread]:   profiles.yml file [[32mOK found and valid[0m]
[0m10:13:24.040330 [info ] [MainThread]:   dbt_project.yml file [[32mOK found and valid[0m]
[0m10:13:24.041340 [info ] [MainThread]: Required dependencies:
[0m10:13:24.041340 [debug] [MainThread]: Executing "git --help"
[0m10:13:24.120460 [debug] [MainThread]: STDOUT: "b"usage: git [-v | --version] [-h | --help] [-C <path>] [-c <name>=<value>]\n           [--exec-path[=<path>]] [--html-path] [--man-path] [--info-path]\n           [-p | --paginate | -P | --no-pager] [--no-replace-objects] [--bare]\n           [--git-dir=<path>] [--work-tree=<path>] [--namespace=<name>]\n           [--config-env=<name>=<envvar>] <command> [<args>]\n\nThese are common Git commands used in various situations:\n\nstart a working area (see also: git help tutorial)\n   clone     Clone a repository into a new directory\n   init      Create an empty Git repository or reinitialize an existing one\n\nwork on the current change (see also: git help everyday)\n   add       Add file contents to the index\n   mv        Move or rename a file, a directory, or a symlink\n   restore   Restore working tree files\n   rm        Remove files from the working tree and from the index\n\nexamine the history and state (see also: git help revisions)\n   bisect    Use binary search to find the commit that introduced a bug\n   diff      Show changes between commits, commit and working tree, etc\n   grep      Print lines matching a pattern\n   log       Show commit logs\n   show      Show various types of objects\n   status    Show the working tree status\n\ngrow, mark and tweak your common history\n   branch    List, create, or delete branches\n   commit    Record changes to the repository\n   merge     Join two or more development histories together\n   rebase    Reapply commits on top of another base tip\n   reset     Reset current HEAD to the specified state\n   switch    Switch branches\n   tag       Create, list, delete or verify a tag object signed with GPG\n\ncollaborate (see also: git help workflows)\n   fetch     Download objects and refs from another repository\n   pull      Fetch from and integrate with another repository or a local branch\n   push      Update remote refs along with associated objects\n\n'git help -a' and 'git help -g' list available subcommands and some\nconcept guides. See 'git help <command>' or 'git help <concept>'\nto read about a specific subcommand or concept.\nSee 'git help git' for an overview of the system.\n""
[0m10:13:24.120460 [debug] [MainThread]: STDERR: "b''"
[0m10:13:24.120460 [info ] [MainThread]:  - git [[32mOK found[0m]

[0m10:13:24.120460 [info ] [MainThread]: Connection:
[0m10:13:24.120460 [info ] [MainThread]:   host: localhost
[0m10:13:24.120460 [info ] [MainThread]:   port: 8080
[0m10:13:24.120460 [info ] [MainThread]:   user: admin
[0m10:13:24.120460 [info ] [MainThread]:   database: datalake
[0m10:13:24.135468 [info ] [MainThread]:   schema: analytics
[0m10:13:24.135987 [info ] [MainThread]:   cert: None
[0m10:13:24.135987 [info ] [MainThread]:   prepared_statements_enabled: True
[0m10:13:24.135987 [info ] [MainThread]: Registered adapter: trino=1.8.0
[0m10:13:24.135987 [debug] [MainThread]: Acquiring new trino connection 'debug'
[0m10:13:24.300271 [debug] [MainThread]: Using trino connection "debug"
[0m10:13:24.300271 [debug] [MainThread]: On debug: select 1 as id
[0m10:13:24.300271 [debug] [MainThread]: Opening a new connection, currently in state init
[0m10:13:25.147410 [debug] [MainThread]: SQL status: SUCCESS in 1.0 seconds
[0m10:13:25.147410 [debug] [MainThread]: On debug: Close
[0m10:13:25.147410 [info ] [MainThread]:   Connection test: [[32mOK connection ok[0m]

[0m10:13:25.147410 [info ] [MainThread]: [32mAll checks passed![0m
[0m10:13:25.156433 [debug] [MainThread]: Command `dbt debug` succeeded at 10:13:25.156433 after 1.51 seconds
[0m10:13:25.156433 [debug] [MainThread]: Connection 'debug' was properly closed.
[0m10:13:25.156433 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x0000026734170DD0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x00000267319443D0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x00000267318AE210>]}
[0m10:13:25.156433 [debug] [MainThread]: Flushing usage events
[0m10:17:26.904277 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000001B2DE045610>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000001B2DDC47510>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000001B2DE0899D0>]}


============================== 10:17:26.907276 | 76dabc3b-0c8c-492d-99bc-65db3419cd85 ==============================
[0m10:17:26.907276 [info ] [MainThread]: Running with dbt=1.8.2
[0m10:17:26.908275 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'indirect_selection': 'eager', 'write_json': 'True', 'log_cache_events': 'False', 'partial_parse': 'True', 'cache_selected_only': 'False', 'profiles_dir': 'C:\\Users\\ASUS\\Desktop\\work\\Iceberg-Dbt-Trino-Hive-modern-open-source-data-stack-main\\dbt', 'debug': 'False', 'fail_fast': 'False', 'log_path': 'C:\\Users\\ASUS\\Desktop\\work\\Iceberg-Dbt-Trino-Hive-modern-open-source-data-stack-main\\dbt\\logs', 'version_check': 'True', 'warn_error': 'None', 'use_colors': 'True', 'use_experimental_parser': 'False', 'no_print': 'None', 'quiet': 'False', 'log_format': 'default', 'static_parser': 'True', 'invocation_command': 'dbt run', 'introspect': 'True', 'target_path': 'None', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'send_anonymous_usage_stats': 'True'}
[0m10:17:27.336011 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': '76dabc3b-0c8c-492d-99bc-65db3419cd85', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000001B2DE089ED0>]}
[0m10:17:27.370624 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': '76dabc3b-0c8c-492d-99bc-65db3419cd85', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000001B2DB1C5250>]}
[0m10:17:27.371624 [info ] [MainThread]: Registered adapter: trino=1.8.0
[0m10:17:27.384592 [debug] [MainThread]: checksum: f0a141b9de567cb7f131613ba2682f40b3a1c6a157f81c6e5435862eff68f109, vars: {}, profile: , target: , version: 1.8.2
[0m10:17:27.598559 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 0 files changed.
[0m10:17:27.598559 [debug] [MainThread]: Partial parsing enabled, no changes found, skipping parsing
[0m10:17:27.631081 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': '76dabc3b-0c8c-492d-99bc-65db3419cd85', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000001B2DE0B0E10>]}
[0m10:17:27.717291 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': '76dabc3b-0c8c-492d-99bc-65db3419cd85', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000001B2DE583E10>]}
[0m10:17:27.717800 [info ] [MainThread]: Found 15 models, 7 data tests, 3 sources, 559 macros
[0m10:17:27.717800 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '76dabc3b-0c8c-492d-99bc-65db3419cd85', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000001B2DE7E9410>]}
[0m10:17:27.719819 [info ] [MainThread]: 
[0m10:17:27.720371 [debug] [MainThread]: Acquiring new trino connection 'master'
[0m10:17:27.724402 [debug] [ThreadPool]: Acquiring new trino connection 'list_datalake'
[0m10:17:27.784093 [debug] [ThreadPool]: Using trino connection "list_datalake"
[0m10:17:27.785090 [debug] [ThreadPool]: On list_datalake: /* {"app": "dbt", "dbt_version": "1.8.2", "profile_name": "my_dbt_trino_project", "target_name": "dev", "connection_name": "list_datalake"} */

    select schema_name
    from "datalake".INFORMATION_SCHEMA.schemata
[0m10:17:27.785090 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m10:17:28.324719 [debug] [ThreadPool]: SQL status: SUCCESS in 1.0 seconds
[0m10:17:28.325724 [debug] [ThreadPool]: On list_datalake: Close
[0m10:17:28.329264 [debug] [ThreadPool]: Using trino connection "list_datalake"
[0m10:17:28.330269 [debug] [ThreadPool]: On list_datalake: /* {"app": "dbt", "dbt_version": "1.8.2", "profile_name": "my_dbt_trino_project", "target_name": "dev", "connection_name": "list_datalake"} */

    select schema_name
    from "datalake".INFORMATION_SCHEMA.schemata
[0m10:17:28.330269 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m10:17:28.386123 [debug] [ThreadPool]: SQL status: SUCCESS in 0.0 seconds
[0m10:17:28.386123 [debug] [ThreadPool]: On list_datalake: Close
[0m10:17:28.389795 [debug] [ThreadPool]: Using trino connection "list_datalake"
[0m10:17:28.389795 [debug] [ThreadPool]: On list_datalake: /* {"app": "dbt", "dbt_version": "1.8.2", "profile_name": "my_dbt_trino_project", "target_name": "dev", "connection_name": "list_datalake"} */

    select schema_name
    from "datalake".INFORMATION_SCHEMA.schemata
[0m10:17:28.390796 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m10:17:28.453114 [debug] [ThreadPool]: SQL status: SUCCESS in 0.0 seconds
[0m10:17:28.454124 [debug] [ThreadPool]: On list_datalake: Close
[0m10:17:28.455123 [debug] [ThreadPool]: Acquiring new trino connection 'list_datalake_analytics_stage'
[0m10:17:28.467107 [debug] [ThreadPool]: Using trino connection "list_datalake_analytics_stage"
[0m10:17:28.467107 [debug] [ThreadPool]: On list_datalake_analytics_stage: /* {"app": "dbt", "dbt_version": "1.8.2", "profile_name": "my_dbt_trino_project", "target_name": "dev", "connection_name": "list_datalake_analytics_stage"} */
select
      t.table_catalog as database,
      t.table_name as name,
      t.table_schema as schema,
      case when mv.name is not null then 'materialized_view'
           when t.table_type = 'BASE TABLE' then 'table'
           when t.table_type = 'VIEW' then 'view'
           else t.table_type
      end as table_type
    from "datalake".INFORMATION_SCHEMA.tables t
    left join (
            select * from system.metadata.materialized_views
            where catalog_name = 'datalake'
              and schema_name = 'analytics_stage') mv
          on mv.catalog_name = t.table_catalog and mv.schema_name = t.table_schema and mv.name = t.table_name
    where t.table_schema = 'analytics_stage'
[0m10:17:28.467107 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m10:17:29.016756 [debug] [ThreadPool]: SQL status: SUCCESS in 1.0 seconds
[0m10:17:29.017755 [debug] [ThreadPool]: On list_datalake_analytics_stage: ROLLBACK
[0m10:17:29.017755 [debug] [ThreadPool]: On list_datalake_analytics_stage: Close
[0m10:17:29.018757 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_datalake_analytics_stage, now list_datalake_analytics_source)
[0m10:17:29.022781 [debug] [ThreadPool]: Using trino connection "list_datalake_analytics_source"
[0m10:17:29.022781 [debug] [ThreadPool]: On list_datalake_analytics_source: /* {"app": "dbt", "dbt_version": "1.8.2", "profile_name": "my_dbt_trino_project", "target_name": "dev", "connection_name": "list_datalake_analytics_source"} */
select
      t.table_catalog as database,
      t.table_name as name,
      t.table_schema as schema,
      case when mv.name is not null then 'materialized_view'
           when t.table_type = 'BASE TABLE' then 'table'
           when t.table_type = 'VIEW' then 'view'
           else t.table_type
      end as table_type
    from "datalake".INFORMATION_SCHEMA.tables t
    left join (
            select * from system.metadata.materialized_views
            where catalog_name = 'datalake'
              and schema_name = 'analytics_source') mv
          on mv.catalog_name = t.table_catalog and mv.schema_name = t.table_schema and mv.name = t.table_name
    where t.table_schema = 'analytics_source'
[0m10:17:29.022781 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m10:17:29.242409 [debug] [ThreadPool]: SQL status: SUCCESS in 0.0 seconds
[0m10:17:29.243421 [debug] [ThreadPool]: On list_datalake_analytics_source: ROLLBACK
[0m10:17:29.244422 [debug] [ThreadPool]: On list_datalake_analytics_source: Close
[0m10:17:29.244422 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_datalake_analytics_source, now list_datalake_analytics)
[0m10:17:29.249852 [debug] [ThreadPool]: Using trino connection "list_datalake_analytics"
[0m10:17:29.250379 [debug] [ThreadPool]: On list_datalake_analytics: /* {"app": "dbt", "dbt_version": "1.8.2", "profile_name": "my_dbt_trino_project", "target_name": "dev", "connection_name": "list_datalake_analytics"} */
select
      t.table_catalog as database,
      t.table_name as name,
      t.table_schema as schema,
      case when mv.name is not null then 'materialized_view'
           when t.table_type = 'BASE TABLE' then 'table'
           when t.table_type = 'VIEW' then 'view'
           else t.table_type
      end as table_type
    from "datalake".INFORMATION_SCHEMA.tables t
    left join (
            select * from system.metadata.materialized_views
            where catalog_name = 'datalake'
              and schema_name = 'analytics') mv
          on mv.catalog_name = t.table_catalog and mv.schema_name = t.table_schema and mv.name = t.table_name
    where t.table_schema = 'analytics'
[0m10:17:29.250905 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m10:17:29.424435 [debug] [ThreadPool]: SQL status: SUCCESS in 0.0 seconds
[0m10:17:29.425443 [debug] [ThreadPool]: On list_datalake_analytics: ROLLBACK
[0m10:17:29.426444 [debug] [ThreadPool]: On list_datalake_analytics: Close
[0m10:17:29.427948 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '76dabc3b-0c8c-492d-99bc-65db3419cd85', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000001B2DE52E450>]}
[0m10:17:29.428964 [debug] [MainThread]: On master: COMMIT
[0m10:17:29.428964 [info ] [MainThread]: Concurrency: 1 threads (target='dev')
[0m10:17:29.429975 [info ] [MainThread]: 
[0m10:17:29.434016 [debug] [Thread-1 (]: Began running node model.my_dbt_trino_project.src_auth_events
[0m10:17:29.434525 [info ] [Thread-1 (]: 1 of 15 START sql table model analytics_source.src_auth_events ................. [RUN]
[0m10:17:29.435538 [debug] [Thread-1 (]: Acquiring new trino connection 'model.my_dbt_trino_project.src_auth_events'
[0m10:17:29.435538 [debug] [Thread-1 (]: Began compiling node model.my_dbt_trino_project.src_auth_events
[0m10:17:29.442059 [debug] [Thread-1 (]: Writing injected SQL for node "model.my_dbt_trino_project.src_auth_events"
[0m10:17:29.443060 [debug] [Thread-1 (]: Began executing node model.my_dbt_trino_project.src_auth_events
[0m10:17:29.475145 [debug] [Thread-1 (]: Writing runtime sql for node "model.my_dbt_trino_project.src_auth_events"
[0m10:17:29.479142 [debug] [Thread-1 (]: Using trino connection "model.my_dbt_trino_project.src_auth_events"
[0m10:17:29.480142 [debug] [Thread-1 (]: On model.my_dbt_trino_project.src_auth_events: /* {"app": "dbt", "dbt_version": "1.8.2", "profile_name": "my_dbt_trino_project", "target_name": "dev", "node_id": "model.my_dbt_trino_project.src_auth_events"} */

  
    

    create table "datalake"."analytics_source"."src_auth_events__dbt_tmp"
      
      
    as (
      

with source as (
    select
        CAST(ts AS VARCHAR) as id, 
        ts,
        CAST(sessionId AS VARCHAR) as sessionId,
        level,
        itemInSession,
        city,
        zip,
        state,
        userAgent,
        CAST(NULLIF(lon, '') AS double) as lon,
        CAST(NULLIF(lat, '') AS double) as lat,
        CAST(FLOOR(CAST(NULLIF(userId, '') AS DOUBLE)) AS INT) as userId, 
        lastName,
        firstName,
        gender,
        CAST(FLOOR(CAST(NULLIF(registration, '') AS DOUBLE)) AS BIGINT) as registration,
        success
    from "oltp"."public"."auth_events"
)

select
    id,
    ts,
    sessionId,
    level,
    itemInSession,
    city,
    zip,
    state,
    userAgent,
    lon,
    lat,
    userId,
    lastName,
    firstName,
    gender,
    registration, 
    CASE 
        WHEN CAST(success AS VARCHAR) = 't' THEN true 
        WHEN CAST(success AS VARCHAR) = 'f' THEN false
        ELSE NULL 
    END AS success_boolean
from source


    )
[0m10:17:29.480142 [debug] [Thread-1 (]: Opening a new connection, currently in state init
[0m10:17:34.321219 [debug] [Thread-1 (]: SQL status: SUCCESS in 5.0 seconds
[0m10:17:34.326260 [debug] [Thread-1 (]: Using trino connection "model.my_dbt_trino_project.src_auth_events"
[0m10:17:34.327263 [debug] [Thread-1 (]: On model.my_dbt_trino_project.src_auth_events: /* {"app": "dbt", "dbt_version": "1.8.2", "profile_name": "my_dbt_trino_project", "target_name": "dev", "node_id": "model.my_dbt_trino_project.src_auth_events"} */
alter table "datalake"."analytics_source"."src_auth_events" rename to "datalake"."analytics_source"."src_auth_events__dbt_backup"
[0m10:17:34.469440 [debug] [Thread-1 (]: SQL status: SUCCESS in 0.0 seconds
[0m10:17:34.472440 [debug] [Thread-1 (]: Using trino connection "model.my_dbt_trino_project.src_auth_events"
[0m10:17:34.472440 [debug] [Thread-1 (]: On model.my_dbt_trino_project.src_auth_events: /* {"app": "dbt", "dbt_version": "1.8.2", "profile_name": "my_dbt_trino_project", "target_name": "dev", "node_id": "model.my_dbt_trino_project.src_auth_events"} */
alter table "datalake"."analytics_source"."src_auth_events__dbt_tmp" rename to "datalake"."analytics_source"."src_auth_events"
[0m10:17:34.553013 [debug] [Thread-1 (]: SQL status: SUCCESS in 0.0 seconds
[0m10:17:34.558012 [debug] [Thread-1 (]: Applying DROP to: "datalake"."analytics_source"."src_auth_events__dbt_backup"
[0m10:17:34.560010 [debug] [Thread-1 (]: Using trino connection "model.my_dbt_trino_project.src_auth_events"
[0m10:17:34.560010 [debug] [Thread-1 (]: On model.my_dbt_trino_project.src_auth_events: /* {"app": "dbt", "dbt_version": "1.8.2", "profile_name": "my_dbt_trino_project", "target_name": "dev", "node_id": "model.my_dbt_trino_project.src_auth_events"} */

    drop table if exists "datalake"."analytics_source"."src_auth_events__dbt_backup"
[0m10:17:34.809441 [debug] [Thread-1 (]: SQL status: SUCCESS in 0.0 seconds
[0m10:17:34.823968 [debug] [Thread-1 (]: On model.my_dbt_trino_project.src_auth_events: ROLLBACK
[0m10:17:34.824961 [debug] [Thread-1 (]: On model.my_dbt_trino_project.src_auth_events: Close
[0m10:17:34.826963 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '76dabc3b-0c8c-492d-99bc-65db3419cd85', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000001B2DFE83B50>]}
[0m10:17:34.827966 [info ] [Thread-1 (]: 1 of 15 OK created sql table model analytics_source.src_auth_events ............ [[32mSUCCESS[0m in 5.39s]
[0m10:17:34.829138 [debug] [Thread-1 (]: Finished running node model.my_dbt_trino_project.src_auth_events
[0m10:17:34.829138 [debug] [Thread-1 (]: Began running node model.my_dbt_trino_project.src_listen_events
[0m10:17:34.830147 [info ] [Thread-1 (]: 2 of 15 START sql incremental model analytics_source.src_listen_events ......... [RUN]
[0m10:17:34.830147 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.my_dbt_trino_project.src_auth_events, now model.my_dbt_trino_project.src_listen_events)
[0m10:17:34.831527 [debug] [Thread-1 (]: Began compiling node model.my_dbt_trino_project.src_listen_events
[0m10:17:34.837534 [debug] [Thread-1 (]: Writing injected SQL for node "model.my_dbt_trino_project.src_listen_events"
[0m10:17:34.838602 [debug] [Thread-1 (]: Began executing node model.my_dbt_trino_project.src_listen_events
[0m10:17:34.865633 [debug] [Thread-1 (]: Using trino connection "model.my_dbt_trino_project.src_listen_events"
[0m10:17:34.866631 [debug] [Thread-1 (]: On model.my_dbt_trino_project.src_listen_events: /* {"app": "dbt", "dbt_version": "1.8.2", "profile_name": "my_dbt_trino_project", "target_name": "dev", "node_id": "model.my_dbt_trino_project.src_listen_events"} */

  
    

    create table "datalake"."analytics_source"."src_listen_events__dbt_tmp"
      
      
    as (
      

with source as (

    select
        CAST(_id AS VARCHAR) as id,
        artist,
        song,
        CAST(NULLIF(duration, '') AS DOUBLE) as duration,
        ts,
        sessionid,
        auth,
        level,
        CAST(NULLIF(itemInSession, '') AS INTEGER) as itemInSession,
        city,
        zip,
        state,
        country,
        userAgent,
        CAST(NULLIF(lon, '') AS DOUBLE) as lon,
        CAST(NULLIF(lat, '') AS DOUBLE) as lat,
        CAST(CAST(NULLIF(userId, '') AS DOUBLE) AS INTEGER) as userId,
 -- Assurez-vous que userId peut aussi être converti de cette manière.
        lastName,
        firstName,
        gender,
        CAST(CAST(NULLIF(registration, '') AS DOUBLE) AS BIGINT) as registration
    from "website"."demo"."listen_events"

)

select * from source



    -- this filter will only be applied on an incremental run
    where ts > (select max(ts) from "datalake"."analytics_source"."src_listen_events")


    )
[0m10:17:34.866631 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m10:17:35.728738 [debug] [Thread-1 (]: SQL status: SUCCESS in 1.0 seconds
[0m10:17:35.737799 [debug] [Thread-1 (]: Using trino connection "model.my_dbt_trino_project.src_listen_events"
[0m10:17:35.738801 [debug] [Thread-1 (]: On model.my_dbt_trino_project.src_listen_events: /* {"app": "dbt", "dbt_version": "1.8.2", "profile_name": "my_dbt_trino_project", "target_name": "dev", "node_id": "model.my_dbt_trino_project.src_listen_events"} */

    describe "datalake"."analytics_source"."src_listen_events__dbt_tmp"
[0m10:17:35.919528 [debug] [Thread-1 (]: SQL status: SUCCESS in 0.0 seconds
[0m10:17:35.923069 [debug] [Thread-1 (]: Using trino connection "model.my_dbt_trino_project.src_listen_events"
[0m10:17:35.923580 [debug] [Thread-1 (]: On model.my_dbt_trino_project.src_listen_events: /* {"app": "dbt", "dbt_version": "1.8.2", "profile_name": "my_dbt_trino_project", "target_name": "dev", "node_id": "model.my_dbt_trino_project.src_listen_events"} */

    describe "datalake"."analytics_source"."src_listen_events"
[0m10:17:36.070643 [debug] [Thread-1 (]: SQL status: SUCCESS in 0.0 seconds
[0m10:17:36.077219 [debug] [Thread-1 (]: Using trino connection "model.my_dbt_trino_project.src_listen_events"
[0m10:17:36.078218 [debug] [Thread-1 (]: On model.my_dbt_trino_project.src_listen_events: /* {"app": "dbt", "dbt_version": "1.8.2", "profile_name": "my_dbt_trino_project", "target_name": "dev", "node_id": "model.my_dbt_trino_project.src_listen_events"} */

    describe "datalake"."analytics_source"."src_listen_events"
[0m10:17:36.231817 [debug] [Thread-1 (]: SQL status: SUCCESS in 0.0 seconds
[0m10:17:36.241716 [debug] [Thread-1 (]: Writing runtime sql for node "model.my_dbt_trino_project.src_listen_events"
[0m10:17:36.243293 [debug] [Thread-1 (]: Using trino connection "model.my_dbt_trino_project.src_listen_events"
[0m10:17:36.243820 [debug] [Thread-1 (]: On model.my_dbt_trino_project.src_listen_events: /* {"app": "dbt", "dbt_version": "1.8.2", "profile_name": "my_dbt_trino_project", "target_name": "dev", "node_id": "model.my_dbt_trino_project.src_listen_events"} */
insert into "datalake"."analytics_source"."src_listen_events" ("id", "artist", "song", "duration", "ts", "sessionid", "auth", "level", "iteminsession", "city", "zip", "state", "country", "useragent", "lon", "lat", "userid", "lastname", "firstname", "gender", "registration")
    (
        select "id", "artist", "song", "duration", "ts", "sessionid", "auth", "level", "iteminsession", "city", "zip", "state", "country", "useragent", "lon", "lat", "userid", "lastname", "firstname", "gender", "registration"
        from "datalake"."analytics_source"."src_listen_events__dbt_tmp"
    )
[0m10:17:36.466795 [debug] [Thread-1 (]: SQL status: SUCCESS in 0.0 seconds
[0m10:17:36.469812 [debug] [Thread-1 (]: Applying DROP to: "datalake"."analytics_source"."src_listen_events__dbt_tmp"
[0m10:17:36.470821 [debug] [Thread-1 (]: Using trino connection "model.my_dbt_trino_project.src_listen_events"
[0m10:17:36.470821 [debug] [Thread-1 (]: On model.my_dbt_trino_project.src_listen_events: /* {"app": "dbt", "dbt_version": "1.8.2", "profile_name": "my_dbt_trino_project", "target_name": "dev", "node_id": "model.my_dbt_trino_project.src_listen_events"} */

    drop table if exists "datalake"."analytics_source"."src_listen_events__dbt_tmp"
[0m10:17:36.623102 [debug] [Thread-1 (]: SQL status: SUCCESS in 0.0 seconds
[0m10:17:36.624110 [debug] [Thread-1 (]: On model.my_dbt_trino_project.src_listen_events: ROLLBACK
[0m10:17:36.625110 [debug] [Thread-1 (]: On model.my_dbt_trino_project.src_listen_events: Close
[0m10:17:36.625616 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '76dabc3b-0c8c-492d-99bc-65db3419cd85', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000001B2DE6A2AD0>]}
[0m10:17:36.625616 [info ] [Thread-1 (]: 2 of 15 OK created sql incremental model analytics_source.src_listen_events .... [[32mSUCCESS[0m in 1.80s]
[0m10:17:36.626625 [debug] [Thread-1 (]: Finished running node model.my_dbt_trino_project.src_listen_events
[0m10:17:36.627625 [debug] [Thread-1 (]: Began running node model.my_dbt_trino_project.src_page_view_events
[0m10:17:36.627625 [info ] [Thread-1 (]: 3 of 15 START sql incremental model analytics_source.src_page_view_events ...... [RUN]
[0m10:17:36.628625 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.my_dbt_trino_project.src_listen_events, now model.my_dbt_trino_project.src_page_view_events)
[0m10:17:36.628625 [debug] [Thread-1 (]: Began compiling node model.my_dbt_trino_project.src_page_view_events
[0m10:17:36.631682 [debug] [Thread-1 (]: Writing injected SQL for node "model.my_dbt_trino_project.src_page_view_events"
[0m10:17:36.633187 [debug] [Thread-1 (]: Began executing node model.my_dbt_trino_project.src_page_view_events
[0m10:17:36.638194 [debug] [Thread-1 (]: Using trino connection "model.my_dbt_trino_project.src_page_view_events"
[0m10:17:36.639195 [debug] [Thread-1 (]: On model.my_dbt_trino_project.src_page_view_events: /* {"app": "dbt", "dbt_version": "1.8.2", "profile_name": "my_dbt_trino_project", "target_name": "dev", "node_id": "model.my_dbt_trino_project.src_page_view_events"} */

  
    

    create table "datalake"."analytics_source"."src_page_view_events__dbt_tmp"
      
      
    as (
      

with source as (
    select
        CAST(_id AS VARCHAR) as id,
        ts,
        CAST(sessionId AS VARCHAR) as sessionId,
        page,
        auth,
        level,
        CAST(CAST(NULLIF(itemInSession, '') AS DOUBLE) AS INTEGER) as itemInSession, 
        city,
        zip,
        state,
        userAgent,
        CAST(NULLIF(lon, '') AS double) as lon,
        CAST(NULLIF(lat, '') AS double) as lat,
        CAST(CAST(NULLIF(userId, '') AS DOUBLE) AS INTEGER) as userId, 
        lastName,
        firstName,
        gender,
        CAST(CAST(NULLIF(registration, '') AS DOUBLE) AS BIGINT) as registration, 
        artist,
        song,
        CAST(NULLIF(duration, '') AS double) as duration
    from "website"."demo"."page_view_events"
)

select * from source


    where ts > (select max(ts) from "datalake"."analytics_source"."src_page_view_events")

    )
[0m10:17:36.639195 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m10:17:36.949772 [debug] [Thread-1 (]: SQL status: SUCCESS in 0.0 seconds
[0m10:17:36.951779 [debug] [Thread-1 (]: Using trino connection "model.my_dbt_trino_project.src_page_view_events"
[0m10:17:36.952778 [debug] [Thread-1 (]: On model.my_dbt_trino_project.src_page_view_events: /* {"app": "dbt", "dbt_version": "1.8.2", "profile_name": "my_dbt_trino_project", "target_name": "dev", "node_id": "model.my_dbt_trino_project.src_page_view_events"} */

    describe "datalake"."analytics_source"."src_page_view_events__dbt_tmp"
[0m10:17:37.081626 [debug] [Thread-1 (]: SQL status: SUCCESS in 0.0 seconds
[0m10:17:37.086149 [debug] [Thread-1 (]: Using trino connection "model.my_dbt_trino_project.src_page_view_events"
[0m10:17:37.086732 [debug] [Thread-1 (]: On model.my_dbt_trino_project.src_page_view_events: /* {"app": "dbt", "dbt_version": "1.8.2", "profile_name": "my_dbt_trino_project", "target_name": "dev", "node_id": "model.my_dbt_trino_project.src_page_view_events"} */

    describe "datalake"."analytics_source"."src_page_view_events"
[0m10:17:37.221614 [debug] [Thread-1 (]: SQL status: SUCCESS in 0.0 seconds
[0m10:17:37.278382 [debug] [Thread-1 (]: Using trino connection "model.my_dbt_trino_project.src_page_view_events"
[0m10:17:37.279381 [debug] [Thread-1 (]: On model.my_dbt_trino_project.src_page_view_events: /* {"app": "dbt", "dbt_version": "1.8.2", "profile_name": "my_dbt_trino_project", "target_name": "dev", "node_id": "model.my_dbt_trino_project.src_page_view_events"} */

    describe "datalake"."analytics_source"."src_page_view_events"
[0m10:17:37.406666 [debug] [Thread-1 (]: SQL status: SUCCESS in 0.0 seconds
[0m10:17:37.409179 [debug] [Thread-1 (]: Writing runtime sql for node "model.my_dbt_trino_project.src_page_view_events"
[0m10:17:37.412695 [debug] [Thread-1 (]: Using trino connection "model.my_dbt_trino_project.src_page_view_events"
[0m10:17:37.412695 [debug] [Thread-1 (]: On model.my_dbt_trino_project.src_page_view_events: /* {"app": "dbt", "dbt_version": "1.8.2", "profile_name": "my_dbt_trino_project", "target_name": "dev", "node_id": "model.my_dbt_trino_project.src_page_view_events"} */
insert into "datalake"."analytics_source"."src_page_view_events" ("id", "ts", "sessionid", "page", "auth", "level", "iteminsession", "city", "zip", "state", "useragent", "lon", "lat", "userid", "lastname", "firstname", "gender", "registration", "artist", "song", "duration")
    (
        select "id", "ts", "sessionid", "page", "auth", "level", "iteminsession", "city", "zip", "state", "useragent", "lon", "lat", "userid", "lastname", "firstname", "gender", "registration", "artist", "song", "duration"
        from "datalake"."analytics_source"."src_page_view_events__dbt_tmp"
    )
[0m10:17:37.604770 [debug] [Thread-1 (]: SQL status: SUCCESS in 0.0 seconds
[0m10:17:37.608744 [debug] [Thread-1 (]: Applying DROP to: "datalake"."analytics_source"."src_page_view_events__dbt_tmp"
[0m10:17:37.609250 [debug] [Thread-1 (]: Using trino connection "model.my_dbt_trino_project.src_page_view_events"
[0m10:17:37.609250 [debug] [Thread-1 (]: On model.my_dbt_trino_project.src_page_view_events: /* {"app": "dbt", "dbt_version": "1.8.2", "profile_name": "my_dbt_trino_project", "target_name": "dev", "node_id": "model.my_dbt_trino_project.src_page_view_events"} */

    drop table if exists "datalake"."analytics_source"."src_page_view_events__dbt_tmp"
[0m10:17:37.761510 [debug] [Thread-1 (]: SQL status: SUCCESS in 0.0 seconds
[0m10:17:37.763659 [debug] [Thread-1 (]: On model.my_dbt_trino_project.src_page_view_events: ROLLBACK
[0m10:17:37.763659 [debug] [Thread-1 (]: On model.my_dbt_trino_project.src_page_view_events: Close
[0m10:17:37.764252 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '76dabc3b-0c8c-492d-99bc-65db3419cd85', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000001B2DFFB1E10>]}
[0m10:17:37.765291 [info ] [Thread-1 (]: 3 of 15 OK created sql incremental model analytics_source.src_page_view_events . [[32mSUCCESS[0m in 1.14s]
[0m10:17:37.765821 [debug] [Thread-1 (]: Finished running node model.my_dbt_trino_project.src_page_view_events
[0m10:17:37.766341 [debug] [Thread-1 (]: Began running node model.my_dbt_trino_project.stg_user_level_by_gender
[0m10:17:37.766857 [info ] [Thread-1 (]: 4 of 15 START sql view model analytics_stage.stg_user_level_by_gender .......... [RUN]
[0m10:17:37.767384 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.my_dbt_trino_project.src_page_view_events, now model.my_dbt_trino_project.stg_user_level_by_gender)
[0m10:17:37.767384 [debug] [Thread-1 (]: Began compiling node model.my_dbt_trino_project.stg_user_level_by_gender
[0m10:17:37.770492 [debug] [Thread-1 (]: Writing injected SQL for node "model.my_dbt_trino_project.stg_user_level_by_gender"
[0m10:17:37.771493 [debug] [Thread-1 (]: Began executing node model.my_dbt_trino_project.stg_user_level_by_gender
[0m10:17:37.786819 [debug] [Thread-1 (]: Writing runtime sql for node "model.my_dbt_trino_project.stg_user_level_by_gender"
[0m10:17:37.788407 [debug] [Thread-1 (]: Using trino connection "model.my_dbt_trino_project.stg_user_level_by_gender"
[0m10:17:37.788932 [debug] [Thread-1 (]: On model.my_dbt_trino_project.stg_user_level_by_gender: /* {"app": "dbt", "dbt_version": "1.8.2", "profile_name": "my_dbt_trino_project", "target_name": "dev", "node_id": "model.my_dbt_trino_project.stg_user_level_by_gender"} */

  create or replace view
    "datalake"."analytics_stage"."stg_user_level_by_gender"
  security definer
  as
    

WITH user_subscriptions AS (
    SELECT
        gender,
        level, 
        COUNT(DISTINCT userId) AS user_count
    FROM "datalake"."analytics_source"."src_auth_events"
    WHERE gender IS NOT NULL AND level IS NOT NULL
    GROUP BY gender, level
)

SELECT
    gender,
    level,
    user_count
FROM user_subscriptions
  
[0m10:17:37.789459 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m10:17:37.918980 [debug] [Thread-1 (]: SQL status: SUCCESS in 0.0 seconds
[0m10:17:37.920493 [debug] [Thread-1 (]: On model.my_dbt_trino_project.stg_user_level_by_gender: ROLLBACK
[0m10:17:37.920493 [debug] [Thread-1 (]: On model.my_dbt_trino_project.stg_user_level_by_gender: Close
[0m10:17:37.921497 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '76dabc3b-0c8c-492d-99bc-65db3419cd85', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000001B2DDC47A10>]}
[0m10:17:37.921497 [info ] [Thread-1 (]: 4 of 15 OK created sql view model analytics_stage.stg_user_level_by_gender ..... [[32mSUCCESS[0m in 0.15s]
[0m10:17:37.922790 [debug] [Thread-1 (]: Finished running node model.my_dbt_trino_project.stg_user_level_by_gender
[0m10:17:37.922790 [debug] [Thread-1 (]: Began running node model.my_dbt_trino_project.stg_streams_hourly
[0m10:17:37.923794 [info ] [Thread-1 (]: 5 of 15 START sql table model analytics_stage.stg_streams_hourly ............... [RUN]
[0m10:17:37.923794 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.my_dbt_trino_project.stg_user_level_by_gender, now model.my_dbt_trino_project.stg_streams_hourly)
[0m10:17:37.923794 [debug] [Thread-1 (]: Began compiling node model.my_dbt_trino_project.stg_streams_hourly
[0m10:17:37.927302 [debug] [Thread-1 (]: Writing injected SQL for node "model.my_dbt_trino_project.stg_streams_hourly"
[0m10:17:37.928208 [debug] [Thread-1 (]: Began executing node model.my_dbt_trino_project.stg_streams_hourly
[0m10:17:37.930213 [debug] [Thread-1 (]: Writing runtime sql for node "model.my_dbt_trino_project.stg_streams_hourly"
[0m10:17:37.932212 [debug] [Thread-1 (]: Using trino connection "model.my_dbt_trino_project.stg_streams_hourly"
[0m10:17:37.932212 [debug] [Thread-1 (]: On model.my_dbt_trino_project.stg_streams_hourly: /* {"app": "dbt", "dbt_version": "1.8.2", "profile_name": "my_dbt_trino_project", "target_name": "dev", "node_id": "model.my_dbt_trino_project.stg_streams_hourly"} */

  
    

    create table "datalake"."analytics_stage"."stg_streams_hourly__dbt_tmp"
      
      
    as (
      

SELECT
    DATE_FORMAT(FROM_UNIXTIME(ts), '%Y-%m-%d') AS stream_date, 
    DATE_FORMAT(FROM_UNIXTIME(ts), '%H') AS stream_hour,
    COUNT(*) AS total_streams
FROM "datalake"."analytics_source"."src_listen_events"
GROUP BY
    DATE_FORMAT(FROM_UNIXTIME(ts), '%Y-%m-%d'),
    DATE_FORMAT(FROM_UNIXTIME(ts), '%H')
    )
[0m10:17:37.932212 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m10:17:38.498691 [debug] [Thread-1 (]: SQL status: SUCCESS in 1.0 seconds
[0m10:17:38.501689 [debug] [Thread-1 (]: Using trino connection "model.my_dbt_trino_project.stg_streams_hourly"
[0m10:17:38.502687 [debug] [Thread-1 (]: On model.my_dbt_trino_project.stg_streams_hourly: /* {"app": "dbt", "dbt_version": "1.8.2", "profile_name": "my_dbt_trino_project", "target_name": "dev", "node_id": "model.my_dbt_trino_project.stg_streams_hourly"} */
alter table "datalake"."analytics_stage"."stg_streams_hourly" rename to "datalake"."analytics_stage"."stg_streams_hourly__dbt_backup"
[0m10:17:38.605991 [debug] [Thread-1 (]: SQL status: SUCCESS in 0.0 seconds
[0m10:17:38.609998 [debug] [Thread-1 (]: Using trino connection "model.my_dbt_trino_project.stg_streams_hourly"
[0m10:17:38.610996 [debug] [Thread-1 (]: On model.my_dbt_trino_project.stg_streams_hourly: /* {"app": "dbt", "dbt_version": "1.8.2", "profile_name": "my_dbt_trino_project", "target_name": "dev", "node_id": "model.my_dbt_trino_project.stg_streams_hourly"} */
alter table "datalake"."analytics_stage"."stg_streams_hourly__dbt_tmp" rename to "datalake"."analytics_stage"."stg_streams_hourly"
[0m10:17:38.712159 [debug] [Thread-1 (]: SQL status: SUCCESS in 0.0 seconds
[0m10:17:38.715462 [debug] [Thread-1 (]: Applying DROP to: "datalake"."analytics_stage"."stg_streams_hourly__dbt_backup"
[0m10:17:38.716461 [debug] [Thread-1 (]: Using trino connection "model.my_dbt_trino_project.stg_streams_hourly"
[0m10:17:38.716461 [debug] [Thread-1 (]: On model.my_dbt_trino_project.stg_streams_hourly: /* {"app": "dbt", "dbt_version": "1.8.2", "profile_name": "my_dbt_trino_project", "target_name": "dev", "node_id": "model.my_dbt_trino_project.stg_streams_hourly"} */

    drop table if exists "datalake"."analytics_stage"."stg_streams_hourly__dbt_backup"
[0m10:17:38.825974 [debug] [Thread-1 (]: SQL status: SUCCESS in 0.0 seconds
[0m10:17:38.826985 [debug] [Thread-1 (]: On model.my_dbt_trino_project.stg_streams_hourly: ROLLBACK
[0m10:17:38.827983 [debug] [Thread-1 (]: On model.my_dbt_trino_project.stg_streams_hourly: Close
[0m10:17:38.827983 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '76dabc3b-0c8c-492d-99bc-65db3419cd85', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000001B2DFF35510>]}
[0m10:17:38.828981 [info ] [Thread-1 (]: 5 of 15 OK created sql table model analytics_stage.stg_streams_hourly .......... [[32mSUCCESS[0m in 0.90s]
[0m10:17:38.829983 [debug] [Thread-1 (]: Finished running node model.my_dbt_trino_project.stg_streams_hourly
[0m10:17:38.829983 [debug] [Thread-1 (]: Began running node model.my_dbt_trino_project.stg_top_songs_artists
[0m10:17:38.830983 [info ] [Thread-1 (]: 6 of 15 START sql view model analytics_stage.stg_top_songs_artists ............. [RUN]
[0m10:17:38.830983 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.my_dbt_trino_project.stg_streams_hourly, now model.my_dbt_trino_project.stg_top_songs_artists)
[0m10:17:38.831983 [debug] [Thread-1 (]: Began compiling node model.my_dbt_trino_project.stg_top_songs_artists
[0m10:17:38.833982 [debug] [Thread-1 (]: Writing injected SQL for node "model.my_dbt_trino_project.stg_top_songs_artists"
[0m10:17:38.834992 [debug] [Thread-1 (]: Began executing node model.my_dbt_trino_project.stg_top_songs_artists
[0m10:17:38.836994 [debug] [Thread-1 (]: Writing runtime sql for node "model.my_dbt_trino_project.stg_top_songs_artists"
[0m10:17:38.837994 [debug] [Thread-1 (]: Using trino connection "model.my_dbt_trino_project.stg_top_songs_artists"
[0m10:17:38.838993 [debug] [Thread-1 (]: On model.my_dbt_trino_project.stg_top_songs_artists: /* {"app": "dbt", "dbt_version": "1.8.2", "profile_name": "my_dbt_trino_project", "target_name": "dev", "node_id": "model.my_dbt_trino_project.stg_top_songs_artists"} */

  create or replace view
    "datalake"."analytics_stage"."stg_top_songs_artists"
  security definer
  as
    

WITH song_plays AS (
    SELECT
        artist,
        song,
        COUNT(*) AS play_count
    FROM "datalake"."analytics_source"."src_listen_events"
    GROUP BY artist, song
)

SELECT
    artist,
    song,
    play_count
FROM song_plays
ORDER BY play_count DESC
  
[0m10:17:38.838993 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m10:17:38.935319 [debug] [Thread-1 (]: SQL status: SUCCESS in 0.0 seconds
[0m10:17:38.937318 [debug] [Thread-1 (]: On model.my_dbt_trino_project.stg_top_songs_artists: ROLLBACK
[0m10:17:38.937318 [debug] [Thread-1 (]: On model.my_dbt_trino_project.stg_top_songs_artists: Close
[0m10:17:38.937318 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '76dabc3b-0c8c-492d-99bc-65db3419cd85', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000001B2DA1C3A10>]}
[0m10:17:38.938321 [info ] [Thread-1 (]: 6 of 15 OK created sql view model analytics_stage.stg_top_songs_artists ........ [[32mSUCCESS[0m in 0.11s]
[0m10:17:38.939320 [debug] [Thread-1 (]: Finished running node model.my_dbt_trino_project.stg_top_songs_artists
[0m10:17:38.939320 [debug] [Thread-1 (]: Began running node model.my_dbt_trino_project.stg_unique_users
[0m10:17:38.940318 [info ] [Thread-1 (]: 7 of 15 START sql view model analytics_stage.stg_unique_users .................. [RUN]
[0m10:17:38.940318 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.my_dbt_trino_project.stg_top_songs_artists, now model.my_dbt_trino_project.stg_unique_users)
[0m10:17:38.940318 [debug] [Thread-1 (]: Began compiling node model.my_dbt_trino_project.stg_unique_users
[0m10:17:38.943319 [debug] [Thread-1 (]: Writing injected SQL for node "model.my_dbt_trino_project.stg_unique_users"
[0m10:17:38.944318 [debug] [Thread-1 (]: Began executing node model.my_dbt_trino_project.stg_unique_users
[0m10:17:38.946686 [debug] [Thread-1 (]: Writing runtime sql for node "model.my_dbt_trino_project.stg_unique_users"
[0m10:17:38.947696 [debug] [Thread-1 (]: Using trino connection "model.my_dbt_trino_project.stg_unique_users"
[0m10:17:38.947696 [debug] [Thread-1 (]: On model.my_dbt_trino_project.stg_unique_users: /* {"app": "dbt", "dbt_version": "1.8.2", "profile_name": "my_dbt_trino_project", "target_name": "dev", "node_id": "model.my_dbt_trino_project.stg_unique_users"} */

  create or replace view
    "datalake"."analytics_stage"."stg_unique_users"
  security definer
  as
    

SELECT
    COUNT(DISTINCT userid) AS total_unique_users
FROM "datalake"."analytics_source"."src_listen_events"
WHERE userid IS NOT NULL
  
[0m10:17:38.947696 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m10:17:39.031400 [debug] [Thread-1 (]: SQL status: SUCCESS in 0.0 seconds
[0m10:17:39.033409 [debug] [Thread-1 (]: On model.my_dbt_trino_project.stg_unique_users: ROLLBACK
[0m10:17:39.033409 [debug] [Thread-1 (]: On model.my_dbt_trino_project.stg_unique_users: Close
[0m10:17:39.033409 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '76dabc3b-0c8c-492d-99bc-65db3419cd85', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000001B2DE078E90>]}
[0m10:17:39.034406 [info ] [Thread-1 (]: 7 of 15 OK created sql view model analytics_stage.stg_unique_users ............. [[32mSUCCESS[0m in 0.09s]
[0m10:17:39.035408 [debug] [Thread-1 (]: Finished running node model.my_dbt_trino_project.stg_unique_users
[0m10:17:39.035408 [debug] [Thread-1 (]: Began running node model.my_dbt_trino_project.stg_user_activity_per_country
[0m10:17:39.036410 [info ] [Thread-1 (]: 8 of 15 START sql view model analytics_stage.stg_user_activity_per_country ..... [RUN]
[0m10:17:39.036410 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.my_dbt_trino_project.stg_unique_users, now model.my_dbt_trino_project.stg_user_activity_per_country)
[0m10:17:39.037527 [debug] [Thread-1 (]: Began compiling node model.my_dbt_trino_project.stg_user_activity_per_country
[0m10:17:39.039531 [debug] [Thread-1 (]: Writing injected SQL for node "model.my_dbt_trino_project.stg_user_activity_per_country"
[0m10:17:39.040534 [debug] [Thread-1 (]: Began executing node model.my_dbt_trino_project.stg_user_activity_per_country
[0m10:17:39.043048 [debug] [Thread-1 (]: Writing runtime sql for node "model.my_dbt_trino_project.stg_user_activity_per_country"
[0m10:17:39.044056 [debug] [Thread-1 (]: Using trino connection "model.my_dbt_trino_project.stg_user_activity_per_country"
[0m10:17:39.044056 [debug] [Thread-1 (]: On model.my_dbt_trino_project.stg_user_activity_per_country: /* {"app": "dbt", "dbt_version": "1.8.2", "profile_name": "my_dbt_trino_project", "target_name": "dev", "node_id": "model.my_dbt_trino_project.stg_user_activity_per_country"} */

  create or replace view
    "datalake"."analytics_stage"."stg_user_activity_per_country"
  security definer
  as
    

WITH combined_activities AS (
  SELECT
    country,
    'listen_event' AS event_type,
    ts,
    userid
  FROM "datalake"."analytics_source"."src_listen_events"
  WHERE country IS NOT NULL
  UNION ALL
  SELECT
    'Unknown' AS country, 
    ts,
    userid
  FROM "datalake"."analytics_source"."src_auth_events"
  UNION ALL
  SELECT
    'Unknown' AS country, 
    'page_view_event' AS event_type,
    ts,
    userid
  FROM "datalake"."analytics_source"."src_page_view_events"
)

SELECT
  country,
  COUNT(*) AS activity_count
FROM combined_activities
GROUP BY country
  
[0m10:17:39.045531 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m10:17:39.127309 [debug] [Thread-1 (]: Trino adapter: Trino query id: 20240619_021739_00030_uxt54
[0m10:17:39.127824 [debug] [Thread-1 (]: Trino adapter: Trino error: TrinoUserError(type=USER_ERROR, name=TYPE_MISMATCH, message="line 17:3: UNION query has different number of fields: 4, 3", query_id=20240619_021739_00030_uxt54)
[0m10:17:39.128831 [debug] [Thread-1 (]: On model.my_dbt_trino_project.stg_user_activity_per_country: ROLLBACK
[0m10:17:39.128831 [debug] [Thread-1 (]: On model.my_dbt_trino_project.stg_user_activity_per_country: Close
[0m10:17:39.136935 [debug] [Thread-1 (]: Database Error in model stg_user_activity_per_country (models\stage\stg_user_activity_per_country.sql)
  TrinoUserError(type=USER_ERROR, name=TYPE_MISMATCH, message="line 17:3: UNION query has different number of fields: 4, 3", query_id=20240619_021739_00030_uxt54)
  compiled Code at target\run\my_dbt_trino_project\models\stage\stg_user_activity_per_country.sql
[0m10:17:39.137944 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '76dabc3b-0c8c-492d-99bc-65db3419cd85', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000001B2DFF86A90>]}
[0m10:17:39.139156 [error] [Thread-1 (]: 8 of 15 ERROR creating sql view model analytics_stage.stg_user_activity_per_country  [[31mERROR[0m in 0.10s]
[0m10:17:39.140165 [debug] [Thread-1 (]: Finished running node model.my_dbt_trino_project.stg_user_activity_per_country
[0m10:17:39.140165 [debug] [Thread-1 (]: Began running node model.my_dbt_trino_project.stg_user_activity_per_location
[0m10:17:39.141165 [info ] [Thread-1 (]: 9 of 15 START sql view model analytics_stage.stg_user_activity_per_location .... [RUN]
[0m10:17:39.141165 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.my_dbt_trino_project.stg_user_activity_per_country, now model.my_dbt_trino_project.stg_user_activity_per_location)
[0m10:17:39.141165 [debug] [Thread-1 (]: Began compiling node model.my_dbt_trino_project.stg_user_activity_per_location
[0m10:17:39.144369 [debug] [Thread-1 (]: Writing injected SQL for node "model.my_dbt_trino_project.stg_user_activity_per_location"
[0m10:17:39.145369 [debug] [Thread-1 (]: Began executing node model.my_dbt_trino_project.stg_user_activity_per_location
[0m10:17:39.149877 [debug] [Thread-1 (]: Writing runtime sql for node "model.my_dbt_trino_project.stg_user_activity_per_location"
[0m10:17:39.151503 [debug] [Thread-1 (]: Using trino connection "model.my_dbt_trino_project.stg_user_activity_per_location"
[0m10:17:39.152504 [debug] [Thread-1 (]: On model.my_dbt_trino_project.stg_user_activity_per_location: /* {"app": "dbt", "dbt_version": "1.8.2", "profile_name": "my_dbt_trino_project", "target_name": "dev", "node_id": "model.my_dbt_trino_project.stg_user_activity_per_location"} */

  create or replace view
    "datalake"."analytics_stage"."stg_user_activity_per_location"
  security definer
  as
    

WITH combined_activities AS (
  SELECT
    city,
    state,
    'auth_event' AS event_type,
    ts,
    userid
 FROM "datalake"."analytics_source"."src_auth_events"
  UNION ALL
  SELECT
    city,
    state,
    'listen_event' AS event_type,
    ts,
    userid
  FROM "datalake"."analytics_source"."src_listen_events"
  UNION ALL
  SELECT
    city,
    state,
    'page_view_event' AS event_type,
    ts,
    userid
  FROM "datalake"."analytics_source"."src_page_view_events"
)

SELECT
  state,
  city,
  COUNT(*) AS activity_count
FROM combined_activities
GROUP BY state, city
  
[0m10:17:39.152504 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m10:17:39.266839 [debug] [Thread-1 (]: SQL status: SUCCESS in 0.0 seconds
[0m10:17:39.269347 [debug] [Thread-1 (]: On model.my_dbt_trino_project.stg_user_activity_per_location: ROLLBACK
[0m10:17:39.269347 [debug] [Thread-1 (]: On model.my_dbt_trino_project.stg_user_activity_per_location: Close
[0m10:17:39.270357 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '76dabc3b-0c8c-492d-99bc-65db3419cd85', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000001B2DB1C6E10>]}
[0m10:17:39.270357 [info ] [Thread-1 (]: 9 of 15 OK created sql view model analytics_stage.stg_user_activity_per_location  [[32mSUCCESS[0m in 0.13s]
[0m10:17:39.271973 [debug] [Thread-1 (]: Finished running node model.my_dbt_trino_project.stg_user_activity_per_location
[0m10:17:39.271973 [debug] [Thread-1 (]: Began running node model.my_dbt_trino_project.mart_user_level_by_gender
[0m10:17:39.271973 [info ] [Thread-1 (]: 10 of 15 START sql table model analytics.mart_user_level_by_gender ............. [RUN]
[0m10:17:39.273478 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.my_dbt_trino_project.stg_user_activity_per_location, now model.my_dbt_trino_project.mart_user_level_by_gender)
[0m10:17:39.273478 [debug] [Thread-1 (]: Began compiling node model.my_dbt_trino_project.mart_user_level_by_gender
[0m10:17:39.276487 [debug] [Thread-1 (]: Writing injected SQL for node "model.my_dbt_trino_project.mart_user_level_by_gender"
[0m10:17:39.276487 [debug] [Thread-1 (]: Began executing node model.my_dbt_trino_project.mart_user_level_by_gender
[0m10:17:39.280484 [debug] [Thread-1 (]: Writing runtime sql for node "model.my_dbt_trino_project.mart_user_level_by_gender"
[0m10:17:39.281487 [debug] [Thread-1 (]: Using trino connection "model.my_dbt_trino_project.mart_user_level_by_gender"
[0m10:17:39.282484 [debug] [Thread-1 (]: On model.my_dbt_trino_project.mart_user_level_by_gender: /* {"app": "dbt", "dbt_version": "1.8.2", "profile_name": "my_dbt_trino_project", "target_name": "dev", "node_id": "model.my_dbt_trino_project.mart_user_level_by_gender"} */

  
    

    create table "datalake"."analytics"."mart_user_level_by_gender__dbt_tmp"
      
      
    as (
      

SELECT
    gender,
    level,
    SUM(user_count) AS total_users,
    ROUND(SUM(user_count) * 100.0 / SUM(SUM(user_count)) OVER (), 2) AS percentage_of_total_users
FROM "datalake"."analytics_stage"."stg_user_level_by_gender"
GROUP BY gender, level
    )
[0m10:17:39.282484 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m10:17:39.824812 [debug] [Thread-1 (]: SQL status: SUCCESS in 1.0 seconds
[0m10:17:39.828034 [debug] [Thread-1 (]: Using trino connection "model.my_dbt_trino_project.mart_user_level_by_gender"
[0m10:17:39.829033 [debug] [Thread-1 (]: On model.my_dbt_trino_project.mart_user_level_by_gender: /* {"app": "dbt", "dbt_version": "1.8.2", "profile_name": "my_dbt_trino_project", "target_name": "dev", "node_id": "model.my_dbt_trino_project.mart_user_level_by_gender"} */
alter table "datalake"."analytics"."mart_user_level_by_gender" rename to "datalake"."analytics"."mart_user_level_by_gender__dbt_backup"
[0m10:17:39.933499 [debug] [Thread-1 (]: SQL status: SUCCESS in 0.0 seconds
[0m10:17:39.936651 [debug] [Thread-1 (]: Using trino connection "model.my_dbt_trino_project.mart_user_level_by_gender"
[0m10:17:39.936651 [debug] [Thread-1 (]: On model.my_dbt_trino_project.mart_user_level_by_gender: /* {"app": "dbt", "dbt_version": "1.8.2", "profile_name": "my_dbt_trino_project", "target_name": "dev", "node_id": "model.my_dbt_trino_project.mart_user_level_by_gender"} */
alter table "datalake"."analytics"."mart_user_level_by_gender__dbt_tmp" rename to "datalake"."analytics"."mart_user_level_by_gender"
[0m10:17:39.989322 [debug] [Thread-1 (]: SQL status: SUCCESS in 0.0 seconds
[0m10:17:39.991826 [debug] [Thread-1 (]: Applying DROP to: "datalake"."analytics"."mart_user_level_by_gender__dbt_backup"
[0m10:17:39.992836 [debug] [Thread-1 (]: Using trino connection "model.my_dbt_trino_project.mart_user_level_by_gender"
[0m10:17:39.992836 [debug] [Thread-1 (]: On model.my_dbt_trino_project.mart_user_level_by_gender: /* {"app": "dbt", "dbt_version": "1.8.2", "profile_name": "my_dbt_trino_project", "target_name": "dev", "node_id": "model.my_dbt_trino_project.mart_user_level_by_gender"} */

    drop table if exists "datalake"."analytics"."mart_user_level_by_gender__dbt_backup"
[0m10:17:40.152026 [debug] [Thread-1 (]: SQL status: SUCCESS in 0.0 seconds
[0m10:17:40.154037 [debug] [Thread-1 (]: On model.my_dbt_trino_project.mart_user_level_by_gender: ROLLBACK
[0m10:17:40.154037 [debug] [Thread-1 (]: On model.my_dbt_trino_project.mart_user_level_by_gender: Close
[0m10:17:40.155038 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '76dabc3b-0c8c-492d-99bc-65db3419cd85', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000001B2DFAA2310>]}
[0m10:17:40.155038 [info ] [Thread-1 (]: 10 of 15 OK created sql table model analytics.mart_user_level_by_gender ........ [[32mSUCCESS[0m in 0.88s]
[0m10:17:40.156036 [debug] [Thread-1 (]: Finished running node model.my_dbt_trino_project.mart_user_level_by_gender
[0m10:17:40.157055 [debug] [Thread-1 (]: Began running node model.my_dbt_trino_project.mart_hourly_stream_evolution
[0m10:17:40.157055 [info ] [Thread-1 (]: 11 of 15 START sql table model analytics.mart_hourly_stream_evolution .......... [RUN]
[0m10:17:40.157055 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.my_dbt_trino_project.mart_user_level_by_gender, now model.my_dbt_trino_project.mart_hourly_stream_evolution)
[0m10:17:40.158054 [debug] [Thread-1 (]: Began compiling node model.my_dbt_trino_project.mart_hourly_stream_evolution
[0m10:17:40.160054 [debug] [Thread-1 (]: Writing injected SQL for node "model.my_dbt_trino_project.mart_hourly_stream_evolution"
[0m10:17:40.161053 [debug] [Thread-1 (]: Began executing node model.my_dbt_trino_project.mart_hourly_stream_evolution
[0m10:17:40.164055 [debug] [Thread-1 (]: Writing runtime sql for node "model.my_dbt_trino_project.mart_hourly_stream_evolution"
[0m10:17:40.166258 [debug] [Thread-1 (]: Using trino connection "model.my_dbt_trino_project.mart_hourly_stream_evolution"
[0m10:17:40.166769 [debug] [Thread-1 (]: On model.my_dbt_trino_project.mart_hourly_stream_evolution: /* {"app": "dbt", "dbt_version": "1.8.2", "profile_name": "my_dbt_trino_project", "target_name": "dev", "node_id": "model.my_dbt_trino_project.mart_hourly_stream_evolution"} */

  
    

    create table "datalake"."analytics"."mart_hourly_stream_evolution__dbt_tmp"
      
      
    as (
      

SELECT
    stream_date,
    stream_hour,
    total_streams,
    SUM(total_streams) OVER (PARTITION BY stream_date ORDER BY stream_hour) AS cumulative_streams
FROM "datalake"."analytics_stage"."stg_streams_hourly"
ORDER BY
    stream_date,
    stream_hour
    )
[0m10:17:40.166769 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m10:17:40.485701 [debug] [Thread-1 (]: SQL status: SUCCESS in 0.0 seconds
[0m10:17:40.488709 [debug] [Thread-1 (]: Using trino connection "model.my_dbt_trino_project.mart_hourly_stream_evolution"
[0m10:17:40.489706 [debug] [Thread-1 (]: On model.my_dbt_trino_project.mart_hourly_stream_evolution: /* {"app": "dbt", "dbt_version": "1.8.2", "profile_name": "my_dbt_trino_project", "target_name": "dev", "node_id": "model.my_dbt_trino_project.mart_hourly_stream_evolution"} */
alter table "datalake"."analytics"."mart_hourly_stream_evolution" rename to "datalake"."analytics"."mart_hourly_stream_evolution__dbt_backup"
[0m10:17:40.587415 [debug] [Thread-1 (]: SQL status: SUCCESS in 0.0 seconds
[0m10:17:40.592427 [debug] [Thread-1 (]: Using trino connection "model.my_dbt_trino_project.mart_hourly_stream_evolution"
[0m10:17:40.593427 [debug] [Thread-1 (]: On model.my_dbt_trino_project.mart_hourly_stream_evolution: /* {"app": "dbt", "dbt_version": "1.8.2", "profile_name": "my_dbt_trino_project", "target_name": "dev", "node_id": "model.my_dbt_trino_project.mart_hourly_stream_evolution"} */
alter table "datalake"."analytics"."mart_hourly_stream_evolution__dbt_tmp" rename to "datalake"."analytics"."mart_hourly_stream_evolution"
[0m10:17:40.695620 [debug] [Thread-1 (]: SQL status: SUCCESS in 0.0 seconds
[0m10:17:40.698628 [debug] [Thread-1 (]: Applying DROP to: "datalake"."analytics"."mart_hourly_stream_evolution__dbt_backup"
[0m10:17:40.699628 [debug] [Thread-1 (]: Using trino connection "model.my_dbt_trino_project.mart_hourly_stream_evolution"
[0m10:17:40.699628 [debug] [Thread-1 (]: On model.my_dbt_trino_project.mart_hourly_stream_evolution: /* {"app": "dbt", "dbt_version": "1.8.2", "profile_name": "my_dbt_trino_project", "target_name": "dev", "node_id": "model.my_dbt_trino_project.mart_hourly_stream_evolution"} */

    drop table if exists "datalake"."analytics"."mart_hourly_stream_evolution__dbt_backup"
[0m10:17:40.855161 [debug] [Thread-1 (]: SQL status: SUCCESS in 0.0 seconds
[0m10:17:40.857629 [debug] [Thread-1 (]: On model.my_dbt_trino_project.mart_hourly_stream_evolution: ROLLBACK
[0m10:17:40.857629 [debug] [Thread-1 (]: On model.my_dbt_trino_project.mart_hourly_stream_evolution: Close
[0m10:17:40.857629 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '76dabc3b-0c8c-492d-99bc-65db3419cd85', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000001B2DFF36510>]}
[0m10:17:40.859048 [info ] [Thread-1 (]: 11 of 15 OK created sql table model analytics.mart_hourly_stream_evolution ..... [[32mSUCCESS[0m in 0.70s]
[0m10:17:40.859048 [debug] [Thread-1 (]: Finished running node model.my_dbt_trino_project.mart_hourly_stream_evolution
[0m10:17:40.860057 [debug] [Thread-1 (]: Began running node model.my_dbt_trino_project.mart_top_songs_artists
[0m10:17:40.860057 [info ] [Thread-1 (]: 12 of 15 START sql table model analytics.mart_top_songs_artists ................ [RUN]
[0m10:17:40.860057 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.my_dbt_trino_project.mart_hourly_stream_evolution, now model.my_dbt_trino_project.mart_top_songs_artists)
[0m10:17:40.860057 [debug] [Thread-1 (]: Began compiling node model.my_dbt_trino_project.mart_top_songs_artists
[0m10:17:40.863479 [debug] [Thread-1 (]: Writing injected SQL for node "model.my_dbt_trino_project.mart_top_songs_artists"
[0m10:17:40.863479 [debug] [Thread-1 (]: Began executing node model.my_dbt_trino_project.mart_top_songs_artists
[0m10:17:40.866269 [debug] [Thread-1 (]: Writing runtime sql for node "model.my_dbt_trino_project.mart_top_songs_artists"
[0m10:17:40.867710 [debug] [Thread-1 (]: Using trino connection "model.my_dbt_trino_project.mart_top_songs_artists"
[0m10:17:40.867710 [debug] [Thread-1 (]: On model.my_dbt_trino_project.mart_top_songs_artists: /* {"app": "dbt", "dbt_version": "1.8.2", "profile_name": "my_dbt_trino_project", "target_name": "dev", "node_id": "model.my_dbt_trino_project.mart_top_songs_artists"} */

  
    

    create table "datalake"."analytics"."mart_top_songs_artists__dbt_tmp"
      
      
    as (
      

WITH top_songs AS (
    SELECT
        artist,
        song,
        play_count
    FROM "datalake"."analytics_stage"."stg_top_songs_artists"
)

SELECT
    artist,
    song,
    play_count
FROM top_songs
    )
[0m10:17:40.867710 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m10:17:41.196279 [debug] [Thread-1 (]: SQL status: SUCCESS in 0.0 seconds
[0m10:17:41.199474 [debug] [Thread-1 (]: Using trino connection "model.my_dbt_trino_project.mart_top_songs_artists"
[0m10:17:41.200008 [debug] [Thread-1 (]: On model.my_dbt_trino_project.mart_top_songs_artists: /* {"app": "dbt", "dbt_version": "1.8.2", "profile_name": "my_dbt_trino_project", "target_name": "dev", "node_id": "model.my_dbt_trino_project.mart_top_songs_artists"} */
alter table "datalake"."analytics"."mart_top_songs_artists" rename to "datalake"."analytics"."mart_top_songs_artists__dbt_backup"
[0m10:17:41.300256 [debug] [Thread-1 (]: SQL status: SUCCESS in 0.0 seconds
[0m10:17:41.303253 [debug] [Thread-1 (]: Using trino connection "model.my_dbt_trino_project.mart_top_songs_artists"
[0m10:17:41.303253 [debug] [Thread-1 (]: On model.my_dbt_trino_project.mart_top_songs_artists: /* {"app": "dbt", "dbt_version": "1.8.2", "profile_name": "my_dbt_trino_project", "target_name": "dev", "node_id": "model.my_dbt_trino_project.mart_top_songs_artists"} */
alter table "datalake"."analytics"."mart_top_songs_artists__dbt_tmp" rename to "datalake"."analytics"."mart_top_songs_artists"
[0m10:17:41.352483 [debug] [Thread-1 (]: SQL status: SUCCESS in 0.0 seconds
[0m10:17:41.355480 [debug] [Thread-1 (]: Applying DROP to: "datalake"."analytics"."mart_top_songs_artists__dbt_backup"
[0m10:17:41.356479 [debug] [Thread-1 (]: Using trino connection "model.my_dbt_trino_project.mart_top_songs_artists"
[0m10:17:41.356479 [debug] [Thread-1 (]: On model.my_dbt_trino_project.mart_top_songs_artists: /* {"app": "dbt", "dbt_version": "1.8.2", "profile_name": "my_dbt_trino_project", "target_name": "dev", "node_id": "model.my_dbt_trino_project.mart_top_songs_artists"} */

    drop table if exists "datalake"."analytics"."mart_top_songs_artists__dbt_backup"
[0m10:17:41.505931 [debug] [Thread-1 (]: SQL status: SUCCESS in 0.0 seconds
[0m10:17:41.507928 [debug] [Thread-1 (]: On model.my_dbt_trino_project.mart_top_songs_artists: ROLLBACK
[0m10:17:41.507928 [debug] [Thread-1 (]: On model.my_dbt_trino_project.mart_top_songs_artists: Close
[0m10:17:41.508929 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '76dabc3b-0c8c-492d-99bc-65db3419cd85', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000001B2DE483C90>]}
[0m10:17:41.508929 [info ] [Thread-1 (]: 12 of 15 OK created sql table model analytics.mart_top_songs_artists ........... [[32mSUCCESS[0m in 0.65s]
[0m10:17:41.509926 [debug] [Thread-1 (]: Finished running node model.my_dbt_trino_project.mart_top_songs_artists
[0m10:17:41.509926 [debug] [Thread-1 (]: Began running node model.my_dbt_trino_project.mart_total_unique_users
[0m10:17:41.510926 [info ] [Thread-1 (]: 13 of 15 START sql table model analytics.mart_total_unique_users ............... [RUN]
[0m10:17:41.511392 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.my_dbt_trino_project.mart_top_songs_artists, now model.my_dbt_trino_project.mart_total_unique_users)
[0m10:17:41.511392 [debug] [Thread-1 (]: Began compiling node model.my_dbt_trino_project.mart_total_unique_users
[0m10:17:41.514403 [debug] [Thread-1 (]: Writing injected SQL for node "model.my_dbt_trino_project.mart_total_unique_users"
[0m10:17:41.515046 [debug] [Thread-1 (]: Began executing node model.my_dbt_trino_project.mart_total_unique_users
[0m10:17:41.518060 [debug] [Thread-1 (]: Writing runtime sql for node "model.my_dbt_trino_project.mart_total_unique_users"
[0m10:17:41.519056 [debug] [Thread-1 (]: Using trino connection "model.my_dbt_trino_project.mart_total_unique_users"
[0m10:17:41.519056 [debug] [Thread-1 (]: On model.my_dbt_trino_project.mart_total_unique_users: /* {"app": "dbt", "dbt_version": "1.8.2", "profile_name": "my_dbt_trino_project", "target_name": "dev", "node_id": "model.my_dbt_trino_project.mart_total_unique_users"} */

  
    

    create table "datalake"."analytics"."mart_total_unique_users__dbt_tmp"
      
      
    as (
      

SELECT
    total_unique_users
FROM "datalake"."analytics_stage"."stg_unique_users"
    )
[0m10:17:41.519056 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m10:17:41.891582 [debug] [Thread-1 (]: SQL status: SUCCESS in 0.0 seconds
[0m10:17:41.895581 [debug] [Thread-1 (]: Using trino connection "model.my_dbt_trino_project.mart_total_unique_users"
[0m10:17:41.896584 [debug] [Thread-1 (]: On model.my_dbt_trino_project.mart_total_unique_users: /* {"app": "dbt", "dbt_version": "1.8.2", "profile_name": "my_dbt_trino_project", "target_name": "dev", "node_id": "model.my_dbt_trino_project.mart_total_unique_users"} */
alter table "datalake"."analytics"."mart_total_unique_users" rename to "datalake"."analytics"."mart_total_unique_users__dbt_backup"
[0m10:17:41.995534 [debug] [Thread-1 (]: SQL status: SUCCESS in 0.0 seconds
[0m10:17:41.998045 [debug] [Thread-1 (]: Using trino connection "model.my_dbt_trino_project.mart_total_unique_users"
[0m10:17:41.998045 [debug] [Thread-1 (]: On model.my_dbt_trino_project.mart_total_unique_users: /* {"app": "dbt", "dbt_version": "1.8.2", "profile_name": "my_dbt_trino_project", "target_name": "dev", "node_id": "model.my_dbt_trino_project.mart_total_unique_users"} */
alter table "datalake"."analytics"."mart_total_unique_users__dbt_tmp" rename to "datalake"."analytics"."mart_total_unique_users"
[0m10:17:42.107517 [debug] [Thread-1 (]: SQL status: SUCCESS in 0.0 seconds
[0m10:17:42.110525 [debug] [Thread-1 (]: Applying DROP to: "datalake"."analytics"."mart_total_unique_users__dbt_backup"
[0m10:17:42.110525 [debug] [Thread-1 (]: Using trino connection "model.my_dbt_trino_project.mart_total_unique_users"
[0m10:17:42.111533 [debug] [Thread-1 (]: On model.my_dbt_trino_project.mart_total_unique_users: /* {"app": "dbt", "dbt_version": "1.8.2", "profile_name": "my_dbt_trino_project", "target_name": "dev", "node_id": "model.my_dbt_trino_project.mart_total_unique_users"} */

    drop table if exists "datalake"."analytics"."mart_total_unique_users__dbt_backup"
[0m10:17:42.259040 [debug] [Thread-1 (]: SQL status: SUCCESS in 0.0 seconds
[0m10:17:42.260542 [debug] [Thread-1 (]: On model.my_dbt_trino_project.mart_total_unique_users: ROLLBACK
[0m10:17:42.260542 [debug] [Thread-1 (]: On model.my_dbt_trino_project.mart_total_unique_users: Close
[0m10:17:42.261981 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '76dabc3b-0c8c-492d-99bc-65db3419cd85', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000001B2DDD30590>]}
[0m10:17:42.262986 [info ] [Thread-1 (]: 13 of 15 OK created sql table model analytics.mart_total_unique_users .......... [[32mSUCCESS[0m in 0.75s]
[0m10:17:42.262986 [debug] [Thread-1 (]: Finished running node model.my_dbt_trino_project.mart_total_unique_users
[0m10:17:42.262986 [debug] [Thread-1 (]: Began running node model.my_dbt_trino_project.mart_user_activity_per_country
[0m10:17:42.264442 [info ] [Thread-1 (]: 14 of 15 SKIP relation analytics.mart_user_activity_per_country ................ [[33mSKIP[0m]
[0m10:17:42.264442 [debug] [Thread-1 (]: Finished running node model.my_dbt_trino_project.mart_user_activity_per_country
[0m10:17:42.265448 [debug] [Thread-1 (]: Began running node model.my_dbt_trino_project.mart_user_activity_per_state
[0m10:17:42.265448 [info ] [Thread-1 (]: 15 of 15 START sql table model analytics.mart_user_activity_per_state .......... [RUN]
[0m10:17:42.265448 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.my_dbt_trino_project.mart_total_unique_users, now model.my_dbt_trino_project.mart_user_activity_per_state)
[0m10:17:42.266688 [debug] [Thread-1 (]: Began compiling node model.my_dbt_trino_project.mart_user_activity_per_state
[0m10:17:42.269694 [debug] [Thread-1 (]: Writing injected SQL for node "model.my_dbt_trino_project.mart_user_activity_per_state"
[0m10:17:42.270695 [debug] [Thread-1 (]: Began executing node model.my_dbt_trino_project.mart_user_activity_per_state
[0m10:17:42.273241 [debug] [Thread-1 (]: Writing runtime sql for node "model.my_dbt_trino_project.mart_user_activity_per_state"
[0m10:17:42.274808 [debug] [Thread-1 (]: Using trino connection "model.my_dbt_trino_project.mart_user_activity_per_state"
[0m10:17:42.274808 [debug] [Thread-1 (]: On model.my_dbt_trino_project.mart_user_activity_per_state: /* {"app": "dbt", "dbt_version": "1.8.2", "profile_name": "my_dbt_trino_project", "target_name": "dev", "node_id": "model.my_dbt_trino_project.mart_user_activity_per_state"} */

  
    

    create table "datalake"."analytics"."mart_user_activity_per_state__dbt_tmp"
      
      
    as (
      

SELECT
  state,
  city,
  SUM(activity_count) AS total_activity
FROM "datalake"."analytics_stage"."stg_user_activity_per_location"
GROUP BY state, city
ORDER BY state, SUM(activity_count) DESC
    )
[0m10:17:42.275814 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m10:17:42.690936 [debug] [Thread-1 (]: SQL status: SUCCESS in 0.0 seconds
[0m10:17:42.694063 [debug] [Thread-1 (]: Using trino connection "model.my_dbt_trino_project.mart_user_activity_per_state"
[0m10:17:42.694585 [debug] [Thread-1 (]: On model.my_dbt_trino_project.mart_user_activity_per_state: /* {"app": "dbt", "dbt_version": "1.8.2", "profile_name": "my_dbt_trino_project", "target_name": "dev", "node_id": "model.my_dbt_trino_project.mart_user_activity_per_state"} */
alter table "datalake"."analytics"."mart_user_activity_per_state" rename to "datalake"."analytics"."mart_user_activity_per_state__dbt_backup"
[0m10:17:42.791119 [debug] [Thread-1 (]: SQL status: SUCCESS in 0.0 seconds
[0m10:17:42.794126 [debug] [Thread-1 (]: Using trino connection "model.my_dbt_trino_project.mart_user_activity_per_state"
[0m10:17:42.795129 [debug] [Thread-1 (]: On model.my_dbt_trino_project.mart_user_activity_per_state: /* {"app": "dbt", "dbt_version": "1.8.2", "profile_name": "my_dbt_trino_project", "target_name": "dev", "node_id": "model.my_dbt_trino_project.mart_user_activity_per_state"} */
alter table "datalake"."analytics"."mart_user_activity_per_state__dbt_tmp" rename to "datalake"."analytics"."mart_user_activity_per_state"
[0m10:17:42.897512 [debug] [Thread-1 (]: SQL status: SUCCESS in 0.0 seconds
[0m10:17:42.899793 [debug] [Thread-1 (]: Applying DROP to: "datalake"."analytics"."mart_user_activity_per_state__dbt_backup"
[0m10:17:42.901258 [debug] [Thread-1 (]: Using trino connection "model.my_dbt_trino_project.mart_user_activity_per_state"
[0m10:17:42.901258 [debug] [Thread-1 (]: On model.my_dbt_trino_project.mart_user_activity_per_state: /* {"app": "dbt", "dbt_version": "1.8.2", "profile_name": "my_dbt_trino_project", "target_name": "dev", "node_id": "model.my_dbt_trino_project.mart_user_activity_per_state"} */

    drop table if exists "datalake"."analytics"."mart_user_activity_per_state__dbt_backup"
[0m10:17:43.058378 [debug] [Thread-1 (]: SQL status: SUCCESS in 0.0 seconds
[0m10:17:43.059374 [debug] [Thread-1 (]: On model.my_dbt_trino_project.mart_user_activity_per_state: ROLLBACK
[0m10:17:43.060374 [debug] [Thread-1 (]: On model.my_dbt_trino_project.mart_user_activity_per_state: Close
[0m10:17:43.060374 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '76dabc3b-0c8c-492d-99bc-65db3419cd85', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000001B2DFE81850>]}
[0m10:17:43.061377 [info ] [Thread-1 (]: 15 of 15 OK created sql table model analytics.mart_user_activity_per_state ..... [[32mSUCCESS[0m in 0.79s]
[0m10:17:43.062375 [debug] [Thread-1 (]: Finished running node model.my_dbt_trino_project.mart_user_activity_per_state
[0m10:17:43.063374 [debug] [MainThread]: On master: COMMIT
[0m10:17:43.063374 [debug] [MainThread]: Connection 'master' was properly closed.
[0m10:17:43.063374 [debug] [MainThread]: Connection 'list_datalake' was properly closed.
[0m10:17:43.064374 [debug] [MainThread]: Connection 'list_datalake_analytics' was properly closed.
[0m10:17:43.064374 [debug] [MainThread]: Connection 'model.my_dbt_trino_project.mart_user_activity_per_state' was properly closed.
[0m10:17:43.064374 [info ] [MainThread]: 
[0m10:17:43.065374 [info ] [MainThread]: Finished running 8 table models, 2 incremental models, 5 view models in 0 hours 0 minutes and 15.34 seconds (15.34s).
[0m10:17:43.067375 [debug] [MainThread]: Command end result
[0m10:17:43.097421 [info ] [MainThread]: 
[0m10:17:43.098596 [info ] [MainThread]: [31mCompleted with 1 error and 0 warnings:[0m
[0m10:17:43.098596 [info ] [MainThread]: 
[0m10:17:43.099607 [error] [MainThread]:   Database Error in model stg_user_activity_per_country (models\stage\stg_user_activity_per_country.sql)
  TrinoUserError(type=USER_ERROR, name=TYPE_MISMATCH, message="line 17:3: UNION query has different number of fields: 4, 3", query_id=20240619_021739_00030_uxt54)
  compiled Code at target\run\my_dbt_trino_project\models\stage\stg_user_activity_per_country.sql
[0m10:17:43.101092 [info ] [MainThread]: 
[0m10:17:43.101092 [info ] [MainThread]: Done. PASS=13 WARN=0 ERROR=1 SKIP=1 TOTAL=15
[0m10:17:43.103099 [debug] [MainThread]: Command `dbt run` failed at 10:17:43.102100 after 16.35 seconds
[0m10:17:43.103099 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000001B2DD0C8DD0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000001B2DE0BB7D0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000001B2DE0BBED0>]}
[0m10:17:43.103099 [debug] [MainThread]: Flushing usage events
[0m10:20:03.432785 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x0000025B32D56B90>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x0000025B32957910>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x0000025B3274D390>]}


============================== 10:20:03.434794 | 819bf140-452d-4f11-8728-afb48875a71d ==============================
[0m10:20:03.434794 [info ] [MainThread]: Running with dbt=1.8.2
[0m10:20:03.435791 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'indirect_selection': 'eager', 'log_cache_events': 'False', 'write_json': 'True', 'partial_parse': 'True', 'cache_selected_only': 'False', 'warn_error': 'None', 'fail_fast': 'False', 'version_check': 'True', 'log_path': 'C:\\Users\\ASUS\\Desktop\\work\\Iceberg-Dbt-Trino-Hive-modern-open-source-data-stack-main\\dbt\\logs', 'profiles_dir': 'C:\\Users\\ASUS\\Desktop\\work\\Iceberg-Dbt-Trino-Hive-modern-open-source-data-stack-main\\dbt', 'debug': 'False', 'use_colors': 'True', 'use_experimental_parser': 'False', 'no_print': 'None', 'quiet': 'False', 'log_format': 'default', 'static_parser': 'True', 'introspect': 'True', 'invocation_command': 'dbt run --models source', 'target_path': 'None', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'send_anonymous_usage_stats': 'True'}
[0m10:20:03.746031 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': '819bf140-452d-4f11-8728-afb48875a71d', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x0000025B32D94D10>]}
[0m10:20:03.780770 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': '819bf140-452d-4f11-8728-afb48875a71d', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x0000025B2FED5250>]}
[0m10:20:03.780770 [info ] [MainThread]: Registered adapter: trino=1.8.0
[0m10:20:03.791772 [debug] [MainThread]: checksum: f0a141b9de567cb7f131613ba2682f40b3a1c6a157f81c6e5435862eff68f109, vars: {}, profile: , target: , version: 1.8.2
[0m10:20:03.941872 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 0 files changed.
[0m10:20:03.941872 [debug] [MainThread]: Partial parsing enabled, no changes found, skipping parsing
[0m10:20:03.969873 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': '819bf140-452d-4f11-8728-afb48875a71d', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x0000025B333DBE90>]}
[0m10:20:04.034387 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': '819bf140-452d-4f11-8728-afb48875a71d', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x0000025B332A3C90>]}
[0m10:20:04.034387 [info ] [MainThread]: Found 15 models, 7 data tests, 3 sources, 559 macros
[0m10:20:04.035387 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '819bf140-452d-4f11-8728-afb48875a71d', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x0000025B334FA2D0>]}
[0m10:20:04.036388 [info ] [MainThread]: 
[0m10:20:04.037389 [debug] [MainThread]: Acquiring new trino connection 'master'
[0m10:20:04.040396 [debug] [ThreadPool]: Acquiring new trino connection 'list_datalake'
[0m10:20:04.096832 [debug] [ThreadPool]: Using trino connection "list_datalake"
[0m10:20:04.096832 [debug] [ThreadPool]: On list_datalake: /* {"app": "dbt", "dbt_version": "1.8.2", "profile_name": "my_dbt_trino_project", "target_name": "dev", "connection_name": "list_datalake"} */

    select schema_name
    from "datalake".INFORMATION_SCHEMA.schemata
[0m10:20:04.097832 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m10:20:04.167422 [debug] [ThreadPool]: SQL status: SUCCESS in 0.0 seconds
[0m10:20:04.168421 [debug] [ThreadPool]: On list_datalake: Close
[0m10:20:04.169920 [debug] [ThreadPool]: Acquiring new trino connection 'list_datalake_analytics'
[0m10:20:04.180218 [debug] [ThreadPool]: Using trino connection "list_datalake_analytics"
[0m10:20:04.181218 [debug] [ThreadPool]: On list_datalake_analytics: /* {"app": "dbt", "dbt_version": "1.8.2", "profile_name": "my_dbt_trino_project", "target_name": "dev", "connection_name": "list_datalake_analytics"} */
select
      t.table_catalog as database,
      t.table_name as name,
      t.table_schema as schema,
      case when mv.name is not null then 'materialized_view'
           when t.table_type = 'BASE TABLE' then 'table'
           when t.table_type = 'VIEW' then 'view'
           else t.table_type
      end as table_type
    from "datalake".INFORMATION_SCHEMA.tables t
    left join (
            select * from system.metadata.materialized_views
            where catalog_name = 'datalake'
              and schema_name = 'analytics') mv
          on mv.catalog_name = t.table_catalog and mv.schema_name = t.table_schema and mv.name = t.table_name
    where t.table_schema = 'analytics'
[0m10:20:04.181218 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m10:20:04.268124 [debug] [ThreadPool]: SQL status: SUCCESS in 0.0 seconds
[0m10:20:04.269269 [debug] [ThreadPool]: On list_datalake_analytics: ROLLBACK
[0m10:20:04.269269 [debug] [ThreadPool]: On list_datalake_analytics: Close
[0m10:20:04.270295 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_datalake_analytics, now list_datalake_analytics_stage)
[0m10:20:04.274543 [debug] [ThreadPool]: Using trino connection "list_datalake_analytics_stage"
[0m10:20:04.274543 [debug] [ThreadPool]: On list_datalake_analytics_stage: /* {"app": "dbt", "dbt_version": "1.8.2", "profile_name": "my_dbt_trino_project", "target_name": "dev", "connection_name": "list_datalake_analytics_stage"} */
select
      t.table_catalog as database,
      t.table_name as name,
      t.table_schema as schema,
      case when mv.name is not null then 'materialized_view'
           when t.table_type = 'BASE TABLE' then 'table'
           when t.table_type = 'VIEW' then 'view'
           else t.table_type
      end as table_type
    from "datalake".INFORMATION_SCHEMA.tables t
    left join (
            select * from system.metadata.materialized_views
            where catalog_name = 'datalake'
              and schema_name = 'analytics_stage') mv
          on mv.catalog_name = t.table_catalog and mv.schema_name = t.table_schema and mv.name = t.table_name
    where t.table_schema = 'analytics_stage'
[0m10:20:04.274543 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m10:20:04.362258 [debug] [ThreadPool]: SQL status: SUCCESS in 0.0 seconds
[0m10:20:04.363270 [debug] [ThreadPool]: On list_datalake_analytics_stage: ROLLBACK
[0m10:20:04.363270 [debug] [ThreadPool]: On list_datalake_analytics_stage: Close
[0m10:20:04.364701 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_datalake_analytics_stage, now list_datalake_analytics_source)
[0m10:20:04.369786 [debug] [ThreadPool]: Using trino connection "list_datalake_analytics_source"
[0m10:20:04.369786 [debug] [ThreadPool]: On list_datalake_analytics_source: /* {"app": "dbt", "dbt_version": "1.8.2", "profile_name": "my_dbt_trino_project", "target_name": "dev", "connection_name": "list_datalake_analytics_source"} */
select
      t.table_catalog as database,
      t.table_name as name,
      t.table_schema as schema,
      case when mv.name is not null then 'materialized_view'
           when t.table_type = 'BASE TABLE' then 'table'
           when t.table_type = 'VIEW' then 'view'
           else t.table_type
      end as table_type
    from "datalake".INFORMATION_SCHEMA.tables t
    left join (
            select * from system.metadata.materialized_views
            where catalog_name = 'datalake'
              and schema_name = 'analytics_source') mv
          on mv.catalog_name = t.table_catalog and mv.schema_name = t.table_schema and mv.name = t.table_name
    where t.table_schema = 'analytics_source'
[0m10:20:04.369786 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m10:20:04.452803 [debug] [ThreadPool]: SQL status: SUCCESS in 0.0 seconds
[0m10:20:04.453803 [debug] [ThreadPool]: On list_datalake_analytics_source: ROLLBACK
[0m10:20:04.453803 [debug] [ThreadPool]: On list_datalake_analytics_source: Close
[0m10:20:04.454803 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '819bf140-452d-4f11-8728-afb48875a71d', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x0000025B333077D0>]}
[0m10:20:04.456227 [debug] [MainThread]: On master: COMMIT
[0m10:20:04.456227 [info ] [MainThread]: Concurrency: 1 threads (target='dev')
[0m10:20:04.457242 [info ] [MainThread]: 
[0m10:20:04.459243 [debug] [Thread-1 (]: Began running node model.my_dbt_trino_project.src_auth_events
[0m10:20:04.459243 [info ] [Thread-1 (]: 1 of 3 START sql table model analytics_source.src_auth_events .................. [RUN]
[0m10:20:04.460750 [debug] [Thread-1 (]: Acquiring new trino connection 'model.my_dbt_trino_project.src_auth_events'
[0m10:20:04.460750 [debug] [Thread-1 (]: Began compiling node model.my_dbt_trino_project.src_auth_events
[0m10:20:04.466758 [debug] [Thread-1 (]: Writing injected SQL for node "model.my_dbt_trino_project.src_auth_events"
[0m10:20:04.467757 [debug] [Thread-1 (]: Began executing node model.my_dbt_trino_project.src_auth_events
[0m10:20:04.498964 [debug] [Thread-1 (]: Writing runtime sql for node "model.my_dbt_trino_project.src_auth_events"
[0m10:20:04.502971 [debug] [Thread-1 (]: Using trino connection "model.my_dbt_trino_project.src_auth_events"
[0m10:20:04.503974 [debug] [Thread-1 (]: On model.my_dbt_trino_project.src_auth_events: /* {"app": "dbt", "dbt_version": "1.8.2", "profile_name": "my_dbt_trino_project", "target_name": "dev", "node_id": "model.my_dbt_trino_project.src_auth_events"} */

  
    

    create table "datalake"."analytics_source"."src_auth_events__dbt_tmp"
      
      
    as (
      

with source as (
    select
        CAST(ts AS VARCHAR) as id, 
        ts,
        CAST(sessionId AS VARCHAR) as sessionId,
        level,
        itemInSession,
        city,
        zip,
        state,
        userAgent,
        CAST(NULLIF(lon, '') AS double) as lon,
        CAST(NULLIF(lat, '') AS double) as lat,
        CAST(FLOOR(CAST(NULLIF(userId, '') AS DOUBLE)) AS INT) as userId, 
        lastName,
        firstName,
        gender,
        CAST(FLOOR(CAST(NULLIF(registration, '') AS DOUBLE)) AS BIGINT) as registration,
        success
    from "oltp"."public"."auth_events"
)

select
    id,
    ts,
    sessionId,
    level,
    itemInSession,
    city,
    zip,
    state,
    userAgent,
    lon,
    lat,
    userId,
    lastName,
    firstName,
    gender,
    registration, 
    CASE 
        WHEN CAST(success AS VARCHAR) = 't' THEN true 
        WHEN CAST(success AS VARCHAR) = 'f' THEN false
        ELSE NULL 
    END AS success_boolean
from source


    )
[0m10:20:04.503974 [debug] [Thread-1 (]: Opening a new connection, currently in state init
[0m10:20:04.811838 [debug] [Thread-1 (]: SQL status: SUCCESS in 0.0 seconds
[0m10:20:04.817371 [debug] [Thread-1 (]: Using trino connection "model.my_dbt_trino_project.src_auth_events"
[0m10:20:04.818371 [debug] [Thread-1 (]: On model.my_dbt_trino_project.src_auth_events: /* {"app": "dbt", "dbt_version": "1.8.2", "profile_name": "my_dbt_trino_project", "target_name": "dev", "node_id": "model.my_dbt_trino_project.src_auth_events"} */
alter table "datalake"."analytics_source"."src_auth_events" rename to "datalake"."analytics_source"."src_auth_events__dbt_backup"
[0m10:20:04.917688 [debug] [Thread-1 (]: SQL status: SUCCESS in 0.0 seconds
[0m10:20:04.920616 [debug] [Thread-1 (]: Using trino connection "model.my_dbt_trino_project.src_auth_events"
[0m10:20:04.921626 [debug] [Thread-1 (]: On model.my_dbt_trino_project.src_auth_events: /* {"app": "dbt", "dbt_version": "1.8.2", "profile_name": "my_dbt_trino_project", "target_name": "dev", "node_id": "model.my_dbt_trino_project.src_auth_events"} */
alter table "datalake"."analytics_source"."src_auth_events__dbt_tmp" rename to "datalake"."analytics_source"."src_auth_events"
[0m10:20:05.025494 [debug] [Thread-1 (]: SQL status: SUCCESS in 0.0 seconds
[0m10:20:05.032009 [debug] [Thread-1 (]: Applying DROP to: "datalake"."analytics_source"."src_auth_events__dbt_backup"
[0m10:20:05.034008 [debug] [Thread-1 (]: Using trino connection "model.my_dbt_trino_project.src_auth_events"
[0m10:20:05.034008 [debug] [Thread-1 (]: On model.my_dbt_trino_project.src_auth_events: /* {"app": "dbt", "dbt_version": "1.8.2", "profile_name": "my_dbt_trino_project", "target_name": "dev", "node_id": "model.my_dbt_trino_project.src_auth_events"} */

    drop table if exists "datalake"."analytics_source"."src_auth_events__dbt_backup"
[0m10:20:05.175976 [debug] [Thread-1 (]: SQL status: SUCCESS in 0.0 seconds
[0m10:20:05.187973 [debug] [Thread-1 (]: On model.my_dbt_trino_project.src_auth_events: ROLLBACK
[0m10:20:05.188977 [debug] [Thread-1 (]: On model.my_dbt_trino_project.src_auth_events: Close
[0m10:20:05.190387 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '819bf140-452d-4f11-8728-afb48875a71d', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x0000025B33BACB90>]}
[0m10:20:05.190387 [info ] [Thread-1 (]: 1 of 3 OK created sql table model analytics_source.src_auth_events ............. [[32mSUCCESS[0m in 0.73s]
[0m10:20:05.191393 [debug] [Thread-1 (]: Finished running node model.my_dbt_trino_project.src_auth_events
[0m10:20:05.192393 [debug] [Thread-1 (]: Began running node model.my_dbt_trino_project.src_listen_events
[0m10:20:05.192393 [info ] [Thread-1 (]: 2 of 3 START sql incremental model analytics_source.src_listen_events .......... [RUN]
[0m10:20:05.193422 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.my_dbt_trino_project.src_auth_events, now model.my_dbt_trino_project.src_listen_events)
[0m10:20:05.193938 [debug] [Thread-1 (]: Began compiling node model.my_dbt_trino_project.src_listen_events
[0m10:20:05.198093 [debug] [Thread-1 (]: Writing injected SQL for node "model.my_dbt_trino_project.src_listen_events"
[0m10:20:05.198614 [debug] [Thread-1 (]: Began executing node model.my_dbt_trino_project.src_listen_events
[0m10:20:05.225351 [debug] [Thread-1 (]: Using trino connection "model.my_dbt_trino_project.src_listen_events"
[0m10:20:05.225871 [debug] [Thread-1 (]: On model.my_dbt_trino_project.src_listen_events: /* {"app": "dbt", "dbt_version": "1.8.2", "profile_name": "my_dbt_trino_project", "target_name": "dev", "node_id": "model.my_dbt_trino_project.src_listen_events"} */

  
    

    create table "datalake"."analytics_source"."src_listen_events__dbt_tmp"
      
      
    as (
      

with source as (

    select
        CAST(_id AS VARCHAR) as id,
        artist,
        song,
        CAST(NULLIF(duration, '') AS DOUBLE) as duration,
        ts,
        sessionid,
        auth,
        level,
        CAST(NULLIF(itemInSession, '') AS INTEGER) as itemInSession,
        city,
        zip,
        state,
        country,
        userAgent,
        CAST(NULLIF(lon, '') AS DOUBLE) as lon,
        CAST(NULLIF(lat, '') AS DOUBLE) as lat,
        CAST(CAST(NULLIF(userId, '') AS DOUBLE) AS INTEGER) as userId,
 -- Assurez-vous que userId peut aussi être converti de cette manière.
        lastName,
        firstName,
        gender,
        CAST(CAST(NULLIF(registration, '') AS DOUBLE) AS BIGINT) as registration
    from "website"."demo"."listen_events"

)

select * from source



    -- this filter will only be applied on an incremental run
    where ts > (select max(ts) from "datalake"."analytics_source"."src_listen_events")


    )
[0m10:20:05.226392 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m10:20:05.543770 [debug] [Thread-1 (]: SQL status: SUCCESS in 0.0 seconds
[0m10:20:05.552031 [debug] [Thread-1 (]: Using trino connection "model.my_dbt_trino_project.src_listen_events"
[0m10:20:05.553034 [debug] [Thread-1 (]: On model.my_dbt_trino_project.src_listen_events: /* {"app": "dbt", "dbt_version": "1.8.2", "profile_name": "my_dbt_trino_project", "target_name": "dev", "node_id": "model.my_dbt_trino_project.src_listen_events"} */

    describe "datalake"."analytics_source"."src_listen_events__dbt_tmp"
[0m10:20:05.648620 [debug] [Thread-1 (]: SQL status: SUCCESS in 0.0 seconds
[0m10:20:05.652281 [debug] [Thread-1 (]: Using trino connection "model.my_dbt_trino_project.src_listen_events"
[0m10:20:05.652281 [debug] [Thread-1 (]: On model.my_dbt_trino_project.src_listen_events: /* {"app": "dbt", "dbt_version": "1.8.2", "profile_name": "my_dbt_trino_project", "target_name": "dev", "node_id": "model.my_dbt_trino_project.src_listen_events"} */

    describe "datalake"."analytics_source"."src_listen_events"
[0m10:20:05.762338 [debug] [Thread-1 (]: SQL status: SUCCESS in 0.0 seconds
[0m10:20:05.769873 [debug] [Thread-1 (]: Using trino connection "model.my_dbt_trino_project.src_listen_events"
[0m10:20:05.770874 [debug] [Thread-1 (]: On model.my_dbt_trino_project.src_listen_events: /* {"app": "dbt", "dbt_version": "1.8.2", "profile_name": "my_dbt_trino_project", "target_name": "dev", "node_id": "model.my_dbt_trino_project.src_listen_events"} */

    describe "datalake"."analytics_source"."src_listen_events"
[0m10:20:05.875360 [debug] [Thread-1 (]: SQL status: SUCCESS in 0.0 seconds
[0m10:20:05.883814 [debug] [Thread-1 (]: Writing runtime sql for node "model.my_dbt_trino_project.src_listen_events"
[0m10:20:05.885823 [debug] [Thread-1 (]: Using trino connection "model.my_dbt_trino_project.src_listen_events"
[0m10:20:05.885823 [debug] [Thread-1 (]: On model.my_dbt_trino_project.src_listen_events: /* {"app": "dbt", "dbt_version": "1.8.2", "profile_name": "my_dbt_trino_project", "target_name": "dev", "node_id": "model.my_dbt_trino_project.src_listen_events"} */
insert into "datalake"."analytics_source"."src_listen_events" ("id", "artist", "song", "duration", "ts", "sessionid", "auth", "level", "iteminsession", "city", "zip", "state", "country", "useragent", "lon", "lat", "userid", "lastname", "firstname", "gender", "registration")
    (
        select "id", "artist", "song", "duration", "ts", "sessionid", "auth", "level", "iteminsession", "city", "zip", "state", "country", "useragent", "lon", "lat", "userid", "lastname", "firstname", "gender", "registration"
        from "datalake"."analytics_source"."src_listen_events__dbt_tmp"
    )
[0m10:20:06.023711 [debug] [Thread-1 (]: SQL status: SUCCESS in 0.0 seconds
[0m10:20:06.027825 [debug] [Thread-1 (]: Applying DROP to: "datalake"."analytics_source"."src_listen_events__dbt_tmp"
[0m10:20:06.027825 [debug] [Thread-1 (]: Using trino connection "model.my_dbt_trino_project.src_listen_events"
[0m10:20:06.028825 [debug] [Thread-1 (]: On model.my_dbt_trino_project.src_listen_events: /* {"app": "dbt", "dbt_version": "1.8.2", "profile_name": "my_dbt_trino_project", "target_name": "dev", "node_id": "model.my_dbt_trino_project.src_listen_events"} */

    drop table if exists "datalake"."analytics_source"."src_listen_events__dbt_tmp"
[0m10:20:06.156790 [debug] [Thread-1 (]: SQL status: SUCCESS in 0.0 seconds
[0m10:20:06.158866 [debug] [Thread-1 (]: On model.my_dbt_trino_project.src_listen_events: ROLLBACK
[0m10:20:06.158866 [debug] [Thread-1 (]: On model.my_dbt_trino_project.src_listen_events: Close
[0m10:20:06.159898 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '819bf140-452d-4f11-8728-afb48875a71d', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x0000025B337482D0>]}
[0m10:20:06.160421 [info ] [Thread-1 (]: 2 of 3 OK created sql incremental model analytics_source.src_listen_events ..... [[32mSUCCESS[0m in 0.97s]
[0m10:20:06.161466 [debug] [Thread-1 (]: Finished running node model.my_dbt_trino_project.src_listen_events
[0m10:20:06.161466 [debug] [Thread-1 (]: Began running node model.my_dbt_trino_project.src_page_view_events
[0m10:20:06.162000 [info ] [Thread-1 (]: 3 of 3 START sql incremental model analytics_source.src_page_view_events ....... [RUN]
[0m10:20:06.162536 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.my_dbt_trino_project.src_listen_events, now model.my_dbt_trino_project.src_page_view_events)
[0m10:20:06.163071 [debug] [Thread-1 (]: Began compiling node model.my_dbt_trino_project.src_page_view_events
[0m10:20:06.166219 [debug] [Thread-1 (]: Writing injected SQL for node "model.my_dbt_trino_project.src_page_view_events"
[0m10:20:06.166747 [debug] [Thread-1 (]: Began executing node model.my_dbt_trino_project.src_page_view_events
[0m10:20:06.173583 [debug] [Thread-1 (]: Using trino connection "model.my_dbt_trino_project.src_page_view_events"
[0m10:20:06.174125 [debug] [Thread-1 (]: On model.my_dbt_trino_project.src_page_view_events: /* {"app": "dbt", "dbt_version": "1.8.2", "profile_name": "my_dbt_trino_project", "target_name": "dev", "node_id": "model.my_dbt_trino_project.src_page_view_events"} */

  
    

    create table "datalake"."analytics_source"."src_page_view_events__dbt_tmp"
      
      
    as (
      

with source as (
    select
        CAST(_id AS VARCHAR) as id,
        ts,
        CAST(sessionId AS VARCHAR) as sessionId,
        page,
        auth,
        level,
        CAST(CAST(NULLIF(itemInSession, '') AS DOUBLE) AS INTEGER) as itemInSession, 
        city,
        zip,
        state,
        userAgent,
        CAST(NULLIF(lon, '') AS double) as lon,
        CAST(NULLIF(lat, '') AS double) as lat,
        CAST(CAST(NULLIF(userId, '') AS DOUBLE) AS INTEGER) as userId, 
        lastName,
        firstName,
        gender,
        CAST(CAST(NULLIF(registration, '') AS DOUBLE) AS BIGINT) as registration, 
        artist,
        song,
        CAST(NULLIF(duration, '') AS double) as duration
    from "website"."demo"."page_view_events"
)

select * from source


    where ts > (select max(ts) from "datalake"."analytics_source"."src_page_view_events")

    )
[0m10:20:06.176054 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m10:20:06.384184 [debug] [Thread-1 (]: SQL status: SUCCESS in 0.0 seconds
[0m10:20:06.387190 [debug] [Thread-1 (]: Using trino connection "model.my_dbt_trino_project.src_page_view_events"
[0m10:20:06.387190 [debug] [Thread-1 (]: On model.my_dbt_trino_project.src_page_view_events: /* {"app": "dbt", "dbt_version": "1.8.2", "profile_name": "my_dbt_trino_project", "target_name": "dev", "node_id": "model.my_dbt_trino_project.src_page_view_events"} */

    describe "datalake"."analytics_source"."src_page_view_events__dbt_tmp"
[0m10:20:06.497542 [debug] [Thread-1 (]: SQL status: SUCCESS in 0.0 seconds
[0m10:20:06.501554 [debug] [Thread-1 (]: Using trino connection "model.my_dbt_trino_project.src_page_view_events"
[0m10:20:06.502058 [debug] [Thread-1 (]: On model.my_dbt_trino_project.src_page_view_events: /* {"app": "dbt", "dbt_version": "1.8.2", "profile_name": "my_dbt_trino_project", "target_name": "dev", "node_id": "model.my_dbt_trino_project.src_page_view_events"} */

    describe "datalake"."analytics_source"."src_page_view_events"
[0m10:20:06.608159 [debug] [Thread-1 (]: SQL status: SUCCESS in 0.0 seconds
[0m10:20:06.611173 [debug] [Thread-1 (]: Using trino connection "model.my_dbt_trino_project.src_page_view_events"
[0m10:20:06.611173 [debug] [Thread-1 (]: On model.my_dbt_trino_project.src_page_view_events: /* {"app": "dbt", "dbt_version": "1.8.2", "profile_name": "my_dbt_trino_project", "target_name": "dev", "node_id": "model.my_dbt_trino_project.src_page_view_events"} */

    describe "datalake"."analytics_source"."src_page_view_events"
[0m10:20:06.709154 [debug] [Thread-1 (]: SQL status: SUCCESS in 0.0 seconds
[0m10:20:06.711172 [debug] [Thread-1 (]: Writing runtime sql for node "model.my_dbt_trino_project.src_page_view_events"
[0m10:20:06.713171 [debug] [Thread-1 (]: Using trino connection "model.my_dbt_trino_project.src_page_view_events"
[0m10:20:06.713171 [debug] [Thread-1 (]: On model.my_dbt_trino_project.src_page_view_events: /* {"app": "dbt", "dbt_version": "1.8.2", "profile_name": "my_dbt_trino_project", "target_name": "dev", "node_id": "model.my_dbt_trino_project.src_page_view_events"} */
insert into "datalake"."analytics_source"."src_page_view_events" ("id", "ts", "sessionid", "page", "auth", "level", "iteminsession", "city", "zip", "state", "useragent", "lon", "lat", "userid", "lastname", "firstname", "gender", "registration", "artist", "song", "duration")
    (
        select "id", "ts", "sessionid", "page", "auth", "level", "iteminsession", "city", "zip", "state", "useragent", "lon", "lat", "userid", "lastname", "firstname", "gender", "registration", "artist", "song", "duration"
        from "datalake"."analytics_source"."src_page_view_events__dbt_tmp"
    )
[0m10:20:06.868237 [debug] [Thread-1 (]: SQL status: SUCCESS in 0.0 seconds
[0m10:20:06.872271 [debug] [Thread-1 (]: Applying DROP to: "datalake"."analytics_source"."src_page_view_events__dbt_tmp"
[0m10:20:06.872271 [debug] [Thread-1 (]: Using trino connection "model.my_dbt_trino_project.src_page_view_events"
[0m10:20:06.873270 [debug] [Thread-1 (]: On model.my_dbt_trino_project.src_page_view_events: /* {"app": "dbt", "dbt_version": "1.8.2", "profile_name": "my_dbt_trino_project", "target_name": "dev", "node_id": "model.my_dbt_trino_project.src_page_view_events"} */

    drop table if exists "datalake"."analytics_source"."src_page_view_events__dbt_tmp"
[0m10:20:06.987069 [debug] [Thread-1 (]: SQL status: SUCCESS in 0.0 seconds
[0m10:20:06.988074 [debug] [Thread-1 (]: On model.my_dbt_trino_project.src_page_view_events: ROLLBACK
[0m10:20:06.989077 [debug] [Thread-1 (]: On model.my_dbt_trino_project.src_page_view_events: Close
[0m10:20:06.989077 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '819bf140-452d-4f11-8728-afb48875a71d', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x0000025B34CD5C90>]}
[0m10:20:06.989077 [info ] [Thread-1 (]: 3 of 3 OK created sql incremental model analytics_source.src_page_view_events .. [[32mSUCCESS[0m in 0.83s]
[0m10:20:06.990290 [debug] [Thread-1 (]: Finished running node model.my_dbt_trino_project.src_page_view_events
[0m10:20:06.991298 [debug] [MainThread]: On master: COMMIT
[0m10:20:06.991298 [debug] [MainThread]: Connection 'master' was properly closed.
[0m10:20:06.992299 [debug] [MainThread]: Connection 'list_datalake' was properly closed.
[0m10:20:06.992299 [debug] [MainThread]: Connection 'list_datalake_analytics_source' was properly closed.
[0m10:20:06.992299 [debug] [MainThread]: Connection 'model.my_dbt_trino_project.src_page_view_events' was properly closed.
[0m10:20:06.992299 [info ] [MainThread]: 
[0m10:20:06.993299 [info ] [MainThread]: Finished running 1 table model, 2 incremental models in 0 hours 0 minutes and 2.96 seconds (2.96s).
[0m10:20:06.994298 [debug] [MainThread]: Command end result
[0m10:20:07.070889 [info ] [MainThread]: 
[0m10:20:07.072122 [info ] [MainThread]: [32mCompleted successfully[0m
[0m10:20:07.072122 [info ] [MainThread]: 
[0m10:20:07.073134 [info ] [MainThread]: Done. PASS=3 WARN=0 ERROR=0 SKIP=0 TOTAL=3
[0m10:20:07.074131 [debug] [MainThread]: Command `dbt run` succeeded at 10:20:07.074131 after 3.78 seconds
[0m10:20:07.075128 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x0000025B2DE0EED0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x0000025B2DE0E2D0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x0000025B2DE0F390>]}
[0m10:20:07.075128 [debug] [MainThread]: Flushing usage events
[0m10:20:19.492078 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000001CBA1236150>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000001CBA0E373D0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000001CB9FCE9310>]}


============================== 10:20:19.494079 | 832b4395-c4f2-4316-a604-8eaa6dabe5c9 ==============================
[0m10:20:19.494079 [info ] [MainThread]: Running with dbt=1.8.2
[0m10:20:19.495079 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'indirect_selection': 'eager', 'write_json': 'True', 'log_cache_events': 'False', 'partial_parse': 'True', 'cache_selected_only': 'False', 'warn_error': 'None', 'debug': 'False', 'version_check': 'True', 'log_path': 'C:\\Users\\ASUS\\Desktop\\work\\Iceberg-Dbt-Trino-Hive-modern-open-source-data-stack-main\\dbt\\logs', 'fail_fast': 'False', 'profiles_dir': 'C:\\Users\\ASUS\\Desktop\\work\\Iceberg-Dbt-Trino-Hive-modern-open-source-data-stack-main\\dbt', 'use_colors': 'True', 'use_experimental_parser': 'False', 'no_print': 'None', 'quiet': 'False', 'log_format': 'default', 'static_parser': 'True', 'introspect': 'True', 'invocation_command': 'dbt run --models stage', 'target_path': 'None', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'send_anonymous_usage_stats': 'True'}
[0m10:20:19.778719 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': '832b4395-c4f2-4316-a604-8eaa6dabe5c9', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000001CBA1594D90>]}
[0m10:20:19.811740 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': '832b4395-c4f2-4316-a604-8eaa6dabe5c9', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000001CB9E3B5510>]}
[0m10:20:19.811740 [info ] [MainThread]: Registered adapter: trino=1.8.0
[0m10:20:19.821742 [debug] [MainThread]: checksum: f0a141b9de567cb7f131613ba2682f40b3a1c6a157f81c6e5435862eff68f109, vars: {}, profile: , target: , version: 1.8.2
[0m10:20:19.969354 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 0 files changed.
[0m10:20:19.970354 [debug] [MainThread]: Partial parsing enabled, no changes found, skipping parsing
[0m10:20:19.997375 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': '832b4395-c4f2-4316-a604-8eaa6dabe5c9', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000001CBA186EA50>]}
[0m10:20:20.059508 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': '832b4395-c4f2-4316-a604-8eaa6dabe5c9', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000001CBA179BF10>]}
[0m10:20:20.060508 [info ] [MainThread]: Found 15 models, 7 data tests, 3 sources, 559 macros
[0m10:20:20.060508 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '832b4395-c4f2-4316-a604-8eaa6dabe5c9', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000001CBA19E1890>]}
[0m10:20:20.062508 [info ] [MainThread]: 
[0m10:20:20.063508 [debug] [MainThread]: Acquiring new trino connection 'master'
[0m10:20:20.066508 [debug] [ThreadPool]: Acquiring new trino connection 'list_datalake'
[0m10:20:20.121384 [debug] [ThreadPool]: Using trino connection "list_datalake"
[0m10:20:20.121384 [debug] [ThreadPool]: On list_datalake: /* {"app": "dbt", "dbt_version": "1.8.2", "profile_name": "my_dbt_trino_project", "target_name": "dev", "connection_name": "list_datalake"} */

    select schema_name
    from "datalake".INFORMATION_SCHEMA.schemata
[0m10:20:20.122384 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m10:20:20.153336 [debug] [ThreadPool]: SQL status: SUCCESS in 0.0 seconds
[0m10:20:20.154334 [debug] [ThreadPool]: On list_datalake: Close
[0m10:20:20.156338 [debug] [ThreadPool]: Acquiring new trino connection 'list_datalake_analytics_stage'
[0m10:20:20.166843 [debug] [ThreadPool]: Using trino connection "list_datalake_analytics_stage"
[0m10:20:20.167843 [debug] [ThreadPool]: On list_datalake_analytics_stage: /* {"app": "dbt", "dbt_version": "1.8.2", "profile_name": "my_dbt_trino_project", "target_name": "dev", "connection_name": "list_datalake_analytics_stage"} */
select
      t.table_catalog as database,
      t.table_name as name,
      t.table_schema as schema,
      case when mv.name is not null then 'materialized_view'
           when t.table_type = 'BASE TABLE' then 'table'
           when t.table_type = 'VIEW' then 'view'
           else t.table_type
      end as table_type
    from "datalake".INFORMATION_SCHEMA.tables t
    left join (
            select * from system.metadata.materialized_views
            where catalog_name = 'datalake'
              and schema_name = 'analytics_stage') mv
          on mv.catalog_name = t.table_catalog and mv.schema_name = t.table_schema and mv.name = t.table_name
    where t.table_schema = 'analytics_stage'
[0m10:20:20.167843 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m10:20:20.244721 [debug] [ThreadPool]: SQL status: SUCCESS in 0.0 seconds
[0m10:20:20.245725 [debug] [ThreadPool]: On list_datalake_analytics_stage: ROLLBACK
[0m10:20:20.245725 [debug] [ThreadPool]: On list_datalake_analytics_stage: Close
[0m10:20:20.246728 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_datalake_analytics_stage, now list_datalake_analytics)
[0m10:20:20.250017 [debug] [ThreadPool]: Using trino connection "list_datalake_analytics"
[0m10:20:20.250017 [debug] [ThreadPool]: On list_datalake_analytics: /* {"app": "dbt", "dbt_version": "1.8.2", "profile_name": "my_dbt_trino_project", "target_name": "dev", "connection_name": "list_datalake_analytics"} */
select
      t.table_catalog as database,
      t.table_name as name,
      t.table_schema as schema,
      case when mv.name is not null then 'materialized_view'
           when t.table_type = 'BASE TABLE' then 'table'
           when t.table_type = 'VIEW' then 'view'
           else t.table_type
      end as table_type
    from "datalake".INFORMATION_SCHEMA.tables t
    left join (
            select * from system.metadata.materialized_views
            where catalog_name = 'datalake'
              and schema_name = 'analytics') mv
          on mv.catalog_name = t.table_catalog and mv.schema_name = t.table_schema and mv.name = t.table_name
    where t.table_schema = 'analytics'
[0m10:20:20.251459 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m10:20:20.317333 [debug] [ThreadPool]: SQL status: SUCCESS in 0.0 seconds
[0m10:20:20.318335 [debug] [ThreadPool]: On list_datalake_analytics: ROLLBACK
[0m10:20:20.319842 [debug] [ThreadPool]: On list_datalake_analytics: Close
[0m10:20:20.320849 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_datalake_analytics, now list_datalake_analytics_source)
[0m10:20:20.324941 [debug] [ThreadPool]: Using trino connection "list_datalake_analytics_source"
[0m10:20:20.324941 [debug] [ThreadPool]: On list_datalake_analytics_source: /* {"app": "dbt", "dbt_version": "1.8.2", "profile_name": "my_dbt_trino_project", "target_name": "dev", "connection_name": "list_datalake_analytics_source"} */
select
      t.table_catalog as database,
      t.table_name as name,
      t.table_schema as schema,
      case when mv.name is not null then 'materialized_view'
           when t.table_type = 'BASE TABLE' then 'table'
           when t.table_type = 'VIEW' then 'view'
           else t.table_type
      end as table_type
    from "datalake".INFORMATION_SCHEMA.tables t
    left join (
            select * from system.metadata.materialized_views
            where catalog_name = 'datalake'
              and schema_name = 'analytics_source') mv
          on mv.catalog_name = t.table_catalog and mv.schema_name = t.table_schema and mv.name = t.table_name
    where t.table_schema = 'analytics_source'
[0m10:20:20.324941 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m10:20:20.398125 [debug] [ThreadPool]: SQL status: SUCCESS in 0.0 seconds
[0m10:20:20.399645 [debug] [ThreadPool]: On list_datalake_analytics_source: ROLLBACK
[0m10:20:20.399645 [debug] [ThreadPool]: On list_datalake_analytics_source: Close
[0m10:20:20.400654 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '832b4395-c4f2-4316-a604-8eaa6dabe5c9', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000001CBA12A5E10>]}
[0m10:20:20.402011 [debug] [MainThread]: On master: COMMIT
[0m10:20:20.402011 [info ] [MainThread]: Concurrency: 1 threads (target='dev')
[0m10:20:20.403019 [info ] [MainThread]: 
[0m10:20:20.405666 [debug] [Thread-1 (]: Began running node model.my_dbt_trino_project.stg_streams_hourly
[0m10:20:20.405666 [info ] [Thread-1 (]: 1 of 6 START sql table model analytics_stage.stg_streams_hourly ................ [RUN]
[0m10:20:20.406671 [debug] [Thread-1 (]: Acquiring new trino connection 'model.my_dbt_trino_project.stg_streams_hourly'
[0m10:20:20.407264 [debug] [Thread-1 (]: Began compiling node model.my_dbt_trino_project.stg_streams_hourly
[0m10:20:20.409277 [debug] [Thread-1 (]: Writing injected SQL for node "model.my_dbt_trino_project.stg_streams_hourly"
[0m10:20:20.410277 [debug] [Thread-1 (]: Began executing node model.my_dbt_trino_project.stg_streams_hourly
[0m10:20:20.441047 [debug] [Thread-1 (]: Writing runtime sql for node "model.my_dbt_trino_project.stg_streams_hourly"
[0m10:20:20.443049 [debug] [Thread-1 (]: Using trino connection "model.my_dbt_trino_project.stg_streams_hourly"
[0m10:20:20.443049 [debug] [Thread-1 (]: On model.my_dbt_trino_project.stg_streams_hourly: /* {"app": "dbt", "dbt_version": "1.8.2", "profile_name": "my_dbt_trino_project", "target_name": "dev", "node_id": "model.my_dbt_trino_project.stg_streams_hourly"} */

  
    

    create table "datalake"."analytics_stage"."stg_streams_hourly__dbt_tmp"
      
      
    as (
      

SELECT
    DATE_FORMAT(FROM_UNIXTIME(ts), '%Y-%m-%d') AS stream_date, 
    DATE_FORMAT(FROM_UNIXTIME(ts), '%H') AS stream_hour,
    COUNT(*) AS total_streams
FROM "datalake"."analytics_source"."src_listen_events"
GROUP BY
    DATE_FORMAT(FROM_UNIXTIME(ts), '%Y-%m-%d'),
    DATE_FORMAT(FROM_UNIXTIME(ts), '%H')
    )
[0m10:20:20.443049 [debug] [Thread-1 (]: Opening a new connection, currently in state init
[0m10:20:20.709889 [debug] [Thread-1 (]: SQL status: SUCCESS in 0.0 seconds
[0m10:20:20.714396 [debug] [Thread-1 (]: Using trino connection "model.my_dbt_trino_project.stg_streams_hourly"
[0m10:20:20.715405 [debug] [Thread-1 (]: On model.my_dbt_trino_project.stg_streams_hourly: /* {"app": "dbt", "dbt_version": "1.8.2", "profile_name": "my_dbt_trino_project", "target_name": "dev", "node_id": "model.my_dbt_trino_project.stg_streams_hourly"} */
alter table "datalake"."analytics_stage"."stg_streams_hourly" rename to "datalake"."analytics_stage"."stg_streams_hourly__dbt_backup"
[0m10:20:20.812371 [debug] [Thread-1 (]: SQL status: SUCCESS in 0.0 seconds
[0m10:20:20.815885 [debug] [Thread-1 (]: Using trino connection "model.my_dbt_trino_project.stg_streams_hourly"
[0m10:20:20.815885 [debug] [Thread-1 (]: On model.my_dbt_trino_project.stg_streams_hourly: /* {"app": "dbt", "dbt_version": "1.8.2", "profile_name": "my_dbt_trino_project", "target_name": "dev", "node_id": "model.my_dbt_trino_project.stg_streams_hourly"} */
alter table "datalake"."analytics_stage"."stg_streams_hourly__dbt_tmp" rename to "datalake"."analytics_stage"."stg_streams_hourly"
[0m10:20:20.904546 [debug] [Thread-1 (]: SQL status: SUCCESS in 0.0 seconds
[0m10:20:20.909543 [debug] [Thread-1 (]: Applying DROP to: "datalake"."analytics_stage"."stg_streams_hourly__dbt_backup"
[0m10:20:20.912053 [debug] [Thread-1 (]: Using trino connection "model.my_dbt_trino_project.stg_streams_hourly"
[0m10:20:20.912053 [debug] [Thread-1 (]: On model.my_dbt_trino_project.stg_streams_hourly: /* {"app": "dbt", "dbt_version": "1.8.2", "profile_name": "my_dbt_trino_project", "target_name": "dev", "node_id": "model.my_dbt_trino_project.stg_streams_hourly"} */

    drop table if exists "datalake"."analytics_stage"."stg_streams_hourly__dbt_backup"
[0m10:20:21.037709 [debug] [Thread-1 (]: SQL status: SUCCESS in 0.0 seconds
[0m10:20:21.050476 [debug] [Thread-1 (]: On model.my_dbt_trino_project.stg_streams_hourly: ROLLBACK
[0m10:20:21.050476 [debug] [Thread-1 (]: On model.my_dbt_trino_project.stg_streams_hourly: Close
[0m10:20:21.051973 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '832b4395-c4f2-4316-a604-8eaa6dabe5c9', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000001CBA1C79090>]}
[0m10:20:21.052477 [info ] [Thread-1 (]: 1 of 6 OK created sql table model analytics_stage.stg_streams_hourly ........... [[32mSUCCESS[0m in 0.64s]
[0m10:20:21.053486 [debug] [Thread-1 (]: Finished running node model.my_dbt_trino_project.stg_streams_hourly
[0m10:20:21.053486 [debug] [Thread-1 (]: Began running node model.my_dbt_trino_project.stg_top_songs_artists
[0m10:20:21.054485 [info ] [Thread-1 (]: 2 of 6 START sql view model analytics_stage.stg_top_songs_artists .............. [RUN]
[0m10:20:21.054485 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.my_dbt_trino_project.stg_streams_hourly, now model.my_dbt_trino_project.stg_top_songs_artists)
[0m10:20:21.055484 [debug] [Thread-1 (]: Began compiling node model.my_dbt_trino_project.stg_top_songs_artists
[0m10:20:21.057485 [debug] [Thread-1 (]: Writing injected SQL for node "model.my_dbt_trino_project.stg_top_songs_artists"
[0m10:20:21.058485 [debug] [Thread-1 (]: Began executing node model.my_dbt_trino_project.stg_top_songs_artists
[0m10:20:21.072486 [debug] [Thread-1 (]: Writing runtime sql for node "model.my_dbt_trino_project.stg_top_songs_artists"
[0m10:20:21.073485 [debug] [Thread-1 (]: Using trino connection "model.my_dbt_trino_project.stg_top_songs_artists"
[0m10:20:21.073485 [debug] [Thread-1 (]: On model.my_dbt_trino_project.stg_top_songs_artists: /* {"app": "dbt", "dbt_version": "1.8.2", "profile_name": "my_dbt_trino_project", "target_name": "dev", "node_id": "model.my_dbt_trino_project.stg_top_songs_artists"} */

  create or replace view
    "datalake"."analytics_stage"."stg_top_songs_artists"
  security definer
  as
    

WITH song_plays AS (
    SELECT
        artist,
        song,
        COUNT(*) AS play_count
    FROM "datalake"."analytics_source"."src_listen_events"
    GROUP BY artist, song
)

SELECT
    artist,
    song,
    play_count
FROM song_plays
ORDER BY play_count DESC
  
[0m10:20:21.074487 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m10:20:21.143432 [debug] [Thread-1 (]: SQL status: SUCCESS in 0.0 seconds
[0m10:20:21.145034 [debug] [Thread-1 (]: On model.my_dbt_trino_project.stg_top_songs_artists: ROLLBACK
[0m10:20:21.145566 [debug] [Thread-1 (]: On model.my_dbt_trino_project.stg_top_songs_artists: Close
[0m10:20:21.146093 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '832b4395-c4f2-4316-a604-8eaa6dabe5c9', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000001CBA2108A50>]}
[0m10:20:21.146628 [info ] [Thread-1 (]: 2 of 6 OK created sql view model analytics_stage.stg_top_songs_artists ......... [[32mSUCCESS[0m in 0.09s]
[0m10:20:21.147683 [debug] [Thread-1 (]: Finished running node model.my_dbt_trino_project.stg_top_songs_artists
[0m10:20:21.147683 [debug] [Thread-1 (]: Began running node model.my_dbt_trino_project.stg_unique_users
[0m10:20:21.148215 [info ] [Thread-1 (]: 3 of 6 START sql view model analytics_stage.stg_unique_users ................... [RUN]
[0m10:20:21.149296 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.my_dbt_trino_project.stg_top_songs_artists, now model.my_dbt_trino_project.stg_unique_users)
[0m10:20:21.149296 [debug] [Thread-1 (]: Began compiling node model.my_dbt_trino_project.stg_unique_users
[0m10:20:21.151974 [debug] [Thread-1 (]: Writing injected SQL for node "model.my_dbt_trino_project.stg_unique_users"
[0m10:20:21.152512 [debug] [Thread-1 (]: Began executing node model.my_dbt_trino_project.stg_unique_users
[0m10:20:21.154651 [debug] [Thread-1 (]: Writing runtime sql for node "model.my_dbt_trino_project.stg_unique_users"
[0m10:20:21.156342 [debug] [Thread-1 (]: Using trino connection "model.my_dbt_trino_project.stg_unique_users"
[0m10:20:21.156342 [debug] [Thread-1 (]: On model.my_dbt_trino_project.stg_unique_users: /* {"app": "dbt", "dbt_version": "1.8.2", "profile_name": "my_dbt_trino_project", "target_name": "dev", "node_id": "model.my_dbt_trino_project.stg_unique_users"} */

  create or replace view
    "datalake"."analytics_stage"."stg_unique_users"
  security definer
  as
    

SELECT
    COUNT(DISTINCT userid) AS total_unique_users
FROM "datalake"."analytics_source"."src_listen_events"
WHERE userid IS NOT NULL
  
[0m10:20:21.156342 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m10:20:21.208354 [debug] [Thread-1 (]: SQL status: SUCCESS in 0.0 seconds
[0m10:20:21.209361 [debug] [Thread-1 (]: On model.my_dbt_trino_project.stg_unique_users: ROLLBACK
[0m10:20:21.210368 [debug] [Thread-1 (]: On model.my_dbt_trino_project.stg_unique_users: Close
[0m10:20:21.210368 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '832b4395-c4f2-4316-a604-8eaa6dabe5c9', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000001CBA1762110>]}
[0m10:20:21.211368 [info ] [Thread-1 (]: 3 of 6 OK created sql view model analytics_stage.stg_unique_users .............. [[32mSUCCESS[0m in 0.06s]
[0m10:20:21.212592 [debug] [Thread-1 (]: Finished running node model.my_dbt_trino_project.stg_unique_users
[0m10:20:21.212592 [debug] [Thread-1 (]: Began running node model.my_dbt_trino_project.stg_user_activity_per_country
[0m10:20:21.213600 [info ] [Thread-1 (]: 4 of 6 START sql view model analytics_stage.stg_user_activity_per_country ...... [RUN]
[0m10:20:21.213600 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.my_dbt_trino_project.stg_unique_users, now model.my_dbt_trino_project.stg_user_activity_per_country)
[0m10:20:21.214597 [debug] [Thread-1 (]: Began compiling node model.my_dbt_trino_project.stg_user_activity_per_country
[0m10:20:21.216600 [debug] [Thread-1 (]: Writing injected SQL for node "model.my_dbt_trino_project.stg_user_activity_per_country"
[0m10:20:21.217892 [debug] [Thread-1 (]: Began executing node model.my_dbt_trino_project.stg_user_activity_per_country
[0m10:20:21.219902 [debug] [Thread-1 (]: Writing runtime sql for node "model.my_dbt_trino_project.stg_user_activity_per_country"
[0m10:20:21.222900 [debug] [Thread-1 (]: Using trino connection "model.my_dbt_trino_project.stg_user_activity_per_country"
[0m10:20:21.223898 [debug] [Thread-1 (]: On model.my_dbt_trino_project.stg_user_activity_per_country: /* {"app": "dbt", "dbt_version": "1.8.2", "profile_name": "my_dbt_trino_project", "target_name": "dev", "node_id": "model.my_dbt_trino_project.stg_user_activity_per_country"} */

  create or replace view
    "datalake"."analytics_stage"."stg_user_activity_per_country"
  security definer
  as
    

WITH combined_activities AS (
  SELECT
    country,
    'listen_event' AS event_type,
    ts,
    userid
  FROM "datalake"."analytics_source"."src_listen_events"
  WHERE country IS NOT NULL
  UNION ALL
  SELECT
    'Unknown' AS country, 
    ts,
    userid
  FROM "datalake"."analytics_source"."src_auth_events"
  UNION ALL
  SELECT
    'Unknown' AS country, 
    'page_view_event' AS event_type,
    ts,
    userid
  FROM "datalake"."analytics_source"."src_page_view_events"
)

SELECT
  country,
  COUNT(*) AS activity_count
FROM combined_activities
GROUP BY country
  
[0m10:20:21.223898 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m10:20:21.284979 [debug] [Thread-1 (]: Trino adapter: Trino query id: 20240619_022021_00082_uxt54
[0m10:20:21.284979 [debug] [Thread-1 (]: Trino adapter: Trino error: TrinoUserError(type=USER_ERROR, name=TYPE_MISMATCH, message="line 17:3: UNION query has different number of fields: 4, 3", query_id=20240619_022021_00082_uxt54)
[0m10:20:21.285985 [debug] [Thread-1 (]: On model.my_dbt_trino_project.stg_user_activity_per_country: ROLLBACK
[0m10:20:21.285985 [debug] [Thread-1 (]: On model.my_dbt_trino_project.stg_user_activity_per_country: Close
[0m10:20:21.290000 [debug] [Thread-1 (]: Database Error in model stg_user_activity_per_country (models\stage\stg_user_activity_per_country.sql)
  TrinoUserError(type=USER_ERROR, name=TYPE_MISMATCH, message="line 17:3: UNION query has different number of fields: 4, 3", query_id=20240619_022021_00082_uxt54)
  compiled Code at target\run\my_dbt_trino_project\models\stage\stg_user_activity_per_country.sql
[0m10:20:21.291496 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '832b4395-c4f2-4316-a604-8eaa6dabe5c9', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000001CBA21B8610>]}
[0m10:20:21.291496 [error] [Thread-1 (]: 4 of 6 ERROR creating sql view model analytics_stage.stg_user_activity_per_country  [[31mERROR[0m in 0.08s]
[0m10:20:21.292991 [debug] [Thread-1 (]: Finished running node model.my_dbt_trino_project.stg_user_activity_per_country
[0m10:20:21.293998 [debug] [Thread-1 (]: Began running node model.my_dbt_trino_project.stg_user_activity_per_location
[0m10:20:21.293998 [info ] [Thread-1 (]: 5 of 6 START sql view model analytics_stage.stg_user_activity_per_location ..... [RUN]
[0m10:20:21.293998 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.my_dbt_trino_project.stg_user_activity_per_country, now model.my_dbt_trino_project.stg_user_activity_per_location)
[0m10:20:21.295335 [debug] [Thread-1 (]: Began compiling node model.my_dbt_trino_project.stg_user_activity_per_location
[0m10:20:21.299001 [debug] [Thread-1 (]: Writing injected SQL for node "model.my_dbt_trino_project.stg_user_activity_per_location"
[0m10:20:21.299001 [debug] [Thread-1 (]: Began executing node model.my_dbt_trino_project.stg_user_activity_per_location
[0m10:20:21.301417 [debug] [Thread-1 (]: Writing runtime sql for node "model.my_dbt_trino_project.stg_user_activity_per_location"
[0m10:20:21.302677 [debug] [Thread-1 (]: Using trino connection "model.my_dbt_trino_project.stg_user_activity_per_location"
[0m10:20:21.303686 [debug] [Thread-1 (]: On model.my_dbt_trino_project.stg_user_activity_per_location: /* {"app": "dbt", "dbt_version": "1.8.2", "profile_name": "my_dbt_trino_project", "target_name": "dev", "node_id": "model.my_dbt_trino_project.stg_user_activity_per_location"} */

  create or replace view
    "datalake"."analytics_stage"."stg_user_activity_per_location"
  security definer
  as
    

WITH combined_activities AS (
  SELECT
    city,
    state,
    'auth_event' AS event_type,
    ts,
    userid
 FROM "datalake"."analytics_source"."src_auth_events"
  UNION ALL
  SELECT
    city,
    state,
    'listen_event' AS event_type,
    ts,
    userid
  FROM "datalake"."analytics_source"."src_listen_events"
  UNION ALL
  SELECT
    city,
    state,
    'page_view_event' AS event_type,
    ts,
    userid
  FROM "datalake"."analytics_source"."src_page_view_events"
)

SELECT
  state,
  city,
  COUNT(*) AS activity_count
FROM combined_activities
GROUP BY state, city
  
[0m10:20:21.303686 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m10:20:21.402316 [debug] [Thread-1 (]: SQL status: SUCCESS in 0.0 seconds
[0m10:20:21.404313 [debug] [Thread-1 (]: On model.my_dbt_trino_project.stg_user_activity_per_location: ROLLBACK
[0m10:20:21.404313 [debug] [Thread-1 (]: On model.my_dbt_trino_project.stg_user_activity_per_location: Close
[0m10:20:21.405314 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '832b4395-c4f2-4316-a604-8eaa6dabe5c9', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000001CB9EA41C90>]}
[0m10:20:21.405314 [info ] [Thread-1 (]: 5 of 6 OK created sql view model analytics_stage.stg_user_activity_per_location  [[32mSUCCESS[0m in 0.11s]
[0m10:20:21.406821 [debug] [Thread-1 (]: Finished running node model.my_dbt_trino_project.stg_user_activity_per_location
[0m10:20:21.407333 [debug] [Thread-1 (]: Began running node model.my_dbt_trino_project.stg_user_level_by_gender
[0m10:20:21.407587 [info ] [Thread-1 (]: 6 of 6 START sql view model analytics_stage.stg_user_level_by_gender ........... [RUN]
[0m10:20:21.407587 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.my_dbt_trino_project.stg_user_activity_per_location, now model.my_dbt_trino_project.stg_user_level_by_gender)
[0m10:20:21.407587 [debug] [Thread-1 (]: Began compiling node model.my_dbt_trino_project.stg_user_level_by_gender
[0m10:20:21.410802 [debug] [Thread-1 (]: Writing injected SQL for node "model.my_dbt_trino_project.stg_user_level_by_gender"
[0m10:20:21.410802 [debug] [Thread-1 (]: Began executing node model.my_dbt_trino_project.stg_user_level_by_gender
[0m10:20:21.413228 [debug] [Thread-1 (]: Writing runtime sql for node "model.my_dbt_trino_project.stg_user_level_by_gender"
[0m10:20:21.414233 [debug] [Thread-1 (]: Using trino connection "model.my_dbt_trino_project.stg_user_level_by_gender"
[0m10:20:21.415233 [debug] [Thread-1 (]: On model.my_dbt_trino_project.stg_user_level_by_gender: /* {"app": "dbt", "dbt_version": "1.8.2", "profile_name": "my_dbt_trino_project", "target_name": "dev", "node_id": "model.my_dbt_trino_project.stg_user_level_by_gender"} */

  create or replace view
    "datalake"."analytics_stage"."stg_user_level_by_gender"
  security definer
  as
    

WITH user_subscriptions AS (
    SELECT
        gender,
        level, 
        COUNT(DISTINCT userId) AS user_count
    FROM "datalake"."analytics_source"."src_auth_events"
    WHERE gender IS NOT NULL AND level IS NOT NULL
    GROUP BY gender, level
)

SELECT
    gender,
    level,
    user_count
FROM user_subscriptions
  
[0m10:20:21.415233 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m10:20:21.490025 [debug] [Thread-1 (]: SQL status: SUCCESS in 0.0 seconds
[0m10:20:21.491031 [debug] [Thread-1 (]: On model.my_dbt_trino_project.stg_user_level_by_gender: ROLLBACK
[0m10:20:21.492031 [debug] [Thread-1 (]: On model.my_dbt_trino_project.stg_user_level_by_gender: Close
[0m10:20:21.492031 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '832b4395-c4f2-4316-a604-8eaa6dabe5c9', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000001CBA190D390>]}
[0m10:20:21.493315 [info ] [Thread-1 (]: 6 of 6 OK created sql view model analytics_stage.stg_user_level_by_gender ...... [[32mSUCCESS[0m in 0.08s]
[0m10:20:21.493315 [debug] [Thread-1 (]: Finished running node model.my_dbt_trino_project.stg_user_level_by_gender
[0m10:20:21.494509 [debug] [MainThread]: On master: COMMIT
[0m10:20:21.495519 [debug] [MainThread]: Connection 'master' was properly closed.
[0m10:20:21.495773 [debug] [MainThread]: Connection 'list_datalake' was properly closed.
[0m10:20:21.495773 [debug] [MainThread]: Connection 'list_datalake_analytics_source' was properly closed.
[0m10:20:21.495773 [debug] [MainThread]: Connection 'model.my_dbt_trino_project.stg_user_level_by_gender' was properly closed.
[0m10:20:21.496518 [info ] [MainThread]: 
[0m10:20:21.496518 [info ] [MainThread]: Finished running 1 table model, 5 view models in 0 hours 0 minutes and 1.43 seconds (1.43s).
[0m10:20:21.497828 [debug] [MainThread]: Command end result
[0m10:20:21.583025 [info ] [MainThread]: 
[0m10:20:21.584026 [info ] [MainThread]: [31mCompleted with 1 error and 0 warnings:[0m
[0m10:20:21.584026 [info ] [MainThread]: 
[0m10:20:21.585395 [error] [MainThread]:   Database Error in model stg_user_activity_per_country (models\stage\stg_user_activity_per_country.sql)
  TrinoUserError(type=USER_ERROR, name=TYPE_MISMATCH, message="line 17:3: UNION query has different number of fields: 4, 3", query_id=20240619_022021_00082_uxt54)
  compiled Code at target\run\my_dbt_trino_project\models\stage\stg_user_activity_per_country.sql
[0m10:20:21.585395 [info ] [MainThread]: 
[0m10:20:21.586491 [info ] [MainThread]: Done. PASS=5 WARN=0 ERROR=1 SKIP=0 TOTAL=6
[0m10:20:21.587946 [debug] [MainThread]: Command `dbt run` failed at 10:20:21.587946 after 2.22 seconds
[0m10:20:21.587946 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000001CB9C2EF390>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000001CB9C2EE310>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000001CBA17AC110>]}
[0m10:20:21.588954 [debug] [MainThread]: Flushing usage events
[0m10:20:48.744694 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x00000156BB648FD0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x00000156BC627E10>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x00000156BC600510>]}


============================== 10:20:48.747687 | c52552ee-b298-4147-8bc6-d7b23af264f5 ==============================
[0m10:20:48.747687 [info ] [MainThread]: Running with dbt=1.8.2
[0m10:20:48.747687 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'indirect_selection': 'eager', 'log_cache_events': 'False', 'write_json': 'True', 'partial_parse': 'True', 'cache_selected_only': 'False', 'warn_error': 'None', 'version_check': 'True', 'debug': 'False', 'log_path': 'C:\\Users\\ASUS\\Desktop\\work\\Iceberg-Dbt-Trino-Hive-modern-open-source-data-stack-main\\dbt\\logs', 'fail_fast': 'False', 'profiles_dir': 'C:\\Users\\ASUS\\Desktop\\work\\Iceberg-Dbt-Trino-Hive-modern-open-source-data-stack-main\\dbt', 'use_colors': 'True', 'use_experimental_parser': 'False', 'no_print': 'None', 'quiet': 'False', 'log_format': 'default', 'static_parser': 'True', 'invocation_command': 'dbt run --models models', 'introspect': 'True', 'target_path': 'None', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'send_anonymous_usage_stats': 'True'}
[0m10:20:49.036256 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': 'c52552ee-b298-4147-8bc6-d7b23af264f5', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x00000156BC96AC10>]}
[0m10:20:49.068797 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': 'c52552ee-b298-4147-8bc6-d7b23af264f5', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x00000156B97456D0>]}
[0m10:20:49.069787 [info ] [MainThread]: Registered adapter: trino=1.8.0
[0m10:20:49.078821 [debug] [MainThread]: checksum: f0a141b9de567cb7f131613ba2682f40b3a1c6a157f81c6e5435862eff68f109, vars: {}, profile: , target: , version: 1.8.2
[0m10:20:49.228374 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 0 files changed.
[0m10:20:49.229374 [debug] [MainThread]: Partial parsing enabled, no changes found, skipping parsing
[0m10:20:49.256054 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': 'c52552ee-b298-4147-8bc6-d7b23af264f5', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x00000156BC5C5590>]}
[0m10:20:49.325404 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': 'c52552ee-b298-4147-8bc6-d7b23af264f5', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x00000156BCB13B10>]}
[0m10:20:49.326405 [info ] [MainThread]: Found 15 models, 7 data tests, 3 sources, 559 macros
[0m10:20:49.326405 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': 'c52552ee-b298-4147-8bc6-d7b23af264f5', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x00000156BCD69990>]}
[0m10:20:49.327405 [warn ] [MainThread]: The selection criterion 'models' does not match any enabled nodes
[0m10:20:49.327405 [info ] [MainThread]: 
[0m10:20:49.328800 [warn ] [MainThread]: Nothing to do. Try checking your model configs and model specification args
[0m10:20:49.329961 [debug] [MainThread]: Command end result
[0m10:20:49.362380 [debug] [MainThread]: Command `dbt run` succeeded at 10:20:49.362380 after 0.74 seconds
[0m10:20:49.362380 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x00000156BC63B9D0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x00000156BC63B390>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x00000156BC63BDD0>]}
[0m10:20:49.363479 [debug] [MainThread]: Flushing usage events
[0m10:24:36.762854 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x0000015AE00F3BD0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x0000015AE00D7A90>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x0000015AE0086090>]}


============================== 10:24:36.765854 | 153807a6-1905-4c4b-b052-4f8686099abe ==============================
[0m10:24:36.765854 [info ] [MainThread]: Running with dbt=1.8.2
[0m10:24:36.765854 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'indirect_selection': 'eager', 'write_json': 'True', 'log_cache_events': 'False', 'partial_parse': 'True', 'cache_selected_only': 'False', 'profiles_dir': 'C:\\Users\\ASUS\\Desktop\\work\\Iceberg-Dbt-Trino-Hive-modern-open-source-data-stack-main\\dbt', 'debug': 'False', 'warn_error': 'None', 'log_path': 'C:\\Users\\ASUS\\Desktop\\work\\Iceberg-Dbt-Trino-Hive-modern-open-source-data-stack-main\\dbt\\logs', 'fail_fast': 'False', 'version_check': 'True', 'use_colors': 'True', 'use_experimental_parser': 'False', 'no_print': 'None', 'quiet': 'False', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'introspect': 'True', 'log_format': 'default', 'static_parser': 'True', 'target_path': 'None', 'invocation_command': 'dbt debug', 'send_anonymous_usage_stats': 'True'}
[0m10:24:36.777154 [info ] [MainThread]: dbt version: 1.8.2
[0m10:24:36.778166 [info ] [MainThread]: python version: 3.11.5
[0m10:24:36.778166 [info ] [MainThread]: python path: C:\Users\ASUS\anaconda3\python.exe
[0m10:24:36.779478 [info ] [MainThread]: os info: Windows-10-10.0.22631-SP0
[0m10:24:36.938641 [info ] [MainThread]: Using profiles dir at C:\Users\ASUS\Desktop\work\Iceberg-Dbt-Trino-Hive-modern-open-source-data-stack-main\dbt
[0m10:24:36.939816 [info ] [MainThread]: Using profiles.yml file at C:\Users\ASUS\Desktop\work\Iceberg-Dbt-Trino-Hive-modern-open-source-data-stack-main\dbt\profiles.yml
[0m10:24:36.940747 [info ] [MainThread]: Using dbt_project.yml file at C:\Users\ASUS\Desktop\work\Iceberg-Dbt-Trino-Hive-modern-open-source-data-stack-main\dbt\dbt_project.yml
[0m10:24:36.941761 [info ] [MainThread]: adapter type: trino
[0m10:24:36.941761 [info ] [MainThread]: adapter version: 1.8.0
[0m10:24:37.006855 [info ] [MainThread]: Configuration:
[0m10:24:37.007854 [info ] [MainThread]:   profiles.yml file [[32mOK found and valid[0m]
[0m10:24:37.007854 [info ] [MainThread]:   dbt_project.yml file [[32mOK found and valid[0m]
[0m10:24:37.008856 [info ] [MainThread]: Required dependencies:
[0m10:24:37.008856 [debug] [MainThread]: Executing "git --help"
[0m10:24:37.102550 [debug] [MainThread]: STDOUT: "b"usage: git [-v | --version] [-h | --help] [-C <path>] [-c <name>=<value>]\n           [--exec-path[=<path>]] [--html-path] [--man-path] [--info-path]\n           [-p | --paginate | -P | --no-pager] [--no-replace-objects] [--bare]\n           [--git-dir=<path>] [--work-tree=<path>] [--namespace=<name>]\n           [--config-env=<name>=<envvar>] <command> [<args>]\n\nThese are common Git commands used in various situations:\n\nstart a working area (see also: git help tutorial)\n   clone     Clone a repository into a new directory\n   init      Create an empty Git repository or reinitialize an existing one\n\nwork on the current change (see also: git help everyday)\n   add       Add file contents to the index\n   mv        Move or rename a file, a directory, or a symlink\n   restore   Restore working tree files\n   rm        Remove files from the working tree and from the index\n\nexamine the history and state (see also: git help revisions)\n   bisect    Use binary search to find the commit that introduced a bug\n   diff      Show changes between commits, commit and working tree, etc\n   grep      Print lines matching a pattern\n   log       Show commit logs\n   show      Show various types of objects\n   status    Show the working tree status\n\ngrow, mark and tweak your common history\n   branch    List, create, or delete branches\n   commit    Record changes to the repository\n   merge     Join two or more development histories together\n   rebase    Reapply commits on top of another base tip\n   reset     Reset current HEAD to the specified state\n   switch    Switch branches\n   tag       Create, list, delete or verify a tag object signed with GPG\n\ncollaborate (see also: git help workflows)\n   fetch     Download objects and refs from another repository\n   pull      Fetch from and integrate with another repository or a local branch\n   push      Update remote refs along with associated objects\n\n'git help -a' and 'git help -g' list available subcommands and some\nconcept guides. See 'git help <command>' or 'git help <concept>'\nto read about a specific subcommand or concept.\nSee 'git help git' for an overview of the system.\n""
[0m10:24:37.103549 [debug] [MainThread]: STDERR: "b''"
[0m10:24:37.103549 [info ] [MainThread]:  - git [[32mOK found[0m]

[0m10:24:37.104548 [info ] [MainThread]: Connection:
[0m10:24:37.105548 [info ] [MainThread]:   host: localhost
[0m10:24:37.105548 [info ] [MainThread]:   port: 8080
[0m10:24:37.106548 [info ] [MainThread]:   user: admin
[0m10:24:37.106548 [info ] [MainThread]:   database: datalake
[0m10:24:37.107549 [info ] [MainThread]:   schema: analytics
[0m10:24:37.107549 [info ] [MainThread]:   cert: None
[0m10:24:37.107549 [info ] [MainThread]:   prepared_statements_enabled: True
[0m10:24:37.108549 [info ] [MainThread]: Registered adapter: trino=1.8.0
[0m10:24:37.109548 [debug] [MainThread]: Acquiring new trino connection 'debug'
[0m10:24:37.156581 [debug] [MainThread]: Using trino connection "debug"
[0m10:24:37.156581 [debug] [MainThread]: On debug: select 1 as id
[0m10:24:37.157581 [debug] [MainThread]: Opening a new connection, currently in state init
[0m10:24:37.186615 [debug] [MainThread]: SQL status: SUCCESS in 0.0 seconds
[0m10:24:37.187609 [debug] [MainThread]: On debug: Close
[0m10:24:37.187609 [info ] [MainThread]:   Connection test: [[32mOK connection ok[0m]

[0m10:24:37.188609 [info ] [MainThread]: [32mAll checks passed![0m
[0m10:24:37.189611 [debug] [MainThread]: Command `dbt debug` succeeded at 10:24:37.189611 after 0.56 seconds
[0m10:24:37.190610 [debug] [MainThread]: Connection 'debug' was properly closed.
[0m10:24:37.190610 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x0000015AE07F7890>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x0000015AE07F6C90>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x0000015AE07F7790>]}
[0m10:24:37.191608 [debug] [MainThread]: Flushing usage events
[0m10:24:43.511386 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000001CF12984290>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000001CF14A73910>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000001CF148F7BD0>]}


============================== 10:24:43.513384 | 60645fcd-0f0e-4258-af25-27a15a0a1a46 ==============================
[0m10:24:43.513384 [info ] [MainThread]: Running with dbt=1.8.2
[0m10:24:43.514384 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'indirect_selection': 'eager', 'log_cache_events': 'False', 'write_json': 'True', 'partial_parse': 'True', 'cache_selected_only': 'False', 'warn_error': 'None', 'debug': 'False', 'fail_fast': 'False', 'log_path': 'C:\\Users\\ASUS\\Desktop\\work\\Iceberg-Dbt-Trino-Hive-modern-open-source-data-stack-main\\dbt\\logs', 'profiles_dir': 'C:\\Users\\ASUS\\Desktop\\work\\Iceberg-Dbt-Trino-Hive-modern-open-source-data-stack-main\\dbt', 'version_check': 'True', 'use_colors': 'True', 'use_experimental_parser': 'False', 'no_print': 'None', 'quiet': 'False', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'introspect': 'True', 'static_parser': 'True', 'log_format': 'default', 'target_path': 'None', 'invocation_command': 'dbt run', 'send_anonymous_usage_stats': 'True'}
[0m10:24:43.803730 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': '60645fcd-0f0e-4258-af25-27a15a0a1a46', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000001CF150A6DD0>]}
[0m10:24:43.836250 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': '60645fcd-0f0e-4258-af25-27a15a0a1a46', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000001CF12195350>]}
[0m10:24:43.837251 [info ] [MainThread]: Registered adapter: trino=1.8.0
[0m10:24:43.847441 [debug] [MainThread]: checksum: f0a141b9de567cb7f131613ba2682f40b3a1c6a157f81c6e5435862eff68f109, vars: {}, profile: , target: , version: 1.8.2
[0m10:24:44.002062 [debug] [MainThread]: Partial parsing enabled: 6 files deleted, 6 files added, 0 files changed.
[0m10:24:44.003063 [debug] [MainThread]: Partial parsing: added file: my_dbt_trino_project://models\marts\mart_user_level_by_gender.sql
[0m10:24:44.003063 [debug] [MainThread]: Partial parsing: added file: my_dbt_trino_project://models\marts\mart_user_activity_per_country.sql
[0m10:24:44.004062 [debug] [MainThread]: Partial parsing: added file: my_dbt_trino_project://models\marts\mart_total_unique_users.sql
[0m10:24:44.004062 [debug] [MainThread]: Partial parsing: added file: my_dbt_trino_project://models\marts\mart_hourly_stream_evolution.sql
[0m10:24:44.004062 [debug] [MainThread]: Partial parsing: added file: my_dbt_trino_project://models\marts\mart_user_activity_per_state.sql
[0m10:24:44.005062 [debug] [MainThread]: Partial parsing: added file: my_dbt_trino_project://models\marts\mart_top_songs_artists.sql
[0m10:24:44.005062 [debug] [MainThread]: Partial parsing: deleted file: my_dbt_trino_project://models\mart_user_activity_per_state.sql
[0m10:24:44.005062 [debug] [MainThread]: Partial parsing: deleted file: my_dbt_trino_project://models\mart_hourly_stream_evolution.sql
[0m10:24:44.005062 [debug] [MainThread]: Partial parsing: deleted file: my_dbt_trino_project://models\mart_total_unique_users.sql
[0m10:24:44.006062 [debug] [MainThread]: Partial parsing: deleted file: my_dbt_trino_project://models\mart_user_level_by_gender.sql
[0m10:24:44.006062 [debug] [MainThread]: Partial parsing: deleted file: my_dbt_trino_project://models\mart_top_songs_artists.sql
[0m10:24:44.006062 [debug] [MainThread]: Partial parsing: deleted file: my_dbt_trino_project://models\mart_user_activity_per_country.sql
[0m10:24:44.180316 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': '60645fcd-0f0e-4258-af25-27a15a0a1a46', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000001CF1584D250>]}
[0m10:24:44.244349 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': '60645fcd-0f0e-4258-af25-27a15a0a1a46', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000001CF12821990>]}
[0m10:24:44.244349 [info ] [MainThread]: Found 15 models, 7 data tests, 3 sources, 559 macros
[0m10:24:44.245356 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '60645fcd-0f0e-4258-af25-27a15a0a1a46', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000001CF15800A90>]}
[0m10:24:44.247356 [info ] [MainThread]: 
[0m10:24:44.247356 [debug] [MainThread]: Acquiring new trino connection 'master'
[0m10:24:44.251354 [debug] [ThreadPool]: Acquiring new trino connection 'list_datalake'
[0m10:24:44.308870 [debug] [ThreadPool]: Using trino connection "list_datalake"
[0m10:24:44.308870 [debug] [ThreadPool]: On list_datalake: /* {"app": "dbt", "dbt_version": "1.8.2", "profile_name": "my_dbt_trino_project", "target_name": "dev", "connection_name": "list_datalake"} */

    select schema_name
    from "datalake".INFORMATION_SCHEMA.schemata
[0m10:24:44.308870 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m10:24:44.338019 [debug] [ThreadPool]: SQL status: SUCCESS in 0.0 seconds
[0m10:24:44.339020 [debug] [ThreadPool]: On list_datalake: Close
[0m10:24:44.341020 [debug] [ThreadPool]: Using trino connection "list_datalake"
[0m10:24:44.342017 [debug] [ThreadPool]: On list_datalake: /* {"app": "dbt", "dbt_version": "1.8.2", "profile_name": "my_dbt_trino_project", "target_name": "dev", "connection_name": "list_datalake"} */

    select schema_name
    from "datalake".INFORMATION_SCHEMA.schemata
[0m10:24:44.342017 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m10:24:44.366131 [debug] [ThreadPool]: SQL status: SUCCESS in 0.0 seconds
[0m10:24:44.367139 [debug] [ThreadPool]: On list_datalake: Close
[0m10:24:44.369138 [debug] [ThreadPool]: Using trino connection "list_datalake"
[0m10:24:44.370138 [debug] [ThreadPool]: On list_datalake: /* {"app": "dbt", "dbt_version": "1.8.2", "profile_name": "my_dbt_trino_project", "target_name": "dev", "connection_name": "list_datalake"} */

    select schema_name
    from "datalake".INFORMATION_SCHEMA.schemata
[0m10:24:44.370138 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m10:24:44.392341 [debug] [ThreadPool]: SQL status: SUCCESS in 0.0 seconds
[0m10:24:44.393350 [debug] [ThreadPool]: On list_datalake: Close
[0m10:24:44.395689 [debug] [ThreadPool]: Acquiring new trino connection 'list_datalake_analytics'
[0m10:24:44.406856 [debug] [ThreadPool]: Using trino connection "list_datalake_analytics"
[0m10:24:44.407854 [debug] [ThreadPool]: On list_datalake_analytics: /* {"app": "dbt", "dbt_version": "1.8.2", "profile_name": "my_dbt_trino_project", "target_name": "dev", "connection_name": "list_datalake_analytics"} */
select
      t.table_catalog as database,
      t.table_name as name,
      t.table_schema as schema,
      case when mv.name is not null then 'materialized_view'
           when t.table_type = 'BASE TABLE' then 'table'
           when t.table_type = 'VIEW' then 'view'
           else t.table_type
      end as table_type
    from "datalake".INFORMATION_SCHEMA.tables t
    left join (
            select * from system.metadata.materialized_views
            where catalog_name = 'datalake'
              and schema_name = 'analytics') mv
          on mv.catalog_name = t.table_catalog and mv.schema_name = t.table_schema and mv.name = t.table_name
    where t.table_schema = 'analytics'
[0m10:24:44.407854 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m10:24:44.472868 [debug] [ThreadPool]: SQL status: SUCCESS in 0.0 seconds
[0m10:24:44.473875 [debug] [ThreadPool]: On list_datalake_analytics: ROLLBACK
[0m10:24:44.473875 [debug] [ThreadPool]: On list_datalake_analytics: Close
[0m10:24:44.473875 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_datalake_analytics, now list_datalake_analytics_source)
[0m10:24:44.478386 [debug] [ThreadPool]: Using trino connection "list_datalake_analytics_source"
[0m10:24:44.478386 [debug] [ThreadPool]: On list_datalake_analytics_source: /* {"app": "dbt", "dbt_version": "1.8.2", "profile_name": "my_dbt_trino_project", "target_name": "dev", "connection_name": "list_datalake_analytics_source"} */
select
      t.table_catalog as database,
      t.table_name as name,
      t.table_schema as schema,
      case when mv.name is not null then 'materialized_view'
           when t.table_type = 'BASE TABLE' then 'table'
           when t.table_type = 'VIEW' then 'view'
           else t.table_type
      end as table_type
    from "datalake".INFORMATION_SCHEMA.tables t
    left join (
            select * from system.metadata.materialized_views
            where catalog_name = 'datalake'
              and schema_name = 'analytics_source') mv
          on mv.catalog_name = t.table_catalog and mv.schema_name = t.table_schema and mv.name = t.table_name
    where t.table_schema = 'analytics_source'
[0m10:24:44.479719 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m10:24:44.549840 [debug] [ThreadPool]: SQL status: SUCCESS in 0.0 seconds
[0m10:24:44.550687 [debug] [ThreadPool]: On list_datalake_analytics_source: ROLLBACK
[0m10:24:44.551468 [debug] [ThreadPool]: On list_datalake_analytics_source: Close
[0m10:24:44.551468 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_datalake_analytics_source, now list_datalake_analytics_stage)
[0m10:24:44.555467 [debug] [ThreadPool]: Using trino connection "list_datalake_analytics_stage"
[0m10:24:44.556468 [debug] [ThreadPool]: On list_datalake_analytics_stage: /* {"app": "dbt", "dbt_version": "1.8.2", "profile_name": "my_dbt_trino_project", "target_name": "dev", "connection_name": "list_datalake_analytics_stage"} */
select
      t.table_catalog as database,
      t.table_name as name,
      t.table_schema as schema,
      case when mv.name is not null then 'materialized_view'
           when t.table_type = 'BASE TABLE' then 'table'
           when t.table_type = 'VIEW' then 'view'
           else t.table_type
      end as table_type
    from "datalake".INFORMATION_SCHEMA.tables t
    left join (
            select * from system.metadata.materialized_views
            where catalog_name = 'datalake'
              and schema_name = 'analytics_stage') mv
          on mv.catalog_name = t.table_catalog and mv.schema_name = t.table_schema and mv.name = t.table_name
    where t.table_schema = 'analytics_stage'
[0m10:24:44.556468 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m10:24:44.629648 [debug] [ThreadPool]: SQL status: SUCCESS in 0.0 seconds
[0m10:24:44.630720 [debug] [ThreadPool]: On list_datalake_analytics_stage: ROLLBACK
[0m10:24:44.631729 [debug] [ThreadPool]: On list_datalake_analytics_stage: Close
[0m10:24:44.631729 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '60645fcd-0f0e-4258-af25-27a15a0a1a46', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000001CF154BAD50>]}
[0m10:24:44.633216 [debug] [MainThread]: On master: COMMIT
[0m10:24:44.633216 [info ] [MainThread]: Concurrency: 1 threads (target='dev')
[0m10:24:44.634223 [info ] [MainThread]: 
[0m10:24:44.636737 [debug] [Thread-1 (]: Began running node model.my_dbt_trino_project.src_auth_events
[0m10:24:44.636737 [info ] [Thread-1 (]: 1 of 15 START sql table model analytics_source.src_auth_events ................. [RUN]
[0m10:24:44.637736 [debug] [Thread-1 (]: Acquiring new trino connection 'model.my_dbt_trino_project.src_auth_events'
[0m10:24:44.638736 [debug] [Thread-1 (]: Began compiling node model.my_dbt_trino_project.src_auth_events
[0m10:24:44.645738 [debug] [Thread-1 (]: Writing injected SQL for node "model.my_dbt_trino_project.src_auth_events"
[0m10:24:44.646735 [debug] [Thread-1 (]: Began executing node model.my_dbt_trino_project.src_auth_events
[0m10:24:44.676296 [debug] [Thread-1 (]: Writing runtime sql for node "model.my_dbt_trino_project.src_auth_events"
[0m10:24:44.682320 [debug] [Thread-1 (]: Using trino connection "model.my_dbt_trino_project.src_auth_events"
[0m10:24:44.683321 [debug] [Thread-1 (]: On model.my_dbt_trino_project.src_auth_events: /* {"app": "dbt", "dbt_version": "1.8.2", "profile_name": "my_dbt_trino_project", "target_name": "dev", "node_id": "model.my_dbt_trino_project.src_auth_events"} */

  
    

    create table "datalake"."analytics_source"."src_auth_events__dbt_tmp"
      
      
    as (
      

with source as (
    select
        CAST(ts AS VARCHAR) as id, 
        ts,
        CAST(sessionId AS VARCHAR) as sessionId,
        level,
        itemInSession,
        city,
        zip,
        state,
        userAgent,
        CAST(NULLIF(lon, '') AS double) as lon,
        CAST(NULLIF(lat, '') AS double) as lat,
        CAST(FLOOR(CAST(NULLIF(userId, '') AS DOUBLE)) AS INT) as userId, 
        lastName,
        firstName,
        gender,
        CAST(FLOOR(CAST(NULLIF(registration, '') AS DOUBLE)) AS BIGINT) as registration,
        success
    from "oltp"."public"."auth_events"
)

select
    id,
    ts,
    sessionId,
    level,
    itemInSession,
    city,
    zip,
    state,
    userAgent,
    lon,
    lat,
    userId,
    lastName,
    firstName,
    gender,
    registration, 
    CASE 
        WHEN CAST(success AS VARCHAR) = 't' THEN true 
        WHEN CAST(success AS VARCHAR) = 'f' THEN false
        ELSE NULL 
    END AS success_boolean
from source


    )
[0m10:24:44.683321 [debug] [Thread-1 (]: Opening a new connection, currently in state init
[0m10:24:44.960248 [debug] [Thread-1 (]: SQL status: SUCCESS in 0.0 seconds
[0m10:24:44.966342 [debug] [Thread-1 (]: Using trino connection "model.my_dbt_trino_project.src_auth_events"
[0m10:24:44.967347 [debug] [Thread-1 (]: On model.my_dbt_trino_project.src_auth_events: /* {"app": "dbt", "dbt_version": "1.8.2", "profile_name": "my_dbt_trino_project", "target_name": "dev", "node_id": "model.my_dbt_trino_project.src_auth_events"} */
alter table "datalake"."analytics_source"."src_auth_events" rename to "datalake"."analytics_source"."src_auth_events__dbt_backup"
[0m10:24:45.062116 [debug] [Thread-1 (]: SQL status: SUCCESS in 0.0 seconds
[0m10:24:45.116630 [debug] [Thread-1 (]: Using trino connection "model.my_dbt_trino_project.src_auth_events"
[0m10:24:45.116630 [debug] [Thread-1 (]: On model.my_dbt_trino_project.src_auth_events: /* {"app": "dbt", "dbt_version": "1.8.2", "profile_name": "my_dbt_trino_project", "target_name": "dev", "node_id": "model.my_dbt_trino_project.src_auth_events"} */
alter table "datalake"."analytics_source"."src_auth_events__dbt_tmp" rename to "datalake"."analytics_source"."src_auth_events"
[0m10:24:45.224129 [debug] [Thread-1 (]: SQL status: SUCCESS in 0.0 seconds
[0m10:24:45.230135 [debug] [Thread-1 (]: Applying DROP to: "datalake"."analytics_source"."src_auth_events__dbt_backup"
[0m10:24:45.232640 [debug] [Thread-1 (]: Using trino connection "model.my_dbt_trino_project.src_auth_events"
[0m10:24:45.232640 [debug] [Thread-1 (]: On model.my_dbt_trino_project.src_auth_events: /* {"app": "dbt", "dbt_version": "1.8.2", "profile_name": "my_dbt_trino_project", "target_name": "dev", "node_id": "model.my_dbt_trino_project.src_auth_events"} */

    drop table if exists "datalake"."analytics_source"."src_auth_events__dbt_backup"
[0m10:24:45.366047 [debug] [Thread-1 (]: SQL status: SUCCESS in 0.0 seconds
[0m10:24:45.380072 [debug] [Thread-1 (]: On model.my_dbt_trino_project.src_auth_events: ROLLBACK
[0m10:24:45.381146 [debug] [Thread-1 (]: On model.my_dbt_trino_project.src_auth_events: Close
[0m10:24:45.382656 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '60645fcd-0f0e-4258-af25-27a15a0a1a46', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000001CF16C22AD0>]}
[0m10:24:45.382656 [info ] [Thread-1 (]: 1 of 15 OK created sql table model analytics_source.src_auth_events ............ [[32mSUCCESS[0m in 0.74s]
[0m10:24:45.384162 [debug] [Thread-1 (]: Finished running node model.my_dbt_trino_project.src_auth_events
[0m10:24:45.384162 [debug] [Thread-1 (]: Began running node model.my_dbt_trino_project.src_listen_events
[0m10:24:45.385169 [info ] [Thread-1 (]: 2 of 15 START sql incremental model analytics_source.src_listen_events ......... [RUN]
[0m10:24:45.386169 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.my_dbt_trino_project.src_auth_events, now model.my_dbt_trino_project.src_listen_events)
[0m10:24:45.386169 [debug] [Thread-1 (]: Began compiling node model.my_dbt_trino_project.src_listen_events
[0m10:24:45.391171 [debug] [Thread-1 (]: Writing injected SQL for node "model.my_dbt_trino_project.src_listen_events"
[0m10:24:45.392169 [debug] [Thread-1 (]: Began executing node model.my_dbt_trino_project.src_listen_events
[0m10:24:45.416468 [debug] [Thread-1 (]: Using trino connection "model.my_dbt_trino_project.src_listen_events"
[0m10:24:45.416468 [debug] [Thread-1 (]: On model.my_dbt_trino_project.src_listen_events: /* {"app": "dbt", "dbt_version": "1.8.2", "profile_name": "my_dbt_trino_project", "target_name": "dev", "node_id": "model.my_dbt_trino_project.src_listen_events"} */

  
    

    create table "datalake"."analytics_source"."src_listen_events__dbt_tmp"
      
      
    as (
      

with source as (

    select
        CAST(_id AS VARCHAR) as id,
        artist,
        song,
        CAST(NULLIF(duration, '') AS DOUBLE) as duration,
        ts,
        sessionid,
        auth,
        level,
        CAST(NULLIF(itemInSession, '') AS INTEGER) as itemInSession,
        city,
        zip,
        state,
        country,
        userAgent,
        CAST(NULLIF(lon, '') AS DOUBLE) as lon,
        CAST(NULLIF(lat, '') AS DOUBLE) as lat,
        CAST(CAST(NULLIF(userId, '') AS DOUBLE) AS INTEGER) as userId,
 -- Assurez-vous que userId peut aussi être converti de cette manière.
        lastName,
        firstName,
        gender,
        CAST(CAST(NULLIF(registration, '') AS DOUBLE) AS BIGINT) as registration
    from "website"."demo"."listen_events"

)

select * from source



    -- this filter will only be applied on an incremental run
    where ts > (select max(ts) from "datalake"."analytics_source"."src_listen_events")


    )
[0m10:24:45.417467 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m10:24:45.633848 [debug] [Thread-1 (]: SQL status: SUCCESS in 0.0 seconds
[0m10:24:45.642969 [debug] [Thread-1 (]: Using trino connection "model.my_dbt_trino_project.src_listen_events"
[0m10:24:45.643505 [debug] [Thread-1 (]: On model.my_dbt_trino_project.src_listen_events: /* {"app": "dbt", "dbt_version": "1.8.2", "profile_name": "my_dbt_trino_project", "target_name": "dev", "node_id": "model.my_dbt_trino_project.src_listen_events"} */

    describe "datalake"."analytics_source"."src_listen_events__dbt_tmp"
[0m10:24:45.734112 [debug] [Thread-1 (]: SQL status: SUCCESS in 0.0 seconds
[0m10:24:45.737860 [debug] [Thread-1 (]: Using trino connection "model.my_dbt_trino_project.src_listen_events"
[0m10:24:45.738389 [debug] [Thread-1 (]: On model.my_dbt_trino_project.src_listen_events: /* {"app": "dbt", "dbt_version": "1.8.2", "profile_name": "my_dbt_trino_project", "target_name": "dev", "node_id": "model.my_dbt_trino_project.src_listen_events"} */

    describe "datalake"."analytics_source"."src_listen_events"
[0m10:24:45.881110 [debug] [Thread-1 (]: SQL status: SUCCESS in 0.0 seconds
[0m10:24:45.889119 [debug] [Thread-1 (]: Using trino connection "model.my_dbt_trino_project.src_listen_events"
[0m10:24:45.889119 [debug] [Thread-1 (]: On model.my_dbt_trino_project.src_listen_events: /* {"app": "dbt", "dbt_version": "1.8.2", "profile_name": "my_dbt_trino_project", "target_name": "dev", "node_id": "model.my_dbt_trino_project.src_listen_events"} */

    describe "datalake"."analytics_source"."src_listen_events"
[0m10:24:45.993135 [debug] [Thread-1 (]: SQL status: SUCCESS in 0.0 seconds
[0m10:24:46.001158 [debug] [Thread-1 (]: Writing runtime sql for node "model.my_dbt_trino_project.src_listen_events"
[0m10:24:46.003665 [debug] [Thread-1 (]: Using trino connection "model.my_dbt_trino_project.src_listen_events"
[0m10:24:46.003665 [debug] [Thread-1 (]: On model.my_dbt_trino_project.src_listen_events: /* {"app": "dbt", "dbt_version": "1.8.2", "profile_name": "my_dbt_trino_project", "target_name": "dev", "node_id": "model.my_dbt_trino_project.src_listen_events"} */
insert into "datalake"."analytics_source"."src_listen_events" ("id", "artist", "song", "duration", "ts", "sessionid", "auth", "level", "iteminsession", "city", "zip", "state", "country", "useragent", "lon", "lat", "userid", "lastname", "firstname", "gender", "registration")
    (
        select "id", "artist", "song", "duration", "ts", "sessionid", "auth", "level", "iteminsession", "city", "zip", "state", "country", "useragent", "lon", "lat", "userid", "lastname", "firstname", "gender", "registration"
        from "datalake"."analytics_source"."src_listen_events__dbt_tmp"
    )
[0m10:24:46.130573 [debug] [Thread-1 (]: SQL status: SUCCESS in 0.0 seconds
[0m10:24:46.132573 [debug] [Thread-1 (]: Applying DROP to: "datalake"."analytics_source"."src_listen_events__dbt_tmp"
[0m10:24:46.133581 [debug] [Thread-1 (]: Using trino connection "model.my_dbt_trino_project.src_listen_events"
[0m10:24:46.133581 [debug] [Thread-1 (]: On model.my_dbt_trino_project.src_listen_events: /* {"app": "dbt", "dbt_version": "1.8.2", "profile_name": "my_dbt_trino_project", "target_name": "dev", "node_id": "model.my_dbt_trino_project.src_listen_events"} */

    drop table if exists "datalake"."analytics_source"."src_listen_events__dbt_tmp"
[0m10:24:46.232239 [debug] [Thread-1 (]: SQL status: SUCCESS in 0.0 seconds
[0m10:24:46.233741 [debug] [Thread-1 (]: On model.my_dbt_trino_project.src_listen_events: ROLLBACK
[0m10:24:46.233741 [debug] [Thread-1 (]: On model.my_dbt_trino_project.src_listen_events: Close
[0m10:24:46.234745 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '60645fcd-0f0e-4258-af25-27a15a0a1a46', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000001CF15363310>]}
[0m10:24:46.234745 [info ] [Thread-1 (]: 2 of 15 OK created sql incremental model analytics_source.src_listen_events .... [[32mSUCCESS[0m in 0.85s]
[0m10:24:46.235748 [debug] [Thread-1 (]: Finished running node model.my_dbt_trino_project.src_listen_events
[0m10:24:46.236746 [debug] [Thread-1 (]: Began running node model.my_dbt_trino_project.src_page_view_events
[0m10:24:46.236746 [info ] [Thread-1 (]: 3 of 15 START sql incremental model analytics_source.src_page_view_events ...... [RUN]
[0m10:24:46.236746 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.my_dbt_trino_project.src_listen_events, now model.my_dbt_trino_project.src_page_view_events)
[0m10:24:46.238254 [debug] [Thread-1 (]: Began compiling node model.my_dbt_trino_project.src_page_view_events
[0m10:24:46.241259 [debug] [Thread-1 (]: Writing injected SQL for node "model.my_dbt_trino_project.src_page_view_events"
[0m10:24:46.241259 [debug] [Thread-1 (]: Began executing node model.my_dbt_trino_project.src_page_view_events
[0m10:24:46.247259 [debug] [Thread-1 (]: Using trino connection "model.my_dbt_trino_project.src_page_view_events"
[0m10:24:46.247259 [debug] [Thread-1 (]: On model.my_dbt_trino_project.src_page_view_events: /* {"app": "dbt", "dbt_version": "1.8.2", "profile_name": "my_dbt_trino_project", "target_name": "dev", "node_id": "model.my_dbt_trino_project.src_page_view_events"} */

  
    

    create table "datalake"."analytics_source"."src_page_view_events__dbt_tmp"
      
      
    as (
      

with source as (
    select
        CAST(_id AS VARCHAR) as id,
        ts,
        CAST(sessionId AS VARCHAR) as sessionId,
        page,
        auth,
        level,
        CAST(CAST(NULLIF(itemInSession, '') AS DOUBLE) AS INTEGER) as itemInSession, 
        city,
        zip,
        state,
        userAgent,
        CAST(NULLIF(lon, '') AS double) as lon,
        CAST(NULLIF(lat, '') AS double) as lat,
        CAST(CAST(NULLIF(userId, '') AS DOUBLE) AS INTEGER) as userId, 
        lastName,
        firstName,
        gender,
        CAST(CAST(NULLIF(registration, '') AS DOUBLE) AS BIGINT) as registration, 
        artist,
        song,
        CAST(NULLIF(duration, '') AS double) as duration
    from "website"."demo"."page_view_events"
)

select * from source


    where ts > (select max(ts) from "datalake"."analytics_source"."src_page_view_events")

    )
[0m10:24:46.248260 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m10:24:46.432823 [debug] [Thread-1 (]: SQL status: SUCCESS in 0.0 seconds
[0m10:24:46.435340 [debug] [Thread-1 (]: Using trino connection "model.my_dbt_trino_project.src_page_view_events"
[0m10:24:46.436647 [debug] [Thread-1 (]: On model.my_dbt_trino_project.src_page_view_events: /* {"app": "dbt", "dbt_version": "1.8.2", "profile_name": "my_dbt_trino_project", "target_name": "dev", "node_id": "model.my_dbt_trino_project.src_page_view_events"} */

    describe "datalake"."analytics_source"."src_page_view_events__dbt_tmp"
[0m10:24:46.534720 [debug] [Thread-1 (]: SQL status: SUCCESS in 0.0 seconds
[0m10:24:46.538235 [debug] [Thread-1 (]: Using trino connection "model.my_dbt_trino_project.src_page_view_events"
[0m10:24:46.538773 [debug] [Thread-1 (]: On model.my_dbt_trino_project.src_page_view_events: /* {"app": "dbt", "dbt_version": "1.8.2", "profile_name": "my_dbt_trino_project", "target_name": "dev", "node_id": "model.my_dbt_trino_project.src_page_view_events"} */

    describe "datalake"."analytics_source"."src_page_view_events"
[0m10:24:46.644786 [debug] [Thread-1 (]: SQL status: SUCCESS in 0.0 seconds
[0m10:24:46.647301 [debug] [Thread-1 (]: Using trino connection "model.my_dbt_trino_project.src_page_view_events"
[0m10:24:46.648301 [debug] [Thread-1 (]: On model.my_dbt_trino_project.src_page_view_events: /* {"app": "dbt", "dbt_version": "1.8.2", "profile_name": "my_dbt_trino_project", "target_name": "dev", "node_id": "model.my_dbt_trino_project.src_page_view_events"} */

    describe "datalake"."analytics_source"."src_page_view_events"
[0m10:24:46.740883 [debug] [Thread-1 (]: SQL status: SUCCESS in 0.0 seconds
[0m10:24:46.742881 [debug] [Thread-1 (]: Writing runtime sql for node "model.my_dbt_trino_project.src_page_view_events"
[0m10:24:46.744880 [debug] [Thread-1 (]: Using trino connection "model.my_dbt_trino_project.src_page_view_events"
[0m10:24:46.745390 [debug] [Thread-1 (]: On model.my_dbt_trino_project.src_page_view_events: /* {"app": "dbt", "dbt_version": "1.8.2", "profile_name": "my_dbt_trino_project", "target_name": "dev", "node_id": "model.my_dbt_trino_project.src_page_view_events"} */
insert into "datalake"."analytics_source"."src_page_view_events" ("id", "ts", "sessionid", "page", "auth", "level", "iteminsession", "city", "zip", "state", "useragent", "lon", "lat", "userid", "lastname", "firstname", "gender", "registration", "artist", "song", "duration")
    (
        select "id", "ts", "sessionid", "page", "auth", "level", "iteminsession", "city", "zip", "state", "useragent", "lon", "lat", "userid", "lastname", "firstname", "gender", "registration", "artist", "song", "duration"
        from "datalake"."analytics_source"."src_page_view_events__dbt_tmp"
    )
[0m10:24:46.896864 [debug] [Thread-1 (]: SQL status: SUCCESS in 0.0 seconds
[0m10:24:46.900924 [debug] [Thread-1 (]: Applying DROP to: "datalake"."analytics_source"."src_page_view_events__dbt_tmp"
[0m10:24:46.901931 [debug] [Thread-1 (]: Using trino connection "model.my_dbt_trino_project.src_page_view_events"
[0m10:24:46.902939 [debug] [Thread-1 (]: On model.my_dbt_trino_project.src_page_view_events: /* {"app": "dbt", "dbt_version": "1.8.2", "profile_name": "my_dbt_trino_project", "target_name": "dev", "node_id": "model.my_dbt_trino_project.src_page_view_events"} */

    drop table if exists "datalake"."analytics_source"."src_page_view_events__dbt_tmp"
[0m10:24:47.005247 [debug] [Thread-1 (]: SQL status: SUCCESS in 0.0 seconds
[0m10:24:47.006755 [debug] [Thread-1 (]: On model.my_dbt_trino_project.src_page_view_events: ROLLBACK
[0m10:24:47.006755 [debug] [Thread-1 (]: On model.my_dbt_trino_project.src_page_view_events: Close
[0m10:24:47.007766 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '60645fcd-0f0e-4258-af25-27a15a0a1a46', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000001CF15876110>]}
[0m10:24:47.007766 [info ] [Thread-1 (]: 3 of 15 OK created sql incremental model analytics_source.src_page_view_events . [[32mSUCCESS[0m in 0.77s]
[0m10:24:47.008764 [debug] [Thread-1 (]: Finished running node model.my_dbt_trino_project.src_page_view_events
[0m10:24:47.008764 [debug] [Thread-1 (]: Began running node model.my_dbt_trino_project.stg_user_level_by_gender
[0m10:24:47.009765 [info ] [Thread-1 (]: 4 of 15 START sql view model analytics_stage.stg_user_level_by_gender .......... [RUN]
[0m10:24:47.010765 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.my_dbt_trino_project.src_page_view_events, now model.my_dbt_trino_project.stg_user_level_by_gender)
[0m10:24:47.010765 [debug] [Thread-1 (]: Began compiling node model.my_dbt_trino_project.stg_user_level_by_gender
[0m10:24:47.013647 [debug] [Thread-1 (]: Writing injected SQL for node "model.my_dbt_trino_project.stg_user_level_by_gender"
[0m10:24:47.013647 [debug] [Thread-1 (]: Began executing node model.my_dbt_trino_project.stg_user_level_by_gender
[0m10:24:47.029212 [debug] [Thread-1 (]: Writing runtime sql for node "model.my_dbt_trino_project.stg_user_level_by_gender"
[0m10:24:47.031212 [debug] [Thread-1 (]: Using trino connection "model.my_dbt_trino_project.stg_user_level_by_gender"
[0m10:24:47.031212 [debug] [Thread-1 (]: On model.my_dbt_trino_project.stg_user_level_by_gender: /* {"app": "dbt", "dbt_version": "1.8.2", "profile_name": "my_dbt_trino_project", "target_name": "dev", "node_id": "model.my_dbt_trino_project.stg_user_level_by_gender"} */

  create or replace view
    "datalake"."analytics_stage"."stg_user_level_by_gender"
  security definer
  as
    

WITH user_subscriptions AS (
    SELECT
        gender,
        level, 
        COUNT(DISTINCT userId) AS user_count
    FROM "datalake"."analytics_source"."src_auth_events"
    WHERE gender IS NOT NULL AND level IS NOT NULL
    GROUP BY gender, level
)

SELECT
    gender,
    level,
    user_count
FROM user_subscriptions
  
[0m10:24:47.031212 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m10:24:47.098344 [debug] [Thread-1 (]: SQL status: SUCCESS in 0.0 seconds
[0m10:24:47.100353 [debug] [Thread-1 (]: On model.my_dbt_trino_project.stg_user_level_by_gender: ROLLBACK
[0m10:24:47.101351 [debug] [Thread-1 (]: On model.my_dbt_trino_project.stg_user_level_by_gender: Close
[0m10:24:47.102351 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '60645fcd-0f0e-4258-af25-27a15a0a1a46', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000001CF157F9210>]}
[0m10:24:47.102351 [info ] [Thread-1 (]: 4 of 15 OK created sql view model analytics_stage.stg_user_level_by_gender ..... [[32mSUCCESS[0m in 0.09s]
[0m10:24:47.103351 [debug] [Thread-1 (]: Finished running node model.my_dbt_trino_project.stg_user_level_by_gender
[0m10:24:47.103351 [debug] [Thread-1 (]: Began running node model.my_dbt_trino_project.stg_streams_hourly
[0m10:24:47.104720 [info ] [Thread-1 (]: 5 of 15 START sql table model analytics_stage.stg_streams_hourly ............... [RUN]
[0m10:24:47.105726 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.my_dbt_trino_project.stg_user_level_by_gender, now model.my_dbt_trino_project.stg_streams_hourly)
[0m10:24:47.105726 [debug] [Thread-1 (]: Began compiling node model.my_dbt_trino_project.stg_streams_hourly
[0m10:24:47.109243 [debug] [Thread-1 (]: Writing injected SQL for node "model.my_dbt_trino_project.stg_streams_hourly"
[0m10:24:47.110245 [debug] [Thread-1 (]: Began executing node model.my_dbt_trino_project.stg_streams_hourly
[0m10:24:47.113702 [debug] [Thread-1 (]: Writing runtime sql for node "model.my_dbt_trino_project.stg_streams_hourly"
[0m10:24:47.115131 [debug] [Thread-1 (]: Using trino connection "model.my_dbt_trino_project.stg_streams_hourly"
[0m10:24:47.115860 [debug] [Thread-1 (]: On model.my_dbt_trino_project.stg_streams_hourly: /* {"app": "dbt", "dbt_version": "1.8.2", "profile_name": "my_dbt_trino_project", "target_name": "dev", "node_id": "model.my_dbt_trino_project.stg_streams_hourly"} */

  
    

    create table "datalake"."analytics_stage"."stg_streams_hourly__dbt_tmp"
      
      
    as (
      

SELECT
    DATE_FORMAT(FROM_UNIXTIME(ts), '%Y-%m-%d') AS stream_date, 
    DATE_FORMAT(FROM_UNIXTIME(ts), '%H') AS stream_hour,
    COUNT(*) AS total_streams
FROM "datalake"."analytics_source"."src_listen_events"
GROUP BY
    DATE_FORMAT(FROM_UNIXTIME(ts), '%Y-%m-%d'),
    DATE_FORMAT(FROM_UNIXTIME(ts), '%H')
    )
[0m10:24:47.115860 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m10:24:47.353401 [debug] [Thread-1 (]: SQL status: SUCCESS in 0.0 seconds
[0m10:24:47.356399 [debug] [Thread-1 (]: Using trino connection "model.my_dbt_trino_project.stg_streams_hourly"
[0m10:24:47.356399 [debug] [Thread-1 (]: On model.my_dbt_trino_project.stg_streams_hourly: /* {"app": "dbt", "dbt_version": "1.8.2", "profile_name": "my_dbt_trino_project", "target_name": "dev", "node_id": "model.my_dbt_trino_project.stg_streams_hourly"} */
alter table "datalake"."analytics_stage"."stg_streams_hourly" rename to "datalake"."analytics_stage"."stg_streams_hourly__dbt_backup"
[0m10:24:47.457134 [debug] [Thread-1 (]: SQL status: SUCCESS in 0.0 seconds
[0m10:24:47.460135 [debug] [Thread-1 (]: Using trino connection "model.my_dbt_trino_project.stg_streams_hourly"
[0m10:24:47.460135 [debug] [Thread-1 (]: On model.my_dbt_trino_project.stg_streams_hourly: /* {"app": "dbt", "dbt_version": "1.8.2", "profile_name": "my_dbt_trino_project", "target_name": "dev", "node_id": "model.my_dbt_trino_project.stg_streams_hourly"} */
alter table "datalake"."analytics_stage"."stg_streams_hourly__dbt_tmp" rename to "datalake"."analytics_stage"."stg_streams_hourly"
[0m10:24:47.551627 [debug] [Thread-1 (]: SQL status: SUCCESS in 0.0 seconds
[0m10:24:47.554624 [debug] [Thread-1 (]: Applying DROP to: "datalake"."analytics_stage"."stg_streams_hourly__dbt_backup"
[0m10:24:47.555624 [debug] [Thread-1 (]: Using trino connection "model.my_dbt_trino_project.stg_streams_hourly"
[0m10:24:47.555624 [debug] [Thread-1 (]: On model.my_dbt_trino_project.stg_streams_hourly: /* {"app": "dbt", "dbt_version": "1.8.2", "profile_name": "my_dbt_trino_project", "target_name": "dev", "node_id": "model.my_dbt_trino_project.stg_streams_hourly"} */

    drop table if exists "datalake"."analytics_stage"."stg_streams_hourly__dbt_backup"
[0m10:24:47.693840 [debug] [Thread-1 (]: SQL status: SUCCESS in 0.0 seconds
[0m10:24:47.694839 [debug] [Thread-1 (]: On model.my_dbt_trino_project.stg_streams_hourly: ROLLBACK
[0m10:24:47.695988 [debug] [Thread-1 (]: On model.my_dbt_trino_project.stg_streams_hourly: Close
[0m10:24:47.695988 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '60645fcd-0f0e-4258-af25-27a15a0a1a46', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000001CF16C41810>]}
[0m10:24:47.696839 [info ] [Thread-1 (]: 5 of 15 OK created sql table model analytics_stage.stg_streams_hourly .......... [[32mSUCCESS[0m in 0.59s]
[0m10:24:47.697841 [debug] [Thread-1 (]: Finished running node model.my_dbt_trino_project.stg_streams_hourly
[0m10:24:47.698345 [debug] [Thread-1 (]: Began running node model.my_dbt_trino_project.stg_top_songs_artists
[0m10:24:47.698345 [info ] [Thread-1 (]: 6 of 15 START sql view model analytics_stage.stg_top_songs_artists ............. [RUN]
[0m10:24:47.699351 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.my_dbt_trino_project.stg_streams_hourly, now model.my_dbt_trino_project.stg_top_songs_artists)
[0m10:24:47.699881 [debug] [Thread-1 (]: Began compiling node model.my_dbt_trino_project.stg_top_songs_artists
[0m10:24:47.701888 [debug] [Thread-1 (]: Writing injected SQL for node "model.my_dbt_trino_project.stg_top_songs_artists"
[0m10:24:47.702888 [debug] [Thread-1 (]: Began executing node model.my_dbt_trino_project.stg_top_songs_artists
[0m10:24:47.706401 [debug] [Thread-1 (]: Writing runtime sql for node "model.my_dbt_trino_project.stg_top_songs_artists"
[0m10:24:47.707400 [debug] [Thread-1 (]: Using trino connection "model.my_dbt_trino_project.stg_top_songs_artists"
[0m10:24:47.707400 [debug] [Thread-1 (]: On model.my_dbt_trino_project.stg_top_songs_artists: /* {"app": "dbt", "dbt_version": "1.8.2", "profile_name": "my_dbt_trino_project", "target_name": "dev", "node_id": "model.my_dbt_trino_project.stg_top_songs_artists"} */

  create or replace view
    "datalake"."analytics_stage"."stg_top_songs_artists"
  security definer
  as
    

WITH song_plays AS (
    SELECT
        artist,
        song,
        COUNT(*) AS play_count
    FROM "datalake"."analytics_source"."src_listen_events"
    GROUP BY artist, song
)

SELECT
    artist,
    song,
    play_count
FROM song_plays
ORDER BY play_count DESC
  
[0m10:24:47.708398 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m10:24:47.766502 [debug] [Thread-1 (]: SQL status: SUCCESS in 0.0 seconds
[0m10:24:47.768503 [debug] [Thread-1 (]: On model.my_dbt_trino_project.stg_top_songs_artists: ROLLBACK
[0m10:24:47.768503 [debug] [Thread-1 (]: On model.my_dbt_trino_project.stg_top_songs_artists: Close
[0m10:24:47.769503 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '60645fcd-0f0e-4258-af25-27a15a0a1a46', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000001CF17042550>]}
[0m10:24:47.769503 [info ] [Thread-1 (]: 6 of 15 OK created sql view model analytics_stage.stg_top_songs_artists ........ [[32mSUCCESS[0m in 0.07s]
[0m10:24:47.770503 [debug] [Thread-1 (]: Finished running node model.my_dbt_trino_project.stg_top_songs_artists
[0m10:24:47.770503 [debug] [Thread-1 (]: Began running node model.my_dbt_trino_project.stg_unique_users
[0m10:24:47.771535 [info ] [Thread-1 (]: 7 of 15 START sql view model analytics_stage.stg_unique_users .................. [RUN]
[0m10:24:47.771535 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.my_dbt_trino_project.stg_top_songs_artists, now model.my_dbt_trino_project.stg_unique_users)
[0m10:24:47.772534 [debug] [Thread-1 (]: Began compiling node model.my_dbt_trino_project.stg_unique_users
[0m10:24:47.775535 [debug] [Thread-1 (]: Writing injected SQL for node "model.my_dbt_trino_project.stg_unique_users"
[0m10:24:47.775535 [debug] [Thread-1 (]: Began executing node model.my_dbt_trino_project.stg_unique_users
[0m10:24:47.779052 [debug] [Thread-1 (]: Writing runtime sql for node "model.my_dbt_trino_project.stg_unique_users"
[0m10:24:47.781051 [debug] [Thread-1 (]: Using trino connection "model.my_dbt_trino_project.stg_unique_users"
[0m10:24:47.781051 [debug] [Thread-1 (]: On model.my_dbt_trino_project.stg_unique_users: /* {"app": "dbt", "dbt_version": "1.8.2", "profile_name": "my_dbt_trino_project", "target_name": "dev", "node_id": "model.my_dbt_trino_project.stg_unique_users"} */

  create or replace view
    "datalake"."analytics_stage"."stg_unique_users"
  security definer
  as
    

SELECT
    COUNT(DISTINCT userid) AS total_unique_users
FROM "datalake"."analytics_source"."src_listen_events"
WHERE userid IS NOT NULL
  
[0m10:24:47.781051 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m10:24:47.853351 [debug] [Thread-1 (]: SQL status: SUCCESS in 0.0 seconds
[0m10:24:47.855360 [debug] [Thread-1 (]: On model.my_dbt_trino_project.stg_unique_users: ROLLBACK
[0m10:24:47.855360 [debug] [Thread-1 (]: On model.my_dbt_trino_project.stg_unique_users: Close
[0m10:24:47.856356 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '60645fcd-0f0e-4258-af25-27a15a0a1a46', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000001CF17040810>]}
[0m10:24:47.856356 [info ] [Thread-1 (]: 7 of 15 OK created sql view model analytics_stage.stg_unique_users ............. [[32mSUCCESS[0m in 0.08s]
[0m10:24:47.857659 [debug] [Thread-1 (]: Finished running node model.my_dbt_trino_project.stg_unique_users
[0m10:24:47.857659 [debug] [Thread-1 (]: Began running node model.my_dbt_trino_project.stg_user_activity_per_country
[0m10:24:47.858664 [info ] [Thread-1 (]: 8 of 15 START sql view model analytics_stage.stg_user_activity_per_country ..... [RUN]
[0m10:24:47.859664 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.my_dbt_trino_project.stg_unique_users, now model.my_dbt_trino_project.stg_user_activity_per_country)
[0m10:24:47.859664 [debug] [Thread-1 (]: Began compiling node model.my_dbt_trino_project.stg_user_activity_per_country
[0m10:24:47.862669 [debug] [Thread-1 (]: Writing injected SQL for node "model.my_dbt_trino_project.stg_user_activity_per_country"
[0m10:24:47.862669 [debug] [Thread-1 (]: Began executing node model.my_dbt_trino_project.stg_user_activity_per_country
[0m10:24:47.865668 [debug] [Thread-1 (]: Writing runtime sql for node "model.my_dbt_trino_project.stg_user_activity_per_country"
[0m10:24:47.866669 [debug] [Thread-1 (]: Using trino connection "model.my_dbt_trino_project.stg_user_activity_per_country"
[0m10:24:47.867670 [debug] [Thread-1 (]: On model.my_dbt_trino_project.stg_user_activity_per_country: /* {"app": "dbt", "dbt_version": "1.8.2", "profile_name": "my_dbt_trino_project", "target_name": "dev", "node_id": "model.my_dbt_trino_project.stg_user_activity_per_country"} */

  create or replace view
    "datalake"."analytics_stage"."stg_user_activity_per_country"
  security definer
  as
    

WITH combined_activities AS (
  SELECT
    country,
    'listen_event' AS event_type,
    ts,
    userid
  FROM "datalake"."analytics_source"."src_listen_events"
  WHERE country IS NOT NULL
  UNION ALL
  SELECT
    'Unknown' AS country, 
    ts,
    userid
  FROM "datalake"."analytics_source"."src_auth_events"
  UNION ALL
  SELECT
    'Unknown' AS country, 
    'page_view_event' AS event_type,
    ts,
    userid
  FROM "datalake"."analytics_source"."src_page_view_events"
)

SELECT
  country,
  COUNT(*) AS activity_count
FROM combined_activities
GROUP BY country
  
[0m10:24:47.867670 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m10:24:47.921465 [debug] [Thread-1 (]: Trino adapter: Trino query id: 20240619_022447_00115_uxt54
[0m10:24:47.921465 [debug] [Thread-1 (]: Trino adapter: Trino error: TrinoUserError(type=USER_ERROR, name=TYPE_MISMATCH, message="line 17:3: UNION query has different number of fields: 4, 3", query_id=20240619_022447_00115_uxt54)
[0m10:24:47.921465 [debug] [Thread-1 (]: On model.my_dbt_trino_project.stg_user_activity_per_country: ROLLBACK
[0m10:24:47.922469 [debug] [Thread-1 (]: On model.my_dbt_trino_project.stg_user_activity_per_country: Close
[0m10:24:47.926523 [debug] [Thread-1 (]: Database Error in model stg_user_activity_per_country (models\stage\stg_user_activity_per_country.sql)
  TrinoUserError(type=USER_ERROR, name=TYPE_MISMATCH, message="line 17:3: UNION query has different number of fields: 4, 3", query_id=20240619_022447_00115_uxt54)
  compiled Code at target\run\my_dbt_trino_project\models\stage\stg_user_activity_per_country.sql
[0m10:24:47.927048 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '60645fcd-0f0e-4258-af25-27a15a0a1a46', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000001CF1213FAD0>]}
[0m10:24:47.927575 [error] [Thread-1 (]: 8 of 15 ERROR creating sql view model analytics_stage.stg_user_activity_per_country  [[31mERROR[0m in 0.07s]
[0m10:24:47.928094 [debug] [Thread-1 (]: Finished running node model.my_dbt_trino_project.stg_user_activity_per_country
[0m10:24:47.928626 [debug] [Thread-1 (]: Began running node model.my_dbt_trino_project.stg_user_activity_per_location
[0m10:24:47.929150 [info ] [Thread-1 (]: 9 of 15 START sql view model analytics_stage.stg_user_activity_per_location .... [RUN]
[0m10:24:47.930206 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.my_dbt_trino_project.stg_user_activity_per_country, now model.my_dbt_trino_project.stg_user_activity_per_location)
[0m10:24:47.930206 [debug] [Thread-1 (]: Began compiling node model.my_dbt_trino_project.stg_user_activity_per_location
[0m10:24:47.933411 [debug] [Thread-1 (]: Writing injected SQL for node "model.my_dbt_trino_project.stg_user_activity_per_location"
[0m10:24:47.934466 [debug] [Thread-1 (]: Began executing node model.my_dbt_trino_project.stg_user_activity_per_location
[0m10:24:47.937104 [debug] [Thread-1 (]: Writing runtime sql for node "model.my_dbt_trino_project.stg_user_activity_per_location"
[0m10:24:47.939221 [debug] [Thread-1 (]: Using trino connection "model.my_dbt_trino_project.stg_user_activity_per_location"
[0m10:24:47.939749 [debug] [Thread-1 (]: On model.my_dbt_trino_project.stg_user_activity_per_location: /* {"app": "dbt", "dbt_version": "1.8.2", "profile_name": "my_dbt_trino_project", "target_name": "dev", "node_id": "model.my_dbt_trino_project.stg_user_activity_per_location"} */

  create or replace view
    "datalake"."analytics_stage"."stg_user_activity_per_location"
  security definer
  as
    

WITH combined_activities AS (
  SELECT
    city,
    state,
    'auth_event' AS event_type,
    ts,
    userid
 FROM "datalake"."analytics_source"."src_auth_events"
  UNION ALL
  SELECT
    city,
    state,
    'listen_event' AS event_type,
    ts,
    userid
  FROM "datalake"."analytics_source"."src_listen_events"
  UNION ALL
  SELECT
    city,
    state,
    'page_view_event' AS event_type,
    ts,
    userid
  FROM "datalake"."analytics_source"."src_page_view_events"
)

SELECT
  state,
  city,
  COUNT(*) AS activity_count
FROM combined_activities
GROUP BY state, city
  
[0m10:24:47.940277 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m10:24:48.036565 [debug] [Thread-1 (]: SQL status: SUCCESS in 0.0 seconds
[0m10:24:48.037568 [debug] [Thread-1 (]: On model.my_dbt_trino_project.stg_user_activity_per_location: ROLLBACK
[0m10:24:48.038565 [debug] [Thread-1 (]: On model.my_dbt_trino_project.stg_user_activity_per_location: Close
[0m10:24:48.038565 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '60645fcd-0f0e-4258-af25-27a15a0a1a46', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000001CF154C8590>]}
[0m10:24:48.038565 [info ] [Thread-1 (]: 9 of 15 OK created sql view model analytics_stage.stg_user_activity_per_location  [[32mSUCCESS[0m in 0.11s]
[0m10:24:48.039828 [debug] [Thread-1 (]: Finished running node model.my_dbt_trino_project.stg_user_activity_per_location
[0m10:24:48.040834 [debug] [Thread-1 (]: Began running node model.my_dbt_trino_project.mart_user_level_by_gender
[0m10:24:48.041371 [info ] [Thread-1 (]: 10 of 15 START sql table model analytics.mart_user_level_by_gender ............. [RUN]
[0m10:24:48.041878 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.my_dbt_trino_project.stg_user_activity_per_location, now model.my_dbt_trino_project.mart_user_level_by_gender)
[0m10:24:48.041878 [debug] [Thread-1 (]: Began compiling node model.my_dbt_trino_project.mart_user_level_by_gender
[0m10:24:48.045334 [debug] [Thread-1 (]: Writing injected SQL for node "model.my_dbt_trino_project.mart_user_level_by_gender"
[0m10:24:48.045846 [debug] [Thread-1 (]: Began executing node model.my_dbt_trino_project.mart_user_level_by_gender
[0m10:24:48.048440 [debug] [Thread-1 (]: Writing runtime sql for node "model.my_dbt_trino_project.mart_user_level_by_gender"
[0m10:24:48.051539 [debug] [Thread-1 (]: Using trino connection "model.my_dbt_trino_project.mart_user_level_by_gender"
[0m10:24:48.052053 [debug] [Thread-1 (]: On model.my_dbt_trino_project.mart_user_level_by_gender: /* {"app": "dbt", "dbt_version": "1.8.2", "profile_name": "my_dbt_trino_project", "target_name": "dev", "node_id": "model.my_dbt_trino_project.mart_user_level_by_gender"} */

  
    

    create table "datalake"."analytics"."mart_user_level_by_gender__dbt_tmp"
      
      
    as (
      

SELECT
    gender,
    level,
    SUM(user_count) AS total_users,
    ROUND(SUM(user_count) * 100.0 / SUM(SUM(user_count)) OVER (), 2) AS percentage_of_total_users
FROM "datalake"."analytics_stage"."stg_user_level_by_gender"
GROUP BY gender, level
    )
[0m10:24:48.052053 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m10:24:48.364768 [debug] [Thread-1 (]: SQL status: SUCCESS in 0.0 seconds
[0m10:24:48.367777 [debug] [Thread-1 (]: Using trino connection "model.my_dbt_trino_project.mart_user_level_by_gender"
[0m10:24:48.367777 [debug] [Thread-1 (]: On model.my_dbt_trino_project.mart_user_level_by_gender: /* {"app": "dbt", "dbt_version": "1.8.2", "profile_name": "my_dbt_trino_project", "target_name": "dev", "node_id": "model.my_dbt_trino_project.mart_user_level_by_gender"} */
alter table "datalake"."analytics"."mart_user_level_by_gender" rename to "datalake"."analytics"."mart_user_level_by_gender__dbt_backup"
[0m10:24:48.465823 [debug] [Thread-1 (]: SQL status: SUCCESS in 0.0 seconds
[0m10:24:48.468331 [debug] [Thread-1 (]: Using trino connection "model.my_dbt_trino_project.mart_user_level_by_gender"
[0m10:24:48.468331 [debug] [Thread-1 (]: On model.my_dbt_trino_project.mart_user_level_by_gender: /* {"app": "dbt", "dbt_version": "1.8.2", "profile_name": "my_dbt_trino_project", "target_name": "dev", "node_id": "model.my_dbt_trino_project.mart_user_level_by_gender"} */
alter table "datalake"."analytics"."mart_user_level_by_gender__dbt_tmp" rename to "datalake"."analytics"."mart_user_level_by_gender"
[0m10:24:48.563604 [debug] [Thread-1 (]: SQL status: SUCCESS in 0.0 seconds
[0m10:24:48.566614 [debug] [Thread-1 (]: Applying DROP to: "datalake"."analytics"."mart_user_level_by_gender__dbt_backup"
[0m10:24:48.567614 [debug] [Thread-1 (]: Using trino connection "model.my_dbt_trino_project.mart_user_level_by_gender"
[0m10:24:48.567614 [debug] [Thread-1 (]: On model.my_dbt_trino_project.mart_user_level_by_gender: /* {"app": "dbt", "dbt_version": "1.8.2", "profile_name": "my_dbt_trino_project", "target_name": "dev", "node_id": "model.my_dbt_trino_project.mart_user_level_by_gender"} */

    drop table if exists "datalake"."analytics"."mart_user_level_by_gender__dbt_backup"
[0m10:24:48.692857 [debug] [Thread-1 (]: SQL status: SUCCESS in 0.0 seconds
[0m10:24:48.693867 [debug] [Thread-1 (]: On model.my_dbt_trino_project.mart_user_level_by_gender: ROLLBACK
[0m10:24:48.694917 [debug] [Thread-1 (]: On model.my_dbt_trino_project.mart_user_level_by_gender: Close
[0m10:24:48.694917 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '60645fcd-0f0e-4258-af25-27a15a0a1a46', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000001CF1582D410>]}
[0m10:24:48.694917 [info ] [Thread-1 (]: 10 of 15 OK created sql table model analytics.mart_user_level_by_gender ........ [[32mSUCCESS[0m in 0.65s]
[0m10:24:48.696057 [debug] [Thread-1 (]: Finished running node model.my_dbt_trino_project.mart_user_level_by_gender
[0m10:24:48.697061 [debug] [Thread-1 (]: Began running node model.my_dbt_trino_project.mart_hourly_stream_evolution
[0m10:24:48.697061 [info ] [Thread-1 (]: 11 of 15 START sql table model analytics.mart_hourly_stream_evolution .......... [RUN]
[0m10:24:48.697061 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.my_dbt_trino_project.mart_user_level_by_gender, now model.my_dbt_trino_project.mart_hourly_stream_evolution)
[0m10:24:48.698569 [debug] [Thread-1 (]: Began compiling node model.my_dbt_trino_project.mart_hourly_stream_evolution
[0m10:24:48.701574 [debug] [Thread-1 (]: Writing injected SQL for node "model.my_dbt_trino_project.mart_hourly_stream_evolution"
[0m10:24:48.701574 [debug] [Thread-1 (]: Began executing node model.my_dbt_trino_project.mart_hourly_stream_evolution
[0m10:24:48.705574 [debug] [Thread-1 (]: Writing runtime sql for node "model.my_dbt_trino_project.mart_hourly_stream_evolution"
[0m10:24:48.706577 [debug] [Thread-1 (]: Using trino connection "model.my_dbt_trino_project.mart_hourly_stream_evolution"
[0m10:24:48.707575 [debug] [Thread-1 (]: On model.my_dbt_trino_project.mart_hourly_stream_evolution: /* {"app": "dbt", "dbt_version": "1.8.2", "profile_name": "my_dbt_trino_project", "target_name": "dev", "node_id": "model.my_dbt_trino_project.mart_hourly_stream_evolution"} */

  
    

    create table "datalake"."analytics"."mart_hourly_stream_evolution__dbt_tmp"
      
      
    as (
      

SELECT
    stream_date,
    stream_hour,
    total_streams,
    SUM(total_streams) OVER (PARTITION BY stream_date ORDER BY stream_hour) AS cumulative_streams
FROM "datalake"."analytics_stage"."stg_streams_hourly"
ORDER BY
    stream_date,
    stream_hour
    )
[0m10:24:48.707575 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m10:24:48.952761 [debug] [Thread-1 (]: SQL status: SUCCESS in 0.0 seconds
[0m10:24:48.955760 [debug] [Thread-1 (]: Using trino connection "model.my_dbt_trino_project.mart_hourly_stream_evolution"
[0m10:24:48.955760 [debug] [Thread-1 (]: On model.my_dbt_trino_project.mart_hourly_stream_evolution: /* {"app": "dbt", "dbt_version": "1.8.2", "profile_name": "my_dbt_trino_project", "target_name": "dev", "node_id": "model.my_dbt_trino_project.mart_hourly_stream_evolution"} */
alter table "datalake"."analytics"."mart_hourly_stream_evolution" rename to "datalake"."analytics"."mart_hourly_stream_evolution__dbt_backup"
[0m10:24:49.042911 [debug] [Thread-1 (]: SQL status: SUCCESS in 0.0 seconds
[0m10:24:49.045427 [debug] [Thread-1 (]: Using trino connection "model.my_dbt_trino_project.mart_hourly_stream_evolution"
[0m10:24:49.045427 [debug] [Thread-1 (]: On model.my_dbt_trino_project.mart_hourly_stream_evolution: /* {"app": "dbt", "dbt_version": "1.8.2", "profile_name": "my_dbt_trino_project", "target_name": "dev", "node_id": "model.my_dbt_trino_project.mart_hourly_stream_evolution"} */
alter table "datalake"."analytics"."mart_hourly_stream_evolution__dbt_tmp" rename to "datalake"."analytics"."mart_hourly_stream_evolution"
[0m10:24:49.133867 [debug] [Thread-1 (]: SQL status: SUCCESS in 0.0 seconds
[0m10:24:49.136867 [debug] [Thread-1 (]: Applying DROP to: "datalake"."analytics"."mart_hourly_stream_evolution__dbt_backup"
[0m10:24:49.137870 [debug] [Thread-1 (]: Using trino connection "model.my_dbt_trino_project.mart_hourly_stream_evolution"
[0m10:24:49.137870 [debug] [Thread-1 (]: On model.my_dbt_trino_project.mart_hourly_stream_evolution: /* {"app": "dbt", "dbt_version": "1.8.2", "profile_name": "my_dbt_trino_project", "target_name": "dev", "node_id": "model.my_dbt_trino_project.mart_hourly_stream_evolution"} */

    drop table if exists "datalake"."analytics"."mart_hourly_stream_evolution__dbt_backup"
[0m10:24:49.267521 [debug] [Thread-1 (]: SQL status: SUCCESS in 0.0 seconds
[0m10:24:49.268522 [debug] [Thread-1 (]: On model.my_dbt_trino_project.mart_hourly_stream_evolution: ROLLBACK
[0m10:24:49.269531 [debug] [Thread-1 (]: On model.my_dbt_trino_project.mart_hourly_stream_evolution: Close
[0m10:24:49.269531 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '60645fcd-0f0e-4258-af25-27a15a0a1a46', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000001CF1213FAD0>]}
[0m10:24:49.269531 [info ] [Thread-1 (]: 11 of 15 OK created sql table model analytics.mart_hourly_stream_evolution ..... [[32mSUCCESS[0m in 0.57s]
[0m10:24:49.270839 [debug] [Thread-1 (]: Finished running node model.my_dbt_trino_project.mart_hourly_stream_evolution
[0m10:24:49.271899 [debug] [Thread-1 (]: Began running node model.my_dbt_trino_project.mart_top_songs_artists
[0m10:24:49.272188 [info ] [Thread-1 (]: 12 of 15 START sql table model analytics.mart_top_songs_artists ................ [RUN]
[0m10:24:49.272910 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.my_dbt_trino_project.mart_hourly_stream_evolution, now model.my_dbt_trino_project.mart_top_songs_artists)
[0m10:24:49.272910 [debug] [Thread-1 (]: Began compiling node model.my_dbt_trino_project.mart_top_songs_artists
[0m10:24:49.275395 [debug] [Thread-1 (]: Writing injected SQL for node "model.my_dbt_trino_project.mart_top_songs_artists"
[0m10:24:49.275395 [debug] [Thread-1 (]: Began executing node model.my_dbt_trino_project.mart_top_songs_artists
[0m10:24:49.281908 [debug] [Thread-1 (]: Writing runtime sql for node "model.my_dbt_trino_project.mart_top_songs_artists"
[0m10:24:49.285904 [debug] [Thread-1 (]: Using trino connection "model.my_dbt_trino_project.mart_top_songs_artists"
[0m10:24:49.286905 [debug] [Thread-1 (]: On model.my_dbt_trino_project.mart_top_songs_artists: /* {"app": "dbt", "dbt_version": "1.8.2", "profile_name": "my_dbt_trino_project", "target_name": "dev", "node_id": "model.my_dbt_trino_project.mart_top_songs_artists"} */

  
    

    create table "datalake"."analytics"."mart_top_songs_artists__dbt_tmp"
      
      
    as (
      

WITH top_songs AS (
    SELECT
        artist,
        song,
        play_count
    FROM "datalake"."analytics_stage"."stg_top_songs_artists"
)

SELECT
    artist,
    song,
    play_count
FROM top_songs
    )
[0m10:24:49.286905 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m10:24:49.537075 [debug] [Thread-1 (]: SQL status: SUCCESS in 0.0 seconds
[0m10:24:49.540072 [debug] [Thread-1 (]: Using trino connection "model.my_dbt_trino_project.mart_top_songs_artists"
[0m10:24:49.540072 [debug] [Thread-1 (]: On model.my_dbt_trino_project.mart_top_songs_artists: /* {"app": "dbt", "dbt_version": "1.8.2", "profile_name": "my_dbt_trino_project", "target_name": "dev", "node_id": "model.my_dbt_trino_project.mart_top_songs_artists"} */
alter table "datalake"."analytics"."mart_top_songs_artists" rename to "datalake"."analytics"."mart_top_songs_artists__dbt_backup"
[0m10:24:49.631831 [debug] [Thread-1 (]: SQL status: SUCCESS in 0.0 seconds
[0m10:24:49.635467 [debug] [Thread-1 (]: Using trino connection "model.my_dbt_trino_project.mart_top_songs_artists"
[0m10:24:49.635467 [debug] [Thread-1 (]: On model.my_dbt_trino_project.mart_top_songs_artists: /* {"app": "dbt", "dbt_version": "1.8.2", "profile_name": "my_dbt_trino_project", "target_name": "dev", "node_id": "model.my_dbt_trino_project.mart_top_songs_artists"} */
alter table "datalake"."analytics"."mart_top_songs_artists__dbt_tmp" rename to "datalake"."analytics"."mart_top_songs_artists"
[0m10:24:49.735831 [debug] [Thread-1 (]: SQL status: SUCCESS in 0.0 seconds
[0m10:24:49.738347 [debug] [Thread-1 (]: Applying DROP to: "datalake"."analytics"."mart_top_songs_artists__dbt_backup"
[0m10:24:49.739347 [debug] [Thread-1 (]: Using trino connection "model.my_dbt_trino_project.mart_top_songs_artists"
[0m10:24:49.739347 [debug] [Thread-1 (]: On model.my_dbt_trino_project.mart_top_songs_artists: /* {"app": "dbt", "dbt_version": "1.8.2", "profile_name": "my_dbt_trino_project", "target_name": "dev", "node_id": "model.my_dbt_trino_project.mart_top_songs_artists"} */

    drop table if exists "datalake"."analytics"."mart_top_songs_artists__dbt_backup"
[0m10:24:49.855481 [debug] [Thread-1 (]: SQL status: SUCCESS in 0.0 seconds
[0m10:24:49.857482 [debug] [Thread-1 (]: On model.my_dbt_trino_project.mart_top_songs_artists: ROLLBACK
[0m10:24:49.857482 [debug] [Thread-1 (]: On model.my_dbt_trino_project.mart_top_songs_artists: Close
[0m10:24:49.858482 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '60645fcd-0f0e-4258-af25-27a15a0a1a46', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000001CF154F6AD0>]}
[0m10:24:49.858482 [info ] [Thread-1 (]: 12 of 15 OK created sql table model analytics.mart_top_songs_artists ........... [[32mSUCCESS[0m in 0.59s]
[0m10:24:49.859892 [debug] [Thread-1 (]: Finished running node model.my_dbt_trino_project.mart_top_songs_artists
[0m10:24:49.859892 [debug] [Thread-1 (]: Began running node model.my_dbt_trino_project.mart_total_unique_users
[0m10:24:49.860898 [info ] [Thread-1 (]: 13 of 15 START sql table model analytics.mart_total_unique_users ............... [RUN]
[0m10:24:49.860898 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.my_dbt_trino_project.mart_top_songs_artists, now model.my_dbt_trino_project.mart_total_unique_users)
[0m10:24:49.860898 [debug] [Thread-1 (]: Began compiling node model.my_dbt_trino_project.mart_total_unique_users
[0m10:24:49.864187 [debug] [Thread-1 (]: Writing injected SQL for node "model.my_dbt_trino_project.mart_total_unique_users"
[0m10:24:49.864187 [debug] [Thread-1 (]: Began executing node model.my_dbt_trino_project.mart_total_unique_users
[0m10:24:49.867187 [debug] [Thread-1 (]: Writing runtime sql for node "model.my_dbt_trino_project.mart_total_unique_users"
[0m10:24:49.868187 [debug] [Thread-1 (]: Using trino connection "model.my_dbt_trino_project.mart_total_unique_users"
[0m10:24:49.869186 [debug] [Thread-1 (]: On model.my_dbt_trino_project.mart_total_unique_users: /* {"app": "dbt", "dbt_version": "1.8.2", "profile_name": "my_dbt_trino_project", "target_name": "dev", "node_id": "model.my_dbt_trino_project.mart_total_unique_users"} */

  
    

    create table "datalake"."analytics"."mart_total_unique_users__dbt_tmp"
      
      
    as (
      

SELECT
    total_unique_users
FROM "datalake"."analytics_stage"."stg_unique_users"
    )
[0m10:24:49.869186 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m10:24:50.117269 [debug] [Thread-1 (]: SQL status: SUCCESS in 0.0 seconds
[0m10:24:50.120274 [debug] [Thread-1 (]: Using trino connection "model.my_dbt_trino_project.mart_total_unique_users"
[0m10:24:50.120274 [debug] [Thread-1 (]: On model.my_dbt_trino_project.mart_total_unique_users: /* {"app": "dbt", "dbt_version": "1.8.2", "profile_name": "my_dbt_trino_project", "target_name": "dev", "node_id": "model.my_dbt_trino_project.mart_total_unique_users"} */
alter table "datalake"."analytics"."mart_total_unique_users" rename to "datalake"."analytics"."mart_total_unique_users__dbt_backup"
[0m10:24:50.209659 [debug] [Thread-1 (]: SQL status: SUCCESS in 0.0 seconds
[0m10:24:50.213370 [debug] [Thread-1 (]: Using trino connection "model.my_dbt_trino_project.mart_total_unique_users"
[0m10:24:50.213892 [debug] [Thread-1 (]: On model.my_dbt_trino_project.mart_total_unique_users: /* {"app": "dbt", "dbt_version": "1.8.2", "profile_name": "my_dbt_trino_project", "target_name": "dev", "node_id": "model.my_dbt_trino_project.mart_total_unique_users"} */
alter table "datalake"."analytics"."mart_total_unique_users__dbt_tmp" rename to "datalake"."analytics"."mart_total_unique_users"
[0m10:24:50.308938 [debug] [Thread-1 (]: SQL status: SUCCESS in 0.0 seconds
[0m10:24:50.311938 [debug] [Thread-1 (]: Applying DROP to: "datalake"."analytics"."mart_total_unique_users__dbt_backup"
[0m10:24:50.312938 [debug] [Thread-1 (]: Using trino connection "model.my_dbt_trino_project.mart_total_unique_users"
[0m10:24:50.312938 [debug] [Thread-1 (]: On model.my_dbt_trino_project.mart_total_unique_users: /* {"app": "dbt", "dbt_version": "1.8.2", "profile_name": "my_dbt_trino_project", "target_name": "dev", "node_id": "model.my_dbt_trino_project.mart_total_unique_users"} */

    drop table if exists "datalake"."analytics"."mart_total_unique_users__dbt_backup"
[0m10:24:50.425425 [debug] [Thread-1 (]: SQL status: SUCCESS in 0.0 seconds
[0m10:24:50.427431 [debug] [Thread-1 (]: On model.my_dbt_trino_project.mart_total_unique_users: ROLLBACK
[0m10:24:50.428433 [debug] [Thread-1 (]: On model.my_dbt_trino_project.mart_total_unique_users: Close
[0m10:24:50.428433 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '60645fcd-0f0e-4258-af25-27a15a0a1a46', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000001CF16C517D0>]}
[0m10:24:50.429431 [info ] [Thread-1 (]: 13 of 15 OK created sql table model analytics.mart_total_unique_users .......... [[32mSUCCESS[0m in 0.57s]
[0m10:24:50.430430 [debug] [Thread-1 (]: Finished running node model.my_dbt_trino_project.mart_total_unique_users
[0m10:24:50.430430 [debug] [Thread-1 (]: Began running node model.my_dbt_trino_project.mart_user_activity_per_country
[0m10:24:50.430430 [info ] [Thread-1 (]: 14 of 15 SKIP relation analytics.mart_user_activity_per_country ................ [[33mSKIP[0m]
[0m10:24:50.431430 [debug] [Thread-1 (]: Finished running node model.my_dbt_trino_project.mart_user_activity_per_country
[0m10:24:50.431430 [debug] [Thread-1 (]: Began running node model.my_dbt_trino_project.mart_user_activity_per_state
[0m10:24:50.432429 [info ] [Thread-1 (]: 15 of 15 START sql table model analytics.mart_user_activity_per_state .......... [RUN]
[0m10:24:50.432429 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.my_dbt_trino_project.mart_total_unique_users, now model.my_dbt_trino_project.mart_user_activity_per_state)
[0m10:24:50.433429 [debug] [Thread-1 (]: Began compiling node model.my_dbt_trino_project.mart_user_activity_per_state
[0m10:24:50.437431 [debug] [Thread-1 (]: Writing injected SQL for node "model.my_dbt_trino_project.mart_user_activity_per_state"
[0m10:24:50.437431 [debug] [Thread-1 (]: Began executing node model.my_dbt_trino_project.mart_user_activity_per_state
[0m10:24:50.440429 [debug] [Thread-1 (]: Writing runtime sql for node "model.my_dbt_trino_project.mart_user_activity_per_state"
[0m10:24:50.441429 [debug] [Thread-1 (]: Using trino connection "model.my_dbt_trino_project.mart_user_activity_per_state"
[0m10:24:50.442429 [debug] [Thread-1 (]: On model.my_dbt_trino_project.mart_user_activity_per_state: /* {"app": "dbt", "dbt_version": "1.8.2", "profile_name": "my_dbt_trino_project", "target_name": "dev", "node_id": "model.my_dbt_trino_project.mart_user_activity_per_state"} */

  
    

    create table "datalake"."analytics"."mart_user_activity_per_state__dbt_tmp"
      
      
    as (
      

SELECT
  state,
  city,
  SUM(activity_count) AS total_activity
FROM "datalake"."analytics_stage"."stg_user_activity_per_location"
GROUP BY state, city
ORDER BY state, SUM(activity_count) DESC
    )
[0m10:24:50.442497 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m10:24:50.750873 [debug] [Thread-1 (]: SQL status: SUCCESS in 0.0 seconds
[0m10:24:50.754012 [debug] [Thread-1 (]: Using trino connection "model.my_dbt_trino_project.mart_user_activity_per_state"
[0m10:24:50.754012 [debug] [Thread-1 (]: On model.my_dbt_trino_project.mart_user_activity_per_state: /* {"app": "dbt", "dbt_version": "1.8.2", "profile_name": "my_dbt_trino_project", "target_name": "dev", "node_id": "model.my_dbt_trino_project.mart_user_activity_per_state"} */
alter table "datalake"."analytics"."mart_user_activity_per_state" rename to "datalake"."analytics"."mart_user_activity_per_state__dbt_backup"
[0m10:24:50.842771 [debug] [Thread-1 (]: SQL status: SUCCESS in 0.0 seconds
[0m10:24:50.845776 [debug] [Thread-1 (]: Using trino connection "model.my_dbt_trino_project.mart_user_activity_per_state"
[0m10:24:50.846779 [debug] [Thread-1 (]: On model.my_dbt_trino_project.mart_user_activity_per_state: /* {"app": "dbt", "dbt_version": "1.8.2", "profile_name": "my_dbt_trino_project", "target_name": "dev", "node_id": "model.my_dbt_trino_project.mart_user_activity_per_state"} */
alter table "datalake"."analytics"."mart_user_activity_per_state__dbt_tmp" rename to "datalake"."analytics"."mart_user_activity_per_state"
[0m10:24:50.950385 [debug] [Thread-1 (]: SQL status: SUCCESS in 0.0 seconds
[0m10:24:50.954294 [debug] [Thread-1 (]: Applying DROP to: "datalake"."analytics"."mart_user_activity_per_state__dbt_backup"
[0m10:24:50.954294 [debug] [Thread-1 (]: Using trino connection "model.my_dbt_trino_project.mart_user_activity_per_state"
[0m10:24:50.955738 [debug] [Thread-1 (]: On model.my_dbt_trino_project.mart_user_activity_per_state: /* {"app": "dbt", "dbt_version": "1.8.2", "profile_name": "my_dbt_trino_project", "target_name": "dev", "node_id": "model.my_dbt_trino_project.mart_user_activity_per_state"} */

    drop table if exists "datalake"."analytics"."mart_user_activity_per_state__dbt_backup"
[0m10:24:51.081446 [debug] [Thread-1 (]: SQL status: SUCCESS in 0.0 seconds
[0m10:24:51.082954 [debug] [Thread-1 (]: On model.my_dbt_trino_project.mart_user_activity_per_state: ROLLBACK
[0m10:24:51.082954 [debug] [Thread-1 (]: On model.my_dbt_trino_project.mart_user_activity_per_state: Close
[0m10:24:51.083960 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '60645fcd-0f0e-4258-af25-27a15a0a1a46', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000001CF154DF6D0>]}
[0m10:24:51.083960 [info ] [Thread-1 (]: 15 of 15 OK created sql table model analytics.mart_user_activity_per_state ..... [[32mSUCCESS[0m in 0.65s]
[0m10:24:51.085086 [debug] [Thread-1 (]: Finished running node model.my_dbt_trino_project.mart_user_activity_per_state
[0m10:24:51.085961 [debug] [MainThread]: On master: COMMIT
[0m10:24:51.085961 [debug] [MainThread]: Connection 'master' was properly closed.
[0m10:24:51.087268 [debug] [MainThread]: Connection 'list_datalake' was properly closed.
[0m10:24:51.087268 [debug] [MainThread]: Connection 'list_datalake_analytics_stage' was properly closed.
[0m10:24:51.087268 [debug] [MainThread]: Connection 'model.my_dbt_trino_project.mart_user_activity_per_state' was properly closed.
[0m10:24:51.088276 [info ] [MainThread]: 
[0m10:24:51.088276 [info ] [MainThread]: Finished running 8 table models, 2 incremental models, 5 view models in 0 hours 0 minutes and 6.84 seconds (6.84s).
[0m10:24:51.090278 [debug] [MainThread]: Command end result
[0m10:24:51.121945 [info ] [MainThread]: 
[0m10:24:51.121945 [info ] [MainThread]: [31mCompleted with 1 error and 0 warnings:[0m
[0m10:24:51.122945 [info ] [MainThread]: 
[0m10:24:51.122945 [error] [MainThread]:   Database Error in model stg_user_activity_per_country (models\stage\stg_user_activity_per_country.sql)
  TrinoUserError(type=USER_ERROR, name=TYPE_MISMATCH, message="line 17:3: UNION query has different number of fields: 4, 3", query_id=20240619_022447_00115_uxt54)
  compiled Code at target\run\my_dbt_trino_project\models\stage\stg_user_activity_per_country.sql
[0m10:24:51.123945 [info ] [MainThread]: 
[0m10:24:51.123945 [info ] [MainThread]: Done. PASS=13 WARN=0 ERROR=1 SKIP=1 TOTAL=15
[0m10:24:51.125945 [debug] [MainThread]: Command `dbt run` failed at 10:24:51.124947 after 7.74 seconds
[0m10:24:51.125945 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000001CF100CEDD0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000001CF100CEE10>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000001CF100CEF50>]}
[0m10:24:51.125945 [debug] [MainThread]: Flushing usage events
[0m10:25:04.017255 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000001A0C61151D0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000001A0C59E7DD0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000001A0C61543D0>]}


============================== 10:25:04.020304 | 6da18c64-dbb6-4246-9bde-f8c324f3a36c ==============================
[0m10:25:04.020304 [info ] [MainThread]: Running with dbt=1.8.2
[0m10:25:04.020304 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'indirect_selection': 'eager', 'log_cache_events': 'False', 'write_json': 'True', 'partial_parse': 'True', 'cache_selected_only': 'False', 'warn_error': 'None', 'fail_fast': 'False', 'debug': 'False', 'log_path': 'C:\\Users\\ASUS\\Desktop\\work\\Iceberg-Dbt-Trino-Hive-modern-open-source-data-stack-main\\dbt\\logs', 'profiles_dir': 'C:\\Users\\ASUS\\Desktop\\work\\Iceberg-Dbt-Trino-Hive-modern-open-source-data-stack-main\\dbt', 'version_check': 'True', 'use_colors': 'True', 'use_experimental_parser': 'False', 'no_print': 'None', 'quiet': 'False', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'introspect': 'True', 'invocation_command': 'dbt run --models marts', 'log_format': 'default', 'target_path': 'None', 'static_parser': 'True', 'send_anonymous_usage_stats': 'True'}
[0m10:25:04.328455 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': '6da18c64-dbb6-4246-9bde-f8c324f3a36c', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000001A0C6115F90>]}
[0m10:25:04.361966 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': '6da18c64-dbb6-4246-9bde-f8c324f3a36c', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000001A0C3285610>]}
[0m10:25:04.361966 [info ] [MainThread]: Registered adapter: trino=1.8.0
[0m10:25:04.371970 [debug] [MainThread]: checksum: f0a141b9de567cb7f131613ba2682f40b3a1c6a157f81c6e5435862eff68f109, vars: {}, profile: , target: , version: 1.8.2
[0m10:25:04.531354 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 0 files changed.
[0m10:25:04.531354 [debug] [MainThread]: Partial parsing enabled, no changes found, skipping parsing
[0m10:25:04.562355 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': '6da18c64-dbb6-4246-9bde-f8c324f3a36c', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000001A0C676A350>]}
[0m10:25:04.638869 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': '6da18c64-dbb6-4246-9bde-f8c324f3a36c', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000001A0C666BE10>]}
[0m10:25:04.639869 [info ] [MainThread]: Found 15 models, 7 data tests, 3 sources, 559 macros
[0m10:25:04.639869 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '6da18c64-dbb6-4246-9bde-f8c324f3a36c', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000001A0C62839D0>]}
[0m10:25:04.642337 [info ] [MainThread]: 
[0m10:25:04.642337 [debug] [MainThread]: Acquiring new trino connection 'master'
[0m10:25:04.647655 [debug] [ThreadPool]: Acquiring new trino connection 'list_datalake'
[0m10:25:04.701621 [debug] [ThreadPool]: Using trino connection "list_datalake"
[0m10:25:04.701621 [debug] [ThreadPool]: On list_datalake: /* {"app": "dbt", "dbt_version": "1.8.2", "profile_name": "my_dbt_trino_project", "target_name": "dev", "connection_name": "list_datalake"} */

    select schema_name
    from "datalake".INFORMATION_SCHEMA.schemata
[0m10:25:04.702623 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m10:25:04.728855 [debug] [ThreadPool]: SQL status: SUCCESS in 0.0 seconds
[0m10:25:04.729865 [debug] [ThreadPool]: On list_datalake: Close
[0m10:25:04.732248 [debug] [ThreadPool]: Acquiring new trino connection 'list_datalake_analytics_stage'
[0m10:25:04.742254 [debug] [ThreadPool]: Using trino connection "list_datalake_analytics_stage"
[0m10:25:04.743254 [debug] [ThreadPool]: On list_datalake_analytics_stage: /* {"app": "dbt", "dbt_version": "1.8.2", "profile_name": "my_dbt_trino_project", "target_name": "dev", "connection_name": "list_datalake_analytics_stage"} */
select
      t.table_catalog as database,
      t.table_name as name,
      t.table_schema as schema,
      case when mv.name is not null then 'materialized_view'
           when t.table_type = 'BASE TABLE' then 'table'
           when t.table_type = 'VIEW' then 'view'
           else t.table_type
      end as table_type
    from "datalake".INFORMATION_SCHEMA.tables t
    left join (
            select * from system.metadata.materialized_views
            where catalog_name = 'datalake'
              and schema_name = 'analytics_stage') mv
          on mv.catalog_name = t.table_catalog and mv.schema_name = t.table_schema and mv.name = t.table_name
    where t.table_schema = 'analytics_stage'
[0m10:25:04.743254 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m10:25:04.811359 [debug] [ThreadPool]: SQL status: SUCCESS in 0.0 seconds
[0m10:25:04.812708 [debug] [ThreadPool]: On list_datalake_analytics_stage: ROLLBACK
[0m10:25:04.812708 [debug] [ThreadPool]: On list_datalake_analytics_stage: Close
[0m10:25:04.813884 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_datalake_analytics_stage, now list_datalake_analytics)
[0m10:25:04.818516 [debug] [ThreadPool]: Using trino connection "list_datalake_analytics"
[0m10:25:04.818516 [debug] [ThreadPool]: On list_datalake_analytics: /* {"app": "dbt", "dbt_version": "1.8.2", "profile_name": "my_dbt_trino_project", "target_name": "dev", "connection_name": "list_datalake_analytics"} */
select
      t.table_catalog as database,
      t.table_name as name,
      t.table_schema as schema,
      case when mv.name is not null then 'materialized_view'
           when t.table_type = 'BASE TABLE' then 'table'
           when t.table_type = 'VIEW' then 'view'
           else t.table_type
      end as table_type
    from "datalake".INFORMATION_SCHEMA.tables t
    left join (
            select * from system.metadata.materialized_views
            where catalog_name = 'datalake'
              and schema_name = 'analytics') mv
          on mv.catalog_name = t.table_catalog and mv.schema_name = t.table_schema and mv.name = t.table_name
    where t.table_schema = 'analytics'
[0m10:25:04.819717 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m10:25:04.890582 [debug] [ThreadPool]: SQL status: SUCCESS in 0.0 seconds
[0m10:25:04.892079 [debug] [ThreadPool]: On list_datalake_analytics: ROLLBACK
[0m10:25:04.892079 [debug] [ThreadPool]: On list_datalake_analytics: Close
[0m10:25:04.893419 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_datalake_analytics, now list_datalake_analytics_source)
[0m10:25:04.897861 [debug] [ThreadPool]: Using trino connection "list_datalake_analytics_source"
[0m10:25:04.897861 [debug] [ThreadPool]: On list_datalake_analytics_source: /* {"app": "dbt", "dbt_version": "1.8.2", "profile_name": "my_dbt_trino_project", "target_name": "dev", "connection_name": "list_datalake_analytics_source"} */
select
      t.table_catalog as database,
      t.table_name as name,
      t.table_schema as schema,
      case when mv.name is not null then 'materialized_view'
           when t.table_type = 'BASE TABLE' then 'table'
           when t.table_type = 'VIEW' then 'view'
           else t.table_type
      end as table_type
    from "datalake".INFORMATION_SCHEMA.tables t
    left join (
            select * from system.metadata.materialized_views
            where catalog_name = 'datalake'
              and schema_name = 'analytics_source') mv
          on mv.catalog_name = t.table_catalog and mv.schema_name = t.table_schema and mv.name = t.table_name
    where t.table_schema = 'analytics_source'
[0m10:25:04.898864 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m10:25:04.948114 [debug] [ThreadPool]: SQL status: SUCCESS in 0.0 seconds
[0m10:25:04.949120 [debug] [ThreadPool]: On list_datalake_analytics_source: ROLLBACK
[0m10:25:04.949120 [debug] [ThreadPool]: On list_datalake_analytics_source: Close
[0m10:25:04.950300 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '6da18c64-dbb6-4246-9bde-f8c324f3a36c', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000001A0C7B1B590>]}
[0m10:25:04.951586 [debug] [MainThread]: On master: COMMIT
[0m10:25:04.951586 [info ] [MainThread]: Concurrency: 1 threads (target='dev')
[0m10:25:04.951586 [info ] [MainThread]: 
[0m10:25:04.955083 [debug] [Thread-1 (]: Began running node model.my_dbt_trino_project.mart_hourly_stream_evolution
[0m10:25:04.955083 [info ] [Thread-1 (]: 1 of 6 START sql table model analytics.mart_hourly_stream_evolution ............ [RUN]
[0m10:25:04.956334 [debug] [Thread-1 (]: Acquiring new trino connection 'model.my_dbt_trino_project.mart_hourly_stream_evolution'
[0m10:25:04.956334 [debug] [Thread-1 (]: Began compiling node model.my_dbt_trino_project.mart_hourly_stream_evolution
[0m10:25:04.958348 [debug] [Thread-1 (]: Writing injected SQL for node "model.my_dbt_trino_project.mart_hourly_stream_evolution"
[0m10:25:04.959834 [debug] [Thread-1 (]: Began executing node model.my_dbt_trino_project.mart_hourly_stream_evolution
[0m10:25:04.991779 [debug] [Thread-1 (]: Writing runtime sql for node "model.my_dbt_trino_project.mart_hourly_stream_evolution"
[0m10:25:04.993778 [debug] [Thread-1 (]: Using trino connection "model.my_dbt_trino_project.mart_hourly_stream_evolution"
[0m10:25:04.994782 [debug] [Thread-1 (]: On model.my_dbt_trino_project.mart_hourly_stream_evolution: /* {"app": "dbt", "dbt_version": "1.8.2", "profile_name": "my_dbt_trino_project", "target_name": "dev", "node_id": "model.my_dbt_trino_project.mart_hourly_stream_evolution"} */

  
    

    create table "datalake"."analytics"."mart_hourly_stream_evolution__dbt_tmp"
      
      
    as (
      

SELECT
    stream_date,
    stream_hour,
    total_streams,
    SUM(total_streams) OVER (PARTITION BY stream_date ORDER BY stream_hour) AS cumulative_streams
FROM "datalake"."analytics_stage"."stg_streams_hourly"
ORDER BY
    stream_date,
    stream_hour
    )
[0m10:25:04.994782 [debug] [Thread-1 (]: Opening a new connection, currently in state init
[0m10:25:05.254828 [debug] [Thread-1 (]: SQL status: SUCCESS in 0.0 seconds
[0m10:25:05.261761 [debug] [Thread-1 (]: Using trino connection "model.my_dbt_trino_project.mart_hourly_stream_evolution"
[0m10:25:05.262832 [debug] [Thread-1 (]: On model.my_dbt_trino_project.mart_hourly_stream_evolution: /* {"app": "dbt", "dbt_version": "1.8.2", "profile_name": "my_dbt_trino_project", "target_name": "dev", "node_id": "model.my_dbt_trino_project.mart_hourly_stream_evolution"} */
alter table "datalake"."analytics"."mart_hourly_stream_evolution" rename to "datalake"."analytics"."mart_hourly_stream_evolution__dbt_backup"
[0m10:25:05.356732 [debug] [Thread-1 (]: SQL status: SUCCESS in 0.0 seconds
[0m10:25:05.360931 [debug] [Thread-1 (]: Using trino connection "model.my_dbt_trino_project.mart_hourly_stream_evolution"
[0m10:25:05.361453 [debug] [Thread-1 (]: On model.my_dbt_trino_project.mart_hourly_stream_evolution: /* {"app": "dbt", "dbt_version": "1.8.2", "profile_name": "my_dbt_trino_project", "target_name": "dev", "node_id": "model.my_dbt_trino_project.mart_hourly_stream_evolution"} */
alter table "datalake"."analytics"."mart_hourly_stream_evolution__dbt_tmp" rename to "datalake"."analytics"."mart_hourly_stream_evolution"
[0m10:25:05.455761 [debug] [Thread-1 (]: SQL status: SUCCESS in 0.0 seconds
[0m10:25:05.463547 [debug] [Thread-1 (]: Applying DROP to: "datalake"."analytics"."mart_hourly_stream_evolution__dbt_backup"
[0m10:25:05.465628 [debug] [Thread-1 (]: Using trino connection "model.my_dbt_trino_project.mart_hourly_stream_evolution"
[0m10:25:05.466150 [debug] [Thread-1 (]: On model.my_dbt_trino_project.mart_hourly_stream_evolution: /* {"app": "dbt", "dbt_version": "1.8.2", "profile_name": "my_dbt_trino_project", "target_name": "dev", "node_id": "model.my_dbt_trino_project.mart_hourly_stream_evolution"} */

    drop table if exists "datalake"."analytics"."mart_hourly_stream_evolution__dbt_backup"
[0m10:25:05.606287 [debug] [Thread-1 (]: SQL status: SUCCESS in 0.0 seconds
[0m10:25:05.620303 [debug] [Thread-1 (]: On model.my_dbt_trino_project.mart_hourly_stream_evolution: ROLLBACK
[0m10:25:05.620303 [debug] [Thread-1 (]: On model.my_dbt_trino_project.mart_hourly_stream_evolution: Close
[0m10:25:05.621861 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '6da18c64-dbb6-4246-9bde-f8c324f3a36c', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000001A0C66CCF10>]}
[0m10:25:05.622397 [info ] [Thread-1 (]: 1 of 6 OK created sql table model analytics.mart_hourly_stream_evolution ....... [[32mSUCCESS[0m in 0.67s]
[0m10:25:05.623443 [debug] [Thread-1 (]: Finished running node model.my_dbt_trino_project.mart_hourly_stream_evolution
[0m10:25:05.623967 [debug] [Thread-1 (]: Began running node model.my_dbt_trino_project.mart_top_songs_artists
[0m10:25:05.624492 [info ] [Thread-1 (]: 2 of 6 START sql table model analytics.mart_top_songs_artists .................. [RUN]
[0m10:25:05.625023 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.my_dbt_trino_project.mart_hourly_stream_evolution, now model.my_dbt_trino_project.mart_top_songs_artists)
[0m10:25:05.625023 [debug] [Thread-1 (]: Began compiling node model.my_dbt_trino_project.mart_top_songs_artists
[0m10:25:05.628199 [debug] [Thread-1 (]: Writing injected SQL for node "model.my_dbt_trino_project.mart_top_songs_artists"
[0m10:25:05.629255 [debug] [Thread-1 (]: Began executing node model.my_dbt_trino_project.mart_top_songs_artists
[0m10:25:05.632392 [debug] [Thread-1 (]: Writing runtime sql for node "model.my_dbt_trino_project.mart_top_songs_artists"
[0m10:25:05.633949 [debug] [Thread-1 (]: Using trino connection "model.my_dbt_trino_project.mart_top_songs_artists"
[0m10:25:05.633949 [debug] [Thread-1 (]: On model.my_dbt_trino_project.mart_top_songs_artists: /* {"app": "dbt", "dbt_version": "1.8.2", "profile_name": "my_dbt_trino_project", "target_name": "dev", "node_id": "model.my_dbt_trino_project.mart_top_songs_artists"} */

  
    

    create table "datalake"."analytics"."mart_top_songs_artists__dbt_tmp"
      
      
    as (
      

WITH top_songs AS (
    SELECT
        artist,
        song,
        play_count
    FROM "datalake"."analytics_stage"."stg_top_songs_artists"
)

SELECT
    artist,
    song,
    play_count
FROM top_songs
    )
[0m10:25:05.634471 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m10:25:05.875070 [debug] [Thread-1 (]: SQL status: SUCCESS in 0.0 seconds
[0m10:25:05.877922 [debug] [Thread-1 (]: Using trino connection "model.my_dbt_trino_project.mart_top_songs_artists"
[0m10:25:05.878927 [debug] [Thread-1 (]: On model.my_dbt_trino_project.mart_top_songs_artists: /* {"app": "dbt", "dbt_version": "1.8.2", "profile_name": "my_dbt_trino_project", "target_name": "dev", "node_id": "model.my_dbt_trino_project.mart_top_songs_artists"} */
alter table "datalake"."analytics"."mart_top_songs_artists" rename to "datalake"."analytics"."mart_top_songs_artists__dbt_backup"
[0m10:25:05.967422 [debug] [Thread-1 (]: SQL status: SUCCESS in 0.0 seconds
[0m10:25:05.970421 [debug] [Thread-1 (]: Using trino connection "model.my_dbt_trino_project.mart_top_songs_artists"
[0m10:25:05.970421 [debug] [Thread-1 (]: On model.my_dbt_trino_project.mart_top_songs_artists: /* {"app": "dbt", "dbt_version": "1.8.2", "profile_name": "my_dbt_trino_project", "target_name": "dev", "node_id": "model.my_dbt_trino_project.mart_top_songs_artists"} */
alter table "datalake"."analytics"."mart_top_songs_artists__dbt_tmp" rename to "datalake"."analytics"."mart_top_songs_artists"
[0m10:25:06.067642 [debug] [Thread-1 (]: SQL status: SUCCESS in 0.0 seconds
[0m10:25:06.070314 [debug] [Thread-1 (]: Applying DROP to: "datalake"."analytics"."mart_top_songs_artists__dbt_backup"
[0m10:25:06.071693 [debug] [Thread-1 (]: Using trino connection "model.my_dbt_trino_project.mart_top_songs_artists"
[0m10:25:06.071693 [debug] [Thread-1 (]: On model.my_dbt_trino_project.mart_top_songs_artists: /* {"app": "dbt", "dbt_version": "1.8.2", "profile_name": "my_dbt_trino_project", "target_name": "dev", "node_id": "model.my_dbt_trino_project.mart_top_songs_artists"} */

    drop table if exists "datalake"."analytics"."mart_top_songs_artists__dbt_backup"
[0m10:25:06.195641 [debug] [Thread-1 (]: SQL status: SUCCESS in 0.0 seconds
[0m10:25:06.198149 [debug] [Thread-1 (]: On model.my_dbt_trino_project.mart_top_songs_artists: ROLLBACK
[0m10:25:06.198149 [debug] [Thread-1 (]: On model.my_dbt_trino_project.mart_top_songs_artists: Close
[0m10:25:06.199158 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '6da18c64-dbb6-4246-9bde-f8c324f3a36c', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000001A0C7F17A50>]}
[0m10:25:06.199158 [info ] [Thread-1 (]: 2 of 6 OK created sql table model analytics.mart_top_songs_artists ............. [[32mSUCCESS[0m in 0.57s]
[0m10:25:06.200226 [debug] [Thread-1 (]: Finished running node model.my_dbt_trino_project.mart_top_songs_artists
[0m10:25:06.200226 [debug] [Thread-1 (]: Began running node model.my_dbt_trino_project.mart_total_unique_users
[0m10:25:06.201231 [info ] [Thread-1 (]: 3 of 6 START sql table model analytics.mart_total_unique_users ................. [RUN]
[0m10:25:06.201231 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.my_dbt_trino_project.mart_top_songs_artists, now model.my_dbt_trino_project.mart_total_unique_users)
[0m10:25:06.202282 [debug] [Thread-1 (]: Began compiling node model.my_dbt_trino_project.mart_total_unique_users
[0m10:25:06.205287 [debug] [Thread-1 (]: Writing injected SQL for node "model.my_dbt_trino_project.mart_total_unique_users"
[0m10:25:06.205287 [debug] [Thread-1 (]: Began executing node model.my_dbt_trino_project.mart_total_unique_users
[0m10:25:06.209287 [debug] [Thread-1 (]: Writing runtime sql for node "model.my_dbt_trino_project.mart_total_unique_users"
[0m10:25:06.210286 [debug] [Thread-1 (]: Using trino connection "model.my_dbt_trino_project.mart_total_unique_users"
[0m10:25:06.211288 [debug] [Thread-1 (]: On model.my_dbt_trino_project.mart_total_unique_users: /* {"app": "dbt", "dbt_version": "1.8.2", "profile_name": "my_dbt_trino_project", "target_name": "dev", "node_id": "model.my_dbt_trino_project.mart_total_unique_users"} */

  
    

    create table "datalake"."analytics"."mart_total_unique_users__dbt_tmp"
      
      
    as (
      

SELECT
    total_unique_users
FROM "datalake"."analytics_stage"."stg_unique_users"
    )
[0m10:25:06.211288 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m10:25:06.449757 [debug] [Thread-1 (]: SQL status: SUCCESS in 0.0 seconds
[0m10:25:06.452392 [debug] [Thread-1 (]: Using trino connection "model.my_dbt_trino_project.mart_total_unique_users"
[0m10:25:06.452392 [debug] [Thread-1 (]: On model.my_dbt_trino_project.mart_total_unique_users: /* {"app": "dbt", "dbt_version": "1.8.2", "profile_name": "my_dbt_trino_project", "target_name": "dev", "node_id": "model.my_dbt_trino_project.mart_total_unique_users"} */
alter table "datalake"."analytics"."mart_total_unique_users" rename to "datalake"."analytics"."mart_total_unique_users__dbt_backup"
[0m10:25:06.532752 [debug] [Thread-1 (]: SQL status: SUCCESS in 0.0 seconds
[0m10:25:06.535460 [debug] [Thread-1 (]: Using trino connection "model.my_dbt_trino_project.mart_total_unique_users"
[0m10:25:06.536465 [debug] [Thread-1 (]: On model.my_dbt_trino_project.mart_total_unique_users: /* {"app": "dbt", "dbt_version": "1.8.2", "profile_name": "my_dbt_trino_project", "target_name": "dev", "node_id": "model.my_dbt_trino_project.mart_total_unique_users"} */
alter table "datalake"."analytics"."mart_total_unique_users__dbt_tmp" rename to "datalake"."analytics"."mart_total_unique_users"
[0m10:25:06.631389 [debug] [Thread-1 (]: SQL status: SUCCESS in 0.0 seconds
[0m10:25:06.635899 [debug] [Thread-1 (]: Applying DROP to: "datalake"."analytics"."mart_total_unique_users__dbt_backup"
[0m10:25:06.636904 [debug] [Thread-1 (]: Using trino connection "model.my_dbt_trino_project.mart_total_unique_users"
[0m10:25:06.637912 [debug] [Thread-1 (]: On model.my_dbt_trino_project.mart_total_unique_users: /* {"app": "dbt", "dbt_version": "1.8.2", "profile_name": "my_dbt_trino_project", "target_name": "dev", "node_id": "model.my_dbt_trino_project.mart_total_unique_users"} */

    drop table if exists "datalake"."analytics"."mart_total_unique_users__dbt_backup"
[0m10:25:06.769717 [debug] [Thread-1 (]: SQL status: SUCCESS in 0.0 seconds
[0m10:25:06.770717 [debug] [Thread-1 (]: On model.my_dbt_trino_project.mart_total_unique_users: ROLLBACK
[0m10:25:06.771717 [debug] [Thread-1 (]: On model.my_dbt_trino_project.mart_total_unique_users: Close
[0m10:25:06.771717 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '6da18c64-dbb6-4246-9bde-f8c324f3a36c', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000001A0C67C0250>]}
[0m10:25:06.771717 [info ] [Thread-1 (]: 3 of 6 OK created sql table model analytics.mart_total_unique_users ............ [[32mSUCCESS[0m in 0.57s]
[0m10:25:06.773073 [debug] [Thread-1 (]: Finished running node model.my_dbt_trino_project.mart_total_unique_users
[0m10:25:06.774078 [debug] [Thread-1 (]: Began running node model.my_dbt_trino_project.mart_user_activity_per_country
[0m10:25:06.774078 [info ] [Thread-1 (]: 4 of 6 START sql table model analytics.mart_user_activity_per_country .......... [RUN]
[0m10:25:06.774078 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.my_dbt_trino_project.mart_total_unique_users, now model.my_dbt_trino_project.mart_user_activity_per_country)
[0m10:25:06.775584 [debug] [Thread-1 (]: Began compiling node model.my_dbt_trino_project.mart_user_activity_per_country
[0m10:25:06.777101 [debug] [Thread-1 (]: Writing injected SQL for node "model.my_dbt_trino_project.mart_user_activity_per_country"
[0m10:25:06.778100 [debug] [Thread-1 (]: Began executing node model.my_dbt_trino_project.mart_user_activity_per_country
[0m10:25:06.781098 [debug] [Thread-1 (]: Writing runtime sql for node "model.my_dbt_trino_project.mart_user_activity_per_country"
[0m10:25:06.782098 [debug] [Thread-1 (]: Using trino connection "model.my_dbt_trino_project.mart_user_activity_per_country"
[0m10:25:06.782098 [debug] [Thread-1 (]: On model.my_dbt_trino_project.mart_user_activity_per_country: /* {"app": "dbt", "dbt_version": "1.8.2", "profile_name": "my_dbt_trino_project", "target_name": "dev", "node_id": "model.my_dbt_trino_project.mart_user_activity_per_country"} */

  
    

    create table "datalake"."analytics"."mart_user_activity_per_country__dbt_tmp"
      
      
    as (
      

SELECT
  country,
  SUM(activity_count) AS total_activity
FROM "datalake"."analytics_stage"."stg_user_activity_per_country"
GROUP BY country
ORDER BY SUM(activity_count) DESC
    )
[0m10:25:06.782098 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m10:25:06.823003 [debug] [Thread-1 (]: Trino adapter: Trino query id: 20240619_022506_00153_uxt54
[0m10:25:06.824004 [debug] [Thread-1 (]: Trino adapter: Trino error: TrinoUserError(type=USER_ERROR, name=TABLE_NOT_FOUND, message="line 15:6: Table 'datalake.analytics_stage.stg_user_activity_per_country' does not exist", query_id=20240619_022506_00153_uxt54)
[0m10:25:06.824004 [debug] [Thread-1 (]: On model.my_dbt_trino_project.mart_user_activity_per_country: ROLLBACK
[0m10:25:06.824004 [debug] [Thread-1 (]: On model.my_dbt_trino_project.mart_user_activity_per_country: Close
[0m10:25:06.828509 [debug] [Thread-1 (]: Database Error in model mart_user_activity_per_country (models\marts\mart_user_activity_per_country.sql)
  TrinoUserError(type=USER_ERROR, name=TABLE_NOT_FOUND, message="line 15:6: Table 'datalake.analytics_stage.stg_user_activity_per_country' does not exist", query_id=20240619_022506_00153_uxt54)
  compiled Code at target\run\my_dbt_trino_project\models\marts\mart_user_activity_per_country.sql
[0m10:25:06.828509 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '6da18c64-dbb6-4246-9bde-f8c324f3a36c', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000001A0C7FCEF50>]}
[0m10:25:06.829516 [error] [Thread-1 (]: 4 of 6 ERROR creating sql table model analytics.mart_user_activity_per_country . [[31mERROR[0m in 0.05s]
[0m10:25:06.830515 [debug] [Thread-1 (]: Finished running node model.my_dbt_trino_project.mart_user_activity_per_country
[0m10:25:06.830515 [debug] [Thread-1 (]: Began running node model.my_dbt_trino_project.mart_user_activity_per_state
[0m10:25:06.831523 [info ] [Thread-1 (]: 5 of 6 START sql table model analytics.mart_user_activity_per_state ............ [RUN]
[0m10:25:06.831523 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.my_dbt_trino_project.mart_user_activity_per_country, now model.my_dbt_trino_project.mart_user_activity_per_state)
[0m10:25:06.832527 [debug] [Thread-1 (]: Began compiling node model.my_dbt_trino_project.mart_user_activity_per_state
[0m10:25:06.834524 [debug] [Thread-1 (]: Writing injected SQL for node "model.my_dbt_trino_project.mart_user_activity_per_state"
[0m10:25:06.835524 [debug] [Thread-1 (]: Began executing node model.my_dbt_trino_project.mart_user_activity_per_state
[0m10:25:06.837527 [debug] [Thread-1 (]: Writing runtime sql for node "model.my_dbt_trino_project.mart_user_activity_per_state"
[0m10:25:06.839524 [debug] [Thread-1 (]: Using trino connection "model.my_dbt_trino_project.mart_user_activity_per_state"
[0m10:25:06.839524 [debug] [Thread-1 (]: On model.my_dbt_trino_project.mart_user_activity_per_state: /* {"app": "dbt", "dbt_version": "1.8.2", "profile_name": "my_dbt_trino_project", "target_name": "dev", "node_id": "model.my_dbt_trino_project.mart_user_activity_per_state"} */

  
    

    create table "datalake"."analytics"."mart_user_activity_per_state__dbt_tmp"
      
      
    as (
      

SELECT
  state,
  city,
  SUM(activity_count) AS total_activity
FROM "datalake"."analytics_stage"."stg_user_activity_per_location"
GROUP BY state, city
ORDER BY state, SUM(activity_count) DESC
    )
[0m10:25:06.839524 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m10:25:07.120551 [debug] [Thread-1 (]: SQL status: SUCCESS in 0.0 seconds
[0m10:25:07.123549 [debug] [Thread-1 (]: Using trino connection "model.my_dbt_trino_project.mart_user_activity_per_state"
[0m10:25:07.123549 [debug] [Thread-1 (]: On model.my_dbt_trino_project.mart_user_activity_per_state: /* {"app": "dbt", "dbt_version": "1.8.2", "profile_name": "my_dbt_trino_project", "target_name": "dev", "node_id": "model.my_dbt_trino_project.mart_user_activity_per_state"} */
alter table "datalake"."analytics"."mart_user_activity_per_state" rename to "datalake"."analytics"."mart_user_activity_per_state__dbt_backup"
[0m10:25:07.208886 [debug] [Thread-1 (]: SQL status: SUCCESS in 0.0 seconds
[0m10:25:07.214603 [debug] [Thread-1 (]: Using trino connection "model.my_dbt_trino_project.mart_user_activity_per_state"
[0m10:25:07.214603 [debug] [Thread-1 (]: On model.my_dbt_trino_project.mart_user_activity_per_state: /* {"app": "dbt", "dbt_version": "1.8.2", "profile_name": "my_dbt_trino_project", "target_name": "dev", "node_id": "model.my_dbt_trino_project.mart_user_activity_per_state"} */
alter table "datalake"."analytics"."mart_user_activity_per_state__dbt_tmp" rename to "datalake"."analytics"."mart_user_activity_per_state"
[0m10:25:07.294498 [debug] [Thread-1 (]: SQL status: SUCCESS in 0.0 seconds
[0m10:25:07.340245 [debug] [Thread-1 (]: Applying DROP to: "datalake"."analytics"."mart_user_activity_per_state__dbt_backup"
[0m10:25:07.341245 [debug] [Thread-1 (]: Using trino connection "model.my_dbt_trino_project.mart_user_activity_per_state"
[0m10:25:07.341245 [debug] [Thread-1 (]: On model.my_dbt_trino_project.mart_user_activity_per_state: /* {"app": "dbt", "dbt_version": "1.8.2", "profile_name": "my_dbt_trino_project", "target_name": "dev", "node_id": "model.my_dbt_trino_project.mart_user_activity_per_state"} */

    drop table if exists "datalake"."analytics"."mart_user_activity_per_state__dbt_backup"
[0m10:25:07.454014 [debug] [Thread-1 (]: SQL status: SUCCESS in 0.0 seconds
[0m10:25:07.455015 [debug] [Thread-1 (]: On model.my_dbt_trino_project.mart_user_activity_per_state: ROLLBACK
[0m10:25:07.456014 [debug] [Thread-1 (]: On model.my_dbt_trino_project.mart_user_activity_per_state: Close
[0m10:25:07.456014 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '6da18c64-dbb6-4246-9bde-f8c324f3a36c', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000001A0C3234110>]}
[0m10:25:07.457012 [info ] [Thread-1 (]: 5 of 6 OK created sql table model analytics.mart_user_activity_per_state ....... [[32mSUCCESS[0m in 0.62s]
[0m10:25:07.457012 [debug] [Thread-1 (]: Finished running node model.my_dbt_trino_project.mart_user_activity_per_state
[0m10:25:07.458014 [debug] [Thread-1 (]: Began running node model.my_dbt_trino_project.mart_user_level_by_gender
[0m10:25:07.458014 [info ] [Thread-1 (]: 6 of 6 START sql table model analytics.mart_user_level_by_gender ............... [RUN]
[0m10:25:07.459010 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.my_dbt_trino_project.mart_user_activity_per_state, now model.my_dbt_trino_project.mart_user_level_by_gender)
[0m10:25:07.459010 [debug] [Thread-1 (]: Began compiling node model.my_dbt_trino_project.mart_user_level_by_gender
[0m10:25:07.461012 [debug] [Thread-1 (]: Writing injected SQL for node "model.my_dbt_trino_project.mart_user_level_by_gender"
[0m10:25:07.462010 [debug] [Thread-1 (]: Began executing node model.my_dbt_trino_project.mart_user_level_by_gender
[0m10:25:07.464010 [debug] [Thread-1 (]: Writing runtime sql for node "model.my_dbt_trino_project.mart_user_level_by_gender"
[0m10:25:07.466012 [debug] [Thread-1 (]: Using trino connection "model.my_dbt_trino_project.mart_user_level_by_gender"
[0m10:25:07.466012 [debug] [Thread-1 (]: On model.my_dbt_trino_project.mart_user_level_by_gender: /* {"app": "dbt", "dbt_version": "1.8.2", "profile_name": "my_dbt_trino_project", "target_name": "dev", "node_id": "model.my_dbt_trino_project.mart_user_level_by_gender"} */

  
    

    create table "datalake"."analytics"."mart_user_level_by_gender__dbt_tmp"
      
      
    as (
      

SELECT
    gender,
    level,
    SUM(user_count) AS total_users,
    ROUND(SUM(user_count) * 100.0 / SUM(SUM(user_count)) OVER (), 2) AS percentage_of_total_users
FROM "datalake"."analytics_stage"."stg_user_level_by_gender"
GROUP BY gender, level
    )
[0m10:25:07.466012 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m10:25:07.778377 [debug] [Thread-1 (]: SQL status: SUCCESS in 0.0 seconds
[0m10:25:07.781376 [debug] [Thread-1 (]: Using trino connection "model.my_dbt_trino_project.mart_user_level_by_gender"
[0m10:25:07.781914 [debug] [Thread-1 (]: On model.my_dbt_trino_project.mart_user_level_by_gender: /* {"app": "dbt", "dbt_version": "1.8.2", "profile_name": "my_dbt_trino_project", "target_name": "dev", "node_id": "model.my_dbt_trino_project.mart_user_level_by_gender"} */
alter table "datalake"."analytics"."mart_user_level_by_gender" rename to "datalake"."analytics"."mart_user_level_by_gender__dbt_backup"
[0m10:25:07.865439 [debug] [Thread-1 (]: SQL status: SUCCESS in 0.0 seconds
[0m10:25:07.868144 [debug] [Thread-1 (]: Using trino connection "model.my_dbt_trino_project.mart_user_level_by_gender"
[0m10:25:07.868687 [debug] [Thread-1 (]: On model.my_dbt_trino_project.mart_user_level_by_gender: /* {"app": "dbt", "dbt_version": "1.8.2", "profile_name": "my_dbt_trino_project", "target_name": "dev", "node_id": "model.my_dbt_trino_project.mart_user_level_by_gender"} */
alter table "datalake"."analytics"."mart_user_level_by_gender__dbt_tmp" rename to "datalake"."analytics"."mart_user_level_by_gender"
[0m10:25:07.952761 [debug] [Thread-1 (]: SQL status: SUCCESS in 0.0 seconds
[0m10:25:07.955764 [debug] [Thread-1 (]: Applying DROP to: "datalake"."analytics"."mart_user_level_by_gender__dbt_backup"
[0m10:25:07.956761 [debug] [Thread-1 (]: Using trino connection "model.my_dbt_trino_project.mart_user_level_by_gender"
[0m10:25:07.956761 [debug] [Thread-1 (]: On model.my_dbt_trino_project.mart_user_level_by_gender: /* {"app": "dbt", "dbt_version": "1.8.2", "profile_name": "my_dbt_trino_project", "target_name": "dev", "node_id": "model.my_dbt_trino_project.mart_user_level_by_gender"} */

    drop table if exists "datalake"."analytics"."mart_user_level_by_gender__dbt_backup"
[0m10:25:08.069909 [debug] [Thread-1 (]: SQL status: SUCCESS in 0.0 seconds
[0m10:25:08.071909 [debug] [Thread-1 (]: On model.my_dbt_trino_project.mart_user_level_by_gender: ROLLBACK
[0m10:25:08.071909 [debug] [Thread-1 (]: On model.my_dbt_trino_project.mart_user_level_by_gender: Close
[0m10:25:08.072910 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '6da18c64-dbb6-4246-9bde-f8c324f3a36c', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000001A0C646CB50>]}
[0m10:25:08.073910 [info ] [Thread-1 (]: 6 of 6 OK created sql table model analytics.mart_user_level_by_gender .......... [[32mSUCCESS[0m in 0.61s]
[0m10:25:08.073910 [debug] [Thread-1 (]: Finished running node model.my_dbt_trino_project.mart_user_level_by_gender
[0m10:25:08.074910 [debug] [MainThread]: On master: COMMIT
[0m10:25:08.075920 [debug] [MainThread]: Connection 'master' was properly closed.
[0m10:25:08.075920 [debug] [MainThread]: Connection 'list_datalake' was properly closed.
[0m10:25:08.076470 [debug] [MainThread]: Connection 'list_datalake_analytics_source' was properly closed.
[0m10:25:08.076989 [debug] [MainThread]: Connection 'model.my_dbt_trino_project.mart_user_level_by_gender' was properly closed.
[0m10:25:08.077509 [info ] [MainThread]: 
[0m10:25:08.077948 [info ] [MainThread]: Finished running 6 table models in 0 hours 0 minutes and 3.43 seconds (3.43s).
[0m10:25:08.078999 [debug] [MainThread]: Command end result
[0m10:25:08.105857 [info ] [MainThread]: 
[0m10:25:08.106362 [info ] [MainThread]: [31mCompleted with 1 error and 0 warnings:[0m
[0m10:25:08.106888 [info ] [MainThread]: 
[0m10:25:08.107412 [error] [MainThread]:   Database Error in model mart_user_activity_per_country (models\marts\mart_user_activity_per_country.sql)
  TrinoUserError(type=USER_ERROR, name=TABLE_NOT_FOUND, message="line 15:6: Table 'datalake.analytics_stage.stg_user_activity_per_country' does not exist", query_id=20240619_022506_00153_uxt54)
  compiled Code at target\run\my_dbt_trino_project\models\marts\mart_user_activity_per_country.sql
[0m10:25:08.110017 [info ] [MainThread]: 
[0m10:25:08.110523 [info ] [MainThread]: Done. PASS=5 WARN=0 ERROR=1 SKIP=0 TOTAL=6
[0m10:25:08.111581 [debug] [MainThread]: Command `dbt run` failed at 10:25:08.111581 after 4.24 seconds
[0m10:25:08.112110 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000001A0C618BDD0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000001A0C618BB10>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000001A0C618BD10>]}
[0m10:25:08.113340 [debug] [MainThread]: Flushing usage events
[0m10:25:25.770263 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000001F16A6D5450>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000001F16A7185D0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000001F16A713990>]}


============================== 10:25:25.772262 | 76a27da1-8baf-4dbd-bbca-3e1cbbf528e3 ==============================
[0m10:25:25.772262 [info ] [MainThread]: Running with dbt=1.8.2
[0m10:25:25.773813 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'indirect_selection': 'eager', 'log_cache_events': 'False', 'write_json': 'True', 'partial_parse': 'True', 'cache_selected_only': 'False', 'warn_error': 'None', 'fail_fast': 'False', 'version_check': 'True', 'log_path': 'C:\\Users\\ASUS\\Desktop\\work\\Iceberg-Dbt-Trino-Hive-modern-open-source-data-stack-main\\dbt\\logs', 'debug': 'False', 'profiles_dir': 'C:\\Users\\ASUS\\Desktop\\work\\Iceberg-Dbt-Trino-Hive-modern-open-source-data-stack-main\\dbt', 'use_colors': 'True', 'use_experimental_parser': 'False', 'no_print': 'None', 'quiet': 'False', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'invocation_command': 'dbt run --models stage', 'introspect': 'True', 'log_format': 'default', 'target_path': 'None', 'static_parser': 'True', 'send_anonymous_usage_stats': 'True'}
[0m10:25:26.111765 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': '76a27da1-8baf-4dbd-bbca-3e1cbbf528e3', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000001F16A705190>]}
[0m10:25:26.149397 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': '76a27da1-8baf-4dbd-bbca-3e1cbbf528e3', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000001F167855610>]}
[0m10:25:26.150396 [info ] [MainThread]: Registered adapter: trino=1.8.0
[0m10:25:26.162398 [debug] [MainThread]: checksum: f0a141b9de567cb7f131613ba2682f40b3a1c6a157f81c6e5435862eff68f109, vars: {}, profile: , target: , version: 1.8.2
[0m10:25:26.320515 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 0 files changed.
[0m10:25:26.320515 [debug] [MainThread]: Partial parsing enabled, no changes found, skipping parsing
[0m10:25:26.352493 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': '76a27da1-8baf-4dbd-bbca-3e1cbbf528e3', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000001F16A712A10>]}
[0m10:25:26.426996 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': '76a27da1-8baf-4dbd-bbca-3e1cbbf528e3', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000001F16AC13CD0>]}
[0m10:25:26.426996 [info ] [MainThread]: Found 15 models, 7 data tests, 3 sources, 559 macros
[0m10:25:26.428475 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '76a27da1-8baf-4dbd-bbca-3e1cbbf528e3', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000001F16AE75ED0>]}
[0m10:25:26.429811 [info ] [MainThread]: 
[0m10:25:26.430818 [debug] [MainThread]: Acquiring new trino connection 'master'
[0m10:25:26.434574 [debug] [ThreadPool]: Acquiring new trino connection 'list_datalake'
[0m10:25:26.487045 [debug] [ThreadPool]: Using trino connection "list_datalake"
[0m10:25:26.487045 [debug] [ThreadPool]: On list_datalake: /* {"app": "dbt", "dbt_version": "1.8.2", "profile_name": "my_dbt_trino_project", "target_name": "dev", "connection_name": "list_datalake"} */

    select schema_name
    from "datalake".INFORMATION_SCHEMA.schemata
[0m10:25:26.487045 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m10:25:26.516098 [debug] [ThreadPool]: SQL status: SUCCESS in 0.0 seconds
[0m10:25:26.517501 [debug] [ThreadPool]: On list_datalake: Close
[0m10:25:26.518781 [debug] [ThreadPool]: Acquiring new trino connection 'list_datalake_analytics'
[0m10:25:26.529917 [debug] [ThreadPool]: Using trino connection "list_datalake_analytics"
[0m10:25:26.530925 [debug] [ThreadPool]: On list_datalake_analytics: /* {"app": "dbt", "dbt_version": "1.8.2", "profile_name": "my_dbt_trino_project", "target_name": "dev", "connection_name": "list_datalake_analytics"} */
select
      t.table_catalog as database,
      t.table_name as name,
      t.table_schema as schema,
      case when mv.name is not null then 'materialized_view'
           when t.table_type = 'BASE TABLE' then 'table'
           when t.table_type = 'VIEW' then 'view'
           else t.table_type
      end as table_type
    from "datalake".INFORMATION_SCHEMA.tables t
    left join (
            select * from system.metadata.materialized_views
            where catalog_name = 'datalake'
              and schema_name = 'analytics') mv
          on mv.catalog_name = t.table_catalog and mv.schema_name = t.table_schema and mv.name = t.table_name
    where t.table_schema = 'analytics'
[0m10:25:26.530925 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m10:25:26.587258 [debug] [ThreadPool]: SQL status: SUCCESS in 0.0 seconds
[0m10:25:26.588256 [debug] [ThreadPool]: On list_datalake_analytics: ROLLBACK
[0m10:25:26.589256 [debug] [ThreadPool]: On list_datalake_analytics: Close
[0m10:25:26.589256 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_datalake_analytics, now list_datalake_analytics_stage)
[0m10:25:26.593260 [debug] [ThreadPool]: Using trino connection "list_datalake_analytics_stage"
[0m10:25:26.594260 [debug] [ThreadPool]: On list_datalake_analytics_stage: /* {"app": "dbt", "dbt_version": "1.8.2", "profile_name": "my_dbt_trino_project", "target_name": "dev", "connection_name": "list_datalake_analytics_stage"} */
select
      t.table_catalog as database,
      t.table_name as name,
      t.table_schema as schema,
      case when mv.name is not null then 'materialized_view'
           when t.table_type = 'BASE TABLE' then 'table'
           when t.table_type = 'VIEW' then 'view'
           else t.table_type
      end as table_type
    from "datalake".INFORMATION_SCHEMA.tables t
    left join (
            select * from system.metadata.materialized_views
            where catalog_name = 'datalake'
              and schema_name = 'analytics_stage') mv
          on mv.catalog_name = t.table_catalog and mv.schema_name = t.table_schema and mv.name = t.table_name
    where t.table_schema = 'analytics_stage'
[0m10:25:26.594771 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m10:25:26.662899 [debug] [ThreadPool]: SQL status: SUCCESS in 0.0 seconds
[0m10:25:26.663911 [debug] [ThreadPool]: On list_datalake_analytics_stage: ROLLBACK
[0m10:25:26.663911 [debug] [ThreadPool]: On list_datalake_analytics_stage: Close
[0m10:25:26.664911 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_datalake_analytics_stage, now list_datalake_analytics_source)
[0m10:25:26.669872 [debug] [ThreadPool]: Using trino connection "list_datalake_analytics_source"
[0m10:25:26.670873 [debug] [ThreadPool]: On list_datalake_analytics_source: /* {"app": "dbt", "dbt_version": "1.8.2", "profile_name": "my_dbt_trino_project", "target_name": "dev", "connection_name": "list_datalake_analytics_source"} */
select
      t.table_catalog as database,
      t.table_name as name,
      t.table_schema as schema,
      case when mv.name is not null then 'materialized_view'
           when t.table_type = 'BASE TABLE' then 'table'
           when t.table_type = 'VIEW' then 'view'
           else t.table_type
      end as table_type
    from "datalake".INFORMATION_SCHEMA.tables t
    left join (
            select * from system.metadata.materialized_views
            where catalog_name = 'datalake'
              and schema_name = 'analytics_source') mv
          on mv.catalog_name = t.table_catalog and mv.schema_name = t.table_schema and mv.name = t.table_name
    where t.table_schema = 'analytics_source'
[0m10:25:26.670873 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m10:25:26.744721 [debug] [ThreadPool]: SQL status: SUCCESS in 0.0 seconds
[0m10:25:26.745731 [debug] [ThreadPool]: On list_datalake_analytics_source: ROLLBACK
[0m10:25:26.746729 [debug] [ThreadPool]: On list_datalake_analytics_source: Close
[0m10:25:26.747727 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '76a27da1-8baf-4dbd-bbca-3e1cbbf528e3', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000001F16B152C10>]}
[0m10:25:26.748963 [debug] [MainThread]: On master: COMMIT
[0m10:25:26.748963 [info ] [MainThread]: Concurrency: 1 threads (target='dev')
[0m10:25:26.748963 [info ] [MainThread]: 
[0m10:25:26.753048 [debug] [Thread-1 (]: Began running node model.my_dbt_trino_project.stg_streams_hourly
[0m10:25:26.753048 [info ] [Thread-1 (]: 1 of 6 START sql table model analytics_stage.stg_streams_hourly ................ [RUN]
[0m10:25:26.754060 [debug] [Thread-1 (]: Acquiring new trino connection 'model.my_dbt_trino_project.stg_streams_hourly'
[0m10:25:26.755059 [debug] [Thread-1 (]: Began compiling node model.my_dbt_trino_project.stg_streams_hourly
[0m10:25:26.757575 [debug] [Thread-1 (]: Writing injected SQL for node "model.my_dbt_trino_project.stg_streams_hourly"
[0m10:25:26.759097 [debug] [Thread-1 (]: Began executing node model.my_dbt_trino_project.stg_streams_hourly
[0m10:25:26.792646 [debug] [Thread-1 (]: Writing runtime sql for node "model.my_dbt_trino_project.stg_streams_hourly"
[0m10:25:26.794645 [debug] [Thread-1 (]: Using trino connection "model.my_dbt_trino_project.stg_streams_hourly"
[0m10:25:26.794645 [debug] [Thread-1 (]: On model.my_dbt_trino_project.stg_streams_hourly: /* {"app": "dbt", "dbt_version": "1.8.2", "profile_name": "my_dbt_trino_project", "target_name": "dev", "node_id": "model.my_dbt_trino_project.stg_streams_hourly"} */

  
    

    create table "datalake"."analytics_stage"."stg_streams_hourly__dbt_tmp"
      
      
    as (
      

SELECT
    DATE_FORMAT(FROM_UNIXTIME(ts), '%Y-%m-%d') AS stream_date, 
    DATE_FORMAT(FROM_UNIXTIME(ts), '%H') AS stream_hour,
    COUNT(*) AS total_streams
FROM "datalake"."analytics_source"."src_listen_events"
GROUP BY
    DATE_FORMAT(FROM_UNIXTIME(ts), '%Y-%m-%d'),
    DATE_FORMAT(FROM_UNIXTIME(ts), '%H')
    )
[0m10:25:26.795644 [debug] [Thread-1 (]: Opening a new connection, currently in state init
[0m10:25:27.026372 [debug] [Thread-1 (]: SQL status: SUCCESS in 0.0 seconds
[0m10:25:27.031884 [debug] [Thread-1 (]: Using trino connection "model.my_dbt_trino_project.stg_streams_hourly"
[0m10:25:27.033391 [debug] [Thread-1 (]: On model.my_dbt_trino_project.stg_streams_hourly: /* {"app": "dbt", "dbt_version": "1.8.2", "profile_name": "my_dbt_trino_project", "target_name": "dev", "node_id": "model.my_dbt_trino_project.stg_streams_hourly"} */
alter table "datalake"."analytics_stage"."stg_streams_hourly" rename to "datalake"."analytics_stage"."stg_streams_hourly__dbt_backup"
[0m10:25:27.123912 [debug] [Thread-1 (]: SQL status: SUCCESS in 0.0 seconds
[0m10:25:27.126910 [debug] [Thread-1 (]: Using trino connection "model.my_dbt_trino_project.stg_streams_hourly"
[0m10:25:27.126910 [debug] [Thread-1 (]: On model.my_dbt_trino_project.stg_streams_hourly: /* {"app": "dbt", "dbt_version": "1.8.2", "profile_name": "my_dbt_trino_project", "target_name": "dev", "node_id": "model.my_dbt_trino_project.stg_streams_hourly"} */
alter table "datalake"."analytics_stage"."stg_streams_hourly__dbt_tmp" rename to "datalake"."analytics_stage"."stg_streams_hourly"
[0m10:25:27.217158 [debug] [Thread-1 (]: SQL status: SUCCESS in 0.0 seconds
[0m10:25:27.222156 [debug] [Thread-1 (]: Applying DROP to: "datalake"."analytics_stage"."stg_streams_hourly__dbt_backup"
[0m10:25:27.224155 [debug] [Thread-1 (]: Using trino connection "model.my_dbt_trino_project.stg_streams_hourly"
[0m10:25:27.224155 [debug] [Thread-1 (]: On model.my_dbt_trino_project.stg_streams_hourly: /* {"app": "dbt", "dbt_version": "1.8.2", "profile_name": "my_dbt_trino_project", "target_name": "dev", "node_id": "model.my_dbt_trino_project.stg_streams_hourly"} */

    drop table if exists "datalake"."analytics_stage"."stg_streams_hourly__dbt_backup"
[0m10:25:27.345134 [debug] [Thread-1 (]: SQL status: SUCCESS in 0.0 seconds
[0m10:25:27.358736 [debug] [Thread-1 (]: On model.my_dbt_trino_project.stg_streams_hourly: ROLLBACK
[0m10:25:27.358736 [debug] [Thread-1 (]: On model.my_dbt_trino_project.stg_streams_hourly: Close
[0m10:25:27.360575 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '76a27da1-8baf-4dbd-bbca-3e1cbbf528e3', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000001F16B5300D0>]}
[0m10:25:27.361082 [info ] [Thread-1 (]: 1 of 6 OK created sql table model analytics_stage.stg_streams_hourly ........... [[32mSUCCESS[0m in 0.61s]
[0m10:25:27.362089 [debug] [Thread-1 (]: Finished running node model.my_dbt_trino_project.stg_streams_hourly
[0m10:25:27.362089 [debug] [Thread-1 (]: Began running node model.my_dbt_trino_project.stg_top_songs_artists
[0m10:25:27.363087 [info ] [Thread-1 (]: 2 of 6 START sql view model analytics_stage.stg_top_songs_artists .............. [RUN]
[0m10:25:27.363087 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.my_dbt_trino_project.stg_streams_hourly, now model.my_dbt_trino_project.stg_top_songs_artists)
[0m10:25:27.364087 [debug] [Thread-1 (]: Began compiling node model.my_dbt_trino_project.stg_top_songs_artists
[0m10:25:27.366087 [debug] [Thread-1 (]: Writing injected SQL for node "model.my_dbt_trino_project.stg_top_songs_artists"
[0m10:25:27.367089 [debug] [Thread-1 (]: Began executing node model.my_dbt_trino_project.stg_top_songs_artists
[0m10:25:27.379609 [debug] [Thread-1 (]: Writing runtime sql for node "model.my_dbt_trino_project.stg_top_songs_artists"
[0m10:25:27.381610 [debug] [Thread-1 (]: Using trino connection "model.my_dbt_trino_project.stg_top_songs_artists"
[0m10:25:27.381610 [debug] [Thread-1 (]: On model.my_dbt_trino_project.stg_top_songs_artists: /* {"app": "dbt", "dbt_version": "1.8.2", "profile_name": "my_dbt_trino_project", "target_name": "dev", "node_id": "model.my_dbt_trino_project.stg_top_songs_artists"} */

  create or replace view
    "datalake"."analytics_stage"."stg_top_songs_artists"
  security definer
  as
    

WITH song_plays AS (
    SELECT
        artist,
        song,
        COUNT(*) AS play_count
    FROM "datalake"."analytics_source"."src_listen_events"
    GROUP BY artist, song
)

SELECT
    artist,
    song,
    play_count
FROM song_plays
ORDER BY play_count DESC
  
[0m10:25:27.381610 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m10:25:27.430716 [debug] [Thread-1 (]: SQL status: SUCCESS in 0.0 seconds
[0m10:25:27.432720 [debug] [Thread-1 (]: On model.my_dbt_trino_project.stg_top_songs_artists: ROLLBACK
[0m10:25:27.432720 [debug] [Thread-1 (]: On model.my_dbt_trino_project.stg_top_songs_artists: Close
[0m10:25:27.433720 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '76a27da1-8baf-4dbd-bbca-3e1cbbf528e3', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000001F16AD8EB90>]}
[0m10:25:27.433720 [info ] [Thread-1 (]: 2 of 6 OK created sql view model analytics_stage.stg_top_songs_artists ......... [[32mSUCCESS[0m in 0.07s]
[0m10:25:27.435083 [debug] [Thread-1 (]: Finished running node model.my_dbt_trino_project.stg_top_songs_artists
[0m10:25:27.436240 [debug] [Thread-1 (]: Began running node model.my_dbt_trino_project.stg_unique_users
[0m10:25:27.436240 [info ] [Thread-1 (]: 3 of 6 START sql view model analytics_stage.stg_unique_users ................... [RUN]
[0m10:25:27.437252 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.my_dbt_trino_project.stg_top_songs_artists, now model.my_dbt_trino_project.stg_unique_users)
[0m10:25:27.437252 [debug] [Thread-1 (]: Began compiling node model.my_dbt_trino_project.stg_unique_users
[0m10:25:27.440524 [debug] [Thread-1 (]: Writing injected SQL for node "model.my_dbt_trino_project.stg_unique_users"
[0m10:25:27.440524 [debug] [Thread-1 (]: Began executing node model.my_dbt_trino_project.stg_unique_users
[0m10:25:27.443612 [debug] [Thread-1 (]: Writing runtime sql for node "model.my_dbt_trino_project.stg_unique_users"
[0m10:25:27.444616 [debug] [Thread-1 (]: Using trino connection "model.my_dbt_trino_project.stg_unique_users"
[0m10:25:27.444616 [debug] [Thread-1 (]: On model.my_dbt_trino_project.stg_unique_users: /* {"app": "dbt", "dbt_version": "1.8.2", "profile_name": "my_dbt_trino_project", "target_name": "dev", "node_id": "model.my_dbt_trino_project.stg_unique_users"} */

  create or replace view
    "datalake"."analytics_stage"."stg_unique_users"
  security definer
  as
    

SELECT
    COUNT(DISTINCT userid) AS total_unique_users
FROM "datalake"."analytics_source"."src_listen_events"
WHERE userid IS NOT NULL
  
[0m10:25:27.444616 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m10:25:27.509582 [debug] [Thread-1 (]: SQL status: SUCCESS in 0.0 seconds
[0m10:25:27.511181 [debug] [Thread-1 (]: On model.my_dbt_trino_project.stg_unique_users: ROLLBACK
[0m10:25:27.511712 [debug] [Thread-1 (]: On model.my_dbt_trino_project.stg_unique_users: Close
[0m10:25:27.512243 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '76a27da1-8baf-4dbd-bbca-3e1cbbf528e3', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000001F16B5EAD50>]}
[0m10:25:27.512771 [info ] [Thread-1 (]: 3 of 6 OK created sql view model analytics_stage.stg_unique_users .............. [[32mSUCCESS[0m in 0.07s]
[0m10:25:27.513822 [debug] [Thread-1 (]: Finished running node model.my_dbt_trino_project.stg_unique_users
[0m10:25:27.514361 [debug] [Thread-1 (]: Began running node model.my_dbt_trino_project.stg_user_activity_per_country
[0m10:25:27.514893 [info ] [Thread-1 (]: 4 of 6 START sql view model analytics_stage.stg_user_activity_per_country ...... [RUN]
[0m10:25:27.515419 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.my_dbt_trino_project.stg_unique_users, now model.my_dbt_trino_project.stg_user_activity_per_country)
[0m10:25:27.515949 [debug] [Thread-1 (]: Began compiling node model.my_dbt_trino_project.stg_user_activity_per_country
[0m10:25:27.518604 [debug] [Thread-1 (]: Writing injected SQL for node "model.my_dbt_trino_project.stg_user_activity_per_country"
[0m10:25:27.519648 [debug] [Thread-1 (]: Began executing node model.my_dbt_trino_project.stg_user_activity_per_country
[0m10:25:27.521180 [debug] [Thread-1 (]: Writing runtime sql for node "model.my_dbt_trino_project.stg_user_activity_per_country"
[0m10:25:27.525067 [debug] [Thread-1 (]: Using trino connection "model.my_dbt_trino_project.stg_user_activity_per_country"
[0m10:25:27.525571 [debug] [Thread-1 (]: On model.my_dbt_trino_project.stg_user_activity_per_country: /* {"app": "dbt", "dbt_version": "1.8.2", "profile_name": "my_dbt_trino_project", "target_name": "dev", "node_id": "model.my_dbt_trino_project.stg_user_activity_per_country"} */

  create or replace view
    "datalake"."analytics_stage"."stg_user_activity_per_country"
  security definer
  as
    

WITH combined_activities AS (
  SELECT
    country,
    'listen_event' AS event_type,
    ts,
    userid
  FROM "datalake"."analytics_source"."src_listen_events"
  WHERE country IS NOT NULL
  UNION ALL
  SELECT
    'Unknown' AS country, 
    ts,
    userid
  FROM "datalake"."analytics_source"."src_auth_events"
  UNION ALL
  SELECT
    'Unknown' AS country, 
    'page_view_event' AS event_type,
    ts,
    userid
  FROM "datalake"."analytics_source"."src_page_view_events"
)

SELECT
  country,
  COUNT(*) AS activity_count
FROM combined_activities
GROUP BY country
  
[0m10:25:27.525571 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m10:25:27.584001 [debug] [Thread-1 (]: Trino adapter: Trino query id: 20240619_022527_00172_uxt54
[0m10:25:27.584544 [debug] [Thread-1 (]: Trino adapter: Trino error: TrinoUserError(type=USER_ERROR, name=TYPE_MISMATCH, message="line 17:3: UNION query has different number of fields: 4, 3", query_id=20240619_022527_00172_uxt54)
[0m10:25:27.586197 [debug] [Thread-1 (]: On model.my_dbt_trino_project.stg_user_activity_per_country: ROLLBACK
[0m10:25:27.587257 [debug] [Thread-1 (]: On model.my_dbt_trino_project.stg_user_activity_per_country: Close
[0m10:25:27.594657 [debug] [Thread-1 (]: Database Error in model stg_user_activity_per_country (models\stage\stg_user_activity_per_country.sql)
  TrinoUserError(type=USER_ERROR, name=TYPE_MISMATCH, message="line 17:3: UNION query has different number of fields: 4, 3", query_id=20240619_022527_00172_uxt54)
  compiled Code at target\run\my_dbt_trino_project\models\stage\stg_user_activity_per_country.sql
[0m10:25:27.595728 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '76a27da1-8baf-4dbd-bbca-3e1cbbf528e3', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000001F16C600410>]}
[0m10:25:27.596793 [error] [Thread-1 (]: 4 of 6 ERROR creating sql view model analytics_stage.stg_user_activity_per_country  [[31mERROR[0m in 0.08s]
[0m10:25:27.597858 [debug] [Thread-1 (]: Finished running node model.my_dbt_trino_project.stg_user_activity_per_country
[0m10:25:27.598921 [debug] [Thread-1 (]: Began running node model.my_dbt_trino_project.stg_user_activity_per_location
[0m10:25:27.599462 [info ] [Thread-1 (]: 5 of 6 START sql view model analytics_stage.stg_user_activity_per_location ..... [RUN]
[0m10:25:27.600523 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.my_dbt_trino_project.stg_user_activity_per_country, now model.my_dbt_trino_project.stg_user_activity_per_location)
[0m10:25:27.600523 [debug] [Thread-1 (]: Began compiling node model.my_dbt_trino_project.stg_user_activity_per_location
[0m10:25:27.604190 [debug] [Thread-1 (]: Writing injected SQL for node "model.my_dbt_trino_project.stg_user_activity_per_location"
[0m10:25:27.605251 [debug] [Thread-1 (]: Began executing node model.my_dbt_trino_project.stg_user_activity_per_location
[0m10:25:27.607862 [debug] [Thread-1 (]: Writing runtime sql for node "model.my_dbt_trino_project.stg_user_activity_per_location"
[0m10:25:27.609854 [debug] [Thread-1 (]: Using trino connection "model.my_dbt_trino_project.stg_user_activity_per_location"
[0m10:25:27.609854 [debug] [Thread-1 (]: On model.my_dbt_trino_project.stg_user_activity_per_location: /* {"app": "dbt", "dbt_version": "1.8.2", "profile_name": "my_dbt_trino_project", "target_name": "dev", "node_id": "model.my_dbt_trino_project.stg_user_activity_per_location"} */

  create or replace view
    "datalake"."analytics_stage"."stg_user_activity_per_location"
  security definer
  as
    

WITH combined_activities AS (
  SELECT
    city,
    state,
    'auth_event' AS event_type,
    ts,
    userid
 FROM "datalake"."analytics_source"."src_auth_events"
  UNION ALL
  SELECT
    city,
    state,
    'listen_event' AS event_type,
    ts,
    userid
  FROM "datalake"."analytics_source"."src_listen_events"
  UNION ALL
  SELECT
    city,
    state,
    'page_view_event' AS event_type,
    ts,
    userid
  FROM "datalake"."analytics_source"."src_page_view_events"
)

SELECT
  state,
  city,
  COUNT(*) AS activity_count
FROM combined_activities
GROUP BY state, city
  
[0m10:25:27.610856 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m10:25:27.715001 [debug] [Thread-1 (]: SQL status: SUCCESS in 0.0 seconds
[0m10:25:27.717385 [debug] [Thread-1 (]: On model.my_dbt_trino_project.stg_user_activity_per_location: ROLLBACK
[0m10:25:27.717385 [debug] [Thread-1 (]: On model.my_dbt_trino_project.stg_user_activity_per_location: Close
[0m10:25:27.718565 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '76a27da1-8baf-4dbd-bbca-3e1cbbf528e3', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000001F16B5EACD0>]}
[0m10:25:27.718565 [info ] [Thread-1 (]: 5 of 6 OK created sql view model analytics_stage.stg_user_activity_per_location  [[32mSUCCESS[0m in 0.12s]
[0m10:25:27.719573 [debug] [Thread-1 (]: Finished running node model.my_dbt_trino_project.stg_user_activity_per_location
[0m10:25:27.719573 [debug] [Thread-1 (]: Began running node model.my_dbt_trino_project.stg_user_level_by_gender
[0m10:25:27.720887 [info ] [Thread-1 (]: 6 of 6 START sql view model analytics_stage.stg_user_level_by_gender ........... [RUN]
[0m10:25:27.720887 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.my_dbt_trino_project.stg_user_activity_per_location, now model.my_dbt_trino_project.stg_user_level_by_gender)
[0m10:25:27.722255 [debug] [Thread-1 (]: Began compiling node model.my_dbt_trino_project.stg_user_level_by_gender
[0m10:25:27.724434 [debug] [Thread-1 (]: Writing injected SQL for node "model.my_dbt_trino_project.stg_user_level_by_gender"
[0m10:25:27.725433 [debug] [Thread-1 (]: Began executing node model.my_dbt_trino_project.stg_user_level_by_gender
[0m10:25:27.727811 [debug] [Thread-1 (]: Writing runtime sql for node "model.my_dbt_trino_project.stg_user_level_by_gender"
[0m10:25:27.730090 [debug] [Thread-1 (]: Using trino connection "model.my_dbt_trino_project.stg_user_level_by_gender"
[0m10:25:27.730090 [debug] [Thread-1 (]: On model.my_dbt_trino_project.stg_user_level_by_gender: /* {"app": "dbt", "dbt_version": "1.8.2", "profile_name": "my_dbt_trino_project", "target_name": "dev", "node_id": "model.my_dbt_trino_project.stg_user_level_by_gender"} */

  create or replace view
    "datalake"."analytics_stage"."stg_user_level_by_gender"
  security definer
  as
    

WITH user_subscriptions AS (
    SELECT
        gender,
        level, 
        COUNT(DISTINCT userId) AS user_count
    FROM "datalake"."analytics_source"."src_auth_events"
    WHERE gender IS NOT NULL AND level IS NOT NULL
    GROUP BY gender, level
)

SELECT
    gender,
    level,
    user_count
FROM user_subscriptions
  
[0m10:25:27.730090 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m10:25:27.793464 [debug] [Thread-1 (]: SQL status: SUCCESS in 0.0 seconds
[0m10:25:27.795097 [debug] [Thread-1 (]: On model.my_dbt_trino_project.stg_user_level_by_gender: ROLLBACK
[0m10:25:27.795625 [debug] [Thread-1 (]: On model.my_dbt_trino_project.stg_user_level_by_gender: Close
[0m10:25:27.796152 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '76a27da1-8baf-4dbd-bbca-3e1cbbf528e3', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000001F16AD8E550>]}
[0m10:25:27.797203 [info ] [Thread-1 (]: 6 of 6 OK created sql view model analytics_stage.stg_user_level_by_gender ...... [[32mSUCCESS[0m in 0.08s]
[0m10:25:27.797734 [debug] [Thread-1 (]: Finished running node model.my_dbt_trino_project.stg_user_level_by_gender
[0m10:25:27.798788 [debug] [MainThread]: On master: COMMIT
[0m10:25:27.799312 [debug] [MainThread]: Connection 'master' was properly closed.
[0m10:25:27.799842 [debug] [MainThread]: Connection 'list_datalake' was properly closed.
[0m10:25:27.799842 [debug] [MainThread]: Connection 'list_datalake_analytics_source' was properly closed.
[0m10:25:27.800367 [debug] [MainThread]: Connection 'model.my_dbt_trino_project.stg_user_level_by_gender' was properly closed.
[0m10:25:27.800367 [info ] [MainThread]: 
[0m10:25:27.800897 [info ] [MainThread]: Finished running 1 table model, 5 view models in 0 hours 0 minutes and 1.37 seconds (1.37s).
[0m10:25:27.802463 [debug] [MainThread]: Command end result
[0m10:25:27.890919 [info ] [MainThread]: 
[0m10:25:27.891448 [info ] [MainThread]: [31mCompleted with 1 error and 0 warnings:[0m
[0m10:25:27.891979 [info ] [MainThread]: 
[0m10:25:27.892509 [error] [MainThread]:   Database Error in model stg_user_activity_per_country (models\stage\stg_user_activity_per_country.sql)
  TrinoUserError(type=USER_ERROR, name=TYPE_MISMATCH, message="line 17:3: UNION query has different number of fields: 4, 3", query_id=20240619_022527_00172_uxt54)
  compiled Code at target\run\my_dbt_trino_project\models\stage\stg_user_activity_per_country.sql
[0m10:25:27.893038 [info ] [MainThread]: 
[0m10:25:27.893579 [info ] [MainThread]: Done. PASS=5 WARN=0 ERROR=1 SKIP=0 TOTAL=6
[0m10:25:27.895150 [debug] [MainThread]: Command `dbt run` failed at 10:25:27.895150 after 2.26 seconds
[0m10:25:27.895726 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000001F1657BF390>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000001F1657BE310>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000001F16C6D3A50>]}
[0m10:25:27.896255 [debug] [MainThread]: Flushing usage events
[0m10:25:37.304804 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000001C8EFC75110>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000001C8EFCBB910>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000001C8EFC8C810>]}


============================== 10:25:37.307301 | ccf74b2c-d71a-44ec-802a-51893ee310be ==============================
[0m10:25:37.307301 [info ] [MainThread]: Running with dbt=1.8.2
[0m10:25:37.308711 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'indirect_selection': 'eager', 'write_json': 'True', 'log_cache_events': 'False', 'partial_parse': 'True', 'cache_selected_only': 'False', 'warn_error': 'None', 'version_check': 'True', 'profiles_dir': 'C:\\Users\\ASUS\\Desktop\\work\\Iceberg-Dbt-Trino-Hive-modern-open-source-data-stack-main\\dbt', 'log_path': 'C:\\Users\\ASUS\\Desktop\\work\\Iceberg-Dbt-Trino-Hive-modern-open-source-data-stack-main\\dbt\\logs', 'fail_fast': 'False', 'debug': 'False', 'use_colors': 'True', 'use_experimental_parser': 'False', 'no_print': 'None', 'quiet': 'False', 'log_format': 'default', 'static_parser': 'True', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'invocation_command': 'dbt run', 'target_path': 'None', 'introspect': 'True', 'send_anonymous_usage_stats': 'True'}
[0m10:25:37.625615 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': 'ccf74b2c-d71a-44ec-802a-51893ee310be', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000001C8F0073A50>]}
[0m10:25:37.659577 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': 'ccf74b2c-d71a-44ec-802a-51893ee310be', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000001C8ECDE50D0>]}
[0m10:25:37.659577 [info ] [MainThread]: Registered adapter: trino=1.8.0
[0m10:25:37.673281 [debug] [MainThread]: checksum: f0a141b9de567cb7f131613ba2682f40b3a1c6a157f81c6e5435862eff68f109, vars: {}, profile: , target: , version: 1.8.2
[0m10:25:37.826563 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 0 files changed.
[0m10:25:37.826563 [debug] [MainThread]: Partial parsing enabled, no changes found, skipping parsing
[0m10:25:37.856562 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': 'ccf74b2c-d71a-44ec-802a-51893ee310be', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000001C8F0314CD0>]}
[0m10:25:37.938183 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': 'ccf74b2c-d71a-44ec-802a-51893ee310be', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000001C8F01C7F10>]}
[0m10:25:37.938183 [info ] [MainThread]: Found 15 models, 7 data tests, 3 sources, 559 macros
[0m10:25:37.939390 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': 'ccf74b2c-d71a-44ec-802a-51893ee310be', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000001C8F0143150>]}
[0m10:25:37.940886 [info ] [MainThread]: 
[0m10:25:37.940886 [debug] [MainThread]: Acquiring new trino connection 'master'
[0m10:25:37.946117 [debug] [ThreadPool]: Acquiring new trino connection 'list_datalake'
[0m10:25:38.000674 [debug] [ThreadPool]: Using trino connection "list_datalake"
[0m10:25:38.001675 [debug] [ThreadPool]: On list_datalake: /* {"app": "dbt", "dbt_version": "1.8.2", "profile_name": "my_dbt_trino_project", "target_name": "dev", "connection_name": "list_datalake"} */

    select schema_name
    from "datalake".INFORMATION_SCHEMA.schemata
[0m10:25:38.001675 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m10:25:38.043238 [debug] [ThreadPool]: SQL status: SUCCESS in 0.0 seconds
[0m10:25:38.044238 [debug] [ThreadPool]: On list_datalake: Close
[0m10:25:38.047318 [debug] [ThreadPool]: Using trino connection "list_datalake"
[0m10:25:38.048315 [debug] [ThreadPool]: On list_datalake: /* {"app": "dbt", "dbt_version": "1.8.2", "profile_name": "my_dbt_trino_project", "target_name": "dev", "connection_name": "list_datalake"} */

    select schema_name
    from "datalake".INFORMATION_SCHEMA.schemata
[0m10:25:38.048315 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m10:25:38.090872 [debug] [ThreadPool]: SQL status: SUCCESS in 0.0 seconds
[0m10:25:38.091912 [debug] [ThreadPool]: On list_datalake: Close
[0m10:25:38.094533 [debug] [ThreadPool]: Using trino connection "list_datalake"
[0m10:25:38.095057 [debug] [ThreadPool]: On list_datalake: /* {"app": "dbt", "dbt_version": "1.8.2", "profile_name": "my_dbt_trino_project", "target_name": "dev", "connection_name": "list_datalake"} */

    select schema_name
    from "datalake".INFORMATION_SCHEMA.schemata
[0m10:25:38.095057 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m10:25:38.135969 [debug] [ThreadPool]: SQL status: SUCCESS in 0.0 seconds
[0m10:25:38.136977 [debug] [ThreadPool]: On list_datalake: Close
[0m10:25:38.139466 [debug] [ThreadPool]: Acquiring new trino connection 'list_datalake_analytics'
[0m10:25:38.149919 [debug] [ThreadPool]: Using trino connection "list_datalake_analytics"
[0m10:25:38.150923 [debug] [ThreadPool]: On list_datalake_analytics: /* {"app": "dbt", "dbt_version": "1.8.2", "profile_name": "my_dbt_trino_project", "target_name": "dev", "connection_name": "list_datalake_analytics"} */
select
      t.table_catalog as database,
      t.table_name as name,
      t.table_schema as schema,
      case when mv.name is not null then 'materialized_view'
           when t.table_type = 'BASE TABLE' then 'table'
           when t.table_type = 'VIEW' then 'view'
           else t.table_type
      end as table_type
    from "datalake".INFORMATION_SCHEMA.tables t
    left join (
            select * from system.metadata.materialized_views
            where catalog_name = 'datalake'
              and schema_name = 'analytics') mv
          on mv.catalog_name = t.table_catalog and mv.schema_name = t.table_schema and mv.name = t.table_name
    where t.table_schema = 'analytics'
[0m10:25:38.150923 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m10:25:38.196578 [debug] [ThreadPool]: SQL status: SUCCESS in 0.0 seconds
[0m10:25:38.197577 [debug] [ThreadPool]: On list_datalake_analytics: ROLLBACK
[0m10:25:38.197577 [debug] [ThreadPool]: On list_datalake_analytics: Close
[0m10:25:38.198575 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_datalake_analytics, now list_datalake_analytics_stage)
[0m10:25:38.202868 [debug] [ThreadPool]: Using trino connection "list_datalake_analytics_stage"
[0m10:25:38.202868 [debug] [ThreadPool]: On list_datalake_analytics_stage: /* {"app": "dbt", "dbt_version": "1.8.2", "profile_name": "my_dbt_trino_project", "target_name": "dev", "connection_name": "list_datalake_analytics_stage"} */
select
      t.table_catalog as database,
      t.table_name as name,
      t.table_schema as schema,
      case when mv.name is not null then 'materialized_view'
           when t.table_type = 'BASE TABLE' then 'table'
           when t.table_type = 'VIEW' then 'view'
           else t.table_type
      end as table_type
    from "datalake".INFORMATION_SCHEMA.tables t
    left join (
            select * from system.metadata.materialized_views
            where catalog_name = 'datalake'
              and schema_name = 'analytics_stage') mv
          on mv.catalog_name = t.table_catalog and mv.schema_name = t.table_schema and mv.name = t.table_name
    where t.table_schema = 'analytics_stage'
[0m10:25:38.202868 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m10:25:38.275313 [debug] [ThreadPool]: SQL status: SUCCESS in 0.0 seconds
[0m10:25:38.276319 [debug] [ThreadPool]: On list_datalake_analytics_stage: ROLLBACK
[0m10:25:38.276319 [debug] [ThreadPool]: On list_datalake_analytics_stage: Close
[0m10:25:38.277754 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_datalake_analytics_stage, now list_datalake_analytics_source)
[0m10:25:38.282688 [debug] [ThreadPool]: Using trino connection "list_datalake_analytics_source"
[0m10:25:38.283223 [debug] [ThreadPool]: On list_datalake_analytics_source: /* {"app": "dbt", "dbt_version": "1.8.2", "profile_name": "my_dbt_trino_project", "target_name": "dev", "connection_name": "list_datalake_analytics_source"} */
select
      t.table_catalog as database,
      t.table_name as name,
      t.table_schema as schema,
      case when mv.name is not null then 'materialized_view'
           when t.table_type = 'BASE TABLE' then 'table'
           when t.table_type = 'VIEW' then 'view'
           else t.table_type
      end as table_type
    from "datalake".INFORMATION_SCHEMA.tables t
    left join (
            select * from system.metadata.materialized_views
            where catalog_name = 'datalake'
              and schema_name = 'analytics_source') mv
          on mv.catalog_name = t.table_catalog and mv.schema_name = t.table_schema and mv.name = t.table_name
    where t.table_schema = 'analytics_source'
[0m10:25:38.283751 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m10:25:38.343000 [debug] [ThreadPool]: SQL status: SUCCESS in 0.0 seconds
[0m10:25:38.344505 [debug] [ThreadPool]: On list_datalake_analytics_source: ROLLBACK
[0m10:25:38.344505 [debug] [ThreadPool]: On list_datalake_analytics_source: Close
[0m10:25:38.345510 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': 'ccf74b2c-d71a-44ec-802a-51893ee310be', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000001C8F06F2DD0>]}
[0m10:25:38.345510 [debug] [MainThread]: On master: COMMIT
[0m10:25:38.346968 [info ] [MainThread]: Concurrency: 1 threads (target='dev')
[0m10:25:38.346968 [info ] [MainThread]: 
[0m10:25:38.349729 [debug] [Thread-1 (]: Began running node model.my_dbt_trino_project.src_auth_events
[0m10:25:38.350734 [info ] [Thread-1 (]: 1 of 15 START sql table model analytics_source.src_auth_events ................. [RUN]
[0m10:25:38.351873 [debug] [Thread-1 (]: Acquiring new trino connection 'model.my_dbt_trino_project.src_auth_events'
[0m10:25:38.351873 [debug] [Thread-1 (]: Began compiling node model.my_dbt_trino_project.src_auth_events
[0m10:25:38.357833 [debug] [Thread-1 (]: Writing injected SQL for node "model.my_dbt_trino_project.src_auth_events"
[0m10:25:38.357833 [debug] [Thread-1 (]: Began executing node model.my_dbt_trino_project.src_auth_events
[0m10:25:38.394441 [debug] [Thread-1 (]: Writing runtime sql for node "model.my_dbt_trino_project.src_auth_events"
[0m10:25:38.398752 [debug] [Thread-1 (]: Using trino connection "model.my_dbt_trino_project.src_auth_events"
[0m10:25:38.398752 [debug] [Thread-1 (]: On model.my_dbt_trino_project.src_auth_events: /* {"app": "dbt", "dbt_version": "1.8.2", "profile_name": "my_dbt_trino_project", "target_name": "dev", "node_id": "model.my_dbt_trino_project.src_auth_events"} */

  
    

    create table "datalake"."analytics_source"."src_auth_events__dbt_tmp"
      
      
    as (
      

with source as (
    select
        CAST(ts AS VARCHAR) as id, 
        ts,
        CAST(sessionId AS VARCHAR) as sessionId,
        level,
        itemInSession,
        city,
        zip,
        state,
        userAgent,
        CAST(NULLIF(lon, '') AS double) as lon,
        CAST(NULLIF(lat, '') AS double) as lat,
        CAST(FLOOR(CAST(NULLIF(userId, '') AS DOUBLE)) AS INT) as userId, 
        lastName,
        firstName,
        gender,
        CAST(FLOOR(CAST(NULLIF(registration, '') AS DOUBLE)) AS BIGINT) as registration,
        success
    from "oltp"."public"."auth_events"
)

select
    id,
    ts,
    sessionId,
    level,
    itemInSession,
    city,
    zip,
    state,
    userAgent,
    lon,
    lat,
    userId,
    lastName,
    firstName,
    gender,
    registration, 
    CASE 
        WHEN CAST(success AS VARCHAR) = 't' THEN true 
        WHEN CAST(success AS VARCHAR) = 'f' THEN false
        ELSE NULL 
    END AS success_boolean
from source


    )
[0m10:25:38.400257 [debug] [Thread-1 (]: Opening a new connection, currently in state init
[0m10:25:38.668796 [debug] [Thread-1 (]: SQL status: SUCCESS in 0.0 seconds
[0m10:25:38.673812 [debug] [Thread-1 (]: Using trino connection "model.my_dbt_trino_project.src_auth_events"
[0m10:25:38.674821 [debug] [Thread-1 (]: On model.my_dbt_trino_project.src_auth_events: /* {"app": "dbt", "dbt_version": "1.8.2", "profile_name": "my_dbt_trino_project", "target_name": "dev", "node_id": "model.my_dbt_trino_project.src_auth_events"} */
alter table "datalake"."analytics_source"."src_auth_events" rename to "datalake"."analytics_source"."src_auth_events__dbt_backup"
[0m10:25:38.761584 [debug] [Thread-1 (]: SQL status: SUCCESS in 0.0 seconds
[0m10:25:38.764579 [debug] [Thread-1 (]: Using trino connection "model.my_dbt_trino_project.src_auth_events"
[0m10:25:38.765578 [debug] [Thread-1 (]: On model.my_dbt_trino_project.src_auth_events: /* {"app": "dbt", "dbt_version": "1.8.2", "profile_name": "my_dbt_trino_project", "target_name": "dev", "node_id": "model.my_dbt_trino_project.src_auth_events"} */
alter table "datalake"."analytics_source"."src_auth_events__dbt_tmp" rename to "datalake"."analytics_source"."src_auth_events"
[0m10:25:38.845304 [debug] [Thread-1 (]: SQL status: SUCCESS in 0.0 seconds
[0m10:25:38.851352 [debug] [Thread-1 (]: Applying DROP to: "datalake"."analytics_source"."src_auth_events__dbt_backup"
[0m10:25:38.853352 [debug] [Thread-1 (]: Using trino connection "model.my_dbt_trino_project.src_auth_events"
[0m10:25:38.853352 [debug] [Thread-1 (]: On model.my_dbt_trino_project.src_auth_events: /* {"app": "dbt", "dbt_version": "1.8.2", "profile_name": "my_dbt_trino_project", "target_name": "dev", "node_id": "model.my_dbt_trino_project.src_auth_events"} */

    drop table if exists "datalake"."analytics_source"."src_auth_events__dbt_backup"
[0m10:25:38.967133 [debug] [Thread-1 (]: SQL status: SUCCESS in 0.0 seconds
[0m10:25:38.979705 [debug] [Thread-1 (]: On model.my_dbt_trino_project.src_auth_events: ROLLBACK
[0m10:25:38.980705 [debug] [Thread-1 (]: On model.my_dbt_trino_project.src_auth_events: Close
[0m10:25:38.981706 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'ccf74b2c-d71a-44ec-802a-51893ee310be', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000001C8F06C0DD0>]}
[0m10:25:38.982706 [info ] [Thread-1 (]: 1 of 15 OK created sql table model analytics_source.src_auth_events ............ [[32mSUCCESS[0m in 0.63s]
[0m10:25:38.982706 [debug] [Thread-1 (]: Finished running node model.my_dbt_trino_project.src_auth_events
[0m10:25:38.984215 [debug] [Thread-1 (]: Began running node model.my_dbt_trino_project.src_listen_events
[0m10:25:38.984215 [info ] [Thread-1 (]: 2 of 15 START sql incremental model analytics_source.src_listen_events ......... [RUN]
[0m10:25:38.985221 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.my_dbt_trino_project.src_auth_events, now model.my_dbt_trino_project.src_listen_events)
[0m10:25:38.985221 [debug] [Thread-1 (]: Began compiling node model.my_dbt_trino_project.src_listen_events
[0m10:25:38.990498 [debug] [Thread-1 (]: Writing injected SQL for node "model.my_dbt_trino_project.src_listen_events"
[0m10:25:38.991497 [debug] [Thread-1 (]: Began executing node model.my_dbt_trino_project.src_listen_events
[0m10:25:39.016817 [debug] [Thread-1 (]: Using trino connection "model.my_dbt_trino_project.src_listen_events"
[0m10:25:39.016817 [debug] [Thread-1 (]: On model.my_dbt_trino_project.src_listen_events: /* {"app": "dbt", "dbt_version": "1.8.2", "profile_name": "my_dbt_trino_project", "target_name": "dev", "node_id": "model.my_dbt_trino_project.src_listen_events"} */

  
    

    create table "datalake"."analytics_source"."src_listen_events__dbt_tmp"
      
      
    as (
      

with source as (

    select
        CAST(_id AS VARCHAR) as id,
        artist,
        song,
        CAST(NULLIF(duration, '') AS DOUBLE) as duration,
        ts,
        sessionid,
        auth,
        level,
        CAST(NULLIF(itemInSession, '') AS INTEGER) as itemInSession,
        city,
        zip,
        state,
        country,
        userAgent,
        CAST(NULLIF(lon, '') AS DOUBLE) as lon,
        CAST(NULLIF(lat, '') AS DOUBLE) as lat,
        CAST(CAST(NULLIF(userId, '') AS DOUBLE) AS INTEGER) as userId,
 -- Assurez-vous que userId peut aussi être converti de cette manière.
        lastName,
        firstName,
        gender,
        CAST(CAST(NULLIF(registration, '') AS DOUBLE) AS BIGINT) as registration
    from "website"."demo"."listen_events"

)

select * from source



    -- this filter will only be applied on an incremental run
    where ts > (select max(ts) from "datalake"."analytics_source"."src_listen_events")


    )
[0m10:25:39.017817 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m10:25:39.176168 [debug] [Thread-1 (]: SQL status: SUCCESS in 0.0 seconds
[0m10:25:39.184200 [debug] [Thread-1 (]: Using trino connection "model.my_dbt_trino_project.src_listen_events"
[0m10:25:39.185202 [debug] [Thread-1 (]: On model.my_dbt_trino_project.src_listen_events: /* {"app": "dbt", "dbt_version": "1.8.2", "profile_name": "my_dbt_trino_project", "target_name": "dev", "node_id": "model.my_dbt_trino_project.src_listen_events"} */

    describe "datalake"."analytics_source"."src_listen_events__dbt_tmp"
[0m10:25:39.268487 [debug] [Thread-1 (]: SQL status: SUCCESS in 0.0 seconds
[0m10:25:39.272004 [debug] [Thread-1 (]: Using trino connection "model.my_dbt_trino_project.src_listen_events"
[0m10:25:39.272004 [debug] [Thread-1 (]: On model.my_dbt_trino_project.src_listen_events: /* {"app": "dbt", "dbt_version": "1.8.2", "profile_name": "my_dbt_trino_project", "target_name": "dev", "node_id": "model.my_dbt_trino_project.src_listen_events"} */

    describe "datalake"."analytics_source"."src_listen_events"
[0m10:25:39.369050 [debug] [Thread-1 (]: SQL status: SUCCESS in 0.0 seconds
[0m10:25:39.375048 [debug] [Thread-1 (]: Using trino connection "model.my_dbt_trino_project.src_listen_events"
[0m10:25:39.376052 [debug] [Thread-1 (]: On model.my_dbt_trino_project.src_listen_events: /* {"app": "dbt", "dbt_version": "1.8.2", "profile_name": "my_dbt_trino_project", "target_name": "dev", "node_id": "model.my_dbt_trino_project.src_listen_events"} */

    describe "datalake"."analytics_source"."src_listen_events"
[0m10:25:39.468120 [debug] [Thread-1 (]: SQL status: SUCCESS in 0.0 seconds
[0m10:25:39.475186 [debug] [Thread-1 (]: Writing runtime sql for node "model.my_dbt_trino_project.src_listen_events"
[0m10:25:39.477347 [debug] [Thread-1 (]: Using trino connection "model.my_dbt_trino_project.src_listen_events"
[0m10:25:39.477347 [debug] [Thread-1 (]: On model.my_dbt_trino_project.src_listen_events: /* {"app": "dbt", "dbt_version": "1.8.2", "profile_name": "my_dbt_trino_project", "target_name": "dev", "node_id": "model.my_dbt_trino_project.src_listen_events"} */
insert into "datalake"."analytics_source"."src_listen_events" ("id", "artist", "song", "duration", "ts", "sessionid", "auth", "level", "iteminsession", "city", "zip", "state", "country", "useragent", "lon", "lat", "userid", "lastname", "firstname", "gender", "registration")
    (
        select "id", "artist", "song", "duration", "ts", "sessionid", "auth", "level", "iteminsession", "city", "zip", "state", "country", "useragent", "lon", "lat", "userid", "lastname", "firstname", "gender", "registration"
        from "datalake"."analytics_source"."src_listen_events__dbt_tmp"
    )
[0m10:25:39.612012 [debug] [Thread-1 (]: SQL status: SUCCESS in 0.0 seconds
[0m10:25:39.615024 [debug] [Thread-1 (]: Applying DROP to: "datalake"."analytics_source"."src_listen_events__dbt_tmp"
[0m10:25:39.615024 [debug] [Thread-1 (]: Using trino connection "model.my_dbt_trino_project.src_listen_events"
[0m10:25:39.616022 [debug] [Thread-1 (]: On model.my_dbt_trino_project.src_listen_events: /* {"app": "dbt", "dbt_version": "1.8.2", "profile_name": "my_dbt_trino_project", "target_name": "dev", "node_id": "model.my_dbt_trino_project.src_listen_events"} */

    drop table if exists "datalake"."analytics_source"."src_listen_events__dbt_tmp"
[0m10:25:39.715023 [debug] [Thread-1 (]: SQL status: SUCCESS in 0.0 seconds
[0m10:25:39.717023 [debug] [Thread-1 (]: On model.my_dbt_trino_project.src_listen_events: ROLLBACK
[0m10:25:39.717023 [debug] [Thread-1 (]: On model.my_dbt_trino_project.src_listen_events: Close
[0m10:25:39.717023 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'ccf74b2c-d71a-44ec-802a-51893ee310be', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000001C8F02B8DD0>]}
[0m10:25:39.718021 [info ] [Thread-1 (]: 2 of 15 OK created sql incremental model analytics_source.src_listen_events .... [[32mSUCCESS[0m in 0.73s]
[0m10:25:39.718021 [debug] [Thread-1 (]: Finished running node model.my_dbt_trino_project.src_listen_events
[0m10:25:39.719524 [debug] [Thread-1 (]: Began running node model.my_dbt_trino_project.src_page_view_events
[0m10:25:39.720546 [info ] [Thread-1 (]: 3 of 15 START sql incremental model analytics_source.src_page_view_events ...... [RUN]
[0m10:25:39.720546 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.my_dbt_trino_project.src_listen_events, now model.my_dbt_trino_project.src_page_view_events)
[0m10:25:39.720546 [debug] [Thread-1 (]: Began compiling node model.my_dbt_trino_project.src_page_view_events
[0m10:25:39.723541 [debug] [Thread-1 (]: Writing injected SQL for node "model.my_dbt_trino_project.src_page_view_events"
[0m10:25:39.723541 [debug] [Thread-1 (]: Began executing node model.my_dbt_trino_project.src_page_view_events
[0m10:25:39.729432 [debug] [Thread-1 (]: Using trino connection "model.my_dbt_trino_project.src_page_view_events"
[0m10:25:39.729432 [debug] [Thread-1 (]: On model.my_dbt_trino_project.src_page_view_events: /* {"app": "dbt", "dbt_version": "1.8.2", "profile_name": "my_dbt_trino_project", "target_name": "dev", "node_id": "model.my_dbt_trino_project.src_page_view_events"} */

  
    

    create table "datalake"."analytics_source"."src_page_view_events__dbt_tmp"
      
      
    as (
      

with source as (
    select
        CAST(_id AS VARCHAR) as id,
        ts,
        CAST(sessionId AS VARCHAR) as sessionId,
        page,
        auth,
        level,
        CAST(CAST(NULLIF(itemInSession, '') AS DOUBLE) AS INTEGER) as itemInSession, 
        city,
        zip,
        state,
        userAgent,
        CAST(NULLIF(lon, '') AS double) as lon,
        CAST(NULLIF(lat, '') AS double) as lat,
        CAST(CAST(NULLIF(userId, '') AS DOUBLE) AS INTEGER) as userId, 
        lastName,
        firstName,
        gender,
        CAST(CAST(NULLIF(registration, '') AS DOUBLE) AS BIGINT) as registration, 
        artist,
        song,
        CAST(NULLIF(duration, '') AS double) as duration
    from "website"."demo"."page_view_events"
)

select * from source


    where ts > (select max(ts) from "datalake"."analytics_source"."src_page_view_events")

    )
[0m10:25:39.730441 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m10:25:39.919940 [debug] [Thread-1 (]: SQL status: SUCCESS in 0.0 seconds
[0m10:25:39.922570 [debug] [Thread-1 (]: Using trino connection "model.my_dbt_trino_project.src_page_view_events"
[0m10:25:39.923096 [debug] [Thread-1 (]: On model.my_dbt_trino_project.src_page_view_events: /* {"app": "dbt", "dbt_version": "1.8.2", "profile_name": "my_dbt_trino_project", "target_name": "dev", "node_id": "model.my_dbt_trino_project.src_page_view_events"} */

    describe "datalake"."analytics_source"."src_page_view_events__dbt_tmp"
[0m10:25:40.019452 [debug] [Thread-1 (]: SQL status: SUCCESS in 0.0 seconds
[0m10:25:40.022461 [debug] [Thread-1 (]: Using trino connection "model.my_dbt_trino_project.src_page_view_events"
[0m10:25:40.022461 [debug] [Thread-1 (]: On model.my_dbt_trino_project.src_page_view_events: /* {"app": "dbt", "dbt_version": "1.8.2", "profile_name": "my_dbt_trino_project", "target_name": "dev", "node_id": "model.my_dbt_trino_project.src_page_view_events"} */

    describe "datalake"."analytics_source"."src_page_view_events"
[0m10:25:40.118140 [debug] [Thread-1 (]: SQL status: SUCCESS in 0.0 seconds
[0m10:25:40.175044 [debug] [Thread-1 (]: Using trino connection "model.my_dbt_trino_project.src_page_view_events"
[0m10:25:40.175044 [debug] [Thread-1 (]: On model.my_dbt_trino_project.src_page_view_events: /* {"app": "dbt", "dbt_version": "1.8.2", "profile_name": "my_dbt_trino_project", "target_name": "dev", "node_id": "model.my_dbt_trino_project.src_page_view_events"} */

    describe "datalake"."analytics_source"."src_page_view_events"
[0m10:25:40.269911 [debug] [Thread-1 (]: SQL status: SUCCESS in 0.0 seconds
[0m10:25:40.271911 [debug] [Thread-1 (]: Writing runtime sql for node "model.my_dbt_trino_project.src_page_view_events"
[0m10:25:40.273419 [debug] [Thread-1 (]: Using trino connection "model.my_dbt_trino_project.src_page_view_events"
[0m10:25:40.273419 [debug] [Thread-1 (]: On model.my_dbt_trino_project.src_page_view_events: /* {"app": "dbt", "dbt_version": "1.8.2", "profile_name": "my_dbt_trino_project", "target_name": "dev", "node_id": "model.my_dbt_trino_project.src_page_view_events"} */
insert into "datalake"."analytics_source"."src_page_view_events" ("id", "ts", "sessionid", "page", "auth", "level", "iteminsession", "city", "zip", "state", "useragent", "lon", "lat", "userid", "lastname", "firstname", "gender", "registration", "artist", "song", "duration")
    (
        select "id", "ts", "sessionid", "page", "auth", "level", "iteminsession", "city", "zip", "state", "useragent", "lon", "lat", "userid", "lastname", "firstname", "gender", "registration", "artist", "song", "duration"
        from "datalake"."analytics_source"."src_page_view_events__dbt_tmp"
    )
[0m10:25:40.392022 [debug] [Thread-1 (]: SQL status: SUCCESS in 0.0 seconds
[0m10:25:40.394549 [debug] [Thread-1 (]: Applying DROP to: "datalake"."analytics_source"."src_page_view_events__dbt_tmp"
[0m10:25:40.394549 [debug] [Thread-1 (]: Using trino connection "model.my_dbt_trino_project.src_page_view_events"
[0m10:25:40.395552 [debug] [Thread-1 (]: On model.my_dbt_trino_project.src_page_view_events: /* {"app": "dbt", "dbt_version": "1.8.2", "profile_name": "my_dbt_trino_project", "target_name": "dev", "node_id": "model.my_dbt_trino_project.src_page_view_events"} */

    drop table if exists "datalake"."analytics_source"."src_page_view_events__dbt_tmp"
[0m10:25:40.499550 [debug] [Thread-1 (]: SQL status: SUCCESS in 0.0 seconds
[0m10:25:40.501057 [debug] [Thread-1 (]: On model.my_dbt_trino_project.src_page_view_events: ROLLBACK
[0m10:25:40.502064 [debug] [Thread-1 (]: On model.my_dbt_trino_project.src_page_view_events: Close
[0m10:25:40.502064 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'ccf74b2c-d71a-44ec-802a-51893ee310be', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000001C8EFE9F390>]}
[0m10:25:40.502064 [info ] [Thread-1 (]: 3 of 15 OK created sql incremental model analytics_source.src_page_view_events . [[32mSUCCESS[0m in 0.78s]
[0m10:25:40.503375 [debug] [Thread-1 (]: Finished running node model.my_dbt_trino_project.src_page_view_events
[0m10:25:40.504382 [debug] [Thread-1 (]: Began running node model.my_dbt_trino_project.stg_user_level_by_gender
[0m10:25:40.504382 [info ] [Thread-1 (]: 4 of 15 START sql view model analytics_stage.stg_user_level_by_gender .......... [RUN]
[0m10:25:40.505542 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.my_dbt_trino_project.src_page_view_events, now model.my_dbt_trino_project.stg_user_level_by_gender)
[0m10:25:40.505542 [debug] [Thread-1 (]: Began compiling node model.my_dbt_trino_project.stg_user_level_by_gender
[0m10:25:40.508553 [debug] [Thread-1 (]: Writing injected SQL for node "model.my_dbt_trino_project.stg_user_level_by_gender"
[0m10:25:40.509257 [debug] [Thread-1 (]: Began executing node model.my_dbt_trino_project.stg_user_level_by_gender
[0m10:25:40.519821 [debug] [Thread-1 (]: Writing runtime sql for node "model.my_dbt_trino_project.stg_user_level_by_gender"
[0m10:25:40.521824 [debug] [Thread-1 (]: Using trino connection "model.my_dbt_trino_project.stg_user_level_by_gender"
[0m10:25:40.521824 [debug] [Thread-1 (]: On model.my_dbt_trino_project.stg_user_level_by_gender: /* {"app": "dbt", "dbt_version": "1.8.2", "profile_name": "my_dbt_trino_project", "target_name": "dev", "node_id": "model.my_dbt_trino_project.stg_user_level_by_gender"} */

  create or replace view
    "datalake"."analytics_stage"."stg_user_level_by_gender"
  security definer
  as
    

WITH user_subscriptions AS (
    SELECT
        gender,
        level, 
        COUNT(DISTINCT userId) AS user_count
    FROM "datalake"."analytics_source"."src_auth_events"
    WHERE gender IS NOT NULL AND level IS NOT NULL
    GROUP BY gender, level
)

SELECT
    gender,
    level,
    user_count
FROM user_subscriptions
  
[0m10:25:40.521824 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m10:25:40.584154 [debug] [Thread-1 (]: SQL status: SUCCESS in 0.0 seconds
[0m10:25:40.587163 [debug] [Thread-1 (]: On model.my_dbt_trino_project.stg_user_level_by_gender: ROLLBACK
[0m10:25:40.587163 [debug] [Thread-1 (]: On model.my_dbt_trino_project.stg_user_level_by_gender: Close
[0m10:25:40.588164 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'ccf74b2c-d71a-44ec-802a-51893ee310be', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000001C8EF93FA10>]}
[0m10:25:40.588164 [info ] [Thread-1 (]: 4 of 15 OK created sql view model analytics_stage.stg_user_level_by_gender ..... [[32mSUCCESS[0m in 0.08s]
[0m10:25:40.589244 [debug] [Thread-1 (]: Finished running node model.my_dbt_trino_project.stg_user_level_by_gender
[0m10:25:40.589244 [debug] [Thread-1 (]: Began running node model.my_dbt_trino_project.stg_streams_hourly
[0m10:25:40.590251 [info ] [Thread-1 (]: 5 of 15 START sql table model analytics_stage.stg_streams_hourly ............... [RUN]
[0m10:25:40.590251 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.my_dbt_trino_project.stg_user_level_by_gender, now model.my_dbt_trino_project.stg_streams_hourly)
[0m10:25:40.591251 [debug] [Thread-1 (]: Began compiling node model.my_dbt_trino_project.stg_streams_hourly
[0m10:25:40.593249 [debug] [Thread-1 (]: Writing injected SQL for node "model.my_dbt_trino_project.stg_streams_hourly"
[0m10:25:40.594252 [debug] [Thread-1 (]: Began executing node model.my_dbt_trino_project.stg_streams_hourly
[0m10:25:40.596259 [debug] [Thread-1 (]: Writing runtime sql for node "model.my_dbt_trino_project.stg_streams_hourly"
[0m10:25:40.598259 [debug] [Thread-1 (]: Using trino connection "model.my_dbt_trino_project.stg_streams_hourly"
[0m10:25:40.598259 [debug] [Thread-1 (]: On model.my_dbt_trino_project.stg_streams_hourly: /* {"app": "dbt", "dbt_version": "1.8.2", "profile_name": "my_dbt_trino_project", "target_name": "dev", "node_id": "model.my_dbt_trino_project.stg_streams_hourly"} */

  
    

    create table "datalake"."analytics_stage"."stg_streams_hourly__dbt_tmp"
      
      
    as (
      

SELECT
    DATE_FORMAT(FROM_UNIXTIME(ts), '%Y-%m-%d') AS stream_date, 
    DATE_FORMAT(FROM_UNIXTIME(ts), '%H') AS stream_hour,
    COUNT(*) AS total_streams
FROM "datalake"."analytics_source"."src_listen_events"
GROUP BY
    DATE_FORMAT(FROM_UNIXTIME(ts), '%Y-%m-%d'),
    DATE_FORMAT(FROM_UNIXTIME(ts), '%H')
    )
[0m10:25:40.598259 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m10:25:40.829706 [debug] [Thread-1 (]: SQL status: SUCCESS in 0.0 seconds
[0m10:25:40.832706 [debug] [Thread-1 (]: Using trino connection "model.my_dbt_trino_project.stg_streams_hourly"
[0m10:25:40.833261 [debug] [Thread-1 (]: On model.my_dbt_trino_project.stg_streams_hourly: /* {"app": "dbt", "dbt_version": "1.8.2", "profile_name": "my_dbt_trino_project", "target_name": "dev", "node_id": "model.my_dbt_trino_project.stg_streams_hourly"} */
alter table "datalake"."analytics_stage"."stg_streams_hourly" rename to "datalake"."analytics_stage"."stg_streams_hourly__dbt_backup"
[0m10:25:40.913838 [debug] [Thread-1 (]: SQL status: SUCCESS in 0.0 seconds
[0m10:25:40.916838 [debug] [Thread-1 (]: Using trino connection "model.my_dbt_trino_project.stg_streams_hourly"
[0m10:25:40.917837 [debug] [Thread-1 (]: On model.my_dbt_trino_project.stg_streams_hourly: /* {"app": "dbt", "dbt_version": "1.8.2", "profile_name": "my_dbt_trino_project", "target_name": "dev", "node_id": "model.my_dbt_trino_project.stg_streams_hourly"} */
alter table "datalake"."analytics_stage"."stg_streams_hourly__dbt_tmp" rename to "datalake"."analytics_stage"."stg_streams_hourly"
[0m10:25:41.005971 [debug] [Thread-1 (]: SQL status: SUCCESS in 0.0 seconds
[0m10:25:41.010081 [debug] [Thread-1 (]: Applying DROP to: "datalake"."analytics_stage"."stg_streams_hourly__dbt_backup"
[0m10:25:41.011085 [debug] [Thread-1 (]: Using trino connection "model.my_dbt_trino_project.stg_streams_hourly"
[0m10:25:41.012085 [debug] [Thread-1 (]: On model.my_dbt_trino_project.stg_streams_hourly: /* {"app": "dbt", "dbt_version": "1.8.2", "profile_name": "my_dbt_trino_project", "target_name": "dev", "node_id": "model.my_dbt_trino_project.stg_streams_hourly"} */

    drop table if exists "datalake"."analytics_stage"."stg_streams_hourly__dbt_backup"
[0m10:25:41.134976 [debug] [Thread-1 (]: SQL status: SUCCESS in 0.0 seconds
[0m10:25:41.136978 [debug] [Thread-1 (]: On model.my_dbt_trino_project.stg_streams_hourly: ROLLBACK
[0m10:25:41.136978 [debug] [Thread-1 (]: On model.my_dbt_trino_project.stg_streams_hourly: Close
[0m10:25:41.136978 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'ccf74b2c-d71a-44ec-802a-51893ee310be', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000001C8F075F2D0>]}
[0m10:25:41.138128 [info ] [Thread-1 (]: 5 of 15 OK created sql table model analytics_stage.stg_streams_hourly .......... [[32mSUCCESS[0m in 0.55s]
[0m10:25:41.138975 [debug] [Thread-1 (]: Finished running node model.my_dbt_trino_project.stg_streams_hourly
[0m10:25:41.139479 [debug] [Thread-1 (]: Began running node model.my_dbt_trino_project.stg_top_songs_artists
[0m10:25:41.139479 [info ] [Thread-1 (]: 6 of 15 START sql view model analytics_stage.stg_top_songs_artists ............. [RUN]
[0m10:25:41.140483 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.my_dbt_trino_project.stg_streams_hourly, now model.my_dbt_trino_project.stg_top_songs_artists)
[0m10:25:41.140483 [debug] [Thread-1 (]: Began compiling node model.my_dbt_trino_project.stg_top_songs_artists
[0m10:25:41.143486 [debug] [Thread-1 (]: Writing injected SQL for node "model.my_dbt_trino_project.stg_top_songs_artists"
[0m10:25:41.143486 [debug] [Thread-1 (]: Began executing node model.my_dbt_trino_project.stg_top_songs_artists
[0m10:25:41.146484 [debug] [Thread-1 (]: Writing runtime sql for node "model.my_dbt_trino_project.stg_top_songs_artists"
[0m10:25:41.147486 [debug] [Thread-1 (]: Using trino connection "model.my_dbt_trino_project.stg_top_songs_artists"
[0m10:25:41.147486 [debug] [Thread-1 (]: On model.my_dbt_trino_project.stg_top_songs_artists: /* {"app": "dbt", "dbt_version": "1.8.2", "profile_name": "my_dbt_trino_project", "target_name": "dev", "node_id": "model.my_dbt_trino_project.stg_top_songs_artists"} */

  create or replace view
    "datalake"."analytics_stage"."stg_top_songs_artists"
  security definer
  as
    

WITH song_plays AS (
    SELECT
        artist,
        song,
        COUNT(*) AS play_count
    FROM "datalake"."analytics_source"."src_listen_events"
    GROUP BY artist, song
)

SELECT
    artist,
    song,
    play_count
FROM song_plays
ORDER BY play_count DESC
  
[0m10:25:41.148485 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m10:25:41.219838 [debug] [Thread-1 (]: SQL status: SUCCESS in 0.0 seconds
[0m10:25:41.221844 [debug] [Thread-1 (]: On model.my_dbt_trino_project.stg_top_songs_artists: ROLLBACK
[0m10:25:41.221844 [debug] [Thread-1 (]: On model.my_dbt_trino_project.stg_top_songs_artists: Close
[0m10:25:41.222842 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'ccf74b2c-d71a-44ec-802a-51893ee310be', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000001C8F0633D10>]}
[0m10:25:41.222842 [info ] [Thread-1 (]: 6 of 15 OK created sql view model analytics_stage.stg_top_songs_artists ........ [[32mSUCCESS[0m in 0.08s]
[0m10:25:41.224066 [debug] [Thread-1 (]: Finished running node model.my_dbt_trino_project.stg_top_songs_artists
[0m10:25:41.224569 [debug] [Thread-1 (]: Began running node model.my_dbt_trino_project.stg_unique_users
[0m10:25:41.224569 [info ] [Thread-1 (]: 7 of 15 START sql view model analytics_stage.stg_unique_users .................. [RUN]
[0m10:25:41.225573 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.my_dbt_trino_project.stg_top_songs_artists, now model.my_dbt_trino_project.stg_unique_users)
[0m10:25:41.225573 [debug] [Thread-1 (]: Began compiling node model.my_dbt_trino_project.stg_unique_users
[0m10:25:41.228574 [debug] [Thread-1 (]: Writing injected SQL for node "model.my_dbt_trino_project.stg_unique_users"
[0m10:25:41.228574 [debug] [Thread-1 (]: Began executing node model.my_dbt_trino_project.stg_unique_users
[0m10:25:41.231573 [debug] [Thread-1 (]: Writing runtime sql for node "model.my_dbt_trino_project.stg_unique_users"
[0m10:25:41.232573 [debug] [Thread-1 (]: Using trino connection "model.my_dbt_trino_project.stg_unique_users"
[0m10:25:41.232573 [debug] [Thread-1 (]: On model.my_dbt_trino_project.stg_unique_users: /* {"app": "dbt", "dbt_version": "1.8.2", "profile_name": "my_dbt_trino_project", "target_name": "dev", "node_id": "model.my_dbt_trino_project.stg_unique_users"} */

  create or replace view
    "datalake"."analytics_stage"."stg_unique_users"
  security definer
  as
    

SELECT
    COUNT(DISTINCT userid) AS total_unique_users
FROM "datalake"."analytics_source"."src_listen_events"
WHERE userid IS NOT NULL
  
[0m10:25:41.232573 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m10:25:41.293026 [debug] [Thread-1 (]: SQL status: SUCCESS in 0.0 seconds
[0m10:25:41.294023 [debug] [Thread-1 (]: On model.my_dbt_trino_project.stg_unique_users: ROLLBACK
[0m10:25:41.295025 [debug] [Thread-1 (]: On model.my_dbt_trino_project.stg_unique_users: Close
[0m10:25:41.295025 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'ccf74b2c-d71a-44ec-802a-51893ee310be', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000001C8EF09CB10>]}
[0m10:25:41.296161 [info ] [Thread-1 (]: 7 of 15 OK created sql view model analytics_stage.stg_unique_users ............. [[32mSUCCESS[0m in 0.07s]
[0m10:25:41.296161 [debug] [Thread-1 (]: Finished running node model.my_dbt_trino_project.stg_unique_users
[0m10:25:41.297168 [debug] [Thread-1 (]: Began running node model.my_dbt_trino_project.stg_user_activity_per_country
[0m10:25:41.297168 [info ] [Thread-1 (]: 8 of 15 START sql view model analytics_stage.stg_user_activity_per_country ..... [RUN]
[0m10:25:41.298168 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.my_dbt_trino_project.stg_unique_users, now model.my_dbt_trino_project.stg_user_activity_per_country)
[0m10:25:41.298168 [debug] [Thread-1 (]: Began compiling node model.my_dbt_trino_project.stg_user_activity_per_country
[0m10:25:41.301168 [debug] [Thread-1 (]: Writing injected SQL for node "model.my_dbt_trino_project.stg_user_activity_per_country"
[0m10:25:41.302169 [debug] [Thread-1 (]: Began executing node model.my_dbt_trino_project.stg_user_activity_per_country
[0m10:25:41.304678 [debug] [Thread-1 (]: Writing runtime sql for node "model.my_dbt_trino_project.stg_user_activity_per_country"
[0m10:25:41.305691 [debug] [Thread-1 (]: Using trino connection "model.my_dbt_trino_project.stg_user_activity_per_country"
[0m10:25:41.306678 [debug] [Thread-1 (]: On model.my_dbt_trino_project.stg_user_activity_per_country: /* {"app": "dbt", "dbt_version": "1.8.2", "profile_name": "my_dbt_trino_project", "target_name": "dev", "node_id": "model.my_dbt_trino_project.stg_user_activity_per_country"} */

  create or replace view
    "datalake"."analytics_stage"."stg_user_activity_per_country"
  security definer
  as
    

WITH combined_activities AS (
  SELECT
    country,
    'listen_event' AS event_type,
    ts,
    userid
  FROM "datalake"."analytics_source"."src_listen_events"
  WHERE country IS NOT NULL
  UNION ALL
  SELECT
    'Unknown' AS country, 
    ts,
    userid
  FROM "datalake"."analytics_source"."src_auth_events"
  UNION ALL
  SELECT
    'Unknown' AS country, 
    'page_view_event' AS event_type,
    ts,
    userid
  FROM "datalake"."analytics_source"."src_page_view_events"
)

SELECT
  country,
  COUNT(*) AS activity_count
FROM combined_activities
GROUP BY country
  
[0m10:25:41.306678 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m10:25:41.361580 [debug] [Thread-1 (]: Trino adapter: Trino query id: 20240619_022541_00204_uxt54
[0m10:25:41.361580 [debug] [Thread-1 (]: Trino adapter: Trino error: TrinoUserError(type=USER_ERROR, name=TYPE_MISMATCH, message="line 17:3: UNION query has different number of fields: 4, 3", query_id=20240619_022541_00204_uxt54)
[0m10:25:41.361580 [debug] [Thread-1 (]: On model.my_dbt_trino_project.stg_user_activity_per_country: ROLLBACK
[0m10:25:41.362945 [debug] [Thread-1 (]: On model.my_dbt_trino_project.stg_user_activity_per_country: Close
[0m10:25:41.366146 [debug] [Thread-1 (]: Database Error in model stg_user_activity_per_country (models\stage\stg_user_activity_per_country.sql)
  TrinoUserError(type=USER_ERROR, name=TYPE_MISMATCH, message="line 17:3: UNION query has different number of fields: 4, 3", query_id=20240619_022541_00204_uxt54)
  compiled Code at target\run\my_dbt_trino_project\models\stage\stg_user_activity_per_country.sql
[0m10:25:41.367154 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'ccf74b2c-d71a-44ec-802a-51893ee310be', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000001C8F1BB7B90>]}
[0m10:25:41.367154 [error] [Thread-1 (]: 8 of 15 ERROR creating sql view model analytics_stage.stg_user_activity_per_country  [[31mERROR[0m in 0.07s]
[0m10:25:41.368332 [debug] [Thread-1 (]: Finished running node model.my_dbt_trino_project.stg_user_activity_per_country
[0m10:25:41.369339 [debug] [Thread-1 (]: Began running node model.my_dbt_trino_project.stg_user_activity_per_location
[0m10:25:41.369846 [info ] [Thread-1 (]: 9 of 15 START sql view model analytics_stage.stg_user_activity_per_location .... [RUN]
[0m10:25:41.369846 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.my_dbt_trino_project.stg_user_activity_per_country, now model.my_dbt_trino_project.stg_user_activity_per_location)
[0m10:25:41.370853 [debug] [Thread-1 (]: Began compiling node model.my_dbt_trino_project.stg_user_activity_per_location
[0m10:25:41.374035 [debug] [Thread-1 (]: Writing injected SQL for node "model.my_dbt_trino_project.stg_user_activity_per_location"
[0m10:25:41.374035 [debug] [Thread-1 (]: Began executing node model.my_dbt_trino_project.stg_user_activity_per_location
[0m10:25:41.377037 [debug] [Thread-1 (]: Writing runtime sql for node "model.my_dbt_trino_project.stg_user_activity_per_location"
[0m10:25:41.378290 [debug] [Thread-1 (]: Using trino connection "model.my_dbt_trino_project.stg_user_activity_per_location"
[0m10:25:41.379295 [debug] [Thread-1 (]: On model.my_dbt_trino_project.stg_user_activity_per_location: /* {"app": "dbt", "dbt_version": "1.8.2", "profile_name": "my_dbt_trino_project", "target_name": "dev", "node_id": "model.my_dbt_trino_project.stg_user_activity_per_location"} */

  create or replace view
    "datalake"."analytics_stage"."stg_user_activity_per_location"
  security definer
  as
    

WITH combined_activities AS (
  SELECT
    city,
    state,
    'auth_event' AS event_type,
    ts,
    userid
 FROM "datalake"."analytics_source"."src_auth_events"
  UNION ALL
  SELECT
    city,
    state,
    'listen_event' AS event_type,
    ts,
    userid
  FROM "datalake"."analytics_source"."src_listen_events"
  UNION ALL
  SELECT
    city,
    state,
    'page_view_event' AS event_type,
    ts,
    userid
  FROM "datalake"."analytics_source"."src_page_view_events"
)

SELECT
  state,
  city,
  COUNT(*) AS activity_count
FROM combined_activities
GROUP BY state, city
  
[0m10:25:41.379295 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m10:25:41.477278 [debug] [Thread-1 (]: SQL status: SUCCESS in 0.0 seconds
[0m10:25:41.479359 [debug] [Thread-1 (]: On model.my_dbt_trino_project.stg_user_activity_per_location: ROLLBACK
[0m10:25:41.480358 [debug] [Thread-1 (]: On model.my_dbt_trino_project.stg_user_activity_per_location: Close
[0m10:25:41.480358 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'ccf74b2c-d71a-44ec-802a-51893ee310be', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000001C8F0B77290>]}
[0m10:25:41.480358 [info ] [Thread-1 (]: 9 of 15 OK created sql view model analytics_stage.stg_user_activity_per_location  [[32mSUCCESS[0m in 0.11s]
[0m10:25:41.481768 [debug] [Thread-1 (]: Finished running node model.my_dbt_trino_project.stg_user_activity_per_location
[0m10:25:41.482774 [debug] [Thread-1 (]: Began running node model.my_dbt_trino_project.mart_user_level_by_gender
[0m10:25:41.482774 [info ] [Thread-1 (]: 10 of 15 START sql table model analytics.mart_user_level_by_gender ............. [RUN]
[0m10:25:41.483775 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.my_dbt_trino_project.stg_user_activity_per_location, now model.my_dbt_trino_project.mart_user_level_by_gender)
[0m10:25:41.484817 [debug] [Thread-1 (]: Began compiling node model.my_dbt_trino_project.mart_user_level_by_gender
[0m10:25:41.487876 [debug] [Thread-1 (]: Writing injected SQL for node "model.my_dbt_trino_project.mart_user_level_by_gender"
[0m10:25:41.488875 [debug] [Thread-1 (]: Began executing node model.my_dbt_trino_project.mart_user_level_by_gender
[0m10:25:41.492146 [debug] [Thread-1 (]: Writing runtime sql for node "model.my_dbt_trino_project.mart_user_level_by_gender"
[0m10:25:41.493607 [debug] [Thread-1 (]: Using trino connection "model.my_dbt_trino_project.mart_user_level_by_gender"
[0m10:25:41.493607 [debug] [Thread-1 (]: On model.my_dbt_trino_project.mart_user_level_by_gender: /* {"app": "dbt", "dbt_version": "1.8.2", "profile_name": "my_dbt_trino_project", "target_name": "dev", "node_id": "model.my_dbt_trino_project.mart_user_level_by_gender"} */

  
    

    create table "datalake"."analytics"."mart_user_level_by_gender__dbt_tmp"
      
      
    as (
      

SELECT
    gender,
    level,
    SUM(user_count) AS total_users,
    ROUND(SUM(user_count) * 100.0 / SUM(SUM(user_count)) OVER (), 2) AS percentage_of_total_users
FROM "datalake"."analytics_stage"."stg_user_level_by_gender"
GROUP BY gender, level
    )
[0m10:25:41.493607 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m10:25:41.758297 [debug] [Thread-1 (]: SQL status: SUCCESS in 0.0 seconds
[0m10:25:41.760303 [debug] [Thread-1 (]: Using trino connection "model.my_dbt_trino_project.mart_user_level_by_gender"
[0m10:25:41.761304 [debug] [Thread-1 (]: On model.my_dbt_trino_project.mart_user_level_by_gender: /* {"app": "dbt", "dbt_version": "1.8.2", "profile_name": "my_dbt_trino_project", "target_name": "dev", "node_id": "model.my_dbt_trino_project.mart_user_level_by_gender"} */
alter table "datalake"."analytics"."mart_user_level_by_gender" rename to "datalake"."analytics"."mart_user_level_by_gender__dbt_backup"
[0m10:25:41.841657 [debug] [Thread-1 (]: SQL status: SUCCESS in 0.0 seconds
[0m10:25:41.844667 [debug] [Thread-1 (]: Using trino connection "model.my_dbt_trino_project.mart_user_level_by_gender"
[0m10:25:41.844667 [debug] [Thread-1 (]: On model.my_dbt_trino_project.mart_user_level_by_gender: /* {"app": "dbt", "dbt_version": "1.8.2", "profile_name": "my_dbt_trino_project", "target_name": "dev", "node_id": "model.my_dbt_trino_project.mart_user_level_by_gender"} */
alter table "datalake"."analytics"."mart_user_level_by_gender__dbt_tmp" rename to "datalake"."analytics"."mart_user_level_by_gender"
[0m10:25:41.933440 [debug] [Thread-1 (]: SQL status: SUCCESS in 0.0 seconds
[0m10:25:41.935947 [debug] [Thread-1 (]: Applying DROP to: "datalake"."analytics"."mart_user_level_by_gender__dbt_backup"
[0m10:25:41.936950 [debug] [Thread-1 (]: Using trino connection "model.my_dbt_trino_project.mart_user_level_by_gender"
[0m10:25:41.936950 [debug] [Thread-1 (]: On model.my_dbt_trino_project.mart_user_level_by_gender: /* {"app": "dbt", "dbt_version": "1.8.2", "profile_name": "my_dbt_trino_project", "target_name": "dev", "node_id": "model.my_dbt_trino_project.mart_user_level_by_gender"} */

    drop table if exists "datalake"."analytics"."mart_user_level_by_gender__dbt_backup"
[0m10:25:42.060144 [debug] [Thread-1 (]: SQL status: SUCCESS in 0.0 seconds
[0m10:25:42.062144 [debug] [Thread-1 (]: On model.my_dbt_trino_project.mart_user_level_by_gender: ROLLBACK
[0m10:25:42.062144 [debug] [Thread-1 (]: On model.my_dbt_trino_project.mart_user_level_by_gender: Close
[0m10:25:42.063144 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'ccf74b2c-d71a-44ec-802a-51893ee310be', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000001C8F0B75F90>]}
[0m10:25:42.063144 [info ] [Thread-1 (]: 10 of 15 OK created sql table model analytics.mart_user_level_by_gender ........ [[32mSUCCESS[0m in 0.58s]
[0m10:25:42.064464 [debug] [Thread-1 (]: Finished running node model.my_dbt_trino_project.mart_user_level_by_gender
[0m10:25:42.064464 [debug] [Thread-1 (]: Began running node model.my_dbt_trino_project.mart_hourly_stream_evolution
[0m10:25:42.065473 [info ] [Thread-1 (]: 11 of 15 START sql table model analytics.mart_hourly_stream_evolution .......... [RUN]
[0m10:25:42.065473 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.my_dbt_trino_project.mart_user_level_by_gender, now model.my_dbt_trino_project.mart_hourly_stream_evolution)
[0m10:25:42.066470 [debug] [Thread-1 (]: Began compiling node model.my_dbt_trino_project.mart_hourly_stream_evolution
[0m10:25:42.068472 [debug] [Thread-1 (]: Writing injected SQL for node "model.my_dbt_trino_project.mart_hourly_stream_evolution"
[0m10:25:42.068472 [debug] [Thread-1 (]: Began executing node model.my_dbt_trino_project.mart_hourly_stream_evolution
[0m10:25:42.071869 [debug] [Thread-1 (]: Writing runtime sql for node "model.my_dbt_trino_project.mart_hourly_stream_evolution"
[0m10:25:42.071869 [debug] [Thread-1 (]: Using trino connection "model.my_dbt_trino_project.mart_hourly_stream_evolution"
[0m10:25:42.073216 [debug] [Thread-1 (]: On model.my_dbt_trino_project.mart_hourly_stream_evolution: /* {"app": "dbt", "dbt_version": "1.8.2", "profile_name": "my_dbt_trino_project", "target_name": "dev", "node_id": "model.my_dbt_trino_project.mart_hourly_stream_evolution"} */

  
    

    create table "datalake"."analytics"."mart_hourly_stream_evolution__dbt_tmp"
      
      
    as (
      

SELECT
    stream_date,
    stream_hour,
    total_streams,
    SUM(total_streams) OVER (PARTITION BY stream_date ORDER BY stream_hour) AS cumulative_streams
FROM "datalake"."analytics_stage"."stg_streams_hourly"
ORDER BY
    stream_date,
    stream_hour
    )
[0m10:25:42.073216 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m10:25:42.324303 [debug] [Thread-1 (]: SQL status: SUCCESS in 0.0 seconds
[0m10:25:42.328298 [debug] [Thread-1 (]: Using trino connection "model.my_dbt_trino_project.mart_hourly_stream_evolution"
[0m10:25:42.329297 [debug] [Thread-1 (]: On model.my_dbt_trino_project.mart_hourly_stream_evolution: /* {"app": "dbt", "dbt_version": "1.8.2", "profile_name": "my_dbt_trino_project", "target_name": "dev", "node_id": "model.my_dbt_trino_project.mart_hourly_stream_evolution"} */
alter table "datalake"."analytics"."mart_hourly_stream_evolution" rename to "datalake"."analytics"."mart_hourly_stream_evolution__dbt_backup"
[0m10:25:42.416834 [debug] [Thread-1 (]: SQL status: SUCCESS in 0.0 seconds
[0m10:25:42.419837 [debug] [Thread-1 (]: Using trino connection "model.my_dbt_trino_project.mart_hourly_stream_evolution"
[0m10:25:42.419837 [debug] [Thread-1 (]: On model.my_dbt_trino_project.mart_hourly_stream_evolution: /* {"app": "dbt", "dbt_version": "1.8.2", "profile_name": "my_dbt_trino_project", "target_name": "dev", "node_id": "model.my_dbt_trino_project.mart_hourly_stream_evolution"} */
alter table "datalake"."analytics"."mart_hourly_stream_evolution__dbt_tmp" rename to "datalake"."analytics"."mart_hourly_stream_evolution"
[0m10:25:42.505148 [debug] [Thread-1 (]: SQL status: SUCCESS in 0.0 seconds
[0m10:25:42.508148 [debug] [Thread-1 (]: Applying DROP to: "datalake"."analytics"."mart_hourly_stream_evolution__dbt_backup"
[0m10:25:42.509149 [debug] [Thread-1 (]: Using trino connection "model.my_dbt_trino_project.mart_hourly_stream_evolution"
[0m10:25:42.509149 [debug] [Thread-1 (]: On model.my_dbt_trino_project.mart_hourly_stream_evolution: /* {"app": "dbt", "dbt_version": "1.8.2", "profile_name": "my_dbt_trino_project", "target_name": "dev", "node_id": "model.my_dbt_trino_project.mart_hourly_stream_evolution"} */

    drop table if exists "datalake"."analytics"."mart_hourly_stream_evolution__dbt_backup"
[0m10:25:42.623690 [debug] [Thread-1 (]: SQL status: SUCCESS in 0.0 seconds
[0m10:25:42.624697 [debug] [Thread-1 (]: On model.my_dbt_trino_project.mart_hourly_stream_evolution: ROLLBACK
[0m10:25:42.625704 [debug] [Thread-1 (]: On model.my_dbt_trino_project.mart_hourly_stream_evolution: Close
[0m10:25:42.625704 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'ccf74b2c-d71a-44ec-802a-51893ee310be', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000001C8ED387D10>]}
[0m10:25:42.626711 [info ] [Thread-1 (]: 11 of 15 OK created sql table model analytics.mart_hourly_stream_evolution ..... [[32mSUCCESS[0m in 0.56s]
[0m10:25:42.627933 [debug] [Thread-1 (]: Finished running node model.my_dbt_trino_project.mart_hourly_stream_evolution
[0m10:25:42.627933 [debug] [Thread-1 (]: Began running node model.my_dbt_trino_project.mart_top_songs_artists
[0m10:25:42.628941 [info ] [Thread-1 (]: 12 of 15 START sql table model analytics.mart_top_songs_artists ................ [RUN]
[0m10:25:42.628941 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.my_dbt_trino_project.mart_hourly_stream_evolution, now model.my_dbt_trino_project.mart_top_songs_artists)
[0m10:25:42.628941 [debug] [Thread-1 (]: Began compiling node model.my_dbt_trino_project.mart_top_songs_artists
[0m10:25:42.633432 [debug] [Thread-1 (]: Writing injected SQL for node "model.my_dbt_trino_project.mart_top_songs_artists"
[0m10:25:42.633432 [debug] [Thread-1 (]: Began executing node model.my_dbt_trino_project.mart_top_songs_artists
[0m10:25:42.636937 [debug] [Thread-1 (]: Writing runtime sql for node "model.my_dbt_trino_project.mart_top_songs_artists"
[0m10:25:42.638182 [debug] [Thread-1 (]: Using trino connection "model.my_dbt_trino_project.mart_top_songs_artists"
[0m10:25:42.638182 [debug] [Thread-1 (]: On model.my_dbt_trino_project.mart_top_songs_artists: /* {"app": "dbt", "dbt_version": "1.8.2", "profile_name": "my_dbt_trino_project", "target_name": "dev", "node_id": "model.my_dbt_trino_project.mart_top_songs_artists"} */

  
    

    create table "datalake"."analytics"."mart_top_songs_artists__dbt_tmp"
      
      
    as (
      

WITH top_songs AS (
    SELECT
        artist,
        song,
        play_count
    FROM "datalake"."analytics_stage"."stg_top_songs_artists"
)

SELECT
    artist,
    song,
    play_count
FROM top_songs
    )
[0m10:25:42.639189 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m10:25:42.879442 [debug] [Thread-1 (]: SQL status: SUCCESS in 0.0 seconds
[0m10:25:42.882465 [debug] [Thread-1 (]: Using trino connection "model.my_dbt_trino_project.mart_top_songs_artists"
[0m10:25:42.882465 [debug] [Thread-1 (]: On model.my_dbt_trino_project.mart_top_songs_artists: /* {"app": "dbt", "dbt_version": "1.8.2", "profile_name": "my_dbt_trino_project", "target_name": "dev", "node_id": "model.my_dbt_trino_project.mart_top_songs_artists"} */
alter table "datalake"."analytics"."mart_top_songs_artists" rename to "datalake"."analytics"."mart_top_songs_artists__dbt_backup"
[0m10:25:42.963641 [debug] [Thread-1 (]: SQL status: SUCCESS in 0.0 seconds
[0m10:25:42.966641 [debug] [Thread-1 (]: Using trino connection "model.my_dbt_trino_project.mart_top_songs_artists"
[0m10:25:42.966641 [debug] [Thread-1 (]: On model.my_dbt_trino_project.mart_top_songs_artists: /* {"app": "dbt", "dbt_version": "1.8.2", "profile_name": "my_dbt_trino_project", "target_name": "dev", "node_id": "model.my_dbt_trino_project.mart_top_songs_artists"} */
alter table "datalake"."analytics"."mart_top_songs_artists__dbt_tmp" rename to "datalake"."analytics"."mart_top_songs_artists"
[0m10:25:43.056722 [debug] [Thread-1 (]: SQL status: SUCCESS in 0.0 seconds
[0m10:25:43.058823 [debug] [Thread-1 (]: Applying DROP to: "datalake"."analytics"."mart_top_songs_artists__dbt_backup"
[0m10:25:43.059822 [debug] [Thread-1 (]: Using trino connection "model.my_dbt_trino_project.mart_top_songs_artists"
[0m10:25:43.059822 [debug] [Thread-1 (]: On model.my_dbt_trino_project.mart_top_songs_artists: /* {"app": "dbt", "dbt_version": "1.8.2", "profile_name": "my_dbt_trino_project", "target_name": "dev", "node_id": "model.my_dbt_trino_project.mart_top_songs_artists"} */

    drop table if exists "datalake"."analytics"."mart_top_songs_artists__dbt_backup"
[0m10:25:43.174693 [debug] [Thread-1 (]: SQL status: SUCCESS in 0.0 seconds
[0m10:25:43.176696 [debug] [Thread-1 (]: On model.my_dbt_trino_project.mart_top_songs_artists: ROLLBACK
[0m10:25:43.176696 [debug] [Thread-1 (]: On model.my_dbt_trino_project.mart_top_songs_artists: Close
[0m10:25:43.177693 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'ccf74b2c-d71a-44ec-802a-51893ee310be', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000001C8F0B05390>]}
[0m10:25:43.177693 [info ] [Thread-1 (]: 12 of 15 OK created sql table model analytics.mart_top_songs_artists ........... [[32mSUCCESS[0m in 0.55s]
[0m10:25:43.178946 [debug] [Thread-1 (]: Finished running node model.my_dbt_trino_project.mart_top_songs_artists
[0m10:25:43.178946 [debug] [Thread-1 (]: Began running node model.my_dbt_trino_project.mart_total_unique_users
[0m10:25:43.179951 [info ] [Thread-1 (]: 13 of 15 START sql table model analytics.mart_total_unique_users ............... [RUN]
[0m10:25:43.179951 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.my_dbt_trino_project.mart_top_songs_artists, now model.my_dbt_trino_project.mart_total_unique_users)
[0m10:25:43.180951 [debug] [Thread-1 (]: Began compiling node model.my_dbt_trino_project.mart_total_unique_users
[0m10:25:43.182950 [debug] [Thread-1 (]: Writing injected SQL for node "model.my_dbt_trino_project.mart_total_unique_users"
[0m10:25:43.183951 [debug] [Thread-1 (]: Began executing node model.my_dbt_trino_project.mart_total_unique_users
[0m10:25:43.186455 [debug] [Thread-1 (]: Writing runtime sql for node "model.my_dbt_trino_project.mart_total_unique_users"
[0m10:25:43.187462 [debug] [Thread-1 (]: Using trino connection "model.my_dbt_trino_project.mart_total_unique_users"
[0m10:25:43.187462 [debug] [Thread-1 (]: On model.my_dbt_trino_project.mart_total_unique_users: /* {"app": "dbt", "dbt_version": "1.8.2", "profile_name": "my_dbt_trino_project", "target_name": "dev", "node_id": "model.my_dbt_trino_project.mart_total_unique_users"} */

  
    

    create table "datalake"."analytics"."mart_total_unique_users__dbt_tmp"
      
      
    as (
      

SELECT
    total_unique_users
FROM "datalake"."analytics_stage"."stg_unique_users"
    )
[0m10:25:43.188459 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m10:25:43.428306 [debug] [Thread-1 (]: SQL status: SUCCESS in 0.0 seconds
[0m10:25:43.431311 [debug] [Thread-1 (]: Using trino connection "model.my_dbt_trino_project.mart_total_unique_users"
[0m10:25:43.431311 [debug] [Thread-1 (]: On model.my_dbt_trino_project.mart_total_unique_users: /* {"app": "dbt", "dbt_version": "1.8.2", "profile_name": "my_dbt_trino_project", "target_name": "dev", "node_id": "model.my_dbt_trino_project.mart_total_unique_users"} */
alter table "datalake"."analytics"."mart_total_unique_users" rename to "datalake"."analytics"."mart_total_unique_users__dbt_backup"
[0m10:25:43.514525 [debug] [Thread-1 (]: SQL status: SUCCESS in 0.0 seconds
[0m10:25:43.516774 [debug] [Thread-1 (]: Using trino connection "model.my_dbt_trino_project.mart_total_unique_users"
[0m10:25:43.517954 [debug] [Thread-1 (]: On model.my_dbt_trino_project.mart_total_unique_users: /* {"app": "dbt", "dbt_version": "1.8.2", "profile_name": "my_dbt_trino_project", "target_name": "dev", "node_id": "model.my_dbt_trino_project.mart_total_unique_users"} */
alter table "datalake"."analytics"."mart_total_unique_users__dbt_tmp" rename to "datalake"."analytics"."mart_total_unique_users"
[0m10:25:43.608246 [debug] [Thread-1 (]: SQL status: SUCCESS in 0.0 seconds
[0m10:25:43.611246 [debug] [Thread-1 (]: Applying DROP to: "datalake"."analytics"."mart_total_unique_users__dbt_backup"
[0m10:25:43.612249 [debug] [Thread-1 (]: Using trino connection "model.my_dbt_trino_project.mart_total_unique_users"
[0m10:25:43.612249 [debug] [Thread-1 (]: On model.my_dbt_trino_project.mart_total_unique_users: /* {"app": "dbt", "dbt_version": "1.8.2", "profile_name": "my_dbt_trino_project", "target_name": "dev", "node_id": "model.my_dbt_trino_project.mart_total_unique_users"} */

    drop table if exists "datalake"."analytics"."mart_total_unique_users__dbt_backup"
[0m10:25:43.719350 [debug] [Thread-1 (]: SQL status: SUCCESS in 0.0 seconds
[0m10:25:43.720351 [debug] [Thread-1 (]: On model.my_dbt_trino_project.mart_total_unique_users: ROLLBACK
[0m10:25:43.721350 [debug] [Thread-1 (]: On model.my_dbt_trino_project.mart_total_unique_users: Close
[0m10:25:43.721350 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'ccf74b2c-d71a-44ec-802a-51893ee310be', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000001C8F06F5810>]}
[0m10:25:43.722352 [info ] [Thread-1 (]: 13 of 15 OK created sql table model analytics.mart_total_unique_users .......... [[32mSUCCESS[0m in 0.54s]
[0m10:25:43.723353 [debug] [Thread-1 (]: Finished running node model.my_dbt_trino_project.mart_total_unique_users
[0m10:25:43.723353 [debug] [Thread-1 (]: Began running node model.my_dbt_trino_project.mart_user_activity_per_country
[0m10:25:43.723353 [info ] [Thread-1 (]: 14 of 15 SKIP relation analytics.mart_user_activity_per_country ................ [[33mSKIP[0m]
[0m10:25:43.724350 [debug] [Thread-1 (]: Finished running node model.my_dbt_trino_project.mart_user_activity_per_country
[0m10:25:43.725350 [debug] [Thread-1 (]: Began running node model.my_dbt_trino_project.mart_user_activity_per_state
[0m10:25:43.725350 [info ] [Thread-1 (]: 15 of 15 START sql table model analytics.mart_user_activity_per_state .......... [RUN]
[0m10:25:43.726349 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.my_dbt_trino_project.mart_total_unique_users, now model.my_dbt_trino_project.mart_user_activity_per_state)
[0m10:25:43.726349 [debug] [Thread-1 (]: Began compiling node model.my_dbt_trino_project.mart_user_activity_per_state
[0m10:25:43.729350 [debug] [Thread-1 (]: Writing injected SQL for node "model.my_dbt_trino_project.mart_user_activity_per_state"
[0m10:25:43.729350 [debug] [Thread-1 (]: Began executing node model.my_dbt_trino_project.mart_user_activity_per_state
[0m10:25:43.732349 [debug] [Thread-1 (]: Writing runtime sql for node "model.my_dbt_trino_project.mart_user_activity_per_state"
[0m10:25:43.733349 [debug] [Thread-1 (]: Using trino connection "model.my_dbt_trino_project.mart_user_activity_per_state"
[0m10:25:43.733349 [debug] [Thread-1 (]: On model.my_dbt_trino_project.mart_user_activity_per_state: /* {"app": "dbt", "dbt_version": "1.8.2", "profile_name": "my_dbt_trino_project", "target_name": "dev", "node_id": "model.my_dbt_trino_project.mart_user_activity_per_state"} */

  
    

    create table "datalake"."analytics"."mart_user_activity_per_state__dbt_tmp"
      
      
    as (
      

SELECT
  state,
  city,
  SUM(activity_count) AS total_activity
FROM "datalake"."analytics_stage"."stg_user_activity_per_location"
GROUP BY state, city
ORDER BY state, SUM(activity_count) DESC
    )
[0m10:25:43.733349 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m10:25:43.988250 [debug] [Thread-1 (]: SQL status: SUCCESS in 0.0 seconds
[0m10:25:43.991266 [debug] [Thread-1 (]: Using trino connection "model.my_dbt_trino_project.mart_user_activity_per_state"
[0m10:25:43.992263 [debug] [Thread-1 (]: On model.my_dbt_trino_project.mart_user_activity_per_state: /* {"app": "dbt", "dbt_version": "1.8.2", "profile_name": "my_dbt_trino_project", "target_name": "dev", "node_id": "model.my_dbt_trino_project.mart_user_activity_per_state"} */
alter table "datalake"."analytics"."mart_user_activity_per_state" rename to "datalake"."analytics"."mart_user_activity_per_state__dbt_backup"
[0m10:25:44.081289 [debug] [Thread-1 (]: SQL status: SUCCESS in 0.0 seconds
[0m10:25:44.084295 [debug] [Thread-1 (]: Using trino connection "model.my_dbt_trino_project.mart_user_activity_per_state"
[0m10:25:44.084295 [debug] [Thread-1 (]: On model.my_dbt_trino_project.mart_user_activity_per_state: /* {"app": "dbt", "dbt_version": "1.8.2", "profile_name": "my_dbt_trino_project", "target_name": "dev", "node_id": "model.my_dbt_trino_project.mart_user_activity_per_state"} */
alter table "datalake"."analytics"."mart_user_activity_per_state__dbt_tmp" rename to "datalake"."analytics"."mart_user_activity_per_state"
[0m10:25:44.166141 [debug] [Thread-1 (]: SQL status: SUCCESS in 0.0 seconds
[0m10:25:44.169142 [debug] [Thread-1 (]: Applying DROP to: "datalake"."analytics"."mart_user_activity_per_state__dbt_backup"
[0m10:25:44.169142 [debug] [Thread-1 (]: Using trino connection "model.my_dbt_trino_project.mart_user_activity_per_state"
[0m10:25:44.170142 [debug] [Thread-1 (]: On model.my_dbt_trino_project.mart_user_activity_per_state: /* {"app": "dbt", "dbt_version": "1.8.2", "profile_name": "my_dbt_trino_project", "target_name": "dev", "node_id": "model.my_dbt_trino_project.mart_user_activity_per_state"} */

    drop table if exists "datalake"."analytics"."mart_user_activity_per_state__dbt_backup"
[0m10:25:44.291630 [debug] [Thread-1 (]: SQL status: SUCCESS in 0.0 seconds
[0m10:25:44.292632 [debug] [Thread-1 (]: On model.my_dbt_trino_project.mart_user_activity_per_state: ROLLBACK
[0m10:25:44.293628 [debug] [Thread-1 (]: On model.my_dbt_trino_project.mart_user_activity_per_state: Close
[0m10:25:44.293628 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'ccf74b2c-d71a-44ec-802a-51893ee310be', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000001C8F0ACC4D0>]}
[0m10:25:44.293628 [info ] [Thread-1 (]: 15 of 15 OK created sql table model analytics.mart_user_activity_per_state ..... [[32mSUCCESS[0m in 0.57s]
[0m10:25:44.295105 [debug] [Thread-1 (]: Finished running node model.my_dbt_trino_project.mart_user_activity_per_state
[0m10:25:44.296664 [debug] [MainThread]: On master: COMMIT
[0m10:25:44.296664 [debug] [MainThread]: Connection 'master' was properly closed.
[0m10:25:44.296664 [debug] [MainThread]: Connection 'list_datalake' was properly closed.
[0m10:25:44.297669 [debug] [MainThread]: Connection 'list_datalake_analytics_source' was properly closed.
[0m10:25:44.297669 [debug] [MainThread]: Connection 'model.my_dbt_trino_project.mart_user_activity_per_state' was properly closed.
[0m10:25:44.297669 [info ] [MainThread]: 
[0m10:25:44.297669 [info ] [MainThread]: Finished running 8 table models, 2 incremental models, 5 view models in 0 hours 0 minutes and 6.36 seconds (6.36s).
[0m10:25:44.300148 [debug] [MainThread]: Command end result
[0m10:25:44.334188 [info ] [MainThread]: 
[0m10:25:44.334188 [info ] [MainThread]: [31mCompleted with 1 error and 0 warnings:[0m
[0m10:25:44.335355 [info ] [MainThread]: 
[0m10:25:44.335355 [error] [MainThread]:   Database Error in model stg_user_activity_per_country (models\stage\stg_user_activity_per_country.sql)
  TrinoUserError(type=USER_ERROR, name=TYPE_MISMATCH, message="line 17:3: UNION query has different number of fields: 4, 3", query_id=20240619_022541_00204_uxt54)
  compiled Code at target\run\my_dbt_trino_project\models\stage\stg_user_activity_per_country.sql
[0m10:25:44.336577 [info ] [MainThread]: 
[0m10:25:44.337586 [info ] [MainThread]: Done. PASS=13 WARN=0 ERROR=1 SKIP=1 TOTAL=15
[0m10:25:44.338585 [debug] [MainThread]: Command `dbt run` failed at 10:25:44.338585 after 7.19 seconds
[0m10:25:44.338585 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000001C8ED5E0DD0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000001C8EF659B50>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000001C8EE687290>]}
[0m10:25:44.339680 [debug] [MainThread]: Flushing usage events
[0m10:26:01.474725 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x0000021585497D10>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x00000215850FF150>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x0000021585427A90>]}


============================== 10:26:01.476726 | 51601119-410f-4487-99cb-a029e2a377b3 ==============================
[0m10:26:01.476726 [info ] [MainThread]: Running with dbt=1.8.2
[0m10:26:01.478124 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'indirect_selection': 'eager', 'log_cache_events': 'False', 'write_json': 'True', 'partial_parse': 'True', 'cache_selected_only': 'False', 'warn_error': 'None', 'fail_fast': 'False', 'profiles_dir': 'C:\\Users\\ASUS\\Desktop\\work\\Iceberg-Dbt-Trino-Hive-modern-open-source-data-stack-main\\dbt', 'log_path': 'C:\\Users\\ASUS\\Desktop\\work\\Iceberg-Dbt-Trino-Hive-modern-open-source-data-stack-main\\dbt\\logs', 'debug': 'False', 'version_check': 'True', 'use_colors': 'True', 'use_experimental_parser': 'False', 'no_print': 'None', 'quiet': 'False', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'introspect': 'True', 'invocation_command': 'dbt run --models source', 'static_parser': 'True', 'target_path': 'None', 'log_format': 'default', 'send_anonymous_usage_stats': 'True'}
[0m10:26:01.772841 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': '51601119-410f-4487-99cb-a029e2a377b3', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x00000215858F3E90>]}
[0m10:26:01.805842 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': '51601119-410f-4487-99cb-a029e2a377b3', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x00000215825A5410>]}
[0m10:26:01.806842 [info ] [MainThread]: Registered adapter: trino=1.8.0
[0m10:26:01.817211 [debug] [MainThread]: checksum: f0a141b9de567cb7f131613ba2682f40b3a1c6a157f81c6e5435862eff68f109, vars: {}, profile: , target: , version: 1.8.2
[0m10:26:01.976310 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 0 files changed.
[0m10:26:01.977312 [debug] [MainThread]: Partial parsing enabled, no changes found, skipping parsing
[0m10:26:02.006312 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': '51601119-410f-4487-99cb-a029e2a377b3', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x0000021585929F50>]}
[0m10:26:02.077426 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': '51601119-410f-4487-99cb-a029e2a377b3', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x0000021585973ED0>]}
[0m10:26:02.077952 [info ] [MainThread]: Found 15 models, 7 data tests, 3 sources, 559 macros
[0m10:26:02.078473 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '51601119-410f-4487-99cb-a029e2a377b3', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000002158485C290>]}
[0m10:26:02.079514 [info ] [MainThread]: 
[0m10:26:02.080034 [debug] [MainThread]: Acquiring new trino connection 'master'
[0m10:26:02.083667 [debug] [ThreadPool]: Acquiring new trino connection 'list_datalake'
[0m10:26:02.143657 [debug] [ThreadPool]: Using trino connection "list_datalake"
[0m10:26:02.143657 [debug] [ThreadPool]: On list_datalake: /* {"app": "dbt", "dbt_version": "1.8.2", "profile_name": "my_dbt_trino_project", "target_name": "dev", "connection_name": "list_datalake"} */

    select schema_name
    from "datalake".INFORMATION_SCHEMA.schemata
[0m10:26:02.144661 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m10:26:02.187357 [debug] [ThreadPool]: SQL status: SUCCESS in 0.0 seconds
[0m10:26:02.188365 [debug] [ThreadPool]: On list_datalake: Close
[0m10:26:02.190365 [debug] [ThreadPool]: Acquiring new trino connection 'list_datalake_analytics_source'
[0m10:26:02.201362 [debug] [ThreadPool]: Using trino connection "list_datalake_analytics_source"
[0m10:26:02.201362 [debug] [ThreadPool]: On list_datalake_analytics_source: /* {"app": "dbt", "dbt_version": "1.8.2", "profile_name": "my_dbt_trino_project", "target_name": "dev", "connection_name": "list_datalake_analytics_source"} */
select
      t.table_catalog as database,
      t.table_name as name,
      t.table_schema as schema,
      case when mv.name is not null then 'materialized_view'
           when t.table_type = 'BASE TABLE' then 'table'
           when t.table_type = 'VIEW' then 'view'
           else t.table_type
      end as table_type
    from "datalake".INFORMATION_SCHEMA.tables t
    left join (
            select * from system.metadata.materialized_views
            where catalog_name = 'datalake'
              and schema_name = 'analytics_source') mv
          on mv.catalog_name = t.table_catalog and mv.schema_name = t.table_schema and mv.name = t.table_name
    where t.table_schema = 'analytics_source'
[0m10:26:02.202363 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m10:26:02.265352 [debug] [ThreadPool]: SQL status: SUCCESS in 0.0 seconds
[0m10:26:02.266914 [debug] [ThreadPool]: On list_datalake_analytics_source: ROLLBACK
[0m10:26:02.266914 [debug] [ThreadPool]: On list_datalake_analytics_source: Close
[0m10:26:02.267434 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_datalake_analytics_source, now list_datalake_analytics_stage)
[0m10:26:02.271092 [debug] [ThreadPool]: Using trino connection "list_datalake_analytics_stage"
[0m10:26:02.271619 [debug] [ThreadPool]: On list_datalake_analytics_stage: /* {"app": "dbt", "dbt_version": "1.8.2", "profile_name": "my_dbt_trino_project", "target_name": "dev", "connection_name": "list_datalake_analytics_stage"} */
select
      t.table_catalog as database,
      t.table_name as name,
      t.table_schema as schema,
      case when mv.name is not null then 'materialized_view'
           when t.table_type = 'BASE TABLE' then 'table'
           when t.table_type = 'VIEW' then 'view'
           else t.table_type
      end as table_type
    from "datalake".INFORMATION_SCHEMA.tables t
    left join (
            select * from system.metadata.materialized_views
            where catalog_name = 'datalake'
              and schema_name = 'analytics_stage') mv
          on mv.catalog_name = t.table_catalog and mv.schema_name = t.table_schema and mv.name = t.table_name
    where t.table_schema = 'analytics_stage'
[0m10:26:02.271619 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m10:26:02.326289 [debug] [ThreadPool]: SQL status: SUCCESS in 0.0 seconds
[0m10:26:02.327292 [debug] [ThreadPool]: On list_datalake_analytics_stage: ROLLBACK
[0m10:26:02.327292 [debug] [ThreadPool]: On list_datalake_analytics_stage: Close
[0m10:26:02.328290 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_datalake_analytics_stage, now list_datalake_analytics)
[0m10:26:02.331431 [debug] [ThreadPool]: Using trino connection "list_datalake_analytics"
[0m10:26:02.332431 [debug] [ThreadPool]: On list_datalake_analytics: /* {"app": "dbt", "dbt_version": "1.8.2", "profile_name": "my_dbt_trino_project", "target_name": "dev", "connection_name": "list_datalake_analytics"} */
select
      t.table_catalog as database,
      t.table_name as name,
      t.table_schema as schema,
      case when mv.name is not null then 'materialized_view'
           when t.table_type = 'BASE TABLE' then 'table'
           when t.table_type = 'VIEW' then 'view'
           else t.table_type
      end as table_type
    from "datalake".INFORMATION_SCHEMA.tables t
    left join (
            select * from system.metadata.materialized_views
            where catalog_name = 'datalake'
              and schema_name = 'analytics') mv
          on mv.catalog_name = t.table_catalog and mv.schema_name = t.table_schema and mv.name = t.table_name
    where t.table_schema = 'analytics'
[0m10:26:02.332431 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m10:26:02.371984 [debug] [ThreadPool]: SQL status: SUCCESS in 0.0 seconds
[0m10:26:02.372979 [debug] [ThreadPool]: On list_datalake_analytics: ROLLBACK
[0m10:26:02.372979 [debug] [ThreadPool]: On list_datalake_analytics: Close
[0m10:26:02.374984 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '51601119-410f-4487-99cb-a029e2a377b3', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x0000021585EAAC10>]}
[0m10:26:02.374984 [debug] [MainThread]: On master: COMMIT
[0m10:26:02.375983 [info ] [MainThread]: Concurrency: 1 threads (target='dev')
[0m10:26:02.375983 [info ] [MainThread]: 
[0m10:26:02.377980 [debug] [Thread-1 (]: Began running node model.my_dbt_trino_project.src_auth_events
[0m10:26:02.378979 [info ] [Thread-1 (]: 1 of 3 START sql table model analytics_source.src_auth_events .................. [RUN]
[0m10:26:02.379979 [debug] [Thread-1 (]: Acquiring new trino connection 'model.my_dbt_trino_project.src_auth_events'
[0m10:26:02.380484 [debug] [Thread-1 (]: Began compiling node model.my_dbt_trino_project.src_auth_events
[0m10:26:02.385489 [debug] [Thread-1 (]: Writing injected SQL for node "model.my_dbt_trino_project.src_auth_events"
[0m10:26:02.386489 [debug] [Thread-1 (]: Began executing node model.my_dbt_trino_project.src_auth_events
[0m10:26:02.415260 [debug] [Thread-1 (]: Writing runtime sql for node "model.my_dbt_trino_project.src_auth_events"
[0m10:26:02.419265 [debug] [Thread-1 (]: Using trino connection "model.my_dbt_trino_project.src_auth_events"
[0m10:26:02.419265 [debug] [Thread-1 (]: On model.my_dbt_trino_project.src_auth_events: /* {"app": "dbt", "dbt_version": "1.8.2", "profile_name": "my_dbt_trino_project", "target_name": "dev", "node_id": "model.my_dbt_trino_project.src_auth_events"} */

  
    

    create table "datalake"."analytics_source"."src_auth_events__dbt_tmp"
      
      
    as (
      

with source as (
    select
        CAST(ts AS VARCHAR) as id, 
        ts,
        CAST(sessionId AS VARCHAR) as sessionId,
        level,
        itemInSession,
        city,
        zip,
        state,
        userAgent,
        CAST(NULLIF(lon, '') AS double) as lon,
        CAST(NULLIF(lat, '') AS double) as lat,
        CAST(FLOOR(CAST(NULLIF(userId, '') AS DOUBLE)) AS INT) as userId, 
        lastName,
        firstName,
        gender,
        CAST(FLOOR(CAST(NULLIF(registration, '') AS DOUBLE)) AS BIGINT) as registration,
        success
    from "oltp"."public"."auth_events"
)

select
    id,
    ts,
    sessionId,
    level,
    itemInSession,
    city,
    zip,
    state,
    userAgent,
    lon,
    lat,
    userId,
    lastName,
    firstName,
    gender,
    registration, 
    CASE 
        WHEN CAST(success AS VARCHAR) = 't' THEN true 
        WHEN CAST(success AS VARCHAR) = 'f' THEN false
        ELSE NULL 
    END AS success_boolean
from source


    )
[0m10:26:02.420264 [debug] [Thread-1 (]: Opening a new connection, currently in state init
[0m10:26:02.641872 [debug] [Thread-1 (]: SQL status: SUCCESS in 0.0 seconds
[0m10:26:02.648390 [debug] [Thread-1 (]: Using trino connection "model.my_dbt_trino_project.src_auth_events"
[0m10:26:02.649389 [debug] [Thread-1 (]: On model.my_dbt_trino_project.src_auth_events: /* {"app": "dbt", "dbt_version": "1.8.2", "profile_name": "my_dbt_trino_project", "target_name": "dev", "node_id": "model.my_dbt_trino_project.src_auth_events"} */
alter table "datalake"."analytics_source"."src_auth_events" rename to "datalake"."analytics_source"."src_auth_events__dbt_backup"
[0m10:26:02.740905 [debug] [Thread-1 (]: SQL status: SUCCESS in 0.0 seconds
[0m10:26:02.743722 [debug] [Thread-1 (]: Using trino connection "model.my_dbt_trino_project.src_auth_events"
[0m10:26:02.743722 [debug] [Thread-1 (]: On model.my_dbt_trino_project.src_auth_events: /* {"app": "dbt", "dbt_version": "1.8.2", "profile_name": "my_dbt_trino_project", "target_name": "dev", "node_id": "model.my_dbt_trino_project.src_auth_events"} */
alter table "datalake"."analytics_source"."src_auth_events__dbt_tmp" rename to "datalake"."analytics_source"."src_auth_events"
[0m10:26:02.825498 [debug] [Thread-1 (]: SQL status: SUCCESS in 0.0 seconds
[0m10:26:02.830505 [debug] [Thread-1 (]: Applying DROP to: "datalake"."analytics_source"."src_auth_events__dbt_backup"
[0m10:26:02.832505 [debug] [Thread-1 (]: Using trino connection "model.my_dbt_trino_project.src_auth_events"
[0m10:26:02.832505 [debug] [Thread-1 (]: On model.my_dbt_trino_project.src_auth_events: /* {"app": "dbt", "dbt_version": "1.8.2", "profile_name": "my_dbt_trino_project", "target_name": "dev", "node_id": "model.my_dbt_trino_project.src_auth_events"} */

    drop table if exists "datalake"."analytics_source"."src_auth_events__dbt_backup"
[0m10:26:02.936847 [debug] [Thread-1 (]: SQL status: SUCCESS in 0.0 seconds
[0m10:26:02.948394 [debug] [Thread-1 (]: On model.my_dbt_trino_project.src_auth_events: ROLLBACK
[0m10:26:02.948394 [debug] [Thread-1 (]: On model.my_dbt_trino_project.src_auth_events: Close
[0m10:26:02.950380 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '51601119-410f-4487-99cb-a029e2a377b3', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x00000215862FB210>]}
[0m10:26:02.950380 [info ] [Thread-1 (]: 1 of 3 OK created sql table model analytics_source.src_auth_events ............. [[32mSUCCESS[0m in 0.57s]
[0m10:26:02.951375 [debug] [Thread-1 (]: Finished running node model.my_dbt_trino_project.src_auth_events
[0m10:26:02.951375 [debug] [Thread-1 (]: Began running node model.my_dbt_trino_project.src_listen_events
[0m10:26:02.952375 [info ] [Thread-1 (]: 2 of 3 START sql incremental model analytics_source.src_listen_events .......... [RUN]
[0m10:26:02.952806 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.my_dbt_trino_project.src_auth_events, now model.my_dbt_trino_project.src_listen_events)
[0m10:26:02.952806 [debug] [Thread-1 (]: Began compiling node model.my_dbt_trino_project.src_listen_events
[0m10:26:02.956816 [debug] [Thread-1 (]: Writing injected SQL for node "model.my_dbt_trino_project.src_listen_events"
[0m10:26:02.957819 [debug] [Thread-1 (]: Began executing node model.my_dbt_trino_project.src_listen_events
[0m10:26:02.981084 [debug] [Thread-1 (]: Using trino connection "model.my_dbt_trino_project.src_listen_events"
[0m10:26:02.982095 [debug] [Thread-1 (]: On model.my_dbt_trino_project.src_listen_events: /* {"app": "dbt", "dbt_version": "1.8.2", "profile_name": "my_dbt_trino_project", "target_name": "dev", "node_id": "model.my_dbt_trino_project.src_listen_events"} */

  
    

    create table "datalake"."analytics_source"."src_listen_events__dbt_tmp"
      
      
    as (
      

with source as (

    select
        CAST(_id AS VARCHAR) as id,
        artist,
        song,
        CAST(NULLIF(duration, '') AS DOUBLE) as duration,
        ts,
        sessionid,
        auth,
        level,
        CAST(NULLIF(itemInSession, '') AS INTEGER) as itemInSession,
        city,
        zip,
        state,
        country,
        userAgent,
        CAST(NULLIF(lon, '') AS DOUBLE) as lon,
        CAST(NULLIF(lat, '') AS DOUBLE) as lat,
        CAST(CAST(NULLIF(userId, '') AS DOUBLE) AS INTEGER) as userId,
 -- Assurez-vous que userId peut aussi être converti de cette manière.
        lastName,
        firstName,
        gender,
        CAST(CAST(NULLIF(registration, '') AS DOUBLE) AS BIGINT) as registration
    from "website"."demo"."listen_events"

)

select * from source



    -- this filter will only be applied on an incremental run
    where ts > (select max(ts) from "datalake"."analytics_source"."src_listen_events")


    )
[0m10:26:02.983093 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m10:26:03.138924 [debug] [Thread-1 (]: SQL status: SUCCESS in 0.0 seconds
[0m10:26:03.146143 [debug] [Thread-1 (]: Using trino connection "model.my_dbt_trino_project.src_listen_events"
[0m10:26:03.146143 [debug] [Thread-1 (]: On model.my_dbt_trino_project.src_listen_events: /* {"app": "dbt", "dbt_version": "1.8.2", "profile_name": "my_dbt_trino_project", "target_name": "dev", "node_id": "model.my_dbt_trino_project.src_listen_events"} */

    describe "datalake"."analytics_source"."src_listen_events__dbt_tmp"
[0m10:26:03.241892 [debug] [Thread-1 (]: SQL status: SUCCESS in 0.0 seconds
[0m10:26:03.245915 [debug] [Thread-1 (]: Using trino connection "model.my_dbt_trino_project.src_listen_events"
[0m10:26:03.245915 [debug] [Thread-1 (]: On model.my_dbt_trino_project.src_listen_events: /* {"app": "dbt", "dbt_version": "1.8.2", "profile_name": "my_dbt_trino_project", "target_name": "dev", "node_id": "model.my_dbt_trino_project.src_listen_events"} */

    describe "datalake"."analytics_source"."src_listen_events"
[0m10:26:03.333106 [debug] [Thread-1 (]: SQL status: SUCCESS in 0.0 seconds
[0m10:26:03.340100 [debug] [Thread-1 (]: Using trino connection "model.my_dbt_trino_project.src_listen_events"
[0m10:26:03.341100 [debug] [Thread-1 (]: On model.my_dbt_trino_project.src_listen_events: /* {"app": "dbt", "dbt_version": "1.8.2", "profile_name": "my_dbt_trino_project", "target_name": "dev", "node_id": "model.my_dbt_trino_project.src_listen_events"} */

    describe "datalake"."analytics_source"."src_listen_events"
[0m10:26:03.434076 [debug] [Thread-1 (]: SQL status: SUCCESS in 0.0 seconds
[0m10:26:03.442592 [debug] [Thread-1 (]: Writing runtime sql for node "model.my_dbt_trino_project.src_listen_events"
[0m10:26:03.444199 [debug] [Thread-1 (]: Using trino connection "model.my_dbt_trino_project.src_listen_events"
[0m10:26:03.444199 [debug] [Thread-1 (]: On model.my_dbt_trino_project.src_listen_events: /* {"app": "dbt", "dbt_version": "1.8.2", "profile_name": "my_dbt_trino_project", "target_name": "dev", "node_id": "model.my_dbt_trino_project.src_listen_events"} */
insert into "datalake"."analytics_source"."src_listen_events" ("id", "artist", "song", "duration", "ts", "sessionid", "auth", "level", "iteminsession", "city", "zip", "state", "country", "useragent", "lon", "lat", "userid", "lastname", "firstname", "gender", "registration")
    (
        select "id", "artist", "song", "duration", "ts", "sessionid", "auth", "level", "iteminsession", "city", "zip", "state", "country", "useragent", "lon", "lat", "userid", "lastname", "firstname", "gender", "registration"
        from "datalake"."analytics_source"."src_listen_events__dbt_tmp"
    )
[0m10:26:03.564284 [debug] [Thread-1 (]: SQL status: SUCCESS in 0.0 seconds
[0m10:26:03.566281 [debug] [Thread-1 (]: Applying DROP to: "datalake"."analytics_source"."src_listen_events__dbt_tmp"
[0m10:26:03.567283 [debug] [Thread-1 (]: Using trino connection "model.my_dbt_trino_project.src_listen_events"
[0m10:26:03.567283 [debug] [Thread-1 (]: On model.my_dbt_trino_project.src_listen_events: /* {"app": "dbt", "dbt_version": "1.8.2", "profile_name": "my_dbt_trino_project", "target_name": "dev", "node_id": "model.my_dbt_trino_project.src_listen_events"} */

    drop table if exists "datalake"."analytics_source"."src_listen_events__dbt_tmp"
[0m10:26:03.666317 [debug] [Thread-1 (]: SQL status: SUCCESS in 0.0 seconds
[0m10:26:03.667386 [debug] [Thread-1 (]: On model.my_dbt_trino_project.src_listen_events: ROLLBACK
[0m10:26:03.667386 [debug] [Thread-1 (]: On model.my_dbt_trino_project.src_listen_events: Close
[0m10:26:03.668391 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '51601119-410f-4487-99cb-a029e2a377b3', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x0000021585F1B150>]}
[0m10:26:03.669506 [info ] [Thread-1 (]: 2 of 3 OK created sql incremental model analytics_source.src_listen_events ..... [[32mSUCCESS[0m in 0.72s]
[0m10:26:03.669748 [debug] [Thread-1 (]: Finished running node model.my_dbt_trino_project.src_listen_events
[0m10:26:03.670260 [debug] [Thread-1 (]: Began running node model.my_dbt_trino_project.src_page_view_events
[0m10:26:03.670260 [info ] [Thread-1 (]: 3 of 3 START sql incremental model analytics_source.src_page_view_events ....... [RUN]
[0m10:26:03.671264 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.my_dbt_trino_project.src_listen_events, now model.my_dbt_trino_project.src_page_view_events)
[0m10:26:03.671264 [debug] [Thread-1 (]: Began compiling node model.my_dbt_trino_project.src_page_view_events
[0m10:26:03.674264 [debug] [Thread-1 (]: Writing injected SQL for node "model.my_dbt_trino_project.src_page_view_events"
[0m10:26:03.675264 [debug] [Thread-1 (]: Began executing node model.my_dbt_trino_project.src_page_view_events
[0m10:26:03.680266 [debug] [Thread-1 (]: Using trino connection "model.my_dbt_trino_project.src_page_view_events"
[0m10:26:03.680266 [debug] [Thread-1 (]: On model.my_dbt_trino_project.src_page_view_events: /* {"app": "dbt", "dbt_version": "1.8.2", "profile_name": "my_dbt_trino_project", "target_name": "dev", "node_id": "model.my_dbt_trino_project.src_page_view_events"} */

  
    

    create table "datalake"."analytics_source"."src_page_view_events__dbt_tmp"
      
      
    as (
      

with source as (
    select
        CAST(_id AS VARCHAR) as id,
        ts,
        CAST(sessionId AS VARCHAR) as sessionId,
        page,
        auth,
        level,
        CAST(CAST(NULLIF(itemInSession, '') AS DOUBLE) AS INTEGER) as itemInSession, 
        city,
        zip,
        state,
        userAgent,
        CAST(NULLIF(lon, '') AS double) as lon,
        CAST(NULLIF(lat, '') AS double) as lat,
        CAST(CAST(NULLIF(userId, '') AS DOUBLE) AS INTEGER) as userId, 
        lastName,
        firstName,
        gender,
        CAST(CAST(NULLIF(registration, '') AS DOUBLE) AS BIGINT) as registration, 
        artist,
        song,
        CAST(NULLIF(duration, '') AS double) as duration
    from "website"."demo"."page_view_events"
)

select * from source


    where ts > (select max(ts) from "datalake"."analytics_source"."src_page_view_events")

    )
[0m10:26:03.680266 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m10:26:03.830499 [debug] [Thread-1 (]: SQL status: SUCCESS in 0.0 seconds
[0m10:26:03.833147 [debug] [Thread-1 (]: Using trino connection "model.my_dbt_trino_project.src_page_view_events"
[0m10:26:03.833147 [debug] [Thread-1 (]: On model.my_dbt_trino_project.src_page_view_events: /* {"app": "dbt", "dbt_version": "1.8.2", "profile_name": "my_dbt_trino_project", "target_name": "dev", "node_id": "model.my_dbt_trino_project.src_page_view_events"} */

    describe "datalake"."analytics_source"."src_page_view_events__dbt_tmp"
[0m10:26:03.925198 [debug] [Thread-1 (]: SQL status: SUCCESS in 0.0 seconds
[0m10:26:03.928195 [debug] [Thread-1 (]: Using trino connection "model.my_dbt_trino_project.src_page_view_events"
[0m10:26:03.928195 [debug] [Thread-1 (]: On model.my_dbt_trino_project.src_page_view_events: /* {"app": "dbt", "dbt_version": "1.8.2", "profile_name": "my_dbt_trino_project", "target_name": "dev", "node_id": "model.my_dbt_trino_project.src_page_view_events"} */

    describe "datalake"."analytics_source"."src_page_view_events"
[0m10:26:04.024105 [debug] [Thread-1 (]: SQL status: SUCCESS in 0.0 seconds
[0m10:26:04.027126 [debug] [Thread-1 (]: Using trino connection "model.my_dbt_trino_project.src_page_view_events"
[0m10:26:04.027126 [debug] [Thread-1 (]: On model.my_dbt_trino_project.src_page_view_events: /* {"app": "dbt", "dbt_version": "1.8.2", "profile_name": "my_dbt_trino_project", "target_name": "dev", "node_id": "model.my_dbt_trino_project.src_page_view_events"} */

    describe "datalake"."analytics_source"."src_page_view_events"
[0m10:26:04.115135 [debug] [Thread-1 (]: SQL status: SUCCESS in 0.0 seconds
[0m10:26:04.117137 [debug] [Thread-1 (]: Writing runtime sql for node "model.my_dbt_trino_project.src_page_view_events"
[0m10:26:04.118135 [debug] [Thread-1 (]: Using trino connection "model.my_dbt_trino_project.src_page_view_events"
[0m10:26:04.119135 [debug] [Thread-1 (]: On model.my_dbt_trino_project.src_page_view_events: /* {"app": "dbt", "dbt_version": "1.8.2", "profile_name": "my_dbt_trino_project", "target_name": "dev", "node_id": "model.my_dbt_trino_project.src_page_view_events"} */
insert into "datalake"."analytics_source"."src_page_view_events" ("id", "ts", "sessionid", "page", "auth", "level", "iteminsession", "city", "zip", "state", "useragent", "lon", "lat", "userid", "lastname", "firstname", "gender", "registration", "artist", "song", "duration")
    (
        select "id", "ts", "sessionid", "page", "auth", "level", "iteminsession", "city", "zip", "state", "useragent", "lon", "lat", "userid", "lastname", "firstname", "gender", "registration", "artist", "song", "duration"
        from "datalake"."analytics_source"."src_page_view_events__dbt_tmp"
    )
[0m10:26:04.236185 [debug] [Thread-1 (]: SQL status: SUCCESS in 0.0 seconds
[0m10:26:04.239193 [debug] [Thread-1 (]: Applying DROP to: "datalake"."analytics_source"."src_page_view_events__dbt_tmp"
[0m10:26:04.240191 [debug] [Thread-1 (]: Using trino connection "model.my_dbt_trino_project.src_page_view_events"
[0m10:26:04.240191 [debug] [Thread-1 (]: On model.my_dbt_trino_project.src_page_view_events: /* {"app": "dbt", "dbt_version": "1.8.2", "profile_name": "my_dbt_trino_project", "target_name": "dev", "node_id": "model.my_dbt_trino_project.src_page_view_events"} */

    drop table if exists "datalake"."analytics_source"."src_page_view_events__dbt_tmp"
[0m10:26:04.343128 [debug] [Thread-1 (]: SQL status: SUCCESS in 0.0 seconds
[0m10:26:04.345455 [debug] [Thread-1 (]: On model.my_dbt_trino_project.src_page_view_events: ROLLBACK
[0m10:26:04.345455 [debug] [Thread-1 (]: On model.my_dbt_trino_project.src_page_view_events: Close
[0m10:26:04.345455 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '51601119-410f-4487-99cb-a029e2a377b3', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x00000215873BAB10>]}
[0m10:26:04.346891 [info ] [Thread-1 (]: 3 of 3 OK created sql incremental model analytics_source.src_page_view_events .. [[32mSUCCESS[0m in 0.67s]
[0m10:26:04.348076 [debug] [Thread-1 (]: Finished running node model.my_dbt_trino_project.src_page_view_events
[0m10:26:04.348076 [debug] [MainThread]: On master: COMMIT
[0m10:26:04.349564 [debug] [MainThread]: Connection 'master' was properly closed.
[0m10:26:04.349564 [debug] [MainThread]: Connection 'list_datalake' was properly closed.
[0m10:26:04.349564 [debug] [MainThread]: Connection 'list_datalake_analytics' was properly closed.
[0m10:26:04.349564 [debug] [MainThread]: Connection 'model.my_dbt_trino_project.src_page_view_events' was properly closed.
[0m10:26:04.350804 [info ] [MainThread]: 
[0m10:26:04.350804 [info ] [MainThread]: Finished running 1 table model, 2 incremental models in 0 hours 0 minutes and 2.27 seconds (2.27s).
[0m10:26:04.351814 [debug] [MainThread]: Command end result
[0m10:26:04.437098 [info ] [MainThread]: 
[0m10:26:04.438101 [info ] [MainThread]: [32mCompleted successfully[0m
[0m10:26:04.438101 [info ] [MainThread]: 
[0m10:26:04.439515 [info ] [MainThread]: Done. PASS=3 WARN=0 ERROR=0 SKIP=0 TOTAL=3
[0m10:26:04.440596 [debug] [MainThread]: Command `dbt run` succeeded at 10:26:04.440596 after 3.09 seconds
[0m10:26:04.440596 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x0000021585851F90>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000002158583C150>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x00000215804DEED0>]}
[0m10:26:04.441887 [debug] [MainThread]: Flushing usage events
[0m10:26:15.186903 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000002AB6B6A7410>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000002AB690050D0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000002AB6B6A8790>]}


============================== 10:26:15.190057 | 5e1f980e-43fb-420a-9dda-506a892e9fcb ==============================
[0m10:26:15.190057 [info ] [MainThread]: Running with dbt=1.8.2
[0m10:26:15.191446 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'indirect_selection': 'eager', 'write_json': 'True', 'log_cache_events': 'False', 'partial_parse': 'True', 'cache_selected_only': 'False', 'warn_error': 'None', 'debug': 'False', 'version_check': 'True', 'log_path': 'C:\\Users\\ASUS\\Desktop\\work\\Iceberg-Dbt-Trino-Hive-modern-open-source-data-stack-main\\dbt\\logs', 'profiles_dir': 'C:\\Users\\ASUS\\Desktop\\work\\Iceberg-Dbt-Trino-Hive-modern-open-source-data-stack-main\\dbt', 'fail_fast': 'False', 'use_colors': 'True', 'use_experimental_parser': 'False', 'no_print': 'None', 'quiet': 'False', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'static_parser': 'True', 'invocation_command': 'dbt run --models marts', 'introspect': 'True', 'target_path': 'None', 'log_format': 'default', 'send_anonymous_usage_stats': 'True'}
[0m10:26:15.527871 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': '5e1f980e-43fb-420a-9dda-506a892e9fcb', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000002AB6BA4B710>]}
[0m10:26:15.565717 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': '5e1f980e-43fb-420a-9dda-506a892e9fcb', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000002AB68825550>]}
[0m10:26:15.566237 [info ] [MainThread]: Registered adapter: trino=1.8.0
[0m10:26:15.579624 [debug] [MainThread]: checksum: f0a141b9de567cb7f131613ba2682f40b3a1c6a157f81c6e5435862eff68f109, vars: {}, profile: , target: , version: 1.8.2
[0m10:26:15.739758 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 0 files changed.
[0m10:26:15.740264 [debug] [MainThread]: Partial parsing enabled, no changes found, skipping parsing
[0m10:26:15.769165 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': '5e1f980e-43fb-420a-9dda-506a892e9fcb', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000002AB6BCD8A50>]}
[0m10:26:15.835815 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': '5e1f980e-43fb-420a-9dda-506a892e9fcb', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000002AB6BBE3ED0>]}
[0m10:26:15.836337 [info ] [MainThread]: Found 15 models, 7 data tests, 3 sources, 559 macros
[0m10:26:15.836853 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '5e1f980e-43fb-420a-9dda-506a892e9fcb', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000002AB6BB70550>]}
[0m10:26:15.837918 [info ] [MainThread]: 
[0m10:26:15.838977 [debug] [MainThread]: Acquiring new trino connection 'master'
[0m10:26:15.842619 [debug] [ThreadPool]: Acquiring new trino connection 'list_datalake'
[0m10:26:15.898562 [debug] [ThreadPool]: Using trino connection "list_datalake"
[0m10:26:15.898562 [debug] [ThreadPool]: On list_datalake: /* {"app": "dbt", "dbt_version": "1.8.2", "profile_name": "my_dbt_trino_project", "target_name": "dev", "connection_name": "list_datalake"} */

    select schema_name
    from "datalake".INFORMATION_SCHEMA.schemata
[0m10:26:15.899568 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m10:26:15.943829 [debug] [ThreadPool]: SQL status: SUCCESS in 0.0 seconds
[0m10:26:15.944829 [debug] [ThreadPool]: On list_datalake: Close
[0m10:26:15.947163 [debug] [ThreadPool]: Acquiring new trino connection 'list_datalake_analytics_source'
[0m10:26:15.956708 [debug] [ThreadPool]: Using trino connection "list_datalake_analytics_source"
[0m10:26:15.957710 [debug] [ThreadPool]: On list_datalake_analytics_source: /* {"app": "dbt", "dbt_version": "1.8.2", "profile_name": "my_dbt_trino_project", "target_name": "dev", "connection_name": "list_datalake_analytics_source"} */
select
      t.table_catalog as database,
      t.table_name as name,
      t.table_schema as schema,
      case when mv.name is not null then 'materialized_view'
           when t.table_type = 'BASE TABLE' then 'table'
           when t.table_type = 'VIEW' then 'view'
           else t.table_type
      end as table_type
    from "datalake".INFORMATION_SCHEMA.tables t
    left join (
            select * from system.metadata.materialized_views
            where catalog_name = 'datalake'
              and schema_name = 'analytics_source') mv
          on mv.catalog_name = t.table_catalog and mv.schema_name = t.table_schema and mv.name = t.table_name
    where t.table_schema = 'analytics_source'
[0m10:26:15.957710 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m10:26:16.017727 [debug] [ThreadPool]: SQL status: SUCCESS in 0.0 seconds
[0m10:26:16.018727 [debug] [ThreadPool]: On list_datalake_analytics_source: ROLLBACK
[0m10:26:16.019727 [debug] [ThreadPool]: On list_datalake_analytics_source: Close
[0m10:26:16.019727 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_datalake_analytics_source, now list_datalake_analytics)
[0m10:26:16.023161 [debug] [ThreadPool]: Using trino connection "list_datalake_analytics"
[0m10:26:16.024160 [debug] [ThreadPool]: On list_datalake_analytics: /* {"app": "dbt", "dbt_version": "1.8.2", "profile_name": "my_dbt_trino_project", "target_name": "dev", "connection_name": "list_datalake_analytics"} */
select
      t.table_catalog as database,
      t.table_name as name,
      t.table_schema as schema,
      case when mv.name is not null then 'materialized_view'
           when t.table_type = 'BASE TABLE' then 'table'
           when t.table_type = 'VIEW' then 'view'
           else t.table_type
      end as table_type
    from "datalake".INFORMATION_SCHEMA.tables t
    left join (
            select * from system.metadata.materialized_views
            where catalog_name = 'datalake'
              and schema_name = 'analytics') mv
          on mv.catalog_name = t.table_catalog and mv.schema_name = t.table_schema and mv.name = t.table_name
    where t.table_schema = 'analytics'
[0m10:26:16.024160 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m10:26:16.081809 [debug] [ThreadPool]: SQL status: SUCCESS in 0.0 seconds
[0m10:26:16.082818 [debug] [ThreadPool]: On list_datalake_analytics: ROLLBACK
[0m10:26:16.083819 [debug] [ThreadPool]: On list_datalake_analytics: Close
[0m10:26:16.083819 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_datalake_analytics, now list_datalake_analytics_stage)
[0m10:26:16.087656 [debug] [ThreadPool]: Using trino connection "list_datalake_analytics_stage"
[0m10:26:16.088664 [debug] [ThreadPool]: On list_datalake_analytics_stage: /* {"app": "dbt", "dbt_version": "1.8.2", "profile_name": "my_dbt_trino_project", "target_name": "dev", "connection_name": "list_datalake_analytics_stage"} */
select
      t.table_catalog as database,
      t.table_name as name,
      t.table_schema as schema,
      case when mv.name is not null then 'materialized_view'
           when t.table_type = 'BASE TABLE' then 'table'
           when t.table_type = 'VIEW' then 'view'
           else t.table_type
      end as table_type
    from "datalake".INFORMATION_SCHEMA.tables t
    left join (
            select * from system.metadata.materialized_views
            where catalog_name = 'datalake'
              and schema_name = 'analytics_stage') mv
          on mv.catalog_name = t.table_catalog and mv.schema_name = t.table_schema and mv.name = t.table_name
    where t.table_schema = 'analytics_stage'
[0m10:26:16.088664 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m10:26:16.149560 [debug] [ThreadPool]: SQL status: SUCCESS in 0.0 seconds
[0m10:26:16.151076 [debug] [ThreadPool]: On list_datalake_analytics_stage: ROLLBACK
[0m10:26:16.151076 [debug] [ThreadPool]: On list_datalake_analytics_stage: Close
[0m10:26:16.153084 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '5e1f980e-43fb-420a-9dda-506a892e9fcb', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000002AB6BC19CD0>]}
[0m10:26:16.153593 [debug] [MainThread]: On master: COMMIT
[0m10:26:16.153593 [info ] [MainThread]: Concurrency: 1 threads (target='dev')
[0m10:26:16.154603 [info ] [MainThread]: 
[0m10:26:16.156608 [debug] [Thread-1 (]: Began running node model.my_dbt_trino_project.mart_hourly_stream_evolution
[0m10:26:16.157613 [info ] [Thread-1 (]: 1 of 6 START sql table model analytics.mart_hourly_stream_evolution ............ [RUN]
[0m10:26:16.157613 [debug] [Thread-1 (]: Acquiring new trino connection 'model.my_dbt_trino_project.mart_hourly_stream_evolution'
[0m10:26:16.158608 [debug] [Thread-1 (]: Began compiling node model.my_dbt_trino_project.mart_hourly_stream_evolution
[0m10:26:16.160608 [debug] [Thread-1 (]: Writing injected SQL for node "model.my_dbt_trino_project.mart_hourly_stream_evolution"
[0m10:26:16.161608 [debug] [Thread-1 (]: Began executing node model.my_dbt_trino_project.mart_hourly_stream_evolution
[0m10:26:16.191783 [debug] [Thread-1 (]: Writing runtime sql for node "model.my_dbt_trino_project.mart_hourly_stream_evolution"
[0m10:26:16.192789 [debug] [Thread-1 (]: Using trino connection "model.my_dbt_trino_project.mart_hourly_stream_evolution"
[0m10:26:16.193787 [debug] [Thread-1 (]: On model.my_dbt_trino_project.mart_hourly_stream_evolution: /* {"app": "dbt", "dbt_version": "1.8.2", "profile_name": "my_dbt_trino_project", "target_name": "dev", "node_id": "model.my_dbt_trino_project.mart_hourly_stream_evolution"} */

  
    

    create table "datalake"."analytics"."mart_hourly_stream_evolution__dbt_tmp"
      
      
    as (
      

SELECT
    stream_date,
    stream_hour,
    total_streams,
    SUM(total_streams) OVER (PARTITION BY stream_date ORDER BY stream_hour) AS cumulative_streams
FROM "datalake"."analytics_stage"."stg_streams_hourly"
ORDER BY
    stream_date,
    stream_hour
    )
[0m10:26:16.193787 [debug] [Thread-1 (]: Opening a new connection, currently in state init
[0m10:26:16.421872 [debug] [Thread-1 (]: SQL status: SUCCESS in 0.0 seconds
[0m10:26:16.427873 [debug] [Thread-1 (]: Using trino connection "model.my_dbt_trino_project.mart_hourly_stream_evolution"
[0m10:26:16.427873 [debug] [Thread-1 (]: On model.my_dbt_trino_project.mart_hourly_stream_evolution: /* {"app": "dbt", "dbt_version": "1.8.2", "profile_name": "my_dbt_trino_project", "target_name": "dev", "node_id": "model.my_dbt_trino_project.mart_hourly_stream_evolution"} */
alter table "datalake"."analytics"."mart_hourly_stream_evolution" rename to "datalake"."analytics"."mart_hourly_stream_evolution__dbt_backup"
[0m10:26:16.514528 [debug] [Thread-1 (]: SQL status: SUCCESS in 0.0 seconds
[0m10:26:16.517535 [debug] [Thread-1 (]: Using trino connection "model.my_dbt_trino_project.mart_hourly_stream_evolution"
[0m10:26:16.518534 [debug] [Thread-1 (]: On model.my_dbt_trino_project.mart_hourly_stream_evolution: /* {"app": "dbt", "dbt_version": "1.8.2", "profile_name": "my_dbt_trino_project", "target_name": "dev", "node_id": "model.my_dbt_trino_project.mart_hourly_stream_evolution"} */
alter table "datalake"."analytics"."mart_hourly_stream_evolution__dbt_tmp" rename to "datalake"."analytics"."mart_hourly_stream_evolution"
[0m10:26:16.612620 [debug] [Thread-1 (]: SQL status: SUCCESS in 0.0 seconds
[0m10:26:16.617623 [debug] [Thread-1 (]: Applying DROP to: "datalake"."analytics"."mart_hourly_stream_evolution__dbt_backup"
[0m10:26:16.619623 [debug] [Thread-1 (]: Using trino connection "model.my_dbt_trino_project.mart_hourly_stream_evolution"
[0m10:26:16.620623 [debug] [Thread-1 (]: On model.my_dbt_trino_project.mart_hourly_stream_evolution: /* {"app": "dbt", "dbt_version": "1.8.2", "profile_name": "my_dbt_trino_project", "target_name": "dev", "node_id": "model.my_dbt_trino_project.mart_hourly_stream_evolution"} */

    drop table if exists "datalake"."analytics"."mart_hourly_stream_evolution__dbt_backup"
[0m10:26:16.746589 [debug] [Thread-1 (]: SQL status: SUCCESS in 0.0 seconds
[0m10:26:16.760402 [debug] [Thread-1 (]: On model.my_dbt_trino_project.mart_hourly_stream_evolution: ROLLBACK
[0m10:26:16.760402 [debug] [Thread-1 (]: On model.my_dbt_trino_project.mart_hourly_stream_evolution: Close
[0m10:26:16.762397 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '5e1f980e-43fb-420a-9dda-506a892e9fcb', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000002AB6D098210>]}
[0m10:26:16.762397 [info ] [Thread-1 (]: 1 of 6 OK created sql table model analytics.mart_hourly_stream_evolution ....... [[32mSUCCESS[0m in 0.60s]
[0m10:26:16.763396 [debug] [Thread-1 (]: Finished running node model.my_dbt_trino_project.mart_hourly_stream_evolution
[0m10:26:16.764400 [debug] [Thread-1 (]: Began running node model.my_dbt_trino_project.mart_top_songs_artists
[0m10:26:16.764400 [info ] [Thread-1 (]: 2 of 6 START sql table model analytics.mart_top_songs_artists .................. [RUN]
[0m10:26:16.765398 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.my_dbt_trino_project.mart_hourly_stream_evolution, now model.my_dbt_trino_project.mart_top_songs_artists)
[0m10:26:16.765398 [debug] [Thread-1 (]: Began compiling node model.my_dbt_trino_project.mart_top_songs_artists
[0m10:26:16.768599 [debug] [Thread-1 (]: Writing injected SQL for node "model.my_dbt_trino_project.mart_top_songs_artists"
[0m10:26:16.768599 [debug] [Thread-1 (]: Began executing node model.my_dbt_trino_project.mart_top_songs_artists
[0m10:26:16.771596 [debug] [Thread-1 (]: Writing runtime sql for node "model.my_dbt_trino_project.mart_top_songs_artists"
[0m10:26:16.772596 [debug] [Thread-1 (]: Using trino connection "model.my_dbt_trino_project.mart_top_songs_artists"
[0m10:26:16.772596 [debug] [Thread-1 (]: On model.my_dbt_trino_project.mart_top_songs_artists: /* {"app": "dbt", "dbt_version": "1.8.2", "profile_name": "my_dbt_trino_project", "target_name": "dev", "node_id": "model.my_dbt_trino_project.mart_top_songs_artists"} */

  
    

    create table "datalake"."analytics"."mart_top_songs_artists__dbt_tmp"
      
      
    as (
      

WITH top_songs AS (
    SELECT
        artist,
        song,
        play_count
    FROM "datalake"."analytics_stage"."stg_top_songs_artists"
)

SELECT
    artist,
    song,
    play_count
FROM top_songs
    )
[0m10:26:16.773598 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m10:26:17.014932 [debug] [Thread-1 (]: SQL status: SUCCESS in 0.0 seconds
[0m10:26:17.017945 [debug] [Thread-1 (]: Using trino connection "model.my_dbt_trino_project.mart_top_songs_artists"
[0m10:26:17.017945 [debug] [Thread-1 (]: On model.my_dbt_trino_project.mart_top_songs_artists: /* {"app": "dbt", "dbt_version": "1.8.2", "profile_name": "my_dbt_trino_project", "target_name": "dev", "node_id": "model.my_dbt_trino_project.mart_top_songs_artists"} */
alter table "datalake"."analytics"."mart_top_songs_artists" rename to "datalake"."analytics"."mart_top_songs_artists__dbt_backup"
[0m10:26:17.112388 [debug] [Thread-1 (]: SQL status: SUCCESS in 0.0 seconds
[0m10:26:17.115389 [debug] [Thread-1 (]: Using trino connection "model.my_dbt_trino_project.mart_top_songs_artists"
[0m10:26:17.115389 [debug] [Thread-1 (]: On model.my_dbt_trino_project.mart_top_songs_artists: /* {"app": "dbt", "dbt_version": "1.8.2", "profile_name": "my_dbt_trino_project", "target_name": "dev", "node_id": "model.my_dbt_trino_project.mart_top_songs_artists"} */
alter table "datalake"."analytics"."mart_top_songs_artists__dbt_tmp" rename to "datalake"."analytics"."mart_top_songs_artists"
[0m10:26:17.203760 [debug] [Thread-1 (]: SQL status: SUCCESS in 0.0 seconds
[0m10:26:17.206319 [debug] [Thread-1 (]: Applying DROP to: "datalake"."analytics"."mart_top_songs_artists__dbt_backup"
[0m10:26:17.207328 [debug] [Thread-1 (]: Using trino connection "model.my_dbt_trino_project.mart_top_songs_artists"
[0m10:26:17.207328 [debug] [Thread-1 (]: On model.my_dbt_trino_project.mart_top_songs_artists: /* {"app": "dbt", "dbt_version": "1.8.2", "profile_name": "my_dbt_trino_project", "target_name": "dev", "node_id": "model.my_dbt_trino_project.mart_top_songs_artists"} */

    drop table if exists "datalake"."analytics"."mart_top_songs_artists__dbt_backup"
[0m10:26:17.319369 [debug] [Thread-1 (]: SQL status: SUCCESS in 0.0 seconds
[0m10:26:17.320369 [debug] [Thread-1 (]: On model.my_dbt_trino_project.mart_top_songs_artists: ROLLBACK
[0m10:26:17.321369 [debug] [Thread-1 (]: On model.my_dbt_trino_project.mart_top_songs_artists: Close
[0m10:26:17.321369 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '5e1f980e-43fb-420a-9dda-506a892e9fcb', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000002AB6BCDAC10>]}
[0m10:26:17.321369 [info ] [Thread-1 (]: 2 of 6 OK created sql table model analytics.mart_top_songs_artists ............. [[32mSUCCESS[0m in 0.56s]
[0m10:26:17.322875 [debug] [Thread-1 (]: Finished running node model.my_dbt_trino_project.mart_top_songs_artists
[0m10:26:17.322875 [debug] [Thread-1 (]: Began running node model.my_dbt_trino_project.mart_total_unique_users
[0m10:26:17.323882 [info ] [Thread-1 (]: 3 of 6 START sql table model analytics.mart_total_unique_users ................. [RUN]
[0m10:26:17.323882 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.my_dbt_trino_project.mart_top_songs_artists, now model.my_dbt_trino_project.mart_total_unique_users)
[0m10:26:17.324881 [debug] [Thread-1 (]: Began compiling node model.my_dbt_trino_project.mart_total_unique_users
[0m10:26:17.326387 [debug] [Thread-1 (]: Writing injected SQL for node "model.my_dbt_trino_project.mart_total_unique_users"
[0m10:26:17.327394 [debug] [Thread-1 (]: Began executing node model.my_dbt_trino_project.mart_total_unique_users
[0m10:26:17.331398 [debug] [Thread-1 (]: Writing runtime sql for node "model.my_dbt_trino_project.mart_total_unique_users"
[0m10:26:17.331906 [debug] [Thread-1 (]: Using trino connection "model.my_dbt_trino_project.mart_total_unique_users"
[0m10:26:17.332917 [debug] [Thread-1 (]: On model.my_dbt_trino_project.mart_total_unique_users: /* {"app": "dbt", "dbt_version": "1.8.2", "profile_name": "my_dbt_trino_project", "target_name": "dev", "node_id": "model.my_dbt_trino_project.mart_total_unique_users"} */

  
    

    create table "datalake"."analytics"."mart_total_unique_users__dbt_tmp"
      
      
    as (
      

SELECT
    total_unique_users
FROM "datalake"."analytics_stage"."stg_unique_users"
    )
[0m10:26:17.332917 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m10:26:17.567551 [debug] [Thread-1 (]: SQL status: SUCCESS in 0.0 seconds
[0m10:26:17.570694 [debug] [Thread-1 (]: Using trino connection "model.my_dbt_trino_project.mart_total_unique_users"
[0m10:26:17.571209 [debug] [Thread-1 (]: On model.my_dbt_trino_project.mart_total_unique_users: /* {"app": "dbt", "dbt_version": "1.8.2", "profile_name": "my_dbt_trino_project", "target_name": "dev", "node_id": "model.my_dbt_trino_project.mart_total_unique_users"} */
alter table "datalake"."analytics"."mart_total_unique_users" rename to "datalake"."analytics"."mart_total_unique_users__dbt_backup"
[0m10:26:17.660644 [debug] [Thread-1 (]: SQL status: SUCCESS in 0.0 seconds
[0m10:26:17.663649 [debug] [Thread-1 (]: Using trino connection "model.my_dbt_trino_project.mart_total_unique_users"
[0m10:26:17.663649 [debug] [Thread-1 (]: On model.my_dbt_trino_project.mart_total_unique_users: /* {"app": "dbt", "dbt_version": "1.8.2", "profile_name": "my_dbt_trino_project", "target_name": "dev", "node_id": "model.my_dbt_trino_project.mart_total_unique_users"} */
alter table "datalake"."analytics"."mart_total_unique_users__dbt_tmp" rename to "datalake"."analytics"."mart_total_unique_users"
[0m10:26:17.740306 [debug] [Thread-1 (]: SQL status: SUCCESS in 0.0 seconds
[0m10:26:17.743315 [debug] [Thread-1 (]: Applying DROP to: "datalake"."analytics"."mart_total_unique_users__dbt_backup"
[0m10:26:17.744316 [debug] [Thread-1 (]: Using trino connection "model.my_dbt_trino_project.mart_total_unique_users"
[0m10:26:17.744876 [debug] [Thread-1 (]: On model.my_dbt_trino_project.mart_total_unique_users: /* {"app": "dbt", "dbt_version": "1.8.2", "profile_name": "my_dbt_trino_project", "target_name": "dev", "node_id": "model.my_dbt_trino_project.mart_total_unique_users"} */

    drop table if exists "datalake"."analytics"."mart_total_unique_users__dbt_backup"
[0m10:26:17.848711 [debug] [Thread-1 (]: SQL status: SUCCESS in 0.0 seconds
[0m10:26:17.850840 [debug] [Thread-1 (]: On model.my_dbt_trino_project.mart_total_unique_users: ROLLBACK
[0m10:26:17.850840 [debug] [Thread-1 (]: On model.my_dbt_trino_project.mart_total_unique_users: Close
[0m10:26:17.851841 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '5e1f980e-43fb-420a-9dda-506a892e9fcb', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000002AB6D5DF850>]}
[0m10:26:17.851841 [info ] [Thread-1 (]: 3 of 6 OK created sql table model analytics.mart_total_unique_users ............ [[32mSUCCESS[0m in 0.53s]
[0m10:26:17.852841 [debug] [Thread-1 (]: Finished running node model.my_dbt_trino_project.mart_total_unique_users
[0m10:26:17.852841 [debug] [Thread-1 (]: Began running node model.my_dbt_trino_project.mart_user_activity_per_country
[0m10:26:17.852841 [info ] [Thread-1 (]: 4 of 6 START sql table model analytics.mart_user_activity_per_country .......... [RUN]
[0m10:26:17.854343 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.my_dbt_trino_project.mart_total_unique_users, now model.my_dbt_trino_project.mart_user_activity_per_country)
[0m10:26:17.854343 [debug] [Thread-1 (]: Began compiling node model.my_dbt_trino_project.mart_user_activity_per_country
[0m10:26:17.857353 [debug] [Thread-1 (]: Writing injected SQL for node "model.my_dbt_trino_project.mart_user_activity_per_country"
[0m10:26:17.857353 [debug] [Thread-1 (]: Began executing node model.my_dbt_trino_project.mart_user_activity_per_country
[0m10:26:17.860397 [debug] [Thread-1 (]: Writing runtime sql for node "model.my_dbt_trino_project.mart_user_activity_per_country"
[0m10:26:17.860397 [debug] [Thread-1 (]: Using trino connection "model.my_dbt_trino_project.mart_user_activity_per_country"
[0m10:26:17.861878 [debug] [Thread-1 (]: On model.my_dbt_trino_project.mart_user_activity_per_country: /* {"app": "dbt", "dbt_version": "1.8.2", "profile_name": "my_dbt_trino_project", "target_name": "dev", "node_id": "model.my_dbt_trino_project.mart_user_activity_per_country"} */

  
    

    create table "datalake"."analytics"."mart_user_activity_per_country__dbt_tmp"
      
      
    as (
      

SELECT
  country,
  SUM(activity_count) AS total_activity
FROM "datalake"."analytics_stage"."stg_user_activity_per_country"
GROUP BY country
ORDER BY SUM(activity_count) DESC
    )
[0m10:26:17.861878 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m10:26:17.900391 [debug] [Thread-1 (]: Trino adapter: Trino query id: 20240619_022617_00262_uxt54
[0m10:26:17.900391 [debug] [Thread-1 (]: Trino adapter: Trino error: TrinoUserError(type=USER_ERROR, name=TABLE_NOT_FOUND, message="line 15:6: Table 'datalake.analytics_stage.stg_user_activity_per_country' does not exist", query_id=20240619_022617_00262_uxt54)
[0m10:26:17.901395 [debug] [Thread-1 (]: On model.my_dbt_trino_project.mart_user_activity_per_country: ROLLBACK
[0m10:26:17.901395 [debug] [Thread-1 (]: On model.my_dbt_trino_project.mart_user_activity_per_country: Close
[0m10:26:17.905437 [debug] [Thread-1 (]: Database Error in model mart_user_activity_per_country (models\marts\mart_user_activity_per_country.sql)
  TrinoUserError(type=USER_ERROR, name=TABLE_NOT_FOUND, message="line 15:6: Table 'datalake.analytics_stage.stg_user_activity_per_country' does not exist", query_id=20240619_022617_00262_uxt54)
  compiled Code at target\run\my_dbt_trino_project\models\marts\mart_user_activity_per_country.sql
[0m10:26:17.905437 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '5e1f980e-43fb-420a-9dda-506a892e9fcb', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000002AB6D5D4710>]}
[0m10:26:17.906438 [error] [Thread-1 (]: 4 of 6 ERROR creating sql table model analytics.mart_user_activity_per_country . [[31mERROR[0m in 0.05s]
[0m10:26:17.907440 [debug] [Thread-1 (]: Finished running node model.my_dbt_trino_project.mart_user_activity_per_country
[0m10:26:17.907440 [debug] [Thread-1 (]: Began running node model.my_dbt_trino_project.mart_user_activity_per_state
[0m10:26:17.908437 [info ] [Thread-1 (]: 5 of 6 START sql table model analytics.mart_user_activity_per_state ............ [RUN]
[0m10:26:17.908437 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.my_dbt_trino_project.mart_user_activity_per_country, now model.my_dbt_trino_project.mart_user_activity_per_state)
[0m10:26:17.909436 [debug] [Thread-1 (]: Began compiling node model.my_dbt_trino_project.mart_user_activity_per_state
[0m10:26:17.911438 [debug] [Thread-1 (]: Writing injected SQL for node "model.my_dbt_trino_project.mart_user_activity_per_state"
[0m10:26:17.912437 [debug] [Thread-1 (]: Began executing node model.my_dbt_trino_project.mart_user_activity_per_state
[0m10:26:17.914437 [debug] [Thread-1 (]: Writing runtime sql for node "model.my_dbt_trino_project.mart_user_activity_per_state"
[0m10:26:17.916440 [debug] [Thread-1 (]: Using trino connection "model.my_dbt_trino_project.mart_user_activity_per_state"
[0m10:26:17.916440 [debug] [Thread-1 (]: On model.my_dbt_trino_project.mart_user_activity_per_state: /* {"app": "dbt", "dbt_version": "1.8.2", "profile_name": "my_dbt_trino_project", "target_name": "dev", "node_id": "model.my_dbt_trino_project.mart_user_activity_per_state"} */

  
    

    create table "datalake"."analytics"."mart_user_activity_per_state__dbt_tmp"
      
      
    as (
      

SELECT
  state,
  city,
  SUM(activity_count) AS total_activity
FROM "datalake"."analytics_stage"."stg_user_activity_per_location"
GROUP BY state, city
ORDER BY state, SUM(activity_count) DESC
    )
[0m10:26:17.916440 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m10:26:18.178073 [debug] [Thread-1 (]: SQL status: SUCCESS in 0.0 seconds
[0m10:26:18.181846 [debug] [Thread-1 (]: Using trino connection "model.my_dbt_trino_project.mart_user_activity_per_state"
[0m10:26:18.181846 [debug] [Thread-1 (]: On model.my_dbt_trino_project.mart_user_activity_per_state: /* {"app": "dbt", "dbt_version": "1.8.2", "profile_name": "my_dbt_trino_project", "target_name": "dev", "node_id": "model.my_dbt_trino_project.mart_user_activity_per_state"} */
alter table "datalake"."analytics"."mart_user_activity_per_state" rename to "datalake"."analytics"."mart_user_activity_per_state__dbt_backup"
[0m10:26:18.274892 [debug] [Thread-1 (]: SQL status: SUCCESS in 0.0 seconds
[0m10:26:18.280414 [debug] [Thread-1 (]: Using trino connection "model.my_dbt_trino_project.mart_user_activity_per_state"
[0m10:26:18.281415 [debug] [Thread-1 (]: On model.my_dbt_trino_project.mart_user_activity_per_state: /* {"app": "dbt", "dbt_version": "1.8.2", "profile_name": "my_dbt_trino_project", "target_name": "dev", "node_id": "model.my_dbt_trino_project.mart_user_activity_per_state"} */
alter table "datalake"."analytics"."mart_user_activity_per_state__dbt_tmp" rename to "datalake"."analytics"."mart_user_activity_per_state"
[0m10:26:18.379853 [debug] [Thread-1 (]: SQL status: SUCCESS in 0.0 seconds
[0m10:26:18.428923 [debug] [Thread-1 (]: Applying DROP to: "datalake"."analytics"."mart_user_activity_per_state__dbt_backup"
[0m10:26:18.429924 [debug] [Thread-1 (]: Using trino connection "model.my_dbt_trino_project.mart_user_activity_per_state"
[0m10:26:18.429924 [debug] [Thread-1 (]: On model.my_dbt_trino_project.mart_user_activity_per_state: /* {"app": "dbt", "dbt_version": "1.8.2", "profile_name": "my_dbt_trino_project", "target_name": "dev", "node_id": "model.my_dbt_trino_project.mart_user_activity_per_state"} */

    drop table if exists "datalake"."analytics"."mart_user_activity_per_state__dbt_backup"
[0m10:26:18.539632 [debug] [Thread-1 (]: SQL status: SUCCESS in 0.0 seconds
[0m10:26:18.541137 [debug] [Thread-1 (]: On model.my_dbt_trino_project.mart_user_activity_per_state: ROLLBACK
[0m10:26:18.541137 [debug] [Thread-1 (]: On model.my_dbt_trino_project.mart_user_activity_per_state: Close
[0m10:26:18.542141 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '5e1f980e-43fb-420a-9dda-506a892e9fcb', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000002AB6BD6B690>]}
[0m10:26:18.542141 [info ] [Thread-1 (]: 5 of 6 OK created sql table model analytics.mart_user_activity_per_state ....... [[32mSUCCESS[0m in 0.63s]
[0m10:26:18.543158 [debug] [Thread-1 (]: Finished running node model.my_dbt_trino_project.mart_user_activity_per_state
[0m10:26:18.544163 [debug] [Thread-1 (]: Began running node model.my_dbt_trino_project.mart_user_level_by_gender
[0m10:26:18.544163 [info ] [Thread-1 (]: 6 of 6 START sql table model analytics.mart_user_level_by_gender ............... [RUN]
[0m10:26:18.545163 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.my_dbt_trino_project.mart_user_activity_per_state, now model.my_dbt_trino_project.mart_user_level_by_gender)
[0m10:26:18.545163 [debug] [Thread-1 (]: Began compiling node model.my_dbt_trino_project.mart_user_level_by_gender
[0m10:26:18.547165 [debug] [Thread-1 (]: Writing injected SQL for node "model.my_dbt_trino_project.mart_user_level_by_gender"
[0m10:26:18.548163 [debug] [Thread-1 (]: Began executing node model.my_dbt_trino_project.mart_user_level_by_gender
[0m10:26:18.550163 [debug] [Thread-1 (]: Writing runtime sql for node "model.my_dbt_trino_project.mart_user_level_by_gender"
[0m10:26:18.552164 [debug] [Thread-1 (]: Using trino connection "model.my_dbt_trino_project.mart_user_level_by_gender"
[0m10:26:18.552164 [debug] [Thread-1 (]: On model.my_dbt_trino_project.mart_user_level_by_gender: /* {"app": "dbt", "dbt_version": "1.8.2", "profile_name": "my_dbt_trino_project", "target_name": "dev", "node_id": "model.my_dbt_trino_project.mart_user_level_by_gender"} */

  
    

    create table "datalake"."analytics"."mart_user_level_by_gender__dbt_tmp"
      
      
    as (
      

SELECT
    gender,
    level,
    SUM(user_count) AS total_users,
    ROUND(SUM(user_count) * 100.0 / SUM(SUM(user_count)) OVER (), 2) AS percentage_of_total_users
FROM "datalake"."analytics_stage"."stg_user_level_by_gender"
GROUP BY gender, level
    )
[0m10:26:18.552164 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m10:26:18.804181 [debug] [Thread-1 (]: SQL status: SUCCESS in 0.0 seconds
[0m10:26:18.807338 [debug] [Thread-1 (]: Using trino connection "model.my_dbt_trino_project.mart_user_level_by_gender"
[0m10:26:18.807338 [debug] [Thread-1 (]: On model.my_dbt_trino_project.mart_user_level_by_gender: /* {"app": "dbt", "dbt_version": "1.8.2", "profile_name": "my_dbt_trino_project", "target_name": "dev", "node_id": "model.my_dbt_trino_project.mart_user_level_by_gender"} */
alter table "datalake"."analytics"."mart_user_level_by_gender" rename to "datalake"."analytics"."mart_user_level_by_gender__dbt_backup"
[0m10:26:18.889432 [debug] [Thread-1 (]: SQL status: SUCCESS in 0.0 seconds
[0m10:26:18.892428 [debug] [Thread-1 (]: Using trino connection "model.my_dbt_trino_project.mart_user_level_by_gender"
[0m10:26:18.892428 [debug] [Thread-1 (]: On model.my_dbt_trino_project.mart_user_level_by_gender: /* {"app": "dbt", "dbt_version": "1.8.2", "profile_name": "my_dbt_trino_project", "target_name": "dev", "node_id": "model.my_dbt_trino_project.mart_user_level_by_gender"} */
alter table "datalake"."analytics"."mart_user_level_by_gender__dbt_tmp" rename to "datalake"."analytics"."mart_user_level_by_gender"
[0m10:26:18.971173 [debug] [Thread-1 (]: SQL status: SUCCESS in 0.0 seconds
[0m10:26:18.973179 [debug] [Thread-1 (]: Applying DROP to: "datalake"."analytics"."mart_user_level_by_gender__dbt_backup"
[0m10:26:18.974178 [debug] [Thread-1 (]: Using trino connection "model.my_dbt_trino_project.mart_user_level_by_gender"
[0m10:26:18.974178 [debug] [Thread-1 (]: On model.my_dbt_trino_project.mart_user_level_by_gender: /* {"app": "dbt", "dbt_version": "1.8.2", "profile_name": "my_dbt_trino_project", "target_name": "dev", "node_id": "model.my_dbt_trino_project.mart_user_level_by_gender"} */

    drop table if exists "datalake"."analytics"."mart_user_level_by_gender__dbt_backup"
[0m10:26:19.086591 [debug] [Thread-1 (]: SQL status: SUCCESS in 0.0 seconds
[0m10:26:19.088125 [debug] [Thread-1 (]: On model.my_dbt_trino_project.mart_user_level_by_gender: ROLLBACK
[0m10:26:19.088125 [debug] [Thread-1 (]: On model.my_dbt_trino_project.mart_user_level_by_gender: Close
[0m10:26:19.089124 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '5e1f980e-43fb-420a-9dda-506a892e9fcb', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000002AB6D6A5650>]}
[0m10:26:19.090123 [info ] [Thread-1 (]: 6 of 6 OK created sql table model analytics.mart_user_level_by_gender .......... [[32mSUCCESS[0m in 0.54s]
[0m10:26:19.090631 [debug] [Thread-1 (]: Finished running node model.my_dbt_trino_project.mart_user_level_by_gender
[0m10:26:19.091984 [debug] [MainThread]: On master: COMMIT
[0m10:26:19.091984 [debug] [MainThread]: Connection 'master' was properly closed.
[0m10:26:19.091984 [debug] [MainThread]: Connection 'list_datalake' was properly closed.
[0m10:26:19.092990 [debug] [MainThread]: Connection 'list_datalake_analytics_stage' was properly closed.
[0m10:26:19.092990 [debug] [MainThread]: Connection 'model.my_dbt_trino_project.mart_user_level_by_gender' was properly closed.
[0m10:26:19.092990 [info ] [MainThread]: 
[0m10:26:19.093993 [info ] [MainThread]: Finished running 6 table models in 0 hours 0 minutes and 3.25 seconds (3.25s).
[0m10:26:19.095100 [debug] [MainThread]: Command end result
[0m10:26:19.128147 [info ] [MainThread]: 
[0m10:26:19.129148 [info ] [MainThread]: [31mCompleted with 1 error and 0 warnings:[0m
[0m10:26:19.130147 [info ] [MainThread]: 
[0m10:26:19.130147 [error] [MainThread]:   Database Error in model mart_user_activity_per_country (models\marts\mart_user_activity_per_country.sql)
  TrinoUserError(type=USER_ERROR, name=TABLE_NOT_FOUND, message="line 15:6: Table 'datalake.analytics_stage.stg_user_activity_per_country' does not exist", query_id=20240619_022617_00262_uxt54)
  compiled Code at target\run\my_dbt_trino_project\models\marts\mart_user_activity_per_country.sql
[0m10:26:19.131654 [info ] [MainThread]: 
[0m10:26:19.132664 [info ] [MainThread]: Done. PASS=5 WARN=0 ERROR=1 SKIP=0 TOTAL=6
[0m10:26:19.133662 [debug] [MainThread]: Command `dbt run` failed at 10:26:19.133662 after 4.09 seconds
[0m10:26:19.133662 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000002AB6677EED0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000002AB6677E350>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000002AB6BA3C710>]}
[0m10:26:19.133662 [debug] [MainThread]: Flushing usage events
[0m10:26:42.796123 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000001915B674410>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000001915A4B3390>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000001915B667BD0>]}


============================== 10:26:42.799122 | 987e65e8-53e0-41f6-bc0f-0d6ed5abdbc1 ==============================
[0m10:26:42.799122 [info ] [MainThread]: Running with dbt=1.8.2
[0m10:26:42.799122 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'indirect_selection': 'eager', 'write_json': 'True', 'log_cache_events': 'False', 'partial_parse': 'True', 'cache_selected_only': 'False', 'profiles_dir': 'C:\\Users\\ASUS\\Desktop\\work\\Iceberg-Dbt-Trino-Hive-modern-open-source-data-stack-main\\dbt', 'debug': 'False', 'fail_fast': 'False', 'log_path': 'C:\\Users\\ASUS\\Desktop\\work\\Iceberg-Dbt-Trino-Hive-modern-open-source-data-stack-main\\dbt\\logs', 'warn_error': 'None', 'version_check': 'True', 'use_colors': 'True', 'use_experimental_parser': 'False', 'no_print': 'None', 'quiet': 'False', 'log_format': 'default', 'introspect': 'True', 'invocation_command': 'dbt run --models stage', 'static_parser': 'True', 'target_path': 'None', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'send_anonymous_usage_stats': 'True'}
[0m10:26:43.087258 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': '987e65e8-53e0-41f6-bc0f-0d6ed5abdbc1', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000001915BA1AC10>]}
[0m10:26:43.120258 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': '987e65e8-53e0-41f6-bc0f-0d6ed5abdbc1', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x00000191587E53D0>]}
[0m10:26:43.121258 [info ] [MainThread]: Registered adapter: trino=1.8.0
[0m10:26:43.134258 [debug] [MainThread]: checksum: f0a141b9de567cb7f131613ba2682f40b3a1c6a157f81c6e5435862eff68f109, vars: {}, profile: , target: , version: 1.8.2
[0m10:26:43.281881 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 0 files changed.
[0m10:26:43.282881 [debug] [MainThread]: Partial parsing enabled, no changes found, skipping parsing
[0m10:26:43.311230 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': '987e65e8-53e0-41f6-bc0f-0d6ed5abdbc1', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000001915BD08710>]}
[0m10:26:43.375740 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': '987e65e8-53e0-41f6-bc0f-0d6ed5abdbc1', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000001915BBB7B10>]}
[0m10:26:43.375740 [info ] [MainThread]: Found 15 models, 7 data tests, 3 sources, 559 macros
[0m10:26:43.376740 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '987e65e8-53e0-41f6-bc0f-0d6ed5abdbc1', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000001915AA9A210>]}
[0m10:26:43.378348 [info ] [MainThread]: 
[0m10:26:43.378348 [debug] [MainThread]: Acquiring new trino connection 'master'
[0m10:26:43.382353 [debug] [ThreadPool]: Acquiring new trino connection 'list_datalake'
[0m10:26:43.435868 [debug] [ThreadPool]: Using trino connection "list_datalake"
[0m10:26:43.435868 [debug] [ThreadPool]: On list_datalake: /* {"app": "dbt", "dbt_version": "1.8.2", "profile_name": "my_dbt_trino_project", "target_name": "dev", "connection_name": "list_datalake"} */

    select schema_name
    from "datalake".INFORMATION_SCHEMA.schemata
[0m10:26:43.436871 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m10:26:43.467674 [debug] [ThreadPool]: SQL status: SUCCESS in 0.0 seconds
[0m10:26:43.469671 [debug] [ThreadPool]: On list_datalake: Close
[0m10:26:43.471673 [debug] [ThreadPool]: Acquiring new trino connection 'list_datalake_analytics_stage'
[0m10:26:43.481672 [debug] [ThreadPool]: Using trino connection "list_datalake_analytics_stage"
[0m10:26:43.481672 [debug] [ThreadPool]: On list_datalake_analytics_stage: /* {"app": "dbt", "dbt_version": "1.8.2", "profile_name": "my_dbt_trino_project", "target_name": "dev", "connection_name": "list_datalake_analytics_stage"} */
select
      t.table_catalog as database,
      t.table_name as name,
      t.table_schema as schema,
      case when mv.name is not null then 'materialized_view'
           when t.table_type = 'BASE TABLE' then 'table'
           when t.table_type = 'VIEW' then 'view'
           else t.table_type
      end as table_type
    from "datalake".INFORMATION_SCHEMA.tables t
    left join (
            select * from system.metadata.materialized_views
            where catalog_name = 'datalake'
              and schema_name = 'analytics_stage') mv
          on mv.catalog_name = t.table_catalog and mv.schema_name = t.table_schema and mv.name = t.table_name
    where t.table_schema = 'analytics_stage'
[0m10:26:43.482671 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m10:26:43.543561 [debug] [ThreadPool]: SQL status: SUCCESS in 0.0 seconds
[0m10:26:43.545078 [debug] [ThreadPool]: On list_datalake_analytics_stage: ROLLBACK
[0m10:26:43.545078 [debug] [ThreadPool]: On list_datalake_analytics_stage: Close
[0m10:26:43.546538 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_datalake_analytics_stage, now list_datalake_analytics)
[0m10:26:43.550701 [debug] [ThreadPool]: Using trino connection "list_datalake_analytics"
[0m10:26:43.550701 [debug] [ThreadPool]: On list_datalake_analytics: /* {"app": "dbt", "dbt_version": "1.8.2", "profile_name": "my_dbt_trino_project", "target_name": "dev", "connection_name": "list_datalake_analytics"} */
select
      t.table_catalog as database,
      t.table_name as name,
      t.table_schema as schema,
      case when mv.name is not null then 'materialized_view'
           when t.table_type = 'BASE TABLE' then 'table'
           when t.table_type = 'VIEW' then 'view'
           else t.table_type
      end as table_type
    from "datalake".INFORMATION_SCHEMA.tables t
    left join (
            select * from system.metadata.materialized_views
            where catalog_name = 'datalake'
              and schema_name = 'analytics') mv
          on mv.catalog_name = t.table_catalog and mv.schema_name = t.table_schema and mv.name = t.table_name
    where t.table_schema = 'analytics'
[0m10:26:43.550701 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m10:26:43.601323 [debug] [ThreadPool]: SQL status: SUCCESS in 0.0 seconds
[0m10:26:43.602827 [debug] [ThreadPool]: On list_datalake_analytics: ROLLBACK
[0m10:26:43.602827 [debug] [ThreadPool]: On list_datalake_analytics: Close
[0m10:26:43.603832 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_datalake_analytics, now list_datalake_analytics_source)
[0m10:26:43.607832 [debug] [ThreadPool]: Using trino connection "list_datalake_analytics_source"
[0m10:26:43.607832 [debug] [ThreadPool]: On list_datalake_analytics_source: /* {"app": "dbt", "dbt_version": "1.8.2", "profile_name": "my_dbt_trino_project", "target_name": "dev", "connection_name": "list_datalake_analytics_source"} */
select
      t.table_catalog as database,
      t.table_name as name,
      t.table_schema as schema,
      case when mv.name is not null then 'materialized_view'
           when t.table_type = 'BASE TABLE' then 'table'
           when t.table_type = 'VIEW' then 'view'
           else t.table_type
      end as table_type
    from "datalake".INFORMATION_SCHEMA.tables t
    left join (
            select * from system.metadata.materialized_views
            where catalog_name = 'datalake'
              and schema_name = 'analytics_source') mv
          on mv.catalog_name = t.table_catalog and mv.schema_name = t.table_schema and mv.name = t.table_name
    where t.table_schema = 'analytics_source'
[0m10:26:43.607832 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m10:26:43.664209 [debug] [ThreadPool]: SQL status: SUCCESS in 0.0 seconds
[0m10:26:43.665214 [debug] [ThreadPool]: On list_datalake_analytics_source: ROLLBACK
[0m10:26:43.666219 [debug] [ThreadPool]: On list_datalake_analytics_source: Close
[0m10:26:43.666219 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '987e65e8-53e0-41f6-bc0f-0d6ed5abdbc1', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x00000191578A58D0>]}
[0m10:26:43.667462 [debug] [MainThread]: On master: COMMIT
[0m10:26:43.667462 [info ] [MainThread]: Concurrency: 1 threads (target='dev')
[0m10:26:43.668466 [info ] [MainThread]: 
[0m10:26:43.670844 [debug] [Thread-1 (]: Began running node model.my_dbt_trino_project.stg_streams_hourly
[0m10:26:43.670844 [info ] [Thread-1 (]: 1 of 6 START sql table model analytics_stage.stg_streams_hourly ................ [RUN]
[0m10:26:43.671856 [debug] [Thread-1 (]: Acquiring new trino connection 'model.my_dbt_trino_project.stg_streams_hourly'
[0m10:26:43.671856 [debug] [Thread-1 (]: Began compiling node model.my_dbt_trino_project.stg_streams_hourly
[0m10:26:43.674859 [debug] [Thread-1 (]: Writing injected SQL for node "model.my_dbt_trino_project.stg_streams_hourly"
[0m10:26:43.675854 [debug] [Thread-1 (]: Began executing node model.my_dbt_trino_project.stg_streams_hourly
[0m10:26:43.703878 [debug] [Thread-1 (]: Writing runtime sql for node "model.my_dbt_trino_project.stg_streams_hourly"
[0m10:26:43.705875 [debug] [Thread-1 (]: Using trino connection "model.my_dbt_trino_project.stg_streams_hourly"
[0m10:26:43.705875 [debug] [Thread-1 (]: On model.my_dbt_trino_project.stg_streams_hourly: /* {"app": "dbt", "dbt_version": "1.8.2", "profile_name": "my_dbt_trino_project", "target_name": "dev", "node_id": "model.my_dbt_trino_project.stg_streams_hourly"} */

  
    

    create table "datalake"."analytics_stage"."stg_streams_hourly__dbt_tmp"
      
      
    as (
      

SELECT
    DATE_FORMAT(FROM_UNIXTIME(ts), '%Y-%m-%d') AS stream_date, 
    DATE_FORMAT(FROM_UNIXTIME(ts), '%H') AS stream_hour,
    COUNT(*) AS total_streams
FROM "datalake"."analytics_source"."src_listen_events"
GROUP BY
    DATE_FORMAT(FROM_UNIXTIME(ts), '%Y-%m-%d'),
    DATE_FORMAT(FROM_UNIXTIME(ts), '%H')
    )
[0m10:26:43.705875 [debug] [Thread-1 (]: Opening a new connection, currently in state init
[0m10:26:43.941520 [debug] [Thread-1 (]: SQL status: SUCCESS in 0.0 seconds
[0m10:26:43.946523 [debug] [Thread-1 (]: Using trino connection "model.my_dbt_trino_project.stg_streams_hourly"
[0m10:26:43.948521 [debug] [Thread-1 (]: On model.my_dbt_trino_project.stg_streams_hourly: /* {"app": "dbt", "dbt_version": "1.8.2", "profile_name": "my_dbt_trino_project", "target_name": "dev", "node_id": "model.my_dbt_trino_project.stg_streams_hourly"} */
alter table "datalake"."analytics_stage"."stg_streams_hourly" rename to "datalake"."analytics_stage"."stg_streams_hourly__dbt_backup"
[0m10:26:44.043026 [debug] [Thread-1 (]: SQL status: SUCCESS in 0.0 seconds
[0m10:26:44.046270 [debug] [Thread-1 (]: Using trino connection "model.my_dbt_trino_project.stg_streams_hourly"
[0m10:26:44.046789 [debug] [Thread-1 (]: On model.my_dbt_trino_project.stg_streams_hourly: /* {"app": "dbt", "dbt_version": "1.8.2", "profile_name": "my_dbt_trino_project", "target_name": "dev", "node_id": "model.my_dbt_trino_project.stg_streams_hourly"} */
alter table "datalake"."analytics_stage"."stg_streams_hourly__dbt_tmp" rename to "datalake"."analytics_stage"."stg_streams_hourly"
[0m10:26:44.131079 [debug] [Thread-1 (]: SQL status: SUCCESS in 0.0 seconds
[0m10:26:44.137078 [debug] [Thread-1 (]: Applying DROP to: "datalake"."analytics_stage"."stg_streams_hourly__dbt_backup"
[0m10:26:44.139083 [debug] [Thread-1 (]: Using trino connection "model.my_dbt_trino_project.stg_streams_hourly"
[0m10:26:44.139083 [debug] [Thread-1 (]: On model.my_dbt_trino_project.stg_streams_hourly: /* {"app": "dbt", "dbt_version": "1.8.2", "profile_name": "my_dbt_trino_project", "target_name": "dev", "node_id": "model.my_dbt_trino_project.stg_streams_hourly"} */

    drop table if exists "datalake"."analytics_stage"."stg_streams_hourly__dbt_backup"
[0m10:26:44.255163 [debug] [Thread-1 (]: SQL status: SUCCESS in 0.0 seconds
[0m10:26:44.267169 [debug] [Thread-1 (]: On model.my_dbt_trino_project.stg_streams_hourly: ROLLBACK
[0m10:26:44.267169 [debug] [Thread-1 (]: On model.my_dbt_trino_project.stg_streams_hourly: Close
[0m10:26:44.268169 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '987e65e8-53e0-41f6-bc0f-0d6ed5abdbc1', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000001915C4CF010>]}
[0m10:26:44.269170 [info ] [Thread-1 (]: 1 of 6 OK created sql table model analytics_stage.stg_streams_hourly ........... [[32mSUCCESS[0m in 0.60s]
[0m10:26:44.269170 [debug] [Thread-1 (]: Finished running node model.my_dbt_trino_project.stg_streams_hourly
[0m10:26:44.270553 [debug] [Thread-1 (]: Began running node model.my_dbt_trino_project.stg_top_songs_artists
[0m10:26:44.270553 [info ] [Thread-1 (]: 2 of 6 START sql view model analytics_stage.stg_top_songs_artists .............. [RUN]
[0m10:26:44.271560 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.my_dbt_trino_project.stg_streams_hourly, now model.my_dbt_trino_project.stg_top_songs_artists)
[0m10:26:44.271560 [debug] [Thread-1 (]: Began compiling node model.my_dbt_trino_project.stg_top_songs_artists
[0m10:26:44.273558 [debug] [Thread-1 (]: Writing injected SQL for node "model.my_dbt_trino_project.stg_top_songs_artists"
[0m10:26:44.274559 [debug] [Thread-1 (]: Began executing node model.my_dbt_trino_project.stg_top_songs_artists
[0m10:26:44.285036 [debug] [Thread-1 (]: Writing runtime sql for node "model.my_dbt_trino_project.stg_top_songs_artists"
[0m10:26:44.287036 [debug] [Thread-1 (]: Using trino connection "model.my_dbt_trino_project.stg_top_songs_artists"
[0m10:26:44.288037 [debug] [Thread-1 (]: On model.my_dbt_trino_project.stg_top_songs_artists: /* {"app": "dbt", "dbt_version": "1.8.2", "profile_name": "my_dbt_trino_project", "target_name": "dev", "node_id": "model.my_dbt_trino_project.stg_top_songs_artists"} */

  create or replace view
    "datalake"."analytics_stage"."stg_top_songs_artists"
  security definer
  as
    

WITH song_plays AS (
    SELECT
        artist,
        song,
        COUNT(*) AS play_count
    FROM "datalake"."analytics_source"."src_listen_events"
    GROUP BY artist, song
)

SELECT
    artist,
    song,
    play_count
FROM song_plays
ORDER BY play_count DESC
  
[0m10:26:44.288037 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m10:26:44.349804 [debug] [Thread-1 (]: SQL status: SUCCESS in 0.0 seconds
[0m10:26:44.350812 [debug] [Thread-1 (]: On model.my_dbt_trino_project.stg_top_songs_artists: ROLLBACK
[0m10:26:44.351813 [debug] [Thread-1 (]: On model.my_dbt_trino_project.stg_top_songs_artists: Close
[0m10:26:44.351813 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '987e65e8-53e0-41f6-bc0f-0d6ed5abdbc1', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000001915BB08550>]}
[0m10:26:44.352811 [info ] [Thread-1 (]: 2 of 6 OK created sql view model analytics_stage.stg_top_songs_artists ......... [[32mSUCCESS[0m in 0.08s]
[0m10:26:44.352811 [debug] [Thread-1 (]: Finished running node model.my_dbt_trino_project.stg_top_songs_artists
[0m10:26:44.354277 [debug] [Thread-1 (]: Began running node model.my_dbt_trino_project.stg_unique_users
[0m10:26:44.354277 [info ] [Thread-1 (]: 3 of 6 START sql view model analytics_stage.stg_unique_users ................... [RUN]
[0m10:26:44.355284 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.my_dbt_trino_project.stg_top_songs_artists, now model.my_dbt_trino_project.stg_unique_users)
[0m10:26:44.355284 [debug] [Thread-1 (]: Began compiling node model.my_dbt_trino_project.stg_unique_users
[0m10:26:44.358283 [debug] [Thread-1 (]: Writing injected SQL for node "model.my_dbt_trino_project.stg_unique_users"
[0m10:26:44.358283 [debug] [Thread-1 (]: Began executing node model.my_dbt_trino_project.stg_unique_users
[0m10:26:44.360281 [debug] [Thread-1 (]: Writing runtime sql for node "model.my_dbt_trino_project.stg_unique_users"
[0m10:26:44.361281 [debug] [Thread-1 (]: Using trino connection "model.my_dbt_trino_project.stg_unique_users"
[0m10:26:44.362281 [debug] [Thread-1 (]: On model.my_dbt_trino_project.stg_unique_users: /* {"app": "dbt", "dbt_version": "1.8.2", "profile_name": "my_dbt_trino_project", "target_name": "dev", "node_id": "model.my_dbt_trino_project.stg_unique_users"} */

  create or replace view
    "datalake"."analytics_stage"."stg_unique_users"
  security definer
  as
    

SELECT
    COUNT(DISTINCT userid) AS total_unique_users
FROM "datalake"."analytics_source"."src_listen_events"
WHERE userid IS NOT NULL
  
[0m10:26:44.362281 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m10:26:44.427413 [debug] [Thread-1 (]: SQL status: SUCCESS in 0.0 seconds
[0m10:26:44.429413 [debug] [Thread-1 (]: On model.my_dbt_trino_project.stg_unique_users: ROLLBACK
[0m10:26:44.429413 [debug] [Thread-1 (]: On model.my_dbt_trino_project.stg_unique_users: Close
[0m10:26:44.430413 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '987e65e8-53e0-41f6-bc0f-0d6ed5abdbc1', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000001915C56E090>]}
[0m10:26:44.430921 [info ] [Thread-1 (]: 3 of 6 OK created sql view model analytics_stage.stg_unique_users .............. [[32mSUCCESS[0m in 0.08s]
[0m10:26:44.430921 [debug] [Thread-1 (]: Finished running node model.my_dbt_trino_project.stg_unique_users
[0m10:26:44.431931 [debug] [Thread-1 (]: Began running node model.my_dbt_trino_project.stg_user_activity_per_country
[0m10:26:44.431931 [info ] [Thread-1 (]: 4 of 6 START sql view model analytics_stage.stg_user_activity_per_country ...... [RUN]
[0m10:26:44.432931 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.my_dbt_trino_project.stg_unique_users, now model.my_dbt_trino_project.stg_user_activity_per_country)
[0m10:26:44.432931 [debug] [Thread-1 (]: Began compiling node model.my_dbt_trino_project.stg_user_activity_per_country
[0m10:26:44.435931 [debug] [Thread-1 (]: Writing injected SQL for node "model.my_dbt_trino_project.stg_user_activity_per_country"
[0m10:26:44.437105 [debug] [Thread-1 (]: Began executing node model.my_dbt_trino_project.stg_user_activity_per_country
[0m10:26:44.438930 [debug] [Thread-1 (]: Writing runtime sql for node "model.my_dbt_trino_project.stg_user_activity_per_country"
[0m10:26:44.442930 [debug] [Thread-1 (]: Using trino connection "model.my_dbt_trino_project.stg_user_activity_per_country"
[0m10:26:44.442930 [debug] [Thread-1 (]: On model.my_dbt_trino_project.stg_user_activity_per_country: /* {"app": "dbt", "dbt_version": "1.8.2", "profile_name": "my_dbt_trino_project", "target_name": "dev", "node_id": "model.my_dbt_trino_project.stg_user_activity_per_country"} */

  create or replace view
    "datalake"."analytics_stage"."stg_user_activity_per_country"
  security definer
  as
    

WITH combined_activities AS (
  SELECT
    country,
    'listen_event' AS event_type,
    ts,
    userid
  FROM "datalake"."analytics_source"."src_listen_events"
  WHERE country IS NOT NULL
  UNION ALL
  SELECT
    'Unknown' AS country, 
    ts,
    userid
  FROM "datalake"."analytics_source"."src_auth_events"
  UNION ALL
  SELECT
    'Unknown' AS country, 
    'page_view_event' AS event_type,
    ts,
    userid
  FROM "datalake"."analytics_source"."src_page_view_events"
)

SELECT
  country,
  COUNT(*) AS activity_count
FROM combined_activities
GROUP BY country
  
[0m10:26:44.442930 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m10:26:44.493497 [debug] [Thread-1 (]: Trino adapter: Trino query id: 20240619_022644_00281_uxt54
[0m10:26:44.493497 [debug] [Thread-1 (]: Trino adapter: Trino error: TrinoUserError(type=USER_ERROR, name=TYPE_MISMATCH, message="line 17:3: UNION query has different number of fields: 4, 3", query_id=20240619_022644_00281_uxt54)
[0m10:26:44.494494 [debug] [Thread-1 (]: On model.my_dbt_trino_project.stg_user_activity_per_country: ROLLBACK
[0m10:26:44.494494 [debug] [Thread-1 (]: On model.my_dbt_trino_project.stg_user_activity_per_country: Close
[0m10:26:44.498493 [debug] [Thread-1 (]: Database Error in model stg_user_activity_per_country (models\stage\stg_user_activity_per_country.sql)
  TrinoUserError(type=USER_ERROR, name=TYPE_MISMATCH, message="line 17:3: UNION query has different number of fields: 4, 3", query_id=20240619_022644_00281_uxt54)
  compiled Code at target\run\my_dbt_trino_project\models\stage\stg_user_activity_per_country.sql
[0m10:26:44.499506 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '987e65e8-53e0-41f6-bc0f-0d6ed5abdbc1', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000001915C5F2BD0>]}
[0m10:26:44.499506 [error] [Thread-1 (]: 4 of 6 ERROR creating sql view model analytics_stage.stg_user_activity_per_country  [[31mERROR[0m in 0.07s]
[0m10:26:44.500677 [debug] [Thread-1 (]: Finished running node model.my_dbt_trino_project.stg_user_activity_per_country
[0m10:26:44.500677 [debug] [Thread-1 (]: Began running node model.my_dbt_trino_project.stg_user_activity_per_location
[0m10:26:44.501687 [info ] [Thread-1 (]: 5 of 6 START sql view model analytics_stage.stg_user_activity_per_location ..... [RUN]
[0m10:26:44.501687 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.my_dbt_trino_project.stg_user_activity_per_country, now model.my_dbt_trino_project.stg_user_activity_per_location)
[0m10:26:44.503067 [debug] [Thread-1 (]: Began compiling node model.my_dbt_trino_project.stg_user_activity_per_location
[0m10:26:44.506076 [debug] [Thread-1 (]: Writing injected SQL for node "model.my_dbt_trino_project.stg_user_activity_per_location"
[0m10:26:44.507075 [debug] [Thread-1 (]: Began executing node model.my_dbt_trino_project.stg_user_activity_per_location
[0m10:26:44.509074 [debug] [Thread-1 (]: Writing runtime sql for node "model.my_dbt_trino_project.stg_user_activity_per_location"
[0m10:26:44.511073 [debug] [Thread-1 (]: Using trino connection "model.my_dbt_trino_project.stg_user_activity_per_location"
[0m10:26:44.511073 [debug] [Thread-1 (]: On model.my_dbt_trino_project.stg_user_activity_per_location: /* {"app": "dbt", "dbt_version": "1.8.2", "profile_name": "my_dbt_trino_project", "target_name": "dev", "node_id": "model.my_dbt_trino_project.stg_user_activity_per_location"} */

  create or replace view
    "datalake"."analytics_stage"."stg_user_activity_per_location"
  security definer
  as
    

WITH combined_activities AS (
  SELECT
    city,
    state,
    'auth_event' AS event_type,
    ts,
    userid
 FROM "datalake"."analytics_source"."src_auth_events"
  UNION ALL
  SELECT
    city,
    state,
    'listen_event' AS event_type,
    ts,
    userid
  FROM "datalake"."analytics_source"."src_listen_events"
  UNION ALL
  SELECT
    city,
    state,
    'page_view_event' AS event_type,
    ts,
    userid
  FROM "datalake"."analytics_source"."src_page_view_events"
)

SELECT
  state,
  city,
  COUNT(*) AS activity_count
FROM combined_activities
GROUP BY state, city
  
[0m10:26:44.512075 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m10:26:44.589739 [debug] [Thread-1 (]: SQL status: SUCCESS in 0.0 seconds
[0m10:26:44.591746 [debug] [Thread-1 (]: On model.my_dbt_trino_project.stg_user_activity_per_location: ROLLBACK
[0m10:26:44.591746 [debug] [Thread-1 (]: On model.my_dbt_trino_project.stg_user_activity_per_location: Close
[0m10:26:44.592745 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '987e65e8-53e0-41f6-bc0f-0d6ed5abdbc1', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000001915C561C50>]}
[0m10:26:44.593744 [info ] [Thread-1 (]: 5 of 6 OK created sql view model analytics_stage.stg_user_activity_per_location  [[32mSUCCESS[0m in 0.09s]
[0m10:26:44.593744 [debug] [Thread-1 (]: Finished running node model.my_dbt_trino_project.stg_user_activity_per_location
[0m10:26:44.594763 [debug] [Thread-1 (]: Began running node model.my_dbt_trino_project.stg_user_level_by_gender
[0m10:26:44.594763 [info ] [Thread-1 (]: 6 of 6 START sql view model analytics_stage.stg_user_level_by_gender ........... [RUN]
[0m10:26:44.595771 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.my_dbt_trino_project.stg_user_activity_per_location, now model.my_dbt_trino_project.stg_user_level_by_gender)
[0m10:26:44.595771 [debug] [Thread-1 (]: Began compiling node model.my_dbt_trino_project.stg_user_level_by_gender
[0m10:26:44.599773 [debug] [Thread-1 (]: Writing injected SQL for node "model.my_dbt_trino_project.stg_user_level_by_gender"
[0m10:26:44.599773 [debug] [Thread-1 (]: Began executing node model.my_dbt_trino_project.stg_user_level_by_gender
[0m10:26:44.602782 [debug] [Thread-1 (]: Writing runtime sql for node "model.my_dbt_trino_project.stg_user_level_by_gender"
[0m10:26:44.603775 [debug] [Thread-1 (]: Using trino connection "model.my_dbt_trino_project.stg_user_level_by_gender"
[0m10:26:44.604777 [debug] [Thread-1 (]: On model.my_dbt_trino_project.stg_user_level_by_gender: /* {"app": "dbt", "dbt_version": "1.8.2", "profile_name": "my_dbt_trino_project", "target_name": "dev", "node_id": "model.my_dbt_trino_project.stg_user_level_by_gender"} */

  create or replace view
    "datalake"."analytics_stage"."stg_user_level_by_gender"
  security definer
  as
    

WITH user_subscriptions AS (
    SELECT
        gender,
        level, 
        COUNT(DISTINCT userId) AS user_count
    FROM "datalake"."analytics_source"."src_auth_events"
    WHERE gender IS NOT NULL AND level IS NOT NULL
    GROUP BY gender, level
)

SELECT
    gender,
    level,
    user_count
FROM user_subscriptions
  
[0m10:26:44.604777 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m10:26:44.655825 [debug] [Thread-1 (]: SQL status: SUCCESS in 0.0 seconds
[0m10:26:44.657827 [debug] [Thread-1 (]: On model.my_dbt_trino_project.stg_user_level_by_gender: ROLLBACK
[0m10:26:44.657827 [debug] [Thread-1 (]: On model.my_dbt_trino_project.stg_user_level_by_gender: Close
[0m10:26:44.658828 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '987e65e8-53e0-41f6-bc0f-0d6ed5abdbc1', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000001915C05FF50>]}
[0m10:26:44.658828 [info ] [Thread-1 (]: 6 of 6 OK created sql view model analytics_stage.stg_user_level_by_gender ...... [[32mSUCCESS[0m in 0.06s]
[0m10:26:44.659826 [debug] [Thread-1 (]: Finished running node model.my_dbt_trino_project.stg_user_level_by_gender
[0m10:26:44.661196 [debug] [MainThread]: On master: COMMIT
[0m10:26:44.661196 [debug] [MainThread]: Connection 'master' was properly closed.
[0m10:26:44.661196 [debug] [MainThread]: Connection 'list_datalake' was properly closed.
[0m10:26:44.662201 [debug] [MainThread]: Connection 'list_datalake_analytics_source' was properly closed.
[0m10:26:44.662201 [debug] [MainThread]: Connection 'model.my_dbt_trino_project.stg_user_level_by_gender' was properly closed.
[0m10:26:44.662201 [info ] [MainThread]: 
[0m10:26:44.663196 [info ] [MainThread]: Finished running 1 table model, 5 view models in 0 hours 0 minutes and 1.28 seconds (1.28s).
[0m10:26:44.664199 [debug] [MainThread]: Command end result
[0m10:26:44.748861 [info ] [MainThread]: 
[0m10:26:44.749862 [info ] [MainThread]: [31mCompleted with 1 error and 0 warnings:[0m
[0m10:26:44.750864 [info ] [MainThread]: 
[0m10:26:44.750864 [error] [MainThread]:   Database Error in model stg_user_activity_per_country (models\stage\stg_user_activity_per_country.sql)
  TrinoUserError(type=USER_ERROR, name=TYPE_MISMATCH, message="line 17:3: UNION query has different number of fields: 4, 3", query_id=20240619_022644_00281_uxt54)
  compiled Code at target\run\my_dbt_trino_project\models\stage\stg_user_activity_per_country.sql
[0m10:26:44.751862 [info ] [MainThread]: 
[0m10:26:44.752553 [info ] [MainThread]: Done. PASS=5 WARN=0 ERROR=1 SKIP=0 TOTAL=6
[0m10:26:44.753056 [debug] [MainThread]: Command `dbt run` failed at 10:26:44.753056 after 2.09 seconds
[0m10:26:44.754061 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000001915671EE90>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000001915671E350>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000001915671EED0>]}
[0m10:26:44.754061 [debug] [MainThread]: Flushing usage events
[0m10:28:43.829403 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x0000014BF4B05CD0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x0000014BF4B04910>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x0000014BF4B07650>]}


============================== 10:28:43.832403 | 6862f49b-c094-480f-96ba-3ed4c9a4c755 ==============================
[0m10:28:43.832403 [info ] [MainThread]: Running with dbt=1.8.2
[0m10:28:43.832403 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'indirect_selection': 'eager', 'write_json': 'True', 'log_cache_events': 'False', 'partial_parse': 'True', 'cache_selected_only': 'False', 'warn_error': 'None', 'version_check': 'True', 'fail_fast': 'False', 'log_path': 'C:\\Users\\ASUS\\Desktop\\work\\Iceberg-Dbt-Trino-Hive-modern-open-source-data-stack-main\\dbt\\logs', 'profiles_dir': 'C:\\Users\\ASUS\\Desktop\\work\\Iceberg-Dbt-Trino-Hive-modern-open-source-data-stack-main\\dbt', 'debug': 'False', 'use_colors': 'True', 'use_experimental_parser': 'False', 'no_print': 'None', 'quiet': 'False', 'log_format': 'default', 'introspect': 'True', 'invocation_command': 'dbt run', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'target_path': 'None', 'static_parser': 'True', 'send_anonymous_usage_stats': 'True'}
[0m10:28:44.130996 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': '6862f49b-c094-480f-96ba-3ed4c9a4c755', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x0000014BF4EC2C10>]}
[0m10:28:44.170901 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': '6862f49b-c094-480f-96ba-3ed4c9a4c755', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x0000014BF1C85190>]}
[0m10:28:44.171900 [info ] [MainThread]: Registered adapter: trino=1.8.0
[0m10:28:44.182412 [debug] [MainThread]: checksum: f0a141b9de567cb7f131613ba2682f40b3a1c6a157f81c6e5435862eff68f109, vars: {}, profile: , target: , version: 1.8.2
[0m10:28:44.329571 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 0 files changed.
[0m10:28:44.329571 [debug] [MainThread]: Partial parsing enabled, no changes found, skipping parsing
[0m10:28:44.359084 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': '6862f49b-c094-480f-96ba-3ed4c9a4c755', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x0000014BF482B590>]}
[0m10:28:44.425615 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': '6862f49b-c094-480f-96ba-3ed4c9a4c755', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x0000014BF5043D90>]}
[0m10:28:44.426617 [info ] [MainThread]: Found 15 models, 7 data tests, 3 sources, 559 macros
[0m10:28:44.426617 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '6862f49b-c094-480f-96ba-3ed4c9a4c755', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x0000014BF504E050>]}
[0m10:28:44.428615 [info ] [MainThread]: 
[0m10:28:44.428615 [debug] [MainThread]: Acquiring new trino connection 'master'
[0m10:28:44.432615 [debug] [ThreadPool]: Acquiring new trino connection 'list_datalake'
[0m10:28:44.488489 [debug] [ThreadPool]: Using trino connection "list_datalake"
[0m10:28:44.488489 [debug] [ThreadPool]: On list_datalake: /* {"app": "dbt", "dbt_version": "1.8.2", "profile_name": "my_dbt_trino_project", "target_name": "dev", "connection_name": "list_datalake"} */

    select schema_name
    from "datalake".INFORMATION_SCHEMA.schemata
[0m10:28:44.489489 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m10:28:44.538752 [debug] [ThreadPool]: SQL status: SUCCESS in 0.0 seconds
[0m10:28:44.539762 [debug] [ThreadPool]: On list_datalake: Close
[0m10:28:44.542916 [debug] [ThreadPool]: Using trino connection "list_datalake"
[0m10:28:44.542916 [debug] [ThreadPool]: On list_datalake: /* {"app": "dbt", "dbt_version": "1.8.2", "profile_name": "my_dbt_trino_project", "target_name": "dev", "connection_name": "list_datalake"} */

    select schema_name
    from "datalake".INFORMATION_SCHEMA.schemata
[0m10:28:44.542916 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m10:28:44.578855 [debug] [ThreadPool]: SQL status: SUCCESS in 0.0 seconds
[0m10:28:44.579360 [debug] [ThreadPool]: On list_datalake: Close
[0m10:28:44.582601 [debug] [ThreadPool]: Using trino connection "list_datalake"
[0m10:28:44.582601 [debug] [ThreadPool]: On list_datalake: /* {"app": "dbt", "dbt_version": "1.8.2", "profile_name": "my_dbt_trino_project", "target_name": "dev", "connection_name": "list_datalake"} */

    select schema_name
    from "datalake".INFORMATION_SCHEMA.schemata
[0m10:28:44.582601 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m10:28:44.623534 [debug] [ThreadPool]: SQL status: SUCCESS in 0.0 seconds
[0m10:28:44.624533 [debug] [ThreadPool]: On list_datalake: Close
[0m10:28:44.625896 [debug] [ThreadPool]: Acquiring new trino connection 'list_datalake_analytics'
[0m10:28:44.636913 [debug] [ThreadPool]: Using trino connection "list_datalake_analytics"
[0m10:28:44.637912 [debug] [ThreadPool]: On list_datalake_analytics: /* {"app": "dbt", "dbt_version": "1.8.2", "profile_name": "my_dbt_trino_project", "target_name": "dev", "connection_name": "list_datalake_analytics"} */
select
      t.table_catalog as database,
      t.table_name as name,
      t.table_schema as schema,
      case when mv.name is not null then 'materialized_view'
           when t.table_type = 'BASE TABLE' then 'table'
           when t.table_type = 'VIEW' then 'view'
           else t.table_type
      end as table_type
    from "datalake".INFORMATION_SCHEMA.tables t
    left join (
            select * from system.metadata.materialized_views
            where catalog_name = 'datalake'
              and schema_name = 'analytics') mv
          on mv.catalog_name = t.table_catalog and mv.schema_name = t.table_schema and mv.name = t.table_name
    where t.table_schema = 'analytics'
[0m10:28:44.637912 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m10:28:44.689629 [debug] [ThreadPool]: SQL status: SUCCESS in 0.0 seconds
[0m10:28:44.691633 [debug] [ThreadPool]: On list_datalake_analytics: ROLLBACK
[0m10:28:44.691633 [debug] [ThreadPool]: On list_datalake_analytics: Close
[0m10:28:44.692635 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_datalake_analytics, now list_datalake_analytics_stage)
[0m10:28:44.696636 [debug] [ThreadPool]: Using trino connection "list_datalake_analytics_stage"
[0m10:28:44.696636 [debug] [ThreadPool]: On list_datalake_analytics_stage: /* {"app": "dbt", "dbt_version": "1.8.2", "profile_name": "my_dbt_trino_project", "target_name": "dev", "connection_name": "list_datalake_analytics_stage"} */
select
      t.table_catalog as database,
      t.table_name as name,
      t.table_schema as schema,
      case when mv.name is not null then 'materialized_view'
           when t.table_type = 'BASE TABLE' then 'table'
           when t.table_type = 'VIEW' then 'view'
           else t.table_type
      end as table_type
    from "datalake".INFORMATION_SCHEMA.tables t
    left join (
            select * from system.metadata.materialized_views
            where catalog_name = 'datalake'
              and schema_name = 'analytics_stage') mv
          on mv.catalog_name = t.table_catalog and mv.schema_name = t.table_schema and mv.name = t.table_name
    where t.table_schema = 'analytics_stage'
[0m10:28:44.696636 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m10:28:44.752067 [debug] [ThreadPool]: SQL status: SUCCESS in 0.0 seconds
[0m10:28:44.753066 [debug] [ThreadPool]: On list_datalake_analytics_stage: ROLLBACK
[0m10:28:44.753066 [debug] [ThreadPool]: On list_datalake_analytics_stage: Close
[0m10:28:44.754069 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_datalake_analytics_stage, now list_datalake_analytics_source)
[0m10:28:44.758585 [debug] [ThreadPool]: Using trino connection "list_datalake_analytics_source"
[0m10:28:44.758585 [debug] [ThreadPool]: On list_datalake_analytics_source: /* {"app": "dbt", "dbt_version": "1.8.2", "profile_name": "my_dbt_trino_project", "target_name": "dev", "connection_name": "list_datalake_analytics_source"} */
select
      t.table_catalog as database,
      t.table_name as name,
      t.table_schema as schema,
      case when mv.name is not null then 'materialized_view'
           when t.table_type = 'BASE TABLE' then 'table'
           when t.table_type = 'VIEW' then 'view'
           else t.table_type
      end as table_type
    from "datalake".INFORMATION_SCHEMA.tables t
    left join (
            select * from system.metadata.materialized_views
            where catalog_name = 'datalake'
              and schema_name = 'analytics_source') mv
          on mv.catalog_name = t.table_catalog and mv.schema_name = t.table_schema and mv.name = t.table_name
    where t.table_schema = 'analytics_source'
[0m10:28:44.758585 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m10:28:44.803568 [debug] [ThreadPool]: SQL status: SUCCESS in 0.0 seconds
[0m10:28:44.804573 [debug] [ThreadPool]: On list_datalake_analytics_source: ROLLBACK
[0m10:28:44.804573 [debug] [ThreadPool]: On list_datalake_analytics_source: Close
[0m10:28:44.805572 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '6862f49b-c094-480f-96ba-3ed4c9a4c755', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x0000014BF50A38D0>]}
[0m10:28:44.807080 [debug] [MainThread]: On master: COMMIT
[0m10:28:44.807080 [info ] [MainThread]: Concurrency: 1 threads (target='dev')
[0m10:28:44.808086 [info ] [MainThread]: 
[0m10:28:44.809596 [debug] [Thread-1 (]: Began running node model.my_dbt_trino_project.src_auth_events
[0m10:28:44.810595 [info ] [Thread-1 (]: 1 of 15 START sql table model analytics_source.src_auth_events ................. [RUN]
[0m10:28:44.811100 [debug] [Thread-1 (]: Acquiring new trino connection 'model.my_dbt_trino_project.src_auth_events'
[0m10:28:44.811100 [debug] [Thread-1 (]: Began compiling node model.my_dbt_trino_project.src_auth_events
[0m10:28:44.816610 [debug] [Thread-1 (]: Writing injected SQL for node "model.my_dbt_trino_project.src_auth_events"
[0m10:28:44.817609 [debug] [Thread-1 (]: Began executing node model.my_dbt_trino_project.src_auth_events
[0m10:28:44.853814 [debug] [Thread-1 (]: Writing runtime sql for node "model.my_dbt_trino_project.src_auth_events"
[0m10:28:44.857816 [debug] [Thread-1 (]: Using trino connection "model.my_dbt_trino_project.src_auth_events"
[0m10:28:44.858820 [debug] [Thread-1 (]: On model.my_dbt_trino_project.src_auth_events: /* {"app": "dbt", "dbt_version": "1.8.2", "profile_name": "my_dbt_trino_project", "target_name": "dev", "node_id": "model.my_dbt_trino_project.src_auth_events"} */

  
    

    create table "datalake"."analytics_source"."src_auth_events__dbt_tmp"
      
      
    as (
      

with source as (
    select
        CAST(ts AS VARCHAR) as id, 
        ts,
        CAST(sessionId AS VARCHAR) as sessionId,
        level,
        itemInSession,
        city,
        zip,
        state,
        userAgent,
        CAST(NULLIF(lon, '') AS double) as lon,
        CAST(NULLIF(lat, '') AS double) as lat,
        CAST(FLOOR(CAST(NULLIF(userId, '') AS DOUBLE)) AS INT) as userId, 
        lastName,
        firstName,
        gender,
        CAST(FLOOR(CAST(NULLIF(registration, '') AS DOUBLE)) AS BIGINT) as registration,
        success
    from "oltp"."public"."auth_events"
)

select
    id,
    ts,
    sessionId,
    level,
    itemInSession,
    city,
    zip,
    state,
    userAgent,
    lon,
    lat,
    userId,
    lastName,
    firstName,
    gender,
    registration, 
    CASE 
        WHEN CAST(success AS VARCHAR) = 't' THEN true 
        WHEN CAST(success AS VARCHAR) = 'f' THEN false
        ELSE NULL 
    END AS success_boolean
from source


    )
[0m10:28:44.858820 [debug] [Thread-1 (]: Opening a new connection, currently in state init
[0m10:28:45.106729 [debug] [Thread-1 (]: SQL status: SUCCESS in 0.0 seconds
[0m10:28:45.112087 [debug] [Thread-1 (]: Using trino connection "model.my_dbt_trino_project.src_auth_events"
[0m10:28:45.112087 [debug] [Thread-1 (]: On model.my_dbt_trino_project.src_auth_events: /* {"app": "dbt", "dbt_version": "1.8.2", "profile_name": "my_dbt_trino_project", "target_name": "dev", "node_id": "model.my_dbt_trino_project.src_auth_events"} */
alter table "datalake"."analytics_source"."src_auth_events" rename to "datalake"."analytics_source"."src_auth_events__dbt_backup"
[0m10:28:45.202924 [debug] [Thread-1 (]: SQL status: SUCCESS in 0.0 seconds
[0m10:28:45.205955 [debug] [Thread-1 (]: Using trino connection "model.my_dbt_trino_project.src_auth_events"
[0m10:28:45.205955 [debug] [Thread-1 (]: On model.my_dbt_trino_project.src_auth_events: /* {"app": "dbt", "dbt_version": "1.8.2", "profile_name": "my_dbt_trino_project", "target_name": "dev", "node_id": "model.my_dbt_trino_project.src_auth_events"} */
alter table "datalake"."analytics_source"."src_auth_events__dbt_tmp" rename to "datalake"."analytics_source"."src_auth_events"
[0m10:28:45.305178 [debug] [Thread-1 (]: SQL status: SUCCESS in 0.0 seconds
[0m10:28:45.310684 [debug] [Thread-1 (]: Applying DROP to: "datalake"."analytics_source"."src_auth_events__dbt_backup"
[0m10:28:45.312685 [debug] [Thread-1 (]: Using trino connection "model.my_dbt_trino_project.src_auth_events"
[0m10:28:45.313685 [debug] [Thread-1 (]: On model.my_dbt_trino_project.src_auth_events: /* {"app": "dbt", "dbt_version": "1.8.2", "profile_name": "my_dbt_trino_project", "target_name": "dev", "node_id": "model.my_dbt_trino_project.src_auth_events"} */

    drop table if exists "datalake"."analytics_source"."src_auth_events__dbt_backup"
[0m10:28:45.434068 [debug] [Thread-1 (]: SQL status: SUCCESS in 0.0 seconds
[0m10:28:45.447273 [debug] [Thread-1 (]: On model.my_dbt_trino_project.src_auth_events: ROLLBACK
[0m10:28:45.448272 [debug] [Thread-1 (]: On model.my_dbt_trino_project.src_auth_events: Close
[0m10:28:45.449779 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '6862f49b-c094-480f-96ba-3ed4c9a4c755', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x0000014BF64F9E10>]}
[0m10:28:45.449779 [info ] [Thread-1 (]: 1 of 15 OK created sql table model analytics_source.src_auth_events ............ [[32mSUCCESS[0m in 0.64s]
[0m10:28:45.451254 [debug] [Thread-1 (]: Finished running node model.my_dbt_trino_project.src_auth_events
[0m10:28:45.451791 [debug] [Thread-1 (]: Began running node model.my_dbt_trino_project.src_listen_events
[0m10:28:45.452321 [info ] [Thread-1 (]: 2 of 15 START sql incremental model analytics_source.src_listen_events ......... [RUN]
[0m10:28:45.452847 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.my_dbt_trino_project.src_auth_events, now model.my_dbt_trino_project.src_listen_events)
[0m10:28:45.453371 [debug] [Thread-1 (]: Began compiling node model.my_dbt_trino_project.src_listen_events
[0m10:28:45.458357 [debug] [Thread-1 (]: Writing injected SQL for node "model.my_dbt_trino_project.src_listen_events"
[0m10:28:45.459418 [debug] [Thread-1 (]: Began executing node model.my_dbt_trino_project.src_listen_events
[0m10:28:45.488070 [debug] [Thread-1 (]: Using trino connection "model.my_dbt_trino_project.src_listen_events"
[0m10:28:45.488616 [debug] [Thread-1 (]: On model.my_dbt_trino_project.src_listen_events: /* {"app": "dbt", "dbt_version": "1.8.2", "profile_name": "my_dbt_trino_project", "target_name": "dev", "node_id": "model.my_dbt_trino_project.src_listen_events"} */

  
    

    create table "datalake"."analytics_source"."src_listen_events__dbt_tmp"
      
      
    as (
      

with source as (

    select
        CAST(_id AS VARCHAR) as id,
        artist,
        song,
        CAST(NULLIF(duration, '') AS DOUBLE) as duration,
        ts,
        sessionid,
        auth,
        level,
        CAST(NULLIF(itemInSession, '') AS INTEGER) as itemInSession,
        city,
        zip,
        state,
        country,
        userAgent,
        CAST(NULLIF(lon, '') AS DOUBLE) as lon,
        CAST(NULLIF(lat, '') AS DOUBLE) as lat,
        CAST(CAST(NULLIF(userId, '') AS DOUBLE) AS INTEGER) as userId,
 -- Assurez-vous que userId peut aussi être converti de cette manière.
        lastName,
        firstName,
        gender,
        CAST(CAST(NULLIF(registration, '') AS DOUBLE) AS BIGINT) as registration
    from "website"."demo"."listen_events"

)

select * from source



    -- this filter will only be applied on an incremental run
    where ts > (select max(ts) from "datalake"."analytics_source"."src_listen_events")


    )
[0m10:28:45.489152 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m10:28:45.660251 [debug] [Thread-1 (]: SQL status: SUCCESS in 0.0 seconds
[0m10:28:45.669685 [debug] [Thread-1 (]: Using trino connection "model.my_dbt_trino_project.src_listen_events"
[0m10:28:45.670214 [debug] [Thread-1 (]: On model.my_dbt_trino_project.src_listen_events: /* {"app": "dbt", "dbt_version": "1.8.2", "profile_name": "my_dbt_trino_project", "target_name": "dev", "node_id": "model.my_dbt_trino_project.src_listen_events"} */

    describe "datalake"."analytics_source"."src_listen_events__dbt_tmp"
[0m10:28:45.755265 [debug] [Thread-1 (]: SQL status: SUCCESS in 0.0 seconds
[0m10:28:45.758917 [debug] [Thread-1 (]: Using trino connection "model.my_dbt_trino_project.src_listen_events"
[0m10:28:45.759457 [debug] [Thread-1 (]: On model.my_dbt_trino_project.src_listen_events: /* {"app": "dbt", "dbt_version": "1.8.2", "profile_name": "my_dbt_trino_project", "target_name": "dev", "node_id": "model.my_dbt_trino_project.src_listen_events"} */

    describe "datalake"."analytics_source"."src_listen_events"
[0m10:28:45.855149 [debug] [Thread-1 (]: SQL status: SUCCESS in 0.0 seconds
[0m10:28:45.863663 [debug] [Thread-1 (]: Using trino connection "model.my_dbt_trino_project.src_listen_events"
[0m10:28:45.864187 [debug] [Thread-1 (]: On model.my_dbt_trino_project.src_listen_events: /* {"app": "dbt", "dbt_version": "1.8.2", "profile_name": "my_dbt_trino_project", "target_name": "dev", "node_id": "model.my_dbt_trino_project.src_listen_events"} */

    describe "datalake"."analytics_source"."src_listen_events"
[0m10:28:45.959023 [debug] [Thread-1 (]: SQL status: SUCCESS in 0.0 seconds
[0m10:28:45.967779 [debug] [Thread-1 (]: Writing runtime sql for node "model.my_dbt_trino_project.src_listen_events"
[0m10:28:45.970285 [debug] [Thread-1 (]: Using trino connection "model.my_dbt_trino_project.src_listen_events"
[0m10:28:45.970790 [debug] [Thread-1 (]: On model.my_dbt_trino_project.src_listen_events: /* {"app": "dbt", "dbt_version": "1.8.2", "profile_name": "my_dbt_trino_project", "target_name": "dev", "node_id": "model.my_dbt_trino_project.src_listen_events"} */
insert into "datalake"."analytics_source"."src_listen_events" ("id", "artist", "song", "duration", "ts", "sessionid", "auth", "level", "iteminsession", "city", "zip", "state", "country", "useragent", "lon", "lat", "userid", "lastname", "firstname", "gender", "registration")
    (
        select "id", "artist", "song", "duration", "ts", "sessionid", "auth", "level", "iteminsession", "city", "zip", "state", "country", "useragent", "lon", "lat", "userid", "lastname", "firstname", "gender", "registration"
        from "datalake"."analytics_source"."src_listen_events__dbt_tmp"
    )
[0m10:28:46.097289 [debug] [Thread-1 (]: SQL status: SUCCESS in 0.0 seconds
[0m10:28:46.099908 [debug] [Thread-1 (]: Applying DROP to: "datalake"."analytics_source"."src_listen_events__dbt_tmp"
[0m10:28:46.100941 [debug] [Thread-1 (]: Using trino connection "model.my_dbt_trino_project.src_listen_events"
[0m10:28:46.101473 [debug] [Thread-1 (]: On model.my_dbt_trino_project.src_listen_events: /* {"app": "dbt", "dbt_version": "1.8.2", "profile_name": "my_dbt_trino_project", "target_name": "dev", "node_id": "model.my_dbt_trino_project.src_listen_events"} */

    drop table if exists "datalake"."analytics_source"."src_listen_events__dbt_tmp"
[0m10:28:46.194535 [debug] [Thread-1 (]: SQL status: SUCCESS in 0.0 seconds
[0m10:28:46.196538 [debug] [Thread-1 (]: On model.my_dbt_trino_project.src_listen_events: ROLLBACK
[0m10:28:46.196538 [debug] [Thread-1 (]: On model.my_dbt_trino_project.src_listen_events: Close
[0m10:28:46.197534 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '6862f49b-c094-480f-96ba-3ed4c9a4c755', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x0000014BF50417D0>]}
[0m10:28:46.197534 [info ] [Thread-1 (]: 2 of 15 OK created sql incremental model analytics_source.src_listen_events .... [[32mSUCCESS[0m in 0.74s]
[0m10:28:46.198838 [debug] [Thread-1 (]: Finished running node model.my_dbt_trino_project.src_listen_events
[0m10:28:46.199843 [debug] [Thread-1 (]: Began running node model.my_dbt_trino_project.src_page_view_events
[0m10:28:46.199843 [info ] [Thread-1 (]: 3 of 15 START sql incremental model analytics_source.src_page_view_events ...... [RUN]
[0m10:28:46.200842 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.my_dbt_trino_project.src_listen_events, now model.my_dbt_trino_project.src_page_view_events)
[0m10:28:46.201347 [debug] [Thread-1 (]: Began compiling node model.my_dbt_trino_project.src_page_view_events
[0m10:28:46.204351 [debug] [Thread-1 (]: Writing injected SQL for node "model.my_dbt_trino_project.src_page_view_events"
[0m10:28:46.204351 [debug] [Thread-1 (]: Began executing node model.my_dbt_trino_project.src_page_view_events
[0m10:28:46.210351 [debug] [Thread-1 (]: Using trino connection "model.my_dbt_trino_project.src_page_view_events"
[0m10:28:46.210351 [debug] [Thread-1 (]: On model.my_dbt_trino_project.src_page_view_events: /* {"app": "dbt", "dbt_version": "1.8.2", "profile_name": "my_dbt_trino_project", "target_name": "dev", "node_id": "model.my_dbt_trino_project.src_page_view_events"} */

  
    

    create table "datalake"."analytics_source"."src_page_view_events__dbt_tmp"
      
      
    as (
      

with source as (
    select
        CAST(_id AS VARCHAR) as id,
        ts,
        CAST(sessionId AS VARCHAR) as sessionId,
        page,
        auth,
        level,
        CAST(CAST(NULLIF(itemInSession, '') AS DOUBLE) AS INTEGER) as itemInSession, 
        city,
        zip,
        state,
        userAgent,
        CAST(NULLIF(lon, '') AS double) as lon,
        CAST(NULLIF(lat, '') AS double) as lat,
        CAST(CAST(NULLIF(userId, '') AS DOUBLE) AS INTEGER) as userId, 
        lastName,
        firstName,
        gender,
        CAST(CAST(NULLIF(registration, '') AS DOUBLE) AS BIGINT) as registration, 
        artist,
        song,
        CAST(NULLIF(duration, '') AS double) as duration
    from "website"."demo"."page_view_events"
)

select * from source


    where ts > (select max(ts) from "datalake"."analytics_source"."src_page_view_events")

    )
[0m10:28:46.210351 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m10:28:46.365806 [debug] [Thread-1 (]: SQL status: SUCCESS in 0.0 seconds
[0m10:28:46.368810 [debug] [Thread-1 (]: Using trino connection "model.my_dbt_trino_project.src_page_view_events"
[0m10:28:46.369319 [debug] [Thread-1 (]: On model.my_dbt_trino_project.src_page_view_events: /* {"app": "dbt", "dbt_version": "1.8.2", "profile_name": "my_dbt_trino_project", "target_name": "dev", "node_id": "model.my_dbt_trino_project.src_page_view_events"} */

    describe "datalake"."analytics_source"."src_page_view_events__dbt_tmp"
[0m10:28:46.473630 [debug] [Thread-1 (]: SQL status: SUCCESS in 0.0 seconds
[0m10:28:46.477136 [debug] [Thread-1 (]: Using trino connection "model.my_dbt_trino_project.src_page_view_events"
[0m10:28:46.477136 [debug] [Thread-1 (]: On model.my_dbt_trino_project.src_page_view_events: /* {"app": "dbt", "dbt_version": "1.8.2", "profile_name": "my_dbt_trino_project", "target_name": "dev", "node_id": "model.my_dbt_trino_project.src_page_view_events"} */

    describe "datalake"."analytics_source"."src_page_view_events"
[0m10:28:46.565847 [debug] [Thread-1 (]: SQL status: SUCCESS in 0.0 seconds
[0m10:28:46.621474 [debug] [Thread-1 (]: Using trino connection "model.my_dbt_trino_project.src_page_view_events"
[0m10:28:46.622475 [debug] [Thread-1 (]: On model.my_dbt_trino_project.src_page_view_events: /* {"app": "dbt", "dbt_version": "1.8.2", "profile_name": "my_dbt_trino_project", "target_name": "dev", "node_id": "model.my_dbt_trino_project.src_page_view_events"} */

    describe "datalake"."analytics_source"."src_page_view_events"
[0m10:28:46.710930 [debug] [Thread-1 (]: SQL status: SUCCESS in 0.0 seconds
[0m10:28:46.713051 [debug] [Thread-1 (]: Writing runtime sql for node "model.my_dbt_trino_project.src_page_view_events"
[0m10:28:46.715186 [debug] [Thread-1 (]: Using trino connection "model.my_dbt_trino_project.src_page_view_events"
[0m10:28:46.715186 [debug] [Thread-1 (]: On model.my_dbt_trino_project.src_page_view_events: /* {"app": "dbt", "dbt_version": "1.8.2", "profile_name": "my_dbt_trino_project", "target_name": "dev", "node_id": "model.my_dbt_trino_project.src_page_view_events"} */
insert into "datalake"."analytics_source"."src_page_view_events" ("id", "ts", "sessionid", "page", "auth", "level", "iteminsession", "city", "zip", "state", "useragent", "lon", "lat", "userid", "lastname", "firstname", "gender", "registration", "artist", "song", "duration")
    (
        select "id", "ts", "sessionid", "page", "auth", "level", "iteminsession", "city", "zip", "state", "useragent", "lon", "lat", "userid", "lastname", "firstname", "gender", "registration", "artist", "song", "duration"
        from "datalake"."analytics_source"."src_page_view_events__dbt_tmp"
    )
[0m10:28:46.844678 [debug] [Thread-1 (]: SQL status: SUCCESS in 0.0 seconds
[0m10:28:46.846896 [debug] [Thread-1 (]: Applying DROP to: "datalake"."analytics_source"."src_page_view_events__dbt_tmp"
[0m10:28:46.847908 [debug] [Thread-1 (]: Using trino connection "model.my_dbt_trino_project.src_page_view_events"
[0m10:28:46.847908 [debug] [Thread-1 (]: On model.my_dbt_trino_project.src_page_view_events: /* {"app": "dbt", "dbt_version": "1.8.2", "profile_name": "my_dbt_trino_project", "target_name": "dev", "node_id": "model.my_dbt_trino_project.src_page_view_events"} */

    drop table if exists "datalake"."analytics_source"."src_page_view_events__dbt_tmp"
[0m10:28:46.951066 [debug] [Thread-1 (]: SQL status: SUCCESS in 0.0 seconds
[0m10:28:46.953579 [debug] [Thread-1 (]: On model.my_dbt_trino_project.src_page_view_events: ROLLBACK
[0m10:28:46.953579 [debug] [Thread-1 (]: On model.my_dbt_trino_project.src_page_view_events: Close
[0m10:28:46.954577 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '6862f49b-c094-480f-96ba-3ed4c9a4c755', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x0000014BF4AEEB90>]}
[0m10:28:46.954577 [info ] [Thread-1 (]: 3 of 15 OK created sql incremental model analytics_source.src_page_view_events . [[32mSUCCESS[0m in 0.75s]
[0m10:28:46.955580 [debug] [Thread-1 (]: Finished running node model.my_dbt_trino_project.src_page_view_events
[0m10:28:46.955580 [debug] [Thread-1 (]: Began running node model.my_dbt_trino_project.stg_user_level_by_gender
[0m10:28:46.956585 [info ] [Thread-1 (]: 4 of 15 START sql view model analytics_stage.stg_user_level_by_gender .......... [RUN]
[0m10:28:46.957585 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.my_dbt_trino_project.src_page_view_events, now model.my_dbt_trino_project.stg_user_level_by_gender)
[0m10:28:46.957585 [debug] [Thread-1 (]: Began compiling node model.my_dbt_trino_project.stg_user_level_by_gender
[0m10:28:46.959588 [debug] [Thread-1 (]: Writing injected SQL for node "model.my_dbt_trino_project.stg_user_level_by_gender"
[0m10:28:46.960825 [debug] [Thread-1 (]: Began executing node model.my_dbt_trino_project.stg_user_level_by_gender
[0m10:28:46.971334 [debug] [Thread-1 (]: Writing runtime sql for node "model.my_dbt_trino_project.stg_user_level_by_gender"
[0m10:28:46.972848 [debug] [Thread-1 (]: Using trino connection "model.my_dbt_trino_project.stg_user_level_by_gender"
[0m10:28:46.972848 [debug] [Thread-1 (]: On model.my_dbt_trino_project.stg_user_level_by_gender: /* {"app": "dbt", "dbt_version": "1.8.2", "profile_name": "my_dbt_trino_project", "target_name": "dev", "node_id": "model.my_dbt_trino_project.stg_user_level_by_gender"} */

  create or replace view
    "datalake"."analytics_stage"."stg_user_level_by_gender"
  security definer
  as
    

WITH user_subscriptions AS (
    SELECT
        gender,
        level, 
        COUNT(DISTINCT userId) AS user_count
    FROM "datalake"."analytics_source"."src_auth_events"
    WHERE gender IS NOT NULL AND level IS NOT NULL
    GROUP BY gender, level
)

SELECT
    gender,
    level,
    user_count
FROM user_subscriptions
  
[0m10:28:46.973847 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m10:28:47.029624 [debug] [Thread-1 (]: SQL status: SUCCESS in 0.0 seconds
[0m10:28:47.031624 [debug] [Thread-1 (]: On model.my_dbt_trino_project.stg_user_level_by_gender: ROLLBACK
[0m10:28:47.032626 [debug] [Thread-1 (]: On model.my_dbt_trino_project.stg_user_level_by_gender: Close
[0m10:28:47.032626 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '6862f49b-c094-480f-96ba-3ed4c9a4c755', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x0000014BF38C65D0>]}
[0m10:28:47.033628 [info ] [Thread-1 (]: 4 of 15 OK created sql view model analytics_stage.stg_user_level_by_gender ..... [[32mSUCCESS[0m in 0.08s]
[0m10:28:47.034629 [debug] [Thread-1 (]: Finished running node model.my_dbt_trino_project.stg_user_level_by_gender
[0m10:28:47.034629 [debug] [Thread-1 (]: Began running node model.my_dbt_trino_project.stg_streams_hourly
[0m10:28:47.035625 [info ] [Thread-1 (]: 5 of 15 START sql table model analytics_stage.stg_streams_hourly ............... [RUN]
[0m10:28:47.035625 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.my_dbt_trino_project.stg_user_level_by_gender, now model.my_dbt_trino_project.stg_streams_hourly)
[0m10:28:47.036830 [debug] [Thread-1 (]: Began compiling node model.my_dbt_trino_project.stg_streams_hourly
[0m10:28:47.038839 [debug] [Thread-1 (]: Writing injected SQL for node "model.my_dbt_trino_project.stg_streams_hourly"
[0m10:28:47.039837 [debug] [Thread-1 (]: Began executing node model.my_dbt_trino_project.stg_streams_hourly
[0m10:28:47.042250 [debug] [Thread-1 (]: Writing runtime sql for node "model.my_dbt_trino_project.stg_streams_hourly"
[0m10:28:47.044344 [debug] [Thread-1 (]: Using trino connection "model.my_dbt_trino_project.stg_streams_hourly"
[0m10:28:47.044344 [debug] [Thread-1 (]: On model.my_dbt_trino_project.stg_streams_hourly: /* {"app": "dbt", "dbt_version": "1.8.2", "profile_name": "my_dbt_trino_project", "target_name": "dev", "node_id": "model.my_dbt_trino_project.stg_streams_hourly"} */

  
    

    create table "datalake"."analytics_stage"."stg_streams_hourly__dbt_tmp"
      
      
    as (
      

SELECT
    DATE_FORMAT(FROM_UNIXTIME(ts), '%Y-%m-%d') AS stream_date, 
    DATE_FORMAT(FROM_UNIXTIME(ts), '%H') AS stream_hour,
    COUNT(*) AS total_streams
FROM "datalake"."analytics_source"."src_listen_events"
GROUP BY
    DATE_FORMAT(FROM_UNIXTIME(ts), '%Y-%m-%d'),
    DATE_FORMAT(FROM_UNIXTIME(ts), '%H')
    )
[0m10:28:47.044344 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m10:28:47.256827 [debug] [Thread-1 (]: SQL status: SUCCESS in 0.0 seconds
[0m10:28:47.259342 [debug] [Thread-1 (]: Using trino connection "model.my_dbt_trino_project.stg_streams_hourly"
[0m10:28:47.260339 [debug] [Thread-1 (]: On model.my_dbt_trino_project.stg_streams_hourly: /* {"app": "dbt", "dbt_version": "1.8.2", "profile_name": "my_dbt_trino_project", "target_name": "dev", "node_id": "model.my_dbt_trino_project.stg_streams_hourly"} */
alter table "datalake"."analytics_stage"."stg_streams_hourly" rename to "datalake"."analytics_stage"."stg_streams_hourly__dbt_backup"
[0m10:28:47.339869 [debug] [Thread-1 (]: SQL status: SUCCESS in 0.0 seconds
[0m10:28:47.342877 [debug] [Thread-1 (]: Using trino connection "model.my_dbt_trino_project.stg_streams_hourly"
[0m10:28:47.342877 [debug] [Thread-1 (]: On model.my_dbt_trino_project.stg_streams_hourly: /* {"app": "dbt", "dbt_version": "1.8.2", "profile_name": "my_dbt_trino_project", "target_name": "dev", "node_id": "model.my_dbt_trino_project.stg_streams_hourly"} */
alter table "datalake"."analytics_stage"."stg_streams_hourly__dbt_tmp" rename to "datalake"."analytics_stage"."stg_streams_hourly"
[0m10:28:47.423235 [debug] [Thread-1 (]: SQL status: SUCCESS in 0.0 seconds
[0m10:28:47.427236 [debug] [Thread-1 (]: Applying DROP to: "datalake"."analytics_stage"."stg_streams_hourly__dbt_backup"
[0m10:28:47.428235 [debug] [Thread-1 (]: Using trino connection "model.my_dbt_trino_project.stg_streams_hourly"
[0m10:28:47.429236 [debug] [Thread-1 (]: On model.my_dbt_trino_project.stg_streams_hourly: /* {"app": "dbt", "dbt_version": "1.8.2", "profile_name": "my_dbt_trino_project", "target_name": "dev", "node_id": "model.my_dbt_trino_project.stg_streams_hourly"} */

    drop table if exists "datalake"."analytics_stage"."stg_streams_hourly__dbt_backup"
[0m10:28:47.540319 [debug] [Thread-1 (]: SQL status: SUCCESS in 0.0 seconds
[0m10:28:47.542320 [debug] [Thread-1 (]: On model.my_dbt_trino_project.stg_streams_hourly: ROLLBACK
[0m10:28:47.542320 [debug] [Thread-1 (]: On model.my_dbt_trino_project.stg_streams_hourly: Close
[0m10:28:47.543320 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '6862f49b-c094-480f-96ba-3ed4c9a4c755', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x0000014BF652D7D0>]}
[0m10:28:47.543320 [info ] [Thread-1 (]: 5 of 15 OK created sql table model analytics_stage.stg_streams_hourly .......... [[32mSUCCESS[0m in 0.51s]
[0m10:28:47.544692 [debug] [Thread-1 (]: Finished running node model.my_dbt_trino_project.stg_streams_hourly
[0m10:28:47.544692 [debug] [Thread-1 (]: Began running node model.my_dbt_trino_project.stg_top_songs_artists
[0m10:28:47.545699 [info ] [Thread-1 (]: 6 of 15 START sql view model analytics_stage.stg_top_songs_artists ............. [RUN]
[0m10:28:47.545699 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.my_dbt_trino_project.stg_streams_hourly, now model.my_dbt_trino_project.stg_top_songs_artists)
[0m10:28:47.545699 [debug] [Thread-1 (]: Began compiling node model.my_dbt_trino_project.stg_top_songs_artists
[0m10:28:47.548589 [debug] [Thread-1 (]: Writing injected SQL for node "model.my_dbt_trino_project.stg_top_songs_artists"
[0m10:28:47.549623 [debug] [Thread-1 (]: Began executing node model.my_dbt_trino_project.stg_top_songs_artists
[0m10:28:47.551622 [debug] [Thread-1 (]: Writing runtime sql for node "model.my_dbt_trino_project.stg_top_songs_artists"
[0m10:28:47.552627 [debug] [Thread-1 (]: Using trino connection "model.my_dbt_trino_project.stg_top_songs_artists"
[0m10:28:47.552627 [debug] [Thread-1 (]: On model.my_dbt_trino_project.stg_top_songs_artists: /* {"app": "dbt", "dbt_version": "1.8.2", "profile_name": "my_dbt_trino_project", "target_name": "dev", "node_id": "model.my_dbt_trino_project.stg_top_songs_artists"} */

  create or replace view
    "datalake"."analytics_stage"."stg_top_songs_artists"
  security definer
  as
    

WITH song_plays AS (
    SELECT
        artist,
        song,
        COUNT(*) AS play_count
    FROM "datalake"."analytics_source"."src_listen_events"
    GROUP BY artist, song
)

SELECT
    artist,
    song,
    play_count
FROM song_plays
ORDER BY play_count DESC
  
[0m10:28:47.553626 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m10:28:47.595714 [debug] [Thread-1 (]: SQL status: SUCCESS in 0.0 seconds
[0m10:28:47.597873 [debug] [Thread-1 (]: On model.my_dbt_trino_project.stg_top_songs_artists: ROLLBACK
[0m10:28:47.597873 [debug] [Thread-1 (]: On model.my_dbt_trino_project.stg_top_songs_artists: Close
[0m10:28:47.598873 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '6862f49b-c094-480f-96ba-3ed4c9a4c755', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x0000014BF65B3810>]}
[0m10:28:47.599875 [info ] [Thread-1 (]: 6 of 15 OK created sql view model analytics_stage.stg_top_songs_artists ........ [[32mSUCCESS[0m in 0.05s]
[0m10:28:47.599875 [debug] [Thread-1 (]: Finished running node model.my_dbt_trino_project.stg_top_songs_artists
[0m10:28:47.600990 [debug] [Thread-1 (]: Began running node model.my_dbt_trino_project.stg_unique_users
[0m10:28:47.600990 [info ] [Thread-1 (]: 7 of 15 START sql view model analytics_stage.stg_unique_users .................. [RUN]
[0m10:28:47.600990 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.my_dbt_trino_project.stg_top_songs_artists, now model.my_dbt_trino_project.stg_unique_users)
[0m10:28:47.602499 [debug] [Thread-1 (]: Began compiling node model.my_dbt_trino_project.stg_unique_users
[0m10:28:47.605506 [debug] [Thread-1 (]: Writing injected SQL for node "model.my_dbt_trino_project.stg_unique_users"
[0m10:28:47.605506 [debug] [Thread-1 (]: Began executing node model.my_dbt_trino_project.stg_unique_users
[0m10:28:47.608504 [debug] [Thread-1 (]: Writing runtime sql for node "model.my_dbt_trino_project.stg_unique_users"
[0m10:28:47.609505 [debug] [Thread-1 (]: Using trino connection "model.my_dbt_trino_project.stg_unique_users"
[0m10:28:47.609505 [debug] [Thread-1 (]: On model.my_dbt_trino_project.stg_unique_users: /* {"app": "dbt", "dbt_version": "1.8.2", "profile_name": "my_dbt_trino_project", "target_name": "dev", "node_id": "model.my_dbt_trino_project.stg_unique_users"} */

  create or replace view
    "datalake"."analytics_stage"."stg_unique_users"
  security definer
  as
    

SELECT
    COUNT(DISTINCT userid) AS total_unique_users
FROM "datalake"."analytics_source"."src_listen_events"
WHERE userid IS NOT NULL
  
[0m10:28:47.609505 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m10:28:47.671971 [debug] [Thread-1 (]: SQL status: SUCCESS in 0.0 seconds
[0m10:28:47.673481 [debug] [Thread-1 (]: On model.my_dbt_trino_project.stg_unique_users: ROLLBACK
[0m10:28:47.673481 [debug] [Thread-1 (]: On model.my_dbt_trino_project.stg_unique_users: Close
[0m10:28:47.674481 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '6862f49b-c094-480f-96ba-3ed4c9a4c755', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x0000014BF6A37F90>]}
[0m10:28:47.674481 [info ] [Thread-1 (]: 7 of 15 OK created sql view model analytics_stage.stg_unique_users ............. [[32mSUCCESS[0m in 0.07s]
[0m10:28:47.675556 [debug] [Thread-1 (]: Finished running node model.my_dbt_trino_project.stg_unique_users
[0m10:28:47.676907 [debug] [Thread-1 (]: Began running node model.my_dbt_trino_project.stg_user_activity_per_country
[0m10:28:47.676907 [info ] [Thread-1 (]: 8 of 15 START sql view model analytics_stage.stg_user_activity_per_country ..... [RUN]
[0m10:28:47.677912 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.my_dbt_trino_project.stg_unique_users, now model.my_dbt_trino_project.stg_user_activity_per_country)
[0m10:28:47.677912 [debug] [Thread-1 (]: Began compiling node model.my_dbt_trino_project.stg_user_activity_per_country
[0m10:28:47.681420 [debug] [Thread-1 (]: Writing injected SQL for node "model.my_dbt_trino_project.stg_user_activity_per_country"
[0m10:28:47.681420 [debug] [Thread-1 (]: Began executing node model.my_dbt_trino_project.stg_user_activity_per_country
[0m10:28:47.683423 [debug] [Thread-1 (]: Writing runtime sql for node "model.my_dbt_trino_project.stg_user_activity_per_country"
[0m10:28:47.685420 [debug] [Thread-1 (]: Using trino connection "model.my_dbt_trino_project.stg_user_activity_per_country"
[0m10:28:47.686424 [debug] [Thread-1 (]: On model.my_dbt_trino_project.stg_user_activity_per_country: /* {"app": "dbt", "dbt_version": "1.8.2", "profile_name": "my_dbt_trino_project", "target_name": "dev", "node_id": "model.my_dbt_trino_project.stg_user_activity_per_country"} */

  create or replace view
    "datalake"."analytics_stage"."stg_user_activity_per_country"
  security definer
  as
    

WITH combined_activities AS (
  SELECT
    country,
    'listen_event' AS event_type,
    ts,
    userid
  FROM "datalake"."analytics_source"."src_listen_events"
  WHERE country IS NOT NULL
  UNION ALL
  SELECT
    'Unknown' AS country, 
    ts,
    userid
  FROM "datalake"."analytics_source"."src_auth_events"
  UNION ALL
  SELECT
    'Unknown' AS country, 
    'page_view_event' AS event_type,
    ts,
    userid
  FROM "datalake"."analytics_source"."src_page_view_events"
)

SELECT
  country,
  COUNT(*) AS activity_count
FROM combined_activities
GROUP BY country
  
[0m10:28:47.686424 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m10:28:47.741350 [debug] [Thread-1 (]: Trino adapter: Trino query id: 20240619_022847_00313_uxt54
[0m10:28:47.741878 [debug] [Thread-1 (]: Trino adapter: Trino error: TrinoUserError(type=USER_ERROR, name=TYPE_MISMATCH, message="line 17:3: UNION query has different number of fields: 4, 3", query_id=20240619_022847_00313_uxt54)
[0m10:28:47.742418 [debug] [Thread-1 (]: On model.my_dbt_trino_project.stg_user_activity_per_country: ROLLBACK
[0m10:28:47.742960 [debug] [Thread-1 (]: On model.my_dbt_trino_project.stg_user_activity_per_country: Close
[0m10:28:47.746645 [debug] [Thread-1 (]: Database Error in model stg_user_activity_per_country (models\stage\stg_user_activity_per_country.sql)
  TrinoUserError(type=USER_ERROR, name=TYPE_MISMATCH, message="line 17:3: UNION query has different number of fields: 4, 3", query_id=20240619_022847_00313_uxt54)
  compiled Code at target\run\my_dbt_trino_project\models\stage\stg_user_activity_per_country.sql
[0m10:28:47.747700 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '6862f49b-c094-480f-96ba-3ed4c9a4c755', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x0000014BF0B45350>]}
[0m10:28:47.748225 [error] [Thread-1 (]: 8 of 15 ERROR creating sql view model analytics_stage.stg_user_activity_per_country  [[31mERROR[0m in 0.07s]
[0m10:28:47.748225 [debug] [Thread-1 (]: Finished running node model.my_dbt_trino_project.stg_user_activity_per_country
[0m10:28:47.749233 [debug] [Thread-1 (]: Began running node model.my_dbt_trino_project.stg_user_activity_per_location
[0m10:28:47.749233 [info ] [Thread-1 (]: 9 of 15 START sql view model analytics_stage.stg_user_activity_per_location .... [RUN]
[0m10:28:47.750814 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.my_dbt_trino_project.stg_user_activity_per_country, now model.my_dbt_trino_project.stg_user_activity_per_location)
[0m10:28:47.750814 [debug] [Thread-1 (]: Began compiling node model.my_dbt_trino_project.stg_user_activity_per_location
[0m10:28:47.753885 [debug] [Thread-1 (]: Writing injected SQL for node "model.my_dbt_trino_project.stg_user_activity_per_location"
[0m10:28:47.754885 [debug] [Thread-1 (]: Began executing node model.my_dbt_trino_project.stg_user_activity_per_location
[0m10:28:47.756884 [debug] [Thread-1 (]: Writing runtime sql for node "model.my_dbt_trino_project.stg_user_activity_per_location"
[0m10:28:47.759390 [debug] [Thread-1 (]: Using trino connection "model.my_dbt_trino_project.stg_user_activity_per_location"
[0m10:28:47.759390 [debug] [Thread-1 (]: On model.my_dbt_trino_project.stg_user_activity_per_location: /* {"app": "dbt", "dbt_version": "1.8.2", "profile_name": "my_dbt_trino_project", "target_name": "dev", "node_id": "model.my_dbt_trino_project.stg_user_activity_per_location"} */

  create or replace view
    "datalake"."analytics_stage"."stg_user_activity_per_location"
  security definer
  as
    

WITH combined_activities AS (
  SELECT
    city,
    state,
    'auth_event' AS event_type,
    ts,
    userid
 FROM "datalake"."analytics_source"."src_auth_events"
  UNION ALL
  SELECT
    city,
    state,
    'listen_event' AS event_type,
    ts,
    userid
  FROM "datalake"."analytics_source"."src_listen_events"
  UNION ALL
  SELECT
    city,
    state,
    'page_view_event' AS event_type,
    ts,
    userid
  FROM "datalake"."analytics_source"."src_page_view_events"
)

SELECT
  state,
  city,
  COUNT(*) AS activity_count
FROM combined_activities
GROUP BY state, city
  
[0m10:28:47.760396 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m10:28:47.829888 [debug] [Thread-1 (]: SQL status: SUCCESS in 0.0 seconds
[0m10:28:47.832850 [debug] [Thread-1 (]: On model.my_dbt_trino_project.stg_user_activity_per_location: ROLLBACK
[0m10:28:47.832850 [debug] [Thread-1 (]: On model.my_dbt_trino_project.stg_user_activity_per_location: Close
[0m10:28:47.832850 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '6862f49b-c094-480f-96ba-3ed4c9a4c755', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x0000014BF69D5490>]}
[0m10:28:47.834303 [info ] [Thread-1 (]: 9 of 15 OK created sql view model analytics_stage.stg_user_activity_per_location  [[32mSUCCESS[0m in 0.08s]
[0m10:28:47.835313 [debug] [Thread-1 (]: Finished running node model.my_dbt_trino_project.stg_user_activity_per_location
[0m10:28:47.835313 [debug] [Thread-1 (]: Began running node model.my_dbt_trino_project.mart_user_level_by_gender
[0m10:28:47.836315 [info ] [Thread-1 (]: 10 of 15 START sql table model analytics.mart_user_level_by_gender ............. [RUN]
[0m10:28:47.837313 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.my_dbt_trino_project.stg_user_activity_per_location, now model.my_dbt_trino_project.mart_user_level_by_gender)
[0m10:28:47.837313 [debug] [Thread-1 (]: Began compiling node model.my_dbt_trino_project.mart_user_level_by_gender
[0m10:28:47.840313 [debug] [Thread-1 (]: Writing injected SQL for node "model.my_dbt_trino_project.mart_user_level_by_gender"
[0m10:28:47.841314 [debug] [Thread-1 (]: Began executing node model.my_dbt_trino_project.mart_user_level_by_gender
[0m10:28:47.843313 [debug] [Thread-1 (]: Writing runtime sql for node "model.my_dbt_trino_project.mart_user_level_by_gender"
[0m10:28:47.845312 [debug] [Thread-1 (]: Using trino connection "model.my_dbt_trino_project.mart_user_level_by_gender"
[0m10:28:47.845312 [debug] [Thread-1 (]: On model.my_dbt_trino_project.mart_user_level_by_gender: /* {"app": "dbt", "dbt_version": "1.8.2", "profile_name": "my_dbt_trino_project", "target_name": "dev", "node_id": "model.my_dbt_trino_project.mart_user_level_by_gender"} */

  
    

    create table "datalake"."analytics"."mart_user_level_by_gender__dbt_tmp"
      
      
    as (
      

SELECT
    gender,
    level,
    SUM(user_count) AS total_users,
    ROUND(SUM(user_count) * 100.0 / SUM(SUM(user_count)) OVER (), 2) AS percentage_of_total_users
FROM "datalake"."analytics_stage"."stg_user_level_by_gender"
GROUP BY gender, level
    )
[0m10:28:47.845312 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m10:28:48.094374 [debug] [Thread-1 (]: SQL status: SUCCESS in 0.0 seconds
[0m10:28:48.097377 [debug] [Thread-1 (]: Using trino connection "model.my_dbt_trino_project.mart_user_level_by_gender"
[0m10:28:48.097921 [debug] [Thread-1 (]: On model.my_dbt_trino_project.mart_user_level_by_gender: /* {"app": "dbt", "dbt_version": "1.8.2", "profile_name": "my_dbt_trino_project", "target_name": "dev", "node_id": "model.my_dbt_trino_project.mart_user_level_by_gender"} */
alter table "datalake"."analytics"."mart_user_level_by_gender" rename to "datalake"."analytics"."mart_user_level_by_gender__dbt_backup"
[0m10:28:48.180350 [debug] [Thread-1 (]: SQL status: SUCCESS in 0.0 seconds
[0m10:28:48.183349 [debug] [Thread-1 (]: Using trino connection "model.my_dbt_trino_project.mart_user_level_by_gender"
[0m10:28:48.183349 [debug] [Thread-1 (]: On model.my_dbt_trino_project.mart_user_level_by_gender: /* {"app": "dbt", "dbt_version": "1.8.2", "profile_name": "my_dbt_trino_project", "target_name": "dev", "node_id": "model.my_dbt_trino_project.mart_user_level_by_gender"} */
alter table "datalake"."analytics"."mart_user_level_by_gender__dbt_tmp" rename to "datalake"."analytics"."mart_user_level_by_gender"
[0m10:28:48.264702 [debug] [Thread-1 (]: SQL status: SUCCESS in 0.0 seconds
[0m10:28:48.267848 [debug] [Thread-1 (]: Applying DROP to: "datalake"."analytics"."mart_user_level_by_gender__dbt_backup"
[0m10:28:48.268910 [debug] [Thread-1 (]: Using trino connection "model.my_dbt_trino_project.mart_user_level_by_gender"
[0m10:28:48.268910 [debug] [Thread-1 (]: On model.my_dbt_trino_project.mart_user_level_by_gender: /* {"app": "dbt", "dbt_version": "1.8.2", "profile_name": "my_dbt_trino_project", "target_name": "dev", "node_id": "model.my_dbt_trino_project.mart_user_level_by_gender"} */

    drop table if exists "datalake"."analytics"."mart_user_level_by_gender__dbt_backup"
[0m10:28:48.387116 [debug] [Thread-1 (]: SQL status: SUCCESS in 0.0 seconds
[0m10:28:48.389125 [debug] [Thread-1 (]: On model.my_dbt_trino_project.mart_user_level_by_gender: ROLLBACK
[0m10:28:48.390124 [debug] [Thread-1 (]: On model.my_dbt_trino_project.mart_user_level_by_gender: Close
[0m10:28:48.391124 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '6862f49b-c094-480f-96ba-3ed4c9a4c755', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x0000014BF1C87F90>]}
[0m10:28:48.392124 [info ] [Thread-1 (]: 10 of 15 OK created sql table model analytics.mart_user_level_by_gender ........ [[32mSUCCESS[0m in 0.55s]
[0m10:28:48.392124 [debug] [Thread-1 (]: Finished running node model.my_dbt_trino_project.mart_user_level_by_gender
[0m10:28:48.393238 [debug] [Thread-1 (]: Began running node model.my_dbt_trino_project.mart_hourly_stream_evolution
[0m10:28:48.393745 [info ] [Thread-1 (]: 11 of 15 START sql table model analytics.mart_hourly_stream_evolution .......... [RUN]
[0m10:28:48.394753 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.my_dbt_trino_project.mart_user_level_by_gender, now model.my_dbt_trino_project.mart_hourly_stream_evolution)
[0m10:28:48.394753 [debug] [Thread-1 (]: Began compiling node model.my_dbt_trino_project.mart_hourly_stream_evolution
[0m10:28:48.398753 [debug] [Thread-1 (]: Writing injected SQL for node "model.my_dbt_trino_project.mart_hourly_stream_evolution"
[0m10:28:48.399750 [debug] [Thread-1 (]: Began executing node model.my_dbt_trino_project.mart_hourly_stream_evolution
[0m10:28:48.402750 [debug] [Thread-1 (]: Writing runtime sql for node "model.my_dbt_trino_project.mart_hourly_stream_evolution"
[0m10:28:48.403256 [debug] [Thread-1 (]: Using trino connection "model.my_dbt_trino_project.mart_hourly_stream_evolution"
[0m10:28:48.404263 [debug] [Thread-1 (]: On model.my_dbt_trino_project.mart_hourly_stream_evolution: /* {"app": "dbt", "dbt_version": "1.8.2", "profile_name": "my_dbt_trino_project", "target_name": "dev", "node_id": "model.my_dbt_trino_project.mart_hourly_stream_evolution"} */

  
    

    create table "datalake"."analytics"."mart_hourly_stream_evolution__dbt_tmp"
      
      
    as (
      

SELECT
    stream_date,
    stream_hour,
    total_streams,
    SUM(total_streams) OVER (PARTITION BY stream_date ORDER BY stream_hour) AS cumulative_streams
FROM "datalake"."analytics_stage"."stg_streams_hourly"
ORDER BY
    stream_date,
    stream_hour
    )
[0m10:28:48.404263 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m10:28:48.632240 [debug] [Thread-1 (]: SQL status: SUCCESS in 0.0 seconds
[0m10:28:48.635248 [debug] [Thread-1 (]: Using trino connection "model.my_dbt_trino_project.mart_hourly_stream_evolution"
[0m10:28:48.635248 [debug] [Thread-1 (]: On model.my_dbt_trino_project.mart_hourly_stream_evolution: /* {"app": "dbt", "dbt_version": "1.8.2", "profile_name": "my_dbt_trino_project", "target_name": "dev", "node_id": "model.my_dbt_trino_project.mart_hourly_stream_evolution"} */
alter table "datalake"."analytics"."mart_hourly_stream_evolution" rename to "datalake"."analytics"."mart_hourly_stream_evolution__dbt_backup"
[0m10:28:48.737481 [debug] [Thread-1 (]: SQL status: SUCCESS in 0.0 seconds
[0m10:28:48.741002 [debug] [Thread-1 (]: Using trino connection "model.my_dbt_trino_project.mart_hourly_stream_evolution"
[0m10:28:48.741002 [debug] [Thread-1 (]: On model.my_dbt_trino_project.mart_hourly_stream_evolution: /* {"app": "dbt", "dbt_version": "1.8.2", "profile_name": "my_dbt_trino_project", "target_name": "dev", "node_id": "model.my_dbt_trino_project.mart_hourly_stream_evolution"} */
alter table "datalake"."analytics"."mart_hourly_stream_evolution__dbt_tmp" rename to "datalake"."analytics"."mart_hourly_stream_evolution"
[0m10:28:48.825816 [debug] [Thread-1 (]: SQL status: SUCCESS in 0.0 seconds
[0m10:28:48.829826 [debug] [Thread-1 (]: Applying DROP to: "datalake"."analytics"."mart_hourly_stream_evolution__dbt_backup"
[0m10:28:48.830825 [debug] [Thread-1 (]: Using trino connection "model.my_dbt_trino_project.mart_hourly_stream_evolution"
[0m10:28:48.831825 [debug] [Thread-1 (]: On model.my_dbt_trino_project.mart_hourly_stream_evolution: /* {"app": "dbt", "dbt_version": "1.8.2", "profile_name": "my_dbt_trino_project", "target_name": "dev", "node_id": "model.my_dbt_trino_project.mart_hourly_stream_evolution"} */

    drop table if exists "datalake"."analytics"."mart_hourly_stream_evolution__dbt_backup"
[0m10:28:48.942037 [debug] [Thread-1 (]: SQL status: SUCCESS in 0.0 seconds
[0m10:28:48.943549 [debug] [Thread-1 (]: On model.my_dbt_trino_project.mart_hourly_stream_evolution: ROLLBACK
[0m10:28:48.943549 [debug] [Thread-1 (]: On model.my_dbt_trino_project.mart_hourly_stream_evolution: Close
[0m10:28:48.944549 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '6862f49b-c094-480f-96ba-3ed4c9a4c755', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x0000014BF6964F90>]}
[0m10:28:48.945550 [info ] [Thread-1 (]: 11 of 15 OK created sql table model analytics.mart_hourly_stream_evolution ..... [[32mSUCCESS[0m in 0.55s]
[0m10:28:48.945550 [debug] [Thread-1 (]: Finished running node model.my_dbt_trino_project.mart_hourly_stream_evolution
[0m10:28:48.946549 [debug] [Thread-1 (]: Began running node model.my_dbt_trino_project.mart_top_songs_artists
[0m10:28:48.946549 [info ] [Thread-1 (]: 12 of 15 START sql table model analytics.mart_top_songs_artists ................ [RUN]
[0m10:28:48.947659 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.my_dbt_trino_project.mart_hourly_stream_evolution, now model.my_dbt_trino_project.mart_top_songs_artists)
[0m10:28:48.947659 [debug] [Thread-1 (]: Began compiling node model.my_dbt_trino_project.mart_top_songs_artists
[0m10:28:48.950934 [debug] [Thread-1 (]: Writing injected SQL for node "model.my_dbt_trino_project.mart_top_songs_artists"
[0m10:28:48.950934 [debug] [Thread-1 (]: Began executing node model.my_dbt_trino_project.mart_top_songs_artists
[0m10:28:48.953934 [debug] [Thread-1 (]: Writing runtime sql for node "model.my_dbt_trino_project.mart_top_songs_artists"
[0m10:28:48.954931 [debug] [Thread-1 (]: Using trino connection "model.my_dbt_trino_project.mart_top_songs_artists"
[0m10:28:48.955932 [debug] [Thread-1 (]: On model.my_dbt_trino_project.mart_top_songs_artists: /* {"app": "dbt", "dbt_version": "1.8.2", "profile_name": "my_dbt_trino_project", "target_name": "dev", "node_id": "model.my_dbt_trino_project.mart_top_songs_artists"} */

  
    

    create table "datalake"."analytics"."mart_top_songs_artists__dbt_tmp"
      
      
    as (
      

WITH top_songs AS (
    SELECT
        artist,
        song,
        play_count
    FROM "datalake"."analytics_stage"."stg_top_songs_artists"
)

SELECT
    artist,
    song,
    play_count
FROM top_songs
    )
[0m10:28:48.955932 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m10:28:49.194136 [debug] [Thread-1 (]: SQL status: SUCCESS in 0.0 seconds
[0m10:28:49.197133 [debug] [Thread-1 (]: Using trino connection "model.my_dbt_trino_project.mart_top_songs_artists"
[0m10:28:49.198132 [debug] [Thread-1 (]: On model.my_dbt_trino_project.mart_top_songs_artists: /* {"app": "dbt", "dbt_version": "1.8.2", "profile_name": "my_dbt_trino_project", "target_name": "dev", "node_id": "model.my_dbt_trino_project.mart_top_songs_artists"} */
alter table "datalake"."analytics"."mart_top_songs_artists" rename to "datalake"."analytics"."mart_top_songs_artists__dbt_backup"
[0m10:28:49.291743 [debug] [Thread-1 (]: SQL status: SUCCESS in 0.0 seconds
[0m10:28:49.294744 [debug] [Thread-1 (]: Using trino connection "model.my_dbt_trino_project.mart_top_songs_artists"
[0m10:28:49.295745 [debug] [Thread-1 (]: On model.my_dbt_trino_project.mart_top_songs_artists: /* {"app": "dbt", "dbt_version": "1.8.2", "profile_name": "my_dbt_trino_project", "target_name": "dev", "node_id": "model.my_dbt_trino_project.mart_top_songs_artists"} */
alter table "datalake"."analytics"."mart_top_songs_artists__dbt_tmp" rename to "datalake"."analytics"."mart_top_songs_artists"
[0m10:28:49.389044 [debug] [Thread-1 (]: SQL status: SUCCESS in 0.0 seconds
[0m10:28:49.392786 [debug] [Thread-1 (]: Applying DROP to: "datalake"."analytics"."mart_top_songs_artists__dbt_backup"
[0m10:28:49.393561 [debug] [Thread-1 (]: Using trino connection "model.my_dbt_trino_project.mart_top_songs_artists"
[0m10:28:49.393561 [debug] [Thread-1 (]: On model.my_dbt_trino_project.mart_top_songs_artists: /* {"app": "dbt", "dbt_version": "1.8.2", "profile_name": "my_dbt_trino_project", "target_name": "dev", "node_id": "model.my_dbt_trino_project.mart_top_songs_artists"} */

    drop table if exists "datalake"."analytics"."mart_top_songs_artists__dbt_backup"
[0m10:28:49.497488 [debug] [Thread-1 (]: SQL status: SUCCESS in 0.0 seconds
[0m10:28:49.498486 [debug] [Thread-1 (]: On model.my_dbt_trino_project.mart_top_songs_artists: ROLLBACK
[0m10:28:49.499486 [debug] [Thread-1 (]: On model.my_dbt_trino_project.mart_top_songs_artists: Close
[0m10:28:49.499486 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '6862f49b-c094-480f-96ba-3ed4c9a4c755', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x0000014BF1D80550>]}
[0m10:28:49.499486 [info ] [Thread-1 (]: 12 of 15 OK created sql table model analytics.mart_top_songs_artists ........... [[32mSUCCESS[0m in 0.55s]
[0m10:28:49.500908 [debug] [Thread-1 (]: Finished running node model.my_dbt_trino_project.mart_top_songs_artists
[0m10:28:49.500908 [debug] [Thread-1 (]: Began running node model.my_dbt_trino_project.mart_total_unique_users
[0m10:28:49.501917 [info ] [Thread-1 (]: 13 of 15 START sql table model analytics.mart_total_unique_users ............... [RUN]
[0m10:28:49.501917 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.my_dbt_trino_project.mart_top_songs_artists, now model.my_dbt_trino_project.mart_total_unique_users)
[0m10:28:49.502917 [debug] [Thread-1 (]: Began compiling node model.my_dbt_trino_project.mart_total_unique_users
[0m10:28:49.504436 [debug] [Thread-1 (]: Writing injected SQL for node "model.my_dbt_trino_project.mart_total_unique_users"
[0m10:28:49.505946 [debug] [Thread-1 (]: Began executing node model.my_dbt_trino_project.mart_total_unique_users
[0m10:28:49.508954 [debug] [Thread-1 (]: Writing runtime sql for node "model.my_dbt_trino_project.mart_total_unique_users"
[0m10:28:49.509957 [debug] [Thread-1 (]: Using trino connection "model.my_dbt_trino_project.mart_total_unique_users"
[0m10:28:49.509957 [debug] [Thread-1 (]: On model.my_dbt_trino_project.mart_total_unique_users: /* {"app": "dbt", "dbt_version": "1.8.2", "profile_name": "my_dbt_trino_project", "target_name": "dev", "node_id": "model.my_dbt_trino_project.mart_total_unique_users"} */

  
    

    create table "datalake"."analytics"."mart_total_unique_users__dbt_tmp"
      
      
    as (
      

SELECT
    total_unique_users
FROM "datalake"."analytics_stage"."stg_unique_users"
    )
[0m10:28:49.510959 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m10:28:49.738727 [debug] [Thread-1 (]: SQL status: SUCCESS in 0.0 seconds
[0m10:28:49.741306 [debug] [Thread-1 (]: Using trino connection "model.my_dbt_trino_project.mart_total_unique_users"
[0m10:28:49.742315 [debug] [Thread-1 (]: On model.my_dbt_trino_project.mart_total_unique_users: /* {"app": "dbt", "dbt_version": "1.8.2", "profile_name": "my_dbt_trino_project", "target_name": "dev", "node_id": "model.my_dbt_trino_project.mart_total_unique_users"} */
alter table "datalake"."analytics"."mart_total_unique_users" rename to "datalake"."analytics"."mart_total_unique_users__dbt_backup"
[0m10:28:49.821620 [debug] [Thread-1 (]: SQL status: SUCCESS in 0.0 seconds
[0m10:28:49.824617 [debug] [Thread-1 (]: Using trino connection "model.my_dbt_trino_project.mart_total_unique_users"
[0m10:28:49.825617 [debug] [Thread-1 (]: On model.my_dbt_trino_project.mart_total_unique_users: /* {"app": "dbt", "dbt_version": "1.8.2", "profile_name": "my_dbt_trino_project", "target_name": "dev", "node_id": "model.my_dbt_trino_project.mart_total_unique_users"} */
alter table "datalake"."analytics"."mart_total_unique_users__dbt_tmp" rename to "datalake"."analytics"."mart_total_unique_users"
[0m10:28:49.919612 [debug] [Thread-1 (]: SQL status: SUCCESS in 0.0 seconds
[0m10:28:49.922620 [debug] [Thread-1 (]: Applying DROP to: "datalake"."analytics"."mart_total_unique_users__dbt_backup"
[0m10:28:49.922620 [debug] [Thread-1 (]: Using trino connection "model.my_dbt_trino_project.mart_total_unique_users"
[0m10:28:49.923622 [debug] [Thread-1 (]: On model.my_dbt_trino_project.mart_total_unique_users: /* {"app": "dbt", "dbt_version": "1.8.2", "profile_name": "my_dbt_trino_project", "target_name": "dev", "node_id": "model.my_dbt_trino_project.mart_total_unique_users"} */

    drop table if exists "datalake"."analytics"."mart_total_unique_users__dbt_backup"
[0m10:28:50.026633 [debug] [Thread-1 (]: SQL status: SUCCESS in 0.0 seconds
[0m10:28:50.028292 [debug] [Thread-1 (]: On model.my_dbt_trino_project.mart_total_unique_users: ROLLBACK
[0m10:28:50.029299 [debug] [Thread-1 (]: On model.my_dbt_trino_project.mart_total_unique_users: Close
[0m10:28:50.029299 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '6862f49b-c094-480f-96ba-3ed4c9a4c755', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x0000014BF4535E50>]}
[0m10:28:50.030299 [info ] [Thread-1 (]: 13 of 15 OK created sql table model analytics.mart_total_unique_users .......... [[32mSUCCESS[0m in 0.53s]
[0m10:28:50.030299 [debug] [Thread-1 (]: Finished running node model.my_dbt_trino_project.mart_total_unique_users
[0m10:28:50.031299 [debug] [Thread-1 (]: Began running node model.my_dbt_trino_project.mart_user_activity_per_country
[0m10:28:50.031299 [info ] [Thread-1 (]: 14 of 15 SKIP relation analytics.mart_user_activity_per_country ................ [[33mSKIP[0m]
[0m10:28:50.032297 [debug] [Thread-1 (]: Finished running node model.my_dbt_trino_project.mart_user_activity_per_country
[0m10:28:50.032297 [debug] [Thread-1 (]: Began running node model.my_dbt_trino_project.mart_user_activity_per_state
[0m10:28:50.033297 [info ] [Thread-1 (]: 15 of 15 START sql table model analytics.mart_user_activity_per_state .......... [RUN]
[0m10:28:50.033297 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.my_dbt_trino_project.mart_total_unique_users, now model.my_dbt_trino_project.mart_user_activity_per_state)
[0m10:28:50.034482 [debug] [Thread-1 (]: Began compiling node model.my_dbt_trino_project.mart_user_activity_per_state
[0m10:28:50.036813 [debug] [Thread-1 (]: Writing injected SQL for node "model.my_dbt_trino_project.mart_user_activity_per_state"
[0m10:28:50.036813 [debug] [Thread-1 (]: Began executing node model.my_dbt_trino_project.mart_user_activity_per_state
[0m10:28:50.039828 [debug] [Thread-1 (]: Writing runtime sql for node "model.my_dbt_trino_project.mart_user_activity_per_state"
[0m10:28:50.040828 [debug] [Thread-1 (]: Using trino connection "model.my_dbt_trino_project.mart_user_activity_per_state"
[0m10:28:50.041829 [debug] [Thread-1 (]: On model.my_dbt_trino_project.mart_user_activity_per_state: /* {"app": "dbt", "dbt_version": "1.8.2", "profile_name": "my_dbt_trino_project", "target_name": "dev", "node_id": "model.my_dbt_trino_project.mart_user_activity_per_state"} */

  
    

    create table "datalake"."analytics"."mart_user_activity_per_state__dbt_tmp"
      
      
    as (
      

SELECT
  state,
  city,
  SUM(activity_count) AS total_activity
FROM "datalake"."analytics_stage"."stg_user_activity_per_location"
GROUP BY state, city
ORDER BY state, SUM(activity_count) DESC
    )
[0m10:28:50.041829 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m10:28:50.309994 [debug] [Thread-1 (]: SQL status: SUCCESS in 0.0 seconds
[0m10:28:50.313002 [debug] [Thread-1 (]: Using trino connection "model.my_dbt_trino_project.mart_user_activity_per_state"
[0m10:28:50.313002 [debug] [Thread-1 (]: On model.my_dbt_trino_project.mart_user_activity_per_state: /* {"app": "dbt", "dbt_version": "1.8.2", "profile_name": "my_dbt_trino_project", "target_name": "dev", "node_id": "model.my_dbt_trino_project.mart_user_activity_per_state"} */
alter table "datalake"."analytics"."mart_user_activity_per_state" rename to "datalake"."analytics"."mart_user_activity_per_state__dbt_backup"
[0m10:28:50.391258 [debug] [Thread-1 (]: SQL status: SUCCESS in 0.0 seconds
[0m10:28:50.394263 [debug] [Thread-1 (]: Using trino connection "model.my_dbt_trino_project.mart_user_activity_per_state"
[0m10:28:50.394263 [debug] [Thread-1 (]: On model.my_dbt_trino_project.mart_user_activity_per_state: /* {"app": "dbt", "dbt_version": "1.8.2", "profile_name": "my_dbt_trino_project", "target_name": "dev", "node_id": "model.my_dbt_trino_project.mart_user_activity_per_state"} */
alter table "datalake"."analytics"."mart_user_activity_per_state__dbt_tmp" rename to "datalake"."analytics"."mart_user_activity_per_state"
[0m10:28:50.481720 [debug] [Thread-1 (]: SQL status: SUCCESS in 0.0 seconds
[0m10:28:50.484719 [debug] [Thread-1 (]: Applying DROP to: "datalake"."analytics"."mart_user_activity_per_state__dbt_backup"
[0m10:28:50.484719 [debug] [Thread-1 (]: Using trino connection "model.my_dbt_trino_project.mart_user_activity_per_state"
[0m10:28:50.485721 [debug] [Thread-1 (]: On model.my_dbt_trino_project.mart_user_activity_per_state: /* {"app": "dbt", "dbt_version": "1.8.2", "profile_name": "my_dbt_trino_project", "target_name": "dev", "node_id": "model.my_dbt_trino_project.mart_user_activity_per_state"} */

    drop table if exists "datalake"."analytics"."mart_user_activity_per_state__dbt_backup"
[0m10:28:50.608104 [debug] [Thread-1 (]: SQL status: SUCCESS in 0.0 seconds
[0m10:28:50.609700 [debug] [Thread-1 (]: On model.my_dbt_trino_project.mart_user_activity_per_state: ROLLBACK
[0m10:28:50.610281 [debug] [Thread-1 (]: On model.my_dbt_trino_project.mart_user_activity_per_state: Close
[0m10:28:50.610790 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '6862f49b-c094-480f-96ba-3ed4c9a4c755', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x0000014BF619B710>]}
[0m10:28:50.611316 [info ] [Thread-1 (]: 15 of 15 OK created sql table model analytics.mart_user_activity_per_state ..... [[32mSUCCESS[0m in 0.58s]
[0m10:28:50.611837 [debug] [Thread-1 (]: Finished running node model.my_dbt_trino_project.mart_user_activity_per_state
[0m10:28:50.612886 [debug] [MainThread]: On master: COMMIT
[0m10:28:50.613427 [debug] [MainThread]: Connection 'master' was properly closed.
[0m10:28:50.613973 [debug] [MainThread]: Connection 'list_datalake' was properly closed.
[0m10:28:50.613973 [debug] [MainThread]: Connection 'list_datalake_analytics_source' was properly closed.
[0m10:28:50.614491 [debug] [MainThread]: Connection 'model.my_dbt_trino_project.mart_user_activity_per_state' was properly closed.
[0m10:28:50.615013 [info ] [MainThread]: 
[0m10:28:50.615529 [info ] [MainThread]: Finished running 8 table models, 2 incremental models, 5 view models in 0 hours 0 minutes and 6.19 seconds (6.19s).
[0m10:28:50.617094 [debug] [MainThread]: Command end result
[0m10:28:50.650485 [info ] [MainThread]: 
[0m10:28:50.651543 [info ] [MainThread]: [31mCompleted with 1 error and 0 warnings:[0m
[0m10:28:50.652081 [info ] [MainThread]: 
[0m10:28:50.652605 [error] [MainThread]:   Database Error in model stg_user_activity_per_country (models\stage\stg_user_activity_per_country.sql)
  TrinoUserError(type=USER_ERROR, name=TYPE_MISMATCH, message="line 17:3: UNION query has different number of fields: 4, 3", query_id=20240619_022847_00313_uxt54)
  compiled Code at target\run\my_dbt_trino_project\models\stage\stg_user_activity_per_country.sql
[0m10:28:50.653137 [info ] [MainThread]: 
[0m10:28:50.653667 [info ] [MainThread]: Done. PASS=13 WARN=0 ERROR=1 SKIP=1 TOTAL=15
[0m10:28:50.654718 [debug] [MainThread]: Command `dbt run` failed at 10:28:50.654718 after 6.95 seconds
[0m10:28:50.655246 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x0000014BF4B40110>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x0000014BEFBEEF50>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x0000014BEFBEEDD0>]}
[0m10:28:50.655246 [debug] [MainThread]: Flushing usage events
[0m10:32:05.141278 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000002624D004C10>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000002624CFF7FD0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000002624CBF7110>]}


============================== 10:32:05.144279 | 06846fa7-a8fc-468b-8654-70d69101f297 ==============================
[0m10:32:05.144279 [info ] [MainThread]: Running with dbt=1.8.2
[0m10:32:05.144279 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'indirect_selection': 'eager', 'log_cache_events': 'False', 'write_json': 'True', 'partial_parse': 'True', 'cache_selected_only': 'False', 'warn_error': 'None', 'fail_fast': 'False', 'debug': 'False', 'log_path': 'C:\\Users\\ASUS\\Desktop\\work\\Iceberg-Dbt-Trino-Hive-modern-open-source-data-stack-main\\dbt\\logs', 'version_check': 'True', 'profiles_dir': 'C:\\Users\\ASUS\\Desktop\\work\\Iceberg-Dbt-Trino-Hive-modern-open-source-data-stack-main\\dbt', 'use_colors': 'True', 'use_experimental_parser': 'False', 'no_print': 'None', 'quiet': 'False', 'log_format': 'default', 'invocation_command': 'dbt run', 'introspect': 'True', 'static_parser': 'True', 'target_path': 'None', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'send_anonymous_usage_stats': 'True'}
[0m10:32:05.442005 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': '06846fa7-a8fc-468b-8654-70d69101f297', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000002624D407550>]}
[0m10:32:05.481006 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': '06846fa7-a8fc-468b-8654-70d69101f297', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000002624A175510>]}
[0m10:32:05.482010 [info ] [MainThread]: Registered adapter: trino=1.8.0
[0m10:32:05.493006 [debug] [MainThread]: checksum: f0a141b9de567cb7f131613ba2682f40b3a1c6a157f81c6e5435862eff68f109, vars: {}, profile: , target: , version: 1.8.2
[0m10:32:05.652142 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 1 files changed.
[0m10:32:05.653141 [debug] [MainThread]: Partial parsing: updated file: my_dbt_trino_project://models\stage\stg_user_activity_per_country.sql
[0m10:32:05.833452 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': '06846fa7-a8fc-468b-8654-70d69101f297', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000002624D62A250>]}
[0m10:32:05.903852 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': '06846fa7-a8fc-468b-8654-70d69101f297', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000002624D8023D0>]}
[0m10:32:05.904373 [info ] [MainThread]: Found 15 models, 7 data tests, 3 sources, 559 macros
[0m10:32:05.904373 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '06846fa7-a8fc-468b-8654-70d69101f297', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000002624D49C4D0>]}
[0m10:32:05.906506 [info ] [MainThread]: 
[0m10:32:05.907031 [debug] [MainThread]: Acquiring new trino connection 'master'
[0m10:32:05.910797 [debug] [ThreadPool]: Acquiring new trino connection 'list_datalake'
[0m10:32:05.968415 [debug] [ThreadPool]: Using trino connection "list_datalake"
[0m10:32:05.969105 [debug] [ThreadPool]: On list_datalake: /* {"app": "dbt", "dbt_version": "1.8.2", "profile_name": "my_dbt_trino_project", "target_name": "dev", "connection_name": "list_datalake"} */

    select schema_name
    from "datalake".INFORMATION_SCHEMA.schemata
[0m10:32:05.969105 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m10:32:06.007150 [debug] [ThreadPool]: SQL status: SUCCESS in 0.0 seconds
[0m10:32:06.008701 [debug] [ThreadPool]: On list_datalake: Close
[0m10:32:06.011882 [debug] [ThreadPool]: Using trino connection "list_datalake"
[0m10:32:06.011882 [debug] [ThreadPool]: On list_datalake: /* {"app": "dbt", "dbt_version": "1.8.2", "profile_name": "my_dbt_trino_project", "target_name": "dev", "connection_name": "list_datalake"} */

    select schema_name
    from "datalake".INFORMATION_SCHEMA.schemata
[0m10:32:06.012424 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m10:32:06.056539 [debug] [ThreadPool]: SQL status: SUCCESS in 0.0 seconds
[0m10:32:06.057608 [debug] [ThreadPool]: On list_datalake: Close
[0m10:32:06.060276 [debug] [ThreadPool]: Using trino connection "list_datalake"
[0m10:32:06.060814 [debug] [ThreadPool]: On list_datalake: /* {"app": "dbt", "dbt_version": "1.8.2", "profile_name": "my_dbt_trino_project", "target_name": "dev", "connection_name": "list_datalake"} */

    select schema_name
    from "datalake".INFORMATION_SCHEMA.schemata
[0m10:32:06.060814 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m10:32:06.100794 [debug] [ThreadPool]: SQL status: SUCCESS in 0.0 seconds
[0m10:32:06.101802 [debug] [ThreadPool]: On list_datalake: Close
[0m10:32:06.103803 [debug] [ThreadPool]: Acquiring new trino connection 'list_datalake_analytics'
[0m10:32:06.113804 [debug] [ThreadPool]: Using trino connection "list_datalake_analytics"
[0m10:32:06.114803 [debug] [ThreadPool]: On list_datalake_analytics: /* {"app": "dbt", "dbt_version": "1.8.2", "profile_name": "my_dbt_trino_project", "target_name": "dev", "connection_name": "list_datalake_analytics"} */
select
      t.table_catalog as database,
      t.table_name as name,
      t.table_schema as schema,
      case when mv.name is not null then 'materialized_view'
           when t.table_type = 'BASE TABLE' then 'table'
           when t.table_type = 'VIEW' then 'view'
           else t.table_type
      end as table_type
    from "datalake".INFORMATION_SCHEMA.tables t
    left join (
            select * from system.metadata.materialized_views
            where catalog_name = 'datalake'
              and schema_name = 'analytics') mv
          on mv.catalog_name = t.table_catalog and mv.schema_name = t.table_schema and mv.name = t.table_name
    where t.table_schema = 'analytics'
[0m10:32:06.114803 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m10:32:06.175095 [debug] [ThreadPool]: SQL status: SUCCESS in 0.0 seconds
[0m10:32:06.176102 [debug] [ThreadPool]: On list_datalake_analytics: ROLLBACK
[0m10:32:06.176102 [debug] [ThreadPool]: On list_datalake_analytics: Close
[0m10:32:06.177103 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_datalake_analytics, now list_datalake_analytics_stage)
[0m10:32:06.182607 [debug] [ThreadPool]: Using trino connection "list_datalake_analytics_stage"
[0m10:32:06.183125 [debug] [ThreadPool]: On list_datalake_analytics_stage: /* {"app": "dbt", "dbt_version": "1.8.2", "profile_name": "my_dbt_trino_project", "target_name": "dev", "connection_name": "list_datalake_analytics_stage"} */
select
      t.table_catalog as database,
      t.table_name as name,
      t.table_schema as schema,
      case when mv.name is not null then 'materialized_view'
           when t.table_type = 'BASE TABLE' then 'table'
           when t.table_type = 'VIEW' then 'view'
           else t.table_type
      end as table_type
    from "datalake".INFORMATION_SCHEMA.tables t
    left join (
            select * from system.metadata.materialized_views
            where catalog_name = 'datalake'
              and schema_name = 'analytics_stage') mv
          on mv.catalog_name = t.table_catalog and mv.schema_name = t.table_schema and mv.name = t.table_name
    where t.table_schema = 'analytics_stage'
[0m10:32:06.183648 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m10:32:06.254639 [debug] [ThreadPool]: SQL status: SUCCESS in 0.0 seconds
[0m10:32:06.255180 [debug] [ThreadPool]: On list_datalake_analytics_stage: ROLLBACK
[0m10:32:06.256188 [debug] [ThreadPool]: On list_datalake_analytics_stage: Close
[0m10:32:06.256188 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_datalake_analytics_stage, now list_datalake_analytics_source)
[0m10:32:06.260353 [debug] [ThreadPool]: Using trino connection "list_datalake_analytics_source"
[0m10:32:06.260353 [debug] [ThreadPool]: On list_datalake_analytics_source: /* {"app": "dbt", "dbt_version": "1.8.2", "profile_name": "my_dbt_trino_project", "target_name": "dev", "connection_name": "list_datalake_analytics_source"} */
select
      t.table_catalog as database,
      t.table_name as name,
      t.table_schema as schema,
      case when mv.name is not null then 'materialized_view'
           when t.table_type = 'BASE TABLE' then 'table'
           when t.table_type = 'VIEW' then 'view'
           else t.table_type
      end as table_type
    from "datalake".INFORMATION_SCHEMA.tables t
    left join (
            select * from system.metadata.materialized_views
            where catalog_name = 'datalake'
              and schema_name = 'analytics_source') mv
          on mv.catalog_name = t.table_catalog and mv.schema_name = t.table_schema and mv.name = t.table_name
    where t.table_schema = 'analytics_source'
[0m10:32:06.261355 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m10:32:06.318332 [debug] [ThreadPool]: SQL status: SUCCESS in 0.0 seconds
[0m10:32:06.319340 [debug] [ThreadPool]: On list_datalake_analytics_source: ROLLBACK
[0m10:32:06.319340 [debug] [ThreadPool]: On list_datalake_analytics_source: Close
[0m10:32:06.320339 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '06846fa7-a8fc-468b-8654-70d69101f297', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000002624D65A2D0>]}
[0m10:32:06.321338 [debug] [MainThread]: On master: COMMIT
[0m10:32:06.321338 [info ] [MainThread]: Concurrency: 1 threads (target='dev')
[0m10:32:06.321842 [info ] [MainThread]: 
[0m10:32:06.324127 [debug] [Thread-1 (]: Began running node model.my_dbt_trino_project.src_auth_events
[0m10:32:06.324127 [info ] [Thread-1 (]: 1 of 15 START sql table model analytics_source.src_auth_events ................. [RUN]
[0m10:32:06.325260 [debug] [Thread-1 (]: Acquiring new trino connection 'model.my_dbt_trino_project.src_auth_events'
[0m10:32:06.325260 [debug] [Thread-1 (]: Began compiling node model.my_dbt_trino_project.src_auth_events
[0m10:32:06.330260 [debug] [Thread-1 (]: Writing injected SQL for node "model.my_dbt_trino_project.src_auth_events"
[0m10:32:06.331261 [debug] [Thread-1 (]: Began executing node model.my_dbt_trino_project.src_auth_events
[0m10:32:06.360499 [debug] [Thread-1 (]: Writing runtime sql for node "model.my_dbt_trino_project.src_auth_events"
[0m10:32:06.363953 [debug] [Thread-1 (]: Using trino connection "model.my_dbt_trino_project.src_auth_events"
[0m10:32:06.365007 [debug] [Thread-1 (]: On model.my_dbt_trino_project.src_auth_events: /* {"app": "dbt", "dbt_version": "1.8.2", "profile_name": "my_dbt_trino_project", "target_name": "dev", "node_id": "model.my_dbt_trino_project.src_auth_events"} */

  
    

    create table "datalake"."analytics_source"."src_auth_events__dbt_tmp"
      
      
    as (
      

with source as (
    select
        CAST(ts AS VARCHAR) as id, 
        ts,
        CAST(sessionId AS VARCHAR) as sessionId,
        level,
        itemInSession,
        city,
        zip,
        state,
        userAgent,
        CAST(NULLIF(lon, '') AS double) as lon,
        CAST(NULLIF(lat, '') AS double) as lat,
        CAST(FLOOR(CAST(NULLIF(userId, '') AS DOUBLE)) AS INT) as userId, 
        lastName,
        firstName,
        gender,
        CAST(FLOOR(CAST(NULLIF(registration, '') AS DOUBLE)) AS BIGINT) as registration,
        success
    from "oltp"."public"."auth_events"
)

select
    id,
    ts,
    sessionId,
    level,
    itemInSession,
    city,
    zip,
    state,
    userAgent,
    lon,
    lat,
    userId,
    lastName,
    firstName,
    gender,
    registration, 
    CASE 
        WHEN CAST(success AS VARCHAR) = 't' THEN true 
        WHEN CAST(success AS VARCHAR) = 'f' THEN false
        ELSE NULL 
    END AS success_boolean
from source


    )
[0m10:32:06.365517 [debug] [Thread-1 (]: Opening a new connection, currently in state init
[0m10:32:06.618085 [debug] [Thread-1 (]: SQL status: SUCCESS in 0.0 seconds
[0m10:32:06.622591 [debug] [Thread-1 (]: Using trino connection "model.my_dbt_trino_project.src_auth_events"
[0m10:32:06.623597 [debug] [Thread-1 (]: On model.my_dbt_trino_project.src_auth_events: /* {"app": "dbt", "dbt_version": "1.8.2", "profile_name": "my_dbt_trino_project", "target_name": "dev", "node_id": "model.my_dbt_trino_project.src_auth_events"} */
alter table "datalake"."analytics_source"."src_auth_events" rename to "datalake"."analytics_source"."src_auth_events__dbt_backup"
[0m10:32:06.722249 [debug] [Thread-1 (]: SQL status: SUCCESS in 0.0 seconds
[0m10:32:06.725257 [debug] [Thread-1 (]: Using trino connection "model.my_dbt_trino_project.src_auth_events"
[0m10:32:06.726256 [debug] [Thread-1 (]: On model.my_dbt_trino_project.src_auth_events: /* {"app": "dbt", "dbt_version": "1.8.2", "profile_name": "my_dbt_trino_project", "target_name": "dev", "node_id": "model.my_dbt_trino_project.src_auth_events"} */
alter table "datalake"."analytics_source"."src_auth_events__dbt_tmp" rename to "datalake"."analytics_source"."src_auth_events"
[0m10:32:06.825494 [debug] [Thread-1 (]: SQL status: SUCCESS in 0.0 seconds
[0m10:32:06.883024 [debug] [Thread-1 (]: Applying DROP to: "datalake"."analytics_source"."src_auth_events__dbt_backup"
[0m10:32:06.885024 [debug] [Thread-1 (]: Using trino connection "model.my_dbt_trino_project.src_auth_events"
[0m10:32:06.885024 [debug] [Thread-1 (]: On model.my_dbt_trino_project.src_auth_events: /* {"app": "dbt", "dbt_version": "1.8.2", "profile_name": "my_dbt_trino_project", "target_name": "dev", "node_id": "model.my_dbt_trino_project.src_auth_events"} */

    drop table if exists "datalake"."analytics_source"."src_auth_events__dbt_backup"
[0m10:32:07.022396 [debug] [Thread-1 (]: SQL status: SUCCESS in 0.0 seconds
[0m10:32:07.036919 [debug] [Thread-1 (]: On model.my_dbt_trino_project.src_auth_events: ROLLBACK
[0m10:32:07.036919 [debug] [Thread-1 (]: On model.my_dbt_trino_project.src_auth_events: Close
[0m10:32:07.039312 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '06846fa7-a8fc-468b-8654-70d69101f297', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000002624A7E6410>]}
[0m10:32:07.039312 [info ] [Thread-1 (]: 1 of 15 OK created sql table model analytics_source.src_auth_events ............ [[32mSUCCESS[0m in 0.71s]
[0m10:32:07.040321 [debug] [Thread-1 (]: Finished running node model.my_dbt_trino_project.src_auth_events
[0m10:32:07.040321 [debug] [Thread-1 (]: Began running node model.my_dbt_trino_project.src_listen_events
[0m10:32:07.041325 [info ] [Thread-1 (]: 2 of 15 START sql incremental model analytics_source.src_listen_events ......... [RUN]
[0m10:32:07.042324 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.my_dbt_trino_project.src_auth_events, now model.my_dbt_trino_project.src_listen_events)
[0m10:32:07.042324 [debug] [Thread-1 (]: Began compiling node model.my_dbt_trino_project.src_listen_events
[0m10:32:07.046324 [debug] [Thread-1 (]: Writing injected SQL for node "model.my_dbt_trino_project.src_listen_events"
[0m10:32:07.047321 [debug] [Thread-1 (]: Began executing node model.my_dbt_trino_project.src_listen_events
[0m10:32:07.069869 [debug] [Thread-1 (]: Using trino connection "model.my_dbt_trino_project.src_listen_events"
[0m10:32:07.070870 [debug] [Thread-1 (]: On model.my_dbt_trino_project.src_listen_events: /* {"app": "dbt", "dbt_version": "1.8.2", "profile_name": "my_dbt_trino_project", "target_name": "dev", "node_id": "model.my_dbt_trino_project.src_listen_events"} */

  
    

    create table "datalake"."analytics_source"."src_listen_events__dbt_tmp"
      
      
    as (
      

with source as (

    select
        CAST(_id AS VARCHAR) as id,
        artist,
        song,
        CAST(NULLIF(duration, '') AS DOUBLE) as duration,
        ts,
        sessionid,
        auth,
        level,
        CAST(NULLIF(itemInSession, '') AS INTEGER) as itemInSession,
        city,
        zip,
        state,
        country,
        userAgent,
        CAST(NULLIF(lon, '') AS DOUBLE) as lon,
        CAST(NULLIF(lat, '') AS DOUBLE) as lat,
        CAST(CAST(NULLIF(userId, '') AS DOUBLE) AS INTEGER) as userId,
 -- Assurez-vous que userId peut aussi être converti de cette manière.
        lastName,
        firstName,
        gender,
        CAST(CAST(NULLIF(registration, '') AS DOUBLE) AS BIGINT) as registration
    from "website"."demo"."listen_events"

)

select * from source



    -- this filter will only be applied on an incremental run
    where ts > (select max(ts) from "datalake"."analytics_source"."src_listen_events")


    )
[0m10:32:07.070870 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m10:32:07.228147 [debug] [Thread-1 (]: SQL status: SUCCESS in 0.0 seconds
[0m10:32:07.236140 [debug] [Thread-1 (]: Using trino connection "model.my_dbt_trino_project.src_listen_events"
[0m10:32:07.236140 [debug] [Thread-1 (]: On model.my_dbt_trino_project.src_listen_events: /* {"app": "dbt", "dbt_version": "1.8.2", "profile_name": "my_dbt_trino_project", "target_name": "dev", "node_id": "model.my_dbt_trino_project.src_listen_events"} */

    describe "datalake"."analytics_source"."src_listen_events__dbt_tmp"
[0m10:32:07.337114 [debug] [Thread-1 (]: SQL status: SUCCESS in 0.0 seconds
[0m10:32:07.340295 [debug] [Thread-1 (]: Using trino connection "model.my_dbt_trino_project.src_listen_events"
[0m10:32:07.341295 [debug] [Thread-1 (]: On model.my_dbt_trino_project.src_listen_events: /* {"app": "dbt", "dbt_version": "1.8.2", "profile_name": "my_dbt_trino_project", "target_name": "dev", "node_id": "model.my_dbt_trino_project.src_listen_events"} */

    describe "datalake"."analytics_source"."src_listen_events"
[0m10:32:07.431634 [debug] [Thread-1 (]: SQL status: SUCCESS in 0.0 seconds
[0m10:32:07.438161 [debug] [Thread-1 (]: Using trino connection "model.my_dbt_trino_project.src_listen_events"
[0m10:32:07.438161 [debug] [Thread-1 (]: On model.my_dbt_trino_project.src_listen_events: /* {"app": "dbt", "dbt_version": "1.8.2", "profile_name": "my_dbt_trino_project", "target_name": "dev", "node_id": "model.my_dbt_trino_project.src_listen_events"} */

    describe "datalake"."analytics_source"."src_listen_events"
[0m10:32:07.522394 [debug] [Thread-1 (]: SQL status: SUCCESS in 0.0 seconds
[0m10:32:07.529903 [debug] [Thread-1 (]: Writing runtime sql for node "model.my_dbt_trino_project.src_listen_events"
[0m10:32:07.532408 [debug] [Thread-1 (]: Using trino connection "model.my_dbt_trino_project.src_listen_events"
[0m10:32:07.532408 [debug] [Thread-1 (]: On model.my_dbt_trino_project.src_listen_events: /* {"app": "dbt", "dbt_version": "1.8.2", "profile_name": "my_dbt_trino_project", "target_name": "dev", "node_id": "model.my_dbt_trino_project.src_listen_events"} */
insert into "datalake"."analytics_source"."src_listen_events" ("id", "artist", "song", "duration", "ts", "sessionid", "auth", "level", "iteminsession", "city", "zip", "state", "country", "useragent", "lon", "lat", "userid", "lastname", "firstname", "gender", "registration")
    (
        select "id", "artist", "song", "duration", "ts", "sessionid", "auth", "level", "iteminsession", "city", "zip", "state", "country", "useragent", "lon", "lat", "userid", "lastname", "firstname", "gender", "registration"
        from "datalake"."analytics_source"."src_listen_events__dbt_tmp"
    )
[0m10:32:07.638340 [debug] [Thread-1 (]: SQL status: SUCCESS in 0.0 seconds
[0m10:32:07.641849 [debug] [Thread-1 (]: Applying DROP to: "datalake"."analytics_source"."src_listen_events__dbt_tmp"
[0m10:32:07.642854 [debug] [Thread-1 (]: Using trino connection "model.my_dbt_trino_project.src_listen_events"
[0m10:32:07.642854 [debug] [Thread-1 (]: On model.my_dbt_trino_project.src_listen_events: /* {"app": "dbt", "dbt_version": "1.8.2", "profile_name": "my_dbt_trino_project", "target_name": "dev", "node_id": "model.my_dbt_trino_project.src_listen_events"} */

    drop table if exists "datalake"."analytics_source"."src_listen_events__dbt_tmp"
[0m10:32:07.737135 [debug] [Thread-1 (]: SQL status: SUCCESS in 0.0 seconds
[0m10:32:07.738135 [debug] [Thread-1 (]: On model.my_dbt_trino_project.src_listen_events: ROLLBACK
[0m10:32:07.739135 [debug] [Thread-1 (]: On model.my_dbt_trino_project.src_listen_events: Close
[0m10:32:07.739135 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '06846fa7-a8fc-468b-8654-70d69101f297', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000002624D34BB50>]}
[0m10:32:07.740136 [info ] [Thread-1 (]: 2 of 15 OK created sql incremental model analytics_source.src_listen_events .... [[32mSUCCESS[0m in 0.70s]
[0m10:32:07.741137 [debug] [Thread-1 (]: Finished running node model.my_dbt_trino_project.src_listen_events
[0m10:32:07.741137 [debug] [Thread-1 (]: Began running node model.my_dbt_trino_project.src_page_view_events
[0m10:32:07.742135 [info ] [Thread-1 (]: 3 of 15 START sql incremental model analytics_source.src_page_view_events ...... [RUN]
[0m10:32:07.742135 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.my_dbt_trino_project.src_listen_events, now model.my_dbt_trino_project.src_page_view_events)
[0m10:32:07.742135 [debug] [Thread-1 (]: Began compiling node model.my_dbt_trino_project.src_page_view_events
[0m10:32:07.747289 [debug] [Thread-1 (]: Writing injected SQL for node "model.my_dbt_trino_project.src_page_view_events"
[0m10:32:07.747289 [debug] [Thread-1 (]: Began executing node model.my_dbt_trino_project.src_page_view_events
[0m10:32:07.752801 [debug] [Thread-1 (]: Using trino connection "model.my_dbt_trino_project.src_page_view_events"
[0m10:32:07.753804 [debug] [Thread-1 (]: On model.my_dbt_trino_project.src_page_view_events: /* {"app": "dbt", "dbt_version": "1.8.2", "profile_name": "my_dbt_trino_project", "target_name": "dev", "node_id": "model.my_dbt_trino_project.src_page_view_events"} */

  
    

    create table "datalake"."analytics_source"."src_page_view_events__dbt_tmp"
      
      
    as (
      

with source as (
    select
        CAST(_id AS VARCHAR) as id,
        ts,
        CAST(sessionId AS VARCHAR) as sessionId,
        page,
        auth,
        level,
        CAST(CAST(NULLIF(itemInSession, '') AS DOUBLE) AS INTEGER) as itemInSession, 
        city,
        zip,
        state,
        userAgent,
        CAST(NULLIF(lon, '') AS double) as lon,
        CAST(NULLIF(lat, '') AS double) as lat,
        CAST(CAST(NULLIF(userId, '') AS DOUBLE) AS INTEGER) as userId, 
        lastName,
        firstName,
        gender,
        CAST(CAST(NULLIF(registration, '') AS DOUBLE) AS BIGINT) as registration, 
        artist,
        song,
        CAST(NULLIF(duration, '') AS double) as duration
    from "website"."demo"."page_view_events"
)

select * from source


    where ts > (select max(ts) from "datalake"."analytics_source"."src_page_view_events")

    )
[0m10:32:07.753804 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m10:32:07.897359 [debug] [Thread-1 (]: SQL status: SUCCESS in 0.0 seconds
[0m10:32:07.899356 [debug] [Thread-1 (]: Using trino connection "model.my_dbt_trino_project.src_page_view_events"
[0m10:32:07.900356 [debug] [Thread-1 (]: On model.my_dbt_trino_project.src_page_view_events: /* {"app": "dbt", "dbt_version": "1.8.2", "profile_name": "my_dbt_trino_project", "target_name": "dev", "node_id": "model.my_dbt_trino_project.src_page_view_events"} */

    describe "datalake"."analytics_source"."src_page_view_events__dbt_tmp"
[0m10:32:07.981095 [debug] [Thread-1 (]: SQL status: SUCCESS in 0.0 seconds
[0m10:32:07.984112 [debug] [Thread-1 (]: Using trino connection "model.my_dbt_trino_project.src_page_view_events"
[0m10:32:07.985121 [debug] [Thread-1 (]: On model.my_dbt_trino_project.src_page_view_events: /* {"app": "dbt", "dbt_version": "1.8.2", "profile_name": "my_dbt_trino_project", "target_name": "dev", "node_id": "model.my_dbt_trino_project.src_page_view_events"} */

    describe "datalake"."analytics_source"."src_page_view_events"
[0m10:32:08.069582 [debug] [Thread-1 (]: SQL status: SUCCESS in 0.0 seconds
[0m10:32:08.072517 [debug] [Thread-1 (]: Using trino connection "model.my_dbt_trino_project.src_page_view_events"
[0m10:32:08.072517 [debug] [Thread-1 (]: On model.my_dbt_trino_project.src_page_view_events: /* {"app": "dbt", "dbt_version": "1.8.2", "profile_name": "my_dbt_trino_project", "target_name": "dev", "node_id": "model.my_dbt_trino_project.src_page_view_events"} */

    describe "datalake"."analytics_source"."src_page_view_events"
[0m10:32:08.150150 [debug] [Thread-1 (]: SQL status: SUCCESS in 0.0 seconds
[0m10:32:08.152158 [debug] [Thread-1 (]: Writing runtime sql for node "model.my_dbt_trino_project.src_page_view_events"
[0m10:32:08.154453 [debug] [Thread-1 (]: Using trino connection "model.my_dbt_trino_project.src_page_view_events"
[0m10:32:08.154453 [debug] [Thread-1 (]: On model.my_dbt_trino_project.src_page_view_events: /* {"app": "dbt", "dbt_version": "1.8.2", "profile_name": "my_dbt_trino_project", "target_name": "dev", "node_id": "model.my_dbt_trino_project.src_page_view_events"} */
insert into "datalake"."analytics_source"."src_page_view_events" ("id", "ts", "sessionid", "page", "auth", "level", "iteminsession", "city", "zip", "state", "useragent", "lon", "lat", "userid", "lastname", "firstname", "gender", "registration", "artist", "song", "duration")
    (
        select "id", "ts", "sessionid", "page", "auth", "level", "iteminsession", "city", "zip", "state", "useragent", "lon", "lat", "userid", "lastname", "firstname", "gender", "registration", "artist", "song", "duration"
        from "datalake"."analytics_source"."src_page_view_events__dbt_tmp"
    )
[0m10:32:08.267704 [debug] [Thread-1 (]: SQL status: SUCCESS in 0.0 seconds
[0m10:32:08.271099 [debug] [Thread-1 (]: Applying DROP to: "datalake"."analytics_source"."src_page_view_events__dbt_tmp"
[0m10:32:08.272519 [debug] [Thread-1 (]: Using trino connection "model.my_dbt_trino_project.src_page_view_events"
[0m10:32:08.272519 [debug] [Thread-1 (]: On model.my_dbt_trino_project.src_page_view_events: /* {"app": "dbt", "dbt_version": "1.8.2", "profile_name": "my_dbt_trino_project", "target_name": "dev", "node_id": "model.my_dbt_trino_project.src_page_view_events"} */

    drop table if exists "datalake"."analytics_source"."src_page_view_events__dbt_tmp"
[0m10:32:08.373630 [debug] [Thread-1 (]: SQL status: SUCCESS in 0.0 seconds
[0m10:32:08.375207 [debug] [Thread-1 (]: On model.my_dbt_trino_project.src_page_view_events: ROLLBACK
[0m10:32:08.375207 [debug] [Thread-1 (]: On model.my_dbt_trino_project.src_page_view_events: Close
[0m10:32:08.375739 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '06846fa7-a8fc-468b-8654-70d69101f297', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000002624D177F50>]}
[0m10:32:08.376745 [info ] [Thread-1 (]: 3 of 15 OK created sql incremental model analytics_source.src_page_view_events . [[32mSUCCESS[0m in 0.63s]
[0m10:32:08.376745 [debug] [Thread-1 (]: Finished running node model.my_dbt_trino_project.src_page_view_events
[0m10:32:08.377796 [debug] [Thread-1 (]: Began running node model.my_dbt_trino_project.stg_user_level_by_gender
[0m10:32:08.378301 [info ] [Thread-1 (]: 4 of 15 START sql view model analytics_stage.stg_user_level_by_gender .......... [RUN]
[0m10:32:08.379353 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.my_dbt_trino_project.src_page_view_events, now model.my_dbt_trino_project.stg_user_level_by_gender)
[0m10:32:08.379353 [debug] [Thread-1 (]: Began compiling node model.my_dbt_trino_project.stg_user_level_by_gender
[0m10:32:08.381991 [debug] [Thread-1 (]: Writing injected SQL for node "model.my_dbt_trino_project.stg_user_level_by_gender"
[0m10:32:08.383065 [debug] [Thread-1 (]: Began executing node model.my_dbt_trino_project.stg_user_level_by_gender
[0m10:32:08.396994 [debug] [Thread-1 (]: Writing runtime sql for node "model.my_dbt_trino_project.stg_user_level_by_gender"
[0m10:32:08.400034 [debug] [Thread-1 (]: Using trino connection "model.my_dbt_trino_project.stg_user_level_by_gender"
[0m10:32:08.400999 [debug] [Thread-1 (]: On model.my_dbt_trino_project.stg_user_level_by_gender: /* {"app": "dbt", "dbt_version": "1.8.2", "profile_name": "my_dbt_trino_project", "target_name": "dev", "node_id": "model.my_dbt_trino_project.stg_user_level_by_gender"} */

  create or replace view
    "datalake"."analytics_stage"."stg_user_level_by_gender"
  security definer
  as
    

WITH user_subscriptions AS (
    SELECT
        gender,
        level, 
        COUNT(DISTINCT userId) AS user_count
    FROM "datalake"."analytics_source"."src_auth_events"
    WHERE gender IS NOT NULL AND level IS NOT NULL
    GROUP BY gender, level
)

SELECT
    gender,
    level,
    user_count
FROM user_subscriptions
  
[0m10:32:08.400999 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m10:32:08.465559 [debug] [Thread-1 (]: SQL status: SUCCESS in 0.0 seconds
[0m10:32:08.467584 [debug] [Thread-1 (]: On model.my_dbt_trino_project.stg_user_level_by_gender: ROLLBACK
[0m10:32:08.468582 [debug] [Thread-1 (]: On model.my_dbt_trino_project.stg_user_level_by_gender: Close
[0m10:32:08.468582 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '06846fa7-a8fc-468b-8654-70d69101f297', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000002624EC31B10>]}
[0m10:32:08.470043 [info ] [Thread-1 (]: 4 of 15 OK created sql view model analytics_stage.stg_user_level_by_gender ..... [[32mSUCCESS[0m in 0.09s]
[0m10:32:08.471051 [debug] [Thread-1 (]: Finished running node model.my_dbt_trino_project.stg_user_level_by_gender
[0m10:32:08.471051 [debug] [Thread-1 (]: Began running node model.my_dbt_trino_project.stg_streams_hourly
[0m10:32:08.472051 [info ] [Thread-1 (]: 5 of 15 START sql table model analytics_stage.stg_streams_hourly ............... [RUN]
[0m10:32:08.473084 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.my_dbt_trino_project.stg_user_level_by_gender, now model.my_dbt_trino_project.stg_streams_hourly)
[0m10:32:08.473084 [debug] [Thread-1 (]: Began compiling node model.my_dbt_trino_project.stg_streams_hourly
[0m10:32:08.476502 [debug] [Thread-1 (]: Writing injected SQL for node "model.my_dbt_trino_project.stg_streams_hourly"
[0m10:32:08.476502 [debug] [Thread-1 (]: Began executing node model.my_dbt_trino_project.stg_streams_hourly
[0m10:32:08.479511 [debug] [Thread-1 (]: Writing runtime sql for node "model.my_dbt_trino_project.stg_streams_hourly"
[0m10:32:08.481537 [debug] [Thread-1 (]: Using trino connection "model.my_dbt_trino_project.stg_streams_hourly"
[0m10:32:08.481537 [debug] [Thread-1 (]: On model.my_dbt_trino_project.stg_streams_hourly: /* {"app": "dbt", "dbt_version": "1.8.2", "profile_name": "my_dbt_trino_project", "target_name": "dev", "node_id": "model.my_dbt_trino_project.stg_streams_hourly"} */

  
    

    create table "datalake"."analytics_stage"."stg_streams_hourly__dbt_tmp"
      
      
    as (
      

SELECT
    DATE_FORMAT(FROM_UNIXTIME(ts), '%Y-%m-%d') AS stream_date, 
    DATE_FORMAT(FROM_UNIXTIME(ts), '%H') AS stream_hour,
    COUNT(*) AS total_streams
FROM "datalake"."analytics_source"."src_listen_events"
GROUP BY
    DATE_FORMAT(FROM_UNIXTIME(ts), '%Y-%m-%d'),
    DATE_FORMAT(FROM_UNIXTIME(ts), '%H')
    )
[0m10:32:08.481537 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m10:32:08.712560 [debug] [Thread-1 (]: SQL status: SUCCESS in 0.0 seconds
[0m10:32:08.715565 [debug] [Thread-1 (]: Using trino connection "model.my_dbt_trino_project.stg_streams_hourly"
[0m10:32:08.715565 [debug] [Thread-1 (]: On model.my_dbt_trino_project.stg_streams_hourly: /* {"app": "dbt", "dbt_version": "1.8.2", "profile_name": "my_dbt_trino_project", "target_name": "dev", "node_id": "model.my_dbt_trino_project.stg_streams_hourly"} */
alter table "datalake"."analytics_stage"."stg_streams_hourly" rename to "datalake"."analytics_stage"."stg_streams_hourly__dbt_backup"
[0m10:32:08.811072 [debug] [Thread-1 (]: SQL status: SUCCESS in 0.0 seconds
[0m10:32:08.815673 [debug] [Thread-1 (]: Using trino connection "model.my_dbt_trino_project.stg_streams_hourly"
[0m10:32:08.816682 [debug] [Thread-1 (]: On model.my_dbt_trino_project.stg_streams_hourly: /* {"app": "dbt", "dbt_version": "1.8.2", "profile_name": "my_dbt_trino_project", "target_name": "dev", "node_id": "model.my_dbt_trino_project.stg_streams_hourly"} */
alter table "datalake"."analytics_stage"."stg_streams_hourly__dbt_tmp" rename to "datalake"."analytics_stage"."stg_streams_hourly"
[0m10:32:08.909429 [debug] [Thread-1 (]: SQL status: SUCCESS in 0.0 seconds
[0m10:32:08.912442 [debug] [Thread-1 (]: Applying DROP to: "datalake"."analytics_stage"."stg_streams_hourly__dbt_backup"
[0m10:32:08.913431 [debug] [Thread-1 (]: Using trino connection "model.my_dbt_trino_project.stg_streams_hourly"
[0m10:32:08.913431 [debug] [Thread-1 (]: On model.my_dbt_trino_project.stg_streams_hourly: /* {"app": "dbt", "dbt_version": "1.8.2", "profile_name": "my_dbt_trino_project", "target_name": "dev", "node_id": "model.my_dbt_trino_project.stg_streams_hourly"} */

    drop table if exists "datalake"."analytics_stage"."stg_streams_hourly__dbt_backup"
[0m10:32:09.023317 [debug] [Thread-1 (]: SQL status: SUCCESS in 0.0 seconds
[0m10:32:09.025323 [debug] [Thread-1 (]: On model.my_dbt_trino_project.stg_streams_hourly: ROLLBACK
[0m10:32:09.025323 [debug] [Thread-1 (]: On model.my_dbt_trino_project.stg_streams_hourly: Close
[0m10:32:09.026323 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '06846fa7-a8fc-468b-8654-70d69101f297', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000002624EC33ED0>]}
[0m10:32:09.026323 [info ] [Thread-1 (]: 5 of 15 OK created sql table model analytics_stage.stg_streams_hourly .......... [[32mSUCCESS[0m in 0.55s]
[0m10:32:09.027324 [debug] [Thread-1 (]: Finished running node model.my_dbt_trino_project.stg_streams_hourly
[0m10:32:09.028323 [debug] [Thread-1 (]: Began running node model.my_dbt_trino_project.stg_top_songs_artists
[0m10:32:09.028323 [info ] [Thread-1 (]: 6 of 15 START sql view model analytics_stage.stg_top_songs_artists ............. [RUN]
[0m10:32:09.029322 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.my_dbt_trino_project.stg_streams_hourly, now model.my_dbt_trino_project.stg_top_songs_artists)
[0m10:32:09.029322 [debug] [Thread-1 (]: Began compiling node model.my_dbt_trino_project.stg_top_songs_artists
[0m10:32:09.032325 [debug] [Thread-1 (]: Writing injected SQL for node "model.my_dbt_trino_project.stg_top_songs_artists"
[0m10:32:09.033326 [debug] [Thread-1 (]: Began executing node model.my_dbt_trino_project.stg_top_songs_artists
[0m10:32:09.035324 [debug] [Thread-1 (]: Writing runtime sql for node "model.my_dbt_trino_project.stg_top_songs_artists"
[0m10:32:09.036323 [debug] [Thread-1 (]: Using trino connection "model.my_dbt_trino_project.stg_top_songs_artists"
[0m10:32:09.037321 [debug] [Thread-1 (]: On model.my_dbt_trino_project.stg_top_songs_artists: /* {"app": "dbt", "dbt_version": "1.8.2", "profile_name": "my_dbt_trino_project", "target_name": "dev", "node_id": "model.my_dbt_trino_project.stg_top_songs_artists"} */

  create or replace view
    "datalake"."analytics_stage"."stg_top_songs_artists"
  security definer
  as
    

WITH song_plays AS (
    SELECT
        artist,
        song,
        COUNT(*) AS play_count
    FROM "datalake"."analytics_source"."src_listen_events"
    GROUP BY artist, song
)

SELECT
    artist,
    song,
    play_count
FROM song_plays
ORDER BY play_count DESC
  
[0m10:32:09.037321 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m10:32:09.085374 [debug] [Thread-1 (]: SQL status: SUCCESS in 0.0 seconds
[0m10:32:09.087632 [debug] [Thread-1 (]: On model.my_dbt_trino_project.stg_top_songs_artists: ROLLBACK
[0m10:32:09.087632 [debug] [Thread-1 (]: On model.my_dbt_trino_project.stg_top_songs_artists: Close
[0m10:32:09.088454 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '06846fa7-a8fc-468b-8654-70d69101f297', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000002624EC33090>]}
[0m10:32:09.088960 [info ] [Thread-1 (]: 6 of 15 OK created sql view model analytics_stage.stg_top_songs_artists ........ [[32mSUCCESS[0m in 0.06s]
[0m10:32:09.090018 [debug] [Thread-1 (]: Finished running node model.my_dbt_trino_project.stg_top_songs_artists
[0m10:32:09.090531 [debug] [Thread-1 (]: Began running node model.my_dbt_trino_project.stg_unique_users
[0m10:32:09.091062 [info ] [Thread-1 (]: 7 of 15 START sql view model analytics_stage.stg_unique_users .................. [RUN]
[0m10:32:09.091596 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.my_dbt_trino_project.stg_top_songs_artists, now model.my_dbt_trino_project.stg_unique_users)
[0m10:32:09.091596 [debug] [Thread-1 (]: Began compiling node model.my_dbt_trino_project.stg_unique_users
[0m10:32:09.095851 [debug] [Thread-1 (]: Writing injected SQL for node "model.my_dbt_trino_project.stg_unique_users"
[0m10:32:09.096382 [debug] [Thread-1 (]: Began executing node model.my_dbt_trino_project.stg_unique_users
[0m10:32:09.098685 [debug] [Thread-1 (]: Writing runtime sql for node "model.my_dbt_trino_project.stg_unique_users"
[0m10:32:09.099737 [debug] [Thread-1 (]: Using trino connection "model.my_dbt_trino_project.stg_unique_users"
[0m10:32:09.100270 [debug] [Thread-1 (]: On model.my_dbt_trino_project.stg_unique_users: /* {"app": "dbt", "dbt_version": "1.8.2", "profile_name": "my_dbt_trino_project", "target_name": "dev", "node_id": "model.my_dbt_trino_project.stg_unique_users"} */

  create or replace view
    "datalake"."analytics_stage"."stg_unique_users"
  security definer
  as
    

SELECT
    COUNT(DISTINCT userid) AS total_unique_users
FROM "datalake"."analytics_source"."src_listen_events"
WHERE userid IS NOT NULL
  
[0m10:32:09.100270 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m10:32:09.150059 [debug] [Thread-1 (]: SQL status: SUCCESS in 0.0 seconds
[0m10:32:09.151586 [debug] [Thread-1 (]: On model.my_dbt_trino_project.stg_unique_users: ROLLBACK
[0m10:32:09.151586 [debug] [Thread-1 (]: On model.my_dbt_trino_project.stg_unique_users: Close
[0m10:32:09.152584 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '06846fa7-a8fc-468b-8654-70d69101f297', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000002624D3A2410>]}
[0m10:32:09.154021 [info ] [Thread-1 (]: 7 of 15 OK created sql view model analytics_stage.stg_unique_users ............. [[32mSUCCESS[0m in 0.06s]
[0m10:32:09.155094 [debug] [Thread-1 (]: Finished running node model.my_dbt_trino_project.stg_unique_users
[0m10:32:09.155621 [debug] [Thread-1 (]: Began running node model.my_dbt_trino_project.stg_user_activity_per_country
[0m10:32:09.156135 [info ] [Thread-1 (]: 8 of 15 START sql view model analytics_stage.stg_user_activity_per_country ..... [RUN]
[0m10:32:09.156687 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.my_dbt_trino_project.stg_unique_users, now model.my_dbt_trino_project.stg_user_activity_per_country)
[0m10:32:09.157216 [debug] [Thread-1 (]: Began compiling node model.my_dbt_trino_project.stg_user_activity_per_country
[0m10:32:09.160335 [debug] [Thread-1 (]: Writing injected SQL for node "model.my_dbt_trino_project.stg_user_activity_per_country"
[0m10:32:09.160852 [debug] [Thread-1 (]: Began executing node model.my_dbt_trino_project.stg_user_activity_per_country
[0m10:32:09.163439 [debug] [Thread-1 (]: Writing runtime sql for node "model.my_dbt_trino_project.stg_user_activity_per_country"
[0m10:32:09.164991 [debug] [Thread-1 (]: Using trino connection "model.my_dbt_trino_project.stg_user_activity_per_country"
[0m10:32:09.165998 [debug] [Thread-1 (]: On model.my_dbt_trino_project.stg_user_activity_per_country: /* {"app": "dbt", "dbt_version": "1.8.2", "profile_name": "my_dbt_trino_project", "target_name": "dev", "node_id": "model.my_dbt_trino_project.stg_user_activity_per_country"} */

  create or replace view
    "datalake"."analytics_stage"."stg_user_activity_per_country"
  security definer
  as
    

WITH combined_activities AS (
  SELECT
    country,
    'listen_event' AS event_type,
    ts,
    userid
  FROM "datalake"."analytics_source"."src_listen_events"
  WHERE country IS NOT NULL
  UNION ALL
  SELECT
    'Unknown' AS country,
    'auth_event' AS event_type 
    ts,
    userid
  FROM "datalake"."analytics_source"."src_auth_events"
  UNION ALL
  SELECT
    'Unknown' AS country, 
    'page_view_event' AS event_type,
    ts,
    userid
  FROM "datalake"."analytics_source"."src_page_view_events"
)

SELECT
  country,
  COUNT(*) AS activity_count
FROM combined_activities
GROUP BY country
  
[0m10:32:09.165998 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m10:32:09.198903 [debug] [Thread-1 (]: Trino adapter: Trino query id: 20240619_023209_00364_uxt54
[0m10:32:09.199915 [debug] [Thread-1 (]: Trino adapter: Trino error: TrinoUserError(type=USER_ERROR, name=SYNTAX_ERROR, message="line 21:5: mismatched input 'ts'. Expecting: ')', ',', 'EXCEPT', 'FETCH', 'FROM', 'GROUP', 'HAVING', 'INTERSECT', 'LIMIT', 'OFFSET', 'ORDER', 'UNION', 'WHERE', 'WINDOW'", query_id=20240619_023209_00364_uxt54)
[0m10:32:09.199915 [debug] [Thread-1 (]: On model.my_dbt_trino_project.stg_user_activity_per_country: ROLLBACK
[0m10:32:09.200912 [debug] [Thread-1 (]: On model.my_dbt_trino_project.stg_user_activity_per_country: Close
[0m10:32:09.205426 [debug] [Thread-1 (]: Database Error in model stg_user_activity_per_country (models\stage\stg_user_activity_per_country.sql)
  TrinoUserError(type=USER_ERROR, name=SYNTAX_ERROR, message="line 21:5: mismatched input 'ts'. Expecting: ')', ',', 'EXCEPT', 'FETCH', 'FROM', 'GROUP', 'HAVING', 'INTERSECT', 'LIMIT', 'OFFSET', 'ORDER', 'UNION', 'WHERE', 'WINDOW'", query_id=20240619_023209_00364_uxt54)
  compiled Code at target\run\my_dbt_trino_project\models\stage\stg_user_activity_per_country.sql
[0m10:32:09.206434 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '06846fa7-a8fc-468b-8654-70d69101f297', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000002624E976850>]}
[0m10:32:09.207435 [error] [Thread-1 (]: 8 of 15 ERROR creating sql view model analytics_stage.stg_user_activity_per_country  [[31mERROR[0m in 0.05s]
[0m10:32:09.208436 [debug] [Thread-1 (]: Finished running node model.my_dbt_trino_project.stg_user_activity_per_country
[0m10:32:09.208436 [debug] [Thread-1 (]: Began running node model.my_dbt_trino_project.stg_user_activity_per_location
[0m10:32:09.209435 [info ] [Thread-1 (]: 9 of 15 START sql view model analytics_stage.stg_user_activity_per_location .... [RUN]
[0m10:32:09.209435 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.my_dbt_trino_project.stg_user_activity_per_country, now model.my_dbt_trino_project.stg_user_activity_per_location)
[0m10:32:09.210435 [debug] [Thread-1 (]: Began compiling node model.my_dbt_trino_project.stg_user_activity_per_location
[0m10:32:09.213437 [debug] [Thread-1 (]: Writing injected SQL for node "model.my_dbt_trino_project.stg_user_activity_per_location"
[0m10:32:09.213437 [debug] [Thread-1 (]: Began executing node model.my_dbt_trino_project.stg_user_activity_per_location
[0m10:32:09.215732 [debug] [Thread-1 (]: Writing runtime sql for node "model.my_dbt_trino_project.stg_user_activity_per_location"
[0m10:32:09.218729 [debug] [Thread-1 (]: Using trino connection "model.my_dbt_trino_project.stg_user_activity_per_location"
[0m10:32:09.218781 [debug] [Thread-1 (]: On model.my_dbt_trino_project.stg_user_activity_per_location: /* {"app": "dbt", "dbt_version": "1.8.2", "profile_name": "my_dbt_trino_project", "target_name": "dev", "node_id": "model.my_dbt_trino_project.stg_user_activity_per_location"} */

  create or replace view
    "datalake"."analytics_stage"."stg_user_activity_per_location"
  security definer
  as
    

WITH combined_activities AS (
  SELECT
    city,
    state,
    'auth_event' AS event_type,
    ts,
    userid
 FROM "datalake"."analytics_source"."src_auth_events"
  UNION ALL
  SELECT
    city,
    state,
    'listen_event' AS event_type,
    ts,
    userid
  FROM "datalake"."analytics_source"."src_listen_events"
  UNION ALL
  SELECT
    city,
    state,
    'page_view_event' AS event_type,
    ts,
    userid
  FROM "datalake"."analytics_source"."src_page_view_events"
)

SELECT
  state,
  city,
  COUNT(*) AS activity_count
FROM combined_activities
GROUP BY state, city
  
[0m10:32:09.219289 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m10:32:09.295545 [debug] [Thread-1 (]: SQL status: SUCCESS in 0.0 seconds
[0m10:32:09.297574 [debug] [Thread-1 (]: On model.my_dbt_trino_project.stg_user_activity_per_location: ROLLBACK
[0m10:32:09.298575 [debug] [Thread-1 (]: On model.my_dbt_trino_project.stg_user_activity_per_location: Close
[0m10:32:09.298575 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '06846fa7-a8fc-468b-8654-70d69101f297', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000002624D7D13D0>]}
[0m10:32:09.299576 [info ] [Thread-1 (]: 9 of 15 OK created sql view model analytics_stage.stg_user_activity_per_location  [[32mSUCCESS[0m in 0.09s]
[0m10:32:09.299576 [debug] [Thread-1 (]: Finished running node model.my_dbt_trino_project.stg_user_activity_per_location
[0m10:32:09.299576 [debug] [Thread-1 (]: Began running node model.my_dbt_trino_project.mart_user_level_by_gender
[0m10:32:09.301090 [info ] [Thread-1 (]: 10 of 15 START sql table model analytics.mart_user_level_by_gender ............. [RUN]
[0m10:32:09.302100 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.my_dbt_trino_project.stg_user_activity_per_location, now model.my_dbt_trino_project.mart_user_level_by_gender)
[0m10:32:09.302100 [debug] [Thread-1 (]: Began compiling node model.my_dbt_trino_project.mart_user_level_by_gender
[0m10:32:09.305100 [debug] [Thread-1 (]: Writing injected SQL for node "model.my_dbt_trino_project.mart_user_level_by_gender"
[0m10:32:09.305100 [debug] [Thread-1 (]: Began executing node model.my_dbt_trino_project.mart_user_level_by_gender
[0m10:32:09.308106 [debug] [Thread-1 (]: Writing runtime sql for node "model.my_dbt_trino_project.mart_user_level_by_gender"
[0m10:32:09.310104 [debug] [Thread-1 (]: Using trino connection "model.my_dbt_trino_project.mart_user_level_by_gender"
[0m10:32:09.311107 [debug] [Thread-1 (]: On model.my_dbt_trino_project.mart_user_level_by_gender: /* {"app": "dbt", "dbt_version": "1.8.2", "profile_name": "my_dbt_trino_project", "target_name": "dev", "node_id": "model.my_dbt_trino_project.mart_user_level_by_gender"} */

  
    

    create table "datalake"."analytics"."mart_user_level_by_gender__dbt_tmp"
      
      
    as (
      

SELECT
    gender,
    level,
    SUM(user_count) AS total_users,
    ROUND(SUM(user_count) * 100.0 / SUM(SUM(user_count)) OVER (), 2) AS percentage_of_total_users
FROM "datalake"."analytics_stage"."stg_user_level_by_gender"
GROUP BY gender, level
    )
[0m10:32:09.311650 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m10:32:09.539991 [debug] [Thread-1 (]: SQL status: SUCCESS in 0.0 seconds
[0m10:32:09.542997 [debug] [Thread-1 (]: Using trino connection "model.my_dbt_trino_project.mart_user_level_by_gender"
[0m10:32:09.542997 [debug] [Thread-1 (]: On model.my_dbt_trino_project.mart_user_level_by_gender: /* {"app": "dbt", "dbt_version": "1.8.2", "profile_name": "my_dbt_trino_project", "target_name": "dev", "node_id": "model.my_dbt_trino_project.mart_user_level_by_gender"} */
alter table "datalake"."analytics"."mart_user_level_by_gender" rename to "datalake"."analytics"."mart_user_level_by_gender__dbt_backup"
[0m10:32:09.621887 [debug] [Thread-1 (]: SQL status: SUCCESS in 0.0 seconds
[0m10:32:09.626445 [debug] [Thread-1 (]: Using trino connection "model.my_dbt_trino_project.mart_user_level_by_gender"
[0m10:32:09.626445 [debug] [Thread-1 (]: On model.my_dbt_trino_project.mart_user_level_by_gender: /* {"app": "dbt", "dbt_version": "1.8.2", "profile_name": "my_dbt_trino_project", "target_name": "dev", "node_id": "model.my_dbt_trino_project.mart_user_level_by_gender"} */
alter table "datalake"."analytics"."mart_user_level_by_gender__dbt_tmp" rename to "datalake"."analytics"."mart_user_level_by_gender"
[0m10:32:09.720787 [debug] [Thread-1 (]: SQL status: SUCCESS in 0.0 seconds
[0m10:32:09.724306 [debug] [Thread-1 (]: Applying DROP to: "datalake"."analytics"."mart_user_level_by_gender__dbt_backup"
[0m10:32:09.724306 [debug] [Thread-1 (]: Using trino connection "model.my_dbt_trino_project.mart_user_level_by_gender"
[0m10:32:09.725306 [debug] [Thread-1 (]: On model.my_dbt_trino_project.mart_user_level_by_gender: /* {"app": "dbt", "dbt_version": "1.8.2", "profile_name": "my_dbt_trino_project", "target_name": "dev", "node_id": "model.my_dbt_trino_project.mart_user_level_by_gender"} */

    drop table if exists "datalake"."analytics"."mart_user_level_by_gender__dbt_backup"
[0m10:32:09.844254 [debug] [Thread-1 (]: SQL status: SUCCESS in 0.0 seconds
[0m10:32:09.845261 [debug] [Thread-1 (]: On model.my_dbt_trino_project.mart_user_level_by_gender: ROLLBACK
[0m10:32:09.846261 [debug] [Thread-1 (]: On model.my_dbt_trino_project.mart_user_level_by_gender: Close
[0m10:32:09.846261 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '06846fa7-a8fc-468b-8654-70d69101f297', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000002624F0A68D0>]}
[0m10:32:09.847260 [info ] [Thread-1 (]: 10 of 15 OK created sql table model analytics.mart_user_level_by_gender ........ [[32mSUCCESS[0m in 0.54s]
[0m10:32:09.848498 [debug] [Thread-1 (]: Finished running node model.my_dbt_trino_project.mart_user_level_by_gender
[0m10:32:09.848498 [debug] [Thread-1 (]: Began running node model.my_dbt_trino_project.mart_hourly_stream_evolution
[0m10:32:09.848498 [info ] [Thread-1 (]: 11 of 15 START sql table model analytics.mart_hourly_stream_evolution .......... [RUN]
[0m10:32:09.849850 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.my_dbt_trino_project.mart_user_level_by_gender, now model.my_dbt_trino_project.mart_hourly_stream_evolution)
[0m10:32:09.849850 [debug] [Thread-1 (]: Began compiling node model.my_dbt_trino_project.mart_hourly_stream_evolution
[0m10:32:09.851978 [debug] [Thread-1 (]: Writing injected SQL for node "model.my_dbt_trino_project.mart_hourly_stream_evolution"
[0m10:32:09.851978 [debug] [Thread-1 (]: Began executing node model.my_dbt_trino_project.mart_hourly_stream_evolution
[0m10:32:09.855350 [debug] [Thread-1 (]: Writing runtime sql for node "model.my_dbt_trino_project.mart_hourly_stream_evolution"
[0m10:32:09.856621 [debug] [Thread-1 (]: Using trino connection "model.my_dbt_trino_project.mart_hourly_stream_evolution"
[0m10:32:09.857630 [debug] [Thread-1 (]: On model.my_dbt_trino_project.mart_hourly_stream_evolution: /* {"app": "dbt", "dbt_version": "1.8.2", "profile_name": "my_dbt_trino_project", "target_name": "dev", "node_id": "model.my_dbt_trino_project.mart_hourly_stream_evolution"} */

  
    

    create table "datalake"."analytics"."mart_hourly_stream_evolution__dbt_tmp"
      
      
    as (
      

SELECT
    stream_date,
    stream_hour,
    total_streams,
    SUM(total_streams) OVER (PARTITION BY stream_date ORDER BY stream_hour) AS cumulative_streams
FROM "datalake"."analytics_stage"."stg_streams_hourly"
ORDER BY
    stream_date,
    stream_hour
    )
[0m10:32:09.857630 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m10:32:10.074566 [debug] [Thread-1 (]: SQL status: SUCCESS in 0.0 seconds
[0m10:32:10.076642 [debug] [Thread-1 (]: Using trino connection "model.my_dbt_trino_project.mart_hourly_stream_evolution"
[0m10:32:10.077991 [debug] [Thread-1 (]: On model.my_dbt_trino_project.mart_hourly_stream_evolution: /* {"app": "dbt", "dbt_version": "1.8.2", "profile_name": "my_dbt_trino_project", "target_name": "dev", "node_id": "model.my_dbt_trino_project.mart_hourly_stream_evolution"} */
alter table "datalake"."analytics"."mart_hourly_stream_evolution" rename to "datalake"."analytics"."mart_hourly_stream_evolution__dbt_backup"
[0m10:32:10.175307 [debug] [Thread-1 (]: SQL status: SUCCESS in 0.0 seconds
[0m10:32:10.178313 [debug] [Thread-1 (]: Using trino connection "model.my_dbt_trino_project.mart_hourly_stream_evolution"
[0m10:32:10.178313 [debug] [Thread-1 (]: On model.my_dbt_trino_project.mart_hourly_stream_evolution: /* {"app": "dbt", "dbt_version": "1.8.2", "profile_name": "my_dbt_trino_project", "target_name": "dev", "node_id": "model.my_dbt_trino_project.mart_hourly_stream_evolution"} */
alter table "datalake"."analytics"."mart_hourly_stream_evolution__dbt_tmp" rename to "datalake"."analytics"."mart_hourly_stream_evolution"
[0m10:32:10.276197 [debug] [Thread-1 (]: SQL status: SUCCESS in 0.0 seconds
[0m10:32:10.278967 [debug] [Thread-1 (]: Applying DROP to: "datalake"."analytics"."mart_hourly_stream_evolution__dbt_backup"
[0m10:32:10.279982 [debug] [Thread-1 (]: Using trino connection "model.my_dbt_trino_project.mart_hourly_stream_evolution"
[0m10:32:10.279982 [debug] [Thread-1 (]: On model.my_dbt_trino_project.mart_hourly_stream_evolution: /* {"app": "dbt", "dbt_version": "1.8.2", "profile_name": "my_dbt_trino_project", "target_name": "dev", "node_id": "model.my_dbt_trino_project.mart_hourly_stream_evolution"} */

    drop table if exists "datalake"."analytics"."mart_hourly_stream_evolution__dbt_backup"
[0m10:32:10.391384 [debug] [Thread-1 (]: SQL status: SUCCESS in 0.0 seconds
[0m10:32:10.392789 [debug] [Thread-1 (]: On model.my_dbt_trino_project.mart_hourly_stream_evolution: ROLLBACK
[0m10:32:10.392789 [debug] [Thread-1 (]: On model.my_dbt_trino_project.mart_hourly_stream_evolution: Close
[0m10:32:10.393795 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '06846fa7-a8fc-468b-8654-70d69101f297', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000002624D238E90>]}
[0m10:32:10.394798 [info ] [Thread-1 (]: 11 of 15 OK created sql table model analytics.mart_hourly_stream_evolution ..... [[32mSUCCESS[0m in 0.55s]
[0m10:32:10.394798 [debug] [Thread-1 (]: Finished running node model.my_dbt_trino_project.mart_hourly_stream_evolution
[0m10:32:10.394798 [debug] [Thread-1 (]: Began running node model.my_dbt_trino_project.mart_top_songs_artists
[0m10:32:10.396251 [info ] [Thread-1 (]: 12 of 15 START sql table model analytics.mart_top_songs_artists ................ [RUN]
[0m10:32:10.396251 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.my_dbt_trino_project.mart_hourly_stream_evolution, now model.my_dbt_trino_project.mart_top_songs_artists)
[0m10:32:10.397515 [debug] [Thread-1 (]: Began compiling node model.my_dbt_trino_project.mart_top_songs_artists
[0m10:32:10.399924 [debug] [Thread-1 (]: Writing injected SQL for node "model.my_dbt_trino_project.mart_top_songs_artists"
[0m10:32:10.400929 [debug] [Thread-1 (]: Began executing node model.my_dbt_trino_project.mart_top_songs_artists
[0m10:32:10.402075 [debug] [Thread-1 (]: Writing runtime sql for node "model.my_dbt_trino_project.mart_top_songs_artists"
[0m10:32:10.404917 [debug] [Thread-1 (]: Using trino connection "model.my_dbt_trino_project.mart_top_songs_artists"
[0m10:32:10.404917 [debug] [Thread-1 (]: On model.my_dbt_trino_project.mart_top_songs_artists: /* {"app": "dbt", "dbt_version": "1.8.2", "profile_name": "my_dbt_trino_project", "target_name": "dev", "node_id": "model.my_dbt_trino_project.mart_top_songs_artists"} */

  
    

    create table "datalake"."analytics"."mart_top_songs_artists__dbt_tmp"
      
      
    as (
      

WITH top_songs AS (
    SELECT
        artist,
        song,
        play_count
    FROM "datalake"."analytics_stage"."stg_top_songs_artists"
)

SELECT
    artist,
    song,
    play_count
FROM top_songs
    )
[0m10:32:10.404917 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m10:32:10.620974 [debug] [Thread-1 (]: SQL status: SUCCESS in 0.0 seconds
[0m10:32:10.625488 [debug] [Thread-1 (]: Using trino connection "model.my_dbt_trino_project.mart_top_songs_artists"
[0m10:32:10.625488 [debug] [Thread-1 (]: On model.my_dbt_trino_project.mart_top_songs_artists: /* {"app": "dbt", "dbt_version": "1.8.2", "profile_name": "my_dbt_trino_project", "target_name": "dev", "node_id": "model.my_dbt_trino_project.mart_top_songs_artists"} */
alter table "datalake"."analytics"."mart_top_songs_artists" rename to "datalake"."analytics"."mart_top_songs_artists__dbt_backup"
[0m10:32:10.717911 [debug] [Thread-1 (]: SQL status: SUCCESS in 0.0 seconds
[0m10:32:10.720910 [debug] [Thread-1 (]: Using trino connection "model.my_dbt_trino_project.mart_top_songs_artists"
[0m10:32:10.720910 [debug] [Thread-1 (]: On model.my_dbt_trino_project.mart_top_songs_artists: /* {"app": "dbt", "dbt_version": "1.8.2", "profile_name": "my_dbt_trino_project", "target_name": "dev", "node_id": "model.my_dbt_trino_project.mart_top_songs_artists"} */
alter table "datalake"."analytics"."mart_top_songs_artists__dbt_tmp" rename to "datalake"."analytics"."mart_top_songs_artists"
[0m10:32:10.809766 [debug] [Thread-1 (]: SQL status: SUCCESS in 0.0 seconds
[0m10:32:10.812273 [debug] [Thread-1 (]: Applying DROP to: "datalake"."analytics"."mart_top_songs_artists__dbt_backup"
[0m10:32:10.813272 [debug] [Thread-1 (]: Using trino connection "model.my_dbt_trino_project.mart_top_songs_artists"
[0m10:32:10.813272 [debug] [Thread-1 (]: On model.my_dbt_trino_project.mart_top_songs_artists: /* {"app": "dbt", "dbt_version": "1.8.2", "profile_name": "my_dbt_trino_project", "target_name": "dev", "node_id": "model.my_dbt_trino_project.mart_top_songs_artists"} */

    drop table if exists "datalake"."analytics"."mart_top_songs_artists__dbt_backup"
[0m10:32:10.916581 [debug] [Thread-1 (]: SQL status: SUCCESS in 0.0 seconds
[0m10:32:10.918581 [debug] [Thread-1 (]: On model.my_dbt_trino_project.mart_top_songs_artists: ROLLBACK
[0m10:32:10.919581 [debug] [Thread-1 (]: On model.my_dbt_trino_project.mart_top_songs_artists: Close
[0m10:32:10.920086 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '06846fa7-a8fc-468b-8654-70d69101f297', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000002624EC38E90>]}
[0m10:32:10.921094 [info ] [Thread-1 (]: 12 of 15 OK created sql table model analytics.mart_top_songs_artists ........... [[32mSUCCESS[0m in 0.52s]
[0m10:32:10.922244 [debug] [Thread-1 (]: Finished running node model.my_dbt_trino_project.mart_top_songs_artists
[0m10:32:10.922244 [debug] [Thread-1 (]: Began running node model.my_dbt_trino_project.mart_total_unique_users
[0m10:32:10.922244 [info ] [Thread-1 (]: 13 of 15 START sql table model analytics.mart_total_unique_users ............... [RUN]
[0m10:32:10.923788 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.my_dbt_trino_project.mart_top_songs_artists, now model.my_dbt_trino_project.mart_total_unique_users)
[0m10:32:10.923788 [debug] [Thread-1 (]: Began compiling node model.my_dbt_trino_project.mart_total_unique_users
[0m10:32:10.927233 [debug] [Thread-1 (]: Writing injected SQL for node "model.my_dbt_trino_project.mart_total_unique_users"
[0m10:32:10.927233 [debug] [Thread-1 (]: Began executing node model.my_dbt_trino_project.mart_total_unique_users
[0m10:32:10.930487 [debug] [Thread-1 (]: Writing runtime sql for node "model.my_dbt_trino_project.mart_total_unique_users"
[0m10:32:10.931486 [debug] [Thread-1 (]: Using trino connection "model.my_dbt_trino_project.mart_total_unique_users"
[0m10:32:10.931486 [debug] [Thread-1 (]: On model.my_dbt_trino_project.mart_total_unique_users: /* {"app": "dbt", "dbt_version": "1.8.2", "profile_name": "my_dbt_trino_project", "target_name": "dev", "node_id": "model.my_dbt_trino_project.mart_total_unique_users"} */

  
    

    create table "datalake"."analytics"."mart_total_unique_users__dbt_tmp"
      
      
    as (
      

SELECT
    total_unique_users
FROM "datalake"."analytics_stage"."stg_unique_users"
    )
[0m10:32:10.932966 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m10:32:11.164174 [debug] [Thread-1 (]: SQL status: SUCCESS in 0.0 seconds
[0m10:32:11.168171 [debug] [Thread-1 (]: Using trino connection "model.my_dbt_trino_project.mart_total_unique_users"
[0m10:32:11.169174 [debug] [Thread-1 (]: On model.my_dbt_trino_project.mart_total_unique_users: /* {"app": "dbt", "dbt_version": "1.8.2", "profile_name": "my_dbt_trino_project", "target_name": "dev", "node_id": "model.my_dbt_trino_project.mart_total_unique_users"} */
alter table "datalake"."analytics"."mart_total_unique_users" rename to "datalake"."analytics"."mart_total_unique_users__dbt_backup"
[0m10:32:11.258162 [debug] [Thread-1 (]: SQL status: SUCCESS in 0.0 seconds
[0m10:32:11.261158 [debug] [Thread-1 (]: Using trino connection "model.my_dbt_trino_project.mart_total_unique_users"
[0m10:32:11.261158 [debug] [Thread-1 (]: On model.my_dbt_trino_project.mart_total_unique_users: /* {"app": "dbt", "dbt_version": "1.8.2", "profile_name": "my_dbt_trino_project", "target_name": "dev", "node_id": "model.my_dbt_trino_project.mart_total_unique_users"} */
alter table "datalake"."analytics"."mart_total_unique_users__dbt_tmp" rename to "datalake"."analytics"."mart_total_unique_users"
[0m10:32:11.340669 [debug] [Thread-1 (]: SQL status: SUCCESS in 0.0 seconds
[0m10:32:11.343264 [debug] [Thread-1 (]: Applying DROP to: "datalake"."analytics"."mart_total_unique_users__dbt_backup"
[0m10:32:11.344260 [debug] [Thread-1 (]: Using trino connection "model.my_dbt_trino_project.mart_total_unique_users"
[0m10:32:11.344260 [debug] [Thread-1 (]: On model.my_dbt_trino_project.mart_total_unique_users: /* {"app": "dbt", "dbt_version": "1.8.2", "profile_name": "my_dbt_trino_project", "target_name": "dev", "node_id": "model.my_dbt_trino_project.mart_total_unique_users"} */

    drop table if exists "datalake"."analytics"."mart_total_unique_users__dbt_backup"
[0m10:32:11.448482 [debug] [Thread-1 (]: SQL status: SUCCESS in 0.0 seconds
[0m10:32:11.449482 [debug] [Thread-1 (]: On model.my_dbt_trino_project.mart_total_unique_users: ROLLBACK
[0m10:32:11.450481 [debug] [Thread-1 (]: On model.my_dbt_trino_project.mart_total_unique_users: Close
[0m10:32:11.450481 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '06846fa7-a8fc-468b-8654-70d69101f297', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000002624F0A9C10>]}
[0m10:32:11.450481 [info ] [Thread-1 (]: 13 of 15 OK created sql table model analytics.mart_total_unique_users .......... [[32mSUCCESS[0m in 0.53s]
[0m10:32:11.451945 [debug] [Thread-1 (]: Finished running node model.my_dbt_trino_project.mart_total_unique_users
[0m10:32:11.451945 [debug] [Thread-1 (]: Began running node model.my_dbt_trino_project.mart_user_activity_per_country
[0m10:32:11.452952 [info ] [Thread-1 (]: 14 of 15 SKIP relation analytics.mart_user_activity_per_country ................ [[33mSKIP[0m]
[0m10:32:11.452952 [debug] [Thread-1 (]: Finished running node model.my_dbt_trino_project.mart_user_activity_per_country
[0m10:32:11.453952 [debug] [Thread-1 (]: Began running node model.my_dbt_trino_project.mart_user_activity_per_state
[0m10:32:11.453952 [info ] [Thread-1 (]: 15 of 15 START sql table model analytics.mart_user_activity_per_state .......... [RUN]
[0m10:32:11.454952 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.my_dbt_trino_project.mart_total_unique_users, now model.my_dbt_trino_project.mart_user_activity_per_state)
[0m10:32:11.454952 [debug] [Thread-1 (]: Began compiling node model.my_dbt_trino_project.mart_user_activity_per_state
[0m10:32:11.457512 [debug] [Thread-1 (]: Writing injected SQL for node "model.my_dbt_trino_project.mart_user_activity_per_state"
[0m10:32:11.458532 [debug] [Thread-1 (]: Began executing node model.my_dbt_trino_project.mart_user_activity_per_state
[0m10:32:11.462520 [debug] [Thread-1 (]: Writing runtime sql for node "model.my_dbt_trino_project.mart_user_activity_per_state"
[0m10:32:11.464518 [debug] [Thread-1 (]: Using trino connection "model.my_dbt_trino_project.mart_user_activity_per_state"
[0m10:32:11.464518 [debug] [Thread-1 (]: On model.my_dbt_trino_project.mart_user_activity_per_state: /* {"app": "dbt", "dbt_version": "1.8.2", "profile_name": "my_dbt_trino_project", "target_name": "dev", "node_id": "model.my_dbt_trino_project.mart_user_activity_per_state"} */

  
    

    create table "datalake"."analytics"."mart_user_activity_per_state__dbt_tmp"
      
      
    as (
      

SELECT
  state,
  city,
  SUM(activity_count) AS total_activity
FROM "datalake"."analytics_stage"."stg_user_activity_per_location"
GROUP BY state, city
ORDER BY state, SUM(activity_count) DESC
    )
[0m10:32:11.465519 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m10:32:11.731505 [debug] [Thread-1 (]: SQL status: SUCCESS in 0.0 seconds
[0m10:32:11.734651 [debug] [Thread-1 (]: Using trino connection "model.my_dbt_trino_project.mart_user_activity_per_state"
[0m10:32:11.735169 [debug] [Thread-1 (]: On model.my_dbt_trino_project.mart_user_activity_per_state: /* {"app": "dbt", "dbt_version": "1.8.2", "profile_name": "my_dbt_trino_project", "target_name": "dev", "node_id": "model.my_dbt_trino_project.mart_user_activity_per_state"} */
alter table "datalake"."analytics"."mart_user_activity_per_state" rename to "datalake"."analytics"."mart_user_activity_per_state__dbt_backup"
[0m10:32:11.819604 [debug] [Thread-1 (]: SQL status: SUCCESS in 0.0 seconds
[0m10:32:11.822108 [debug] [Thread-1 (]: Using trino connection "model.my_dbt_trino_project.mart_user_activity_per_state"
[0m10:32:11.822108 [debug] [Thread-1 (]: On model.my_dbt_trino_project.mart_user_activity_per_state: /* {"app": "dbt", "dbt_version": "1.8.2", "profile_name": "my_dbt_trino_project", "target_name": "dev", "node_id": "model.my_dbt_trino_project.mart_user_activity_per_state"} */
alter table "datalake"."analytics"."mart_user_activity_per_state__dbt_tmp" rename to "datalake"."analytics"."mart_user_activity_per_state"
[0m10:32:11.902888 [debug] [Thread-1 (]: SQL status: SUCCESS in 0.0 seconds
[0m10:32:11.905896 [debug] [Thread-1 (]: Applying DROP to: "datalake"."analytics"."mart_user_activity_per_state__dbt_backup"
[0m10:32:11.906897 [debug] [Thread-1 (]: Using trino connection "model.my_dbt_trino_project.mart_user_activity_per_state"
[0m10:32:11.906897 [debug] [Thread-1 (]: On model.my_dbt_trino_project.mart_user_activity_per_state: /* {"app": "dbt", "dbt_version": "1.8.2", "profile_name": "my_dbt_trino_project", "target_name": "dev", "node_id": "model.my_dbt_trino_project.mart_user_activity_per_state"} */

    drop table if exists "datalake"."analytics"."mart_user_activity_per_state__dbt_backup"
[0m10:32:12.020463 [debug] [Thread-1 (]: SQL status: SUCCESS in 0.0 seconds
[0m10:32:12.022471 [debug] [Thread-1 (]: On model.my_dbt_trino_project.mart_user_activity_per_state: ROLLBACK
[0m10:32:12.022471 [debug] [Thread-1 (]: On model.my_dbt_trino_project.mart_user_activity_per_state: Close
[0m10:32:12.023469 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '06846fa7-a8fc-468b-8654-70d69101f297', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x0000026249A34550>]}
[0m10:32:12.023469 [info ] [Thread-1 (]: 15 of 15 OK created sql table model analytics.mart_user_activity_per_state ..... [[32mSUCCESS[0m in 0.57s]
[0m10:32:12.024472 [debug] [Thread-1 (]: Finished running node model.my_dbt_trino_project.mart_user_activity_per_state
[0m10:32:12.025496 [debug] [MainThread]: On master: COMMIT
[0m10:32:12.025496 [debug] [MainThread]: Connection 'master' was properly closed.
[0m10:32:12.025496 [debug] [MainThread]: Connection 'list_datalake' was properly closed.
[0m10:32:12.025496 [debug] [MainThread]: Connection 'list_datalake_analytics_source' was properly closed.
[0m10:32:12.026997 [debug] [MainThread]: Connection 'model.my_dbt_trino_project.mart_user_activity_per_state' was properly closed.
[0m10:32:12.026997 [info ] [MainThread]: 
[0m10:32:12.026997 [info ] [MainThread]: Finished running 8 table models, 2 incremental models, 5 view models in 0 hours 0 minutes and 6.12 seconds (6.12s).
[0m10:32:12.029038 [debug] [MainThread]: Command end result
[0m10:32:12.060044 [info ] [MainThread]: 
[0m10:32:12.061048 [info ] [MainThread]: [31mCompleted with 1 error and 0 warnings:[0m
[0m10:32:12.062048 [info ] [MainThread]: 
[0m10:32:12.062613 [error] [MainThread]:   Database Error in model stg_user_activity_per_country (models\stage\stg_user_activity_per_country.sql)
  TrinoUserError(type=USER_ERROR, name=SYNTAX_ERROR, message="line 21:5: mismatched input 'ts'. Expecting: ')', ',', 'EXCEPT', 'FETCH', 'FROM', 'GROUP', 'HAVING', 'INTERSECT', 'LIMIT', 'OFFSET', 'ORDER', 'UNION', 'WHERE', 'WINDOW'", query_id=20240619_023209_00364_uxt54)
  compiled Code at target\run\my_dbt_trino_project\models\stage\stg_user_activity_per_country.sql
[0m10:32:12.062613 [info ] [MainThread]: 
[0m10:32:12.063625 [info ] [MainThread]: Done. PASS=13 WARN=0 ERROR=1 SKIP=1 TOTAL=15
[0m10:32:12.065621 [debug] [MainThread]: Command `dbt run` failed at 10:32:12.064620 after 7.06 seconds
[0m10:32:12.065621 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x00000262480AEF50>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x00000262480AE210>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000002624D646C90>]}
[0m10:32:12.065621 [debug] [MainThread]: Flushing usage events
[0m10:32:39.894273 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x00000268E9304B10>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x00000268E9367D90>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x00000268E933A350>]}


============================== 10:32:39.896275 | 9c73b342-150c-40c1-97df-70c1641d00f9 ==============================
[0m10:32:39.896275 [info ] [MainThread]: Running with dbt=1.8.2
[0m10:32:39.897763 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'indirect_selection': 'eager', 'log_cache_events': 'False', 'write_json': 'True', 'partial_parse': 'True', 'cache_selected_only': 'False', 'warn_error': 'None', 'version_check': 'True', 'profiles_dir': 'C:\\Users\\ASUS\\Desktop\\work\\Iceberg-Dbt-Trino-Hive-modern-open-source-data-stack-main\\dbt', 'log_path': 'C:\\Users\\ASUS\\Desktop\\work\\Iceberg-Dbt-Trino-Hive-modern-open-source-data-stack-main\\dbt\\logs', 'fail_fast': 'False', 'debug': 'False', 'use_colors': 'True', 'use_experimental_parser': 'False', 'no_print': 'None', 'quiet': 'False', 'log_format': 'default', 'invocation_command': 'dbt run', 'static_parser': 'True', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'target_path': 'None', 'introspect': 'True', 'send_anonymous_usage_stats': 'True'}
[0m10:32:40.201272 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': '9c73b342-150c-40c1-97df-70c1641d00f9', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x00000268E9349C90>]}
[0m10:32:40.237318 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': '9c73b342-150c-40c1-97df-70c1641d00f9', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x00000268E6485310>]}
[0m10:32:40.238319 [info ] [MainThread]: Registered adapter: trino=1.8.0
[0m10:32:40.248649 [debug] [MainThread]: checksum: f0a141b9de567cb7f131613ba2682f40b3a1c6a157f81c6e5435862eff68f109, vars: {}, profile: , target: , version: 1.8.2
[0m10:32:40.401483 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 1 files changed.
[0m10:32:40.402483 [debug] [MainThread]: Partial parsing: updated file: my_dbt_trino_project://models\stage\stg_user_activity_per_country.sql
[0m10:32:40.583135 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': '9c73b342-150c-40c1-97df-70c1641d00f9', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x00000268E94848D0>]}
[0m10:32:40.656755 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': '9c73b342-150c-40c1-97df-70c1641d00f9', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x00000268E9B23390>]}
[0m10:32:40.657762 [info ] [MainThread]: Found 15 models, 7 data tests, 3 sources, 559 macros
[0m10:32:40.658036 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '9c73b342-150c-40c1-97df-70c1641d00f9', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x00000268E9BB6850>]}
[0m10:32:40.659555 [info ] [MainThread]: 
[0m10:32:40.659555 [debug] [MainThread]: Acquiring new trino connection 'master'
[0m10:32:40.664538 [debug] [ThreadPool]: Acquiring new trino connection 'list_datalake'
[0m10:32:40.717467 [debug] [ThreadPool]: Using trino connection "list_datalake"
[0m10:32:40.718469 [debug] [ThreadPool]: On list_datalake: /* {"app": "dbt", "dbt_version": "1.8.2", "profile_name": "my_dbt_trino_project", "target_name": "dev", "connection_name": "list_datalake"} */

    select schema_name
    from "datalake".INFORMATION_SCHEMA.schemata
[0m10:32:40.718469 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m10:32:40.748622 [debug] [ThreadPool]: SQL status: SUCCESS in 0.0 seconds
[0m10:32:40.749619 [debug] [ThreadPool]: On list_datalake: Close
[0m10:32:40.752976 [debug] [ThreadPool]: Using trino connection "list_datalake"
[0m10:32:40.753975 [debug] [ThreadPool]: On list_datalake: /* {"app": "dbt", "dbt_version": "1.8.2", "profile_name": "my_dbt_trino_project", "target_name": "dev", "connection_name": "list_datalake"} */

    select schema_name
    from "datalake".INFORMATION_SCHEMA.schemata
[0m10:32:40.753975 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m10:32:40.772427 [debug] [ThreadPool]: SQL status: SUCCESS in 0.0 seconds
[0m10:32:40.773424 [debug] [ThreadPool]: On list_datalake: Close
[0m10:32:40.775427 [debug] [ThreadPool]: Using trino connection "list_datalake"
[0m10:32:40.776425 [debug] [ThreadPool]: On list_datalake: /* {"app": "dbt", "dbt_version": "1.8.2", "profile_name": "my_dbt_trino_project", "target_name": "dev", "connection_name": "list_datalake"} */

    select schema_name
    from "datalake".INFORMATION_SCHEMA.schemata
[0m10:32:40.776425 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m10:32:40.809451 [debug] [ThreadPool]: SQL status: SUCCESS in 0.0 seconds
[0m10:32:40.810459 [debug] [ThreadPool]: On list_datalake: Close
[0m10:32:40.812566 [debug] [ThreadPool]: Acquiring new trino connection 'list_datalake_analytics_stage'
[0m10:32:40.822571 [debug] [ThreadPool]: Using trino connection "list_datalake_analytics_stage"
[0m10:32:40.822571 [debug] [ThreadPool]: On list_datalake_analytics_stage: /* {"app": "dbt", "dbt_version": "1.8.2", "profile_name": "my_dbt_trino_project", "target_name": "dev", "connection_name": "list_datalake_analytics_stage"} */
select
      t.table_catalog as database,
      t.table_name as name,
      t.table_schema as schema,
      case when mv.name is not null then 'materialized_view'
           when t.table_type = 'BASE TABLE' then 'table'
           when t.table_type = 'VIEW' then 'view'
           else t.table_type
      end as table_type
    from "datalake".INFORMATION_SCHEMA.tables t
    left join (
            select * from system.metadata.materialized_views
            where catalog_name = 'datalake'
              and schema_name = 'analytics_stage') mv
          on mv.catalog_name = t.table_catalog and mv.schema_name = t.table_schema and mv.name = t.table_name
    where t.table_schema = 'analytics_stage'
[0m10:32:40.823575 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m10:32:40.879638 [debug] [ThreadPool]: SQL status: SUCCESS in 0.0 seconds
[0m10:32:40.879638 [debug] [ThreadPool]: On list_datalake_analytics_stage: ROLLBACK
[0m10:32:40.880993 [debug] [ThreadPool]: On list_datalake_analytics_stage: Close
[0m10:32:40.880993 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_datalake_analytics_stage, now list_datalake_analytics_source)
[0m10:32:40.885125 [debug] [ThreadPool]: Using trino connection "list_datalake_analytics_source"
[0m10:32:40.885125 [debug] [ThreadPool]: On list_datalake_analytics_source: /* {"app": "dbt", "dbt_version": "1.8.2", "profile_name": "my_dbt_trino_project", "target_name": "dev", "connection_name": "list_datalake_analytics_source"} */
select
      t.table_catalog as database,
      t.table_name as name,
      t.table_schema as schema,
      case when mv.name is not null then 'materialized_view'
           when t.table_type = 'BASE TABLE' then 'table'
           when t.table_type = 'VIEW' then 'view'
           else t.table_type
      end as table_type
    from "datalake".INFORMATION_SCHEMA.tables t
    left join (
            select * from system.metadata.materialized_views
            where catalog_name = 'datalake'
              and schema_name = 'analytics_source') mv
          on mv.catalog_name = t.table_catalog and mv.schema_name = t.table_schema and mv.name = t.table_name
    where t.table_schema = 'analytics_source'
[0m10:32:40.886126 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m10:32:40.937173 [debug] [ThreadPool]: SQL status: SUCCESS in 0.0 seconds
[0m10:32:40.939172 [debug] [ThreadPool]: On list_datalake_analytics_source: ROLLBACK
[0m10:32:40.939172 [debug] [ThreadPool]: On list_datalake_analytics_source: Close
[0m10:32:40.939172 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_datalake_analytics_source, now list_datalake_analytics)
[0m10:32:40.943581 [debug] [ThreadPool]: Using trino connection "list_datalake_analytics"
[0m10:32:40.943581 [debug] [ThreadPool]: On list_datalake_analytics: /* {"app": "dbt", "dbt_version": "1.8.2", "profile_name": "my_dbt_trino_project", "target_name": "dev", "connection_name": "list_datalake_analytics"} */
select
      t.table_catalog as database,
      t.table_name as name,
      t.table_schema as schema,
      case when mv.name is not null then 'materialized_view'
           when t.table_type = 'BASE TABLE' then 'table'
           when t.table_type = 'VIEW' then 'view'
           else t.table_type
      end as table_type
    from "datalake".INFORMATION_SCHEMA.tables t
    left join (
            select * from system.metadata.materialized_views
            where catalog_name = 'datalake'
              and schema_name = 'analytics') mv
          on mv.catalog_name = t.table_catalog and mv.schema_name = t.table_schema and mv.name = t.table_name
    where t.table_schema = 'analytics'
[0m10:32:40.943581 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m10:32:41.005800 [debug] [ThreadPool]: SQL status: SUCCESS in 0.0 seconds
[0m10:32:41.006800 [debug] [ThreadPool]: On list_datalake_analytics: ROLLBACK
[0m10:32:41.006800 [debug] [ThreadPool]: On list_datalake_analytics: Close
[0m10:32:41.009222 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '9c73b342-150c-40c1-97df-70c1641d00f9', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x00000268E97A3790>]}
[0m10:32:41.009222 [debug] [MainThread]: On master: COMMIT
[0m10:32:41.009222 [info ] [MainThread]: Concurrency: 1 threads (target='dev')
[0m10:32:41.010234 [info ] [MainThread]: 
[0m10:32:41.012713 [debug] [Thread-1 (]: Began running node model.my_dbt_trino_project.src_auth_events
[0m10:32:41.013713 [info ] [Thread-1 (]: 1 of 15 START sql table model analytics_source.src_auth_events ................. [RUN]
[0m10:32:41.013713 [debug] [Thread-1 (]: Acquiring new trino connection 'model.my_dbt_trino_project.src_auth_events'
[0m10:32:41.014859 [debug] [Thread-1 (]: Began compiling node model.my_dbt_trino_project.src_auth_events
[0m10:32:41.019944 [debug] [Thread-1 (]: Writing injected SQL for node "model.my_dbt_trino_project.src_auth_events"
[0m10:32:41.019944 [debug] [Thread-1 (]: Began executing node model.my_dbt_trino_project.src_auth_events
[0m10:32:41.048753 [debug] [Thread-1 (]: Writing runtime sql for node "model.my_dbt_trino_project.src_auth_events"
[0m10:32:41.052657 [debug] [Thread-1 (]: Using trino connection "model.my_dbt_trino_project.src_auth_events"
[0m10:32:41.053662 [debug] [Thread-1 (]: On model.my_dbt_trino_project.src_auth_events: /* {"app": "dbt", "dbt_version": "1.8.2", "profile_name": "my_dbt_trino_project", "target_name": "dev", "node_id": "model.my_dbt_trino_project.src_auth_events"} */

  
    

    create table "datalake"."analytics_source"."src_auth_events__dbt_tmp"
      
      
    as (
      

with source as (
    select
        CAST(ts AS VARCHAR) as id, 
        ts,
        CAST(sessionId AS VARCHAR) as sessionId,
        level,
        itemInSession,
        city,
        zip,
        state,
        userAgent,
        CAST(NULLIF(lon, '') AS double) as lon,
        CAST(NULLIF(lat, '') AS double) as lat,
        CAST(FLOOR(CAST(NULLIF(userId, '') AS DOUBLE)) AS INT) as userId, 
        lastName,
        firstName,
        gender,
        CAST(FLOOR(CAST(NULLIF(registration, '') AS DOUBLE)) AS BIGINT) as registration,
        success
    from "oltp"."public"."auth_events"
)

select
    id,
    ts,
    sessionId,
    level,
    itemInSession,
    city,
    zip,
    state,
    userAgent,
    lon,
    lat,
    userId,
    lastName,
    firstName,
    gender,
    registration, 
    CASE 
        WHEN CAST(success AS VARCHAR) = 't' THEN true 
        WHEN CAST(success AS VARCHAR) = 'f' THEN false
        ELSE NULL 
    END AS success_boolean
from source


    )
[0m10:32:41.053662 [debug] [Thread-1 (]: Opening a new connection, currently in state init
[0m10:32:41.277024 [debug] [Thread-1 (]: SQL status: SUCCESS in 0.0 seconds
[0m10:32:41.283100 [debug] [Thread-1 (]: Using trino connection "model.my_dbt_trino_project.src_auth_events"
[0m10:32:41.283100 [debug] [Thread-1 (]: On model.my_dbt_trino_project.src_auth_events: /* {"app": "dbt", "dbt_version": "1.8.2", "profile_name": "my_dbt_trino_project", "target_name": "dev", "node_id": "model.my_dbt_trino_project.src_auth_events"} */
alter table "datalake"."analytics_source"."src_auth_events" rename to "datalake"."analytics_source"."src_auth_events__dbt_backup"
[0m10:32:41.371967 [debug] [Thread-1 (]: SQL status: SUCCESS in 0.0 seconds
[0m10:32:41.377002 [debug] [Thread-1 (]: Using trino connection "model.my_dbt_trino_project.src_auth_events"
[0m10:32:41.377002 [debug] [Thread-1 (]: On model.my_dbt_trino_project.src_auth_events: /* {"app": "dbt", "dbt_version": "1.8.2", "profile_name": "my_dbt_trino_project", "target_name": "dev", "node_id": "model.my_dbt_trino_project.src_auth_events"} */
alter table "datalake"."analytics_source"."src_auth_events__dbt_tmp" rename to "datalake"."analytics_source"."src_auth_events"
[0m10:32:41.471297 [debug] [Thread-1 (]: SQL status: SUCCESS in 0.0 seconds
[0m10:32:41.530937 [debug] [Thread-1 (]: Applying DROP to: "datalake"."analytics_source"."src_auth_events__dbt_backup"
[0m10:32:41.532933 [debug] [Thread-1 (]: Using trino connection "model.my_dbt_trino_project.src_auth_events"
[0m10:32:41.532933 [debug] [Thread-1 (]: On model.my_dbt_trino_project.src_auth_events: /* {"app": "dbt", "dbt_version": "1.8.2", "profile_name": "my_dbt_trino_project", "target_name": "dev", "node_id": "model.my_dbt_trino_project.src_auth_events"} */

    drop table if exists "datalake"."analytics_source"."src_auth_events__dbt_backup"
[0m10:32:41.645518 [debug] [Thread-1 (]: SQL status: SUCCESS in 0.0 seconds
[0m10:32:41.657615 [debug] [Thread-1 (]: On model.my_dbt_trino_project.src_auth_events: ROLLBACK
[0m10:32:41.658616 [debug] [Thread-1 (]: On model.my_dbt_trino_project.src_auth_events: Close
[0m10:32:41.659889 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '9c73b342-150c-40c1-97df-70c1641d00f9', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x00000268EAFA53D0>]}
[0m10:32:41.659889 [info ] [Thread-1 (]: 1 of 15 OK created sql table model analytics_source.src_auth_events ............ [[32mSUCCESS[0m in 0.64s]
[0m10:32:41.661302 [debug] [Thread-1 (]: Finished running node model.my_dbt_trino_project.src_auth_events
[0m10:32:41.661302 [debug] [Thread-1 (]: Began running node model.my_dbt_trino_project.src_listen_events
[0m10:32:41.662313 [info ] [Thread-1 (]: 2 of 15 START sql incremental model analytics_source.src_listen_events ......... [RUN]
[0m10:32:41.662313 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.my_dbt_trino_project.src_auth_events, now model.my_dbt_trino_project.src_listen_events)
[0m10:32:41.663319 [debug] [Thread-1 (]: Began compiling node model.my_dbt_trino_project.src_listen_events
[0m10:32:41.667326 [debug] [Thread-1 (]: Writing injected SQL for node "model.my_dbt_trino_project.src_listen_events"
[0m10:32:41.668398 [debug] [Thread-1 (]: Began executing node model.my_dbt_trino_project.src_listen_events
[0m10:32:41.692269 [debug] [Thread-1 (]: Using trino connection "model.my_dbt_trino_project.src_listen_events"
[0m10:32:41.692269 [debug] [Thread-1 (]: On model.my_dbt_trino_project.src_listen_events: /* {"app": "dbt", "dbt_version": "1.8.2", "profile_name": "my_dbt_trino_project", "target_name": "dev", "node_id": "model.my_dbt_trino_project.src_listen_events"} */

  
    

    create table "datalake"."analytics_source"."src_listen_events__dbt_tmp"
      
      
    as (
      

with source as (

    select
        CAST(_id AS VARCHAR) as id,
        artist,
        song,
        CAST(NULLIF(duration, '') AS DOUBLE) as duration,
        ts,
        sessionid,
        auth,
        level,
        CAST(NULLIF(itemInSession, '') AS INTEGER) as itemInSession,
        city,
        zip,
        state,
        country,
        userAgent,
        CAST(NULLIF(lon, '') AS DOUBLE) as lon,
        CAST(NULLIF(lat, '') AS DOUBLE) as lat,
        CAST(CAST(NULLIF(userId, '') AS DOUBLE) AS INTEGER) as userId,
 -- Assurez-vous que userId peut aussi être converti de cette manière.
        lastName,
        firstName,
        gender,
        CAST(CAST(NULLIF(registration, '') AS DOUBLE) AS BIGINT) as registration
    from "website"."demo"."listen_events"

)

select * from source



    -- this filter will only be applied on an incremental run
    where ts > (select max(ts) from "datalake"."analytics_source"."src_listen_events")


    )
[0m10:32:41.693268 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m10:32:41.836758 [debug] [Thread-1 (]: SQL status: SUCCESS in 0.0 seconds
[0m10:32:41.844277 [debug] [Thread-1 (]: Using trino connection "model.my_dbt_trino_project.src_listen_events"
[0m10:32:41.845278 [debug] [Thread-1 (]: On model.my_dbt_trino_project.src_listen_events: /* {"app": "dbt", "dbt_version": "1.8.2", "profile_name": "my_dbt_trino_project", "target_name": "dev", "node_id": "model.my_dbt_trino_project.src_listen_events"} */

    describe "datalake"."analytics_source"."src_listen_events__dbt_tmp"
[0m10:32:41.935504 [debug] [Thread-1 (]: SQL status: SUCCESS in 0.0 seconds
[0m10:32:41.939503 [debug] [Thread-1 (]: Using trino connection "model.my_dbt_trino_project.src_listen_events"
[0m10:32:41.939503 [debug] [Thread-1 (]: On model.my_dbt_trino_project.src_listen_events: /* {"app": "dbt", "dbt_version": "1.8.2", "profile_name": "my_dbt_trino_project", "target_name": "dev", "node_id": "model.my_dbt_trino_project.src_listen_events"} */

    describe "datalake"."analytics_source"."src_listen_events"
[0m10:32:42.026670 [debug] [Thread-1 (]: SQL status: SUCCESS in 0.0 seconds
[0m10:32:42.033176 [debug] [Thread-1 (]: Using trino connection "model.my_dbt_trino_project.src_listen_events"
[0m10:32:42.034182 [debug] [Thread-1 (]: On model.my_dbt_trino_project.src_listen_events: /* {"app": "dbt", "dbt_version": "1.8.2", "profile_name": "my_dbt_trino_project", "target_name": "dev", "node_id": "model.my_dbt_trino_project.src_listen_events"} */

    describe "datalake"."analytics_source"."src_listen_events"
[0m10:32:42.133871 [debug] [Thread-1 (]: SQL status: SUCCESS in 0.0 seconds
[0m10:32:42.142849 [debug] [Thread-1 (]: Writing runtime sql for node "model.my_dbt_trino_project.src_listen_events"
[0m10:32:42.144848 [debug] [Thread-1 (]: Using trino connection "model.my_dbt_trino_project.src_listen_events"
[0m10:32:42.144848 [debug] [Thread-1 (]: On model.my_dbt_trino_project.src_listen_events: /* {"app": "dbt", "dbt_version": "1.8.2", "profile_name": "my_dbt_trino_project", "target_name": "dev", "node_id": "model.my_dbt_trino_project.src_listen_events"} */
insert into "datalake"."analytics_source"."src_listen_events" ("id", "artist", "song", "duration", "ts", "sessionid", "auth", "level", "iteminsession", "city", "zip", "state", "country", "useragent", "lon", "lat", "userid", "lastname", "firstname", "gender", "registration")
    (
        select "id", "artist", "song", "duration", "ts", "sessionid", "auth", "level", "iteminsession", "city", "zip", "state", "country", "useragent", "lon", "lat", "userid", "lastname", "firstname", "gender", "registration"
        from "datalake"."analytics_source"."src_listen_events__dbt_tmp"
    )
[0m10:32:42.255996 [debug] [Thread-1 (]: SQL status: SUCCESS in 0.0 seconds
[0m10:32:42.260334 [debug] [Thread-1 (]: Applying DROP to: "datalake"."analytics_source"."src_listen_events__dbt_tmp"
[0m10:32:42.261339 [debug] [Thread-1 (]: Using trino connection "model.my_dbt_trino_project.src_listen_events"
[0m10:32:42.261339 [debug] [Thread-1 (]: On model.my_dbt_trino_project.src_listen_events: /* {"app": "dbt", "dbt_version": "1.8.2", "profile_name": "my_dbt_trino_project", "target_name": "dev", "node_id": "model.my_dbt_trino_project.src_listen_events"} */

    drop table if exists "datalake"."analytics_source"."src_listen_events__dbt_tmp"
[0m10:32:42.354819 [debug] [Thread-1 (]: SQL status: SUCCESS in 0.0 seconds
[0m10:32:42.355827 [debug] [Thread-1 (]: On model.my_dbt_trino_project.src_listen_events: ROLLBACK
[0m10:32:42.356827 [debug] [Thread-1 (]: On model.my_dbt_trino_project.src_listen_events: Close
[0m10:32:42.356827 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '9c73b342-150c-40c1-97df-70c1641d00f9', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x00000268E9498690>]}
[0m10:32:42.357827 [info ] [Thread-1 (]: 2 of 15 OK created sql incremental model analytics_source.src_listen_events .... [[32mSUCCESS[0m in 0.69s]
[0m10:32:42.357827 [debug] [Thread-1 (]: Finished running node model.my_dbt_trino_project.src_listen_events
[0m10:32:42.359217 [debug] [Thread-1 (]: Began running node model.my_dbt_trino_project.src_page_view_events
[0m10:32:42.359640 [info ] [Thread-1 (]: 3 of 15 START sql incremental model analytics_source.src_page_view_events ...... [RUN]
[0m10:32:42.359640 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.my_dbt_trino_project.src_listen_events, now model.my_dbt_trino_project.src_page_view_events)
[0m10:32:42.360720 [debug] [Thread-1 (]: Began compiling node model.my_dbt_trino_project.src_page_view_events
[0m10:32:42.363151 [debug] [Thread-1 (]: Writing injected SQL for node "model.my_dbt_trino_project.src_page_view_events"
[0m10:32:42.364161 [debug] [Thread-1 (]: Began executing node model.my_dbt_trino_project.src_page_view_events
[0m10:32:42.369649 [debug] [Thread-1 (]: Using trino connection "model.my_dbt_trino_project.src_page_view_events"
[0m10:32:42.369649 [debug] [Thread-1 (]: On model.my_dbt_trino_project.src_page_view_events: /* {"app": "dbt", "dbt_version": "1.8.2", "profile_name": "my_dbt_trino_project", "target_name": "dev", "node_id": "model.my_dbt_trino_project.src_page_view_events"} */

  
    

    create table "datalake"."analytics_source"."src_page_view_events__dbt_tmp"
      
      
    as (
      

with source as (
    select
        CAST(_id AS VARCHAR) as id,
        ts,
        CAST(sessionId AS VARCHAR) as sessionId,
        page,
        auth,
        level,
        CAST(CAST(NULLIF(itemInSession, '') AS DOUBLE) AS INTEGER) as itemInSession, 
        city,
        zip,
        state,
        userAgent,
        CAST(NULLIF(lon, '') AS double) as lon,
        CAST(NULLIF(lat, '') AS double) as lat,
        CAST(CAST(NULLIF(userId, '') AS DOUBLE) AS INTEGER) as userId, 
        lastName,
        firstName,
        gender,
        CAST(CAST(NULLIF(registration, '') AS DOUBLE) AS BIGINT) as registration, 
        artist,
        song,
        CAST(NULLIF(duration, '') AS double) as duration
    from "website"."demo"."page_view_events"
)

select * from source


    where ts > (select max(ts) from "datalake"."analytics_source"."src_page_view_events")

    )
[0m10:32:42.370657 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m10:32:42.510065 [debug] [Thread-1 (]: SQL status: SUCCESS in 0.0 seconds
[0m10:32:42.512071 [debug] [Thread-1 (]: Using trino connection "model.my_dbt_trino_project.src_page_view_events"
[0m10:32:42.513083 [debug] [Thread-1 (]: On model.my_dbt_trino_project.src_page_view_events: /* {"app": "dbt", "dbt_version": "1.8.2", "profile_name": "my_dbt_trino_project", "target_name": "dev", "node_id": "model.my_dbt_trino_project.src_page_view_events"} */

    describe "datalake"."analytics_source"."src_page_view_events__dbt_tmp"
[0m10:32:42.591254 [debug] [Thread-1 (]: SQL status: SUCCESS in 0.0 seconds
[0m10:32:42.594274 [debug] [Thread-1 (]: Using trino connection "model.my_dbt_trino_project.src_page_view_events"
[0m10:32:42.594274 [debug] [Thread-1 (]: On model.my_dbt_trino_project.src_page_view_events: /* {"app": "dbt", "dbt_version": "1.8.2", "profile_name": "my_dbt_trino_project", "target_name": "dev", "node_id": "model.my_dbt_trino_project.src_page_view_events"} */

    describe "datalake"."analytics_source"."src_page_view_events"
[0m10:32:42.683129 [debug] [Thread-1 (]: SQL status: SUCCESS in 0.0 seconds
[0m10:32:42.686142 [debug] [Thread-1 (]: Using trino connection "model.my_dbt_trino_project.src_page_view_events"
[0m10:32:42.686142 [debug] [Thread-1 (]: On model.my_dbt_trino_project.src_page_view_events: /* {"app": "dbt", "dbt_version": "1.8.2", "profile_name": "my_dbt_trino_project", "target_name": "dev", "node_id": "model.my_dbt_trino_project.src_page_view_events"} */

    describe "datalake"."analytics_source"."src_page_view_events"
[0m10:32:42.776277 [debug] [Thread-1 (]: SQL status: SUCCESS in 0.0 seconds
[0m10:32:42.778279 [debug] [Thread-1 (]: Writing runtime sql for node "model.my_dbt_trino_project.src_page_view_events"
[0m10:32:42.780707 [debug] [Thread-1 (]: Using trino connection "model.my_dbt_trino_project.src_page_view_events"
[0m10:32:42.780707 [debug] [Thread-1 (]: On model.my_dbt_trino_project.src_page_view_events: /* {"app": "dbt", "dbt_version": "1.8.2", "profile_name": "my_dbt_trino_project", "target_name": "dev", "node_id": "model.my_dbt_trino_project.src_page_view_events"} */
insert into "datalake"."analytics_source"."src_page_view_events" ("id", "ts", "sessionid", "page", "auth", "level", "iteminsession", "city", "zip", "state", "useragent", "lon", "lat", "userid", "lastname", "firstname", "gender", "registration", "artist", "song", "duration")
    (
        select "id", "ts", "sessionid", "page", "auth", "level", "iteminsession", "city", "zip", "state", "useragent", "lon", "lat", "userid", "lastname", "firstname", "gender", "registration", "artist", "song", "duration"
        from "datalake"."analytics_source"."src_page_view_events__dbt_tmp"
    )
[0m10:32:42.886153 [debug] [Thread-1 (]: SQL status: SUCCESS in 0.0 seconds
[0m10:32:42.888152 [debug] [Thread-1 (]: Applying DROP to: "datalake"."analytics_source"."src_page_view_events__dbt_tmp"
[0m10:32:42.889154 [debug] [Thread-1 (]: Using trino connection "model.my_dbt_trino_project.src_page_view_events"
[0m10:32:42.889154 [debug] [Thread-1 (]: On model.my_dbt_trino_project.src_page_view_events: /* {"app": "dbt", "dbt_version": "1.8.2", "profile_name": "my_dbt_trino_project", "target_name": "dev", "node_id": "model.my_dbt_trino_project.src_page_view_events"} */

    drop table if exists "datalake"."analytics_source"."src_page_view_events__dbt_tmp"
[0m10:32:42.986050 [debug] [Thread-1 (]: SQL status: SUCCESS in 0.0 seconds
[0m10:32:42.988048 [debug] [Thread-1 (]: On model.my_dbt_trino_project.src_page_view_events: ROLLBACK
[0m10:32:42.988048 [debug] [Thread-1 (]: On model.my_dbt_trino_project.src_page_view_events: Close
[0m10:32:42.989049 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '9c73b342-150c-40c1-97df-70c1641d00f9', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x00000268E971D7D0>]}
[0m10:32:42.989049 [info ] [Thread-1 (]: 3 of 15 OK created sql incremental model analytics_source.src_page_view_events . [[32mSUCCESS[0m in 0.63s]
[0m10:32:42.990433 [debug] [Thread-1 (]: Finished running node model.my_dbt_trino_project.src_page_view_events
[0m10:32:42.990433 [debug] [Thread-1 (]: Began running node model.my_dbt_trino_project.stg_user_level_by_gender
[0m10:32:42.991272 [info ] [Thread-1 (]: 4 of 15 START sql view model analytics_stage.stg_user_level_by_gender .......... [RUN]
[0m10:32:42.991272 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.my_dbt_trino_project.src_page_view_events, now model.my_dbt_trino_project.stg_user_level_by_gender)
[0m10:32:42.992612 [debug] [Thread-1 (]: Began compiling node model.my_dbt_trino_project.stg_user_level_by_gender
[0m10:32:42.994620 [debug] [Thread-1 (]: Writing injected SQL for node "model.my_dbt_trino_project.stg_user_level_by_gender"
[0m10:32:42.995620 [debug] [Thread-1 (]: Began executing node model.my_dbt_trino_project.stg_user_level_by_gender
[0m10:32:43.011136 [debug] [Thread-1 (]: Writing runtime sql for node "model.my_dbt_trino_project.stg_user_level_by_gender"
[0m10:32:43.013136 [debug] [Thread-1 (]: Using trino connection "model.my_dbt_trino_project.stg_user_level_by_gender"
[0m10:32:43.013136 [debug] [Thread-1 (]: On model.my_dbt_trino_project.stg_user_level_by_gender: /* {"app": "dbt", "dbt_version": "1.8.2", "profile_name": "my_dbt_trino_project", "target_name": "dev", "node_id": "model.my_dbt_trino_project.stg_user_level_by_gender"} */

  create or replace view
    "datalake"."analytics_stage"."stg_user_level_by_gender"
  security definer
  as
    

WITH user_subscriptions AS (
    SELECT
        gender,
        level, 
        COUNT(DISTINCT userId) AS user_count
    FROM "datalake"."analytics_source"."src_auth_events"
    WHERE gender IS NOT NULL AND level IS NOT NULL
    GROUP BY gender, level
)

SELECT
    gender,
    level,
    user_count
FROM user_subscriptions
  
[0m10:32:43.014136 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m10:32:43.066258 [debug] [Thread-1 (]: SQL status: SUCCESS in 0.0 seconds
[0m10:32:43.068258 [debug] [Thread-1 (]: On model.my_dbt_trino_project.stg_user_level_by_gender: ROLLBACK
[0m10:32:43.069403 [debug] [Thread-1 (]: On model.my_dbt_trino_project.stg_user_level_by_gender: Close
[0m10:32:43.069403 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '9c73b342-150c-40c1-97df-70c1641d00f9', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x00000268E69CFD50>]}
[0m10:32:43.070409 [info ] [Thread-1 (]: 4 of 15 OK created sql view model analytics_stage.stg_user_level_by_gender ..... [[32mSUCCESS[0m in 0.08s]
[0m10:32:43.071598 [debug] [Thread-1 (]: Finished running node model.my_dbt_trino_project.stg_user_level_by_gender
[0m10:32:43.071598 [debug] [Thread-1 (]: Began running node model.my_dbt_trino_project.stg_streams_hourly
[0m10:32:43.072603 [info ] [Thread-1 (]: 5 of 15 START sql table model analytics_stage.stg_streams_hourly ............... [RUN]
[0m10:32:43.073609 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.my_dbt_trino_project.stg_user_level_by_gender, now model.my_dbt_trino_project.stg_streams_hourly)
[0m10:32:43.073609 [debug] [Thread-1 (]: Began compiling node model.my_dbt_trino_project.stg_streams_hourly
[0m10:32:43.076610 [debug] [Thread-1 (]: Writing injected SQL for node "model.my_dbt_trino_project.stg_streams_hourly"
[0m10:32:43.077608 [debug] [Thread-1 (]: Began executing node model.my_dbt_trino_project.stg_streams_hourly
[0m10:32:43.080611 [debug] [Thread-1 (]: Writing runtime sql for node "model.my_dbt_trino_project.stg_streams_hourly"
[0m10:32:43.081610 [debug] [Thread-1 (]: Using trino connection "model.my_dbt_trino_project.stg_streams_hourly"
[0m10:32:43.081610 [debug] [Thread-1 (]: On model.my_dbt_trino_project.stg_streams_hourly: /* {"app": "dbt", "dbt_version": "1.8.2", "profile_name": "my_dbt_trino_project", "target_name": "dev", "node_id": "model.my_dbt_trino_project.stg_streams_hourly"} */

  
    

    create table "datalake"."analytics_stage"."stg_streams_hourly__dbt_tmp"
      
      
    as (
      

SELECT
    DATE_FORMAT(FROM_UNIXTIME(ts), '%Y-%m-%d') AS stream_date, 
    DATE_FORMAT(FROM_UNIXTIME(ts), '%H') AS stream_hour,
    COUNT(*) AS total_streams
FROM "datalake"."analytics_source"."src_listen_events"
GROUP BY
    DATE_FORMAT(FROM_UNIXTIME(ts), '%Y-%m-%d'),
    DATE_FORMAT(FROM_UNIXTIME(ts), '%H')
    )
[0m10:32:43.082611 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m10:32:43.291989 [debug] [Thread-1 (]: SQL status: SUCCESS in 0.0 seconds
[0m10:32:43.294077 [debug] [Thread-1 (]: Using trino connection "model.my_dbt_trino_project.stg_streams_hourly"
[0m10:32:43.295081 [debug] [Thread-1 (]: On model.my_dbt_trino_project.stg_streams_hourly: /* {"app": "dbt", "dbt_version": "1.8.2", "profile_name": "my_dbt_trino_project", "target_name": "dev", "node_id": "model.my_dbt_trino_project.stg_streams_hourly"} */
alter table "datalake"."analytics_stage"."stg_streams_hourly" rename to "datalake"."analytics_stage"."stg_streams_hourly__dbt_backup"
[0m10:32:43.381076 [debug] [Thread-1 (]: SQL status: SUCCESS in 0.0 seconds
[0m10:32:43.384075 [debug] [Thread-1 (]: Using trino connection "model.my_dbt_trino_project.stg_streams_hourly"
[0m10:32:43.384075 [debug] [Thread-1 (]: On model.my_dbt_trino_project.stg_streams_hourly: /* {"app": "dbt", "dbt_version": "1.8.2", "profile_name": "my_dbt_trino_project", "target_name": "dev", "node_id": "model.my_dbt_trino_project.stg_streams_hourly"} */
alter table "datalake"."analytics_stage"."stg_streams_hourly__dbt_tmp" rename to "datalake"."analytics_stage"."stg_streams_hourly"
[0m10:32:43.477955 [debug] [Thread-1 (]: SQL status: SUCCESS in 0.0 seconds
[0m10:32:43.479963 [debug] [Thread-1 (]: Applying DROP to: "datalake"."analytics_stage"."stg_streams_hourly__dbt_backup"
[0m10:32:43.480962 [debug] [Thread-1 (]: Using trino connection "model.my_dbt_trino_project.stg_streams_hourly"
[0m10:32:43.480962 [debug] [Thread-1 (]: On model.my_dbt_trino_project.stg_streams_hourly: /* {"app": "dbt", "dbt_version": "1.8.2", "profile_name": "my_dbt_trino_project", "target_name": "dev", "node_id": "model.my_dbt_trino_project.stg_streams_hourly"} */

    drop table if exists "datalake"."analytics_stage"."stg_streams_hourly__dbt_backup"
[0m10:32:43.590502 [debug] [Thread-1 (]: SQL status: SUCCESS in 0.0 seconds
[0m10:32:43.592538 [debug] [Thread-1 (]: On model.my_dbt_trino_project.stg_streams_hourly: ROLLBACK
[0m10:32:43.592538 [debug] [Thread-1 (]: On model.my_dbt_trino_project.stg_streams_hourly: Close
[0m10:32:43.593687 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '9c73b342-150c-40c1-97df-70c1641d00f9', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x00000268E97000D0>]}
[0m10:32:43.593687 [info ] [Thread-1 (]: 5 of 15 OK created sql table model analytics_stage.stg_streams_hourly .......... [[32mSUCCESS[0m in 0.52s]
[0m10:32:43.594862 [debug] [Thread-1 (]: Finished running node model.my_dbt_trino_project.stg_streams_hourly
[0m10:32:43.594862 [debug] [Thread-1 (]: Began running node model.my_dbt_trino_project.stg_top_songs_artists
[0m10:32:43.595891 [info ] [Thread-1 (]: 6 of 15 START sql view model analytics_stage.stg_top_songs_artists ............. [RUN]
[0m10:32:43.596886 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.my_dbt_trino_project.stg_streams_hourly, now model.my_dbt_trino_project.stg_top_songs_artists)
[0m10:32:43.596886 [debug] [Thread-1 (]: Began compiling node model.my_dbt_trino_project.stg_top_songs_artists
[0m10:32:43.599279 [debug] [Thread-1 (]: Writing injected SQL for node "model.my_dbt_trino_project.stg_top_songs_artists"
[0m10:32:43.600277 [debug] [Thread-1 (]: Began executing node model.my_dbt_trino_project.stg_top_songs_artists
[0m10:32:43.602276 [debug] [Thread-1 (]: Writing runtime sql for node "model.my_dbt_trino_project.stg_top_songs_artists"
[0m10:32:43.603276 [debug] [Thread-1 (]: Using trino connection "model.my_dbt_trino_project.stg_top_songs_artists"
[0m10:32:43.603276 [debug] [Thread-1 (]: On model.my_dbt_trino_project.stg_top_songs_artists: /* {"app": "dbt", "dbt_version": "1.8.2", "profile_name": "my_dbt_trino_project", "target_name": "dev", "node_id": "model.my_dbt_trino_project.stg_top_songs_artists"} */

  create or replace view
    "datalake"."analytics_stage"."stg_top_songs_artists"
  security definer
  as
    

WITH song_plays AS (
    SELECT
        artist,
        song,
        COUNT(*) AS play_count
    FROM "datalake"."analytics_source"."src_listen_events"
    GROUP BY artist, song
)

SELECT
    artist,
    song,
    play_count
FROM song_plays
ORDER BY play_count DESC
  
[0m10:32:43.604276 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m10:32:43.669951 [debug] [Thread-1 (]: SQL status: SUCCESS in 0.0 seconds
[0m10:32:43.671949 [debug] [Thread-1 (]: On model.my_dbt_trino_project.stg_top_songs_artists: ROLLBACK
[0m10:32:43.671949 [debug] [Thread-1 (]: On model.my_dbt_trino_project.stg_top_songs_artists: Close
[0m10:32:43.672953 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '9c73b342-150c-40c1-97df-70c1641d00f9', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x00000268E995B750>]}
[0m10:32:43.674352 [info ] [Thread-1 (]: 6 of 15 OK created sql view model analytics_stage.stg_top_songs_artists ........ [[32mSUCCESS[0m in 0.08s]
[0m10:32:43.674352 [debug] [Thread-1 (]: Finished running node model.my_dbt_trino_project.stg_top_songs_artists
[0m10:32:43.675757 [debug] [Thread-1 (]: Began running node model.my_dbt_trino_project.stg_unique_users
[0m10:32:43.675757 [info ] [Thread-1 (]: 7 of 15 START sql view model analytics_stage.stg_unique_users .................. [RUN]
[0m10:32:43.676763 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.my_dbt_trino_project.stg_top_songs_artists, now model.my_dbt_trino_project.stg_unique_users)
[0m10:32:43.676763 [debug] [Thread-1 (]: Began compiling node model.my_dbt_trino_project.stg_unique_users
[0m10:32:43.681762 [debug] [Thread-1 (]: Writing injected SQL for node "model.my_dbt_trino_project.stg_unique_users"
[0m10:32:43.681762 [debug] [Thread-1 (]: Began executing node model.my_dbt_trino_project.stg_unique_users
[0m10:32:43.684763 [debug] [Thread-1 (]: Writing runtime sql for node "model.my_dbt_trino_project.stg_unique_users"
[0m10:32:43.685766 [debug] [Thread-1 (]: Using trino connection "model.my_dbt_trino_project.stg_unique_users"
[0m10:32:43.685766 [debug] [Thread-1 (]: On model.my_dbt_trino_project.stg_unique_users: /* {"app": "dbt", "dbt_version": "1.8.2", "profile_name": "my_dbt_trino_project", "target_name": "dev", "node_id": "model.my_dbt_trino_project.stg_unique_users"} */

  create or replace view
    "datalake"."analytics_stage"."stg_unique_users"
  security definer
  as
    

SELECT
    COUNT(DISTINCT userid) AS total_unique_users
FROM "datalake"."analytics_source"."src_listen_events"
WHERE userid IS NOT NULL
  
[0m10:32:43.685766 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m10:32:43.748092 [debug] [Thread-1 (]: SQL status: SUCCESS in 0.0 seconds
[0m10:32:43.750093 [debug] [Thread-1 (]: On model.my_dbt_trino_project.stg_unique_users: ROLLBACK
[0m10:32:43.750599 [debug] [Thread-1 (]: On model.my_dbt_trino_project.stg_unique_users: Close
[0m10:32:43.751611 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '9c73b342-150c-40c1-97df-70c1641d00f9', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x00000268EADF0D50>]}
[0m10:32:43.751611 [info ] [Thread-1 (]: 7 of 15 OK created sql view model analytics_stage.stg_unique_users ............. [[32mSUCCESS[0m in 0.07s]
[0m10:32:43.752607 [debug] [Thread-1 (]: Finished running node model.my_dbt_trino_project.stg_unique_users
[0m10:32:43.753606 [debug] [Thread-1 (]: Began running node model.my_dbt_trino_project.stg_user_activity_per_country
[0m10:32:43.753606 [info ] [Thread-1 (]: 8 of 15 START sql view model analytics_stage.stg_user_activity_per_country ..... [RUN]
[0m10:32:43.754605 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.my_dbt_trino_project.stg_unique_users, now model.my_dbt_trino_project.stg_user_activity_per_country)
[0m10:32:43.754605 [debug] [Thread-1 (]: Began compiling node model.my_dbt_trino_project.stg_user_activity_per_country
[0m10:32:43.758606 [debug] [Thread-1 (]: Writing injected SQL for node "model.my_dbt_trino_project.stg_user_activity_per_country"
[0m10:32:43.758606 [debug] [Thread-1 (]: Began executing node model.my_dbt_trino_project.stg_user_activity_per_country
[0m10:32:43.761604 [debug] [Thread-1 (]: Writing runtime sql for node "model.my_dbt_trino_project.stg_user_activity_per_country"
[0m10:32:43.763604 [debug] [Thread-1 (]: Using trino connection "model.my_dbt_trino_project.stg_user_activity_per_country"
[0m10:32:43.763604 [debug] [Thread-1 (]: On model.my_dbt_trino_project.stg_user_activity_per_country: /* {"app": "dbt", "dbt_version": "1.8.2", "profile_name": "my_dbt_trino_project", "target_name": "dev", "node_id": "model.my_dbt_trino_project.stg_user_activity_per_country"} */

  create or replace view
    "datalake"."analytics_stage"."stg_user_activity_per_country"
  security definer
  as
    

WITH combined_activities AS (
  SELECT
    country,
    'listen_event' AS event_type,
    ts,
    userid
  FROM "datalake"."analytics_source"."src_listen_events"
  WHERE country IS NOT NULL
  UNION ALL
  SELECT
    'Unknown' AS country,
    'auth_event' AS event_type, 
    ts,
    userid
  FROM "datalake"."analytics_source"."src_auth_events"
  UNION ALL
  SELECT
    'Unknown' AS country, 
    'page_view_event' AS event_type,
    ts,
    userid
  FROM "datalake"."analytics_source"."src_page_view_events"
)

SELECT
  country,
  COUNT(*) AS activity_count
FROM combined_activities
GROUP BY country
  
[0m10:32:43.763604 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m10:32:43.834709 [debug] [Thread-1 (]: SQL status: SUCCESS in 0.0 seconds
[0m10:32:43.836708 [debug] [Thread-1 (]: On model.my_dbt_trino_project.stg_user_activity_per_country: ROLLBACK
[0m10:32:43.836708 [debug] [Thread-1 (]: On model.my_dbt_trino_project.stg_user_activity_per_country: Close
[0m10:32:43.838165 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '9c73b342-150c-40c1-97df-70c1641d00f9', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x00000268EAE68D50>]}
[0m10:32:43.838675 [info ] [Thread-1 (]: 8 of 15 OK created sql view model analytics_stage.stg_user_activity_per_country  [[32mSUCCESS[0m in 0.08s]
[0m10:32:43.838675 [debug] [Thread-1 (]: Finished running node model.my_dbt_trino_project.stg_user_activity_per_country
[0m10:32:43.839685 [debug] [Thread-1 (]: Began running node model.my_dbt_trino_project.stg_user_activity_per_location
[0m10:32:43.839685 [info ] [Thread-1 (]: 9 of 15 START sql view model analytics_stage.stg_user_activity_per_location .... [RUN]
[0m10:32:43.840683 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.my_dbt_trino_project.stg_user_activity_per_country, now model.my_dbt_trino_project.stg_user_activity_per_location)
[0m10:32:43.840683 [debug] [Thread-1 (]: Began compiling node model.my_dbt_trino_project.stg_user_activity_per_location
[0m10:32:43.844189 [debug] [Thread-1 (]: Writing injected SQL for node "model.my_dbt_trino_project.stg_user_activity_per_location"
[0m10:32:43.844189 [debug] [Thread-1 (]: Began executing node model.my_dbt_trino_project.stg_user_activity_per_location
[0m10:32:43.847318 [debug] [Thread-1 (]: Writing runtime sql for node "model.my_dbt_trino_project.stg_user_activity_per_location"
[0m10:32:43.848320 [debug] [Thread-1 (]: Using trino connection "model.my_dbt_trino_project.stg_user_activity_per_location"
[0m10:32:43.849731 [debug] [Thread-1 (]: On model.my_dbt_trino_project.stg_user_activity_per_location: /* {"app": "dbt", "dbt_version": "1.8.2", "profile_name": "my_dbt_trino_project", "target_name": "dev", "node_id": "model.my_dbt_trino_project.stg_user_activity_per_location"} */

  create or replace view
    "datalake"."analytics_stage"."stg_user_activity_per_location"
  security definer
  as
    

WITH combined_activities AS (
  SELECT
    city,
    state,
    'auth_event' AS event_type,
    ts,
    userid
 FROM "datalake"."analytics_source"."src_auth_events"
  UNION ALL
  SELECT
    city,
    state,
    'listen_event' AS event_type,
    ts,
    userid
  FROM "datalake"."analytics_source"."src_listen_events"
  UNION ALL
  SELECT
    city,
    state,
    'page_view_event' AS event_type,
    ts,
    userid
  FROM "datalake"."analytics_source"."src_page_view_events"
)

SELECT
  state,
  city,
  COUNT(*) AS activity_count
FROM combined_activities
GROUP BY state, city
  
[0m10:32:43.850236 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m10:32:43.918584 [debug] [Thread-1 (]: SQL status: SUCCESS in 0.0 seconds
[0m10:32:43.920679 [debug] [Thread-1 (]: On model.my_dbt_trino_project.stg_user_activity_per_location: ROLLBACK
[0m10:32:43.920679 [debug] [Thread-1 (]: On model.my_dbt_trino_project.stg_user_activity_per_location: Close
[0m10:32:43.921207 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '9c73b342-150c-40c1-97df-70c1641d00f9', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x00000268E9657690>]}
[0m10:32:43.921736 [info ] [Thread-1 (]: 9 of 15 OK created sql view model analytics_stage.stg_user_activity_per_location  [[32mSUCCESS[0m in 0.08s]
[0m10:32:43.922801 [debug] [Thread-1 (]: Finished running node model.my_dbt_trino_project.stg_user_activity_per_location
[0m10:32:43.922858 [debug] [Thread-1 (]: Began running node model.my_dbt_trino_project.mart_user_level_by_gender
[0m10:32:43.923364 [info ] [Thread-1 (]: 10 of 15 START sql table model analytics.mart_user_level_by_gender ............. [RUN]
[0m10:32:43.923896 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.my_dbt_trino_project.stg_user_activity_per_location, now model.my_dbt_trino_project.mart_user_level_by_gender)
[0m10:32:43.924427 [debug] [Thread-1 (]: Began compiling node model.my_dbt_trino_project.mart_user_level_by_gender
[0m10:32:43.927074 [debug] [Thread-1 (]: Writing injected SQL for node "model.my_dbt_trino_project.mart_user_level_by_gender"
[0m10:32:43.927602 [debug] [Thread-1 (]: Began executing node model.my_dbt_trino_project.mart_user_level_by_gender
[0m10:32:43.930236 [debug] [Thread-1 (]: Writing runtime sql for node "model.my_dbt_trino_project.mart_user_level_by_gender"
[0m10:32:43.931243 [debug] [Thread-1 (]: Using trino connection "model.my_dbt_trino_project.mart_user_level_by_gender"
[0m10:32:43.932244 [debug] [Thread-1 (]: On model.my_dbt_trino_project.mart_user_level_by_gender: /* {"app": "dbt", "dbt_version": "1.8.2", "profile_name": "my_dbt_trino_project", "target_name": "dev", "node_id": "model.my_dbt_trino_project.mart_user_level_by_gender"} */

  
    

    create table "datalake"."analytics"."mart_user_level_by_gender__dbt_tmp"
      
      
    as (
      

SELECT
    gender,
    level,
    SUM(user_count) AS total_users,
    ROUND(SUM(user_count) * 100.0 / SUM(SUM(user_count)) OVER (), 2) AS percentage_of_total_users
FROM "datalake"."analytics_stage"."stg_user_level_by_gender"
GROUP BY gender, level
    )
[0m10:32:43.932244 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m10:32:44.170111 [debug] [Thread-1 (]: SQL status: SUCCESS in 0.0 seconds
[0m10:32:44.173223 [debug] [Thread-1 (]: Using trino connection "model.my_dbt_trino_project.mart_user_level_by_gender"
[0m10:32:44.173223 [debug] [Thread-1 (]: On model.my_dbt_trino_project.mart_user_level_by_gender: /* {"app": "dbt", "dbt_version": "1.8.2", "profile_name": "my_dbt_trino_project", "target_name": "dev", "node_id": "model.my_dbt_trino_project.mart_user_level_by_gender"} */
alter table "datalake"."analytics"."mart_user_level_by_gender" rename to "datalake"."analytics"."mart_user_level_by_gender__dbt_backup"
[0m10:32:44.256981 [debug] [Thread-1 (]: SQL status: SUCCESS in 0.0 seconds
[0m10:32:44.261979 [debug] [Thread-1 (]: Using trino connection "model.my_dbt_trino_project.mart_user_level_by_gender"
[0m10:32:44.261979 [debug] [Thread-1 (]: On model.my_dbt_trino_project.mart_user_level_by_gender: /* {"app": "dbt", "dbt_version": "1.8.2", "profile_name": "my_dbt_trino_project", "target_name": "dev", "node_id": "model.my_dbt_trino_project.mart_user_level_by_gender"} */
alter table "datalake"."analytics"."mart_user_level_by_gender__dbt_tmp" rename to "datalake"."analytics"."mart_user_level_by_gender"
[0m10:32:44.338754 [debug] [Thread-1 (]: SQL status: SUCCESS in 0.0 seconds
[0m10:32:44.341744 [debug] [Thread-1 (]: Applying DROP to: "datalake"."analytics"."mart_user_level_by_gender__dbt_backup"
[0m10:32:44.342744 [debug] [Thread-1 (]: Using trino connection "model.my_dbt_trino_project.mart_user_level_by_gender"
[0m10:32:44.342744 [debug] [Thread-1 (]: On model.my_dbt_trino_project.mart_user_level_by_gender: /* {"app": "dbt", "dbt_version": "1.8.2", "profile_name": "my_dbt_trino_project", "target_name": "dev", "node_id": "model.my_dbt_trino_project.mart_user_level_by_gender"} */

    drop table if exists "datalake"."analytics"."mart_user_level_by_gender__dbt_backup"
[0m10:32:44.457187 [debug] [Thread-1 (]: SQL status: SUCCESS in 0.0 seconds
[0m10:32:44.460193 [debug] [Thread-1 (]: On model.my_dbt_trino_project.mart_user_level_by_gender: ROLLBACK
[0m10:32:44.460193 [debug] [Thread-1 (]: On model.my_dbt_trino_project.mart_user_level_by_gender: Close
[0m10:32:44.461193 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '9c73b342-150c-40c1-97df-70c1641d00f9', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x00000268EAF35D90>]}
[0m10:32:44.463234 [info ] [Thread-1 (]: 10 of 15 OK created sql table model analytics.mart_user_level_by_gender ........ [[32mSUCCESS[0m in 0.54s]
[0m10:32:44.464195 [debug] [Thread-1 (]: Finished running node model.my_dbt_trino_project.mart_user_level_by_gender
[0m10:32:44.464195 [debug] [Thread-1 (]: Began running node model.my_dbt_trino_project.mart_hourly_stream_evolution
[0m10:32:44.465195 [info ] [Thread-1 (]: 11 of 15 START sql table model analytics.mart_hourly_stream_evolution .......... [RUN]
[0m10:32:44.466195 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.my_dbt_trino_project.mart_user_level_by_gender, now model.my_dbt_trino_project.mart_hourly_stream_evolution)
[0m10:32:44.466195 [debug] [Thread-1 (]: Began compiling node model.my_dbt_trino_project.mart_hourly_stream_evolution
[0m10:32:44.469194 [debug] [Thread-1 (]: Writing injected SQL for node "model.my_dbt_trino_project.mart_hourly_stream_evolution"
[0m10:32:44.469194 [debug] [Thread-1 (]: Began executing node model.my_dbt_trino_project.mart_hourly_stream_evolution
[0m10:32:44.472193 [debug] [Thread-1 (]: Writing runtime sql for node "model.my_dbt_trino_project.mart_hourly_stream_evolution"
[0m10:32:44.474194 [debug] [Thread-1 (]: Using trino connection "model.my_dbt_trino_project.mart_hourly_stream_evolution"
[0m10:32:44.474194 [debug] [Thread-1 (]: On model.my_dbt_trino_project.mart_hourly_stream_evolution: /* {"app": "dbt", "dbt_version": "1.8.2", "profile_name": "my_dbt_trino_project", "target_name": "dev", "node_id": "model.my_dbt_trino_project.mart_hourly_stream_evolution"} */

  
    

    create table "datalake"."analytics"."mart_hourly_stream_evolution__dbt_tmp"
      
      
    as (
      

SELECT
    stream_date,
    stream_hour,
    total_streams,
    SUM(total_streams) OVER (PARTITION BY stream_date ORDER BY stream_hour) AS cumulative_streams
FROM "datalake"."analytics_stage"."stg_streams_hourly"
ORDER BY
    stream_date,
    stream_hour
    )
[0m10:32:44.474194 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m10:32:44.668437 [debug] [Thread-1 (]: SQL status: SUCCESS in 0.0 seconds
[0m10:32:44.670439 [debug] [Thread-1 (]: Using trino connection "model.my_dbt_trino_project.mart_hourly_stream_evolution"
[0m10:32:44.671435 [debug] [Thread-1 (]: On model.my_dbt_trino_project.mart_hourly_stream_evolution: /* {"app": "dbt", "dbt_version": "1.8.2", "profile_name": "my_dbt_trino_project", "target_name": "dev", "node_id": "model.my_dbt_trino_project.mart_hourly_stream_evolution"} */
alter table "datalake"."analytics"."mart_hourly_stream_evolution" rename to "datalake"."analytics"."mart_hourly_stream_evolution__dbt_backup"
[0m10:32:44.752379 [debug] [Thread-1 (]: SQL status: SUCCESS in 0.0 seconds
[0m10:32:44.756385 [debug] [Thread-1 (]: Using trino connection "model.my_dbt_trino_project.mart_hourly_stream_evolution"
[0m10:32:44.756385 [debug] [Thread-1 (]: On model.my_dbt_trino_project.mart_hourly_stream_evolution: /* {"app": "dbt", "dbt_version": "1.8.2", "profile_name": "my_dbt_trino_project", "target_name": "dev", "node_id": "model.my_dbt_trino_project.mart_hourly_stream_evolution"} */
alter table "datalake"."analytics"."mart_hourly_stream_evolution__dbt_tmp" rename to "datalake"."analytics"."mart_hourly_stream_evolution"
[0m10:32:44.843520 [debug] [Thread-1 (]: SQL status: SUCCESS in 0.0 seconds
[0m10:32:44.846528 [debug] [Thread-1 (]: Applying DROP to: "datalake"."analytics"."mart_hourly_stream_evolution__dbt_backup"
[0m10:32:44.847689 [debug] [Thread-1 (]: Using trino connection "model.my_dbt_trino_project.mart_hourly_stream_evolution"
[0m10:32:44.847689 [debug] [Thread-1 (]: On model.my_dbt_trino_project.mart_hourly_stream_evolution: /* {"app": "dbt", "dbt_version": "1.8.2", "profile_name": "my_dbt_trino_project", "target_name": "dev", "node_id": "model.my_dbt_trino_project.mart_hourly_stream_evolution"} */

    drop table if exists "datalake"."analytics"."mart_hourly_stream_evolution__dbt_backup"
[0m10:32:44.957103 [debug] [Thread-1 (]: SQL status: SUCCESS in 0.0 seconds
[0m10:32:44.959106 [debug] [Thread-1 (]: On model.my_dbt_trino_project.mart_hourly_stream_evolution: ROLLBACK
[0m10:32:44.959106 [debug] [Thread-1 (]: On model.my_dbt_trino_project.mart_hourly_stream_evolution: Close
[0m10:32:44.960105 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '9c73b342-150c-40c1-97df-70c1641d00f9', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x00000268E969A710>]}
[0m10:32:44.960105 [info ] [Thread-1 (]: 11 of 15 OK created sql table model analytics.mart_hourly_stream_evolution ..... [[32mSUCCESS[0m in 0.49s]
[0m10:32:44.960105 [debug] [Thread-1 (]: Finished running node model.my_dbt_trino_project.mart_hourly_stream_evolution
[0m10:32:44.961611 [debug] [Thread-1 (]: Began running node model.my_dbt_trino_project.mart_top_songs_artists
[0m10:32:44.961611 [info ] [Thread-1 (]: 12 of 15 START sql table model analytics.mart_top_songs_artists ................ [RUN]
[0m10:32:44.962618 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.my_dbt_trino_project.mart_hourly_stream_evolution, now model.my_dbt_trino_project.mart_top_songs_artists)
[0m10:32:44.962618 [debug] [Thread-1 (]: Began compiling node model.my_dbt_trino_project.mart_top_songs_artists
[0m10:32:44.965621 [debug] [Thread-1 (]: Writing injected SQL for node "model.my_dbt_trino_project.mart_top_songs_artists"
[0m10:32:44.966620 [debug] [Thread-1 (]: Began executing node model.my_dbt_trino_project.mart_top_songs_artists
[0m10:32:44.968402 [debug] [Thread-1 (]: Writing runtime sql for node "model.my_dbt_trino_project.mart_top_songs_artists"
[0m10:32:44.970401 [debug] [Thread-1 (]: Using trino connection "model.my_dbt_trino_project.mart_top_songs_artists"
[0m10:32:44.970401 [debug] [Thread-1 (]: On model.my_dbt_trino_project.mart_top_songs_artists: /* {"app": "dbt", "dbt_version": "1.8.2", "profile_name": "my_dbt_trino_project", "target_name": "dev", "node_id": "model.my_dbt_trino_project.mart_top_songs_artists"} */

  
    

    create table "datalake"."analytics"."mart_top_songs_artists__dbt_tmp"
      
      
    as (
      

WITH top_songs AS (
    SELECT
        artist,
        song,
        play_count
    FROM "datalake"."analytics_stage"."stg_top_songs_artists"
)

SELECT
    artist,
    song,
    play_count
FROM top_songs
    )
[0m10:32:44.970401 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m10:32:45.204642 [debug] [Thread-1 (]: SQL status: SUCCESS in 0.0 seconds
[0m10:32:45.208588 [debug] [Thread-1 (]: Using trino connection "model.my_dbt_trino_project.mart_top_songs_artists"
[0m10:32:45.209586 [debug] [Thread-1 (]: On model.my_dbt_trino_project.mart_top_songs_artists: /* {"app": "dbt", "dbt_version": "1.8.2", "profile_name": "my_dbt_trino_project", "target_name": "dev", "node_id": "model.my_dbt_trino_project.mart_top_songs_artists"} */
alter table "datalake"."analytics"."mart_top_songs_artists" rename to "datalake"."analytics"."mart_top_songs_artists__dbt_backup"
[0m10:32:45.289048 [debug] [Thread-1 (]: SQL status: SUCCESS in 0.0 seconds
[0m10:32:45.292048 [debug] [Thread-1 (]: Using trino connection "model.my_dbt_trino_project.mart_top_songs_artists"
[0m10:32:45.292048 [debug] [Thread-1 (]: On model.my_dbt_trino_project.mart_top_songs_artists: /* {"app": "dbt", "dbt_version": "1.8.2", "profile_name": "my_dbt_trino_project", "target_name": "dev", "node_id": "model.my_dbt_trino_project.mart_top_songs_artists"} */
alter table "datalake"."analytics"."mart_top_songs_artists__dbt_tmp" rename to "datalake"."analytics"."mart_top_songs_artists"
[0m10:32:45.370103 [debug] [Thread-1 (]: SQL status: SUCCESS in 0.0 seconds
[0m10:32:45.373101 [debug] [Thread-1 (]: Applying DROP to: "datalake"."analytics"."mart_top_songs_artists__dbt_backup"
[0m10:32:45.374099 [debug] [Thread-1 (]: Using trino connection "model.my_dbt_trino_project.mart_top_songs_artists"
[0m10:32:45.374099 [debug] [Thread-1 (]: On model.my_dbt_trino_project.mart_top_songs_artists: /* {"app": "dbt", "dbt_version": "1.8.2", "profile_name": "my_dbt_trino_project", "target_name": "dev", "node_id": "model.my_dbt_trino_project.mart_top_songs_artists"} */

    drop table if exists "datalake"."analytics"."mart_top_songs_artists__dbt_backup"
[0m10:32:45.496794 [debug] [Thread-1 (]: SQL status: SUCCESS in 0.0 seconds
[0m10:32:45.497802 [debug] [Thread-1 (]: On model.my_dbt_trino_project.mart_top_songs_artists: ROLLBACK
[0m10:32:45.498801 [debug] [Thread-1 (]: On model.my_dbt_trino_project.mart_top_songs_artists: Close
[0m10:32:45.498801 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '9c73b342-150c-40c1-97df-70c1641d00f9', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x00000268EAF113D0>]}
[0m10:32:45.499802 [info ] [Thread-1 (]: 12 of 15 OK created sql table model analytics.mart_top_songs_artists ........... [[32mSUCCESS[0m in 0.54s]
[0m10:32:45.500803 [debug] [Thread-1 (]: Finished running node model.my_dbt_trino_project.mart_top_songs_artists
[0m10:32:45.500803 [debug] [Thread-1 (]: Began running node model.my_dbt_trino_project.mart_total_unique_users
[0m10:32:45.500803 [info ] [Thread-1 (]: 13 of 15 START sql table model analytics.mart_total_unique_users ............... [RUN]
[0m10:32:45.501802 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.my_dbt_trino_project.mart_top_songs_artists, now model.my_dbt_trino_project.mart_total_unique_users)
[0m10:32:45.501802 [debug] [Thread-1 (]: Began compiling node model.my_dbt_trino_project.mart_total_unique_users
[0m10:32:45.504801 [debug] [Thread-1 (]: Writing injected SQL for node "model.my_dbt_trino_project.mart_total_unique_users"
[0m10:32:45.504801 [debug] [Thread-1 (]: Began executing node model.my_dbt_trino_project.mart_total_unique_users
[0m10:32:45.507300 [debug] [Thread-1 (]: Writing runtime sql for node "model.my_dbt_trino_project.mart_total_unique_users"
[0m10:32:45.509797 [debug] [Thread-1 (]: Using trino connection "model.my_dbt_trino_project.mart_total_unique_users"
[0m10:32:45.509797 [debug] [Thread-1 (]: On model.my_dbt_trino_project.mart_total_unique_users: /* {"app": "dbt", "dbt_version": "1.8.2", "profile_name": "my_dbt_trino_project", "target_name": "dev", "node_id": "model.my_dbt_trino_project.mart_total_unique_users"} */

  
    

    create table "datalake"."analytics"."mart_total_unique_users__dbt_tmp"
      
      
    as (
      

SELECT
    total_unique_users
FROM "datalake"."analytics_stage"."stg_unique_users"
    )
[0m10:32:45.509797 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m10:32:45.739933 [debug] [Thread-1 (]: SQL status: SUCCESS in 0.0 seconds
[0m10:32:45.742987 [debug] [Thread-1 (]: Using trino connection "model.my_dbt_trino_project.mart_total_unique_users"
[0m10:32:45.742987 [debug] [Thread-1 (]: On model.my_dbt_trino_project.mart_total_unique_users: /* {"app": "dbt", "dbt_version": "1.8.2", "profile_name": "my_dbt_trino_project", "target_name": "dev", "node_id": "model.my_dbt_trino_project.mart_total_unique_users"} */
alter table "datalake"."analytics"."mart_total_unique_users" rename to "datalake"."analytics"."mart_total_unique_users__dbt_backup"
[0m10:32:45.833381 [debug] [Thread-1 (]: SQL status: SUCCESS in 0.0 seconds
[0m10:32:45.836529 [debug] [Thread-1 (]: Using trino connection "model.my_dbt_trino_project.mart_total_unique_users"
[0m10:32:45.837048 [debug] [Thread-1 (]: On model.my_dbt_trino_project.mart_total_unique_users: /* {"app": "dbt", "dbt_version": "1.8.2", "profile_name": "my_dbt_trino_project", "target_name": "dev", "node_id": "model.my_dbt_trino_project.mart_total_unique_users"} */
alter table "datalake"."analytics"."mart_total_unique_users__dbt_tmp" rename to "datalake"."analytics"."mart_total_unique_users"
[0m10:32:45.919521 [debug] [Thread-1 (]: SQL status: SUCCESS in 0.0 seconds
[0m10:32:45.922221 [debug] [Thread-1 (]: Applying DROP to: "datalake"."analytics"."mart_total_unique_users__dbt_backup"
[0m10:32:45.923324 [debug] [Thread-1 (]: Using trino connection "model.my_dbt_trino_project.mart_total_unique_users"
[0m10:32:45.923324 [debug] [Thread-1 (]: On model.my_dbt_trino_project.mart_total_unique_users: /* {"app": "dbt", "dbt_version": "1.8.2", "profile_name": "my_dbt_trino_project", "target_name": "dev", "node_id": "model.my_dbt_trino_project.mart_total_unique_users"} */

    drop table if exists "datalake"."analytics"."mart_total_unique_users__dbt_backup"
[0m10:32:46.036352 [debug] [Thread-1 (]: SQL status: SUCCESS in 0.0 seconds
[0m10:32:46.037929 [debug] [Thread-1 (]: On model.my_dbt_trino_project.mart_total_unique_users: ROLLBACK
[0m10:32:46.038465 [debug] [Thread-1 (]: On model.my_dbt_trino_project.mart_total_unique_users: Close
[0m10:32:46.038981 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '9c73b342-150c-40c1-97df-70c1641d00f9', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x00000268EAF13590>]}
[0m10:32:46.039503 [info ] [Thread-1 (]: 13 of 15 OK created sql table model analytics.mart_total_unique_users .......... [[32mSUCCESS[0m in 0.54s]
[0m10:32:46.040031 [debug] [Thread-1 (]: Finished running node model.my_dbt_trino_project.mart_total_unique_users
[0m10:32:46.040545 [debug] [Thread-1 (]: Began running node model.my_dbt_trino_project.mart_user_activity_per_country
[0m10:32:46.041058 [info ] [Thread-1 (]: 14 of 15 START sql table model analytics.mart_user_activity_per_country ........ [RUN]
[0m10:32:46.041572 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.my_dbt_trino_project.mart_total_unique_users, now model.my_dbt_trino_project.mart_user_activity_per_country)
[0m10:32:46.042090 [debug] [Thread-1 (]: Began compiling node model.my_dbt_trino_project.mart_user_activity_per_country
[0m10:32:46.044679 [debug] [Thread-1 (]: Writing injected SQL for node "model.my_dbt_trino_project.mart_user_activity_per_country"
[0m10:32:46.045197 [debug] [Thread-1 (]: Began executing node model.my_dbt_trino_project.mart_user_activity_per_country
[0m10:32:46.049357 [debug] [Thread-1 (]: Writing runtime sql for node "model.my_dbt_trino_project.mart_user_activity_per_country"
[0m10:32:46.052869 [debug] [Thread-1 (]: Using trino connection "model.my_dbt_trino_project.mart_user_activity_per_country"
[0m10:32:46.052869 [debug] [Thread-1 (]: On model.my_dbt_trino_project.mart_user_activity_per_country: /* {"app": "dbt", "dbt_version": "1.8.2", "profile_name": "my_dbt_trino_project", "target_name": "dev", "node_id": "model.my_dbt_trino_project.mart_user_activity_per_country"} */

  
    

    create table "datalake"."analytics"."mart_user_activity_per_country__dbt_tmp"
      
      
    as (
      

SELECT
  country,
  SUM(activity_count) AS total_activity
FROM "datalake"."analytics_stage"."stg_user_activity_per_country"
GROUP BY country
ORDER BY SUM(activity_count) DESC
    )
[0m10:32:46.053865 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m10:32:46.323954 [debug] [Thread-1 (]: SQL status: SUCCESS in 0.0 seconds
[0m10:32:46.326963 [debug] [Thread-1 (]: Using trino connection "model.my_dbt_trino_project.mart_user_activity_per_country"
[0m10:32:46.327962 [debug] [Thread-1 (]: On model.my_dbt_trino_project.mart_user_activity_per_country: /* {"app": "dbt", "dbt_version": "1.8.2", "profile_name": "my_dbt_trino_project", "target_name": "dev", "node_id": "model.my_dbt_trino_project.mart_user_activity_per_country"} */
alter table "datalake"."analytics"."mart_user_activity_per_country__dbt_tmp" rename to "datalake"."analytics"."mart_user_activity_per_country"
[0m10:32:46.410371 [debug] [Thread-1 (]: SQL status: SUCCESS in 0.0 seconds
[0m10:32:46.413369 [debug] [Thread-1 (]: Applying DROP to: "datalake"."analytics"."mart_user_activity_per_country__dbt_backup"
[0m10:32:46.414373 [debug] [Thread-1 (]: Using trino connection "model.my_dbt_trino_project.mart_user_activity_per_country"
[0m10:32:46.414373 [debug] [Thread-1 (]: On model.my_dbt_trino_project.mart_user_activity_per_country: /* {"app": "dbt", "dbt_version": "1.8.2", "profile_name": "my_dbt_trino_project", "target_name": "dev", "node_id": "model.my_dbt_trino_project.mart_user_activity_per_country"} */

    drop table if exists "datalake"."analytics"."mart_user_activity_per_country__dbt_backup"
[0m10:32:46.484732 [debug] [Thread-1 (]: SQL status: SUCCESS in 0.0 seconds
[0m10:32:46.485732 [debug] [Thread-1 (]: On model.my_dbt_trino_project.mart_user_activity_per_country: ROLLBACK
[0m10:32:46.486735 [debug] [Thread-1 (]: On model.my_dbt_trino_project.mart_user_activity_per_country: Close
[0m10:32:46.486735 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '9c73b342-150c-40c1-97df-70c1641d00f9', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x00000268EAC01B50>]}
[0m10:32:46.487732 [info ] [Thread-1 (]: 14 of 15 OK created sql table model analytics.mart_user_activity_per_country ... [[32mSUCCESS[0m in 0.45s]
[0m10:32:46.488731 [debug] [Thread-1 (]: Finished running node model.my_dbt_trino_project.mart_user_activity_per_country
[0m10:32:46.488731 [debug] [Thread-1 (]: Began running node model.my_dbt_trino_project.mart_user_activity_per_state
[0m10:32:46.489731 [info ] [Thread-1 (]: 15 of 15 START sql table model analytics.mart_user_activity_per_state .......... [RUN]
[0m10:32:46.490731 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.my_dbt_trino_project.mart_user_activity_per_country, now model.my_dbt_trino_project.mart_user_activity_per_state)
[0m10:32:46.490731 [debug] [Thread-1 (]: Began compiling node model.my_dbt_trino_project.mart_user_activity_per_state
[0m10:32:46.492732 [debug] [Thread-1 (]: Writing injected SQL for node "model.my_dbt_trino_project.mart_user_activity_per_state"
[0m10:32:46.493732 [debug] [Thread-1 (]: Began executing node model.my_dbt_trino_project.mart_user_activity_per_state
[0m10:32:46.496733 [debug] [Thread-1 (]: Writing runtime sql for node "model.my_dbt_trino_project.mart_user_activity_per_state"
[0m10:32:46.497730 [debug] [Thread-1 (]: Using trino connection "model.my_dbt_trino_project.mart_user_activity_per_state"
[0m10:32:46.497730 [debug] [Thread-1 (]: On model.my_dbt_trino_project.mart_user_activity_per_state: /* {"app": "dbt", "dbt_version": "1.8.2", "profile_name": "my_dbt_trino_project", "target_name": "dev", "node_id": "model.my_dbt_trino_project.mart_user_activity_per_state"} */

  
    

    create table "datalake"."analytics"."mart_user_activity_per_state__dbt_tmp"
      
      
    as (
      

SELECT
  state,
  city,
  SUM(activity_count) AS total_activity
FROM "datalake"."analytics_stage"."stg_user_activity_per_location"
GROUP BY state, city
ORDER BY state, SUM(activity_count) DESC
    )
[0m10:32:46.498732 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m10:32:46.752187 [debug] [Thread-1 (]: SQL status: SUCCESS in 0.0 seconds
[0m10:32:46.754192 [debug] [Thread-1 (]: Using trino connection "model.my_dbt_trino_project.mart_user_activity_per_state"
[0m10:32:46.755194 [debug] [Thread-1 (]: On model.my_dbt_trino_project.mart_user_activity_per_state: /* {"app": "dbt", "dbt_version": "1.8.2", "profile_name": "my_dbt_trino_project", "target_name": "dev", "node_id": "model.my_dbt_trino_project.mart_user_activity_per_state"} */
alter table "datalake"."analytics"."mart_user_activity_per_state" rename to "datalake"."analytics"."mart_user_activity_per_state__dbt_backup"
[0m10:32:46.849697 [debug] [Thread-1 (]: SQL status: SUCCESS in 0.0 seconds
[0m10:32:46.852210 [debug] [Thread-1 (]: Using trino connection "model.my_dbt_trino_project.mart_user_activity_per_state"
[0m10:32:46.853211 [debug] [Thread-1 (]: On model.my_dbt_trino_project.mart_user_activity_per_state: /* {"app": "dbt", "dbt_version": "1.8.2", "profile_name": "my_dbt_trino_project", "target_name": "dev", "node_id": "model.my_dbt_trino_project.mart_user_activity_per_state"} */
alter table "datalake"."analytics"."mart_user_activity_per_state__dbt_tmp" rename to "datalake"."analytics"."mart_user_activity_per_state"
[0m10:32:46.928629 [debug] [Thread-1 (]: SQL status: SUCCESS in 0.0 seconds
[0m10:32:46.931631 [debug] [Thread-1 (]: Applying DROP to: "datalake"."analytics"."mart_user_activity_per_state__dbt_backup"
[0m10:32:46.931631 [debug] [Thread-1 (]: Using trino connection "model.my_dbt_trino_project.mart_user_activity_per_state"
[0m10:32:46.932633 [debug] [Thread-1 (]: On model.my_dbt_trino_project.mart_user_activity_per_state: /* {"app": "dbt", "dbt_version": "1.8.2", "profile_name": "my_dbt_trino_project", "target_name": "dev", "node_id": "model.my_dbt_trino_project.mart_user_activity_per_state"} */

    drop table if exists "datalake"."analytics"."mart_user_activity_per_state__dbt_backup"
[0m10:32:47.039323 [debug] [Thread-1 (]: SQL status: SUCCESS in 0.0 seconds
[0m10:32:47.041326 [debug] [Thread-1 (]: On model.my_dbt_trino_project.mart_user_activity_per_state: ROLLBACK
[0m10:32:47.041326 [debug] [Thread-1 (]: On model.my_dbt_trino_project.mart_user_activity_per_state: Close
[0m10:32:47.042323 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '9c73b342-150c-40c1-97df-70c1641d00f9', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x00000268E965E350>]}
[0m10:32:47.042323 [info ] [Thread-1 (]: 15 of 15 OK created sql table model analytics.mart_user_activity_per_state ..... [[32mSUCCESS[0m in 0.55s]
[0m10:32:47.043589 [debug] [Thread-1 (]: Finished running node model.my_dbt_trino_project.mart_user_activity_per_state
[0m10:32:47.044594 [debug] [MainThread]: On master: COMMIT
[0m10:32:47.045593 [debug] [MainThread]: Connection 'master' was properly closed.
[0m10:32:47.045593 [debug] [MainThread]: Connection 'list_datalake' was properly closed.
[0m10:32:47.045593 [debug] [MainThread]: Connection 'list_datalake_analytics' was properly closed.
[0m10:32:47.046596 [debug] [MainThread]: Connection 'model.my_dbt_trino_project.mart_user_activity_per_state' was properly closed.
[0m10:32:47.046596 [info ] [MainThread]: 
[0m10:32:47.046596 [info ] [MainThread]: Finished running 8 table models, 2 incremental models, 5 view models in 0 hours 0 minutes and 6.39 seconds (6.39s).
[0m10:32:47.048594 [debug] [MainThread]: Command end result
[0m10:32:47.079455 [info ] [MainThread]: 
[0m10:32:47.079455 [info ] [MainThread]: [32mCompleted successfully[0m
[0m10:32:47.080457 [info ] [MainThread]: 
[0m10:32:47.081455 [info ] [MainThread]: Done. PASS=15 WARN=0 ERROR=0 SKIP=0 TOTAL=15
[0m10:32:47.082454 [debug] [MainThread]: Command `dbt run` succeeded at 10:32:47.082454 after 7.33 seconds
[0m10:32:47.082454 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x00000268E937BFD0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x00000268E937BF10>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x00000268E937BF90>]}
[0m10:32:47.083454 [debug] [MainThread]: Flushing usage events
[0m10:32:54.989433 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x00000203298ED390>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x0000020329923110>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x0000020328DA2A90>]}


============================== 10:32:54.992432 | 8c3c1f7e-72e1-4e25-8026-578bc3a89f51 ==============================
[0m10:32:54.992432 [info ] [MainThread]: Running with dbt=1.8.2
[0m10:32:54.993432 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'indirect_selection': 'eager', 'write_json': 'True', 'log_cache_events': 'False', 'partial_parse': 'True', 'cache_selected_only': 'False', 'profiles_dir': 'C:\\Users\\ASUS\\Desktop\\work\\Iceberg-Dbt-Trino-Hive-modern-open-source-data-stack-main\\dbt', 'debug': 'False', 'warn_error': 'None', 'log_path': 'C:\\Users\\ASUS\\Desktop\\work\\Iceberg-Dbt-Trino-Hive-modern-open-source-data-stack-main\\dbt\\logs', 'fail_fast': 'False', 'version_check': 'True', 'use_colors': 'True', 'use_experimental_parser': 'False', 'no_print': 'None', 'quiet': 'False', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'static_parser': 'True', 'invocation_command': 'dbt run --models source', 'introspect': 'True', 'target_path': 'None', 'log_format': 'default', 'send_anonymous_usage_stats': 'True'}
[0m10:32:55.296151 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': '8c3c1f7e-72e1-4e25-8026-578bc3a89f51', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x0000020329C34D90>]}
[0m10:32:55.330718 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': '8c3c1f7e-72e1-4e25-8026-578bc3a89f51', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x0000020326A65310>]}
[0m10:32:55.330718 [info ] [MainThread]: Registered adapter: trino=1.8.0
[0m10:32:55.341506 [debug] [MainThread]: checksum: f0a141b9de567cb7f131613ba2682f40b3a1c6a157f81c6e5435862eff68f109, vars: {}, profile: , target: , version: 1.8.2
[0m10:32:55.500493 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 0 files changed.
[0m10:32:55.501494 [debug] [MainThread]: Partial parsing enabled, no changes found, skipping parsing
[0m10:32:55.532054 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': '8c3c1f7e-72e1-4e25-8026-578bc3a89f51', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x0000020329F3AA90>]}
[0m10:32:55.601021 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': '8c3c1f7e-72e1-4e25-8026-578bc3a89f51', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x0000020329E23DD0>]}
[0m10:32:55.602022 [info ] [MainThread]: Found 15 models, 7 data tests, 3 sources, 559 macros
[0m10:32:55.602022 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '8c3c1f7e-72e1-4e25-8026-578bc3a89f51', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x00000203298F94D0>]}
[0m10:32:55.604083 [info ] [MainThread]: 
[0m10:32:55.605081 [debug] [MainThread]: Acquiring new trino connection 'master'
[0m10:32:55.609085 [debug] [ThreadPool]: Acquiring new trino connection 'list_datalake'
[0m10:32:55.665914 [debug] [ThreadPool]: Using trino connection "list_datalake"
[0m10:32:55.665914 [debug] [ThreadPool]: On list_datalake: /* {"app": "dbt", "dbt_version": "1.8.2", "profile_name": "my_dbt_trino_project", "target_name": "dev", "connection_name": "list_datalake"} */

    select schema_name
    from "datalake".INFORMATION_SCHEMA.schemata
[0m10:32:55.666915 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m10:32:55.691307 [debug] [ThreadPool]: SQL status: SUCCESS in 0.0 seconds
[0m10:32:55.692307 [debug] [ThreadPool]: On list_datalake: Close
[0m10:32:55.694470 [debug] [ThreadPool]: Acquiring new trino connection 'list_datalake_analytics_source'
[0m10:32:55.704478 [debug] [ThreadPool]: Using trino connection "list_datalake_analytics_source"
[0m10:32:55.705480 [debug] [ThreadPool]: On list_datalake_analytics_source: /* {"app": "dbt", "dbt_version": "1.8.2", "profile_name": "my_dbt_trino_project", "target_name": "dev", "connection_name": "list_datalake_analytics_source"} */
select
      t.table_catalog as database,
      t.table_name as name,
      t.table_schema as schema,
      case when mv.name is not null then 'materialized_view'
           when t.table_type = 'BASE TABLE' then 'table'
           when t.table_type = 'VIEW' then 'view'
           else t.table_type
      end as table_type
    from "datalake".INFORMATION_SCHEMA.tables t
    left join (
            select * from system.metadata.materialized_views
            where catalog_name = 'datalake'
              and schema_name = 'analytics_source') mv
          on mv.catalog_name = t.table_catalog and mv.schema_name = t.table_schema and mv.name = t.table_name
    where t.table_schema = 'analytics_source'
[0m10:32:55.706479 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m10:32:55.756820 [debug] [ThreadPool]: SQL status: SUCCESS in 0.0 seconds
[0m10:32:55.758385 [debug] [ThreadPool]: On list_datalake_analytics_source: ROLLBACK
[0m10:32:55.758385 [debug] [ThreadPool]: On list_datalake_analytics_source: Close
[0m10:32:55.759425 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_datalake_analytics_source, now list_datalake_analytics_stage)
[0m10:32:55.763557 [debug] [ThreadPool]: Using trino connection "list_datalake_analytics_stage"
[0m10:32:55.763557 [debug] [ThreadPool]: On list_datalake_analytics_stage: /* {"app": "dbt", "dbt_version": "1.8.2", "profile_name": "my_dbt_trino_project", "target_name": "dev", "connection_name": "list_datalake_analytics_stage"} */
select
      t.table_catalog as database,
      t.table_name as name,
      t.table_schema as schema,
      case when mv.name is not null then 'materialized_view'
           when t.table_type = 'BASE TABLE' then 'table'
           when t.table_type = 'VIEW' then 'view'
           else t.table_type
      end as table_type
    from "datalake".INFORMATION_SCHEMA.tables t
    left join (
            select * from system.metadata.materialized_views
            where catalog_name = 'datalake'
              and schema_name = 'analytics_stage') mv
          on mv.catalog_name = t.table_catalog and mv.schema_name = t.table_schema and mv.name = t.table_name
    where t.table_schema = 'analytics_stage'
[0m10:32:55.764101 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m10:32:55.817278 [debug] [ThreadPool]: SQL status: SUCCESS in 0.0 seconds
[0m10:32:55.818789 [debug] [ThreadPool]: On list_datalake_analytics_stage: ROLLBACK
[0m10:32:55.819313 [debug] [ThreadPool]: On list_datalake_analytics_stage: Close
[0m10:32:55.820354 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_datalake_analytics_stage, now list_datalake_analytics)
[0m10:32:55.824559 [debug] [ThreadPool]: Using trino connection "list_datalake_analytics"
[0m10:32:55.825100 [debug] [ThreadPool]: On list_datalake_analytics: /* {"app": "dbt", "dbt_version": "1.8.2", "profile_name": "my_dbt_trino_project", "target_name": "dev", "connection_name": "list_datalake_analytics"} */
select
      t.table_catalog as database,
      t.table_name as name,
      t.table_schema as schema,
      case when mv.name is not null then 'materialized_view'
           when t.table_type = 'BASE TABLE' then 'table'
           when t.table_type = 'VIEW' then 'view'
           else t.table_type
      end as table_type
    from "datalake".INFORMATION_SCHEMA.tables t
    left join (
            select * from system.metadata.materialized_views
            where catalog_name = 'datalake'
              and schema_name = 'analytics') mv
          on mv.catalog_name = t.table_catalog and mv.schema_name = t.table_schema and mv.name = t.table_name
    where t.table_schema = 'analytics'
[0m10:32:55.825624 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m10:32:55.867027 [debug] [ThreadPool]: SQL status: SUCCESS in 0.0 seconds
[0m10:32:55.868085 [debug] [ThreadPool]: On list_datalake_analytics: ROLLBACK
[0m10:32:55.868625 [debug] [ThreadPool]: On list_datalake_analytics: Close
[0m10:32:55.870232 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '8c3c1f7e-72e1-4e25-8026-578bc3a89f51', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000002032A35AC10>]}
[0m10:32:55.870769 [debug] [MainThread]: On master: COMMIT
[0m10:32:55.870769 [info ] [MainThread]: Concurrency: 1 threads (target='dev')
[0m10:32:55.871292 [info ] [MainThread]: 
[0m10:32:55.873977 [debug] [Thread-1 (]: Began running node model.my_dbt_trino_project.src_auth_events
[0m10:32:55.874507 [info ] [Thread-1 (]: 1 of 3 START sql table model analytics_source.src_auth_events .................. [RUN]
[0m10:32:55.875041 [debug] [Thread-1 (]: Acquiring new trino connection 'model.my_dbt_trino_project.src_auth_events'
[0m10:32:55.875572 [debug] [Thread-1 (]: Began compiling node model.my_dbt_trino_project.src_auth_events
[0m10:32:55.880909 [debug] [Thread-1 (]: Writing injected SQL for node "model.my_dbt_trino_project.src_auth_events"
[0m10:32:55.881429 [debug] [Thread-1 (]: Began executing node model.my_dbt_trino_project.src_auth_events
[0m10:32:55.915826 [debug] [Thread-1 (]: Writing runtime sql for node "model.my_dbt_trino_project.src_auth_events"
[0m10:32:55.920102 [debug] [Thread-1 (]: Using trino connection "model.my_dbt_trino_project.src_auth_events"
[0m10:32:55.920624 [debug] [Thread-1 (]: On model.my_dbt_trino_project.src_auth_events: /* {"app": "dbt", "dbt_version": "1.8.2", "profile_name": "my_dbt_trino_project", "target_name": "dev", "node_id": "model.my_dbt_trino_project.src_auth_events"} */

  
    

    create table "datalake"."analytics_source"."src_auth_events__dbt_tmp"
      
      
    as (
      

with source as (
    select
        CAST(ts AS VARCHAR) as id, 
        ts,
        CAST(sessionId AS VARCHAR) as sessionId,
        level,
        itemInSession,
        city,
        zip,
        state,
        userAgent,
        CAST(NULLIF(lon, '') AS double) as lon,
        CAST(NULLIF(lat, '') AS double) as lat,
        CAST(FLOOR(CAST(NULLIF(userId, '') AS DOUBLE)) AS INT) as userId, 
        lastName,
        firstName,
        gender,
        CAST(FLOOR(CAST(NULLIF(registration, '') AS DOUBLE)) AS BIGINT) as registration,
        success
    from "oltp"."public"."auth_events"
)

select
    id,
    ts,
    sessionId,
    level,
    itemInSession,
    city,
    zip,
    state,
    userAgent,
    lon,
    lat,
    userId,
    lastName,
    firstName,
    gender,
    registration, 
    CASE 
        WHEN CAST(success AS VARCHAR) = 't' THEN true 
        WHEN CAST(success AS VARCHAR) = 'f' THEN false
        ELSE NULL 
    END AS success_boolean
from source


    )
[0m10:32:55.921137 [debug] [Thread-1 (]: Opening a new connection, currently in state init
[0m10:32:56.131643 [debug] [Thread-1 (]: SQL status: SUCCESS in 0.0 seconds
[0m10:32:56.137366 [debug] [Thread-1 (]: Using trino connection "model.my_dbt_trino_project.src_auth_events"
[0m10:32:56.137886 [debug] [Thread-1 (]: On model.my_dbt_trino_project.src_auth_events: /* {"app": "dbt", "dbt_version": "1.8.2", "profile_name": "my_dbt_trino_project", "target_name": "dev", "node_id": "model.my_dbt_trino_project.src_auth_events"} */
alter table "datalake"."analytics_source"."src_auth_events" rename to "datalake"."analytics_source"."src_auth_events__dbt_backup"
[0m10:32:56.221926 [debug] [Thread-1 (]: SQL status: SUCCESS in 0.0 seconds
[0m10:32:56.225161 [debug] [Thread-1 (]: Using trino connection "model.my_dbt_trino_project.src_auth_events"
[0m10:32:56.226157 [debug] [Thread-1 (]: On model.my_dbt_trino_project.src_auth_events: /* {"app": "dbt", "dbt_version": "1.8.2", "profile_name": "my_dbt_trino_project", "target_name": "dev", "node_id": "model.my_dbt_trino_project.src_auth_events"} */
alter table "datalake"."analytics_source"."src_auth_events__dbt_tmp" rename to "datalake"."analytics_source"."src_auth_events"
[0m10:32:56.311398 [debug] [Thread-1 (]: SQL status: SUCCESS in 0.0 seconds
[0m10:32:56.316620 [debug] [Thread-1 (]: Applying DROP to: "datalake"."analytics_source"."src_auth_events__dbt_backup"
[0m10:32:56.317626 [debug] [Thread-1 (]: Using trino connection "model.my_dbt_trino_project.src_auth_events"
[0m10:32:56.318625 [debug] [Thread-1 (]: On model.my_dbt_trino_project.src_auth_events: /* {"app": "dbt", "dbt_version": "1.8.2", "profile_name": "my_dbt_trino_project", "target_name": "dev", "node_id": "model.my_dbt_trino_project.src_auth_events"} */

    drop table if exists "datalake"."analytics_source"."src_auth_events__dbt_backup"
[0m10:32:56.430234 [debug] [Thread-1 (]: SQL status: SUCCESS in 0.0 seconds
[0m10:32:56.441328 [debug] [Thread-1 (]: On model.my_dbt_trino_project.src_auth_events: ROLLBACK
[0m10:32:56.442328 [debug] [Thread-1 (]: On model.my_dbt_trino_project.src_auth_events: Close
[0m10:32:56.443339 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '8c3c1f7e-72e1-4e25-8026-578bc3a89f51', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x0000020329F4EF50>]}
[0m10:32:56.443339 [info ] [Thread-1 (]: 1 of 3 OK created sql table model analytics_source.src_auth_events ............. [[32mSUCCESS[0m in 0.57s]
[0m10:32:56.444516 [debug] [Thread-1 (]: Finished running node model.my_dbt_trino_project.src_auth_events
[0m10:32:56.444516 [debug] [Thread-1 (]: Began running node model.my_dbt_trino_project.src_listen_events
[0m10:32:56.445666 [info ] [Thread-1 (]: 2 of 3 START sql incremental model analytics_source.src_listen_events .......... [RUN]
[0m10:32:56.445666 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.my_dbt_trino_project.src_auth_events, now model.my_dbt_trino_project.src_listen_events)
[0m10:32:56.446678 [debug] [Thread-1 (]: Began compiling node model.my_dbt_trino_project.src_listen_events
[0m10:32:56.449693 [debug] [Thread-1 (]: Writing injected SQL for node "model.my_dbt_trino_project.src_listen_events"
[0m10:32:56.450696 [debug] [Thread-1 (]: Began executing node model.my_dbt_trino_project.src_listen_events
[0m10:32:56.472409 [debug] [Thread-1 (]: Using trino connection "model.my_dbt_trino_project.src_listen_events"
[0m10:32:56.472409 [debug] [Thread-1 (]: On model.my_dbt_trino_project.src_listen_events: /* {"app": "dbt", "dbt_version": "1.8.2", "profile_name": "my_dbt_trino_project", "target_name": "dev", "node_id": "model.my_dbt_trino_project.src_listen_events"} */

  
    

    create table "datalake"."analytics_source"."src_listen_events__dbt_tmp"
      
      
    as (
      

with source as (

    select
        CAST(_id AS VARCHAR) as id,
        artist,
        song,
        CAST(NULLIF(duration, '') AS DOUBLE) as duration,
        ts,
        sessionid,
        auth,
        level,
        CAST(NULLIF(itemInSession, '') AS INTEGER) as itemInSession,
        city,
        zip,
        state,
        country,
        userAgent,
        CAST(NULLIF(lon, '') AS DOUBLE) as lon,
        CAST(NULLIF(lat, '') AS DOUBLE) as lat,
        CAST(CAST(NULLIF(userId, '') AS DOUBLE) AS INTEGER) as userId,
 -- Assurez-vous que userId peut aussi être converti de cette manière.
        lastName,
        firstName,
        gender,
        CAST(CAST(NULLIF(registration, '') AS DOUBLE) AS BIGINT) as registration
    from "website"."demo"."listen_events"

)

select * from source



    -- this filter will only be applied on an incremental run
    where ts > (select max(ts) from "datalake"."analytics_source"."src_listen_events")


    )
[0m10:32:56.472409 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m10:32:56.610675 [debug] [Thread-1 (]: SQL status: SUCCESS in 0.0 seconds
[0m10:32:56.618191 [debug] [Thread-1 (]: Using trino connection "model.my_dbt_trino_project.src_listen_events"
[0m10:32:56.619192 [debug] [Thread-1 (]: On model.my_dbt_trino_project.src_listen_events: /* {"app": "dbt", "dbt_version": "1.8.2", "profile_name": "my_dbt_trino_project", "target_name": "dev", "node_id": "model.my_dbt_trino_project.src_listen_events"} */

    describe "datalake"."analytics_source"."src_listen_events__dbt_tmp"
[0m10:32:56.713580 [debug] [Thread-1 (]: SQL status: SUCCESS in 0.0 seconds
[0m10:32:56.717575 [debug] [Thread-1 (]: Using trino connection "model.my_dbt_trino_project.src_listen_events"
[0m10:32:56.717575 [debug] [Thread-1 (]: On model.my_dbt_trino_project.src_listen_events: /* {"app": "dbt", "dbt_version": "1.8.2", "profile_name": "my_dbt_trino_project", "target_name": "dev", "node_id": "model.my_dbt_trino_project.src_listen_events"} */

    describe "datalake"."analytics_source"."src_listen_events"
[0m10:32:56.803726 [debug] [Thread-1 (]: SQL status: SUCCESS in 0.0 seconds
[0m10:32:56.811280 [debug] [Thread-1 (]: Using trino connection "model.my_dbt_trino_project.src_listen_events"
[0m10:32:56.811280 [debug] [Thread-1 (]: On model.my_dbt_trino_project.src_listen_events: /* {"app": "dbt", "dbt_version": "1.8.2", "profile_name": "my_dbt_trino_project", "target_name": "dev", "node_id": "model.my_dbt_trino_project.src_listen_events"} */

    describe "datalake"."analytics_source"."src_listen_events"
[0m10:32:56.898973 [debug] [Thread-1 (]: SQL status: SUCCESS in 0.0 seconds
[0m10:32:56.906973 [debug] [Thread-1 (]: Writing runtime sql for node "model.my_dbt_trino_project.src_listen_events"
[0m10:32:56.908975 [debug] [Thread-1 (]: Using trino connection "model.my_dbt_trino_project.src_listen_events"
[0m10:32:56.908975 [debug] [Thread-1 (]: On model.my_dbt_trino_project.src_listen_events: /* {"app": "dbt", "dbt_version": "1.8.2", "profile_name": "my_dbt_trino_project", "target_name": "dev", "node_id": "model.my_dbt_trino_project.src_listen_events"} */
insert into "datalake"."analytics_source"."src_listen_events" ("id", "artist", "song", "duration", "ts", "sessionid", "auth", "level", "iteminsession", "city", "zip", "state", "country", "useragent", "lon", "lat", "userid", "lastname", "firstname", "gender", "registration")
    (
        select "id", "artist", "song", "duration", "ts", "sessionid", "auth", "level", "iteminsession", "city", "zip", "state", "country", "useragent", "lon", "lat", "userid", "lastname", "firstname", "gender", "registration"
        from "datalake"."analytics_source"."src_listen_events__dbt_tmp"
    )
[0m10:32:57.020118 [debug] [Thread-1 (]: SQL status: SUCCESS in 0.0 seconds
[0m10:32:57.023643 [debug] [Thread-1 (]: Applying DROP to: "datalake"."analytics_source"."src_listen_events__dbt_tmp"
[0m10:32:57.023643 [debug] [Thread-1 (]: Using trino connection "model.my_dbt_trino_project.src_listen_events"
[0m10:32:57.024644 [debug] [Thread-1 (]: On model.my_dbt_trino_project.src_listen_events: /* {"app": "dbt", "dbt_version": "1.8.2", "profile_name": "my_dbt_trino_project", "target_name": "dev", "node_id": "model.my_dbt_trino_project.src_listen_events"} */

    drop table if exists "datalake"."analytics_source"."src_listen_events__dbt_tmp"
[0m10:32:57.121519 [debug] [Thread-1 (]: SQL status: SUCCESS in 0.0 seconds
[0m10:32:57.122520 [debug] [Thread-1 (]: On model.my_dbt_trino_project.src_listen_events: ROLLBACK
[0m10:32:57.123517 [debug] [Thread-1 (]: On model.my_dbt_trino_project.src_listen_events: Close
[0m10:32:57.123517 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '8c3c1f7e-72e1-4e25-8026-578bc3a89f51', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000002032A3CCE50>]}
[0m10:32:57.124520 [info ] [Thread-1 (]: 2 of 3 OK created sql incremental model analytics_source.src_listen_events ..... [[32mSUCCESS[0m in 0.68s]
[0m10:32:57.124520 [debug] [Thread-1 (]: Finished running node model.my_dbt_trino_project.src_listen_events
[0m10:32:57.125520 [debug] [Thread-1 (]: Began running node model.my_dbt_trino_project.src_page_view_events
[0m10:32:57.125520 [info ] [Thread-1 (]: 3 of 3 START sql incremental model analytics_source.src_page_view_events ....... [RUN]
[0m10:32:57.126520 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.my_dbt_trino_project.src_listen_events, now model.my_dbt_trino_project.src_page_view_events)
[0m10:32:57.126520 [debug] [Thread-1 (]: Began compiling node model.my_dbt_trino_project.src_page_view_events
[0m10:32:57.129518 [debug] [Thread-1 (]: Writing injected SQL for node "model.my_dbt_trino_project.src_page_view_events"
[0m10:32:57.130517 [debug] [Thread-1 (]: Began executing node model.my_dbt_trino_project.src_page_view_events
[0m10:32:57.134517 [debug] [Thread-1 (]: Using trino connection "model.my_dbt_trino_project.src_page_view_events"
[0m10:32:57.135516 [debug] [Thread-1 (]: On model.my_dbt_trino_project.src_page_view_events: /* {"app": "dbt", "dbt_version": "1.8.2", "profile_name": "my_dbt_trino_project", "target_name": "dev", "node_id": "model.my_dbt_trino_project.src_page_view_events"} */

  
    

    create table "datalake"."analytics_source"."src_page_view_events__dbt_tmp"
      
      
    as (
      

with source as (
    select
        CAST(_id AS VARCHAR) as id,
        ts,
        CAST(sessionId AS VARCHAR) as sessionId,
        page,
        auth,
        level,
        CAST(CAST(NULLIF(itemInSession, '') AS DOUBLE) AS INTEGER) as itemInSession, 
        city,
        zip,
        state,
        userAgent,
        CAST(NULLIF(lon, '') AS double) as lon,
        CAST(NULLIF(lat, '') AS double) as lat,
        CAST(CAST(NULLIF(userId, '') AS DOUBLE) AS INTEGER) as userId, 
        lastName,
        firstName,
        gender,
        CAST(CAST(NULLIF(registration, '') AS DOUBLE) AS BIGINT) as registration, 
        artist,
        song,
        CAST(NULLIF(duration, '') AS double) as duration
    from "website"."demo"."page_view_events"
)

select * from source


    where ts > (select max(ts) from "datalake"."analytics_source"."src_page_view_events")

    )
[0m10:32:57.135516 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m10:32:57.273419 [debug] [Thread-1 (]: SQL status: SUCCESS in 0.0 seconds
[0m10:32:57.276426 [debug] [Thread-1 (]: Using trino connection "model.my_dbt_trino_project.src_page_view_events"
[0m10:32:57.276426 [debug] [Thread-1 (]: On model.my_dbt_trino_project.src_page_view_events: /* {"app": "dbt", "dbt_version": "1.8.2", "profile_name": "my_dbt_trino_project", "target_name": "dev", "node_id": "model.my_dbt_trino_project.src_page_view_events"} */

    describe "datalake"."analytics_source"."src_page_view_events__dbt_tmp"
[0m10:32:57.368041 [debug] [Thread-1 (]: SQL status: SUCCESS in 0.0 seconds
[0m10:32:57.372101 [debug] [Thread-1 (]: Using trino connection "model.my_dbt_trino_project.src_page_view_events"
[0m10:32:57.372101 [debug] [Thread-1 (]: On model.my_dbt_trino_project.src_page_view_events: /* {"app": "dbt", "dbt_version": "1.8.2", "profile_name": "my_dbt_trino_project", "target_name": "dev", "node_id": "model.my_dbt_trino_project.src_page_view_events"} */

    describe "datalake"."analytics_source"."src_page_view_events"
[0m10:32:57.448996 [debug] [Thread-1 (]: SQL status: SUCCESS in 0.0 seconds
[0m10:32:57.452006 [debug] [Thread-1 (]: Using trino connection "model.my_dbt_trino_project.src_page_view_events"
[0m10:32:57.453001 [debug] [Thread-1 (]: On model.my_dbt_trino_project.src_page_view_events: /* {"app": "dbt", "dbt_version": "1.8.2", "profile_name": "my_dbt_trino_project", "target_name": "dev", "node_id": "model.my_dbt_trino_project.src_page_view_events"} */

    describe "datalake"."analytics_source"."src_page_view_events"
[0m10:32:57.529691 [debug] [Thread-1 (]: SQL status: SUCCESS in 0.0 seconds
[0m10:32:57.532203 [debug] [Thread-1 (]: Writing runtime sql for node "model.my_dbt_trino_project.src_page_view_events"
[0m10:32:57.534468 [debug] [Thread-1 (]: Using trino connection "model.my_dbt_trino_project.src_page_view_events"
[0m10:32:57.534468 [debug] [Thread-1 (]: On model.my_dbt_trino_project.src_page_view_events: /* {"app": "dbt", "dbt_version": "1.8.2", "profile_name": "my_dbt_trino_project", "target_name": "dev", "node_id": "model.my_dbt_trino_project.src_page_view_events"} */
insert into "datalake"."analytics_source"."src_page_view_events" ("id", "ts", "sessionid", "page", "auth", "level", "iteminsession", "city", "zip", "state", "useragent", "lon", "lat", "userid", "lastname", "firstname", "gender", "registration", "artist", "song", "duration")
    (
        select "id", "ts", "sessionid", "page", "auth", "level", "iteminsession", "city", "zip", "state", "useragent", "lon", "lat", "userid", "lastname", "firstname", "gender", "registration", "artist", "song", "duration"
        from "datalake"."analytics_source"."src_page_view_events__dbt_tmp"
    )
[0m10:32:57.642704 [debug] [Thread-1 (]: SQL status: SUCCESS in 0.0 seconds
[0m10:32:57.646568 [debug] [Thread-1 (]: Applying DROP to: "datalake"."analytics_source"."src_page_view_events__dbt_tmp"
[0m10:32:57.647567 [debug] [Thread-1 (]: Using trino connection "model.my_dbt_trino_project.src_page_view_events"
[0m10:32:57.647567 [debug] [Thread-1 (]: On model.my_dbt_trino_project.src_page_view_events: /* {"app": "dbt", "dbt_version": "1.8.2", "profile_name": "my_dbt_trino_project", "target_name": "dev", "node_id": "model.my_dbt_trino_project.src_page_view_events"} */

    drop table if exists "datalake"."analytics_source"."src_page_view_events__dbt_tmp"
[0m10:32:57.754601 [debug] [Thread-1 (]: SQL status: SUCCESS in 0.0 seconds
[0m10:32:57.757612 [debug] [Thread-1 (]: On model.my_dbt_trino_project.src_page_view_events: ROLLBACK
[0m10:32:57.757612 [debug] [Thread-1 (]: On model.my_dbt_trino_project.src_page_view_events: Close
[0m10:32:57.758612 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '8c3c1f7e-72e1-4e25-8026-578bc3a89f51', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000002032B869C50>]}
[0m10:32:57.759612 [info ] [Thread-1 (]: 3 of 3 OK created sql incremental model analytics_source.src_page_view_events .. [[32mSUCCESS[0m in 0.63s]
[0m10:32:57.760116 [debug] [Thread-1 (]: Finished running node model.my_dbt_trino_project.src_page_view_events
[0m10:32:57.761123 [debug] [MainThread]: On master: COMMIT
[0m10:32:57.761123 [debug] [MainThread]: Connection 'master' was properly closed.
[0m10:32:57.761123 [debug] [MainThread]: Connection 'list_datalake' was properly closed.
[0m10:32:57.762388 [debug] [MainThread]: Connection 'list_datalake_analytics' was properly closed.
[0m10:32:57.762388 [debug] [MainThread]: Connection 'model.my_dbt_trino_project.src_page_view_events' was properly closed.
[0m10:32:57.762388 [info ] [MainThread]: 
[0m10:32:57.763390 [info ] [MainThread]: Finished running 1 table model, 2 incremental models in 0 hours 0 minutes and 2.16 seconds (2.16s).
[0m10:32:57.764389 [debug] [MainThread]: Command end result
[0m10:32:57.846805 [info ] [MainThread]: 
[0m10:32:57.847804 [info ] [MainThread]: [32mCompleted successfully[0m
[0m10:32:57.848806 [info ] [MainThread]: 
[0m10:32:57.848806 [info ] [MainThread]: Done. PASS=3 WARN=0 ERROR=0 SKIP=0 TOTAL=3
[0m10:32:57.850327 [debug] [MainThread]: Command `dbt run` succeeded at 10:32:57.850327 after 3.00 seconds
[0m10:32:57.850832 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x0000020329921790>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000002032499EED0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000002032499E310>]}
[0m10:32:57.850832 [debug] [MainThread]: Flushing usage events
[0m10:33:02.862791 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000001C8E0CD6D90>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000001C8E0CE4F50>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000001C8E0A07110>]}


============================== 10:33:02.865318 | 19209374-9009-4354-9cd7-7c0e4b289f6c ==============================
[0m10:33:02.865318 [info ] [MainThread]: Running with dbt=1.8.2
[0m10:33:02.866343 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'indirect_selection': 'eager', 'log_cache_events': 'False', 'write_json': 'True', 'partial_parse': 'True', 'cache_selected_only': 'False', 'profiles_dir': 'C:\\Users\\ASUS\\Desktop\\work\\Iceberg-Dbt-Trino-Hive-modern-open-source-data-stack-main\\dbt', 'version_check': 'True', 'fail_fast': 'False', 'log_path': 'C:\\Users\\ASUS\\Desktop\\work\\Iceberg-Dbt-Trino-Hive-modern-open-source-data-stack-main\\dbt\\logs', 'debug': 'False', 'warn_error': 'None', 'use_colors': 'True', 'use_experimental_parser': 'False', 'no_print': 'None', 'quiet': 'False', 'log_format': 'default', 'static_parser': 'True', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'invocation_command': 'dbt run --models stage', 'target_path': 'None', 'introspect': 'True', 'send_anonymous_usage_stats': 'True'}
[0m10:33:03.168711 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': '19209374-9009-4354-9cd7-7c0e4b289f6c', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000001C8E113BD90>]}
[0m10:33:03.201732 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': '19209374-9009-4354-9cd7-7c0e4b289f6c', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000001C8DDE55450>]}
[0m10:33:03.201732 [info ] [MainThread]: Registered adapter: trino=1.8.0
[0m10:33:03.211730 [debug] [MainThread]: checksum: f0a141b9de567cb7f131613ba2682f40b3a1c6a157f81c6e5435862eff68f109, vars: {}, profile: , target: , version: 1.8.2
[0m10:33:03.363327 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 0 files changed.
[0m10:33:03.363327 [debug] [MainThread]: Partial parsing enabled, no changes found, skipping parsing
[0m10:33:03.390444 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': '19209374-9009-4354-9cd7-7c0e4b289f6c', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000001C8E12A0050>]}
[0m10:33:03.456279 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': '19209374-9009-4354-9cd7-7c0e4b289f6c', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000001C8E123FE50>]}
[0m10:33:03.457279 [info ] [MainThread]: Found 15 models, 7 data tests, 3 sources, 559 macros
[0m10:33:03.457511 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '19209374-9009-4354-9cd7-7c0e4b289f6c', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000001C8E1173D10>]}
[0m10:33:03.458997 [info ] [MainThread]: 
[0m10:33:03.458997 [debug] [MainThread]: Acquiring new trino connection 'master'
[0m10:33:03.463377 [debug] [ThreadPool]: Acquiring new trino connection 'list_datalake'
[0m10:33:03.521115 [debug] [ThreadPool]: Using trino connection "list_datalake"
[0m10:33:03.522115 [debug] [ThreadPool]: On list_datalake: /* {"app": "dbt", "dbt_version": "1.8.2", "profile_name": "my_dbt_trino_project", "target_name": "dev", "connection_name": "list_datalake"} */

    select schema_name
    from "datalake".INFORMATION_SCHEMA.schemata
[0m10:33:03.522115 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m10:33:03.548428 [debug] [ThreadPool]: SQL status: SUCCESS in 0.0 seconds
[0m10:33:03.549431 [debug] [ThreadPool]: On list_datalake: Close
[0m10:33:03.551751 [debug] [ThreadPool]: Acquiring new trino connection 'list_datalake_analytics_source'
[0m10:33:03.562771 [debug] [ThreadPool]: Using trino connection "list_datalake_analytics_source"
[0m10:33:03.563771 [debug] [ThreadPool]: On list_datalake_analytics_source: /* {"app": "dbt", "dbt_version": "1.8.2", "profile_name": "my_dbt_trino_project", "target_name": "dev", "connection_name": "list_datalake_analytics_source"} */
select
      t.table_catalog as database,
      t.table_name as name,
      t.table_schema as schema,
      case when mv.name is not null then 'materialized_view'
           when t.table_type = 'BASE TABLE' then 'table'
           when t.table_type = 'VIEW' then 'view'
           else t.table_type
      end as table_type
    from "datalake".INFORMATION_SCHEMA.tables t
    left join (
            select * from system.metadata.materialized_views
            where catalog_name = 'datalake'
              and schema_name = 'analytics_source') mv
          on mv.catalog_name = t.table_catalog and mv.schema_name = t.table_schema and mv.name = t.table_name
    where t.table_schema = 'analytics_source'
[0m10:33:03.563771 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m10:33:03.622000 [debug] [ThreadPool]: SQL status: SUCCESS in 0.0 seconds
[0m10:33:03.624104 [debug] [ThreadPool]: On list_datalake_analytics_source: ROLLBACK
[0m10:33:03.624104 [debug] [ThreadPool]: On list_datalake_analytics_source: Close
[0m10:33:03.625107 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_datalake_analytics_source, now list_datalake_analytics_stage)
[0m10:33:03.628104 [debug] [ThreadPool]: Using trino connection "list_datalake_analytics_stage"
[0m10:33:03.629108 [debug] [ThreadPool]: On list_datalake_analytics_stage: /* {"app": "dbt", "dbt_version": "1.8.2", "profile_name": "my_dbt_trino_project", "target_name": "dev", "connection_name": "list_datalake_analytics_stage"} */
select
      t.table_catalog as database,
      t.table_name as name,
      t.table_schema as schema,
      case when mv.name is not null then 'materialized_view'
           when t.table_type = 'BASE TABLE' then 'table'
           when t.table_type = 'VIEW' then 'view'
           else t.table_type
      end as table_type
    from "datalake".INFORMATION_SCHEMA.tables t
    left join (
            select * from system.metadata.materialized_views
            where catalog_name = 'datalake'
              and schema_name = 'analytics_stage') mv
          on mv.catalog_name = t.table_catalog and mv.schema_name = t.table_schema and mv.name = t.table_name
    where t.table_schema = 'analytics_stage'
[0m10:33:03.629108 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m10:33:03.683882 [debug] [ThreadPool]: SQL status: SUCCESS in 0.0 seconds
[0m10:33:03.684887 [debug] [ThreadPool]: On list_datalake_analytics_stage: ROLLBACK
[0m10:33:03.684887 [debug] [ThreadPool]: On list_datalake_analytics_stage: Close
[0m10:33:03.686066 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_datalake_analytics_stage, now list_datalake_analytics)
[0m10:33:03.689884 [debug] [ThreadPool]: Using trino connection "list_datalake_analytics"
[0m10:33:03.690883 [debug] [ThreadPool]: On list_datalake_analytics: /* {"app": "dbt", "dbt_version": "1.8.2", "profile_name": "my_dbt_trino_project", "target_name": "dev", "connection_name": "list_datalake_analytics"} */
select
      t.table_catalog as database,
      t.table_name as name,
      t.table_schema as schema,
      case when mv.name is not null then 'materialized_view'
           when t.table_type = 'BASE TABLE' then 'table'
           when t.table_type = 'VIEW' then 'view'
           else t.table_type
      end as table_type
    from "datalake".INFORMATION_SCHEMA.tables t
    left join (
            select * from system.metadata.materialized_views
            where catalog_name = 'datalake'
              and schema_name = 'analytics') mv
          on mv.catalog_name = t.table_catalog and mv.schema_name = t.table_schema and mv.name = t.table_name
    where t.table_schema = 'analytics'
[0m10:33:03.690883 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m10:33:03.745136 [debug] [ThreadPool]: SQL status: SUCCESS in 0.0 seconds
[0m10:33:03.746734 [debug] [ThreadPool]: On list_datalake_analytics: ROLLBACK
[0m10:33:03.747266 [debug] [ThreadPool]: On list_datalake_analytics: Close
[0m10:33:03.748352 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '19209374-9009-4354-9cd7-7c0e4b289f6c', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000001C8E09ADD90>]}
[0m10:33:03.748881 [debug] [MainThread]: On master: COMMIT
[0m10:33:03.749421 [info ] [MainThread]: Concurrency: 1 threads (target='dev')
[0m10:33:03.749959 [info ] [MainThread]: 
[0m10:33:03.752657 [debug] [Thread-1 (]: Began running node model.my_dbt_trino_project.stg_streams_hourly
[0m10:33:03.753204 [info ] [Thread-1 (]: 1 of 6 START sql table model analytics_stage.stg_streams_hourly ................ [RUN]
[0m10:33:03.753732 [debug] [Thread-1 (]: Acquiring new trino connection 'model.my_dbt_trino_project.stg_streams_hourly'
[0m10:33:03.754284 [debug] [Thread-1 (]: Began compiling node model.my_dbt_trino_project.stg_streams_hourly
[0m10:33:03.756877 [debug] [Thread-1 (]: Writing injected SQL for node "model.my_dbt_trino_project.stg_streams_hourly"
[0m10:33:03.756877 [debug] [Thread-1 (]: Began executing node model.my_dbt_trino_project.stg_streams_hourly
[0m10:33:03.789332 [debug] [Thread-1 (]: Writing runtime sql for node "model.my_dbt_trino_project.stg_streams_hourly"
[0m10:33:03.791331 [debug] [Thread-1 (]: Using trino connection "model.my_dbt_trino_project.stg_streams_hourly"
[0m10:33:03.791331 [debug] [Thread-1 (]: On model.my_dbt_trino_project.stg_streams_hourly: /* {"app": "dbt", "dbt_version": "1.8.2", "profile_name": "my_dbt_trino_project", "target_name": "dev", "node_id": "model.my_dbt_trino_project.stg_streams_hourly"} */

  
    

    create table "datalake"."analytics_stage"."stg_streams_hourly__dbt_tmp"
      
      
    as (
      

SELECT
    DATE_FORMAT(FROM_UNIXTIME(ts), '%Y-%m-%d') AS stream_date, 
    DATE_FORMAT(FROM_UNIXTIME(ts), '%H') AS stream_hour,
    COUNT(*) AS total_streams
FROM "datalake"."analytics_source"."src_listen_events"
GROUP BY
    DATE_FORMAT(FROM_UNIXTIME(ts), '%Y-%m-%d'),
    DATE_FORMAT(FROM_UNIXTIME(ts), '%H')
    )
[0m10:33:03.792331 [debug] [Thread-1 (]: Opening a new connection, currently in state init
[0m10:33:04.001850 [debug] [Thread-1 (]: SQL status: SUCCESS in 0.0 seconds
[0m10:33:04.006783 [debug] [Thread-1 (]: Using trino connection "model.my_dbt_trino_project.stg_streams_hourly"
[0m10:33:04.007784 [debug] [Thread-1 (]: On model.my_dbt_trino_project.stg_streams_hourly: /* {"app": "dbt", "dbt_version": "1.8.2", "profile_name": "my_dbt_trino_project", "target_name": "dev", "node_id": "model.my_dbt_trino_project.stg_streams_hourly"} */
alter table "datalake"."analytics_stage"."stg_streams_hourly" rename to "datalake"."analytics_stage"."stg_streams_hourly__dbt_backup"
[0m10:33:04.097671 [debug] [Thread-1 (]: SQL status: SUCCESS in 0.0 seconds
[0m10:33:04.100678 [debug] [Thread-1 (]: Using trino connection "model.my_dbt_trino_project.stg_streams_hourly"
[0m10:33:04.101678 [debug] [Thread-1 (]: On model.my_dbt_trino_project.stg_streams_hourly: /* {"app": "dbt", "dbt_version": "1.8.2", "profile_name": "my_dbt_trino_project", "target_name": "dev", "node_id": "model.my_dbt_trino_project.stg_streams_hourly"} */
alter table "datalake"."analytics_stage"."stg_streams_hourly__dbt_tmp" rename to "datalake"."analytics_stage"."stg_streams_hourly"
[0m10:33:04.182588 [debug] [Thread-1 (]: SQL status: SUCCESS in 0.0 seconds
[0m10:33:04.187587 [debug] [Thread-1 (]: Applying DROP to: "datalake"."analytics_stage"."stg_streams_hourly__dbt_backup"
[0m10:33:04.189590 [debug] [Thread-1 (]: Using trino connection "model.my_dbt_trino_project.stg_streams_hourly"
[0m10:33:04.190587 [debug] [Thread-1 (]: On model.my_dbt_trino_project.stg_streams_hourly: /* {"app": "dbt", "dbt_version": "1.8.2", "profile_name": "my_dbt_trino_project", "target_name": "dev", "node_id": "model.my_dbt_trino_project.stg_streams_hourly"} */

    drop table if exists "datalake"."analytics_stage"."stg_streams_hourly__dbt_backup"
[0m10:33:04.298846 [debug] [Thread-1 (]: SQL status: SUCCESS in 0.0 seconds
[0m10:33:04.310429 [debug] [Thread-1 (]: On model.my_dbt_trino_project.stg_streams_hourly: ROLLBACK
[0m10:33:04.310429 [debug] [Thread-1 (]: On model.my_dbt_trino_project.stg_streams_hourly: Close
[0m10:33:04.311428 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '19209374-9009-4354-9cd7-7c0e4b289f6c', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000001C8E1356F10>]}
[0m10:33:04.312700 [info ] [Thread-1 (]: 1 of 6 OK created sql table model analytics_stage.stg_streams_hourly ........... [[32mSUCCESS[0m in 0.56s]
[0m10:33:04.312700 [debug] [Thread-1 (]: Finished running node model.my_dbt_trino_project.stg_streams_hourly
[0m10:33:04.313705 [debug] [Thread-1 (]: Began running node model.my_dbt_trino_project.stg_top_songs_artists
[0m10:33:04.313705 [info ] [Thread-1 (]: 2 of 6 START sql view model analytics_stage.stg_top_songs_artists .............. [RUN]
[0m10:33:04.314704 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.my_dbt_trino_project.stg_streams_hourly, now model.my_dbt_trino_project.stg_top_songs_artists)
[0m10:33:04.314704 [debug] [Thread-1 (]: Began compiling node model.my_dbt_trino_project.stg_top_songs_artists
[0m10:33:04.317713 [debug] [Thread-1 (]: Writing injected SQL for node "model.my_dbt_trino_project.stg_top_songs_artists"
[0m10:33:04.317713 [debug] [Thread-1 (]: Began executing node model.my_dbt_trino_project.stg_top_songs_artists
[0m10:33:04.328704 [debug] [Thread-1 (]: Writing runtime sql for node "model.my_dbt_trino_project.stg_top_songs_artists"
[0m10:33:04.330704 [debug] [Thread-1 (]: Using trino connection "model.my_dbt_trino_project.stg_top_songs_artists"
[0m10:33:04.330704 [debug] [Thread-1 (]: On model.my_dbt_trino_project.stg_top_songs_artists: /* {"app": "dbt", "dbt_version": "1.8.2", "profile_name": "my_dbt_trino_project", "target_name": "dev", "node_id": "model.my_dbt_trino_project.stg_top_songs_artists"} */

  create or replace view
    "datalake"."analytics_stage"."stg_top_songs_artists"
  security definer
  as
    

WITH song_plays AS (
    SELECT
        artist,
        song,
        COUNT(*) AS play_count
    FROM "datalake"."analytics_source"."src_listen_events"
    GROUP BY artist, song
)

SELECT
    artist,
    song,
    play_count
FROM song_plays
ORDER BY play_count DESC
  
[0m10:33:04.330704 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m10:33:04.386154 [debug] [Thread-1 (]: SQL status: SUCCESS in 0.0 seconds
[0m10:33:04.388171 [debug] [Thread-1 (]: On model.my_dbt_trino_project.stg_top_songs_artists: ROLLBACK
[0m10:33:04.388171 [debug] [Thread-1 (]: On model.my_dbt_trino_project.stg_top_songs_artists: Close
[0m10:33:04.389172 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '19209374-9009-4354-9cd7-7c0e4b289f6c', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000001C8E10F2410>]}
[0m10:33:04.389172 [info ] [Thread-1 (]: 2 of 6 OK created sql view model analytics_stage.stg_top_songs_artists ......... [[32mSUCCESS[0m in 0.07s]
[0m10:33:04.390171 [debug] [Thread-1 (]: Finished running node model.my_dbt_trino_project.stg_top_songs_artists
[0m10:33:04.390171 [debug] [Thread-1 (]: Began running node model.my_dbt_trino_project.stg_unique_users
[0m10:33:04.391172 [info ] [Thread-1 (]: 3 of 6 START sql view model analytics_stage.stg_unique_users ................... [RUN]
[0m10:33:04.391172 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.my_dbt_trino_project.stg_top_songs_artists, now model.my_dbt_trino_project.stg_unique_users)
[0m10:33:04.392201 [debug] [Thread-1 (]: Began compiling node model.my_dbt_trino_project.stg_unique_users
[0m10:33:04.394200 [debug] [Thread-1 (]: Writing injected SQL for node "model.my_dbt_trino_project.stg_unique_users"
[0m10:33:04.395199 [debug] [Thread-1 (]: Began executing node model.my_dbt_trino_project.stg_unique_users
[0m10:33:04.398203 [debug] [Thread-1 (]: Writing runtime sql for node "model.my_dbt_trino_project.stg_unique_users"
[0m10:33:04.399202 [debug] [Thread-1 (]: Using trino connection "model.my_dbt_trino_project.stg_unique_users"
[0m10:33:04.399202 [debug] [Thread-1 (]: On model.my_dbt_trino_project.stg_unique_users: /* {"app": "dbt", "dbt_version": "1.8.2", "profile_name": "my_dbt_trino_project", "target_name": "dev", "node_id": "model.my_dbt_trino_project.stg_unique_users"} */

  create or replace view
    "datalake"."analytics_stage"."stg_unique_users"
  security definer
  as
    

SELECT
    COUNT(DISTINCT userid) AS total_unique_users
FROM "datalake"."analytics_source"."src_listen_events"
WHERE userid IS NOT NULL
  
[0m10:33:04.400199 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m10:33:04.463544 [debug] [Thread-1 (]: SQL status: SUCCESS in 0.0 seconds
[0m10:33:04.464543 [debug] [Thread-1 (]: On model.my_dbt_trino_project.stg_unique_users: ROLLBACK
[0m10:33:04.464543 [debug] [Thread-1 (]: On model.my_dbt_trino_project.stg_unique_users: Close
[0m10:33:04.466050 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '19209374-9009-4354-9cd7-7c0e4b289f6c', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000001C8E133F890>]}
[0m10:33:04.467057 [info ] [Thread-1 (]: 3 of 6 OK created sql view model analytics_stage.stg_unique_users .............. [[32mSUCCESS[0m in 0.07s]
[0m10:33:04.468057 [debug] [Thread-1 (]: Finished running node model.my_dbt_trino_project.stg_unique_users
[0m10:33:04.468594 [debug] [Thread-1 (]: Began running node model.my_dbt_trino_project.stg_user_activity_per_country
[0m10:33:04.468594 [info ] [Thread-1 (]: 4 of 6 START sql view model analytics_stage.stg_user_activity_per_country ...... [RUN]
[0m10:33:04.469602 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.my_dbt_trino_project.stg_unique_users, now model.my_dbt_trino_project.stg_user_activity_per_country)
[0m10:33:04.469602 [debug] [Thread-1 (]: Began compiling node model.my_dbt_trino_project.stg_user_activity_per_country
[0m10:33:04.473113 [debug] [Thread-1 (]: Writing injected SQL for node "model.my_dbt_trino_project.stg_user_activity_per_country"
[0m10:33:04.473113 [debug] [Thread-1 (]: Began executing node model.my_dbt_trino_project.stg_user_activity_per_country
[0m10:33:04.476114 [debug] [Thread-1 (]: Writing runtime sql for node "model.my_dbt_trino_project.stg_user_activity_per_country"
[0m10:33:04.479111 [debug] [Thread-1 (]: Using trino connection "model.my_dbt_trino_project.stg_user_activity_per_country"
[0m10:33:04.479111 [debug] [Thread-1 (]: On model.my_dbt_trino_project.stg_user_activity_per_country: /* {"app": "dbt", "dbt_version": "1.8.2", "profile_name": "my_dbt_trino_project", "target_name": "dev", "node_id": "model.my_dbt_trino_project.stg_user_activity_per_country"} */

  create or replace view
    "datalake"."analytics_stage"."stg_user_activity_per_country"
  security definer
  as
    

WITH combined_activities AS (
  SELECT
    country,
    'listen_event' AS event_type,
    ts,
    userid
  FROM "datalake"."analytics_source"."src_listen_events"
  WHERE country IS NOT NULL
  UNION ALL
  SELECT
    'Unknown' AS country,
    'auth_event' AS event_type, 
    ts,
    userid
  FROM "datalake"."analytics_source"."src_auth_events"
  UNION ALL
  SELECT
    'Unknown' AS country, 
    'page_view_event' AS event_type,
    ts,
    userid
  FROM "datalake"."analytics_source"."src_page_view_events"
)

SELECT
  country,
  COUNT(*) AS activity_count
FROM combined_activities
GROUP BY country
  
[0m10:33:04.480115 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m10:33:04.558938 [debug] [Thread-1 (]: SQL status: SUCCESS in 0.0 seconds
[0m10:33:04.560935 [debug] [Thread-1 (]: On model.my_dbt_trino_project.stg_user_activity_per_country: ROLLBACK
[0m10:33:04.561935 [debug] [Thread-1 (]: On model.my_dbt_trino_project.stg_user_activity_per_country: Close
[0m10:33:04.561935 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '19209374-9009-4354-9cd7-7c0e4b289f6c', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000001C8E1C56A50>]}
[0m10:33:04.563287 [info ] [Thread-1 (]: 4 of 6 OK created sql view model analytics_stage.stg_user_activity_per_country . [[32mSUCCESS[0m in 0.09s]
[0m10:33:04.563287 [debug] [Thread-1 (]: Finished running node model.my_dbt_trino_project.stg_user_activity_per_country
[0m10:33:04.564297 [debug] [Thread-1 (]: Began running node model.my_dbt_trino_project.stg_user_activity_per_location
[0m10:33:04.564297 [info ] [Thread-1 (]: 5 of 6 START sql view model analytics_stage.stg_user_activity_per_location ..... [RUN]
[0m10:33:04.565294 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.my_dbt_trino_project.stg_user_activity_per_country, now model.my_dbt_trino_project.stg_user_activity_per_location)
[0m10:33:04.566297 [debug] [Thread-1 (]: Began compiling node model.my_dbt_trino_project.stg_user_activity_per_location
[0m10:33:04.569816 [debug] [Thread-1 (]: Writing injected SQL for node "model.my_dbt_trino_project.stg_user_activity_per_location"
[0m10:33:04.570818 [debug] [Thread-1 (]: Began executing node model.my_dbt_trino_project.stg_user_activity_per_location
[0m10:33:04.572816 [debug] [Thread-1 (]: Writing runtime sql for node "model.my_dbt_trino_project.stg_user_activity_per_location"
[0m10:33:04.574816 [debug] [Thread-1 (]: Using trino connection "model.my_dbt_trino_project.stg_user_activity_per_location"
[0m10:33:04.574816 [debug] [Thread-1 (]: On model.my_dbt_trino_project.stg_user_activity_per_location: /* {"app": "dbt", "dbt_version": "1.8.2", "profile_name": "my_dbt_trino_project", "target_name": "dev", "node_id": "model.my_dbt_trino_project.stg_user_activity_per_location"} */

  create or replace view
    "datalake"."analytics_stage"."stg_user_activity_per_location"
  security definer
  as
    

WITH combined_activities AS (
  SELECT
    city,
    state,
    'auth_event' AS event_type,
    ts,
    userid
 FROM "datalake"."analytics_source"."src_auth_events"
  UNION ALL
  SELECT
    city,
    state,
    'listen_event' AS event_type,
    ts,
    userid
  FROM "datalake"."analytics_source"."src_listen_events"
  UNION ALL
  SELECT
    city,
    state,
    'page_view_event' AS event_type,
    ts,
    userid
  FROM "datalake"."analytics_source"."src_page_view_events"
)

SELECT
  state,
  city,
  COUNT(*) AS activity_count
FROM combined_activities
GROUP BY state, city
  
[0m10:33:04.575817 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m10:33:04.649478 [debug] [Thread-1 (]: SQL status: SUCCESS in 0.0 seconds
[0m10:33:04.651476 [debug] [Thread-1 (]: On model.my_dbt_trino_project.stg_user_activity_per_location: ROLLBACK
[0m10:33:04.651476 [debug] [Thread-1 (]: On model.my_dbt_trino_project.stg_user_activity_per_location: Close
[0m10:33:04.652485 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '19209374-9009-4354-9cd7-7c0e4b289f6c', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000001C8E1BF9510>]}
[0m10:33:04.653488 [info ] [Thread-1 (]: 5 of 6 OK created sql view model analytics_stage.stg_user_activity_per_location  [[32mSUCCESS[0m in 0.09s]
[0m10:33:04.654486 [debug] [Thread-1 (]: Finished running node model.my_dbt_trino_project.stg_user_activity_per_location
[0m10:33:04.654486 [debug] [Thread-1 (]: Began running node model.my_dbt_trino_project.stg_user_level_by_gender
[0m10:33:04.655492 [info ] [Thread-1 (]: 6 of 6 START sql view model analytics_stage.stg_user_level_by_gender ........... [RUN]
[0m10:33:04.656484 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.my_dbt_trino_project.stg_user_activity_per_location, now model.my_dbt_trino_project.stg_user_level_by_gender)
[0m10:33:04.656484 [debug] [Thread-1 (]: Began compiling node model.my_dbt_trino_project.stg_user_level_by_gender
[0m10:33:04.659481 [debug] [Thread-1 (]: Writing injected SQL for node "model.my_dbt_trino_project.stg_user_level_by_gender"
[0m10:33:04.659481 [debug] [Thread-1 (]: Began executing node model.my_dbt_trino_project.stg_user_level_by_gender
[0m10:33:04.662481 [debug] [Thread-1 (]: Writing runtime sql for node "model.my_dbt_trino_project.stg_user_level_by_gender"
[0m10:33:04.663484 [debug] [Thread-1 (]: Using trino connection "model.my_dbt_trino_project.stg_user_level_by_gender"
[0m10:33:04.663484 [debug] [Thread-1 (]: On model.my_dbt_trino_project.stg_user_level_by_gender: /* {"app": "dbt", "dbt_version": "1.8.2", "profile_name": "my_dbt_trino_project", "target_name": "dev", "node_id": "model.my_dbt_trino_project.stg_user_level_by_gender"} */

  create or replace view
    "datalake"."analytics_stage"."stg_user_level_by_gender"
  security definer
  as
    

WITH user_subscriptions AS (
    SELECT
        gender,
        level, 
        COUNT(DISTINCT userId) AS user_count
    FROM "datalake"."analytics_source"."src_auth_events"
    WHERE gender IS NOT NULL AND level IS NOT NULL
    GROUP BY gender, level
)

SELECT
    gender,
    level,
    user_count
FROM user_subscriptions
  
[0m10:33:04.664484 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m10:33:04.722704 [debug] [Thread-1 (]: SQL status: SUCCESS in 0.0 seconds
[0m10:33:04.724700 [debug] [Thread-1 (]: On model.my_dbt_trino_project.stg_user_level_by_gender: ROLLBACK
[0m10:33:04.724700 [debug] [Thread-1 (]: On model.my_dbt_trino_project.stg_user_level_by_gender: Close
[0m10:33:04.725702 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '19209374-9009-4354-9cd7-7c0e4b289f6c', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000001C8E1C3C9D0>]}
[0m10:33:04.725702 [info ] [Thread-1 (]: 6 of 6 OK created sql view model analytics_stage.stg_user_level_by_gender ...... [[32mSUCCESS[0m in 0.07s]
[0m10:33:04.726704 [debug] [Thread-1 (]: Finished running node model.my_dbt_trino_project.stg_user_level_by_gender
[0m10:33:04.727703 [debug] [MainThread]: On master: COMMIT
[0m10:33:04.728703 [debug] [MainThread]: Connection 'master' was properly closed.
[0m10:33:04.728703 [debug] [MainThread]: Connection 'list_datalake' was properly closed.
[0m10:33:04.728703 [debug] [MainThread]: Connection 'list_datalake_analytics' was properly closed.
[0m10:33:04.728703 [debug] [MainThread]: Connection 'model.my_dbt_trino_project.stg_user_level_by_gender' was properly closed.
[0m10:33:04.729701 [info ] [MainThread]: 
[0m10:33:04.729701 [info ] [MainThread]: Finished running 1 table model, 5 view models in 0 hours 0 minutes and 1.27 seconds (1.27s).
[0m10:33:04.731702 [debug] [MainThread]: Command end result
[0m10:33:04.811914 [info ] [MainThread]: 
[0m10:33:04.811914 [info ] [MainThread]: [32mCompleted successfully[0m
[0m10:33:04.813170 [info ] [MainThread]: 
[0m10:33:04.813170 [info ] [MainThread]: Done. PASS=6 WARN=0 ERROR=0 SKIP=0 TOTAL=6
[0m10:33:04.815668 [debug] [MainThread]: Command `dbt run` succeeded at 10:33:04.814660 after 2.09 seconds
[0m10:33:04.815668 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000001C8DFD58B50>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000001C8DBDBE2D0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000001C8DBDBE350>]}
[0m10:33:04.815668 [debug] [MainThread]: Flushing usage events
[0m10:33:10.836706 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000001FAD65E8710>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000001FAD5E7B390>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000001FAD62C7010>]}


============================== 10:33:10.839706 | 7004cc7b-5b21-416d-9181-0d37c496d6ef ==============================
[0m10:33:10.839706 [info ] [MainThread]: Running with dbt=1.8.2
[0m10:33:10.840247 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'indirect_selection': 'eager', 'write_json': 'True', 'log_cache_events': 'False', 'partial_parse': 'True', 'cache_selected_only': 'False', 'warn_error': 'None', 'debug': 'False', 'fail_fast': 'False', 'log_path': 'C:\\Users\\ASUS\\Desktop\\work\\Iceberg-Dbt-Trino-Hive-modern-open-source-data-stack-main\\dbt\\logs', 'version_check': 'True', 'profiles_dir': 'C:\\Users\\ASUS\\Desktop\\work\\Iceberg-Dbt-Trino-Hive-modern-open-source-data-stack-main\\dbt', 'use_colors': 'True', 'use_experimental_parser': 'False', 'no_print': 'None', 'quiet': 'False', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'introspect': 'True', 'invocation_command': 'dbt run --models marts', 'static_parser': 'True', 'target_path': 'None', 'log_format': 'default', 'send_anonymous_usage_stats': 'True'}
[0m10:33:11.157744 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': '7004cc7b-5b21-416d-9181-0d37c496d6ef', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000001FAD6962C10>]}
[0m10:33:11.195026 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': '7004cc7b-5b21-416d-9181-0d37c496d6ef', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000001FAD3715850>]}
[0m10:33:11.196057 [info ] [MainThread]: Registered adapter: trino=1.8.0
[0m10:33:11.207660 [debug] [MainThread]: checksum: f0a141b9de567cb7f131613ba2682f40b3a1c6a157f81c6e5435862eff68f109, vars: {}, profile: , target: , version: 1.8.2
[0m10:33:11.366124 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 0 files changed.
[0m10:33:11.366671 [debug] [MainThread]: Partial parsing enabled, no changes found, skipping parsing
[0m10:33:11.395183 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': '7004cc7b-5b21-416d-9181-0d37c496d6ef', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000001FAD6A62890>]}
[0m10:33:11.462688 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': '7004cc7b-5b21-416d-9181-0d37c496d6ef', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000001FAD6AF7DD0>]}
[0m10:33:11.462688 [info ] [MainThread]: Found 15 models, 7 data tests, 3 sources, 559 macros
[0m10:33:11.462688 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '7004cc7b-5b21-416d-9181-0d37c496d6ef', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000001FAD6A5B450>]}
[0m10:33:11.465159 [info ] [MainThread]: 
[0m10:33:11.466159 [debug] [MainThread]: Acquiring new trino connection 'master'
[0m10:33:11.469707 [debug] [ThreadPool]: Acquiring new trino connection 'list_datalake'
[0m10:33:11.523725 [debug] [ThreadPool]: Using trino connection "list_datalake"
[0m10:33:11.524727 [debug] [ThreadPool]: On list_datalake: /* {"app": "dbt", "dbt_version": "1.8.2", "profile_name": "my_dbt_trino_project", "target_name": "dev", "connection_name": "list_datalake"} */

    select schema_name
    from "datalake".INFORMATION_SCHEMA.schemata
[0m10:33:11.524727 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m10:33:11.548015 [debug] [ThreadPool]: SQL status: SUCCESS in 0.0 seconds
[0m10:33:11.549023 [debug] [ThreadPool]: On list_datalake: Close
[0m10:33:11.550912 [debug] [ThreadPool]: Acquiring new trino connection 'list_datalake_analytics_source'
[0m10:33:11.560928 [debug] [ThreadPool]: Using trino connection "list_datalake_analytics_source"
[0m10:33:11.561928 [debug] [ThreadPool]: On list_datalake_analytics_source: /* {"app": "dbt", "dbt_version": "1.8.2", "profile_name": "my_dbt_trino_project", "target_name": "dev", "connection_name": "list_datalake_analytics_source"} */
select
      t.table_catalog as database,
      t.table_name as name,
      t.table_schema as schema,
      case when mv.name is not null then 'materialized_view'
           when t.table_type = 'BASE TABLE' then 'table'
           when t.table_type = 'VIEW' then 'view'
           else t.table_type
      end as table_type
    from "datalake".INFORMATION_SCHEMA.tables t
    left join (
            select * from system.metadata.materialized_views
            where catalog_name = 'datalake'
              and schema_name = 'analytics_source') mv
          on mv.catalog_name = t.table_catalog and mv.schema_name = t.table_schema and mv.name = t.table_name
    where t.table_schema = 'analytics_source'
[0m10:33:11.561928 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m10:33:11.613486 [debug] [ThreadPool]: SQL status: SUCCESS in 0.0 seconds
[0m10:33:11.614487 [debug] [ThreadPool]: On list_datalake_analytics_source: ROLLBACK
[0m10:33:11.614487 [debug] [ThreadPool]: On list_datalake_analytics_source: Close
[0m10:33:11.615486 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_datalake_analytics_source, now list_datalake_analytics)
[0m10:33:11.618486 [debug] [ThreadPool]: Using trino connection "list_datalake_analytics"
[0m10:33:11.619486 [debug] [ThreadPool]: On list_datalake_analytics: /* {"app": "dbt", "dbt_version": "1.8.2", "profile_name": "my_dbt_trino_project", "target_name": "dev", "connection_name": "list_datalake_analytics"} */
select
      t.table_catalog as database,
      t.table_name as name,
      t.table_schema as schema,
      case when mv.name is not null then 'materialized_view'
           when t.table_type = 'BASE TABLE' then 'table'
           when t.table_type = 'VIEW' then 'view'
           else t.table_type
      end as table_type
    from "datalake".INFORMATION_SCHEMA.tables t
    left join (
            select * from system.metadata.materialized_views
            where catalog_name = 'datalake'
              and schema_name = 'analytics') mv
          on mv.catalog_name = t.table_catalog and mv.schema_name = t.table_schema and mv.name = t.table_name
    where t.table_schema = 'analytics'
[0m10:33:11.619486 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m10:33:11.676375 [debug] [ThreadPool]: SQL status: SUCCESS in 0.0 seconds
[0m10:33:11.677376 [debug] [ThreadPool]: On list_datalake_analytics: ROLLBACK
[0m10:33:11.677376 [debug] [ThreadPool]: On list_datalake_analytics: Close
[0m10:33:11.678376 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_datalake_analytics, now list_datalake_analytics_stage)
[0m10:33:11.682886 [debug] [ThreadPool]: Using trino connection "list_datalake_analytics_stage"
[0m10:33:11.682886 [debug] [ThreadPool]: On list_datalake_analytics_stage: /* {"app": "dbt", "dbt_version": "1.8.2", "profile_name": "my_dbt_trino_project", "target_name": "dev", "connection_name": "list_datalake_analytics_stage"} */
select
      t.table_catalog as database,
      t.table_name as name,
      t.table_schema as schema,
      case when mv.name is not null then 'materialized_view'
           when t.table_type = 'BASE TABLE' then 'table'
           when t.table_type = 'VIEW' then 'view'
           else t.table_type
      end as table_type
    from "datalake".INFORMATION_SCHEMA.tables t
    left join (
            select * from system.metadata.materialized_views
            where catalog_name = 'datalake'
              and schema_name = 'analytics_stage') mv
          on mv.catalog_name = t.table_catalog and mv.schema_name = t.table_schema and mv.name = t.table_name
    where t.table_schema = 'analytics_stage'
[0m10:33:11.682886 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m10:33:11.737832 [debug] [ThreadPool]: SQL status: SUCCESS in 0.0 seconds
[0m10:33:11.737832 [debug] [ThreadPool]: On list_datalake_analytics_stage: ROLLBACK
[0m10:33:11.739348 [debug] [ThreadPool]: On list_datalake_analytics_stage: Close
[0m10:33:11.740788 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '7004cc7b-5b21-416d-9181-0d37c496d6ef', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000001FAD7022C10>]}
[0m10:33:11.740788 [debug] [MainThread]: On master: COMMIT
[0m10:33:11.741795 [info ] [MainThread]: Concurrency: 1 threads (target='dev')
[0m10:33:11.742809 [info ] [MainThread]: 
[0m10:33:11.744820 [debug] [Thread-1 (]: Began running node model.my_dbt_trino_project.mart_hourly_stream_evolution
[0m10:33:11.744820 [info ] [Thread-1 (]: 1 of 6 START sql table model analytics.mart_hourly_stream_evolution ............ [RUN]
[0m10:33:11.745820 [debug] [Thread-1 (]: Acquiring new trino connection 'model.my_dbt_trino_project.mart_hourly_stream_evolution'
[0m10:33:11.745820 [debug] [Thread-1 (]: Began compiling node model.my_dbt_trino_project.mart_hourly_stream_evolution
[0m10:33:11.749324 [debug] [Thread-1 (]: Writing injected SQL for node "model.my_dbt_trino_project.mart_hourly_stream_evolution"
[0m10:33:11.749324 [debug] [Thread-1 (]: Began executing node model.my_dbt_trino_project.mart_hourly_stream_evolution
[0m10:33:11.781680 [debug] [Thread-1 (]: Writing runtime sql for node "model.my_dbt_trino_project.mart_hourly_stream_evolution"
[0m10:33:11.782680 [debug] [Thread-1 (]: Using trino connection "model.my_dbt_trino_project.mart_hourly_stream_evolution"
[0m10:33:11.783680 [debug] [Thread-1 (]: On model.my_dbt_trino_project.mart_hourly_stream_evolution: /* {"app": "dbt", "dbt_version": "1.8.2", "profile_name": "my_dbt_trino_project", "target_name": "dev", "node_id": "model.my_dbt_trino_project.mart_hourly_stream_evolution"} */

  
    

    create table "datalake"."analytics"."mart_hourly_stream_evolution__dbt_tmp"
      
      
    as (
      

SELECT
    stream_date,
    stream_hour,
    total_streams,
    SUM(total_streams) OVER (PARTITION BY stream_date ORDER BY stream_hour) AS cumulative_streams
FROM "datalake"."analytics_stage"."stg_streams_hourly"
ORDER BY
    stream_date,
    stream_hour
    )
[0m10:33:11.783680 [debug] [Thread-1 (]: Opening a new connection, currently in state init
[0m10:33:11.974013 [debug] [Thread-1 (]: SQL status: SUCCESS in 0.0 seconds
[0m10:33:11.979437 [debug] [Thread-1 (]: Using trino connection "model.my_dbt_trino_project.mart_hourly_stream_evolution"
[0m10:33:11.980437 [debug] [Thread-1 (]: On model.my_dbt_trino_project.mart_hourly_stream_evolution: /* {"app": "dbt", "dbt_version": "1.8.2", "profile_name": "my_dbt_trino_project", "target_name": "dev", "node_id": "model.my_dbt_trino_project.mart_hourly_stream_evolution"} */
alter table "datalake"."analytics"."mart_hourly_stream_evolution" rename to "datalake"."analytics"."mart_hourly_stream_evolution__dbt_backup"
[0m10:33:12.060310 [debug] [Thread-1 (]: SQL status: SUCCESS in 0.0 seconds
[0m10:33:12.065308 [debug] [Thread-1 (]: Using trino connection "model.my_dbt_trino_project.mart_hourly_stream_evolution"
[0m10:33:12.066308 [debug] [Thread-1 (]: On model.my_dbt_trino_project.mart_hourly_stream_evolution: /* {"app": "dbt", "dbt_version": "1.8.2", "profile_name": "my_dbt_trino_project", "target_name": "dev", "node_id": "model.my_dbt_trino_project.mart_hourly_stream_evolution"} */
alter table "datalake"."analytics"."mart_hourly_stream_evolution__dbt_tmp" rename to "datalake"."analytics"."mart_hourly_stream_evolution"
[0m10:33:12.151552 [debug] [Thread-1 (]: SQL status: SUCCESS in 0.0 seconds
[0m10:33:12.158558 [debug] [Thread-1 (]: Applying DROP to: "datalake"."analytics"."mart_hourly_stream_evolution__dbt_backup"
[0m10:33:12.160555 [debug] [Thread-1 (]: Using trino connection "model.my_dbt_trino_project.mart_hourly_stream_evolution"
[0m10:33:12.160555 [debug] [Thread-1 (]: On model.my_dbt_trino_project.mart_hourly_stream_evolution: /* {"app": "dbt", "dbt_version": "1.8.2", "profile_name": "my_dbt_trino_project", "target_name": "dev", "node_id": "model.my_dbt_trino_project.mart_hourly_stream_evolution"} */

    drop table if exists "datalake"."analytics"."mart_hourly_stream_evolution__dbt_backup"
[0m10:33:12.266780 [debug] [Thread-1 (]: SQL status: SUCCESS in 0.0 seconds
[0m10:33:12.278972 [debug] [Thread-1 (]: On model.my_dbt_trino_project.mart_hourly_stream_evolution: ROLLBACK
[0m10:33:12.278972 [debug] [Thread-1 (]: On model.my_dbt_trino_project.mart_hourly_stream_evolution: Close
[0m10:33:12.279971 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '7004cc7b-5b21-416d-9181-0d37c496d6ef', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000001FAD6197DD0>]}
[0m10:33:12.280976 [info ] [Thread-1 (]: 1 of 6 OK created sql table model analytics.mart_hourly_stream_evolution ....... [[32mSUCCESS[0m in 0.53s]
[0m10:33:12.281972 [debug] [Thread-1 (]: Finished running node model.my_dbt_trino_project.mart_hourly_stream_evolution
[0m10:33:12.281972 [debug] [Thread-1 (]: Began running node model.my_dbt_trino_project.mart_top_songs_artists
[0m10:33:12.282971 [info ] [Thread-1 (]: 2 of 6 START sql table model analytics.mart_top_songs_artists .................. [RUN]
[0m10:33:12.282971 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.my_dbt_trino_project.mart_hourly_stream_evolution, now model.my_dbt_trino_project.mart_top_songs_artists)
[0m10:33:12.283971 [debug] [Thread-1 (]: Began compiling node model.my_dbt_trino_project.mart_top_songs_artists
[0m10:33:12.285975 [debug] [Thread-1 (]: Writing injected SQL for node "model.my_dbt_trino_project.mart_top_songs_artists"
[0m10:33:12.285975 [debug] [Thread-1 (]: Began executing node model.my_dbt_trino_project.mart_top_songs_artists
[0m10:33:12.288971 [debug] [Thread-1 (]: Writing runtime sql for node "model.my_dbt_trino_project.mart_top_songs_artists"
[0m10:33:12.289971 [debug] [Thread-1 (]: Using trino connection "model.my_dbt_trino_project.mart_top_songs_artists"
[0m10:33:12.289971 [debug] [Thread-1 (]: On model.my_dbt_trino_project.mart_top_songs_artists: /* {"app": "dbt", "dbt_version": "1.8.2", "profile_name": "my_dbt_trino_project", "target_name": "dev", "node_id": "model.my_dbt_trino_project.mart_top_songs_artists"} */

  
    

    create table "datalake"."analytics"."mart_top_songs_artists__dbt_tmp"
      
      
    as (
      

WITH top_songs AS (
    SELECT
        artist,
        song,
        play_count
    FROM "datalake"."analytics_stage"."stg_top_songs_artists"
)

SELECT
    artist,
    song,
    play_count
FROM top_songs
    )
[0m10:33:12.290971 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m10:33:12.510998 [debug] [Thread-1 (]: SQL status: SUCCESS in 0.0 seconds
[0m10:33:12.513534 [debug] [Thread-1 (]: Using trino connection "model.my_dbt_trino_project.mart_top_songs_artists"
[0m10:33:12.513534 [debug] [Thread-1 (]: On model.my_dbt_trino_project.mart_top_songs_artists: /* {"app": "dbt", "dbt_version": "1.8.2", "profile_name": "my_dbt_trino_project", "target_name": "dev", "node_id": "model.my_dbt_trino_project.mart_top_songs_artists"} */
alter table "datalake"."analytics"."mart_top_songs_artists" rename to "datalake"."analytics"."mart_top_songs_artists__dbt_backup"
[0m10:33:12.588066 [debug] [Thread-1 (]: SQL status: SUCCESS in 0.0 seconds
[0m10:33:12.591676 [debug] [Thread-1 (]: Using trino connection "model.my_dbt_trino_project.mart_top_songs_artists"
[0m10:33:12.591676 [debug] [Thread-1 (]: On model.my_dbt_trino_project.mart_top_songs_artists: /* {"app": "dbt", "dbt_version": "1.8.2", "profile_name": "my_dbt_trino_project", "target_name": "dev", "node_id": "model.my_dbt_trino_project.mart_top_songs_artists"} */
alter table "datalake"."analytics"."mart_top_songs_artists__dbt_tmp" rename to "datalake"."analytics"."mart_top_songs_artists"
[0m10:33:12.681786 [debug] [Thread-1 (]: SQL status: SUCCESS in 0.0 seconds
[0m10:33:12.685301 [debug] [Thread-1 (]: Applying DROP to: "datalake"."analytics"."mart_top_songs_artists__dbt_backup"
[0m10:33:12.686504 [debug] [Thread-1 (]: Using trino connection "model.my_dbt_trino_project.mart_top_songs_artists"
[0m10:33:12.686504 [debug] [Thread-1 (]: On model.my_dbt_trino_project.mart_top_songs_artists: /* {"app": "dbt", "dbt_version": "1.8.2", "profile_name": "my_dbt_trino_project", "target_name": "dev", "node_id": "model.my_dbt_trino_project.mart_top_songs_artists"} */

    drop table if exists "datalake"."analytics"."mart_top_songs_artists__dbt_backup"
[0m10:33:12.793996 [debug] [Thread-1 (]: SQL status: SUCCESS in 0.0 seconds
[0m10:33:12.794997 [debug] [Thread-1 (]: On model.my_dbt_trino_project.mart_top_songs_artists: ROLLBACK
[0m10:33:12.795995 [debug] [Thread-1 (]: On model.my_dbt_trino_project.mart_top_songs_artists: Close
[0m10:33:12.795995 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '7004cc7b-5b21-416d-9181-0d37c496d6ef', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000001FAD6FC9850>]}
[0m10:33:12.796996 [info ] [Thread-1 (]: 2 of 6 OK created sql table model analytics.mart_top_songs_artists ............. [[32mSUCCESS[0m in 0.51s]
[0m10:33:12.796996 [debug] [Thread-1 (]: Finished running node model.my_dbt_trino_project.mart_top_songs_artists
[0m10:33:12.798091 [debug] [Thread-1 (]: Began running node model.my_dbt_trino_project.mart_total_unique_users
[0m10:33:12.798091 [info ] [Thread-1 (]: 3 of 6 START sql table model analytics.mart_total_unique_users ................. [RUN]
[0m10:33:12.799139 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.my_dbt_trino_project.mart_top_songs_artists, now model.my_dbt_trino_project.mart_total_unique_users)
[0m10:33:12.799139 [debug] [Thread-1 (]: Began compiling node model.my_dbt_trino_project.mart_total_unique_users
[0m10:33:12.802144 [debug] [Thread-1 (]: Writing injected SQL for node "model.my_dbt_trino_project.mart_total_unique_users"
[0m10:33:12.802144 [debug] [Thread-1 (]: Began executing node model.my_dbt_trino_project.mart_total_unique_users
[0m10:33:12.806144 [debug] [Thread-1 (]: Writing runtime sql for node "model.my_dbt_trino_project.mart_total_unique_users"
[0m10:33:12.807145 [debug] [Thread-1 (]: Using trino connection "model.my_dbt_trino_project.mart_total_unique_users"
[0m10:33:12.808146 [debug] [Thread-1 (]: On model.my_dbt_trino_project.mart_total_unique_users: /* {"app": "dbt", "dbt_version": "1.8.2", "profile_name": "my_dbt_trino_project", "target_name": "dev", "node_id": "model.my_dbt_trino_project.mart_total_unique_users"} */

  
    

    create table "datalake"."analytics"."mart_total_unique_users__dbt_tmp"
      
      
    as (
      

SELECT
    total_unique_users
FROM "datalake"."analytics_stage"."stg_unique_users"
    )
[0m10:33:12.808659 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m10:33:13.009272 [debug] [Thread-1 (]: SQL status: SUCCESS in 0.0 seconds
[0m10:33:13.012273 [debug] [Thread-1 (]: Using trino connection "model.my_dbt_trino_project.mart_total_unique_users"
[0m10:33:13.012273 [debug] [Thread-1 (]: On model.my_dbt_trino_project.mart_total_unique_users: /* {"app": "dbt", "dbt_version": "1.8.2", "profile_name": "my_dbt_trino_project", "target_name": "dev", "node_id": "model.my_dbt_trino_project.mart_total_unique_users"} */
alter table "datalake"."analytics"."mart_total_unique_users" rename to "datalake"."analytics"."mart_total_unique_users__dbt_backup"
[0m10:33:13.096118 [debug] [Thread-1 (]: SQL status: SUCCESS in 0.0 seconds
[0m10:33:13.099117 [debug] [Thread-1 (]: Using trino connection "model.my_dbt_trino_project.mart_total_unique_users"
[0m10:33:13.100177 [debug] [Thread-1 (]: On model.my_dbt_trino_project.mart_total_unique_users: /* {"app": "dbt", "dbt_version": "1.8.2", "profile_name": "my_dbt_trino_project", "target_name": "dev", "node_id": "model.my_dbt_trino_project.mart_total_unique_users"} */
alter table "datalake"."analytics"."mart_total_unique_users__dbt_tmp" rename to "datalake"."analytics"."mart_total_unique_users"
[0m10:33:13.180309 [debug] [Thread-1 (]: SQL status: SUCCESS in 0.0 seconds
[0m10:33:13.182819 [debug] [Thread-1 (]: Applying DROP to: "datalake"."analytics"."mart_total_unique_users__dbt_backup"
[0m10:33:13.183818 [debug] [Thread-1 (]: Using trino connection "model.my_dbt_trino_project.mart_total_unique_users"
[0m10:33:13.183818 [debug] [Thread-1 (]: On model.my_dbt_trino_project.mart_total_unique_users: /* {"app": "dbt", "dbt_version": "1.8.2", "profile_name": "my_dbt_trino_project", "target_name": "dev", "node_id": "model.my_dbt_trino_project.mart_total_unique_users"} */

    drop table if exists "datalake"."analytics"."mart_total_unique_users__dbt_backup"
[0m10:33:13.288478 [debug] [Thread-1 (]: SQL status: SUCCESS in 0.0 seconds
[0m10:33:13.289533 [debug] [Thread-1 (]: On model.my_dbt_trino_project.mart_total_unique_users: ROLLBACK
[0m10:33:13.290538 [debug] [Thread-1 (]: On model.my_dbt_trino_project.mart_total_unique_users: Close
[0m10:33:13.290538 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '7004cc7b-5b21-416d-9181-0d37c496d6ef', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000001FAD6197DD0>]}
[0m10:33:13.290538 [info ] [Thread-1 (]: 3 of 6 OK created sql table model analytics.mart_total_unique_users ............ [[32mSUCCESS[0m in 0.49s]
[0m10:33:13.292436 [debug] [Thread-1 (]: Finished running node model.my_dbt_trino_project.mart_total_unique_users
[0m10:33:13.292436 [debug] [Thread-1 (]: Began running node model.my_dbt_trino_project.mart_user_activity_per_country
[0m10:33:13.292436 [info ] [Thread-1 (]: 4 of 6 START sql table model analytics.mart_user_activity_per_country .......... [RUN]
[0m10:33:13.293632 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.my_dbt_trino_project.mart_total_unique_users, now model.my_dbt_trino_project.mart_user_activity_per_country)
[0m10:33:13.293632 [debug] [Thread-1 (]: Began compiling node model.my_dbt_trino_project.mart_user_activity_per_country
[0m10:33:13.296444 [debug] [Thread-1 (]: Writing injected SQL for node "model.my_dbt_trino_project.mart_user_activity_per_country"
[0m10:33:13.296444 [debug] [Thread-1 (]: Began executing node model.my_dbt_trino_project.mart_user_activity_per_country
[0m10:33:13.299441 [debug] [Thread-1 (]: Writing runtime sql for node "model.my_dbt_trino_project.mart_user_activity_per_country"
[0m10:33:13.300440 [debug] [Thread-1 (]: Using trino connection "model.my_dbt_trino_project.mart_user_activity_per_country"
[0m10:33:13.301440 [debug] [Thread-1 (]: On model.my_dbt_trino_project.mart_user_activity_per_country: /* {"app": "dbt", "dbt_version": "1.8.2", "profile_name": "my_dbt_trino_project", "target_name": "dev", "node_id": "model.my_dbt_trino_project.mart_user_activity_per_country"} */

  
    

    create table "datalake"."analytics"."mart_user_activity_per_country__dbt_tmp"
      
      
    as (
      

SELECT
  country,
  SUM(activity_count) AS total_activity
FROM "datalake"."analytics_stage"."stg_user_activity_per_country"
GROUP BY country
ORDER BY SUM(activity_count) DESC
    )
[0m10:33:13.301492 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m10:33:13.550851 [debug] [Thread-1 (]: SQL status: SUCCESS in 0.0 seconds
[0m10:33:13.553926 [debug] [Thread-1 (]: Using trino connection "model.my_dbt_trino_project.mart_user_activity_per_country"
[0m10:33:13.554926 [debug] [Thread-1 (]: On model.my_dbt_trino_project.mart_user_activity_per_country: /* {"app": "dbt", "dbt_version": "1.8.2", "profile_name": "my_dbt_trino_project", "target_name": "dev", "node_id": "model.my_dbt_trino_project.mart_user_activity_per_country"} */
alter table "datalake"."analytics"."mart_user_activity_per_country" rename to "datalake"."analytics"."mart_user_activity_per_country__dbt_backup"
[0m10:33:13.642575 [debug] [Thread-1 (]: SQL status: SUCCESS in 0.0 seconds
[0m10:33:13.645204 [debug] [Thread-1 (]: Using trino connection "model.my_dbt_trino_project.mart_user_activity_per_country"
[0m10:33:13.645733 [debug] [Thread-1 (]: On model.my_dbt_trino_project.mart_user_activity_per_country: /* {"app": "dbt", "dbt_version": "1.8.2", "profile_name": "my_dbt_trino_project", "target_name": "dev", "node_id": "model.my_dbt_trino_project.mart_user_activity_per_country"} */
alter table "datalake"."analytics"."mart_user_activity_per_country__dbt_tmp" rename to "datalake"."analytics"."mart_user_activity_per_country"
[0m10:33:13.741845 [debug] [Thread-1 (]: SQL status: SUCCESS in 0.0 seconds
[0m10:33:13.744844 [debug] [Thread-1 (]: Applying DROP to: "datalake"."analytics"."mart_user_activity_per_country__dbt_backup"
[0m10:33:13.744844 [debug] [Thread-1 (]: Using trino connection "model.my_dbt_trino_project.mart_user_activity_per_country"
[0m10:33:13.745843 [debug] [Thread-1 (]: On model.my_dbt_trino_project.mart_user_activity_per_country: /* {"app": "dbt", "dbt_version": "1.8.2", "profile_name": "my_dbt_trino_project", "target_name": "dev", "node_id": "model.my_dbt_trino_project.mart_user_activity_per_country"} */

    drop table if exists "datalake"."analytics"."mart_user_activity_per_country__dbt_backup"
[0m10:33:13.863751 [debug] [Thread-1 (]: SQL status: SUCCESS in 0.0 seconds
[0m10:33:13.864754 [debug] [Thread-1 (]: On model.my_dbt_trino_project.mart_user_activity_per_country: ROLLBACK
[0m10:33:13.865752 [debug] [Thread-1 (]: On model.my_dbt_trino_project.mart_user_activity_per_country: Close
[0m10:33:13.865752 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '7004cc7b-5b21-416d-9181-0d37c496d6ef', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000001FAD70249D0>]}
[0m10:33:13.866755 [info ] [Thread-1 (]: 4 of 6 OK created sql table model analytics.mart_user_activity_per_country ..... [[32mSUCCESS[0m in 0.57s]
[0m10:33:13.867750 [debug] [Thread-1 (]: Finished running node model.my_dbt_trino_project.mart_user_activity_per_country
[0m10:33:13.867750 [debug] [Thread-1 (]: Began running node model.my_dbt_trino_project.mart_user_activity_per_state
[0m10:33:13.868751 [info ] [Thread-1 (]: 5 of 6 START sql table model analytics.mart_user_activity_per_state ............ [RUN]
[0m10:33:13.868751 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.my_dbt_trino_project.mart_user_activity_per_country, now model.my_dbt_trino_project.mart_user_activity_per_state)
[0m10:33:13.869749 [debug] [Thread-1 (]: Began compiling node model.my_dbt_trino_project.mart_user_activity_per_state
[0m10:33:13.872213 [debug] [Thread-1 (]: Writing injected SQL for node "model.my_dbt_trino_project.mart_user_activity_per_state"
[0m10:33:13.872213 [debug] [Thread-1 (]: Began executing node model.my_dbt_trino_project.mart_user_activity_per_state
[0m10:33:13.929481 [debug] [Thread-1 (]: Writing runtime sql for node "model.my_dbt_trino_project.mart_user_activity_per_state"
[0m10:33:13.930481 [debug] [Thread-1 (]: Using trino connection "model.my_dbt_trino_project.mart_user_activity_per_state"
[0m10:33:13.930481 [debug] [Thread-1 (]: On model.my_dbt_trino_project.mart_user_activity_per_state: /* {"app": "dbt", "dbt_version": "1.8.2", "profile_name": "my_dbt_trino_project", "target_name": "dev", "node_id": "model.my_dbt_trino_project.mart_user_activity_per_state"} */

  
    

    create table "datalake"."analytics"."mart_user_activity_per_state__dbt_tmp"
      
      
    as (
      

SELECT
  state,
  city,
  SUM(activity_count) AS total_activity
FROM "datalake"."analytics_stage"."stg_user_activity_per_location"
GROUP BY state, city
ORDER BY state, SUM(activity_count) DESC
    )
[0m10:33:13.931481 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m10:33:14.173277 [debug] [Thread-1 (]: SQL status: SUCCESS in 0.0 seconds
[0m10:33:14.176794 [debug] [Thread-1 (]: Using trino connection "model.my_dbt_trino_project.mart_user_activity_per_state"
[0m10:33:14.176794 [debug] [Thread-1 (]: On model.my_dbt_trino_project.mart_user_activity_per_state: /* {"app": "dbt", "dbt_version": "1.8.2", "profile_name": "my_dbt_trino_project", "target_name": "dev", "node_id": "model.my_dbt_trino_project.mart_user_activity_per_state"} */
alter table "datalake"."analytics"."mart_user_activity_per_state" rename to "datalake"."analytics"."mart_user_activity_per_state__dbt_backup"
[0m10:33:14.261747 [debug] [Thread-1 (]: SQL status: SUCCESS in 0.0 seconds
[0m10:33:14.264746 [debug] [Thread-1 (]: Using trino connection "model.my_dbt_trino_project.mart_user_activity_per_state"
[0m10:33:14.264746 [debug] [Thread-1 (]: On model.my_dbt_trino_project.mart_user_activity_per_state: /* {"app": "dbt", "dbt_version": "1.8.2", "profile_name": "my_dbt_trino_project", "target_name": "dev", "node_id": "model.my_dbt_trino_project.mart_user_activity_per_state"} */
alter table "datalake"."analytics"."mart_user_activity_per_state__dbt_tmp" rename to "datalake"."analytics"."mart_user_activity_per_state"
[0m10:33:14.358649 [debug] [Thread-1 (]: SQL status: SUCCESS in 0.0 seconds
[0m10:33:14.360656 [debug] [Thread-1 (]: Applying DROP to: "datalake"."analytics"."mart_user_activity_per_state__dbt_backup"
[0m10:33:14.361658 [debug] [Thread-1 (]: Using trino connection "model.my_dbt_trino_project.mart_user_activity_per_state"
[0m10:33:14.361658 [debug] [Thread-1 (]: On model.my_dbt_trino_project.mart_user_activity_per_state: /* {"app": "dbt", "dbt_version": "1.8.2", "profile_name": "my_dbt_trino_project", "target_name": "dev", "node_id": "model.my_dbt_trino_project.mart_user_activity_per_state"} */

    drop table if exists "datalake"."analytics"."mart_user_activity_per_state__dbt_backup"
[0m10:33:14.460215 [debug] [Thread-1 (]: SQL status: SUCCESS in 0.0 seconds
[0m10:33:14.462218 [debug] [Thread-1 (]: On model.my_dbt_trino_project.mart_user_activity_per_state: ROLLBACK
[0m10:33:14.462218 [debug] [Thread-1 (]: On model.my_dbt_trino_project.mart_user_activity_per_state: Close
[0m10:33:14.463219 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '7004cc7b-5b21-416d-9181-0d37c496d6ef', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000001FAD6D75590>]}
[0m10:33:14.463219 [info ] [Thread-1 (]: 5 of 6 OK created sql table model analytics.mart_user_activity_per_state ....... [[32mSUCCESS[0m in 0.59s]
[0m10:33:14.464219 [debug] [Thread-1 (]: Finished running node model.my_dbt_trino_project.mart_user_activity_per_state
[0m10:33:14.464219 [debug] [Thread-1 (]: Began running node model.my_dbt_trino_project.mart_user_level_by_gender
[0m10:33:14.465216 [info ] [Thread-1 (]: 6 of 6 START sql table model analytics.mart_user_level_by_gender ............... [RUN]
[0m10:33:14.465216 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.my_dbt_trino_project.mart_user_activity_per_state, now model.my_dbt_trino_project.mart_user_level_by_gender)
[0m10:33:14.466434 [debug] [Thread-1 (]: Began compiling node model.my_dbt_trino_project.mart_user_level_by_gender
[0m10:33:14.468636 [debug] [Thread-1 (]: Writing injected SQL for node "model.my_dbt_trino_project.mart_user_level_by_gender"
[0m10:33:14.468636 [debug] [Thread-1 (]: Began executing node model.my_dbt_trino_project.mart_user_level_by_gender
[0m10:33:14.472081 [debug] [Thread-1 (]: Writing runtime sql for node "model.my_dbt_trino_project.mart_user_level_by_gender"
[0m10:33:14.473084 [debug] [Thread-1 (]: Using trino connection "model.my_dbt_trino_project.mart_user_level_by_gender"
[0m10:33:14.473084 [debug] [Thread-1 (]: On model.my_dbt_trino_project.mart_user_level_by_gender: /* {"app": "dbt", "dbt_version": "1.8.2", "profile_name": "my_dbt_trino_project", "target_name": "dev", "node_id": "model.my_dbt_trino_project.mart_user_level_by_gender"} */

  
    

    create table "datalake"."analytics"."mart_user_level_by_gender__dbt_tmp"
      
      
    as (
      

SELECT
    gender,
    level,
    SUM(user_count) AS total_users,
    ROUND(SUM(user_count) * 100.0 / SUM(SUM(user_count)) OVER (), 2) AS percentage_of_total_users
FROM "datalake"."analytics_stage"."stg_user_level_by_gender"
GROUP BY gender, level
    )
[0m10:33:14.473084 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m10:33:14.704581 [debug] [Thread-1 (]: SQL status: SUCCESS in 0.0 seconds
[0m10:33:14.707969 [debug] [Thread-1 (]: Using trino connection "model.my_dbt_trino_project.mart_user_level_by_gender"
[0m10:33:14.707969 [debug] [Thread-1 (]: On model.my_dbt_trino_project.mart_user_level_by_gender: /* {"app": "dbt", "dbt_version": "1.8.2", "profile_name": "my_dbt_trino_project", "target_name": "dev", "node_id": "model.my_dbt_trino_project.mart_user_level_by_gender"} */
alter table "datalake"."analytics"."mart_user_level_by_gender" rename to "datalake"."analytics"."mart_user_level_by_gender__dbt_backup"
[0m10:33:14.794083 [debug] [Thread-1 (]: SQL status: SUCCESS in 0.0 seconds
[0m10:33:14.797079 [debug] [Thread-1 (]: Using trino connection "model.my_dbt_trino_project.mart_user_level_by_gender"
[0m10:33:14.798077 [debug] [Thread-1 (]: On model.my_dbt_trino_project.mart_user_level_by_gender: /* {"app": "dbt", "dbt_version": "1.8.2", "profile_name": "my_dbt_trino_project", "target_name": "dev", "node_id": "model.my_dbt_trino_project.mart_user_level_by_gender"} */
alter table "datalake"."analytics"."mart_user_level_by_gender__dbt_tmp" rename to "datalake"."analytics"."mart_user_level_by_gender"
[0m10:33:14.890210 [debug] [Thread-1 (]: SQL status: SUCCESS in 0.0 seconds
[0m10:33:14.892715 [debug] [Thread-1 (]: Applying DROP to: "datalake"."analytics"."mart_user_level_by_gender__dbt_backup"
[0m10:33:14.893719 [debug] [Thread-1 (]: Using trino connection "model.my_dbt_trino_project.mart_user_level_by_gender"
[0m10:33:14.893719 [debug] [Thread-1 (]: On model.my_dbt_trino_project.mart_user_level_by_gender: /* {"app": "dbt", "dbt_version": "1.8.2", "profile_name": "my_dbt_trino_project", "target_name": "dev", "node_id": "model.my_dbt_trino_project.mart_user_level_by_gender"} */

    drop table if exists "datalake"."analytics"."mart_user_level_by_gender__dbt_backup"
[0m10:33:14.991915 [debug] [Thread-1 (]: SQL status: SUCCESS in 0.0 seconds
[0m10:33:14.992923 [debug] [Thread-1 (]: On model.my_dbt_trino_project.mart_user_level_by_gender: ROLLBACK
[0m10:33:14.993924 [debug] [Thread-1 (]: On model.my_dbt_trino_project.mart_user_level_by_gender: Close
[0m10:33:14.993924 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '7004cc7b-5b21-416d-9181-0d37c496d6ef', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000001FAD6B18810>]}
[0m10:33:14.993924 [info ] [Thread-1 (]: 6 of 6 OK created sql table model analytics.mart_user_level_by_gender .......... [[32mSUCCESS[0m in 0.53s]
[0m10:33:14.995390 [debug] [Thread-1 (]: Finished running node model.my_dbt_trino_project.mart_user_level_by_gender
[0m10:33:14.996400 [debug] [MainThread]: On master: COMMIT
[0m10:33:14.997399 [debug] [MainThread]: Connection 'master' was properly closed.
[0m10:33:14.997399 [debug] [MainThread]: Connection 'list_datalake' was properly closed.
[0m10:33:14.997399 [debug] [MainThread]: Connection 'list_datalake_analytics_stage' was properly closed.
[0m10:33:14.997399 [debug] [MainThread]: Connection 'model.my_dbt_trino_project.mart_user_level_by_gender' was properly closed.
[0m10:33:14.998400 [info ] [MainThread]: 
[0m10:33:14.998400 [info ] [MainThread]: Finished running 6 table models in 0 hours 0 minutes and 3.53 seconds (3.53s).
[0m10:33:14.999400 [debug] [MainThread]: Command end result
[0m10:33:15.034041 [info ] [MainThread]: 
[0m10:33:15.035042 [info ] [MainThread]: [32mCompleted successfully[0m
[0m10:33:15.036042 [info ] [MainThread]: 
[0m10:33:15.036042 [info ] [MainThread]: Done. PASS=6 WARN=0 ERROR=0 SKIP=0 TOTAL=6
[0m10:33:15.037047 [debug] [MainThread]: Command `dbt run` succeeded at 10:33:15.037047 after 4.33 seconds
[0m10:33:15.038043 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000001FAD165E310>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000001FAD165E2D0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000001FAD165E350>]}
[0m10:33:15.038043 [debug] [MainThread]: Flushing usage events
[0m10:36:12.775551 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000001A6BBC56910>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000001A6BBC473D0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000001A6BBC5A810>]}


============================== 10:36:12.778551 | ad86cf40-e840-4e1c-afc0-18283c1d4899 ==============================
[0m10:36:12.778551 [info ] [MainThread]: Running with dbt=1.8.2
[0m10:36:12.779362 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'indirect_selection': 'eager', 'write_json': 'True', 'log_cache_events': 'False', 'partial_parse': 'True', 'cache_selected_only': 'False', 'profiles_dir': 'C:\\Users\\ASUS\\Desktop\\work\\Iceberg-Dbt-Trino-Hive-modern-open-source-data-stack-main\\dbt', 'version_check': 'True', 'warn_error': 'None', 'log_path': 'C:\\Users\\ASUS\\Desktop\\work\\Iceberg-Dbt-Trino-Hive-modern-open-source-data-stack-main\\dbt\\logs', 'fail_fast': 'False', 'debug': 'False', 'use_colors': 'True', 'use_experimental_parser': 'False', 'no_print': 'None', 'quiet': 'False', 'log_format': 'default', 'static_parser': 'True', 'introspect': 'True', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'target_path': 'None', 'invocation_command': 'dbt run', 'send_anonymous_usage_stats': 'True'}
[0m10:36:13.079109 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': 'ad86cf40-e840-4e1c-afc0-18283c1d4899', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000001A6BBFA4D50>]}
[0m10:36:13.112166 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': 'ad86cf40-e840-4e1c-afc0-18283c1d4899', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000001A6B8DD5310>]}
[0m10:36:13.113166 [info ] [MainThread]: Registered adapter: trino=1.8.0
[0m10:36:13.122166 [debug] [MainThread]: checksum: f0a141b9de567cb7f131613ba2682f40b3a1c6a157f81c6e5435862eff68f109, vars: {}, profile: , target: , version: 1.8.2
[0m10:36:13.276703 [debug] [MainThread]: Partial parsing enabled: 6 files deleted, 6 files added, 0 files changed.
[0m10:36:13.277703 [debug] [MainThread]: Partial parsing: added file: my_dbt_trino_project://models\mart\mart_user_level_by_gender.sql
[0m10:36:13.277703 [debug] [MainThread]: Partial parsing: added file: my_dbt_trino_project://models\mart\mart_total_unique_users.sql
[0m10:36:13.277703 [debug] [MainThread]: Partial parsing: added file: my_dbt_trino_project://models\mart\mart_hourly_stream_evolution.sql
[0m10:36:13.278702 [debug] [MainThread]: Partial parsing: added file: my_dbt_trino_project://models\mart\mart_user_activity_per_country.sql
[0m10:36:13.278702 [debug] [MainThread]: Partial parsing: added file: my_dbt_trino_project://models\mart\mart_user_activity_per_state.sql
[0m10:36:13.278702 [debug] [MainThread]: Partial parsing: added file: my_dbt_trino_project://models\mart\mart_top_songs_artists.sql
[0m10:36:13.279702 [debug] [MainThread]: Partial parsing: deleted file: my_dbt_trino_project://models\marts\mart_user_activity_per_country.sql
[0m10:36:13.279702 [debug] [MainThread]: Partial parsing: deleted file: my_dbt_trino_project://models\marts\mart_user_activity_per_state.sql
[0m10:36:13.279702 [debug] [MainThread]: Partial parsing: deleted file: my_dbt_trino_project://models\marts\mart_top_songs_artists.sql
[0m10:36:13.279702 [debug] [MainThread]: Partial parsing: deleted file: my_dbt_trino_project://models\marts\mart_total_unique_users.sql
[0m10:36:13.280702 [debug] [MainThread]: Partial parsing: deleted file: my_dbt_trino_project://models\marts\mart_hourly_stream_evolution.sql
[0m10:36:13.280702 [debug] [MainThread]: Partial parsing: deleted file: my_dbt_trino_project://models\marts\mart_user_level_by_gender.sql
[0m10:36:13.464168 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': 'ad86cf40-e840-4e1c-afc0-18283c1d4899', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000001A6BC134C90>]}
[0m10:36:13.527242 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': 'ad86cf40-e840-4e1c-afc0-18283c1d4899', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000001A6BC474610>]}
[0m10:36:13.527242 [info ] [MainThread]: Found 15 models, 7 data tests, 3 sources, 559 macros
[0m10:36:13.528242 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': 'ad86cf40-e840-4e1c-afc0-18283c1d4899', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000001A6BC510ED0>]}
[0m10:36:13.530242 [info ] [MainThread]: 
[0m10:36:13.530454 [debug] [MainThread]: Acquiring new trino connection 'master'
[0m10:36:13.534944 [debug] [ThreadPool]: Acquiring new trino connection 'list_datalake'
[0m10:36:13.592949 [debug] [ThreadPool]: Using trino connection "list_datalake"
[0m10:36:13.592949 [debug] [ThreadPool]: On list_datalake: /* {"app": "dbt", "dbt_version": "1.8.2", "profile_name": "my_dbt_trino_project", "target_name": "dev", "connection_name": "list_datalake"} */

    select schema_name
    from "datalake".INFORMATION_SCHEMA.schemata
[0m10:36:13.592949 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m10:36:13.634698 [debug] [ThreadPool]: SQL status: SUCCESS in 0.0 seconds
[0m10:36:13.635760 [debug] [ThreadPool]: On list_datalake: Close
[0m10:36:13.638758 [debug] [ThreadPool]: Using trino connection "list_datalake"
[0m10:36:13.638758 [debug] [ThreadPool]: On list_datalake: /* {"app": "dbt", "dbt_version": "1.8.2", "profile_name": "my_dbt_trino_project", "target_name": "dev", "connection_name": "list_datalake"} */

    select schema_name
    from "datalake".INFORMATION_SCHEMA.schemata
[0m10:36:13.638758 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m10:36:13.681005 [debug] [ThreadPool]: SQL status: SUCCESS in 0.0 seconds
[0m10:36:13.682085 [debug] [ThreadPool]: On list_datalake: Close
[0m10:36:13.683517 [debug] [ThreadPool]: Using trino connection "list_datalake"
[0m10:36:13.684529 [debug] [ThreadPool]: On list_datalake: /* {"app": "dbt", "dbt_version": "1.8.2", "profile_name": "my_dbt_trino_project", "target_name": "dev", "connection_name": "list_datalake"} */

    select schema_name
    from "datalake".INFORMATION_SCHEMA.schemata
[0m10:36:13.684529 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m10:36:13.722802 [debug] [ThreadPool]: SQL status: SUCCESS in 0.0 seconds
[0m10:36:13.724364 [debug] [ThreadPool]: On list_datalake: Close
[0m10:36:13.726650 [debug] [ThreadPool]: Acquiring new trino connection 'list_datalake_analytics'
[0m10:36:13.735656 [debug] [ThreadPool]: Using trino connection "list_datalake_analytics"
[0m10:36:13.736659 [debug] [ThreadPool]: On list_datalake_analytics: /* {"app": "dbt", "dbt_version": "1.8.2", "profile_name": "my_dbt_trino_project", "target_name": "dev", "connection_name": "list_datalake_analytics"} */
select
      t.table_catalog as database,
      t.table_name as name,
      t.table_schema as schema,
      case when mv.name is not null then 'materialized_view'
           when t.table_type = 'BASE TABLE' then 'table'
           when t.table_type = 'VIEW' then 'view'
           else t.table_type
      end as table_type
    from "datalake".INFORMATION_SCHEMA.tables t
    left join (
            select * from system.metadata.materialized_views
            where catalog_name = 'datalake'
              and schema_name = 'analytics') mv
          on mv.catalog_name = t.table_catalog and mv.schema_name = t.table_schema and mv.name = t.table_name
    where t.table_schema = 'analytics'
[0m10:36:13.736659 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m10:36:13.798631 [debug] [ThreadPool]: SQL status: SUCCESS in 0.0 seconds
[0m10:36:13.799630 [debug] [ThreadPool]: On list_datalake_analytics: ROLLBACK
[0m10:36:13.799630 [debug] [ThreadPool]: On list_datalake_analytics: Close
[0m10:36:13.800633 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_datalake_analytics, now list_datalake_analytics_source)
[0m10:36:13.804145 [debug] [ThreadPool]: Using trino connection "list_datalake_analytics_source"
[0m10:36:13.805141 [debug] [ThreadPool]: On list_datalake_analytics_source: /* {"app": "dbt", "dbt_version": "1.8.2", "profile_name": "my_dbt_trino_project", "target_name": "dev", "connection_name": "list_datalake_analytics_source"} */
select
      t.table_catalog as database,
      t.table_name as name,
      t.table_schema as schema,
      case when mv.name is not null then 'materialized_view'
           when t.table_type = 'BASE TABLE' then 'table'
           when t.table_type = 'VIEW' then 'view'
           else t.table_type
      end as table_type
    from "datalake".INFORMATION_SCHEMA.tables t
    left join (
            select * from system.metadata.materialized_views
            where catalog_name = 'datalake'
              and schema_name = 'analytics_source') mv
          on mv.catalog_name = t.table_catalog and mv.schema_name = t.table_schema and mv.name = t.table_name
    where t.table_schema = 'analytics_source'
[0m10:36:13.805141 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m10:36:13.861858 [debug] [ThreadPool]: SQL status: SUCCESS in 0.0 seconds
[0m10:36:13.862921 [debug] [ThreadPool]: On list_datalake_analytics_source: ROLLBACK
[0m10:36:13.862921 [debug] [ThreadPool]: On list_datalake_analytics_source: Close
[0m10:36:13.863922 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_datalake_analytics_source, now list_datalake_analytics_stage)
[0m10:36:13.867141 [debug] [ThreadPool]: Using trino connection "list_datalake_analytics_stage"
[0m10:36:13.868141 [debug] [ThreadPool]: On list_datalake_analytics_stage: /* {"app": "dbt", "dbt_version": "1.8.2", "profile_name": "my_dbt_trino_project", "target_name": "dev", "connection_name": "list_datalake_analytics_stage"} */
select
      t.table_catalog as database,
      t.table_name as name,
      t.table_schema as schema,
      case when mv.name is not null then 'materialized_view'
           when t.table_type = 'BASE TABLE' then 'table'
           when t.table_type = 'VIEW' then 'view'
           else t.table_type
      end as table_type
    from "datalake".INFORMATION_SCHEMA.tables t
    left join (
            select * from system.metadata.materialized_views
            where catalog_name = 'datalake'
              and schema_name = 'analytics_stage') mv
          on mv.catalog_name = t.table_catalog and mv.schema_name = t.table_schema and mv.name = t.table_name
    where t.table_schema = 'analytics_stage'
[0m10:36:13.868141 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m10:36:13.926162 [debug] [ThreadPool]: SQL status: SUCCESS in 0.0 seconds
[0m10:36:13.927164 [debug] [ThreadPool]: On list_datalake_analytics_stage: ROLLBACK
[0m10:36:13.927164 [debug] [ThreadPool]: On list_datalake_analytics_stage: Close
[0m10:36:13.928511 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': 'ad86cf40-e840-4e1c-afc0-18283c1d4899', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000001A6BC105BD0>]}
[0m10:36:13.929865 [debug] [MainThread]: On master: COMMIT
[0m10:36:13.929865 [info ] [MainThread]: Concurrency: 1 threads (target='dev')
[0m10:36:13.929865 [info ] [MainThread]: 
[0m10:36:13.932354 [debug] [Thread-1 (]: Began running node model.my_dbt_trino_project.src_auth_events
[0m10:36:13.933364 [info ] [Thread-1 (]: 1 of 15 START sql table model analytics_source.src_auth_events ................. [RUN]
[0m10:36:13.933364 [debug] [Thread-1 (]: Acquiring new trino connection 'model.my_dbt_trino_project.src_auth_events'
[0m10:36:13.934366 [debug] [Thread-1 (]: Began compiling node model.my_dbt_trino_project.src_auth_events
[0m10:36:13.939600 [debug] [Thread-1 (]: Writing injected SQL for node "model.my_dbt_trino_project.src_auth_events"
[0m10:36:13.940600 [debug] [Thread-1 (]: Began executing node model.my_dbt_trino_project.src_auth_events
[0m10:36:13.970456 [debug] [Thread-1 (]: Writing runtime sql for node "model.my_dbt_trino_project.src_auth_events"
[0m10:36:13.975458 [debug] [Thread-1 (]: Using trino connection "model.my_dbt_trino_project.src_auth_events"
[0m10:36:13.976456 [debug] [Thread-1 (]: On model.my_dbt_trino_project.src_auth_events: /* {"app": "dbt", "dbt_version": "1.8.2", "profile_name": "my_dbt_trino_project", "target_name": "dev", "node_id": "model.my_dbt_trino_project.src_auth_events"} */

  
    

    create table "datalake"."analytics_source"."src_auth_events__dbt_tmp"
      
      
    as (
      

with source as (
    select
        CAST(ts AS VARCHAR) as id, 
        ts,
        CAST(sessionId AS VARCHAR) as sessionId,
        level,
        itemInSession,
        city,
        zip,
        state,
        userAgent,
        CAST(NULLIF(lon, '') AS double) as lon,
        CAST(NULLIF(lat, '') AS double) as lat,
        CAST(FLOOR(CAST(NULLIF(userId, '') AS DOUBLE)) AS INT) as userId, 
        lastName,
        firstName,
        gender,
        CAST(FLOOR(CAST(NULLIF(registration, '') AS DOUBLE)) AS BIGINT) as registration,
        success
    from "oltp"."public"."auth_events"
)

select
    id,
    ts,
    sessionId,
    level,
    itemInSession,
    city,
    zip,
    state,
    userAgent,
    lon,
    lat,
    userId,
    lastName,
    firstName,
    gender,
    registration, 
    CASE 
        WHEN CAST(success AS VARCHAR) = 't' THEN true 
        WHEN CAST(success AS VARCHAR) = 'f' THEN false
        ELSE NULL 
    END AS success_boolean
from source


    )
[0m10:36:13.977457 [debug] [Thread-1 (]: Opening a new connection, currently in state init
[0m10:36:14.210356 [debug] [Thread-1 (]: SQL status: SUCCESS in 0.0 seconds
[0m10:36:14.216349 [debug] [Thread-1 (]: Using trino connection "model.my_dbt_trino_project.src_auth_events"
[0m10:36:14.217350 [debug] [Thread-1 (]: On model.my_dbt_trino_project.src_auth_events: /* {"app": "dbt", "dbt_version": "1.8.2", "profile_name": "my_dbt_trino_project", "target_name": "dev", "node_id": "model.my_dbt_trino_project.src_auth_events"} */
alter table "datalake"."analytics_source"."src_auth_events" rename to "datalake"."analytics_source"."src_auth_events__dbt_backup"
[0m10:36:14.344463 [debug] [Thread-1 (]: SQL status: SUCCESS in 0.0 seconds
[0m10:36:14.347461 [debug] [Thread-1 (]: Using trino connection "model.my_dbt_trino_project.src_auth_events"
[0m10:36:14.347461 [debug] [Thread-1 (]: On model.my_dbt_trino_project.src_auth_events: /* {"app": "dbt", "dbt_version": "1.8.2", "profile_name": "my_dbt_trino_project", "target_name": "dev", "node_id": "model.my_dbt_trino_project.src_auth_events"} */
alter table "datalake"."analytics_source"."src_auth_events__dbt_tmp" rename to "datalake"."analytics_source"."src_auth_events"
[0m10:36:14.445553 [debug] [Thread-1 (]: SQL status: SUCCESS in 0.0 seconds
[0m10:36:14.451560 [debug] [Thread-1 (]: Applying DROP to: "datalake"."analytics_source"."src_auth_events__dbt_backup"
[0m10:36:14.453561 [debug] [Thread-1 (]: Using trino connection "model.my_dbt_trino_project.src_auth_events"
[0m10:36:14.454561 [debug] [Thread-1 (]: On model.my_dbt_trino_project.src_auth_events: /* {"app": "dbt", "dbt_version": "1.8.2", "profile_name": "my_dbt_trino_project", "target_name": "dev", "node_id": "model.my_dbt_trino_project.src_auth_events"} */

    drop table if exists "datalake"."analytics_source"."src_auth_events__dbt_backup"
[0m10:36:14.564406 [debug] [Thread-1 (]: SQL status: SUCCESS in 0.0 seconds
[0m10:36:14.576922 [debug] [Thread-1 (]: On model.my_dbt_trino_project.src_auth_events: ROLLBACK
[0m10:36:14.576922 [debug] [Thread-1 (]: On model.my_dbt_trino_project.src_auth_events: Close
[0m10:36:14.577920 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'ad86cf40-e840-4e1c-afc0-18283c1d4899', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000001A6BC1F2E10>]}
[0m10:36:14.578923 [info ] [Thread-1 (]: 1 of 15 OK created sql table model analytics_source.src_auth_events ............ [[32mSUCCESS[0m in 0.64s]
[0m10:36:14.578923 [debug] [Thread-1 (]: Finished running node model.my_dbt_trino_project.src_auth_events
[0m10:36:14.580417 [debug] [Thread-1 (]: Began running node model.my_dbt_trino_project.src_listen_events
[0m10:36:14.580417 [info ] [Thread-1 (]: 2 of 15 START sql incremental model analytics_source.src_listen_events ......... [RUN]
[0m10:36:14.581428 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.my_dbt_trino_project.src_auth_events, now model.my_dbt_trino_project.src_listen_events)
[0m10:36:14.581428 [debug] [Thread-1 (]: Began compiling node model.my_dbt_trino_project.src_listen_events
[0m10:36:14.585428 [debug] [Thread-1 (]: Writing injected SQL for node "model.my_dbt_trino_project.src_listen_events"
[0m10:36:14.586425 [debug] [Thread-1 (]: Began executing node model.my_dbt_trino_project.src_listen_events
[0m10:36:14.611947 [debug] [Thread-1 (]: Using trino connection "model.my_dbt_trino_project.src_listen_events"
[0m10:36:14.613086 [debug] [Thread-1 (]: On model.my_dbt_trino_project.src_listen_events: /* {"app": "dbt", "dbt_version": "1.8.2", "profile_name": "my_dbt_trino_project", "target_name": "dev", "node_id": "model.my_dbt_trino_project.src_listen_events"} */

  
    

    create table "datalake"."analytics_source"."src_listen_events__dbt_tmp"
      
      
    as (
      

with source as (

    select
        CAST(_id AS VARCHAR) as id,
        artist,
        song,
        CAST(NULLIF(duration, '') AS DOUBLE) as duration,
        ts,
        sessionid,
        auth,
        level,
        CAST(NULLIF(itemInSession, '') AS INTEGER) as itemInSession,
        city,
        zip,
        state,
        country,
        userAgent,
        CAST(NULLIF(lon, '') AS DOUBLE) as lon,
        CAST(NULLIF(lat, '') AS DOUBLE) as lat,
        CAST(CAST(NULLIF(userId, '') AS DOUBLE) AS INTEGER) as userId,
 -- Assurez-vous que userId peut aussi être converti de cette manière.
        lastName,
        firstName,
        gender,
        CAST(CAST(NULLIF(registration, '') AS DOUBLE) AS BIGINT) as registration
    from "website"."demo"."listen_events"

)

select * from source



    -- this filter will only be applied on an incremental run
    where ts > (select max(ts) from "datalake"."analytics_source"."src_listen_events")


    )
[0m10:36:14.613086 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m10:36:14.762787 [debug] [Thread-1 (]: SQL status: SUCCESS in 0.0 seconds
[0m10:36:14.770786 [debug] [Thread-1 (]: Using trino connection "model.my_dbt_trino_project.src_listen_events"
[0m10:36:14.771786 [debug] [Thread-1 (]: On model.my_dbt_trino_project.src_listen_events: /* {"app": "dbt", "dbt_version": "1.8.2", "profile_name": "my_dbt_trino_project", "target_name": "dev", "node_id": "model.my_dbt_trino_project.src_listen_events"} */

    describe "datalake"."analytics_source"."src_listen_events__dbt_tmp"
[0m10:36:14.851886 [debug] [Thread-1 (]: SQL status: SUCCESS in 0.0 seconds
[0m10:36:14.854398 [debug] [Thread-1 (]: Using trino connection "model.my_dbt_trino_project.src_listen_events"
[0m10:36:14.855404 [debug] [Thread-1 (]: On model.my_dbt_trino_project.src_listen_events: /* {"app": "dbt", "dbt_version": "1.8.2", "profile_name": "my_dbt_trino_project", "target_name": "dev", "node_id": "model.my_dbt_trino_project.src_listen_events"} */

    describe "datalake"."analytics_source"."src_listen_events"
[0m10:36:14.940414 [debug] [Thread-1 (]: SQL status: SUCCESS in 0.0 seconds
[0m10:36:14.948478 [debug] [Thread-1 (]: Using trino connection "model.my_dbt_trino_project.src_listen_events"
[0m10:36:14.949494 [debug] [Thread-1 (]: On model.my_dbt_trino_project.src_listen_events: /* {"app": "dbt", "dbt_version": "1.8.2", "profile_name": "my_dbt_trino_project", "target_name": "dev", "node_id": "model.my_dbt_trino_project.src_listen_events"} */

    describe "datalake"."analytics_source"."src_listen_events"
[0m10:36:15.038294 [debug] [Thread-1 (]: SQL status: SUCCESS in 0.0 seconds
[0m10:36:15.046307 [debug] [Thread-1 (]: Writing runtime sql for node "model.my_dbt_trino_project.src_listen_events"
[0m10:36:15.048556 [debug] [Thread-1 (]: Using trino connection "model.my_dbt_trino_project.src_listen_events"
[0m10:36:15.048556 [debug] [Thread-1 (]: On model.my_dbt_trino_project.src_listen_events: /* {"app": "dbt", "dbt_version": "1.8.2", "profile_name": "my_dbt_trino_project", "target_name": "dev", "node_id": "model.my_dbt_trino_project.src_listen_events"} */
insert into "datalake"."analytics_source"."src_listen_events" ("id", "artist", "song", "duration", "ts", "sessionid", "auth", "level", "iteminsession", "city", "zip", "state", "country", "useragent", "lon", "lat", "userid", "lastname", "firstname", "gender", "registration")
    (
        select "id", "artist", "song", "duration", "ts", "sessionid", "auth", "level", "iteminsession", "city", "zip", "state", "country", "useragent", "lon", "lat", "userid", "lastname", "firstname", "gender", "registration"
        from "datalake"."analytics_source"."src_listen_events__dbt_tmp"
    )
[0m10:36:15.153038 [debug] [Thread-1 (]: SQL status: SUCCESS in 0.0 seconds
[0m10:36:15.156047 [debug] [Thread-1 (]: Applying DROP to: "datalake"."analytics_source"."src_listen_events__dbt_tmp"
[0m10:36:15.157045 [debug] [Thread-1 (]: Using trino connection "model.my_dbt_trino_project.src_listen_events"
[0m10:36:15.157045 [debug] [Thread-1 (]: On model.my_dbt_trino_project.src_listen_events: /* {"app": "dbt", "dbt_version": "1.8.2", "profile_name": "my_dbt_trino_project", "target_name": "dev", "node_id": "model.my_dbt_trino_project.src_listen_events"} */

    drop table if exists "datalake"."analytics_source"."src_listen_events__dbt_tmp"
[0m10:36:15.251133 [debug] [Thread-1 (]: SQL status: SUCCESS in 0.0 seconds
[0m10:36:15.253137 [debug] [Thread-1 (]: On model.my_dbt_trino_project.src_listen_events: ROLLBACK
[0m10:36:15.253137 [debug] [Thread-1 (]: On model.my_dbt_trino_project.src_listen_events: Close
[0m10:36:15.254136 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'ad86cf40-e840-4e1c-afc0-18283c1d4899', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000001A6BB047850>]}
[0m10:36:15.255155 [info ] [Thread-1 (]: 2 of 15 OK created sql incremental model analytics_source.src_listen_events .... [[32mSUCCESS[0m in 0.67s]
[0m10:36:15.256498 [debug] [Thread-1 (]: Finished running node model.my_dbt_trino_project.src_listen_events
[0m10:36:15.256498 [debug] [Thread-1 (]: Began running node model.my_dbt_trino_project.src_page_view_events
[0m10:36:15.257503 [info ] [Thread-1 (]: 3 of 15 START sql incremental model analytics_source.src_page_view_events ...... [RUN]
[0m10:36:15.257503 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.my_dbt_trino_project.src_listen_events, now model.my_dbt_trino_project.src_page_view_events)
[0m10:36:15.258507 [debug] [Thread-1 (]: Began compiling node model.my_dbt_trino_project.src_page_view_events
[0m10:36:15.262503 [debug] [Thread-1 (]: Writing injected SQL for node "model.my_dbt_trino_project.src_page_view_events"
[0m10:36:15.262503 [debug] [Thread-1 (]: Began executing node model.my_dbt_trino_project.src_page_view_events
[0m10:36:15.269611 [debug] [Thread-1 (]: Using trino connection "model.my_dbt_trino_project.src_page_view_events"
[0m10:36:15.270835 [debug] [Thread-1 (]: On model.my_dbt_trino_project.src_page_view_events: /* {"app": "dbt", "dbt_version": "1.8.2", "profile_name": "my_dbt_trino_project", "target_name": "dev", "node_id": "model.my_dbt_trino_project.src_page_view_events"} */

  
    

    create table "datalake"."analytics_source"."src_page_view_events__dbt_tmp"
      
      
    as (
      

with source as (
    select
        CAST(_id AS VARCHAR) as id,
        ts,
        CAST(sessionId AS VARCHAR) as sessionId,
        page,
        auth,
        level,
        CAST(CAST(NULLIF(itemInSession, '') AS DOUBLE) AS INTEGER) as itemInSession, 
        city,
        zip,
        state,
        userAgent,
        CAST(NULLIF(lon, '') AS double) as lon,
        CAST(NULLIF(lat, '') AS double) as lat,
        CAST(CAST(NULLIF(userId, '') AS DOUBLE) AS INTEGER) as userId, 
        lastName,
        firstName,
        gender,
        CAST(CAST(NULLIF(registration, '') AS DOUBLE) AS BIGINT) as registration, 
        artist,
        song,
        CAST(NULLIF(duration, '') AS double) as duration
    from "website"."demo"."page_view_events"
)

select * from source


    where ts > (select max(ts) from "datalake"."analytics_source"."src_page_view_events")

    )
[0m10:36:15.270835 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m10:36:15.414944 [debug] [Thread-1 (]: SQL status: SUCCESS in 0.0 seconds
[0m10:36:15.416950 [debug] [Thread-1 (]: Using trino connection "model.my_dbt_trino_project.src_page_view_events"
[0m10:36:15.417949 [debug] [Thread-1 (]: On model.my_dbt_trino_project.src_page_view_events: /* {"app": "dbt", "dbt_version": "1.8.2", "profile_name": "my_dbt_trino_project", "target_name": "dev", "node_id": "model.my_dbt_trino_project.src_page_view_events"} */

    describe "datalake"."analytics_source"."src_page_view_events__dbt_tmp"
[0m10:36:15.503354 [debug] [Thread-1 (]: SQL status: SUCCESS in 0.0 seconds
[0m10:36:15.507365 [debug] [Thread-1 (]: Using trino connection "model.my_dbt_trino_project.src_page_view_events"
[0m10:36:15.507365 [debug] [Thread-1 (]: On model.my_dbt_trino_project.src_page_view_events: /* {"app": "dbt", "dbt_version": "1.8.2", "profile_name": "my_dbt_trino_project", "target_name": "dev", "node_id": "model.my_dbt_trino_project.src_page_view_events"} */

    describe "datalake"."analytics_source"."src_page_view_events"
[0m10:36:15.592837 [debug] [Thread-1 (]: SQL status: SUCCESS in 0.0 seconds
[0m10:36:15.595834 [debug] [Thread-1 (]: Using trino connection "model.my_dbt_trino_project.src_page_view_events"
[0m10:36:15.596836 [debug] [Thread-1 (]: On model.my_dbt_trino_project.src_page_view_events: /* {"app": "dbt", "dbt_version": "1.8.2", "profile_name": "my_dbt_trino_project", "target_name": "dev", "node_id": "model.my_dbt_trino_project.src_page_view_events"} */

    describe "datalake"."analytics_source"."src_page_view_events"
[0m10:36:15.691533 [debug] [Thread-1 (]: SQL status: SUCCESS in 0.0 seconds
[0m10:36:15.694043 [debug] [Thread-1 (]: Writing runtime sql for node "model.my_dbt_trino_project.src_page_view_events"
[0m10:36:15.696050 [debug] [Thread-1 (]: Using trino connection "model.my_dbt_trino_project.src_page_view_events"
[0m10:36:15.696050 [debug] [Thread-1 (]: On model.my_dbt_trino_project.src_page_view_events: /* {"app": "dbt", "dbt_version": "1.8.2", "profile_name": "my_dbt_trino_project", "target_name": "dev", "node_id": "model.my_dbt_trino_project.src_page_view_events"} */
insert into "datalake"."analytics_source"."src_page_view_events" ("id", "ts", "sessionid", "page", "auth", "level", "iteminsession", "city", "zip", "state", "useragent", "lon", "lat", "userid", "lastname", "firstname", "gender", "registration", "artist", "song", "duration")
    (
        select "id", "ts", "sessionid", "page", "auth", "level", "iteminsession", "city", "zip", "state", "useragent", "lon", "lat", "userid", "lastname", "firstname", "gender", "registration", "artist", "song", "duration"
        from "datalake"."analytics_source"."src_page_view_events__dbt_tmp"
    )
[0m10:36:15.806718 [debug] [Thread-1 (]: SQL status: SUCCESS in 0.0 seconds
[0m10:36:15.811379 [debug] [Thread-1 (]: Applying DROP to: "datalake"."analytics_source"."src_page_view_events__dbt_tmp"
[0m10:36:15.811900 [debug] [Thread-1 (]: Using trino connection "model.my_dbt_trino_project.src_page_view_events"
[0m10:36:15.812422 [debug] [Thread-1 (]: On model.my_dbt_trino_project.src_page_view_events: /* {"app": "dbt", "dbt_version": "1.8.2", "profile_name": "my_dbt_trino_project", "target_name": "dev", "node_id": "model.my_dbt_trino_project.src_page_view_events"} */

    drop table if exists "datalake"."analytics_source"."src_page_view_events__dbt_tmp"
[0m10:36:15.900623 [debug] [Thread-1 (]: SQL status: SUCCESS in 0.0 seconds
[0m10:36:15.902624 [debug] [Thread-1 (]: On model.my_dbt_trino_project.src_page_view_events: ROLLBACK
[0m10:36:15.902624 [debug] [Thread-1 (]: On model.my_dbt_trino_project.src_page_view_events: Close
[0m10:36:15.903622 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'ad86cf40-e840-4e1c-afc0-18283c1d4899', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000001A6BC126A90>]}
[0m10:36:15.904620 [info ] [Thread-1 (]: 3 of 15 OK created sql incremental model analytics_source.src_page_view_events . [[32mSUCCESS[0m in 0.65s]
[0m10:36:15.904620 [debug] [Thread-1 (]: Finished running node model.my_dbt_trino_project.src_page_view_events
[0m10:36:15.904620 [debug] [Thread-1 (]: Began running node model.my_dbt_trino_project.stg_user_level_by_gender
[0m10:36:15.905892 [info ] [Thread-1 (]: 4 of 15 START sql view model analytics_stage.stg_user_level_by_gender .......... [RUN]
[0m10:36:15.906892 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.my_dbt_trino_project.src_page_view_events, now model.my_dbt_trino_project.stg_user_level_by_gender)
[0m10:36:15.906892 [debug] [Thread-1 (]: Began compiling node model.my_dbt_trino_project.stg_user_level_by_gender
[0m10:36:15.908891 [debug] [Thread-1 (]: Writing injected SQL for node "model.my_dbt_trino_project.stg_user_level_by_gender"
[0m10:36:15.909893 [debug] [Thread-1 (]: Began executing node model.my_dbt_trino_project.stg_user_level_by_gender
[0m10:36:15.921892 [debug] [Thread-1 (]: Writing runtime sql for node "model.my_dbt_trino_project.stg_user_level_by_gender"
[0m10:36:15.924895 [debug] [Thread-1 (]: Using trino connection "model.my_dbt_trino_project.stg_user_level_by_gender"
[0m10:36:15.924895 [debug] [Thread-1 (]: On model.my_dbt_trino_project.stg_user_level_by_gender: /* {"app": "dbt", "dbt_version": "1.8.2", "profile_name": "my_dbt_trino_project", "target_name": "dev", "node_id": "model.my_dbt_trino_project.stg_user_level_by_gender"} */

  create or replace view
    "datalake"."analytics_stage"."stg_user_level_by_gender"
  security definer
  as
    

WITH user_subscriptions AS (
    SELECT
        gender,
        level, 
        COUNT(DISTINCT userId) AS user_count
    FROM "datalake"."analytics_source"."src_auth_events"
    WHERE gender IS NOT NULL AND level IS NOT NULL
    GROUP BY gender, level
)

SELECT
    gender,
    level,
    user_count
FROM user_subscriptions
  
[0m10:36:15.925889 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m10:36:15.991580 [debug] [Thread-1 (]: SQL status: SUCCESS in 0.0 seconds
[0m10:36:15.993657 [debug] [Thread-1 (]: On model.my_dbt_trino_project.stg_user_level_by_gender: ROLLBACK
[0m10:36:15.993657 [debug] [Thread-1 (]: On model.my_dbt_trino_project.stg_user_level_by_gender: Close
[0m10:36:15.994723 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'ad86cf40-e840-4e1c-afc0-18283c1d4899', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000001A6BC126850>]}
[0m10:36:15.995260 [info ] [Thread-1 (]: 4 of 15 OK created sql view model analytics_stage.stg_user_level_by_gender ..... [[32mSUCCESS[0m in 0.09s]
[0m10:36:15.995788 [debug] [Thread-1 (]: Finished running node model.my_dbt_trino_project.stg_user_level_by_gender
[0m10:36:15.996313 [debug] [Thread-1 (]: Began running node model.my_dbt_trino_project.stg_streams_hourly
[0m10:36:15.997351 [info ] [Thread-1 (]: 5 of 15 START sql table model analytics_stage.stg_streams_hourly ............... [RUN]
[0m10:36:15.997907 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.my_dbt_trino_project.stg_user_level_by_gender, now model.my_dbt_trino_project.stg_streams_hourly)
[0m10:36:15.998420 [debug] [Thread-1 (]: Began compiling node model.my_dbt_trino_project.stg_streams_hourly
[0m10:36:16.001589 [debug] [Thread-1 (]: Writing injected SQL for node "model.my_dbt_trino_project.stg_streams_hourly"
[0m10:36:16.002104 [debug] [Thread-1 (]: Began executing node model.my_dbt_trino_project.stg_streams_hourly
[0m10:36:16.006294 [debug] [Thread-1 (]: Writing runtime sql for node "model.my_dbt_trino_project.stg_streams_hourly"
[0m10:36:16.008408 [debug] [Thread-1 (]: Using trino connection "model.my_dbt_trino_project.stg_streams_hourly"
[0m10:36:16.008933 [debug] [Thread-1 (]: On model.my_dbt_trino_project.stg_streams_hourly: /* {"app": "dbt", "dbt_version": "1.8.2", "profile_name": "my_dbt_trino_project", "target_name": "dev", "node_id": "model.my_dbt_trino_project.stg_streams_hourly"} */

  
    

    create table "datalake"."analytics_stage"."stg_streams_hourly__dbt_tmp"
      
      
    as (
      

SELECT
    DATE_FORMAT(FROM_UNIXTIME(ts), '%Y-%m-%d') AS stream_date, 
    DATE_FORMAT(FROM_UNIXTIME(ts), '%H') AS stream_hour,
    COUNT(*) AS total_streams
FROM "datalake"."analytics_source"."src_listen_events"
GROUP BY
    DATE_FORMAT(FROM_UNIXTIME(ts), '%Y-%m-%d'),
    DATE_FORMAT(FROM_UNIXTIME(ts), '%H')
    )
[0m10:36:16.009449 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m10:36:16.214522 [debug] [Thread-1 (]: SQL status: SUCCESS in 0.0 seconds
[0m10:36:16.217121 [debug] [Thread-1 (]: Using trino connection "model.my_dbt_trino_project.stg_streams_hourly"
[0m10:36:16.217639 [debug] [Thread-1 (]: On model.my_dbt_trino_project.stg_streams_hourly: /* {"app": "dbt", "dbt_version": "1.8.2", "profile_name": "my_dbt_trino_project", "target_name": "dev", "node_id": "model.my_dbt_trino_project.stg_streams_hourly"} */
alter table "datalake"."analytics_stage"."stg_streams_hourly" rename to "datalake"."analytics_stage"."stg_streams_hourly__dbt_backup"
[0m10:36:16.298006 [debug] [Thread-1 (]: SQL status: SUCCESS in 0.0 seconds
[0m10:36:16.301012 [debug] [Thread-1 (]: Using trino connection "model.my_dbt_trino_project.stg_streams_hourly"
[0m10:36:16.302014 [debug] [Thread-1 (]: On model.my_dbt_trino_project.stg_streams_hourly: /* {"app": "dbt", "dbt_version": "1.8.2", "profile_name": "my_dbt_trino_project", "target_name": "dev", "node_id": "model.my_dbt_trino_project.stg_streams_hourly"} */
alter table "datalake"."analytics_stage"."stg_streams_hourly__dbt_tmp" rename to "datalake"."analytics_stage"."stg_streams_hourly"
[0m10:36:16.382055 [debug] [Thread-1 (]: SQL status: SUCCESS in 0.0 seconds
[0m10:36:16.385058 [debug] [Thread-1 (]: Applying DROP to: "datalake"."analytics_stage"."stg_streams_hourly__dbt_backup"
[0m10:36:16.386055 [debug] [Thread-1 (]: Using trino connection "model.my_dbt_trino_project.stg_streams_hourly"
[0m10:36:16.386055 [debug] [Thread-1 (]: On model.my_dbt_trino_project.stg_streams_hourly: /* {"app": "dbt", "dbt_version": "1.8.2", "profile_name": "my_dbt_trino_project", "target_name": "dev", "node_id": "model.my_dbt_trino_project.stg_streams_hourly"} */

    drop table if exists "datalake"."analytics_stage"."stg_streams_hourly__dbt_backup"
[0m10:36:16.490809 [debug] [Thread-1 (]: SQL status: SUCCESS in 0.0 seconds
[0m10:36:16.492816 [debug] [Thread-1 (]: On model.my_dbt_trino_project.stg_streams_hourly: ROLLBACK
[0m10:36:16.492816 [debug] [Thread-1 (]: On model.my_dbt_trino_project.stg_streams_hourly: Close
[0m10:36:16.493823 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'ad86cf40-e840-4e1c-afc0-18283c1d4899', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000001A6BC30E610>]}
[0m10:36:16.493823 [info ] [Thread-1 (]: 5 of 15 OK created sql table model analytics_stage.stg_streams_hourly .......... [[32mSUCCESS[0m in 0.50s]
[0m10:36:16.495023 [debug] [Thread-1 (]: Finished running node model.my_dbt_trino_project.stg_streams_hourly
[0m10:36:16.495023 [debug] [Thread-1 (]: Began running node model.my_dbt_trino_project.stg_top_songs_artists
[0m10:36:16.496032 [info ] [Thread-1 (]: 6 of 15 START sql view model analytics_stage.stg_top_songs_artists ............. [RUN]
[0m10:36:16.497030 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.my_dbt_trino_project.stg_streams_hourly, now model.my_dbt_trino_project.stg_top_songs_artists)
[0m10:36:16.497030 [debug] [Thread-1 (]: Began compiling node model.my_dbt_trino_project.stg_top_songs_artists
[0m10:36:16.499475 [debug] [Thread-1 (]: Writing injected SQL for node "model.my_dbt_trino_project.stg_top_songs_artists"
[0m10:36:16.499475 [debug] [Thread-1 (]: Began executing node model.my_dbt_trino_project.stg_top_songs_artists
[0m10:36:16.503474 [debug] [Thread-1 (]: Writing runtime sql for node "model.my_dbt_trino_project.stg_top_songs_artists"
[0m10:36:16.504474 [debug] [Thread-1 (]: Using trino connection "model.my_dbt_trino_project.stg_top_songs_artists"
[0m10:36:16.505478 [debug] [Thread-1 (]: On model.my_dbt_trino_project.stg_top_songs_artists: /* {"app": "dbt", "dbt_version": "1.8.2", "profile_name": "my_dbt_trino_project", "target_name": "dev", "node_id": "model.my_dbt_trino_project.stg_top_songs_artists"} */

  create or replace view
    "datalake"."analytics_stage"."stg_top_songs_artists"
  security definer
  as
    

WITH song_plays AS (
    SELECT
        artist,
        song,
        COUNT(*) AS play_count
    FROM "datalake"."analytics_source"."src_listen_events"
    GROUP BY artist, song
)

SELECT
    artist,
    song,
    play_count
FROM song_plays
ORDER BY play_count DESC
  
[0m10:36:16.505478 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m10:36:16.558058 [debug] [Thread-1 (]: SQL status: SUCCESS in 0.0 seconds
[0m10:36:16.560057 [debug] [Thread-1 (]: On model.my_dbt_trino_project.stg_top_songs_artists: ROLLBACK
[0m10:36:16.561056 [debug] [Thread-1 (]: On model.my_dbt_trino_project.stg_top_songs_artists: Close
[0m10:36:16.561056 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'ad86cf40-e840-4e1c-afc0-18283c1d4899', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000001A6BDC8C690>]}
[0m10:36:16.562327 [info ] [Thread-1 (]: 6 of 15 OK created sql view model analytics_stage.stg_top_songs_artists ........ [[32mSUCCESS[0m in 0.07s]
[0m10:36:16.563336 [debug] [Thread-1 (]: Finished running node model.my_dbt_trino_project.stg_top_songs_artists
[0m10:36:16.563336 [debug] [Thread-1 (]: Began running node model.my_dbt_trino_project.stg_unique_users
[0m10:36:16.564335 [info ] [Thread-1 (]: 7 of 15 START sql view model analytics_stage.stg_unique_users .................. [RUN]
[0m10:36:16.564335 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.my_dbt_trino_project.stg_top_songs_artists, now model.my_dbt_trino_project.stg_unique_users)
[0m10:36:16.565336 [debug] [Thread-1 (]: Began compiling node model.my_dbt_trino_project.stg_unique_users
[0m10:36:16.568497 [debug] [Thread-1 (]: Writing injected SQL for node "model.my_dbt_trino_project.stg_unique_users"
[0m10:36:16.569503 [debug] [Thread-1 (]: Began executing node model.my_dbt_trino_project.stg_unique_users
[0m10:36:16.571502 [debug] [Thread-1 (]: Writing runtime sql for node "model.my_dbt_trino_project.stg_unique_users"
[0m10:36:16.572502 [debug] [Thread-1 (]: Using trino connection "model.my_dbt_trino_project.stg_unique_users"
[0m10:36:16.572502 [debug] [Thread-1 (]: On model.my_dbt_trino_project.stg_unique_users: /* {"app": "dbt", "dbt_version": "1.8.2", "profile_name": "my_dbt_trino_project", "target_name": "dev", "node_id": "model.my_dbt_trino_project.stg_unique_users"} */

  create or replace view
    "datalake"."analytics_stage"."stg_unique_users"
  security definer
  as
    

SELECT
    COUNT(DISTINCT userid) AS total_unique_users
FROM "datalake"."analytics_source"."src_listen_events"
WHERE userid IS NOT NULL
  
[0m10:36:16.572502 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m10:36:16.634327 [debug] [Thread-1 (]: SQL status: SUCCESS in 0.0 seconds
[0m10:36:16.636326 [debug] [Thread-1 (]: On model.my_dbt_trino_project.stg_unique_users: ROLLBACK
[0m10:36:16.637325 [debug] [Thread-1 (]: On model.my_dbt_trino_project.stg_unique_users: Close
[0m10:36:16.637325 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'ad86cf40-e840-4e1c-afc0-18283c1d4899', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000001A6BD899310>]}
[0m10:36:16.638719 [info ] [Thread-1 (]: 7 of 15 OK created sql view model analytics_stage.stg_unique_users ............. [[32mSUCCESS[0m in 0.07s]
[0m10:36:16.638719 [debug] [Thread-1 (]: Finished running node model.my_dbt_trino_project.stg_unique_users
[0m10:36:16.639728 [debug] [Thread-1 (]: Began running node model.my_dbt_trino_project.stg_user_activity_per_country
[0m10:36:16.639728 [info ] [Thread-1 (]: 8 of 15 START sql view model analytics_stage.stg_user_activity_per_country ..... [RUN]
[0m10:36:16.640844 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.my_dbt_trino_project.stg_unique_users, now model.my_dbt_trino_project.stg_user_activity_per_country)
[0m10:36:16.640844 [debug] [Thread-1 (]: Began compiling node model.my_dbt_trino_project.stg_user_activity_per_country
[0m10:36:16.644853 [debug] [Thread-1 (]: Writing injected SQL for node "model.my_dbt_trino_project.stg_user_activity_per_country"
[0m10:36:16.645851 [debug] [Thread-1 (]: Began executing node model.my_dbt_trino_project.stg_user_activity_per_country
[0m10:36:16.648330 [debug] [Thread-1 (]: Writing runtime sql for node "model.my_dbt_trino_project.stg_user_activity_per_country"
[0m10:36:16.649347 [debug] [Thread-1 (]: Using trino connection "model.my_dbt_trino_project.stg_user_activity_per_country"
[0m10:36:16.650337 [debug] [Thread-1 (]: On model.my_dbt_trino_project.stg_user_activity_per_country: /* {"app": "dbt", "dbt_version": "1.8.2", "profile_name": "my_dbt_trino_project", "target_name": "dev", "node_id": "model.my_dbt_trino_project.stg_user_activity_per_country"} */

  create or replace view
    "datalake"."analytics_stage"."stg_user_activity_per_country"
  security definer
  as
    

WITH combined_activities AS (
  SELECT
    country,
    'listen_event' AS event_type,
    ts,
    userid
  FROM "datalake"."analytics_source"."src_listen_events"
  WHERE country IS NOT NULL
  UNION ALL
  SELECT
    'Unknown' AS country,
    'auth_event' AS event_type, 
    ts,
    userid
  FROM "datalake"."analytics_source"."src_auth_events"
  UNION ALL
  SELECT
    'Unknown' AS country, 
    'page_view_event' AS event_type,
    ts,
    userid
  FROM "datalake"."analytics_source"."src_page_view_events"
)

SELECT
  country,
  COUNT(*) AS activity_count
FROM combined_activities
GROUP BY country
  
[0m10:36:16.650337 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m10:36:16.709054 [debug] [Thread-1 (]: SQL status: SUCCESS in 0.0 seconds
[0m10:36:16.711053 [debug] [Thread-1 (]: On model.my_dbt_trino_project.stg_user_activity_per_country: ROLLBACK
[0m10:36:16.712053 [debug] [Thread-1 (]: On model.my_dbt_trino_project.stg_user_activity_per_country: Close
[0m10:36:16.712053 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'ad86cf40-e840-4e1c-afc0-18283c1d4899', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000001A6BBCC0610>]}
[0m10:36:16.713054 [info ] [Thread-1 (]: 8 of 15 OK created sql view model analytics_stage.stg_user_activity_per_country  [[32mSUCCESS[0m in 0.07s]
[0m10:36:16.713054 [debug] [Thread-1 (]: Finished running node model.my_dbt_trino_project.stg_user_activity_per_country
[0m10:36:16.714319 [debug] [Thread-1 (]: Began running node model.my_dbt_trino_project.stg_user_activity_per_location
[0m10:36:16.714319 [info ] [Thread-1 (]: 9 of 15 START sql view model analytics_stage.stg_user_activity_per_location .... [RUN]
[0m10:36:16.715324 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.my_dbt_trino_project.stg_user_activity_per_country, now model.my_dbt_trino_project.stg_user_activity_per_location)
[0m10:36:16.715324 [debug] [Thread-1 (]: Began compiling node model.my_dbt_trino_project.stg_user_activity_per_location
[0m10:36:16.718842 [debug] [Thread-1 (]: Writing injected SQL for node "model.my_dbt_trino_project.stg_user_activity_per_location"
[0m10:36:16.719347 [debug] [Thread-1 (]: Began executing node model.my_dbt_trino_project.stg_user_activity_per_location
[0m10:36:16.721353 [debug] [Thread-1 (]: Writing runtime sql for node "model.my_dbt_trino_project.stg_user_activity_per_location"
[0m10:36:16.722990 [debug] [Thread-1 (]: Using trino connection "model.my_dbt_trino_project.stg_user_activity_per_location"
[0m10:36:16.724000 [debug] [Thread-1 (]: On model.my_dbt_trino_project.stg_user_activity_per_location: /* {"app": "dbt", "dbt_version": "1.8.2", "profile_name": "my_dbt_trino_project", "target_name": "dev", "node_id": "model.my_dbt_trino_project.stg_user_activity_per_location"} */

  create or replace view
    "datalake"."analytics_stage"."stg_user_activity_per_location"
  security definer
  as
    

WITH combined_activities AS (
  SELECT
    city,
    state,
    'auth_event' AS event_type,
    ts,
    userid
 FROM "datalake"."analytics_source"."src_auth_events"
  UNION ALL
  SELECT
    city,
    state,
    'listen_event' AS event_type,
    ts,
    userid
  FROM "datalake"."analytics_source"."src_listen_events"
  UNION ALL
  SELECT
    city,
    state,
    'page_view_event' AS event_type,
    ts,
    userid
  FROM "datalake"."analytics_source"."src_page_view_events"
)

SELECT
  state,
  city,
  COUNT(*) AS activity_count
FROM combined_activities
GROUP BY state, city
  
[0m10:36:16.724000 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m10:36:16.792871 [debug] [Thread-1 (]: SQL status: SUCCESS in 0.0 seconds
[0m10:36:16.794870 [debug] [Thread-1 (]: On model.my_dbt_trino_project.stg_user_activity_per_location: ROLLBACK
[0m10:36:16.795869 [debug] [Thread-1 (]: On model.my_dbt_trino_project.stg_user_activity_per_location: Close
[0m10:36:16.796866 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'ad86cf40-e840-4e1c-afc0-18283c1d4899', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000001A6B71A4850>]}
[0m10:36:16.796866 [info ] [Thread-1 (]: 9 of 15 OK created sql view model analytics_stage.stg_user_activity_per_location  [[32mSUCCESS[0m in 0.08s]
[0m10:36:16.798289 [debug] [Thread-1 (]: Finished running node model.my_dbt_trino_project.stg_user_activity_per_location
[0m10:36:16.799298 [debug] [Thread-1 (]: Began running node model.my_dbt_trino_project.mart_user_level_by_gender
[0m10:36:16.799298 [info ] [Thread-1 (]: 10 of 15 START sql table model analytics.mart_user_level_by_gender ............. [RUN]
[0m10:36:16.800337 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.my_dbt_trino_project.stg_user_activity_per_location, now model.my_dbt_trino_project.mart_user_level_by_gender)
[0m10:36:16.800337 [debug] [Thread-1 (]: Began compiling node model.my_dbt_trino_project.mart_user_level_by_gender
[0m10:36:16.803344 [debug] [Thread-1 (]: Writing injected SQL for node "model.my_dbt_trino_project.mart_user_level_by_gender"
[0m10:36:16.804343 [debug] [Thread-1 (]: Began executing node model.my_dbt_trino_project.mart_user_level_by_gender
[0m10:36:16.808515 [debug] [Thread-1 (]: Writing runtime sql for node "model.my_dbt_trino_project.mart_user_level_by_gender"
[0m10:36:16.811024 [debug] [Thread-1 (]: Using trino connection "model.my_dbt_trino_project.mart_user_level_by_gender"
[0m10:36:16.812035 [debug] [Thread-1 (]: On model.my_dbt_trino_project.mart_user_level_by_gender: /* {"app": "dbt", "dbt_version": "1.8.2", "profile_name": "my_dbt_trino_project", "target_name": "dev", "node_id": "model.my_dbt_trino_project.mart_user_level_by_gender"} */

  
    

    create table "datalake"."analytics"."mart_user_level_by_gender__dbt_tmp"
      
      
    as (
      

SELECT
    gender,
    level,
    SUM(user_count) AS total_users,
    ROUND(SUM(user_count) * 100.0 / SUM(SUM(user_count)) OVER (), 2) AS percentage_of_total_users
FROM "datalake"."analytics_stage"."stg_user_level_by_gender"
GROUP BY gender, level
    )
[0m10:36:16.812035 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m10:36:17.047790 [debug] [Thread-1 (]: SQL status: SUCCESS in 0.0 seconds
[0m10:36:17.050799 [debug] [Thread-1 (]: Using trino connection "model.my_dbt_trino_project.mart_user_level_by_gender"
[0m10:36:17.050799 [debug] [Thread-1 (]: On model.my_dbt_trino_project.mart_user_level_by_gender: /* {"app": "dbt", "dbt_version": "1.8.2", "profile_name": "my_dbt_trino_project", "target_name": "dev", "node_id": "model.my_dbt_trino_project.mart_user_level_by_gender"} */
alter table "datalake"."analytics"."mart_user_level_by_gender" rename to "datalake"."analytics"."mart_user_level_by_gender__dbt_backup"
[0m10:36:17.132099 [debug] [Thread-1 (]: SQL status: SUCCESS in 0.0 seconds
[0m10:36:17.135113 [debug] [Thread-1 (]: Using trino connection "model.my_dbt_trino_project.mart_user_level_by_gender"
[0m10:36:17.135113 [debug] [Thread-1 (]: On model.my_dbt_trino_project.mart_user_level_by_gender: /* {"app": "dbt", "dbt_version": "1.8.2", "profile_name": "my_dbt_trino_project", "target_name": "dev", "node_id": "model.my_dbt_trino_project.mart_user_level_by_gender"} */
alter table "datalake"."analytics"."mart_user_level_by_gender__dbt_tmp" rename to "datalake"."analytics"."mart_user_level_by_gender"
[0m10:36:17.231075 [debug] [Thread-1 (]: SQL status: SUCCESS in 0.0 seconds
[0m10:36:17.234084 [debug] [Thread-1 (]: Applying DROP to: "datalake"."analytics"."mart_user_level_by_gender__dbt_backup"
[0m10:36:17.235084 [debug] [Thread-1 (]: Using trino connection "model.my_dbt_trino_project.mart_user_level_by_gender"
[0m10:36:17.236456 [debug] [Thread-1 (]: On model.my_dbt_trino_project.mart_user_level_by_gender: /* {"app": "dbt", "dbt_version": "1.8.2", "profile_name": "my_dbt_trino_project", "target_name": "dev", "node_id": "model.my_dbt_trino_project.mart_user_level_by_gender"} */

    drop table if exists "datalake"."analytics"."mart_user_level_by_gender__dbt_backup"
[0m10:36:17.345545 [debug] [Thread-1 (]: SQL status: SUCCESS in 0.0 seconds
[0m10:36:17.346586 [debug] [Thread-1 (]: On model.my_dbt_trino_project.mart_user_level_by_gender: ROLLBACK
[0m10:36:17.347584 [debug] [Thread-1 (]: On model.my_dbt_trino_project.mart_user_level_by_gender: Close
[0m10:36:17.348089 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'ad86cf40-e840-4e1c-afc0-18283c1d4899', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000001A6BD8D2310>]}
[0m10:36:17.348607 [info ] [Thread-1 (]: 10 of 15 OK created sql table model analytics.mart_user_level_by_gender ........ [[32mSUCCESS[0m in 0.55s]
[0m10:36:17.349675 [debug] [Thread-1 (]: Finished running node model.my_dbt_trino_project.mart_user_level_by_gender
[0m10:36:17.350191 [debug] [Thread-1 (]: Began running node model.my_dbt_trino_project.mart_hourly_stream_evolution
[0m10:36:17.350723 [info ] [Thread-1 (]: 11 of 15 START sql table model analytics.mart_hourly_stream_evolution .......... [RUN]
[0m10:36:17.351242 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.my_dbt_trino_project.mart_user_level_by_gender, now model.my_dbt_trino_project.mart_hourly_stream_evolution)
[0m10:36:17.351242 [debug] [Thread-1 (]: Began compiling node model.my_dbt_trino_project.mart_hourly_stream_evolution
[0m10:36:17.353854 [debug] [Thread-1 (]: Writing injected SQL for node "model.my_dbt_trino_project.mart_hourly_stream_evolution"
[0m10:36:17.354371 [debug] [Thread-1 (]: Began executing node model.my_dbt_trino_project.mart_hourly_stream_evolution
[0m10:36:17.357499 [debug] [Thread-1 (]: Writing runtime sql for node "model.my_dbt_trino_project.mart_hourly_stream_evolution"
[0m10:36:17.359084 [debug] [Thread-1 (]: Using trino connection "model.my_dbt_trino_project.mart_hourly_stream_evolution"
[0m10:36:17.359084 [debug] [Thread-1 (]: On model.my_dbt_trino_project.mart_hourly_stream_evolution: /* {"app": "dbt", "dbt_version": "1.8.2", "profile_name": "my_dbt_trino_project", "target_name": "dev", "node_id": "model.my_dbt_trino_project.mart_hourly_stream_evolution"} */

  
    

    create table "datalake"."analytics"."mart_hourly_stream_evolution__dbt_tmp"
      
      
    as (
      

SELECT
    stream_date,
    stream_hour,
    total_streams,
    SUM(total_streams) OVER (PARTITION BY stream_date ORDER BY stream_hour) AS cumulative_streams
FROM "datalake"."analytics_stage"."stg_streams_hourly"
ORDER BY
    stream_date,
    stream_hour
    )
[0m10:36:17.359605 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m10:36:17.582389 [debug] [Thread-1 (]: SQL status: SUCCESS in 0.0 seconds
[0m10:36:17.585399 [debug] [Thread-1 (]: Using trino connection "model.my_dbt_trino_project.mart_hourly_stream_evolution"
[0m10:36:17.586447 [debug] [Thread-1 (]: On model.my_dbt_trino_project.mart_hourly_stream_evolution: /* {"app": "dbt", "dbt_version": "1.8.2", "profile_name": "my_dbt_trino_project", "target_name": "dev", "node_id": "model.my_dbt_trino_project.mart_hourly_stream_evolution"} */
alter table "datalake"."analytics"."mart_hourly_stream_evolution" rename to "datalake"."analytics"."mart_hourly_stream_evolution__dbt_backup"
[0m10:36:17.669923 [debug] [Thread-1 (]: SQL status: SUCCESS in 0.0 seconds
[0m10:36:17.672145 [debug] [Thread-1 (]: Using trino connection "model.my_dbt_trino_project.mart_hourly_stream_evolution"
[0m10:36:17.673148 [debug] [Thread-1 (]: On model.my_dbt_trino_project.mart_hourly_stream_evolution: /* {"app": "dbt", "dbt_version": "1.8.2", "profile_name": "my_dbt_trino_project", "target_name": "dev", "node_id": "model.my_dbt_trino_project.mart_hourly_stream_evolution"} */
alter table "datalake"."analytics"."mart_hourly_stream_evolution__dbt_tmp" rename to "datalake"."analytics"."mart_hourly_stream_evolution"
[0m10:36:17.749793 [debug] [Thread-1 (]: SQL status: SUCCESS in 0.0 seconds
[0m10:36:17.752798 [debug] [Thread-1 (]: Applying DROP to: "datalake"."analytics"."mart_hourly_stream_evolution__dbt_backup"
[0m10:36:17.753798 [debug] [Thread-1 (]: Using trino connection "model.my_dbt_trino_project.mart_hourly_stream_evolution"
[0m10:36:17.753798 [debug] [Thread-1 (]: On model.my_dbt_trino_project.mart_hourly_stream_evolution: /* {"app": "dbt", "dbt_version": "1.8.2", "profile_name": "my_dbt_trino_project", "target_name": "dev", "node_id": "model.my_dbt_trino_project.mart_hourly_stream_evolution"} */

    drop table if exists "datalake"."analytics"."mart_hourly_stream_evolution__dbt_backup"
[0m10:36:17.861066 [debug] [Thread-1 (]: SQL status: SUCCESS in 0.0 seconds
[0m10:36:17.863075 [debug] [Thread-1 (]: On model.my_dbt_trino_project.mart_hourly_stream_evolution: ROLLBACK
[0m10:36:17.863075 [debug] [Thread-1 (]: On model.my_dbt_trino_project.mart_hourly_stream_evolution: Close
[0m10:36:17.863075 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'ad86cf40-e840-4e1c-afc0-18283c1d4899', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000001A6BD74B210>]}
[0m10:36:17.864076 [info ] [Thread-1 (]: 11 of 15 OK created sql table model analytics.mart_hourly_stream_evolution ..... [[32mSUCCESS[0m in 0.51s]
[0m10:36:17.864076 [debug] [Thread-1 (]: Finished running node model.my_dbt_trino_project.mart_hourly_stream_evolution
[0m10:36:17.865492 [debug] [Thread-1 (]: Began running node model.my_dbt_trino_project.mart_top_songs_artists
[0m10:36:17.865778 [info ] [Thread-1 (]: 12 of 15 START sql table model analytics.mart_top_songs_artists ................ [RUN]
[0m10:36:17.865778 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.my_dbt_trino_project.mart_hourly_stream_evolution, now model.my_dbt_trino_project.mart_top_songs_artists)
[0m10:36:17.866868 [debug] [Thread-1 (]: Began compiling node model.my_dbt_trino_project.mart_top_songs_artists
[0m10:36:17.870880 [debug] [Thread-1 (]: Writing injected SQL for node "model.my_dbt_trino_project.mart_top_songs_artists"
[0m10:36:17.871881 [debug] [Thread-1 (]: Began executing node model.my_dbt_trino_project.mart_top_songs_artists
[0m10:36:17.873882 [debug] [Thread-1 (]: Writing runtime sql for node "model.my_dbt_trino_project.mart_top_songs_artists"
[0m10:36:17.874884 [debug] [Thread-1 (]: Using trino connection "model.my_dbt_trino_project.mart_top_songs_artists"
[0m10:36:17.875878 [debug] [Thread-1 (]: On model.my_dbt_trino_project.mart_top_songs_artists: /* {"app": "dbt", "dbt_version": "1.8.2", "profile_name": "my_dbt_trino_project", "target_name": "dev", "node_id": "model.my_dbt_trino_project.mart_top_songs_artists"} */

  
    

    create table "datalake"."analytics"."mart_top_songs_artists__dbt_tmp"
      
      
    as (
      

WITH top_songs AS (
    SELECT
        artist,
        song,
        play_count
    FROM "datalake"."analytics_stage"."stg_top_songs_artists"
)

SELECT
    artist,
    song,
    play_count
FROM top_songs
    )
[0m10:36:17.875878 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m10:36:18.099122 [debug] [Thread-1 (]: SQL status: SUCCESS in 0.0 seconds
[0m10:36:18.103222 [debug] [Thread-1 (]: Using trino connection "model.my_dbt_trino_project.mart_top_songs_artists"
[0m10:36:18.104224 [debug] [Thread-1 (]: On model.my_dbt_trino_project.mart_top_songs_artists: /* {"app": "dbt", "dbt_version": "1.8.2", "profile_name": "my_dbt_trino_project", "target_name": "dev", "node_id": "model.my_dbt_trino_project.mart_top_songs_artists"} */
alter table "datalake"."analytics"."mart_top_songs_artists" rename to "datalake"."analytics"."mart_top_songs_artists__dbt_backup"
[0m10:36:18.183215 [debug] [Thread-1 (]: SQL status: SUCCESS in 0.0 seconds
[0m10:36:18.186215 [debug] [Thread-1 (]: Using trino connection "model.my_dbt_trino_project.mart_top_songs_artists"
[0m10:36:18.187216 [debug] [Thread-1 (]: On model.my_dbt_trino_project.mart_top_songs_artists: /* {"app": "dbt", "dbt_version": "1.8.2", "profile_name": "my_dbt_trino_project", "target_name": "dev", "node_id": "model.my_dbt_trino_project.mart_top_songs_artists"} */
alter table "datalake"."analytics"."mart_top_songs_artists__dbt_tmp" rename to "datalake"."analytics"."mart_top_songs_artists"
[0m10:36:18.278362 [debug] [Thread-1 (]: SQL status: SUCCESS in 0.0 seconds
[0m10:36:18.281363 [debug] [Thread-1 (]: Applying DROP to: "datalake"."analytics"."mart_top_songs_artists__dbt_backup"
[0m10:36:18.281363 [debug] [Thread-1 (]: Using trino connection "model.my_dbt_trino_project.mart_top_songs_artists"
[0m10:36:18.282364 [debug] [Thread-1 (]: On model.my_dbt_trino_project.mart_top_songs_artists: /* {"app": "dbt", "dbt_version": "1.8.2", "profile_name": "my_dbt_trino_project", "target_name": "dev", "node_id": "model.my_dbt_trino_project.mart_top_songs_artists"} */

    drop table if exists "datalake"."analytics"."mart_top_songs_artists__dbt_backup"
[0m10:36:18.390264 [debug] [Thread-1 (]: SQL status: SUCCESS in 0.0 seconds
[0m10:36:18.392271 [debug] [Thread-1 (]: On model.my_dbt_trino_project.mart_top_songs_artists: ROLLBACK
[0m10:36:18.392271 [debug] [Thread-1 (]: On model.my_dbt_trino_project.mart_top_songs_artists: Close
[0m10:36:18.392271 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'ad86cf40-e840-4e1c-afc0-18283c1d4899', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000001A6BD55F990>]}
[0m10:36:18.393273 [info ] [Thread-1 (]: 12 of 15 OK created sql table model analytics.mart_top_songs_artists ........... [[32mSUCCESS[0m in 0.53s]
[0m10:36:18.394272 [debug] [Thread-1 (]: Finished running node model.my_dbt_trino_project.mart_top_songs_artists
[0m10:36:18.394272 [debug] [Thread-1 (]: Began running node model.my_dbt_trino_project.mart_total_unique_users
[0m10:36:18.395273 [info ] [Thread-1 (]: 13 of 15 START sql table model analytics.mart_total_unique_users ............... [RUN]
[0m10:36:18.396272 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.my_dbt_trino_project.mart_top_songs_artists, now model.my_dbt_trino_project.mart_total_unique_users)
[0m10:36:18.396272 [debug] [Thread-1 (]: Began compiling node model.my_dbt_trino_project.mart_total_unique_users
[0m10:36:18.399273 [debug] [Thread-1 (]: Writing injected SQL for node "model.my_dbt_trino_project.mart_total_unique_users"
[0m10:36:18.399273 [debug] [Thread-1 (]: Began executing node model.my_dbt_trino_project.mart_total_unique_users
[0m10:36:18.402270 [debug] [Thread-1 (]: Writing runtime sql for node "model.my_dbt_trino_project.mart_total_unique_users"
[0m10:36:18.403272 [debug] [Thread-1 (]: Using trino connection "model.my_dbt_trino_project.mart_total_unique_users"
[0m10:36:18.403272 [debug] [Thread-1 (]: On model.my_dbt_trino_project.mart_total_unique_users: /* {"app": "dbt", "dbt_version": "1.8.2", "profile_name": "my_dbt_trino_project", "target_name": "dev", "node_id": "model.my_dbt_trino_project.mart_total_unique_users"} */

  
    

    create table "datalake"."analytics"."mart_total_unique_users__dbt_tmp"
      
      
    as (
      

SELECT
    total_unique_users
FROM "datalake"."analytics_stage"."stg_unique_users"
    )
[0m10:36:18.404274 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m10:36:18.628183 [debug] [Thread-1 (]: SQL status: SUCCESS in 0.0 seconds
[0m10:36:18.631760 [debug] [Thread-1 (]: Using trino connection "model.my_dbt_trino_project.mart_total_unique_users"
[0m10:36:18.631760 [debug] [Thread-1 (]: On model.my_dbt_trino_project.mart_total_unique_users: /* {"app": "dbt", "dbt_version": "1.8.2", "profile_name": "my_dbt_trino_project", "target_name": "dev", "node_id": "model.my_dbt_trino_project.mart_total_unique_users"} */
alter table "datalake"."analytics"."mart_total_unique_users" rename to "datalake"."analytics"."mart_total_unique_users__dbt_backup"
[0m10:36:18.719951 [debug] [Thread-1 (]: SQL status: SUCCESS in 0.0 seconds
[0m10:36:18.723962 [debug] [Thread-1 (]: Using trino connection "model.my_dbt_trino_project.mart_total_unique_users"
[0m10:36:18.723962 [debug] [Thread-1 (]: On model.my_dbt_trino_project.mart_total_unique_users: /* {"app": "dbt", "dbt_version": "1.8.2", "profile_name": "my_dbt_trino_project", "target_name": "dev", "node_id": "model.my_dbt_trino_project.mart_total_unique_users"} */
alter table "datalake"."analytics"."mart_total_unique_users__dbt_tmp" rename to "datalake"."analytics"."mart_total_unique_users"
[0m10:36:18.798215 [debug] [Thread-1 (]: SQL status: SUCCESS in 0.0 seconds
[0m10:36:18.801212 [debug] [Thread-1 (]: Applying DROP to: "datalake"."analytics"."mart_total_unique_users__dbt_backup"
[0m10:36:18.804215 [debug] [Thread-1 (]: Using trino connection "model.my_dbt_trino_project.mart_total_unique_users"
[0m10:36:18.804215 [debug] [Thread-1 (]: On model.my_dbt_trino_project.mart_total_unique_users: /* {"app": "dbt", "dbt_version": "1.8.2", "profile_name": "my_dbt_trino_project", "target_name": "dev", "node_id": "model.my_dbt_trino_project.mart_total_unique_users"} */

    drop table if exists "datalake"."analytics"."mart_total_unique_users__dbt_backup"
[0m10:36:18.912194 [debug] [Thread-1 (]: SQL status: SUCCESS in 0.0 seconds
[0m10:36:18.913202 [debug] [Thread-1 (]: On model.my_dbt_trino_project.mart_total_unique_users: ROLLBACK
[0m10:36:18.914200 [debug] [Thread-1 (]: On model.my_dbt_trino_project.mart_total_unique_users: Close
[0m10:36:18.914200 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'ad86cf40-e840-4e1c-afc0-18283c1d4899', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000001A6BC31D510>]}
[0m10:36:18.915207 [info ] [Thread-1 (]: 13 of 15 OK created sql table model analytics.mart_total_unique_users .......... [[32mSUCCESS[0m in 0.52s]
[0m10:36:18.915207 [debug] [Thread-1 (]: Finished running node model.my_dbt_trino_project.mart_total_unique_users
[0m10:36:18.916379 [debug] [Thread-1 (]: Began running node model.my_dbt_trino_project.mart_user_activity_per_country
[0m10:36:18.916379 [info ] [Thread-1 (]: 14 of 15 START sql table model analytics.mart_user_activity_per_country ........ [RUN]
[0m10:36:18.917384 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.my_dbt_trino_project.mart_total_unique_users, now model.my_dbt_trino_project.mart_user_activity_per_country)
[0m10:36:18.917384 [debug] [Thread-1 (]: Began compiling node model.my_dbt_trino_project.mart_user_activity_per_country
[0m10:36:18.920385 [debug] [Thread-1 (]: Writing injected SQL for node "model.my_dbt_trino_project.mart_user_activity_per_country"
[0m10:36:18.920385 [debug] [Thread-1 (]: Began executing node model.my_dbt_trino_project.mart_user_activity_per_country
[0m10:36:18.923384 [debug] [Thread-1 (]: Writing runtime sql for node "model.my_dbt_trino_project.mart_user_activity_per_country"
[0m10:36:18.924858 [debug] [Thread-1 (]: Using trino connection "model.my_dbt_trino_project.mart_user_activity_per_country"
[0m10:36:18.925400 [debug] [Thread-1 (]: On model.my_dbt_trino_project.mart_user_activity_per_country: /* {"app": "dbt", "dbt_version": "1.8.2", "profile_name": "my_dbt_trino_project", "target_name": "dev", "node_id": "model.my_dbt_trino_project.mart_user_activity_per_country"} */

  
    

    create table "datalake"."analytics"."mart_user_activity_per_country__dbt_tmp"
      
      
    as (
      

SELECT
  country,
  SUM(activity_count) AS total_activity
FROM "datalake"."analytics_stage"."stg_user_activity_per_country"
GROUP BY country
ORDER BY SUM(activity_count) DESC
    )
[0m10:36:18.925400 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m10:36:19.167250 [debug] [Thread-1 (]: SQL status: SUCCESS in 0.0 seconds
[0m10:36:19.170256 [debug] [Thread-1 (]: Using trino connection "model.my_dbt_trino_project.mart_user_activity_per_country"
[0m10:36:19.171257 [debug] [Thread-1 (]: On model.my_dbt_trino_project.mart_user_activity_per_country: /* {"app": "dbt", "dbt_version": "1.8.2", "profile_name": "my_dbt_trino_project", "target_name": "dev", "node_id": "model.my_dbt_trino_project.mart_user_activity_per_country"} */
alter table "datalake"."analytics"."mart_user_activity_per_country" rename to "datalake"."analytics"."mart_user_activity_per_country__dbt_backup"
[0m10:36:19.254611 [debug] [Thread-1 (]: SQL status: SUCCESS in 0.0 seconds
[0m10:36:19.258612 [debug] [Thread-1 (]: Using trino connection "model.my_dbt_trino_project.mart_user_activity_per_country"
[0m10:36:19.258612 [debug] [Thread-1 (]: On model.my_dbt_trino_project.mart_user_activity_per_country: /* {"app": "dbt", "dbt_version": "1.8.2", "profile_name": "my_dbt_trino_project", "target_name": "dev", "node_id": "model.my_dbt_trino_project.mart_user_activity_per_country"} */
alter table "datalake"."analytics"."mart_user_activity_per_country__dbt_tmp" rename to "datalake"."analytics"."mart_user_activity_per_country"
[0m10:36:19.349205 [debug] [Thread-1 (]: SQL status: SUCCESS in 0.0 seconds
[0m10:36:19.352203 [debug] [Thread-1 (]: Applying DROP to: "datalake"."analytics"."mart_user_activity_per_country__dbt_backup"
[0m10:36:19.352203 [debug] [Thread-1 (]: Using trino connection "model.my_dbt_trino_project.mart_user_activity_per_country"
[0m10:36:19.353706 [debug] [Thread-1 (]: On model.my_dbt_trino_project.mart_user_activity_per_country: /* {"app": "dbt", "dbt_version": "1.8.2", "profile_name": "my_dbt_trino_project", "target_name": "dev", "node_id": "model.my_dbt_trino_project.mart_user_activity_per_country"} */

    drop table if exists "datalake"."analytics"."mart_user_activity_per_country__dbt_backup"
[0m10:36:19.448978 [debug] [Thread-1 (]: SQL status: SUCCESS in 0.0 seconds
[0m10:36:19.450989 [debug] [Thread-1 (]: On model.my_dbt_trino_project.mart_user_activity_per_country: ROLLBACK
[0m10:36:19.450989 [debug] [Thread-1 (]: On model.my_dbt_trino_project.mart_user_activity_per_country: Close
[0m10:36:19.451989 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'ad86cf40-e840-4e1c-afc0-18283c1d4899', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000001A6BD87D810>]}
[0m10:36:19.452311 [info ] [Thread-1 (]: 14 of 15 OK created sql table model analytics.mart_user_activity_per_country ... [[32mSUCCESS[0m in 0.53s]
[0m10:36:19.452988 [debug] [Thread-1 (]: Finished running node model.my_dbt_trino_project.mart_user_activity_per_country
[0m10:36:19.452988 [debug] [Thread-1 (]: Began running node model.my_dbt_trino_project.mart_user_activity_per_state
[0m10:36:19.453989 [info ] [Thread-1 (]: 15 of 15 START sql table model analytics.mart_user_activity_per_state .......... [RUN]
[0m10:36:19.453989 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.my_dbt_trino_project.mart_user_activity_per_country, now model.my_dbt_trino_project.mart_user_activity_per_state)
[0m10:36:19.454987 [debug] [Thread-1 (]: Began compiling node model.my_dbt_trino_project.mart_user_activity_per_state
[0m10:36:19.457497 [debug] [Thread-1 (]: Writing injected SQL for node "model.my_dbt_trino_project.mart_user_activity_per_state"
[0m10:36:19.457497 [debug] [Thread-1 (]: Began executing node model.my_dbt_trino_project.mart_user_activity_per_state
[0m10:36:19.460499 [debug] [Thread-1 (]: Writing runtime sql for node "model.my_dbt_trino_project.mart_user_activity_per_state"
[0m10:36:19.461498 [debug] [Thread-1 (]: Using trino connection "model.my_dbt_trino_project.mart_user_activity_per_state"
[0m10:36:19.461498 [debug] [Thread-1 (]: On model.my_dbt_trino_project.mart_user_activity_per_state: /* {"app": "dbt", "dbt_version": "1.8.2", "profile_name": "my_dbt_trino_project", "target_name": "dev", "node_id": "model.my_dbt_trino_project.mart_user_activity_per_state"} */

  
    

    create table "datalake"."analytics"."mart_user_activity_per_state__dbt_tmp"
      
      
    as (
      

SELECT
  state,
  city,
  SUM(activity_count) AS total_activity
FROM "datalake"."analytics_stage"."stg_user_activity_per_location"
GROUP BY state, city
ORDER BY state, SUM(activity_count) DESC
    )
[0m10:36:19.462500 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m10:36:19.727257 [debug] [Thread-1 (]: SQL status: SUCCESS in 0.0 seconds
[0m10:36:19.730841 [debug] [Thread-1 (]: Using trino connection "model.my_dbt_trino_project.mart_user_activity_per_state"
[0m10:36:19.731841 [debug] [Thread-1 (]: On model.my_dbt_trino_project.mart_user_activity_per_state: /* {"app": "dbt", "dbt_version": "1.8.2", "profile_name": "my_dbt_trino_project", "target_name": "dev", "node_id": "model.my_dbt_trino_project.mart_user_activity_per_state"} */
alter table "datalake"."analytics"."mart_user_activity_per_state" rename to "datalake"."analytics"."mart_user_activity_per_state__dbt_backup"
[0m10:36:19.823836 [debug] [Thread-1 (]: SQL status: SUCCESS in 0.0 seconds
[0m10:36:19.827857 [debug] [Thread-1 (]: Using trino connection "model.my_dbt_trino_project.mart_user_activity_per_state"
[0m10:36:19.828378 [debug] [Thread-1 (]: On model.my_dbt_trino_project.mart_user_activity_per_state: /* {"app": "dbt", "dbt_version": "1.8.2", "profile_name": "my_dbt_trino_project", "target_name": "dev", "node_id": "model.my_dbt_trino_project.mart_user_activity_per_state"} */
alter table "datalake"."analytics"."mart_user_activity_per_state__dbt_tmp" rename to "datalake"."analytics"."mart_user_activity_per_state"
[0m10:36:19.919034 [debug] [Thread-1 (]: SQL status: SUCCESS in 0.0 seconds
[0m10:36:19.922052 [debug] [Thread-1 (]: Applying DROP to: "datalake"."analytics"."mart_user_activity_per_state__dbt_backup"
[0m10:36:19.923051 [debug] [Thread-1 (]: Using trino connection "model.my_dbt_trino_project.mart_user_activity_per_state"
[0m10:36:19.923051 [debug] [Thread-1 (]: On model.my_dbt_trino_project.mart_user_activity_per_state: /* {"app": "dbt", "dbt_version": "1.8.2", "profile_name": "my_dbt_trino_project", "target_name": "dev", "node_id": "model.my_dbt_trino_project.mart_user_activity_per_state"} */

    drop table if exists "datalake"."analytics"."mart_user_activity_per_state__dbt_backup"
[0m10:36:20.025484 [debug] [Thread-1 (]: SQL status: SUCCESS in 0.0 seconds
[0m10:36:20.027831 [debug] [Thread-1 (]: On model.my_dbt_trino_project.mart_user_activity_per_state: ROLLBACK
[0m10:36:20.027831 [debug] [Thread-1 (]: On model.my_dbt_trino_project.mart_user_activity_per_state: Close
[0m10:36:20.028831 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'ad86cf40-e840-4e1c-afc0-18283c1d4899', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000001A6BD762E50>]}
[0m10:36:20.028831 [info ] [Thread-1 (]: 15 of 15 OK created sql table model analytics.mart_user_activity_per_state ..... [[32mSUCCESS[0m in 0.57s]
[0m10:36:20.029830 [debug] [Thread-1 (]: Finished running node model.my_dbt_trino_project.mart_user_activity_per_state
[0m10:36:20.030837 [debug] [MainThread]: On master: COMMIT
[0m10:36:20.030837 [debug] [MainThread]: Connection 'master' was properly closed.
[0m10:36:20.030837 [debug] [MainThread]: Connection 'list_datalake' was properly closed.
[0m10:36:20.032115 [debug] [MainThread]: Connection 'list_datalake_analytics_stage' was properly closed.
[0m10:36:20.032115 [debug] [MainThread]: Connection 'model.my_dbt_trino_project.mart_user_activity_per_state' was properly closed.
[0m10:36:20.032620 [info ] [MainThread]: 
[0m10:36:20.033149 [info ] [MainThread]: Finished running 8 table models, 2 incremental models, 5 view models in 0 hours 0 minutes and 6.50 seconds (6.50s).
[0m10:36:20.035303 [debug] [MainThread]: Command end result
[0m10:36:20.068817 [info ] [MainThread]: 
[0m10:36:20.069817 [info ] [MainThread]: [32mCompleted successfully[0m
[0m10:36:20.070820 [info ] [MainThread]: 
[0m10:36:20.070820 [info ] [MainThread]: Done. PASS=15 WARN=0 ERROR=0 SKIP=0 TOTAL=15
[0m10:36:20.072306 [debug] [MainThread]: Command `dbt run` succeeded at 10:36:20.072306 after 7.43 seconds
[0m10:36:20.072306 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000001A6BA6E0DD0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000001A6B6DD4410>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000001A6B6D3E210>]}
[0m10:36:20.073319 [debug] [MainThread]: Flushing usage events
